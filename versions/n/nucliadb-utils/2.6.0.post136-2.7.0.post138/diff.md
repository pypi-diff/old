# Comparing `tmp/nucliadb_utils-2.6.0.post136-py3-none-any.whl.zip` & `tmp/nucliadb_utils-2.7.0.post138-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,71 +1,71 @@
-Zip file size: 97435 bytes, number of entries: 69
--rw-r--r--  2.0 unx      895 b- defN 23-Apr-06 11:12 nucliadb_utils/__init__.py
--rw-r--r--  2.0 unx     5877 b- defN 23-Apr-06 11:12 nucliadb_utils/authentication.py
--rw-r--r--  2.0 unx     4518 b- defN 23-Apr-06 11:12 nucliadb_utils/clandestined.py
--rw-r--r--  2.0 unx     1090 b- defN 23-Apr-06 11:12 nucliadb_utils/exceptions.py
--rw-r--r--  2.0 unx     1872 b- defN 23-Apr-06 11:12 nucliadb_utils/featureflagging.py
--rw-r--r--  2.0 unx     3572 b- defN 23-Apr-06 11:12 nucliadb_utils/indexing.py
--rw-r--r--  2.0 unx      867 b- defN 23-Apr-06 11:12 nucliadb_utils/keys.py
--rw-r--r--  2.0 unx     2720 b- defN 23-Apr-06 11:12 nucliadb_utils/metrics.py
--rw-r--r--  2.0 unx     1519 b- defN 23-Apr-06 11:12 nucliadb_utils/nats.py
--rw-r--r--  2.0 unx     1173 b- defN 23-Apr-06 11:12 nucliadb_utils/partition.py
--rw-r--r--  2.0 unx        0 b- defN 23-Apr-06 11:12 nucliadb_utils/py.typed
--rw-r--r--  2.0 unx     1713 b- defN 23-Apr-06 11:12 nucliadb_utils/run.py
--rw-r--r--  2.0 unx     4451 b- defN 23-Apr-06 11:12 nucliadb_utils/settings.py
--rw-r--r--  2.0 unx     1337 b- defN 23-Apr-06 11:12 nucliadb_utils/settings_running.py
--rw-r--r--  2.0 unx      890 b- defN 23-Apr-06 11:12 nucliadb_utils/store.py
--rw-r--r--  2.0 unx     6633 b- defN 23-Apr-06 11:12 nucliadb_utils/transaction.py
--rw-r--r--  2.0 unx     9964 b- defN 23-Apr-06 11:12 nucliadb_utils/utilities.py
--rw-r--r--  2.0 unx      835 b- defN 23-Apr-06 11:12 nucliadb_utils/audit/__init__.py
--rw-r--r--  2.0 unx     2013 b- defN 23-Apr-06 11:12 nucliadb_utils/audit/audit.py
--rw-r--r--  2.0 unx     2446 b- defN 23-Apr-06 11:12 nucliadb_utils/audit/basic.py
--rw-r--r--  2.0 unx     7688 b- defN 23-Apr-06 11:12 nucliadb_utils/audit/stream.py
--rw-r--r--  2.0 unx      900 b- defN 23-Apr-06 11:12 nucliadb_utils/cache/__init__.py
--rw-r--r--  2.0 unx      975 b- defN 23-Apr-06 11:12 nucliadb_utils/cache/exceptions.py
--rw-r--r--  2.0 unx     1216 b- defN 23-Apr-06 11:12 nucliadb_utils/cache/memcache.py
--rw-r--r--  2.0 unx     6776 b- defN 23-Apr-06 11:12 nucliadb_utils/cache/nats.py
--rw-r--r--  2.0 unx     1654 b- defN 23-Apr-06 11:12 nucliadb_utils/cache/pubsub.py
--rw-r--r--  2.0 unx     3676 b- defN 23-Apr-06 11:12 nucliadb_utils/cache/redis.py
--rw-r--r--  2.0 unx     1302 b- defN 23-Apr-06 11:12 nucliadb_utils/cache/settings.py
--rw-r--r--  2.0 unx     5906 b- defN 23-Apr-06 11:12 nucliadb_utils/cache/utility.py
--rw-r--r--  2.0 unx      833 b- defN 23-Apr-06 11:12 nucliadb_utils/fastapi/__init__.py
--rw-r--r--  2.0 unx     1316 b- defN 23-Apr-06 11:12 nucliadb_utils/fastapi/metrics.py
--rw-r--r--  2.0 unx     1737 b- defN 23-Apr-06 11:12 nucliadb_utils/fastapi/openapi.py
--rw-r--r--  2.0 unx     3888 b- defN 23-Apr-06 11:12 nucliadb_utils/fastapi/run.py
--rw-r--r--  2.0 unx     3786 b- defN 23-Apr-06 11:12 nucliadb_utils/fastapi/versioning.py
--rw-r--r--  2.0 unx      855 b- defN 23-Apr-06 11:12 nucliadb_utils/storages/__init__.py
--rw-r--r--  2.0 unx     2165 b- defN 23-Apr-06 11:12 nucliadb_utils/storages/exceptions.py
--rw-r--r--  2.0 unx    25473 b- defN 23-Apr-06 11:12 nucliadb_utils/storages/gcs.py
--rw-r--r--  2.0 unx    10180 b- defN 23-Apr-06 11:12 nucliadb_utils/storages/local.py
--rw-r--r--  2.0 unx     2093 b- defN 23-Apr-06 11:12 nucliadb_utils/storages/nuclia.py
--rw-r--r--  2.0 unx    17174 b- defN 23-Apr-06 11:12 nucliadb_utils/storages/pg.py
--rw-r--r--  2.0 unx    15029 b- defN 23-Apr-06 11:12 nucliadb_utils/storages/s3.py
--rw-r--r--  2.0 unx     1276 b- defN 23-Apr-06 11:12 nucliadb_utils/storages/settings.py
--rw-r--r--  2.0 unx    16412 b- defN 23-Apr-06 11:12 nucliadb_utils/storages/storage.py
--rw-r--r--  2.0 unx      833 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/__init__.py
--rw-r--r--  2.0 unx    10691 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/asyncbenchmark.py
--rw-r--r--  2.0 unx     1043 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/clandestined.py
--rw-r--r--  2.0 unx     1686 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/conftest.py
--rw-r--r--  2.0 unx     2758 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/gcs.py
--rw-r--r--  2.0 unx     2307 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/indexing.py
--rw-r--r--  2.0 unx     1310 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/local.py
--rw-r--r--  2.0 unx     7697 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/nats.py
--rw-r--r--  2.0 unx     2216 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/s3.py
--rw-r--r--  2.0 unx      833 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/unit/__init__.py
--rw-r--r--  2.0 unx     5159 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/unit/test_authentication.py
--rw-r--r--  2.0 unx    14507 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/unit/test_clandestined.py
--rw-r--r--  2.0 unx     1949 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/unit/test_clandestined_collision.py
--rw-r--r--  2.0 unx     5303 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/unit/test_clandestined_rendezvous_hash.py
--rw-r--r--  2.0 unx     1910 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/unit/test_run.py
--rw-r--r--  2.0 unx     1189 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/unit/test_tests.py
--rw-r--r--  2.0 unx     1667 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/unit/test_transaction.py
--rw-r--r--  2.0 unx     4436 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/unit/test_utilities.py
--rw-r--r--  2.0 unx      833 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/unit/storages/__init__.py
--rw-r--r--  2.0 unx    16726 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/unit/storages/test_pg.py
--rw-r--r--  2.0 unx     4943 b- defN 23-Apr-06 11:12 nucliadb_utils/tests/unit/storages/test_storage.py
--rw-r--r--  2.0 unx     1924 b- defN 23-Apr-06 11:14 nucliadb_utils-2.6.0.post136.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Apr-06 11:14 nucliadb_utils-2.6.0.post136.dist-info/WHEEL
--rw-r--r--  2.0 unx       15 b- defN 23-Apr-06 11:14 nucliadb_utils-2.6.0.post136.dist-info/top_level.txt
--rw-r--r--  2.0 unx        1 b- defN 23-Apr-06 11:13 nucliadb_utils-2.6.0.post136.dist-info/zip-safe
--rw-rw-r--  2.0 unx     6216 b- defN 23-Apr-06 11:14 nucliadb_utils-2.6.0.post136.dist-info/RECORD
-69 files, 284939 bytes uncompressed, 87469 bytes compressed:  69.3%
+Zip file size: 96905 bytes, number of entries: 69
+-rw-r--r--  2.0 unx      895 b- defN 23-Apr-06 19:29 nucliadb_utils/__init__.py
+-rw-r--r--  2.0 unx     5877 b- defN 23-Apr-06 19:29 nucliadb_utils/authentication.py
+-rw-r--r--  2.0 unx     4518 b- defN 23-Apr-06 19:29 nucliadb_utils/clandestined.py
+-rw-r--r--  2.0 unx     1090 b- defN 23-Apr-06 19:29 nucliadb_utils/exceptions.py
+-rw-r--r--  2.0 unx     1872 b- defN 23-Apr-06 19:29 nucliadb_utils/featureflagging.py
+-rw-r--r--  2.0 unx     2212 b- defN 23-Apr-06 19:29 nucliadb_utils/grpc.py
+-rw-r--r--  2.0 unx     3572 b- defN 23-Apr-06 19:29 nucliadb_utils/indexing.py
+-rw-r--r--  2.0 unx      867 b- defN 23-Apr-06 19:29 nucliadb_utils/keys.py
+-rw-r--r--  2.0 unx     1519 b- defN 23-Apr-06 19:29 nucliadb_utils/nats.py
+-rw-r--r--  2.0 unx     1173 b- defN 23-Apr-06 19:29 nucliadb_utils/partition.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Apr-06 19:29 nucliadb_utils/py.typed
+-rw-r--r--  2.0 unx     1713 b- defN 23-Apr-06 19:29 nucliadb_utils/run.py
+-rw-r--r--  2.0 unx     4451 b- defN 23-Apr-06 19:29 nucliadb_utils/settings.py
+-rw-r--r--  2.0 unx     1337 b- defN 23-Apr-06 19:29 nucliadb_utils/settings_running.py
+-rw-r--r--  2.0 unx      890 b- defN 23-Apr-06 19:29 nucliadb_utils/store.py
+-rw-r--r--  2.0 unx     6633 b- defN 23-Apr-06 19:29 nucliadb_utils/transaction.py
+-rw-r--r--  2.0 unx     9964 b- defN 23-Apr-06 19:29 nucliadb_utils/utilities.py
+-rw-r--r--  2.0 unx      835 b- defN 23-Apr-06 19:29 nucliadb_utils/audit/__init__.py
+-rw-r--r--  2.0 unx     2013 b- defN 23-Apr-06 19:29 nucliadb_utils/audit/audit.py
+-rw-r--r--  2.0 unx     2446 b- defN 23-Apr-06 19:29 nucliadb_utils/audit/basic.py
+-rw-r--r--  2.0 unx     7688 b- defN 23-Apr-06 19:29 nucliadb_utils/audit/stream.py
+-rw-r--r--  2.0 unx      900 b- defN 23-Apr-06 19:29 nucliadb_utils/cache/__init__.py
+-rw-r--r--  2.0 unx      975 b- defN 23-Apr-06 19:29 nucliadb_utils/cache/exceptions.py
+-rw-r--r--  2.0 unx     1216 b- defN 23-Apr-06 19:29 nucliadb_utils/cache/memcache.py
+-rw-r--r--  2.0 unx     6776 b- defN 23-Apr-06 19:29 nucliadb_utils/cache/nats.py
+-rw-r--r--  2.0 unx     1654 b- defN 23-Apr-06 19:29 nucliadb_utils/cache/pubsub.py
+-rw-r--r--  2.0 unx     3110 b- defN 23-Apr-06 19:29 nucliadb_utils/cache/redis.py
+-rw-r--r--  2.0 unx     1302 b- defN 23-Apr-06 19:29 nucliadb_utils/cache/settings.py
+-rw-r--r--  2.0 unx     5906 b- defN 23-Apr-06 19:29 nucliadb_utils/cache/utility.py
+-rw-r--r--  2.0 unx      833 b- defN 23-Apr-06 19:29 nucliadb_utils/fastapi/__init__.py
+-rw-r--r--  2.0 unx     1316 b- defN 23-Apr-06 19:29 nucliadb_utils/fastapi/metrics.py
+-rw-r--r--  2.0 unx     1737 b- defN 23-Apr-06 19:29 nucliadb_utils/fastapi/openapi.py
+-rw-r--r--  2.0 unx     3888 b- defN 23-Apr-06 19:29 nucliadb_utils/fastapi/run.py
+-rw-r--r--  2.0 unx     3786 b- defN 23-Apr-06 19:29 nucliadb_utils/fastapi/versioning.py
+-rw-r--r--  2.0 unx      855 b- defN 23-Apr-06 19:29 nucliadb_utils/storages/__init__.py
+-rw-r--r--  2.0 unx     2165 b- defN 23-Apr-06 19:29 nucliadb_utils/storages/exceptions.py
+-rw-r--r--  2.0 unx    24772 b- defN 23-Apr-06 19:29 nucliadb_utils/storages/gcs.py
+-rw-r--r--  2.0 unx    10180 b- defN 23-Apr-06 19:29 nucliadb_utils/storages/local.py
+-rw-r--r--  2.0 unx     2093 b- defN 23-Apr-06 19:29 nucliadb_utils/storages/nuclia.py
+-rw-r--r--  2.0 unx    17174 b- defN 23-Apr-06 19:29 nucliadb_utils/storages/pg.py
+-rw-r--r--  2.0 unx    15029 b- defN 23-Apr-06 19:29 nucliadb_utils/storages/s3.py
+-rw-r--r--  2.0 unx     1276 b- defN 23-Apr-06 19:29 nucliadb_utils/storages/settings.py
+-rw-r--r--  2.0 unx    16412 b- defN 23-Apr-06 19:29 nucliadb_utils/storages/storage.py
+-rw-r--r--  2.0 unx      833 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/__init__.py
+-rw-r--r--  2.0 unx    10691 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/asyncbenchmark.py
+-rw-r--r--  2.0 unx     1043 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/clandestined.py
+-rw-r--r--  2.0 unx     1686 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/conftest.py
+-rw-r--r--  2.0 unx     2758 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/gcs.py
+-rw-r--r--  2.0 unx     2307 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/indexing.py
+-rw-r--r--  2.0 unx     1310 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/local.py
+-rw-r--r--  2.0 unx     7697 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/nats.py
+-rw-r--r--  2.0 unx     2216 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/s3.py
+-rw-r--r--  2.0 unx      833 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/unit/__init__.py
+-rw-r--r--  2.0 unx     5159 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/unit/test_authentication.py
+-rw-r--r--  2.0 unx    14507 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/unit/test_clandestined.py
+-rw-r--r--  2.0 unx     1949 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/unit/test_clandestined_collision.py
+-rw-r--r--  2.0 unx     5303 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/unit/test_clandestined_rendezvous_hash.py
+-rw-r--r--  2.0 unx     1910 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/unit/test_run.py
+-rw-r--r--  2.0 unx     1189 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/unit/test_tests.py
+-rw-r--r--  2.0 unx     1667 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/unit/test_transaction.py
+-rw-r--r--  2.0 unx     4436 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/unit/test_utilities.py
+-rw-r--r--  2.0 unx      833 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/unit/storages/__init__.py
+-rw-r--r--  2.0 unx    16726 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/unit/storages/test_pg.py
+-rw-r--r--  2.0 unx     4943 b- defN 23-Apr-06 19:29 nucliadb_utils/tests/unit/storages/test_storage.py
+-rw-r--r--  2.0 unx     1924 b- defN 23-Apr-06 19:31 nucliadb_utils-2.7.0.post138.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-06 19:31 nucliadb_utils-2.7.0.post138.dist-info/WHEEL
+-rw-r--r--  2.0 unx       15 b- defN 23-Apr-06 19:31 nucliadb_utils-2.7.0.post138.dist-info/top_level.txt
+-rw-r--r--  2.0 unx        1 b- defN 23-Apr-06 19:30 nucliadb_utils-2.7.0.post138.dist-info/zip-safe
+-rw-rw-r--  2.0 unx     6213 b- defN 23-Apr-06 19:31 nucliadb_utils-2.7.0.post138.dist-info/RECORD
+69 files, 283161 bytes uncompressed, 86945 bytes compressed:  69.3%
```

## zipnote {}

```diff
@@ -9,21 +9,21 @@
 
 Filename: nucliadb_utils/exceptions.py
 Comment: 
 
 Filename: nucliadb_utils/featureflagging.py
 Comment: 
 
-Filename: nucliadb_utils/indexing.py
+Filename: nucliadb_utils/grpc.py
 Comment: 
 
-Filename: nucliadb_utils/keys.py
+Filename: nucliadb_utils/indexing.py
 Comment: 
 
-Filename: nucliadb_utils/metrics.py
+Filename: nucliadb_utils/keys.py
 Comment: 
 
 Filename: nucliadb_utils/nats.py
 Comment: 
 
 Filename: nucliadb_utils/partition.py
 Comment: 
@@ -186,23 +186,23 @@
 
 Filename: nucliadb_utils/tests/unit/storages/test_pg.py
 Comment: 
 
 Filename: nucliadb_utils/tests/unit/storages/test_storage.py
 Comment: 
 
-Filename: nucliadb_utils-2.6.0.post136.dist-info/METADATA
+Filename: nucliadb_utils-2.7.0.post138.dist-info/METADATA
 Comment: 
 
-Filename: nucliadb_utils-2.6.0.post136.dist-info/WHEEL
+Filename: nucliadb_utils-2.7.0.post138.dist-info/WHEEL
 Comment: 
 
-Filename: nucliadb_utils-2.6.0.post136.dist-info/top_level.txt
+Filename: nucliadb_utils-2.7.0.post138.dist-info/top_level.txt
 Comment: 
 
-Filename: nucliadb_utils-2.6.0.post136.dist-info/zip-safe
+Filename: nucliadb_utils-2.7.0.post138.dist-info/zip-safe
 Comment: 
 
-Filename: nucliadb_utils-2.6.0.post136.dist-info/RECORD
+Filename: nucliadb_utils-2.7.0.post138.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## nucliadb_utils/cache/redis.py

```diff
@@ -16,41 +16,22 @@
 #
 # You should have received a copy of the GNU Affero General Public License
 # along with this program. If not, see <http://www.gnu.org/licenses/>.
 #
 import asyncio
 from typing import Dict, Optional
 
-import prometheus_client  # type: ignore
+from nucliadb_telemetry import metrics
 from redis import asyncio as aioredis
 from redis.asyncio.client import PubSub
 
-from nucliadb_utils import metrics
 from nucliadb_utils.cache.exceptions import GroupNotSupported, NoPubsubConfigured
 from nucliadb_utils.cache.pubsub import Callback, PubSubDriver
 
-REDIS_OPS = prometheus_client.Counter(
-    "guillotina_cache_redis_ops_total",
-    "Total count of ops by type of operation and the error if there was.",
-    labelnames=["type", "error"],
-)
-REDIS_OPS_PROCESSING_TIME = prometheus_client.Histogram(
-    "guillotina_cache_redis_ops_processing_time_seconds",
-    "Histogram of operations processing time by type (in seconds)",
-    labelnames=["type"],
-)
-
-
-class watch(metrics.watch):
-    def __init__(self, operation: str):
-        super().__init__(
-            counter=REDIS_OPS,
-            histogram=REDIS_OPS_PROCESSING_TIME,
-            labels={"type": operation},
-        )
+redis_observer = metrics.Observer("redis_pubsub", labels={"type": ""})
 
 
 class RedisPubsub(PubSubDriver):
     pubsub: Optional[PubSub] = None
     task: Optional[asyncio.Task] = None
     initialized: bool = False
     driver: Optional[aioredis.Redis] = None
@@ -75,15 +56,15 @@
             await self.driver.close()
         self.initialized = False
 
     async def publish(self, key: str, value: bytes):
         if self.driver is None:
             raise NoPubsubConfigured()
 
-        with watch("publish"):
+        with redis_observer(labels={"type": "publish"}):
             await self.driver.publish(key, value)
 
     async def unsubscribe(self, key: str, subscription_id: Optional[str] = None):
         if self.driver is None or self.pubsub is None:
             raise NoPubsubConfigured()
 
         await self.pubsub.unsubscribe(key)
```

## nucliadb_utils/storages/gcs.py

```diff
@@ -31,16 +31,15 @@
 import aiohttp
 import backoff  # type: ignore
 import google.auth.transport.requests  # type: ignore
 import yarl
 from google.oauth2 import service_account  # type: ignore
 from nucliadb_protos.resources_pb2 import CloudFile
 from nucliadb_telemetry import metrics
-from nucliadb_telemetry.utils import get_telemetry, init_telemetry
-from opentelemetry.instrumentation.aiohttp_client import create_trace_config
+from nucliadb_telemetry.utils import setup_telemetry
 
 from nucliadb_utils import logger
 from nucliadb_utils.storages import CHUNK_SIZE
 from nucliadb_utils.storages.exceptions import (
     CouldNotCopyNotFound,
     CouldNotCreateBucket,
     InvalidOffset,
@@ -133,14 +132,15 @@
                     destination_bucket_name=destination_bucket_name,
                     text=text,
                 )
             else:
                 data = await resp.json()
                 assert data["resource"]["name"] == destination_uri
 
+    @backoff.on_exception(backoff.expo, RETRIABLE_EXCEPTIONS, max_tries=4)
     @storage_ops_observer.wrap({"type": "iter_data"})
     async def iter_data(self, headers=None):
         if headers is None:
             headers = {}
 
         key = self.field.uri if self.field else self.key
         if self.field is None:
@@ -459,36 +459,19 @@
         if self._credentials.valid is False:
             req = google.auth.transport.requests.Request()
             self._credentials.refresh(req)
             self._creation_access_token = datetime.now()
         return self._credentials.token
 
     @storage_ops_observer.wrap({"type": "initialize"})
-    async def initialize(self, service_name: Optional[str] = "GCS_SERVICE"):
+    async def initialize(self, service_name: Optional[str] = None):
         loop = asyncio.get_event_loop()
 
-        tracer_provider = get_telemetry(service_name)
-        if tracer_provider:  # pragma: no cover
-            await init_telemetry(tracer_provider)
-            logger.info("Initializing Telemetry on GCS Driver")
-            self.session = aiohttp.ClientSession(
-                loop=loop,
-                trace_configs=[
-                    create_trace_config(
-                        # Remove all query params from the URL attribute on the span.
-                        url_filter=strip_query_params,
-                        tracer_provider=tracer_provider,
-                    )
-                ],
-            )
-        else:
-            logger.info("Initializing GCS Driver without Telemetry")
-            self.session = aiohttp.ClientSession(
-                loop=loop,
-            )
+        await setup_telemetry(service_name or "GCS_SERVICE")
+        self.session = aiohttp.ClientSession(loop=loop)
 
         try:
             if self.deadletter_bucket is not None and self.deadletter_bucket != "":
                 await self.create_bucket(self.deadletter_bucket)
         except Exception:  # pragma: no cover
             logger.exception(
                 f"Could not create bucket {self.deadletter_bucket}", exc_info=True
```

## Comparing `nucliadb_utils-2.6.0.post136.dist-info/METADATA` & `nucliadb_utils-2.7.0.post138.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: nucliadb-utils
-Version: 2.6.0.post136
+Version: 2.7.0.post138
 Summary: UNKNOWN
 Home-page: https://nuclia.com
 License: BSD
 Platform: UNKNOWN
 Classifier: Development Status :: 4 - Beta
 Classifier: Programming Language :: Python :: 3.7
 Classifier: Topic :: Software Development :: Libraries :: Python Modules
@@ -12,16 +12,16 @@
 Requires-Dist: aiohttp (>=3.8.1)
 Requires-Dist: prometheus-client (>=0.12.0)
 Requires-Dist: types-requests (>=2.27.7)
 Requires-Dist: mmh3 (>=3.0.0)
 Requires-Dist: nats-py[nkeys] (>=2.1.3)
 Requires-Dist: pyjwt (>=2.4.0)
 Requires-Dist: memorylru (>=1.1.2)
-Requires-Dist: nucliadb-protos (==2.6.0-post136)
-Requires-Dist: nucliadb-telemetry (>=1.5.0)
+Requires-Dist: nucliadb-protos (==2.7.0-post138)
+Requires-Dist: nucliadb-telemetry (>=1.7.0)
 Requires-Dist: mrflagly
 Provides-Extra: cache
 Requires-Dist: redis (>=4.3.4) ; extra == 'cache'
 Requires-Dist: orjson (>=3.6.7) ; extra == 'cache'
 Requires-Dist: lru-dict (>=1.1.7) ; extra == 'cache'
 Provides-Extra: fastapi
 Requires-Dist: fastapi (<0.89.0,>=0.75.0) ; extra == 'fastapi'
@@ -30,15 +30,15 @@
 Provides-Extra: postgres
 Requires-Dist: asyncpg (>=0.27.0) ; extra == 'postgres'
 Provides-Extra: storages
 Requires-Dist: oauth2client (>=4.1.3) ; extra == 'storages'
 Requires-Dist: aiobotocore (>=2.1.1) ; extra == 'storages'
 Requires-Dist: google-api-python-client (>=2.37.0) ; extra == 'storages'
 Requires-Dist: opentelemetry-instrumentation-aiohttp-client ; extra == 'storages'
-Requires-Dist: nucliadb-telemetry (>=1.5.0) ; extra == 'storages'
+Requires-Dist: nucliadb-telemetry (>=1.7.0) ; extra == 'storages'
 Requires-Dist: types-aiofiles (>=0.8.3) ; extra == 'storages'
 Requires-Dist: aiofiles (>=0.8.0) ; extra == 'storages'
 Requires-Dist: backoff (>=1.11.1) ; extra == 'storages'
 Requires-Dist: google-auth (>=2.4.1) ; extra == 'storages'
 
 # nucliadb util python library
```

## Comparing `nucliadb_utils-2.6.0.post136.dist-info/RECORD` & `nucliadb_utils-2.7.0.post138.dist-info/RECORD`

 * *Files 3% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 nucliadb_utils/__init__.py,sha256=EvBCH1iTODe-AgXm48aj4kVUt_Std3PeL8QnwimR5wI,895
 nucliadb_utils/authentication.py,sha256=Ww3aTu1SrU0KvHZDSr14Ys_iplQXgAgA_GsdRDp51lY,5877
 nucliadb_utils/clandestined.py,sha256=impMwO7eLA-peRuY4nPqMtMLHWU1nZQC040SHC22XJg,4518
 nucliadb_utils/exceptions.py,sha256=qLsVXniEfWaLxGNhEQc06e6FR2k8lILjPa8Bp8inZz4,1090
 nucliadb_utils/featureflagging.py,sha256=vJVE5OeraibccnFhh6ZwS39aJuyearq59IHKei_48Hg,1872
+nucliadb_utils/grpc.py,sha256=DJE9tQDvjUiiyF43F3Bsl5tfXmjO49l89IETfBOgCIo,2212
 nucliadb_utils/indexing.py,sha256=JSyNSzAbYthomDI2hvr9KaH9nGE7IURPZA0wAUNnzSc,3572
 nucliadb_utils/keys.py,sha256=fjumJHFoRaTbasLO5jZJ46xacAy-HqYAN-8Oquup75o,867
-nucliadb_utils/metrics.py,sha256=8c1jV1wWVtfltCm2bsgaWZDmnyFDWlpD8YzwUfE1vyI,2720
 nucliadb_utils/nats.py,sha256=YW4uMrgL0Ih3SMd5Yo_kHZtas86WXrKo-Nb7HQjEPR4,1519
 nucliadb_utils/partition.py,sha256=0tmXuwRM_v-OmKoRkB--OMDzomVEkmgxqMmNNomI_24,1173
 nucliadb_utils/py.typed,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 nucliadb_utils/run.py,sha256=bKMfsPEK6WdWfiPyWPUxCqcLo4tq6eOwyaf910TOwBk,1713
 nucliadb_utils/settings.py,sha256=odBjp1fuf3qFC6psEWydX8e2C_bZwXNMK4oq2UE1jAM,4451
 nucliadb_utils/settings_running.py,sha256=zCqvq6XsHxDrF_3bWd2m-iYLefPznvqQkBX33WfdeSk,1337
 nucliadb_utils/store.py,sha256=kQ35HemE0v4_Qg6xVqNIJi8vSFAYQtwI3rDtMsNy62Y,890
@@ -20,25 +20,25 @@
 nucliadb_utils/audit/basic.py,sha256=V6bYvJqP9cvagrvnrYaym0aKpictP0XvL_s34S0YX68,2446
 nucliadb_utils/audit/stream.py,sha256=jZe2VbZ4dR5oRkfOnoOKsmEeQMqcUWMxsjccL7oJCW8,7688
 nucliadb_utils/cache/__init__.py,sha256=vVp-ZPp_aGpofI754T7E9JxsMkATqAEytangiKvE1Nk,900
 nucliadb_utils/cache/exceptions.py,sha256=Zu-O_-0-yctOEgoDGI92gPzWfBMRrpiAyESA62ld6MA,975
 nucliadb_utils/cache/memcache.py,sha256=CWd09BLh0K7vmxmj3Bhh0cLlCVeI_uvkzubqJpK7h0A,1216
 nucliadb_utils/cache/nats.py,sha256=TZ2naqcLMwP9Pkzxt1fEQ55km4iPKn9mJjhYXpHR62E,6776
 nucliadb_utils/cache/pubsub.py,sha256=l8i_RwRf7OPzfmPy-gyn66xgYFs5aHidCIjEaU9VOHE,1654
-nucliadb_utils/cache/redis.py,sha256=sVYriP66UMaZelDCvmas1w-uoxGiTxinhq45YBLJkIE,3676
+nucliadb_utils/cache/redis.py,sha256=EvtfbZgBDwDMgZNeHCsfJylFWlHFTp8NdC3zQHzHfEc,3110
 nucliadb_utils/cache/settings.py,sha256=CP4YsCYQUFC3ki_i-54qoMZX-Iup53nrT1V9NIg05RE,1302
 nucliadb_utils/cache/utility.py,sha256=N_3BjomLEEmoZ3ieGWsRZXuwrhLK-qqH8mF0UsldjF0,5906
 nucliadb_utils/fastapi/__init__.py,sha256=itSI7dtTwFP55YMX4iK7JzdMHS5CQVUiB1XzQu4UBh8,833
 nucliadb_utils/fastapi/metrics.py,sha256=7cfOKdAYtYMZ-n62Hui-SOfBRnBVQht363f2AfUI6qc,1316
 nucliadb_utils/fastapi/openapi.py,sha256=b0pLuri0QuzQd0elDyOVXM42YYmES_cmT-jEfsQ1G6Y,1737
 nucliadb_utils/fastapi/run.py,sha256=eG-Ttvl0Ii6BlHQkTnCEXPZwlMzQK3LIV-7IVfUvvJw,3888
 nucliadb_utils/fastapi/versioning.py,sha256=yzHG_TS8ga-qXum6op2dZUxDrVr_zBjAu6LNz28Elao,3786
 nucliadb_utils/storages/__init__.py,sha256=WOSaQhFBQ_TePebZa1nCy_MJAI61ioY_52P9x8LG4SI,855
 nucliadb_utils/storages/exceptions.py,sha256=B4rAjJSjnrcKbnWQpTi1xCz55uRcOrOuQI-W8-tgInI,2165
-nucliadb_utils/storages/gcs.py,sha256=ILjuENvLdgKkQyTgG0Lqjj53p-oRCLm2mKwH3DF-Q6g,25473
+nucliadb_utils/storages/gcs.py,sha256=_8p91D50hwNTcv9775FJDZQ3A4PkoQY1ITv_cmaAnFk,24772
 nucliadb_utils/storages/local.py,sha256=BHc3fG_aiKIVujlqKgig9EiCv5HrKzYCbdPhuhTR-Oc,10180
 nucliadb_utils/storages/nuclia.py,sha256=4qYM0sI9uYbURy-cKtWWiU13ojkWsgjZ8Z0V_cvv7Fo,2093
 nucliadb_utils/storages/pg.py,sha256=hvWZOhUJsboIMCvtFaDg4Dl8Mi5hkEBuYvuPFJESLhI,17174
 nucliadb_utils/storages/s3.py,sha256=LShMSeHJVTvS4xYlimFbKZvHQqaCOIJ7Wr1gsc9kJgc,15029
 nucliadb_utils/storages/settings.py,sha256=bUl3D7To-s3OVXPFFF7LwJbEKGF2WvDM14pwqQdkyoQ,1276
 nucliadb_utils/storages/storage.py,sha256=wDxaN4ErTsuzYdr7FYXv7kMBkiMd65Qqz_XafgfjOs0,16412
 nucliadb_utils/tests/__init__.py,sha256=itSI7dtTwFP55YMX4iK7JzdMHS5CQVUiB1XzQu4UBh8,833
@@ -58,12 +58,12 @@
 nucliadb_utils/tests/unit/test_run.py,sha256=VHeojVBj_AfV_uNch9eEi4zCT-O94VKjwb_O-UZgqpA,1910
 nucliadb_utils/tests/unit/test_tests.py,sha256=-YHgVMKJr_3WYwrBj9TnwpVLIkP80PLZpWnvAIYvnz8,1189
 nucliadb_utils/tests/unit/test_transaction.py,sha256=0K09sWCEZ9iFXHYOiPDhS1Vw5F4akyrmboLalwH-B6U,1667
 nucliadb_utils/tests/unit/test_utilities.py,sha256=96pliy7wk1RqA8r7ogsf4_9AE7FRNK6PjTrB5O-_jBw,4436
 nucliadb_utils/tests/unit/storages/__init__.py,sha256=itSI7dtTwFP55YMX4iK7JzdMHS5CQVUiB1XzQu4UBh8,833
 nucliadb_utils/tests/unit/storages/test_pg.py,sha256=KAIzD3QuJFMRNSSAKz-M5qrO9fJIHYbZfiOOleTgP1c,16726
 nucliadb_utils/tests/unit/storages/test_storage.py,sha256=td_CgoTEmr3j6OnEHe5idLi5JhYlcYHwIhL_19ov9mc,4943
-nucliadb_utils-2.6.0.post136.dist-info/METADATA,sha256=fLkW4PVFy-bulXN4O2nFTeYhHh8KnwQp7rgxmaj9wT4,1924
-nucliadb_utils-2.6.0.post136.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-nucliadb_utils-2.6.0.post136.dist-info/top_level.txt,sha256=fE3vJtALTfgh7bcAWcNhcfXkNPp_eVVpbKK-2IYua3E,15
-nucliadb_utils-2.6.0.post136.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
-nucliadb_utils-2.6.0.post136.dist-info/RECORD,,
+nucliadb_utils-2.7.0.post138.dist-info/METADATA,sha256=-kX9gmNJZej1KtF4xdFwZafrYejElqhCjXBgG9bmch0,1924
+nucliadb_utils-2.7.0.post138.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+nucliadb_utils-2.7.0.post138.dist-info/top_level.txt,sha256=fE3vJtALTfgh7bcAWcNhcfXkNPp_eVVpbKK-2IYua3E,15
+nucliadb_utils-2.7.0.post138.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
+nucliadb_utils-2.7.0.post138.dist-info/RECORD,,
```

