--- tmp/crypt-dir-1.1.2.tar.gz
+++ tmp/crypt-dir-1.1.3.tar.gz
├── filetype from file(1)
│ @@ -1 +1 @@
│ -gzip compressed data, was "crypt-dir-1.1.2.tar", last modified: Thu Apr  6 16:39:57 2023, max compression
│ +gzip compressed data, was "crypt-dir-1.1.3.tar", last modified: Thu Apr  6 16:42:15 2023, max compression
│   --- crypt-dir-1.1.2.tar
├── +++ crypt-dir-1.1.3.tar
│ ├── file list
│ │ @@ -1,19 +1,19 @@
│ │ -drwxr-xr-x   0 khanh      (501) staff       (20)        0 2023-04-06 16:39:57.230813 crypt-dir-1.1.2/
│ │ --rw-r--r--   0 khanh      (501) staff       (20)     1069 2023-03-31 12:34:48.000000 crypt-dir-1.1.2/LICENSE
│ │ --rw-r--r--   0 khanh      (501) staff       (20)     3764 2023-04-06 16:39:57.230660 crypt-dir-1.1.2/PKG-INFO
│ │ --rw-r--r--   0 khanh      (501) staff       (20)     3506 2023-04-06 16:16:43.000000 crypt-dir-1.1.2/README.md
│ │ -drwxr-xr-x   0 khanh      (501) staff       (20)        0 2023-04-06 16:39:57.229503 crypt-dir-1.1.2/crypt_dir/
│ │ --rw-r--r--   0 khanh      (501) staff       (20)      150 2023-04-06 16:16:18.000000 crypt-dir-1.1.2/crypt_dir/__init__.py
│ │ --rw-r--r--   0 khanh      (501) staff       (20)     2511 2023-04-06 16:19:50.000000 crypt-dir-1.1.2/crypt_dir/crypt.py
│ │ --rw-r--r--   0 khanh      (501) staff       (20)     6083 2023-04-06 15:55:36.000000 crypt-dir-1.1.2/crypt_dir/crypt_dir.py
│ │ --rw-r--r--   0 khanh      (501) staff       (20)     4040 2023-04-06 16:39:47.000000 crypt-dir-1.1.2/crypt_dir/crypt_file.py
│ │ --rw-r--r--   0 khanh      (501) staff       (20)      257 2023-04-06 15:59:40.000000 crypt-dir-1.1.2/crypt_dir/serialize.py
│ │ --rw-r--r--   0 khanh      (501) staff       (20)      805 2023-04-06 16:03:15.000000 crypt-dir-1.1.2/crypt_dir/signature.py
│ │ -drwxr-xr-x   0 khanh      (501) staff       (20)        0 2023-04-06 16:39:57.230418 crypt-dir-1.1.2/crypt_dir.egg-info/
│ │ --rw-r--r--   0 khanh      (501) staff       (20)     3764 2023-04-06 16:39:57.000000 crypt-dir-1.1.2/crypt_dir.egg-info/PKG-INFO
│ │ --rw-r--r--   0 khanh      (501) staff       (20)      324 2023-04-06 16:39:57.000000 crypt-dir-1.1.2/crypt_dir.egg-info/SOURCES.txt
│ │ --rw-r--r--   0 khanh      (501) staff       (20)        1 2023-04-06 16:39:57.000000 crypt-dir-1.1.2/crypt_dir.egg-info/dependency_links.txt
│ │ --rw-r--r--   0 khanh      (501) staff       (20)       20 2023-04-06 16:39:57.000000 crypt-dir-1.1.2/crypt_dir.egg-info/requires.txt
│ │ --rw-r--r--   0 khanh      (501) staff       (20)       10 2023-04-06 16:39:57.000000 crypt-dir-1.1.2/crypt_dir.egg-info/top_level.txt
│ │ --rw-r--r--   0 khanh      (501) staff       (20)       38 2023-04-06 16:39:57.230866 crypt-dir-1.1.2/setup.cfg
│ │ --rw-r--r--   0 khanh      (501) staff       (20)      586 2023-04-06 16:39:54.000000 crypt-dir-1.1.2/setup.py
│ │ +drwxr-xr-x   0 khanh      (501) staff       (20)        0 2023-04-06 16:42:15.885440 crypt-dir-1.1.3/
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)     1069 2023-03-31 12:34:48.000000 crypt-dir-1.1.3/LICENSE
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)     3764 2023-04-06 16:42:15.885287 crypt-dir-1.1.3/PKG-INFO
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)     3506 2023-04-06 16:16:43.000000 crypt-dir-1.1.3/README.md
│ │ +drwxr-xr-x   0 khanh      (501) staff       (20)        0 2023-04-06 16:42:15.883893 crypt-dir-1.1.3/crypt_dir/
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)      150 2023-04-06 16:16:18.000000 crypt-dir-1.1.3/crypt_dir/__init__.py
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)     2511 2023-04-06 16:19:50.000000 crypt-dir-1.1.3/crypt_dir/crypt.py
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)     6083 2023-04-06 15:55:36.000000 crypt-dir-1.1.3/crypt_dir/crypt_dir.py
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)     4205 2023-04-06 16:42:04.000000 crypt-dir-1.1.3/crypt_dir/crypt_file.py
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)      257 2023-04-06 15:59:40.000000 crypt-dir-1.1.3/crypt_dir/serialize.py
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)      805 2023-04-06 16:03:15.000000 crypt-dir-1.1.3/crypt_dir/signature.py
│ │ +drwxr-xr-x   0 khanh      (501) staff       (20)        0 2023-04-06 16:42:15.885054 crypt-dir-1.1.3/crypt_dir.egg-info/
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)     3764 2023-04-06 16:42:15.000000 crypt-dir-1.1.3/crypt_dir.egg-info/PKG-INFO
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)      324 2023-04-06 16:42:15.000000 crypt-dir-1.1.3/crypt_dir.egg-info/SOURCES.txt
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)        1 2023-04-06 16:42:15.000000 crypt-dir-1.1.3/crypt_dir.egg-info/dependency_links.txt
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)       20 2023-04-06 16:42:15.000000 crypt-dir-1.1.3/crypt_dir.egg-info/requires.txt
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)       10 2023-04-06 16:42:15.000000 crypt-dir-1.1.3/crypt_dir.egg-info/top_level.txt
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)       38 2023-04-06 16:42:15.885494 crypt-dir-1.1.3/setup.cfg
│ │ +-rw-r--r--   0 khanh      (501) staff       (20)      586 2023-04-06 16:42:11.000000 crypt-dir-1.1.3/setup.py
│ │   --- crypt-dir-1.1.2/LICENSE
│ ├── +++ crypt-dir-1.1.3/LICENSE
│ │┄ Files identical despite different names
│ │   --- crypt-dir-1.1.2/PKG-INFO
│ ├── +++ crypt-dir-1.1.3/PKG-INFO
│ │┄ Files 1% similar despite different names
│ │ @@ -1,10 +1,10 @@
│ │  Metadata-Version: 2.1
│ │  Name: crypt-dir
│ │ -Version: 1.1.2
│ │ +Version: 1.1.3
│ │  Home-page: https://github.com/khanh-nguyen-code/crypt-dir
│ │  Author: Nguyen Ngoc Khanh
│ │  Author-email: khanh.nguyen.contact@gmail.com
│ │  License: MIT
│ │  Description-Content-Type: text/markdown
│ │  License-File: LICENSE
│ │   --- crypt-dir-1.1.2/README.md
│ ├── +++ crypt-dir-1.1.3/README.md
│ │┄ Files identical despite different names
│ │   --- crypt-dir-1.1.2/crypt_dir/crypt.py
│ ├── +++ crypt-dir-1.1.3/crypt_dir/crypt.py
│ │┄ Files identical despite different names
│ │   --- crypt-dir-1.1.2/crypt_dir/crypt_dir.py
│ ├── +++ crypt-dir-1.1.3/crypt_dir/crypt_dir.py
│ │┄ Files identical despite different names
│ │   --- crypt-dir-1.1.2/crypt_dir/crypt_file.py
│ ├── +++ crypt-dir-1.1.3/crypt_dir/crypt_file.py
│ │┄ Files 7% similar despite different names
│ │ @@ -1,12 +1,13 @@
│ │  #!/usr/bin/env python
│ │  from __future__ import annotations
│ │  
│ │  import io
│ │  import os
│ │ +import sys
│ │  from dataclasses import dataclass
│ │  from typing import BinaryIO
│ │  
│ │  from .crypt import aes256_encrypt, aes256_decrypt, sha1_hash, BLOCK_SIZE, KEY_SIZE
│ │  from .serialize import uint64_to_bytes, bytes_to_uint64, UINT64_SIZE
│ │  from .signature import get_file_sig, FILE_SIG_SIZE, get_key_sig, KEY_SIG_SIZE, set_file_signature
│ │  
│ │ @@ -44,19 +45,22 @@
│ │          key_sig: bytes | None = None,
│ │  ) -> bool:
│ │      if key_sig is None:
│ │          key_sig = get_key_sig(key)
│ │      file_sig = get_file_sig(plain_path)
│ │      # check file updated
│ │      if os.path.exists(encrypted_path):
│ │ -        with open(encrypted_path, "rb") as f:
│ │ -            header = read_header(f)
│ │ -        if key_sig == header.key_sig and file_sig == header.file_sig:
│ │ -            # only skip if both key_sig and file_sig are the same
│ │ -            return False
│ │ +        try:
│ │ +            with open(encrypted_path, "rb") as f:
│ │ +                header = read_header(f)
│ │ +            if key_sig == header.key_sig and file_sig == header.file_sig:
│ │ +                # only skip if both key_sig and file_sig are the same
│ │ +                return False
│ │ +        except Exception as e:
│ │ +            print(f"warning: encrypted file corrupted {encrypted_path}", file=sys.stderr)
│ │  
│ │      # encrypted file will be updated regardless its mtime is sooner or later
│ │      # encrypt
│ │      init_vec = os.urandom(BLOCK_SIZE)
│ │      file_size = os.path.getsize(plain_path)
│ │      with open(plain_path, "rb") as plain_f, open(encrypted_path, "wb") as encrypted_f:
│ │          write_header(write_io=encrypted_f, header=Header(
│ │   --- crypt-dir-1.1.2/crypt_dir/signature.py
│ ├── +++ crypt-dir-1.1.3/crypt_dir/signature.py
│ │┄ Files identical despite different names
│ │   --- crypt-dir-1.1.2/crypt_dir.egg-info/PKG-INFO
│ ├── +++ crypt-dir-1.1.3/crypt_dir.egg-info/PKG-INFO
│ │┄ Files 1% similar despite different names
│ │ @@ -1,10 +1,10 @@
│ │  Metadata-Version: 2.1
│ │  Name: crypt-dir
│ │ -Version: 1.1.2
│ │ +Version: 1.1.3
│ │  Home-page: https://github.com/khanh-nguyen-code/crypt-dir
│ │  Author: Nguyen Ngoc Khanh
│ │  Author-email: khanh.nguyen.contact@gmail.com
│ │  License: MIT
│ │  Description-Content-Type: text/markdown
│ │  License-File: LICENSE
│ │   --- crypt-dir-1.1.2/setup.py
│ ├── +++ crypt-dir-1.1.3/setup.py
│ │┄ Files 1% similar despite different names
│ │ @@ -1,15 +1,15 @@
│ │  import setuptools
│ │  
│ │  if __name__ == "__main__":
│ │      with open("README.md") as f:
│ │          long_description = f.read()
│ │      setuptools.setup(
│ │          name="crypt-dir",
│ │ -        version="1.1.2",
│ │ +        version="1.1.3",
│ │          author="Nguyen Ngoc Khanh",
│ │          author_email="khanh.nguyen.contact@gmail.com",
│ │          long_description=long_description,
│ │          long_description_content_type="text/markdown",
│ │          url="https://github.com/khanh-nguyen-code/crypt-dir",
│ │          packages=setuptools.find_packages(),
│ │          license="MIT",
