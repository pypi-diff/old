--- tmp/gcloud_rest_datastore-7.3.1.tar.gz
+++ tmp/gcloud_rest_datastore-7.4.0.tar.gz
├── filetype from file(1)
│ @@ -1 +1 @@
│ -gzip compressed data, was "gcloud_rest_datastore-7.3.1.tar", max compression
│ +gzip compressed data, was "gcloud_rest_datastore-7.4.0.tar", max compression
│   --- gcloud_rest_datastore-7.3.1.tar
├── +++ gcloud_rest_datastore-7.4.0.tar
│ ├── file list
│ │ @@ -1,23 +1,24 @@
│ │ --rw-r--r--   0        0        0     1063 2023-04-05 17:01:35.000000 gcloud_rest_datastore-7.3.1/LICENSE
│ │ --rw-r--r--   0        0        0     1321 2023-04-05 17:01:35.000000 gcloud_rest_datastore-7.3.1/README.rst
│ │ --rw-r--r--   0        0        0      212 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/__init__.py
│ │ --rw-r--r--   0        0        0        0 2023-04-05 17:01:35.000000 gcloud_rest_datastore-7.3.1/gcloud/py.typed
│ │ --rw-r--r--   0        0        0      216 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/__init__.py
│ │ --rw-r--r--   0        0        0     8068 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/__init__.py
│ │ --rw-r--r--   0        0        0     1064 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/array.py
│ │ --rw-r--r--   0        0        0     2006 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/constants.py
│ │ --rw-r--r--   0        0        0    15428 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/datastore.py
│ │ --rw-r--r--   0        0        0     1020 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/datastore_operation.py
│ │ --rw-r--r--   0        0        0     2618 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/entity.py
│ │ --rw-r--r--   0        0        0     3631 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/filter.py
│ │ --rw-r--r--   0        0        0     2411 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/key.py
│ │ --rw-r--r--   0        0        0      843 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/lat_lng.py
│ │ --rw-r--r--   0        0        0     1553 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/mutation.py
│ │ --rw-r--r--   0        0        0      700 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/projection.py
│ │ --rw-r--r--   0        0        0     1079 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/property_order.py
│ │ --rw-r--r--   0        0        0        0 2023-04-05 17:01:35.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/py.typed
│ │ --rw-r--r--   0        0        0     9456 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/query.py
│ │ --rw-r--r--   0        0        0     4094 2023-04-05 17:01:36.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/value.py
│ │ --rw-r--r--   0        0        0        0 2023-04-05 17:01:35.000000 gcloud_rest_datastore-7.3.1/gcloud/rest/py.typed
│ │ --rw-r--r--   0        0        0     1356 2023-04-05 17:01:35.000000 gcloud_rest_datastore-7.3.1/pyproject.toml
│ │ --rw-r--r--   0        0        0     2309 1970-01-01 00:00:00.000000 gcloud_rest_datastore-7.3.1/PKG-INFO
│ │ +-rw-r--r--   0        0        0     1063 2023-04-07 14:16:11.000000 gcloud_rest_datastore-7.4.0/LICENSE
│ │ +-rw-r--r--   0        0        0     1321 2023-04-07 14:16:11.000000 gcloud_rest_datastore-7.4.0/README.rst
│ │ +-rw-r--r--   0        0        0      212 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/__init__.py
│ │ +-rw-r--r--   0        0        0        0 2023-04-07 14:16:11.000000 gcloud_rest_datastore-7.4.0/gcloud/py.typed
│ │ +-rw-r--r--   0        0        0      216 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/__init__.py
│ │ +-rw-r--r--   0        0        0     8327 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/__init__.py
│ │ +-rw-r--r--   0        0        0     1064 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/array.py
│ │ +-rw-r--r--   0        0        0     2006 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/constants.py
│ │ +-rw-r--r--   0        0        0    16482 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/datastore.py
│ │ +-rw-r--r--   0        0        0     1020 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/datastore_operation.py
│ │ +-rw-r--r--   0        0        0     2618 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/entity.py
│ │ +-rw-r--r--   0        0        0     3631 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/filter.py
│ │ +-rw-r--r--   0        0        0     2411 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/key.py
│ │ +-rw-r--r--   0        0        0      843 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/lat_lng.py
│ │ +-rw-r--r--   0        0        0     1553 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/mutation.py
│ │ +-rw-r--r--   0        0        0      700 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/projection.py
│ │ +-rw-r--r--   0        0        0     1079 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/property_order.py
│ │ +-rw-r--r--   0        0        0        0 2023-04-07 14:16:11.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/py.typed
│ │ +-rw-r--r--   0        0        0     9456 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/query.py
│ │ +-rw-r--r--   0        0        0     1001 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/transaction_options.py
│ │ +-rw-r--r--   0        0        0     4094 2023-04-07 14:16:12.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/value.py
│ │ +-rw-r--r--   0        0        0        0 2023-04-07 14:16:11.000000 gcloud_rest_datastore-7.4.0/gcloud/rest/py.typed
│ │ +-rw-r--r--   0        0        0     1356 2023-04-07 14:16:11.000000 gcloud_rest_datastore-7.4.0/pyproject.toml
│ │ +-rw-r--r--   0        0        0     2309 1970-01-01 00:00:00.000000 gcloud_rest_datastore-7.4.0/PKG-INFO
│ │   --- gcloud_rest_datastore-7.3.1/LICENSE
│ ├── +++ gcloud_rest_datastore-7.4.0/LICENSE
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/README.rst
│ ├── +++ gcloud_rest_datastore-7.4.0/README.rst
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/__init__.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/__init__.py
│ │┄ Files 2% similar despite different names
│ │ @@ -196,14 +196,17 @@
│ │  from gcloud.rest.datastore.filter import PropertyFilter
│ │  from gcloud.rest.datastore.key import Key
│ │  from gcloud.rest.datastore.key import PathElement
│ │  from gcloud.rest.datastore.lat_lng import LatLng
│ │  from gcloud.rest.datastore.mutation import MutationResult
│ │  from gcloud.rest.datastore.projection import Projection
│ │  from gcloud.rest.datastore.property_order import PropertyOrder
│ │ +from gcloud.rest.datastore.transaction_options import ReadOnly
│ │ +from gcloud.rest.datastore.transaction_options import ReadWrite
│ │ +from gcloud.rest.datastore.transaction_options import TransactionOptions
│ │  from gcloud.rest.datastore.query import GQLCursor
│ │  from gcloud.rest.datastore.query import GQLQuery
│ │  from gcloud.rest.datastore.query import Query
│ │  from gcloud.rest.datastore.query import QueryResultBatch
│ │  from gcloud.rest.datastore.value import Value
│ │  
│ │  
│ │ @@ -228,12 +231,15 @@
│ │      'PathElement',
│ │      'Projection',
│ │      'PropertyFilter',
│ │      'PropertyFilterOperator',
│ │      'PropertyOrder',
│ │      'Query',
│ │      'QueryResultBatch',
│ │ +    'ReadOnly',
│ │ +    'ReadWrite',
│ │      'ResultType',
│ │      'SCOPES',
│ │ +    'TransactionOptions',
│ │      'Value',
│ │      '__version__',
│ │  ]
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/array.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/array.py
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/constants.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/constants.py
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/datastore.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/datastore.py
│ │┄ Files 8% similar despite different names
│ │ @@ -18,14 +18,15 @@
│ │  from gcloud.rest.datastore.constants import Operation
│ │  from gcloud.rest.datastore.datastore_operation import DatastoreOperation
│ │  from gcloud.rest.datastore.entity import EntityResult
│ │  from gcloud.rest.datastore.key import Key
│ │  from gcloud.rest.datastore.mutation import MutationResult
│ │  from gcloud.rest.datastore.query import BaseQuery
│ │  from gcloud.rest.datastore.query import QueryResultBatch
│ │ +from gcloud.rest.datastore.transaction_options import TransactionOptions
│ │  from gcloud.rest.datastore.value import Value
│ │  
│ │  # Selectively load libraries based on the package
│ │  if BUILD_GCLOUD_REST:
│ │      from requests import Session
│ │  else:
│ │      from aiohttp import ClientSession as Session  # type: ignore[assignment]
│ │ @@ -35,14 +36,16 @@
│ │  SCOPES = [
│ │      'https://www.googleapis.com/auth/cloud-platform',
│ │      'https://www.googleapis.com/auth/datastore',
│ │  ]
│ │  
│ │  log = logging.getLogger(__name__)
│ │  
│ │ +LookUpResult = Dict[str, Union[str, List[Union[EntityResult, Key]]]]
│ │ +
│ │  
│ │  def init_api_root(api_root: Optional[str]) -> Tuple[bool, str]:
│ │      if api_root:
│ │          return True, api_root
│ │  
│ │      host = os.environ.get('DATASTORE_EMULATOR_HOST')
│ │      if host:
│ │ @@ -288,58 +291,81 @@
│ │          resp = s.get(url, headers=headers, timeout=timeout)
│ │          data: Dict[str, Any] = resp.json()
│ │  
│ │          return self.datastore_operation_kind.from_repr(data)
│ │  
│ │      # https://cloud.google.com/datastore/docs/reference/data/rest/v1/projects/lookup
│ │      def lookup(
│ │ -            self, keys: List[Key], transaction: Optional[str] = None,
│ │ +            self, keys: List[Key],
│ │ +            transaction: Optional[str] = None,
│ │ +            newTransaction: Optional[TransactionOptions] = None,
│ │              consistency: Consistency = Consistency.STRONG,
│ │              session: Optional[Session] = None, timeout: int = 10,
│ │ -    ) -> Dict[str, List[Union[EntityResult, Key]]]:
│ │ +    ) -> LookUpResult:
│ │          project = self.project()
│ │          url = f'{self._api_root}/projects/{project}:lookup'
│ │  
│ │ -        if transaction:
│ │ -            options = {'transaction': transaction}
│ │ -        else:
│ │ -            options = {'readConsistency': consistency.value}
│ │ +        read_options = self._build_read_options(
│ │ +            consistency, newTransaction, transaction)
│ │ +
│ │          payload = json.dumps({
│ │              'keys': [k.to_repr() for k in keys],
│ │ -            'readOptions': options,
│ │ +            'readOptions': read_options,
│ │          }).encode('utf-8')
│ │  
│ │          headers = self.headers()
│ │          headers.update({
│ │              'Content-Length': str(len(payload)),
│ │              'Content-Type': 'application/json',
│ │          })
│ │  
│ │          s = SyncSession(session) if session else self.session
│ │          resp = s.post(
│ │              url, data=payload, headers=headers,
│ │              timeout=timeout,
│ │          )
│ │  
│ │ -        data: Dict[str, List[Any]] = resp.json()
│ │ +        data: Dict[str, Any] = resp.json()
│ │  
│ │ -        return {
│ │ +        return self._build_lookup_result(data)
│ │ +
│ │ +    def _build_lookup_result(self, data: Dict[str, Any]) -> LookUpResult:
│ │ +        result: LookUpResult = {
│ │              'found': [
│ │                  self.entity_result_kind.from_repr(e)
│ │                  for e in data.get('found', [])
│ │              ],
│ │              'missing': [
│ │                  self.entity_result_kind.from_repr(e)
│ │                  for e in data.get('missing', [])
│ │              ],
│ │              'deferred': [
│ │                  self.key_kind.from_repr(k)
│ │                  for k in data.get('deferred', [])
│ │              ],
│ │          }
│ │ +        if 'transaction' in data:
│ │ +            new_transaction: str = data['transaction']
│ │ +            result['transaction'] = new_transaction
│ │ +        return result
│ │ +
│ │ +    def _build_read_options(self,
│ │ +                            consistency: Consistency,
│ │ +                            newTransaction: Optional[TransactionOptions],
│ │ +                            transaction: Optional[str]) -> Dict[str, Any]:
│ │ +        # TODO: expose ReadOptions directly to users
│ │ +        # See
│ │ +        # https://cloud.google.com/datastore/docs/reference/data/rest/v1/ReadOptions
│ │ +        if transaction:
│ │ +            return {'transaction': transaction}
│ │ +
│ │ +        if newTransaction:
│ │ +            return {'newTransaction': newTransaction.to_repr()}
│ │ +
│ │ +        return {'readConsistency': consistency.value}
│ │  
│ │      # https://cloud.google.com/datastore/docs/reference/data/rest/v1/projects/reserveIds
│ │      def reserveIds(
│ │          self, keys: List[Key], database_id: str = '',
│ │          session: Optional[Session] = None,
│ │          timeout: int = 10,
│ │      ) -> None:
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/datastore_operation.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/datastore_operation.py
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/entity.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/entity.py
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/filter.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/filter.py
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/key.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/key.py
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/lat_lng.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/lat_lng.py
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/mutation.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/mutation.py
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/projection.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/projection.py
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/property_order.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/property_order.py
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/query.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/query.py
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/gcloud/rest/datastore/value.py
│ ├── +++ gcloud_rest_datastore-7.4.0/gcloud/rest/datastore/value.py
│ │┄ Files identical despite different names
│ │   --- gcloud_rest_datastore-7.3.1/pyproject.toml
│ ├── +++ gcloud_rest_datastore-7.4.0/pyproject.toml
│ │┄ Files 8% similar despite different names
│ │ @@ -1,10 +1,10 @@
│ │  [tool.poetry]
│ │  name = "gcloud-rest-datastore"
│ │ -version = "7.3.1"
│ │ +version = "7.4.0"
│ │  description = "Python Client for Google Cloud Datastore"
│ │  readme = "README.rst"
│ │  
│ │  repository = "https://github.com/talkiq/gcloud-aio"
│ │  authors = ["Vi Engineering <voiceai-eng@dialpad.com>"]
│ │  license = "MIT"
│ │   --- gcloud_rest_datastore-7.3.1/PKG-INFO
│ ├── +++ gcloud_rest_datastore-7.4.0/PKG-INFO
│ │┄ Files 1% similar despite different names
│ │ @@ -1,10 +1,10 @@
│ │  Metadata-Version: 2.1
│ │  Name: gcloud-rest-datastore
│ │ -Version: 7.3.1
│ │ +Version: 7.4.0
│ │  Summary: Python Client for Google Cloud Datastore
│ │  Home-page: https://github.com/talkiq/gcloud-aio
│ │  License: MIT
│ │  Author: Vi Engineering
│ │  Author-email: voiceai-eng@dialpad.com
│ │  Requires-Python: >=3.7,<4.0
│ │  Classifier: Development Status :: 5 - Production/Stable
