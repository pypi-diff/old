# Comparing `tmp/tiledb-0.9.4.tar.gz` & `tmp/tiledb-0.9.5.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "tiledb-0.9.4.tar", last modified: Fri Jul 23 17:48:01 2021, max compression
+gzip compressed data, was "tiledb-0.9.5.tar", last modified: Mon Aug 16 14:14:26 2021, max compression
```

## Comparing `tiledb-0.9.4.tar` & `tiledb-0.9.5.tar`

### file list

```diff
@@ -1,121 +1,121 @@
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.488981 tiledb-0.9.4/
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.448087 tiledb-0.9.4/.github/
--rw-r--r--   0 runner     (501) staff       (20)      228 2021-07-23 17:47:39.000000 tiledb-0.9.4/.github/ISSUE_TEMPLATE.md
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.448463 tiledb-0.9.4/.github/disabled-workflows/
--rw-r--r--   0 runner     (501) staff       (20)      628 2021-07-23 17:47:39.000000 tiledb-0.9.4/.github/disabled-workflows/release.yml
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.449684 tiledb-0.9.4/.github/workflows/
--rw-r--r--   0 runner     (501) staff       (20)     2321 2021-07-23 17:47:39.000000 tiledb-0.9.4/.github/workflows/ci.yml
--rw-r--r--   0 runner     (501) staff       (20)     1110 2021-07-23 17:47:39.000000 tiledb-0.9.4/.github/workflows/daily-test-build.yml
--rw-r--r--   0 runner     (501) staff       (20)      556 2021-07-23 17:47:39.000000 tiledb-0.9.4/.github/workflows/format.yml
--rw-r--r--   0 runner     (501) staff       (20)     1540 2021-07-23 17:47:39.000000 tiledb-0.9.4/CONTRIBUTING.md
--rw-r--r--   0 runner     (501) staff       (20)    29977 2021-07-23 17:47:39.000000 tiledb-0.9.4/HISTORY.md
--rw-r--r--   0 runner     (501) staff       (20)     1073 2021-07-23 17:47:39.000000 tiledb-0.9.4/LICENSE
--rw-r--r--   0 runner     (501) staff       (20)     3030 2021-07-23 17:48:01.489199 tiledb-0.9.4/PKG-INFO
--rw-r--r--   0 runner     (501) staff       (20)     1778 2021-07-23 17:47:39.000000 tiledb-0.9.4/README.md
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.459023 tiledb-0.9.4/examples/
--rw-r--r--   0 runner     (501) staff       (20)     2729 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/config.py
--rw-r--r--   0 runner     (501) staff       (20)     1698 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/errors.py
--rw-r--r--   0 runner     (501) staff       (20)     3567 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/fragment_info.py
--rw-r--r--   0 runner     (501) staff       (20)     3878 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/fragments_consolidation.py
--rw-r--r--   0 runner     (501) staff       (20)     3341 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/incomplete_iteration.py
--rw-r--r--   0 runner     (501) staff       (20)     5272 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/multi_attribute.py
--rw-r--r--   0 runner     (501) staff       (20)     2896 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/multirange_indexing.py
--rw-r--r--   0 runner     (501) staff       (20)     3702 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/object.py
--rw-r--r--   0 runner     (501) staff       (20)    10329 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/parallel_csv_ingestion.py
--rw-r--r--   0 runner     (501) staff       (20)     2772 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/quickstart_dense.py
--rw-r--r--   0 runner     (501) staff       (20)     2985 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/quickstart_sparse.py
--rw-r--r--   0 runner     (501) staff       (20)     4285 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/reading_dense_layouts.py
--rw-r--r--   0 runner     (501) staff       (20)     3522 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/reading_sparse_layouts.py
--rw-r--r--   0 runner     (501) staff       (20)     2793 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/string_float_int_dimensions.py
--rw-r--r--   0 runner     (501) staff       (20)     2483 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/time_traveling.py
--rw-r--r--   0 runner     (501) staff       (20)     2665 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/using_tiledb_stats.py
--rw-r--r--   0 runner     (501) staff       (20)     3640 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/variable_length.py
--rw-r--r--   0 runner     (501) staff       (20)     3335 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/vfs.py
--rw-r--r--   0 runner     (501) staff       (20)     2800 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/writing_dense_multiple.py
--rw-r--r--   0 runner     (501) staff       (20)     2711 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/writing_dense_padding.py
--rw-r--r--   0 runner     (501) staff       (20)     2617 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/writing_dense_rgb.py
--rw-r--r--   0 runner     (501) staff       (20)     2959 2021-07-23 17:47:39.000000 tiledb-0.9.4/examples/writing_sparse_multiple.py
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.460239 tiledb-0.9.4/external/
--rw-r--r--   0 runner     (501) staff       (20)     1338 2021-07-23 17:47:39.000000 tiledb-0.9.4/external/LICENSE-string_view.txt
--rw-r--r--   0 runner     (501) staff       (20)     1173 2021-07-23 17:47:39.000000 tiledb-0.9.4/external/LICENSE-tsl_robin_map.txt
--rw-r--r--   0 runner     (501) staff       (20)    45757 2021-07-23 17:47:39.000000 tiledb-0.9.4/external/string_view.hpp
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.462250 tiledb-0.9.4/external/tsl/
--rw-r--r--   0 runner     (501) staff       (20)    11764 2021-07-23 17:47:39.000000 tiledb-0.9.4/external/tsl/robin_growth_policy.h
--rw-r--r--   0 runner     (501) staff       (20)    52827 2021-07-23 17:47:39.000000 tiledb-0.9.4/external/tsl/robin_hash.h
--rw-r--r--   0 runner     (501) staff       (20)    27360 2021-07-23 17:47:39.000000 tiledb-0.9.4/external/tsl/robin_map.h
--rw-r--r--   0 runner     (501) staff       (20)    22381 2021-07-23 17:47:39.000000 tiledb-0.9.4/external/tsl/robin_set.h
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.443047 tiledb-0.9.4/misc/
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.463197 tiledb-0.9.4/misc/pypi_linux/
--rw-r--r--   0 runner     (501) staff       (20)     2413 2021-07-23 17:47:39.000000 tiledb-0.9.4/misc/pypi_linux/Dockerfile2010
--rw-r--r--   0 runner     (501) staff       (20)     2622 2021-07-23 17:47:39.000000 tiledb-0.9.4/misc/pypi_linux/build.sh
--rw-r--r--   0 runner     (501) staff       (20)      298 2021-07-23 17:47:39.000000 tiledb-0.9.4/pyproject.toml
--rw-r--r--   0 runner     (501) staff       (20)       82 2021-07-23 17:47:39.000000 tiledb-0.9.4/requirements.txt
--rw-r--r--   0 runner     (501) staff       (20)      255 2021-07-23 17:47:39.000000 tiledb-0.9.4/requirements_dev.txt
--rw-r--r--   0 runner     (501) staff       (20)      100 2021-07-23 17:48:01.489883 tiledb-0.9.4/setup.cfg
--rw-r--r--   0 runner     (501) staff       (20)    25688 2021-07-23 17:47:39.000000 tiledb-0.9.4/setup.py
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.473959 tiledb-0.9.4/tiledb/
--rw-r--r--   0 runner     (501) staff       (20)     2858 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/__init__.py
--rw-r--r--   0 runner     (501) staff       (20)     1990 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/array.py
--rw-r--r--   0 runner     (501) staff       (20)     2026 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/common.pxi
--rw-r--r--   0 runner     (501) staff       (20)    47334 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/core.cc
--rw-r--r--   0 runner     (501) staff       (20)     1697 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/ctx.py
--rw-r--r--   0 runner     (501) staff       (20)    27122 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/dataframe_.py
--rw-r--r--   0 runner     (501) staff       (20)     2097 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/debug.cc
--rw-r--r--   0 runner     (501) staff       (20)     9779 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/fragment.cc
--rw-r--r--   0 runner     (501) staff       (20)     4304 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/fragment.py
--rw-r--r--   0 runner     (501) staff       (20)     4590 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/highlevel.py
--rw-r--r--   0 runner     (501) staff       (20)      151 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/indexing.pxd
--rw-r--r--   0 runner     (501) staff       (20)    13181 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/indexing.pyx
--rw-r--r--   0 runner     (501) staff       (20)    15703 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/libmetadata.pyx
--rw-r--r--   0 runner     (501) staff       (20)    35563 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/libtiledb.pxd
--rw-r--r--   0 runner     (501) staff       (20)   246929 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/libtiledb.pyx
--rw-r--r--   0 runner     (501) staff       (20)    14104 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/multirange_indexing.py
--rw-r--r--   0 runner     (501) staff       (20)     8097 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/np2buf.pyx
--rw-r--r--   0 runner     (501) staff       (20)    16119 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/npbuffer.cc
--rw-r--r--   0 runner     (501) staff       (20)      330 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/npbuffer.h
--rw-r--r--   0 runner     (501) staff       (20)       99 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/numpyFlags.h
--rw-r--r--   0 runner     (501) staff       (20)      266 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/parquet_.py
--rw-r--r--   0 runner     (501) staff       (20)     6781 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/query_condition.cc
--rw-r--r--   0 runner     (501) staff       (20)     7308 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/query_condition.py
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.486120 tiledb-0.9.4/tiledb/tests/
--rw-r--r--   0 runner     (501) staff       (20)      208 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/__init__.py
--rw-r--r--   0 runner     (501) staff       (20)      470 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/all.py
--rw-r--r--   0 runner     (501) staff       (20)     1230 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/check_csv_dir.py
--rw-r--r--   0 runner     (501) staff       (20)     9867 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/common.py
--rw-r--r--   0 runner     (501) staff       (20)     1928 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/conftest.py
--rw-r--r--   0 runner     (501) staff       (20)     1529 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/datatypes.py
--rw-r--r--   0 runner     (501) staff       (20)     1018 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/fixtures.py
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.486497 tiledb-0.9.4/tiledb/tests/perf/
--rw-r--r--   0 runner     (501) staff       (20)     6830 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/perf/asv.conf.json
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.488588 tiledb-0.9.4/tiledb/tests/perf/benchmarks/
--rw-r--r--   0 runner     (501) staff       (20)        1 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/perf/benchmarks/__init__.py
--rw-r--r--   0 runner     (501) staff       (20)     1172 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/perf/benchmarks/array.py
--rw-r--r--   0 runner     (501) staff       (20)      217 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/perf/benchmarks/benchmarks.py
--rw-r--r--   0 runner     (501) staff       (20)     1235 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/perf/benchmarks/indexing.py
--rw-r--r--   0 runner     (501) staff       (20)      791 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/perf/benchmarks/metadata.py
--rw-r--r--   0 runner     (501) staff       (20)      746 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/strategies.py
--rw-r--r--   0 runner     (501) staff       (20)     9893 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_compat.py
--rw-r--r--   0 runner     (501) staff       (20)     6195 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_core.py
--rw-r--r--   0 runner     (501) staff       (20)     5212 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_dask.py
--rw-r--r--   0 runner     (501) staff       (20)     5675 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_domain_index.py
--rw-r--r--   0 runner     (501) staff       (20)     1732 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_examples.py
--rw-r--r--   0 runner     (501) staff       (20)     1900 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_fixes.py
--rw-r--r--   0 runner     (501) staff       (20)    18986 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_fragment_info.py
--rw-r--r--   0 runner     (501) staff       (20)     1253 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_hypothesis.py
--rw-r--r--   0 runner     (501) staff       (20)   149278 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_libtiledb.py
--rw-r--r--   0 runner     (501) staff       (20)    12402 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_metadata.py
--rw-r--r--   0 runner     (501) staff       (20)     5052 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_multi_index-hp.py
--rw-r--r--   0 runner     (501) staff       (20)    27773 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_multi_index.py
--rw-r--r--   0 runner     (501) staff       (20)    45227 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_pandas_dataframe.py
--rw-r--r--   0 runner     (501) staff       (20)     4905 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_query_condition.py
--rw-r--r--   0 runner     (501) staff       (20)     3441 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/tests/test_util.py
--rw-r--r--   0 runner     (501) staff       (20)     1050 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/util.h
--rw-r--r--   0 runner     (501) staff       (20)     1266 2021-07-23 17:47:39.000000 tiledb-0.9.4/tiledb/util.py
--rw-r--r--   0 runner     (501) staff       (20)      142 2021-07-23 17:48:01.000000 tiledb-0.9.4/tiledb/version.py
-drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-07-23 17:48:01.476421 tiledb-0.9.4/tiledb.egg-info/
--rw-r--r--   0 runner     (501) staff       (20)     3030 2021-07-23 17:48:01.000000 tiledb-0.9.4/tiledb.egg-info/PKG-INFO
--rw-r--r--   0 runner     (501) staff       (20)     2775 2021-07-23 17:48:01.000000 tiledb-0.9.4/tiledb.egg-info/SOURCES.txt
--rw-r--r--   0 runner     (501) staff       (20)        1 2021-07-23 17:48:01.000000 tiledb-0.9.4/tiledb.egg-info/dependency_links.txt
--rw-r--r--   0 runner     (501) staff       (20)        1 2021-07-23 17:48:01.000000 tiledb-0.9.4/tiledb.egg-info/not-zip-safe
--rw-r--r--   0 runner     (501) staff       (20)       65 2021-07-23 17:48:01.000000 tiledb-0.9.4/tiledb.egg-info/requires.txt
--rw-r--r--   0 runner     (501) staff       (20)        7 2021-07-23 17:48:01.000000 tiledb-0.9.4/tiledb.egg-info/top_level.txt
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.355471 tiledb-0.9.5/
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.314616 tiledb-0.9.5/.github/
+-rw-r--r--   0 runner     (501) staff       (20)      228 2021-08-16 14:13:55.000000 tiledb-0.9.5/.github/ISSUE_TEMPLATE.md
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.315056 tiledb-0.9.5/.github/disabled-workflows/
+-rw-r--r--   0 runner     (501) staff       (20)      628 2021-08-16 14:13:55.000000 tiledb-0.9.5/.github/disabled-workflows/release.yml
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.316225 tiledb-0.9.5/.github/workflows/
+-rw-r--r--   0 runner     (501) staff       (20)     2359 2021-08-16 14:13:55.000000 tiledb-0.9.5/.github/workflows/ci.yml
+-rw-r--r--   0 runner     (501) staff       (20)     1110 2021-08-16 14:13:55.000000 tiledb-0.9.5/.github/workflows/daily-test-build.yml
+-rw-r--r--   0 runner     (501) staff       (20)      556 2021-08-16 14:13:55.000000 tiledb-0.9.5/.github/workflows/format.yml
+-rw-r--r--   0 runner     (501) staff       (20)     1540 2021-08-16 14:13:55.000000 tiledb-0.9.5/CONTRIBUTING.md
+-rw-r--r--   0 runner     (501) staff       (20)    30562 2021-08-16 14:13:55.000000 tiledb-0.9.5/HISTORY.md
+-rw-r--r--   0 runner     (501) staff       (20)     1073 2021-08-16 14:13:55.000000 tiledb-0.9.5/LICENSE
+-rw-r--r--   0 runner     (501) staff       (20)     3030 2021-08-16 14:14:26.355660 tiledb-0.9.5/PKG-INFO
+-rw-r--r--   0 runner     (501) staff       (20)     1778 2021-08-16 14:13:55.000000 tiledb-0.9.5/README.md
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.324682 tiledb-0.9.5/examples/
+-rw-r--r--   0 runner     (501) staff       (20)     2729 2021-08-16 14:13:55.000000 tiledb-0.9.5/examples/config.py
+-rw-r--r--   0 runner     (501) staff       (20)     1698 2021-08-16 14:13:55.000000 tiledb-0.9.5/examples/errors.py
+-rw-r--r--   0 runner     (501) staff       (20)     3634 2021-08-16 14:13:55.000000 tiledb-0.9.5/examples/fragment_info.py
+-rw-r--r--   0 runner     (501) staff       (20)     3878 2021-08-16 14:13:55.000000 tiledb-0.9.5/examples/fragments_consolidation.py
+-rw-r--r--   0 runner     (501) staff       (20)     3341 2021-08-16 14:13:55.000000 tiledb-0.9.5/examples/incomplete_iteration.py
+-rw-r--r--   0 runner     (501) staff       (20)     5272 2021-08-16 14:13:55.000000 tiledb-0.9.5/examples/multi_attribute.py
+-rw-r--r--   0 runner     (501) staff       (20)     2896 2021-08-16 14:13:55.000000 tiledb-0.9.5/examples/multirange_indexing.py
+-rw-r--r--   0 runner     (501) staff       (20)     3702 2021-08-16 14:13:55.000000 tiledb-0.9.5/examples/object.py
+-rw-r--r--   0 runner     (501) staff       (20)    10329 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/parallel_csv_ingestion.py
+-rw-r--r--   0 runner     (501) staff       (20)     2772 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/quickstart_dense.py
+-rw-r--r--   0 runner     (501) staff       (20)     2985 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/quickstart_sparse.py
+-rw-r--r--   0 runner     (501) staff       (20)     4285 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/reading_dense_layouts.py
+-rw-r--r--   0 runner     (501) staff       (20)     3522 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/reading_sparse_layouts.py
+-rw-r--r--   0 runner     (501) staff       (20)     2793 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/string_float_int_dimensions.py
+-rw-r--r--   0 runner     (501) staff       (20)     2483 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/time_traveling.py
+-rw-r--r--   0 runner     (501) staff       (20)     2665 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/using_tiledb_stats.py
+-rw-r--r--   0 runner     (501) staff       (20)     3640 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/variable_length.py
+-rw-r--r--   0 runner     (501) staff       (20)     3335 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/vfs.py
+-rw-r--r--   0 runner     (501) staff       (20)     2800 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/writing_dense_multiple.py
+-rw-r--r--   0 runner     (501) staff       (20)     2711 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/writing_dense_padding.py
+-rw-r--r--   0 runner     (501) staff       (20)     2617 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/writing_dense_rgb.py
+-rw-r--r--   0 runner     (501) staff       (20)     2959 2021-08-16 14:13:56.000000 tiledb-0.9.5/examples/writing_sparse_multiple.py
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.325896 tiledb-0.9.5/external/
+-rw-r--r--   0 runner     (501) staff       (20)     1338 2021-08-16 14:13:56.000000 tiledb-0.9.5/external/LICENSE-string_view.txt
+-rw-r--r--   0 runner     (501) staff       (20)     1173 2021-08-16 14:13:56.000000 tiledb-0.9.5/external/LICENSE-tsl_robin_map.txt
+-rw-r--r--   0 runner     (501) staff       (20)    45757 2021-08-16 14:13:56.000000 tiledb-0.9.5/external/string_view.hpp
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.327720 tiledb-0.9.5/external/tsl/
+-rw-r--r--   0 runner     (501) staff       (20)    11764 2021-08-16 14:13:56.000000 tiledb-0.9.5/external/tsl/robin_growth_policy.h
+-rw-r--r--   0 runner     (501) staff       (20)    52827 2021-08-16 14:13:56.000000 tiledb-0.9.5/external/tsl/robin_hash.h
+-rw-r--r--   0 runner     (501) staff       (20)    27360 2021-08-16 14:13:56.000000 tiledb-0.9.5/external/tsl/robin_map.h
+-rw-r--r--   0 runner     (501) staff       (20)    22381 2021-08-16 14:13:56.000000 tiledb-0.9.5/external/tsl/robin_set.h
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.309640 tiledb-0.9.5/misc/
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.328529 tiledb-0.9.5/misc/pypi_linux/
+-rw-r--r--   0 runner     (501) staff       (20)     2413 2021-08-16 14:13:56.000000 tiledb-0.9.5/misc/pypi_linux/Dockerfile2010
+-rw-r--r--   0 runner     (501) staff       (20)     2622 2021-08-16 14:13:56.000000 tiledb-0.9.5/misc/pypi_linux/build.sh
+-rw-r--r--   0 runner     (501) staff       (20)      298 2021-08-16 14:13:56.000000 tiledb-0.9.5/pyproject.toml
+-rw-r--r--   0 runner     (501) staff       (20)       82 2021-08-16 14:13:56.000000 tiledb-0.9.5/requirements.txt
+-rw-r--r--   0 runner     (501) staff       (20)      255 2021-08-16 14:13:56.000000 tiledb-0.9.5/requirements_dev.txt
+-rw-r--r--   0 runner     (501) staff       (20)      100 2021-08-16 14:14:26.356416 tiledb-0.9.5/setup.cfg
+-rw-r--r--   0 runner     (501) staff       (20)    25786 2021-08-16 14:13:56.000000 tiledb-0.9.5/setup.py
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.340991 tiledb-0.9.5/tiledb/
+-rw-r--r--   0 runner     (501) staff       (20)     2858 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/__init__.py
+-rw-r--r--   0 runner     (501) staff       (20)     1990 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/array.py
+-rw-r--r--   0 runner     (501) staff       (20)     2026 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/common.pxi
+-rw-r--r--   0 runner     (501) staff       (20)    47336 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/core.cc
+-rw-r--r--   0 runner     (501) staff       (20)     1697 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/ctx.py
+-rw-r--r--   0 runner     (501) staff       (20)    27122 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/dataframe_.py
+-rw-r--r--   0 runner     (501) staff       (20)     2097 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/debug.cc
+-rw-r--r--   0 runner     (501) staff       (20)     9781 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/fragment.cc
+-rw-r--r--   0 runner     (501) staff       (20)     8659 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/fragment.py
+-rw-r--r--   0 runner     (501) staff       (20)     4590 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/highlevel.py
+-rw-r--r--   0 runner     (501) staff       (20)      151 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/indexing.pxd
+-rw-r--r--   0 runner     (501) staff       (20)    13181 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/indexing.pyx
+-rw-r--r--   0 runner     (501) staff       (20)    15703 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/libmetadata.pyx
+-rw-r--r--   0 runner     (501) staff       (20)    35563 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/libtiledb.pxd
+-rw-r--r--   0 runner     (501) staff       (20)   244959 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/libtiledb.pyx
+-rw-r--r--   0 runner     (501) staff       (20)    14104 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/multirange_indexing.py
+-rw-r--r--   0 runner     (501) staff       (20)     8097 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/np2buf.pyx
+-rw-r--r--   0 runner     (501) staff       (20)    16121 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/npbuffer.cc
+-rw-r--r--   0 runner     (501) staff       (20)      330 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/npbuffer.h
+-rw-r--r--   0 runner     (501) staff       (20)       99 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/numpyFlags.h
+-rw-r--r--   0 runner     (501) staff       (20)      266 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/parquet_.py
+-rw-r--r--   0 runner     (501) staff       (20)     6783 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/query_condition.cc
+-rw-r--r--   0 runner     (501) staff       (20)     8467 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/query_condition.py
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.352804 tiledb-0.9.5/tiledb/tests/
+-rw-r--r--   0 runner     (501) staff       (20)      208 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/__init__.py
+-rw-r--r--   0 runner     (501) staff       (20)      470 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/all.py
+-rw-r--r--   0 runner     (501) staff       (20)     1230 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/check_csv_dir.py
+-rw-r--r--   0 runner     (501) staff       (20)     9867 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/common.py
+-rw-r--r--   0 runner     (501) staff       (20)     1928 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/conftest.py
+-rw-r--r--   0 runner     (501) staff       (20)     1529 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/datatypes.py
+-rw-r--r--   0 runner     (501) staff       (20)     1018 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/fixtures.py
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.353170 tiledb-0.9.5/tiledb/tests/perf/
+-rw-r--r--   0 runner     (501) staff       (20)     6830 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/perf/asv.conf.json
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.355126 tiledb-0.9.5/tiledb/tests/perf/benchmarks/
+-rw-r--r--   0 runner     (501) staff       (20)        1 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/perf/benchmarks/__init__.py
+-rw-r--r--   0 runner     (501) staff       (20)     1172 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/perf/benchmarks/array.py
+-rw-r--r--   0 runner     (501) staff       (20)      217 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/perf/benchmarks/benchmarks.py
+-rw-r--r--   0 runner     (501) staff       (20)     1235 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/perf/benchmarks/indexing.py
+-rw-r--r--   0 runner     (501) staff       (20)      791 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/perf/benchmarks/metadata.py
+-rw-r--r--   0 runner     (501) staff       (20)      746 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/strategies.py
+-rw-r--r--   0 runner     (501) staff       (20)     9893 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_compat.py
+-rw-r--r--   0 runner     (501) staff       (20)     6195 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_core.py
+-rw-r--r--   0 runner     (501) staff       (20)     5212 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_dask.py
+-rw-r--r--   0 runner     (501) staff       (20)     5675 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_domain_index.py
+-rw-r--r--   0 runner     (501) staff       (20)     1828 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_examples.py
+-rw-r--r--   0 runner     (501) staff       (20)     1900 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_fixes.py
+-rw-r--r--   0 runner     (501) staff       (20)    18986 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_fragment_info.py
+-rw-r--r--   0 runner     (501) staff       (20)     1253 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_hypothesis.py
+-rw-r--r--   0 runner     (501) staff       (20)   150982 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_libtiledb.py
+-rw-r--r--   0 runner     (501) staff       (20)    12402 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_metadata.py
+-rw-r--r--   0 runner     (501) staff       (20)     5052 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_multi_index-hp.py
+-rw-r--r--   0 runner     (501) staff       (20)    27773 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_multi_index.py
+-rw-r--r--   0 runner     (501) staff       (20)    45227 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_pandas_dataframe.py
+-rw-r--r--   0 runner     (501) staff       (20)     8083 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_query_condition.py
+-rw-r--r--   0 runner     (501) staff       (20)     3441 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/tests/test_util.py
+-rw-r--r--   0 runner     (501) staff       (20)     1050 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/util.h
+-rw-r--r--   0 runner     (501) staff       (20)     1266 2021-08-16 14:13:56.000000 tiledb-0.9.5/tiledb/util.py
+-rw-r--r--   0 runner     (501) staff       (20)      142 2021-08-16 14:14:26.000000 tiledb-0.9.5/tiledb/version.py
+drwxr-xr-x   0 runner     (501) staff       (20)        0 2021-08-16 14:14:26.343343 tiledb-0.9.5/tiledb.egg-info/
+-rw-r--r--   0 runner     (501) staff       (20)     3030 2021-08-16 14:14:26.000000 tiledb-0.9.5/tiledb.egg-info/PKG-INFO
+-rw-r--r--   0 runner     (501) staff       (20)     2775 2021-08-16 14:14:26.000000 tiledb-0.9.5/tiledb.egg-info/SOURCES.txt
+-rw-r--r--   0 runner     (501) staff       (20)        1 2021-08-16 14:14:26.000000 tiledb-0.9.5/tiledb.egg-info/dependency_links.txt
+-rw-r--r--   0 runner     (501) staff       (20)        1 2021-08-16 14:14:26.000000 tiledb-0.9.5/tiledb.egg-info/not-zip-safe
+-rw-r--r--   0 runner     (501) staff       (20)       65 2021-08-16 14:14:26.000000 tiledb-0.9.5/tiledb.egg-info/requires.txt
+-rw-r--r--   0 runner     (501) staff       (20)        7 2021-08-16 14:14:26.000000 tiledb-0.9.5/tiledb.egg-info/top_level.txt
```

### Comparing `tiledb-0.9.4/.github/disabled-workflows/release.yml` & `tiledb-0.9.5/.github/disabled-workflows/release.yml`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/.github/workflows/ci.yml` & `tiledb-0.9.5/.github/workflows/ci.yml`

 * *Files 2% similar despite different names*

```diff
@@ -8,15 +8,17 @@
     runs-on: ${{ matrix.os }}
     strategy:
       matrix:
         os: [ubuntu-latest, macos-10.15, windows-latest]
         python-version: [3.7, 3.8, 3.9]
 
     steps:
-    - uses: actions/checkout@v2
+    - name: Checkout TileDB-Py `dev`
+      uses: actions/checkout@v2
+
     - name: Set up Python ${{ matrix.python-version }}
       uses: actions/setup-python@v2
       with:
         python-version: ${{ matrix.python-version }}
 
     # Print python and pip version information for debugging.
     - name: 'Print python version in bash task'
```

### Comparing `tiledb-0.9.4/.github/workflows/daily-test-build.yml` & `tiledb-0.9.5/.github/workflows/daily-test-build.yml`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/.github/workflows/format.yml` & `tiledb-0.9.5/.github/workflows/format.yml`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/CONTRIBUTING.md` & `tiledb-0.9.5/CONTRIBUTING.md`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/HISTORY.md` & `tiledb-0.9.5/HISTORY.md`

 * *Files 1% similar despite different names*

```diff
@@ -1,7 +1,17 @@
+# TileDB-Py 0.9.5 Release Notes
+
+## TileDB Embedded updates:
+* TileDB-Py 0.9.5 includes TileDB Embedded [TileDB 2.3.3](https://github.com/TileDB-Inc/TileDB/releases/tag/2.3.3)
+
+## Improvements
+* Consolidate `_nonempty_domain_var` into `nonempty_domain` [#632](https://github.com/TileDB-Inc/TileDB-Py/pull/632)
+* Support more valid Python syntax for `QueryCondition` statements [#636](https://github.com/TileDB-Inc/TileDB-Py/pull/636)
+* Addition of `ascii` dtype to `Attr` allows `QueryCondition` to support var-length strings [#637](https://github.com/TileDB-Inc/TileDB-Py/pull/637) 
+
 # TileDB-Py 0.9.4 Release Notes
 
 ## Improvements
 * Support pickling for arrays in write-mode [#626](https://github.com/TileDB-Inc/TileDB-Py/pull/626)
 
 ## Bug Fixes
 * Fixed multi-range indexer to default to explicitly pass in the non-empty domain if dimensions are unspecified [#630](https://github.com/TileDB-Inc/TileDB-Py/pull/630)
```

### Comparing `tiledb-0.9.4/LICENSE` & `tiledb-0.9.5/LICENSE`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/PKG-INFO` & `tiledb-0.9.5/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: tiledb
-Version: 0.9.4
+Version: 0.9.5
 Summary: Pythonic interface to the TileDB array storage manager
 Home-page: https://github.com/TileDB-Inc/TileDB-Py
 Author: TileDB, Inc.
 Author-email: help@tiledb.io
 Maintainer: TileDB, Inc.
 Maintainer-email: help@tiledb.io
 License: MIT
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
-Metadata-Version: 2.1 Name: tiledb Version: 0.9.4 Summary: Pythonic interface
+Metadata-Version: 2.1 Name: tiledb Version: 0.9.5 Summary: Pythonic interface
 to the TileDB array storage manager Home-page: https://github.com/TileDB-Inc/
 TileDB-Py Author: TileDB, Inc. Author-email: help@tiledb.io Maintainer: TileDB,
 Inc. Maintainer-email: help@tiledb.io License: MIT Platform: any Classifier:
 Development Status :: 4 - Beta Classifier: Intended Audience :: Developers
 Classifier: Intended Audience :: Information Technology Classifier: Intended
 Audience :: Science/Research Classifier: License :: OSI Approved :: MIT License
 Classifier: Programming Language :: Python Classifier: Topic :: Software
```

### Comparing `tiledb-0.9.4/README.md` & `tiledb-0.9.5/README.md`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/config.py` & `tiledb-0.9.5/examples/config.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/errors.py` & `tiledb-0.9.5/examples/errors.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/fragment_info.py` & `tiledb-0.9.5/examples/fragment_info.py`

 * *Files 2% similar despite different names*

```diff
@@ -72,14 +72,16 @@
 
 # tiledb.array_fragments() requires TileDB-Py version > 0.8.5
 fragments_info = tiledb.array_fragments(array_name)
 
 print("====== FRAGMENTS  INFO ======")
 print("array uri: {}".format(fragments_info.array_uri))
 print("number of fragments: {}".format(len(fragments_info)))
+print(fragments_info.nonempty_domain)
+print(fragments_info.sparse)
 
 for fragment_num, fragment in enumerate(fragments_info, start=1):
     print()
     print("===== FRAGMENT NUMBER {} =====".format(fragment.num))
     print("fragment uri: {}".format(fragment.uri))
     print("is dense: {}".format(fragment.dense))
     print("is sparse: {}".format(fragment.sparse))
```

### Comparing `tiledb-0.9.4/examples/fragments_consolidation.py` & `tiledb-0.9.5/examples/fragments_consolidation.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/incomplete_iteration.py` & `tiledb-0.9.5/examples/incomplete_iteration.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/multi_attribute.py` & `tiledb-0.9.5/examples/multi_attribute.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/multirange_indexing.py` & `tiledb-0.9.5/examples/multirange_indexing.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/object.py` & `tiledb-0.9.5/examples/object.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/parallel_csv_ingestion.py` & `tiledb-0.9.5/examples/parallel_csv_ingestion.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/quickstart_dense.py` & `tiledb-0.9.5/examples/quickstart_dense.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/quickstart_sparse.py` & `tiledb-0.9.5/examples/quickstart_sparse.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/reading_dense_layouts.py` & `tiledb-0.9.5/examples/reading_dense_layouts.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/reading_sparse_layouts.py` & `tiledb-0.9.5/examples/reading_sparse_layouts.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/string_float_int_dimensions.py` & `tiledb-0.9.5/examples/string_float_int_dimensions.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/time_traveling.py` & `tiledb-0.9.5/examples/time_traveling.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/using_tiledb_stats.py` & `tiledb-0.9.5/examples/using_tiledb_stats.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/variable_length.py` & `tiledb-0.9.5/examples/variable_length.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/vfs.py` & `tiledb-0.9.5/examples/vfs.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/writing_dense_multiple.py` & `tiledb-0.9.5/examples/writing_dense_multiple.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/writing_dense_padding.py` & `tiledb-0.9.5/examples/writing_dense_padding.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/writing_dense_rgb.py` & `tiledb-0.9.5/examples/writing_dense_rgb.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/examples/writing_sparse_multiple.py` & `tiledb-0.9.5/examples/writing_sparse_multiple.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/external/LICENSE-string_view.txt` & `tiledb-0.9.5/external/LICENSE-string_view.txt`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/external/LICENSE-tsl_robin_map.txt` & `tiledb-0.9.5/external/LICENSE-tsl_robin_map.txt`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/external/string_view.hpp` & `tiledb-0.9.5/external/string_view.hpp`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/external/tsl/robin_growth_policy.h` & `tiledb-0.9.5/external/tsl/robin_growth_policy.h`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/external/tsl/robin_hash.h` & `tiledb-0.9.5/external/tsl/robin_hash.h`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/external/tsl/robin_map.h` & `tiledb-0.9.5/external/tsl/robin_map.h`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/external/tsl/robin_set.h` & `tiledb-0.9.5/external/tsl/robin_set.h`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/misc/pypi_linux/Dockerfile2010` & `tiledb-0.9.5/misc/pypi_linux/Dockerfile2010`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/misc/pypi_linux/build.sh` & `tiledb-0.9.5/misc/pypi_linux/build.sh`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/setup.py` & `tiledb-0.9.5/setup.py`

 * *Files 2% similar despite different names*

```diff
@@ -14,15 +14,15 @@
 
 from pkg_resources import resource_filename
 from setuptools import Extension, find_packages, setup
 
 print("setup.py sys.argv is: ", sys.argv)
 
 # Target branch
-TILEDB_VERSION = "2.3.2"
+TILEDB_VERSION = "2.3.3"
 # allow overriding w/ environment variable
 TILEDB_VERSION = os.environ.get("TILEDB_VERSION") or TILEDB_VERSION
 
 # Use `setup.py [] --debug` for a debug build of libtiledb
 TILEDB_DEBUG_BUILD = False
 # Use `setup.py [] --release-symbols` for a release build with symbols libtiledb
 TILEDB_SYMBOLS_BUILD = False
@@ -135,28 +135,31 @@
 def download_libtiledb():
     """
     Downloads the native TileDB source.
     :return: Path to extracted source directory.
     """
     dest_name = "TileDB-{}".format(TILEDB_VERSION)
     dest = os.path.join(BUILD_DIR, dest_name)
-    if not os.path.exists(dest):
+    build_dir = os.path.join(BUILD_DIR, f"TileDB-{TILEDB_VERSION[:8]}")
+    if not os.path.exists(build_dir):
         url = "https://github.com/TileDB-Inc/TileDB/archive/{}.zip".format(
             TILEDB_VERSION
         )
         print("Downloading TileDB package from {}...".format(TILEDB_VERSION))
         try:
             with zipfile.ZipFile(io.BytesIO(urlopen(url).read())) as z:
                 z.extractall(BUILD_DIR)
         except URLError:
             # try falling back to wget, maybe SSL is broken
             subprocess.check_call(["wget", url], shell=True)
             with zipfile.ZipFile("{}.zip".format(TILEDB_VERSION)) as z:
                 z.extractall(BUILD_DIR)
-    return dest
+        shutil.move(dest, build_dir)
+
+    return build_dir
 
 
 def build_libtiledb(src_dir):
     """
     Builds and installs the native TileDB library.
     :param src_dir: Path to libtiledb source directory.
     :return: Path to the directory where the library was installed.
@@ -568,15 +571,15 @@
         TILEDBPY_WERROR = True
         sys.argv.remove(arg)
 
 # Global variables
 CXXFLAGS = os.environ.get("CXXFLAGS", "").split()
 if not is_windows():
     CXXFLAGS.append("-std=c++11")
-    if TILEDBPY_WERROR or TILEDB_DEBUG_BUILD:
+    if TILEDBPY_WERROR:
         CXXFLAGS.append("-Werror")
     if not TILEDB_DEBUG_BUILD:
         CXXFLAGS.append("-Wno-deprecated-declarations")
     elif TILEDB_DEBUG_BUILD:
         CXXFLAGS.append("-g")
         CXXFLAGS.append("-O0")
         CXXFLAGS.append("-UNDEBUG")  # defined by distutils
```

### Comparing `tiledb-0.9.4/tiledb/__init__.py` & `tiledb-0.9.5/tiledb/__init__.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/array.py` & `tiledb-0.9.5/tiledb/array.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/common.pxi` & `tiledb-0.9.5/tiledb/common.pxi`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/core.cc` & `tiledb-0.9.5/tiledb/core.cc`

 * *Files 0% similar despite different names*

```diff
@@ -21,15 +21,15 @@
 #include <tiledb/arrowio>
 #include <tiledb/tiledb> // C++
 
 #include "../external/string_view.hpp"
 #include "../external/tsl/robin_map.h"
 
 #if !defined(NDEBUG)
-#include "debug.cc"
+//#include "debug.cc"
 #endif
 
 #include "query_condition.cc"
 
 namespace tiledbpy {
 
 using namespace std;
```

### Comparing `tiledb-0.9.4/tiledb/ctx.py` & `tiledb-0.9.5/tiledb/ctx.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/dataframe_.py` & `tiledb-0.9.5/tiledb/dataframe_.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/debug.cc` & `tiledb-0.9.5/tiledb/debug.cc`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/fragment.cc` & `tiledb-0.9.5/tiledb/fragment.cc`

 * *Files 0% similar despite different names*

```diff
@@ -11,15 +11,15 @@
 
 #include "util.h"
 #include <tiledb/tiledb> // C++
 
 #if TILEDB_VERSION_MAJOR == 2 && TILEDB_VERSION_MINOR >= 2
 
 #if !defined(NDEBUG)
-#include "debug.cc"
+//#include "debug.cc"
 #endif
 
 namespace tiledbpy {
 
 using namespace std;
 using namespace tiledb;
 namespace py = pybind11;
```

### Comparing `tiledb-0.9.4/tiledb/highlevel.py` & `tiledb-0.9.5/tiledb/highlevel.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/indexing.pyx` & `tiledb-0.9.5/tiledb/indexing.pyx`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/libmetadata.pyx` & `tiledb-0.9.5/tiledb/libmetadata.pyx`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/libtiledb.pxd` & `tiledb-0.9.5/tiledb/libtiledb.pxd`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/libtiledb.pyx` & `tiledb-0.9.5/tiledb/libtiledb.pyx`

 * *Files 6% similar despite different names*

```diff
@@ -52,14 +52,81 @@
 # Integer types supported by Python / System
 _inttypes = (int, np.integer)
 
 # Numpy initialization code (critical)
 # https://docs.scipy.org/doc/numpy/reference/c-api.array.html#c.import_array
 np.import_array()
 
+# Conversion from TileDB dtype to Numpy datetime
+_tiledb_dtype_to_datetime_convert = {
+    TILEDB_DATETIME_YEAR: np.datetime64('', 'Y'),
+    TILEDB_DATETIME_MONTH: np.datetime64('', 'M'),
+    TILEDB_DATETIME_WEEK: np.datetime64('', 'W'),
+    TILEDB_DATETIME_DAY: np.datetime64('', 'D'),
+    TILEDB_DATETIME_HR: np.datetime64('', 'h'),
+    TILEDB_DATETIME_MIN: np.datetime64('', 'm'),
+    TILEDB_DATETIME_SEC: np.datetime64('', 's'),
+    TILEDB_DATETIME_MS: np.datetime64('', 'ms'),
+    TILEDB_DATETIME_US: np.datetime64('', 'us'),
+    TILEDB_DATETIME_NS: np.datetime64('', 'ns'),
+    TILEDB_DATETIME_PS: np.datetime64('', 'ps'),
+    TILEDB_DATETIME_FS: np.datetime64('', 'fs'),
+    TILEDB_DATETIME_AS: np.datetime64('', 'as')
+}
+
+# Conversion from Numpy datetime to TileDB dtype
+_datetime_tiledb_dtype_convert = {
+    'Y': TILEDB_DATETIME_YEAR,
+    'M': TILEDB_DATETIME_MONTH,
+    'W': TILEDB_DATETIME_WEEK,
+    'D': TILEDB_DATETIME_DAY,
+    'h': TILEDB_DATETIME_HR,
+    'm': TILEDB_DATETIME_MIN,
+    's': TILEDB_DATETIME_SEC,
+    'ms': TILEDB_DATETIME_MS,
+    'us': TILEDB_DATETIME_US,
+    'ns': TILEDB_DATETIME_NS,
+    'ps': TILEDB_DATETIME_PS,
+    'fs': TILEDB_DATETIME_FS,
+    'as': TILEDB_DATETIME_AS
+}
+
+# Conversion from TileDB dtype to Numpy typeid 
+_tiledb_dtype_to_numpy_typeid_convert ={
+    TILEDB_INT32: np.NPY_INT32,
+    TILEDB_UINT32: np.NPY_UINT32,
+    TILEDB_INT64: np.NPY_INT64,
+    TILEDB_UINT64: np.NPY_UINT64,
+    TILEDB_FLOAT32: np.NPY_FLOAT32,
+    TILEDB_FLOAT64: np.NPY_FLOAT64,
+    TILEDB_INT8: np.NPY_INT8,
+    TILEDB_UINT8: np.NPY_UINT8,
+    TILEDB_INT16: np.NPY_INT16,
+    TILEDB_UINT16: np.NPY_UINT16,
+    TILEDB_CHAR: np.NPY_STRING,
+    TILEDB_STRING_UTF8: np.NPY_UNICODE
+}
+
+# Conversion from TileDB dtype to Numpy dtype
+_tiledb_dtype_to_numpy_dtype_convert = {
+    TILEDB_INT32: np.int32,
+    TILEDB_UINT32: np.uint32,
+    TILEDB_INT64: np.int64,
+    TILEDB_UINT64: np.uint64,
+    TILEDB_FLOAT32: np.float32,
+    TILEDB_FLOAT64: np.float64,
+    TILEDB_INT8: np.int8,
+    TILEDB_UINT8: np.uint8,
+    TILEDB_INT16: np.int16,
+    TILEDB_UINT16: np.uint16,
+    TILEDB_CHAR: np.dtype('S1'),
+    TILEDB_STRING_ASCII: np.bytes_,
+    TILEDB_STRING_UTF8: np.dtype('U1')
+}
+
 def version():
     """Return the version of the linked ``libtiledb`` shared library
 
     :rtype: tuple
     :return: Semver version (major, minor, rev)
 
     """
@@ -1094,95 +1161,43 @@
     one = np.timedelta64(1, date_unit)
     # Dividing a timedelta by 1 will convert the timedelta to an integer
     return int(extent / one)
 
 
 cdef bint _tiledb_type_is_datetime(tiledb_datatype_t tiledb_type) except? False:
     """Returns True if the tiledb type is a datetime type"""
-    if tiledb_type == TILEDB_DATETIME_YEAR or tiledb_type == TILEDB_DATETIME_MONTH \
-            or tiledb_type == TILEDB_DATETIME_WEEK or tiledb_type == TILEDB_DATETIME_DAY \
-            or tiledb_type == TILEDB_DATETIME_HR or tiledb_type == TILEDB_DATETIME_MIN \
-            or tiledb_type == TILEDB_DATETIME_SEC or tiledb_type == TILEDB_DATETIME_MS \
-            or tiledb_type == TILEDB_DATETIME_US or tiledb_type == TILEDB_DATETIME_NS \
-            or tiledb_type == TILEDB_DATETIME_PS or tiledb_type == TILEDB_DATETIME_FS \
-            or tiledb_type == TILEDB_DATETIME_AS:
-        return True
-    return False
-
+    return tiledb_type in (TILEDB_DATETIME_YEAR, TILEDB_DATETIME_MONTH, 
+        TILEDB_DATETIME_WEEK, TILEDB_DATETIME_DAY, TILEDB_DATETIME_HR, 
+        TILEDB_DATETIME_MIN, TILEDB_DATETIME_SEC, TILEDB_DATETIME_MS, 
+        TILEDB_DATETIME_US, TILEDB_DATETIME_NS, TILEDB_DATETIME_PS, 
+        TILEDB_DATETIME_FS, TILEDB_DATETIME_AS)
 
 def _tiledb_type_to_datetime(tiledb_datatype_t tiledb_type):
     """
     Return a datetime64 with appropriate unit for the given
     tiledb_datetype_t enum value
     """
-    if tiledb_type == TILEDB_DATETIME_YEAR:
-        return np.datetime64('', 'Y')
-    elif tiledb_type == TILEDB_DATETIME_MONTH:
-        return np.datetime64('', 'M')
-    elif tiledb_type == TILEDB_DATETIME_WEEK:
-        return np.datetime64('', 'W')
-    elif tiledb_type == TILEDB_DATETIME_DAY:
-        return np.datetime64('', 'D')
-    elif tiledb_type == TILEDB_DATETIME_HR:
-        return np.datetime64('', 'h')
-    elif tiledb_type == TILEDB_DATETIME_MIN:
-        return np.datetime64('', 'm')
-    elif tiledb_type == TILEDB_DATETIME_SEC:
-        return np.datetime64('', 's')
-    elif tiledb_type == TILEDB_DATETIME_MS:
-        return np.datetime64('', 'ms')
-    elif tiledb_type == TILEDB_DATETIME_US:
-        return np.datetime64('', 'us')
-    elif tiledb_type == TILEDB_DATETIME_NS:
-        return np.datetime64('', 'ns')
-    elif tiledb_type == TILEDB_DATETIME_PS:
-        return np.datetime64('', 'ps')
-    elif tiledb_type == TILEDB_DATETIME_FS:
-        return np.datetime64('', 'fs')
-    elif tiledb_type == TILEDB_DATETIME_AS:
-        return np.datetime64('', 'as')
-    else:
+    tdb_type = _tiledb_dtype_to_datetime_convert.get(tiledb_type, None)
+    if tdb_type is None:
         raise TypeError("tiledb type is not a datetime {0!r}".format(tiledb_type))
+    return tdb_type
 
 cdef tiledb_datatype_t _tiledb_dtype_datetime(np.dtype dtype) except? TILEDB_DATETIME_YEAR:
     """Return tiledb_datetype_t enum value for a given np.datetime64 dtype"""
     if dtype.kind != 'M':
         raise TypeError("data type {0!r} not a datetime".format(dtype))
+
     date_unit = np.datetime_data(dtype)[0]
     if date_unit == 'generic':
         raise TypeError("datetime {0!r} does not specify a date unit".format(dtype))
-    elif date_unit == 'Y':
-        return TILEDB_DATETIME_YEAR
-    elif date_unit == 'M':
-        return TILEDB_DATETIME_MONTH
-    elif date_unit == 'W':
-        return TILEDB_DATETIME_WEEK
-    elif date_unit == 'D':
-        return TILEDB_DATETIME_DAY
-    elif date_unit == 'h':
-        return TILEDB_DATETIME_HR
-    elif date_unit == 'm':
-        return TILEDB_DATETIME_MIN
-    elif date_unit == 's':
-        return TILEDB_DATETIME_SEC
-    elif date_unit == 'ms':
-        return TILEDB_DATETIME_MS
-    elif date_unit == 'us':
-        return TILEDB_DATETIME_US
-    elif date_unit == 'ns':
-        return TILEDB_DATETIME_NS
-    elif date_unit == 'ps':
-        return TILEDB_DATETIME_PS
-    elif date_unit == 'fs':
-        return TILEDB_DATETIME_FS
-    elif date_unit == 'as':
-        return TILEDB_DATETIME_AS
-    else:
-        raise TypeError("unhandled datetime data type {0!r}".format(dtype))
-
+    
+    tdb_dt = _datetime_tiledb_dtype_convert.get(date_unit, None)
+    if tdb_dt is None:
+        raise TypeError("np type is not a datetime {0!r}".format(date_unit))
+    return tdb_dt
 
 def _tiledb_cast_tile_extent(tile_extent, dtype):
     """Given a tile extent value, cast it to np.array of the given numpy dtype."""
     # Special handling for datetime domains
     if dtype.kind == 'M':
         date_unit = np.datetime_data(dtype)[0]
         if isinstance(tile_extent, np.timedelta64):
@@ -1196,75 +1211,27 @@
     if tile_size_array.size != 1:
         raise ValueError("tile extent must be a scalar")
     return tile_size_array
 
 
 cdef int _numpy_typeid(tiledb_datatype_t tiledb_dtype):
     """Return a numpy type num (int) given a tiledb_datatype_t enum value."""
-    if tiledb_dtype == TILEDB_INT32:
-        return np.NPY_INT32
-    elif tiledb_dtype == TILEDB_UINT32:
-        return np.NPY_UINT32
-    elif tiledb_dtype == TILEDB_INT64:
-        return np.NPY_INT64
-    elif tiledb_dtype == TILEDB_UINT64:
-        return np.NPY_UINT64
-    elif tiledb_dtype == TILEDB_FLOAT32:
-        return np.NPY_FLOAT32
-    elif tiledb_dtype == TILEDB_FLOAT64:
-        return np.NPY_FLOAT64
-    elif tiledb_dtype == TILEDB_INT8:
-        return np.NPY_INT8
-    elif tiledb_dtype == TILEDB_UINT8:
-        return np.NPY_UINT8
-    elif tiledb_dtype == TILEDB_INT16:
-        return np.NPY_INT16
-    elif tiledb_dtype == TILEDB_UINT16:
-        return np.NPY_UINT16
-    elif tiledb_dtype == TILEDB_CHAR:
-        return np.NPY_STRING
-    elif tiledb_dtype == TILEDB_STRING_UTF8:
-        return np.NPY_UNICODE
-    elif _tiledb_type_is_datetime(tiledb_dtype):
-        return np.NPY_DATETIME
-    else:
-        return np.NPY_NOTYPE
+    np_id_type = _tiledb_dtype_to_numpy_typeid_convert.get(tiledb_dtype, None)
+    if np_id_type:
+        return np_id_type
+    return np.NPY_DATETIME if _tiledb_type_is_datetime(tiledb_dtype) else np.NPY_NOTYPE
 
 cdef _numpy_dtype(tiledb_datatype_t tiledb_dtype, cell_size = 1):
     """Return a numpy type given a tiledb_datatype_t enum value."""
     cdef base_dtype
     cdef uint32_t cell_val_num = cell_size
 
     if cell_val_num == 1:
-        if tiledb_dtype == TILEDB_INT32:
-            return np.int32
-        elif tiledb_dtype == TILEDB_UINT32:
-            return np.uint32
-        elif tiledb_dtype == TILEDB_INT64:
-            return np.int64
-        elif tiledb_dtype == TILEDB_UINT64:
-            return np.uint64
-        elif tiledb_dtype == TILEDB_FLOAT32:
-            return np.float32
-        elif tiledb_dtype == TILEDB_FLOAT64:
-            return np.float64
-        elif tiledb_dtype == TILEDB_INT8:
-            return np.int8
-        elif tiledb_dtype == TILEDB_UINT8:
-            return np.uint8
-        elif tiledb_dtype == TILEDB_INT16:
-            return np.int16
-        elif tiledb_dtype == TILEDB_UINT16:
-            return np.uint16
-        elif tiledb_dtype == TILEDB_CHAR:
-            return np.dtype('S1')
-        elif tiledb_dtype == TILEDB_STRING_ASCII:
-            return np.bytes_
-        elif tiledb_dtype == TILEDB_STRING_UTF8:
-            return np.dtype('U1')
+        if tiledb_dtype in _tiledb_dtype_to_numpy_dtype_convert:
+            return _tiledb_dtype_to_numpy_dtype_convert[tiledb_dtype]
         elif _tiledb_type_is_datetime(tiledb_dtype):
             return _tiledb_type_to_datetime(tiledb_dtype)
 
     elif cell_val_num == 2 and tiledb_dtype == TILEDB_FLOAT32:
         return np.complex64
 
     elif cell_val_num == 2 and tiledb_dtype == TILEDB_FLOAT64:
@@ -1318,26 +1285,26 @@
     raise ValueError("unknown tiledb layout: {0!r}".format(order))
 
 
 cdef unicode _tiledb_layout_string(tiledb_layout_t order):
     """
     Return the unicode string label given a tiledb_layout_t enum value
     """
-    if order == TILEDB_ROW_MAJOR:
-        return u"row-major"
-    elif order == TILEDB_COL_MAJOR:
-        return u"col-major"
-    elif order == TILEDB_GLOBAL_ORDER:
-        return u"global"
-    elif order == TILEDB_UNORDERED:
-        return u"unordered"
-    elif order == TILEDB_HILBERT:
-        return u"hilbert"
+    tiledb_order_to_string ={
+        TILEDB_ROW_MAJOR: u"row-major",
+        TILEDB_COL_MAJOR: u"col-major",
+        TILEDB_GLOBAL_ORDER: u"global",
+        TILEDB_UNORDERED: u"unordered",
+        TILEDB_HILBERT: u"hilbert"
+    }
 
-    raise ValueError("unknown tiledb order: {0!r}".format(order))
+    if order not in tiledb_order_to_string:
+        raise ValueError("unknown tiledb order: {0!r}".format(order))
+    
+    return tiledb_order_to_string[order]
 
 cdef class Filter(object):
     """Base class for all TileDB filters."""
 
     def __cinit__(self):
         self.ptr = NULL
 
@@ -2240,19 +2207,24 @@
                  nullable=False,
                  filters=None,
                  Ctx ctx=None):
         if not ctx:
             ctx = default_ctx()
         cdef bytes bname = ustring(name).encode('UTF-8')
         cdef const char* name_ptr = PyBytes_AS_STRING(bname)
-        cdef np.dtype _dtype = np.dtype(dtype)
+        cdef np.dtype _dtype 
         cdef tiledb_datatype_t tiledb_dtype
         cdef uint32_t ncells
 
-        tiledb_dtype, ncells = array_type_ncells(_dtype)
+        if isinstance(dtype, str) and dtype == "ascii":
+            tiledb_dtype = TILEDB_STRING_ASCII
+            ncells = TILEDB_VAR_NUM
+        else:
+            _dtype = np.dtype(dtype)
+            tiledb_dtype, ncells = array_type_ncells(_dtype)
 
         # ensure that all unicode strings are var-length
         if var or _dtype.kind == 'U' or (_dtype.kind == 'S' and _dtype.itemsize == 0):
             var = True
             ncells = TILEDB_VAR_NUM
 
         # variable-length cell type
@@ -2496,16 +2468,18 @@
         filters_str = ""
         if self.filters:
             filters_str = ", filters=FilterList(["
             for f in self.filters:
                 filters_str +=  repr(f) + ", "
             filters_str += "])"
 
+        attr_dtype = self.dtype if (self._get_type() != TILEDB_STRING_ASCII) else "ascii"
+
         # filters_str must be last with no spaces
-        return (f"""Attr(name={repr(self.name)}, dtype='{self.dtype!s}', """
+        return (f"""Attr(name={repr(self.name)}, dtype='{attr_dtype!s}', """
                 f"""var={self.isvar!s}, nullable={self.isnullable!s}"""
                 f"""{filters_str})""")
 
 
 cdef class Dim(object):
     """Class representing a dimension of a TileDB Array.
 
@@ -4230,16 +4204,22 @@
         :param key: attribute index (positional or associative)
         :type key: int or str
         :rtype: :py:class:`Attr`
         :return: The array attribute at index or with the given name (label)
         :raises TypeError: invalid key type"""
         return self.schema.domain.dim(dim_id)
 
-    def _nonempty_domain_var(self):
-        """Return nonempty domain for a var-length attribute (internal)."""
+    def nonempty_domain(self):
+        """Return the minimum bounding domain which encompasses nonempty values.
+
+        :rtype: tuple(tuple(numpy scalar, numpy scalar), ...)
+        :return: A list of (inclusive) domain extent tuples, that contain all
+            nonempty cells
+
+        """
         cdef list results = list()
         cdef Domain dom = self.schema.domain
 
         cdef tiledb_ctx_t* ctx_ptr = self.ctx.ptr
         cdef tiledb_array_t* array_ptr = self.ptr
         cdef int rc = TILEDB_OK
         cdef uint32_t dim_idx
@@ -4273,76 +4253,43 @@
                 end_buf_ptr = np.PyArray_DATA(end_buf)
             else:
                 # this one is contiguous
                 start_buf = np.empty(2, dim_dtype)
                 start_buf_ptr = np.PyArray_DATA(start_buf)
 
             if np.issubdtype(dim_dtype, np.str_) or np.issubdtype(dim_dtype, np.bytes_):
-                    rc = tiledb_array_get_non_empty_domain_var_from_index(
-                             ctx_ptr, array_ptr, dim_idx, start_buf_ptr, end_buf_ptr, &is_empty
-                    )
-                    if rc != TILEDB_OK:
-                        _raise_ctx_err(ctx_ptr, rc)
-                    if is_empty:
-                        return None
-                    results.append((start_buf.item(0), end_buf.item(0)))
+                rc = tiledb_array_get_non_empty_domain_var_from_index(
+                            ctx_ptr, array_ptr, dim_idx, start_buf_ptr, end_buf_ptr, &is_empty
+                )
+                if rc != TILEDB_OK:
+                    _raise_ctx_err(ctx_ptr, rc)
+                if is_empty:
+                    return None
+                results.append((start_buf.item(0), end_buf.item(0)))
             else:
-                    rc = tiledb_array_get_non_empty_domain_from_index(
-                            ctx_ptr, array_ptr, dim_idx, start_buf_ptr, &is_empty
-                    )
-                    if rc != TILEDB_OK:
-                        _raise_ctx_err(ctx_ptr, rc)
-                    if is_empty:
-                        return None
-                    res_typed = (np.array(start_buf.item(0), dtype=dim_dtype),
-                                 np.array(start_buf.item(1), dtype=dim_dtype))
-                    results.append(res_typed)
+                rc = tiledb_array_get_non_empty_domain_from_index(
+                        ctx_ptr, array_ptr, dim_idx, start_buf_ptr, &is_empty
+                )
+                if rc != TILEDB_OK:
+                    _raise_ctx_err(ctx_ptr, rc)
+                if is_empty:
+                    return None
 
+                res_x, res_y = start_buf.item(0), start_buf.item(1)
+                
+                if np.issubdtype(dim_dtype, np.datetime64):
+                    # Convert to np.datetime64
+                    date_unit = np.datetime_data(dim_dtype)[0]
+                    res_x = np.datetime64(res_x, date_unit)
+                    res_y = np.datetime64(res_y, date_unit)
+                    
+                results.append((res_x, res_y))
+        
         return tuple(results)
 
-    def nonempty_domain(self):
-        """Return the minimum bounding domain which encompasses nonempty values.
-
-        :rtype: tuple(tuple(numpy scalar, numpy scalar), ...)
-        :return: A list of (inclusive) domain extent tuples, that contain all
-            nonempty cells
-
-        """
-        cdef Domain dom = self.schema.domain
-        dom_dims = [dom.dim(idx) for idx in range(dom.ndim)]
-        dom_dtypes = [dim.dtype for dim in dom_dims]
-
-        if any(dim.isvar for dim in dom_dims) or \
-                dom_dims.count(dom_dims[0].dtype) != len(dom_dims):
-            return self._nonempty_domain_var()
-
-        cdef np.ndarray extents = np.zeros(shape=(dom.ndim, 2), dtype=dom.dtype)
-
-        cdef tiledb_ctx_t* ctx_ptr = self.ctx.ptr
-        cdef tiledb_array_t* array_ptr = self.ptr
-        cdef void* extents_ptr = np.PyArray_DATA(extents)
-        cdef int empty = 0
-        cdef int rc = TILEDB_OK
-        with nogil:
-            rc = tiledb_array_get_non_empty_domain(ctx_ptr, array_ptr, extents_ptr, &empty)
-        if rc != TILEDB_OK:
-            _raise_ctx_err(ctx_ptr, rc)
-        if empty > 0:
-            return None
-
-        if dom.dtype.kind == 'M':
-            # Convert to np.datetime64
-            date_unit = np.datetime_data(dom.dtype)[0]
-            return tuple((np.datetime64(extents[i, 0].item(), date_unit),
-                          np.datetime64(extents[i, 1].item(), date_unit))
-                         for i in range(dom.ndim))
-        else:
-            return tuple((extents[i, 0].item(), extents[i, 1].item())
-                         for i in range(dom.ndim))
-
     def consolidate(self, Config config=None, key=None, timestamp=None):
         """
         Consolidates fragments of an array object for increased read performance.
 
         Overview: https://docs.tiledb.com/main/solutions/tiledb-embedded/internal-mechanics/consolidation
 
         :param tiledb.Config config: The TileDB Config with consolidation parameters set
@@ -5253,14 +5200,21 @@
                     raise ValueError("Cannot write a string value to non-string "
                                      "typed attribute '{}'!".format(name))
 
                 attr_val = np.ascontiguousarray(attr_val, dtype=attr.dtype)
         except Exception as exc:
             raise ValueError(f"NumPy array conversion check failed for attr '{name}'") from exc
 
+        # if dtype is ASCII, ensure all characters are valid
+        if attr.dtype == "|S0":
+            try:
+                np.asarray(attr_val, dtype=np.bytes_)
+            except Exception as exc:
+                raise TileDBError(f'Attr\'s dtype is "ascii" but attr_val contains invalid ASCII characters')
+
         if attr_val.size != ncells:
            raise ValueError("value length ({}) does not match "
                              "coordinate length ({})".format(attr_val.size, ncells))
         sparse_attributes.append(attr._internal_name)
         sparse_values.append(attr_val)
 
     if (len(sparse_attributes) != len(val.keys())) \
```

### Comparing `tiledb-0.9.4/tiledb/multirange_indexing.py` & `tiledb-0.9.5/tiledb/multirange_indexing.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/np2buf.pyx` & `tiledb-0.9.5/tiledb/np2buf.pyx`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/npbuffer.cc` & `tiledb-0.9.5/tiledb/npbuffer.cc`

 * *Files 0% similar despite different names*

```diff
@@ -8,15 +8,15 @@
 
 #include "util.h"
 #include <pybind11/numpy.h>
 #include <pybind11/pybind11.h>
 #include <pybind11/pytypes.h>
 
 #if !defined(NDEBUG)
-#include "debug.cc"
+//#include "debug.cc"
 #endif
 
 #define TILEDB_DEPRECATED
 #define TILEDB_DEPRECATED_EXPORT
 
 #include <tiledb/tiledb> // C++
```

### Comparing `tiledb-0.9.4/tiledb/query_condition.cc` & `tiledb-0.9.5/tiledb/query_condition.cc`

 * *Files 0% similar despite different names*

```diff
@@ -8,15 +8,15 @@
 
 #include "util.h"
 #include <tiledb/tiledb> // C++
 
 #if TILEDB_VERSION_MAJOR == 2 && TILEDB_VERSION_MINOR >= 2
 
 #if !defined(NDEBUG)
-#include "debug.cc"
+//#include "debug.cc"
 #endif
 
 namespace tiledbpy {
 
 using namespace std;
 using namespace tiledb;
 namespace py = pybind11;
```

### Comparing `tiledb-0.9.4/tiledb/query_condition.py` & `tiledb-0.9.5/tiledb/query_condition.py`

 * *Files 12% similar despite different names*

```diff
@@ -23,20 +23,20 @@
     Boolean expressions are chained together with Boolean operators.
 
         query_cond ::= bool_expr | bool_expr bool_op query_cond
 
     A Boolean expression contains a comparison operator. The operator works on a
     TileDB attribute name and value.
 
-        bool_expr ::= attr compare_op val | val compare_op attr
+        bool_expr ::= attr compare_op val | val compare_op attr | val compare_op attr compare_op val
 
-    "and" is the only Boolean operator supported at the moment. We intend to
-    support "or" and "not" in future releases.
+    "and" and "&" are the only Boolean operators supported at the moment. We
+    intend to support "or" and "not" in future releases.
 
-        bool_op ::= and
+        bool_op ::= and | &
 
     All comparison operators are supported.
 
         compare_op ::= < | > | <= | >= | == | !=
 
     TileDB attribute names are strings (no quotes).
 
@@ -60,15 +60,21 @@
             ctx = tiledb.default_ctx()
 
         self._ctx = ctx
         self._schema = None
         self._query_attrs = None
         self._c_obj = None
 
-        self.tree = ast.parse(expression)
+        try:
+            self.tree = ast.parse(expression)
+        except:
+            raise tiledb.TileDBError(
+                f"Could not parse the given QueryCondition statement: {expression}"
+            )
+
         if not self.tree.body:
             raise tiledb.TileDBError(
                 "The query condition statement could not be parsed properly. "
                 "(Is this an empty expression?)"
             )
 
         self.raw_str = expression
@@ -81,31 +87,39 @@
         if not isinstance(self._c_obj, tiledb._query_condition.qc):
             raise tiledb.TileDBError(
                 "Malformed query condition statement. A query condition must "
                 "be made up of one or more Boolean expressions."
             )
 
     def visit_Compare(self, node):
+        result = self.aux_visit_Compare(
+            self.visit(node.left), node.ops[0], self.visit(node.comparators[0])
+        )
+        for lhs, op, rhs in zip(
+            node.comparators[:-1], node.ops[1:], node.comparators[1:]
+        ):
+            value = self.aux_visit_Compare(self.visit(lhs), op, self.visit(rhs))
+            result = result.combine(value, qc.TILEDB_AND)
+        return result
+
+    def aux_visit_Compare(self, att, op, val):
         AST_TO_TILEDB = {
             ast.Gt: qc.TILEDB_GT,
             ast.GtE: qc.TILEDB_GE,
             ast.Lt: qc.TILEDB_LT,
             ast.LtE: qc.TILEDB_LE,
             ast.Eq: qc.TILEDB_EQ,
             ast.NotEq: qc.TILEDB_NE,
         }
 
         try:
-            op = AST_TO_TILEDB[type(node.ops[0])]
+            op = AST_TO_TILEDB[type(op)]
         except KeyError:
             raise tiledb.TileDBError("Unsupported comparison operator.")
 
-        att = self.visit(node.left)
-        val = self.visit(node.comparators[0])
-
         if not isinstance(att, ast.Name):
             REVERSE_OP = {
                 qc.TILEDB_GT: qc.TILEDB_LT,
                 qc.TILEDB_GE: qc.TILEDB_LE,
                 qc.TILEDB_LT: qc.TILEDB_GT,
                 qc.TILEDB_LE: qc.TILEDB_GE,
                 qc.TILEDB_EQ: qc.TILEDB_EQ,
@@ -161,38 +175,55 @@
                 val = cast(val)
                 dtype_name = dtype.name
             except ValueError:
                 raise tiledb.TileDBError(
                     f"Type mismatch between attribute `{att}` and value `{val}`."
                 )
 
-        c_obj = qc.qc(self._ctx)
+        result = qc.qc(self._ctx)
 
-        if not hasattr(c_obj, f"init_{dtype_name}"):
+        if not hasattr(result, f"init_{dtype_name}"):
             raise tiledb.TileDBError(
                 f"PyQueryCondition's `init_{dtype_name}` not found."
             )
 
-        init_qc = getattr(c_obj, f"init_{dtype_name}")
+        init_qc = getattr(result, f"init_{dtype_name}")
 
         try:
             init_qc(att, val, op)
         except tiledb.TileDBError as e:
             raise tiledb.TileDBError(e)
 
-        return c_obj
+        return result
+
+    def visit_BinOp(self, node):
+        AST_TO_TILEDB = {ast.BitAnd: qc.TILEDB_AND}
+
+        try:
+            op = AST_TO_TILEDB[type(node.op)]
+        except KeyError:
+            raise tiledb.TileDBError(
+                f"Unsupported binary operator: {ast.dump(node.op)}. Only & is currently supported."
+            )
+
+        result = self.visit(node.left)
+        rhs = node.right[1:] if isinstance(node.right, list) else [node.right]
+        for value in rhs:
+            result = result.combine(self.visit(value), op)
+
+        return result
 
     def visit_BoolOp(self, node):
         AST_TO_TILEDB = {ast.And: qc.TILEDB_AND}
 
         try:
             op = AST_TO_TILEDB[type(node.op)]
         except KeyError:
             raise tiledb.TileDBError(
-                'Unsupported Boolean operator. Only "and" is currently supported.'
+                f'Unsupported Boolean operator: {ast.dump(node.op)}. Only "and" is currently supported.'
             )
 
         result = self.visit(node.values[0])
         for value in node.values[1:]:
             result = result.combine(self.visit(value), op)
 
         return result
```

### Comparing `tiledb-0.9.4/tiledb/tests/check_csv_dir.py` & `tiledb-0.9.5/tiledb/tests/check_csv_dir.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/common.py` & `tiledb-0.9.5/tiledb/tests/common.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/conftest.py` & `tiledb-0.9.5/tiledb/tests/conftest.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/datatypes.py` & `tiledb-0.9.5/tiledb/tests/datatypes.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/fixtures.py` & `tiledb-0.9.5/tiledb/tests/fixtures.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/perf/asv.conf.json` & `tiledb-0.9.5/tiledb/tests/perf/asv.conf.json`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/perf/benchmarks/array.py` & `tiledb-0.9.5/tiledb/tests/perf/benchmarks/array.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/perf/benchmarks/indexing.py` & `tiledb-0.9.5/tiledb/tests/perf/benchmarks/indexing.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/perf/benchmarks/metadata.py` & `tiledb-0.9.5/tiledb/tests/perf/benchmarks/metadata.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/strategies.py` & `tiledb-0.9.5/tiledb/tests/strategies.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/test_compat.py` & `tiledb-0.9.5/tiledb/tests/test_compat.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/test_core.py` & `tiledb-0.9.5/tiledb/tests/test_core.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/test_dask.py` & `tiledb-0.9.5/tiledb/tests/test_dask.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/test_domain_index.py` & `tiledb-0.9.5/tiledb/tests/test_domain_index.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/test_examples.py` & `tiledb-0.9.5/tiledb/tests/test_examples.py`

 * *Files 9% similar despite different names*

```diff
@@ -40,15 +40,19 @@
                 pytest.fail(ex.stderr, pytrace=False)
 
     @pytest.mark.skipif(
         sys.platform == "win32",
         reason="Some doctests are missing a clean-up step on windows",
     )
     @pytest.mark.parametrize(
-        "path", [os.path.join(PROJECT_DIR, "tiledb", "libtiledb.pyx")]
+        "path",
+        [
+            os.path.join(PROJECT_DIR, "tiledb", "libtiledb.pyx"),
+            os.path.join(PROJECT_DIR, "tiledb", "fragment.py"),
+        ],
     )
     def test_docs(self, path, capsys):
         failures, _ = doctest.testfile(
             path,
             module_relative=False,
             verbose=False,
             optionflags=doctest.NORMALIZE_WHITESPACE,
```

### Comparing `tiledb-0.9.4/tiledb/tests/test_fixes.py` & `tiledb-0.9.5/tiledb/tests/test_fixes.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/test_fragment_info.py` & `tiledb-0.9.5/tiledb/tests/test_fragment_info.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/test_hypothesis.py` & `tiledb-0.9.5/tiledb/tests/test_hypothesis.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/test_libtiledb.py` & `tiledb-0.9.5/tiledb/tests/test_libtiledb.py`

 * *Files 1% similar despite different names*

```diff
@@ -1042,8289 +1042,8396 @@
 00004110: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
 00004120: 2061 7474 722e 6474 7970 6520 213d 206e   attr.dtype != n
 00004130: 702e 6474 7970 6528 6e70 2e64 6174 6574  p.dtype(np.datet
 00004140: 696d 6536 3428 2222 2c20 2259 2229 290a  ime64("", "Y")).
 00004150: 2020 2020 2020 2020 6173 7365 7274 2061          assert a
 00004160: 7474 722e 6474 7970 6520 213d 206e 702e  ttr.dtype != np.
 00004170: 6474 7970 6528 6e70 2e64 6174 6574 696d  dtype(np.datetim
-00004180: 6536 3429 0a0a 0a63 6c61 7373 2041 7272  e64)...class Arr
-00004190: 6179 5363 6865 6d61 5465 7374 2844 6973  aySchemaTest(Dis
-000041a0: 6b54 6573 7443 6173 6529 3a0a 2020 2020  kTestCase):.    
-000041b0: 6465 6620 7465 7374 5f73 6368 656d 615f  def test_schema_
-000041c0: 6261 7369 6328 7365 6c66 293a 0a20 2020  basic(self):.   
-000041d0: 2020 2020 2064 6f6d 203d 2074 696c 6564       dom = tiled
-000041e0: 622e 446f 6d61 696e 280a 2020 2020 2020  b.Domain(.      
-000041f0: 2020 2020 2020 7469 6c65 6462 2e44 696d        tiledb.Dim
-00004200: 2822 6431 222c 2028 312c 2034 292c 2032  ("d1", (1, 4), 2
-00004210: 2c20 6474 7970 653d 2275 3822 292c 0a20  , dtype="u8"),. 
-00004220: 2020 2020 2020 2020 2020 2074 696c 6564             tiled
-00004230: 622e 4469 6d28 2264 3222 2c20 2831 2c20  b.Dim("d2", (1, 
-00004240: 3429 2c20 322c 2064 7479 7065 3d22 7538  4), 2, dtype="u8
-00004250: 2229 2c0a 2020 2020 2020 2020 290a 0a20  "),.        ).. 
-00004260: 2020 2020 2020 2061 7474 7231 203d 2074         attr1 = t
-00004270: 696c 6564 622e 4174 7472 2822 666f 6f22  iledb.Attr("foo"
-00004280: 2c20 6474 7970 653d 666c 6f61 7429 0a20  , dtype=float). 
-00004290: 2020 2020 2020 2061 7474 7232 203d 2074         attr2 = t
-000042a0: 696c 6564 622e 4174 7472 2822 666f 6f22  iledb.Attr("foo"
-000042b0: 2c20 6474 7970 653d 696e 7429 0a0a 2020  , dtype=int)..  
-000042c0: 2020 2020 2020 2320 7465 7374 2075 6e69        # test uni
-000042d0: 7175 6520 6174 7472 6962 7574 6573 0a20  que attributes. 
-000042e0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-000042f0: 2e61 7373 6572 7452 6169 7365 7328 7469  .assertRaises(ti
-00004300: 6c65 6462 2e54 696c 6544 4245 7272 6f72  ledb.TileDBError
-00004310: 293a 0a20 2020 2020 2020 2020 2020 2074  ):.            t
-00004320: 696c 6564 622e 4172 7261 7953 6368 656d  iledb.ArraySchem
-00004330: 6128 646f 6d61 696e 3d64 6f6d 2c20 6174  a(domain=dom, at
-00004340: 7472 733d 2861 7474 7231 2c20 6174 7472  trs=(attr1, attr
-00004350: 3229 290a 0a20 2020 2020 2020 2023 2074  2))..        # t
-00004360: 6573 7420 7363 6865 6d61 2e63 6865 636b  est schema.check
-00004370: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
-00004380: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
-00004390: 6865 6d61 2864 6f6d 6169 6e3d 646f 6d2c  hema(domain=dom,
-000043a0: 2061 7474 7273 3d28 6174 7472 312c 2929   attrs=(attr1,))
-000043b0: 0a20 2020 2020 2020 2023 2076 616c 6964  .        # valid
-000043c0: 2073 6368 656d 6120 646f 6573 206e 6f74   schema does not
-000043d0: 2072 6169 7365 0a20 2020 2020 2020 2073   raise.        s
-000043e0: 6368 656d 612e 6368 6563 6b28 290a 2020  chema.check().  
-000043f0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-00004400: 6173 7365 7274 5261 6973 6573 2874 696c  assertRaises(til
-00004410: 6564 622e 5469 6c65 4442 4572 726f 7229  edb.TileDBError)
-00004420: 3a0a 2020 2020 2020 2020 2020 2020 7363  :.            sc
-00004430: 6865 6d61 2e5f 6d61 6b65 5f69 6e76 616c  hema._make_inval
-00004440: 6964 2829 0a20 2020 2020 2020 2020 2020  id().           
-00004450: 2073 6368 656d 612e 6368 6563 6b28 290a   schema.check().
-00004460: 0a20 2020 2064 6566 2074 6573 745f 6465  .    def test_de
-00004470: 6e73 655f 6172 7261 795f 7363 6865 6d61  nse_array_schema
-00004480: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00004490: 646f 6d61 696e 203d 2074 696c 6564 622e  domain = tiledb.
-000044a0: 446f 6d61 696e 280a 2020 2020 2020 2020  Domain(.        
-000044b0: 2020 2020 7469 6c65 6462 2e44 696d 2864      tiledb.Dim(d
-000044c0: 6f6d 6169 6e3d 2831 2c20 3829 2c20 7469  omain=(1, 8), ti
-000044d0: 6c65 3d32 292c 2074 696c 6564 622e 4469  le=2), tiledb.Di
-000044e0: 6d28 646f 6d61 696e 3d28 312c 2038 292c  m(domain=(1, 8),
-000044f0: 2074 696c 653d 3229 0a20 2020 2020 2020   tile=2).       
-00004500: 2029 0a20 2020 2020 2020 2061 3120 3d20   ).        a1 = 
-00004510: 7469 6c65 6462 2e41 7474 7228 2276 616c  tiledb.Attr("val
-00004520: 222c 2064 7479 7065 3d22 6638 2229 0a20  ", dtype="f8"). 
-00004530: 2020 2020 2020 2073 6368 656d 6120 3d20         schema = 
-00004540: 7469 6c65 6462 2e41 7272 6179 5363 6865  tiledb.ArraySche
-00004550: 6d61 2864 6f6d 6169 6e3d 646f 6d61 696e  ma(domain=domain
-00004560: 2c20 6174 7472 733d 2861 312c 2929 0a20  , attrs=(a1,)). 
-00004570: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00004580: 7274 4661 6c73 6528 7363 6865 6d61 2e73  rtFalse(schema.s
-00004590: 7061 7273 6529 0a20 2020 2020 2020 2073  parse).        s
-000045a0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000045b0: 7363 6865 6d61 2e63 656c 6c5f 6f72 6465  schema.cell_orde
-000045c0: 722c 2022 726f 772d 6d61 6a6f 7222 290a  r, "row-major").
-000045d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000045e0: 6572 7445 7175 616c 2873 6368 656d 612e  ertEqual(schema.
-000045f0: 7469 6c65 5f6f 7264 6572 2c20 2272 6f77  tile_order, "row
-00004600: 2d6d 616a 6f72 2229 0a20 2020 2020 2020  -major").       
-00004610: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00004620: 6c28 7363 6865 6d61 2e64 6f6d 6169 6e2c  l(schema.domain,
-00004630: 2064 6f6d 6169 6e29 0a20 2020 2020 2020   domain).       
-00004640: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00004650: 6c28 7363 6865 6d61 2e6e 6469 6d2c 2032  l(schema.ndim, 2
-00004660: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00004670: 7373 6572 7445 7175 616c 2873 6368 656d  ssertEqual(schem
-00004680: 612e 7368 6170 652c 2028 382c 2038 2929  a.shape, (8, 8))
-00004690: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-000046a0: 7365 7274 4571 7561 6c28 7363 6865 6d61  sertEqual(schema
-000046b0: 2e6e 6174 7472 2c20 3129 0a20 2020 2020  .nattr, 1).     
-000046c0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000046d0: 7561 6c28 7363 6865 6d61 2e64 6f6d 6169  ual(schema.domai
-000046e0: 6e2e 686f 6d6f 6765 6e65 6f75 732c 2054  n.homogeneous, T
-000046f0: 7275 6529 0a20 2020 2020 2020 2073 656c  rue).        sel
-00004700: 662e 6173 7365 7274 4571 7561 6c28 7363  f.assertEqual(sc
-00004710: 6865 6d61 2e61 7474 7228 3029 2c20 6131  hema.attr(0), a1
-00004720: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00004730: 7373 6572 7454 7275 6528 7363 6865 6d61  ssertTrue(schema
-00004740: 2e68 6173 5f61 7474 7228 2276 616c 2229  .has_attr("val")
-00004750: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00004760: 7373 6572 7446 616c 7365 2873 6368 656d  ssertFalse(schem
-00004770: 612e 6861 735f 6174 7472 2822 6e6f 6e6f  a.has_attr("nono
-00004780: 6e6f 6174 7472 2229 290a 2020 2020 2020  noattr")).      
-00004790: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-000047a0: 616c 2873 6368 656d 612c 2074 696c 6564  al(schema, tiled
-000047b0: 622e 4172 7261 7953 6368 656d 6128 646f  b.ArraySchema(do
-000047c0: 6d61 696e 3d64 6f6d 6169 6e2c 2061 7474  main=domain, att
-000047d0: 7273 3d28 6131 2c29 2929 0a20 2020 2020  rs=(a1,))).     
-000047e0: 2020 2073 656c 662e 6173 7365 7274 4e6f     self.assertNo
-000047f0: 7445 7175 616c 280a 2020 2020 2020 2020  tEqual(.        
-00004800: 2020 2020 7363 6865 6d61 2c20 7469 6c65      schema, tile
-00004810: 6462 2e41 7272 6179 5363 6865 6d61 2864  db.ArraySchema(d
-00004820: 6f6d 6169 6e3d 646f 6d61 696e 2c20 6174  omain=domain, at
-00004830: 7472 733d 2861 312c 292c 2073 7061 7273  trs=(a1,), spars
-00004840: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-00004850: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
-00004860: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-00004870: 2874 696c 6564 622e 5469 6c65 4442 4572  (tiledb.TileDBEr
-00004880: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
-00004890: 2020 7363 6865 6d61 2e61 6c6c 6f77 735f    schema.allows_
-000048a0: 6475 706c 6963 6174 6573 0a20 2020 2020  duplicates.     
-000048b0: 2020 2023 2074 6573 7420 6974 6572 6174     # test iterat
-000048c0: 696f 6e20 6f76 6572 2061 7474 7269 6275  ion over attribu
-000048d0: 7465 730a 2020 2020 2020 2020 7365 6c66  tes.        self
-000048e0: 2e61 7373 6572 7445 7175 616c 286c 6973  .assertEqual(lis
-000048f0: 7428 7363 6865 6d61 292c 205b 6131 5d29  t(schema), [a1])
-00004900: 0a0a 2020 2020 2020 2020 7769 7468 2073  ..        with s
-00004910: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-00004920: 5265 6765 7828 0a20 2020 2020 2020 2020  Regex(.         
-00004930: 2020 2074 696c 6564 622e 5469 6c65 4442     tiledb.TileDB
-00004940: 4572 726f 722c 0a20 2020 2020 2020 2020  Error,.         
-00004950: 2020 2022 4361 6e6e 6f74 2073 6574 2063     "Cannot set c
-00004960: 656c 6c20 6f72 6465 723b 2048 696c 6265  ell order; Hilbe
-00004970: 7274 206f 7264 6572 2069 7320 6f6e 6c79  rt order is only
-00004980: 2061 7070 6c69 6361 626c 6520 746f 2073   applicable to s
-00004990: 7061 7273 6520 6172 7261 7973 222c 0a20  parse arrays",. 
-000049a0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-000049b0: 2020 2020 2020 7469 6c65 6462 2e41 7272        tiledb.Arr
-000049c0: 6179 5363 6865 6d61 280a 2020 2020 2020  aySchema(.      
-000049d0: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
-000049e0: 3d64 6f6d 6169 6e2c 2061 7474 7273 3d28  =domain, attrs=(
-000049f0: 6131 2c29 2c20 7370 6172 7365 3d46 616c  a1,), sparse=Fal
-00004a00: 7365 2c20 6365 6c6c 5f6f 7264 6572 3d22  se, cell_order="
-00004a10: 6869 6c62 6572 7422 0a20 2020 2020 2020  hilbert".       
-00004a20: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00004a30: 7465 7374 5f64 656e 7365 5f61 7272 6179  test_dense_array
-00004a40: 5f73 6368 656d 615f 6670 5f64 6f6d 6169  _schema_fp_domai
-00004a50: 6e5f 6572 726f 7228 7365 6c66 293a 0a20  n_error(self):. 
-00004a60: 2020 2020 2020 2064 6f6d 203d 2074 696c         dom = til
-00004a70: 6564 622e 446f 6d61 696e 2874 696c 6564  edb.Domain(tiled
-00004a80: 622e 4469 6d28 646f 6d61 696e 3d28 312c  b.Dim(domain=(1,
-00004a90: 2038 292c 2074 696c 653d 322c 2064 7479   8), tile=2, dty
-00004aa0: 7065 3d6e 702e 666c 6f61 7436 3429 290a  pe=np.float64)).
-00004ab0: 2020 2020 2020 2020 6174 7420 3d20 7469          att = ti
-00004ac0: 6c65 6462 2e41 7474 7228 2276 616c 222c  ledb.Attr("val",
-00004ad0: 2064 7479 7065 3d6e 702e 666c 6f61 7436   dtype=np.float6
-00004ae0: 3429 0a0a 2020 2020 2020 2020 7769 7468  4)..        with
-00004af0: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-00004b00: 6573 2874 696c 6564 622e 5469 6c65 4442  es(tiledb.TileDB
-00004b10: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-00004b20: 2020 2020 7469 6c65 6462 2e41 7272 6179      tiledb.Array
-00004b30: 5363 6865 6d61 2864 6f6d 6169 6e3d 646f  Schema(domain=do
-00004b40: 6d2c 2061 7474 7273 3d28 6174 742c 2929  m, attrs=(att,))
-00004b50: 0a0a 2020 2020 6465 6620 7465 7374 5f73  ..    def test_s
-00004b60: 7061 7273 655f 7363 6865 6d61 2873 656c  parse_schema(sel
-00004b70: 662c 2063 6170 6664 293a 0a20 2020 2020  f, capfd):.     
-00004b80: 2020 2023 2063 7265 6174 6520 6469 6d65     # create dime
-00004b90: 6e73 696f 6e73 0a20 2020 2020 2020 2064  nsions.        d
-00004ba0: 3120 3d20 7469 6c65 6462 2e44 696d 2822  1 = tiledb.Dim("
-00004bb0: 6431 222c 2064 6f6d 6169 6e3d 2831 2c20  d1", domain=(1, 
-00004bc0: 3130 3030 292c 2074 696c 653d 3130 2c20  1000), tile=10, 
-00004bd0: 6474 7970 653d 2275 696e 7436 3422 290a  dtype="uint64").
-00004be0: 2020 2020 2020 2020 6432 203d 2074 696c          d2 = til
-00004bf0: 6564 622e 4469 6d28 2264 3222 2c20 646f  edb.Dim("d2", do
-00004c00: 6d61 696e 3d28 3130 312c 2031 3030 3030  main=(101, 10000
-00004c10: 292c 2074 696c 653d 3130 302c 2064 7479  ), tile=100, dty
-00004c20: 7065 3d22 7569 6e74 3634 2229 0a0a 2020  pe="uint64")..  
-00004c30: 2020 2020 2020 2320 6372 6561 7465 2064        # create d
-00004c40: 6f6d 6169 6e0a 2020 2020 2020 2020 646f  omain.        do
-00004c50: 6d61 696e 203d 2074 696c 6564 622e 446f  main = tiledb.Do
-00004c60: 6d61 696e 2864 312c 2064 3229 0a0a 2020  main(d1, d2)..  
-00004c70: 2020 2020 2020 2320 6372 6561 7465 2061        # create a
-00004c80: 7474 7269 6275 7465 730a 2020 2020 2020  ttributes.      
-00004c90: 2020 6131 203d 2074 696c 6564 622e 4174    a1 = tiledb.At
-00004ca0: 7472 2822 6131 222c 2064 7479 7065 3d22  tr("a1", dtype="
-00004cb0: 696e 7433 322c 696e 7433 322c 696e 7433  int32,int32,int3
-00004cc0: 3222 290a 2020 2020 2020 2020 6132 203d  2").        a2 =
-00004cd0: 2074 696c 6564 622e 4174 7472 280a 2020   tiledb.Attr(.  
-00004ce0: 2020 2020 2020 2020 2020 2261 3222 2c20            "a2", 
-00004cf0: 6669 6c74 6572 733d 7469 6c65 6462 2e46  filters=tiledb.F
-00004d00: 696c 7465 724c 6973 7428 5b74 696c 6564  ilterList([tiled
-00004d10: 622e 477a 6970 4669 6c74 6572 282d 3129  b.GzipFilter(-1)
-00004d20: 5d29 2c20 6474 7970 653d 2266 6c6f 6174  ]), dtype="float
-00004d30: 3332 220a 2020 2020 2020 2020 290a 0a20  32".        ).. 
-00004d40: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
-00004d50: 7370 6172 7365 2061 7272 6179 2077 6974  sparse array wit
-00004d60: 6820 7363 6865 6d61 0a20 2020 2020 2020  h schema.       
-00004d70: 2063 6f6f 7264 735f 6669 6c74 6572 7320   coords_filters 
-00004d80: 3d20 7469 6c65 6462 2e46 696c 7465 724c  = tiledb.FilterL
-00004d90: 6973 7428 5b74 696c 6564 622e 5a73 7464  ist([tiledb.Zstd
-00004da0: 4669 6c74 6572 2834 295d 290a 2020 2020  Filter(4)]).    
-00004db0: 2020 2020 6f66 6673 6574 735f 6669 6c74      offsets_filt
-00004dc0: 6572 7320 3d20 7469 6c65 6462 2e46 696c  ers = tiledb.Fil
-00004dd0: 7465 724c 6973 7428 5b74 696c 6564 622e  terList([tiledb.
-00004de0: 4c5a 3446 696c 7465 7228 3529 5d29 0a0a  LZ4Filter(5)])..
-00004df0: 2020 2020 2020 2020 7363 6865 6d61 203d          schema =
-00004e00: 2074 696c 6564 622e 4172 7261 7953 6368   tiledb.ArraySch
-00004e10: 656d 6128 0a20 2020 2020 2020 2020 2020  ema(.           
-00004e20: 2064 6f6d 6169 6e3d 646f 6d61 696e 2c0a   domain=domain,.
-00004e30: 2020 2020 2020 2020 2020 2020 6174 7472              attr
-00004e40: 733d 2861 312c 2061 3229 2c0a 2020 2020  s=(a1, a2),.    
-00004e50: 2020 2020 2020 2020 6361 7061 6369 7479          capacity
-00004e60: 3d31 302c 0a20 2020 2020 2020 2020 2020  =10,.           
-00004e70: 2063 656c 6c5f 6f72 6465 723d 2263 6f6c   cell_order="col
-00004e80: 2d6d 616a 6f72 222c 0a20 2020 2020 2020  -major",.       
-00004e90: 2020 2020 2074 696c 655f 6f72 6465 723d       tile_order=
-00004ea0: 2272 6f77 2d6d 616a 6f72 222c 0a20 2020  "row-major",.   
-00004eb0: 2020 2020 2020 2020 2061 6c6c 6f77 735f           allows_
-00004ec0: 6475 706c 6963 6174 6573 3d54 7275 652c  duplicates=True,
-00004ed0: 0a20 2020 2020 2020 2020 2020 2073 7061  .            spa
-00004ee0: 7273 653d 5472 7565 2c0a 2020 2020 2020  rse=True,.      
-00004ef0: 2020 2020 2020 636f 6f72 6473 5f66 696c        coords_fil
-00004f00: 7465 7273 3d63 6f6f 7264 735f 6669 6c74  ters=coords_filt
-00004f10: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
-00004f20: 206f 6666 7365 7473 5f66 696c 7465 7273   offsets_filters
-00004f30: 3d6f 6666 7365 7473 5f66 696c 7465 7273  =offsets_filters
-00004f40: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00004f50: 2020 2020 2073 6368 656d 612e 6475 6d70       schema.dump
-00004f60: 2829 0a20 2020 2020 2020 2061 7373 6572  ().        asser
-00004f70: 745f 6361 7074 7572 6564 2863 6170 6664  t_captured(capfd
-00004f80: 2c20 2241 7272 6179 2074 7970 653a 2073  , "Array type: s
-00004f90: 7061 7273 6522 290a 0a20 2020 2020 2020  parse")..       
-00004fa0: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
-00004fb0: 2873 6368 656d 612e 7370 6172 7365 290a  (schema.sparse).
-00004fc0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00004fd0: 6572 7445 7175 616c 2873 6368 656d 612e  ertEqual(schema.
-00004fe0: 6361 7061 6369 7479 2c20 3130 290a 2020  capacity, 10).  
-00004ff0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00005000: 7445 7175 616c 2873 6368 656d 612e 6365  tEqual(schema.ce
-00005010: 6c6c 5f6f 7264 6572 2c20 2263 6f6c 2d6d  ll_order, "col-m
-00005020: 616a 6f72 2229 0a20 2020 2020 2020 2073  ajor").        s
-00005030: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005040: 7363 6865 6d61 2e74 696c 655f 6f72 6465  schema.tile_orde
-00005050: 722c 2022 726f 772d 6d61 6a6f 7222 290a  r, "row-major").
-00005060: 0a20 2020 2020 2020 2023 203c 746f 646f  .        # <todo
-00005070: 3e0a 2020 2020 2020 2020 2320 7365 6c66  >.        # self
-00005080: 2e61 7373 6572 7445 7175 616c 2873 6368  .assertEqual(sch
-00005090: 656d 612e 636f 6f72 6473 5f63 6f6d 7072  ema.coords_compr
-000050a0: 6573 736f 722c 2028 277a 7374 6427 2c20  essor, ('zstd', 
-000050b0: 3429 290a 2020 2020 2020 2020 2320 7365  4)).        # se
-000050c0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
-000050d0: 6368 656d 612e 6f66 6673 6574 735f 636f  chema.offsets_co
-000050e0: 6d70 7265 7373 6f72 2c20 2827 6c7a 3427  mpressor, ('lz4'
-000050f0: 2c20 3529 290a 0a20 2020 2020 2020 2073  , 5))..        s
-00005100: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005110: 7363 6865 6d61 2e64 6f6d 6169 6e2c 2064  schema.domain, d
-00005120: 6f6d 6169 6e29 0a20 2020 2020 2020 2073  omain).        s
-00005130: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005140: 7363 6865 6d61 2e6e 6469 6d2c 2032 290a  schema.ndim, 2).
-00005150: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00005160: 6572 7445 7175 616c 2873 6368 656d 612e  ertEqual(schema.
-00005170: 7368 6170 652c 2028 3130 3030 2c20 3939  shape, (1000, 99
-00005180: 3030 2929 0a20 2020 2020 2020 2073 656c  00)).        sel
-00005190: 662e 6173 7365 7274 4571 7561 6c28 7363  f.assertEqual(sc
-000051a0: 6865 6d61 2e6e 6174 7472 2c20 3229 0a20  hema.nattr, 2). 
-000051b0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-000051c0: 7274 4571 7561 6c28 7363 6865 6d61 2e61  rtEqual(schema.a
-000051d0: 7474 7228 3029 2c20 6131 290a 2020 2020  ttr(0), a1).    
-000051e0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-000051f0: 7175 616c 2873 6368 656d 612e 6174 7472  qual(schema.attr
-00005200: 2822 6132 2229 2c20 6132 290a 2020 2020  ("a2"), a2).    
-00005210: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005220: 7175 616c 2873 6368 656d 612e 616c 6c6f  qual(schema.allo
-00005230: 7773 5f64 7570 6c69 6361 7465 732c 2054  ws_duplicates, T
-00005240: 7275 6529 0a20 2020 2020 2020 2073 656c  rue).        sel
-00005250: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-00005260: 2020 2020 2020 2020 2020 2073 6368 656d             schem
-00005270: 612c 0a20 2020 2020 2020 2020 2020 2074  a,.            t
-00005280: 696c 6564 622e 4172 7261 7953 6368 656d  iledb.ArraySchem
-00005290: 6128 0a20 2020 2020 2020 2020 2020 2020  a(.             
-000052a0: 2020 2064 6f6d 6169 6e3d 646f 6d61 696e     domain=domain
-000052b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000052c0: 2020 6174 7472 733d 2861 312c 2061 3229    attrs=(a1, a2)
-000052d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000052e0: 2020 6361 7061 6369 7479 3d31 302c 0a20    capacity=10,. 
-000052f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00005300: 656c 6c5f 6f72 6465 723d 2263 6f6c 2d6d  ell_order="col-m
-00005310: 616a 6f72 222c 0a20 2020 2020 2020 2020  ajor",.         
-00005320: 2020 2020 2020 2074 696c 655f 6f72 6465         tile_orde
-00005330: 723d 2272 6f77 2d6d 616a 6f72 222c 0a20  r="row-major",. 
-00005340: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00005350: 6c6c 6f77 735f 6475 706c 6963 6174 6573  llows_duplicates
-00005360: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-00005370: 2020 2020 2020 2073 7061 7273 653d 5472         sparse=Tr
-00005380: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-00005390: 2020 2020 636f 6f72 6473 5f66 696c 7465      coords_filte
-000053a0: 7273 3d63 6f6f 7264 735f 6669 6c74 6572  rs=coords_filter
-000053b0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-000053c0: 2020 206f 6666 7365 7473 5f66 696c 7465     offsets_filte
-000053d0: 7273 3d6f 6666 7365 7473 5f66 696c 7465  rs=offsets_filte
-000053e0: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
-000053f0: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
-00005400: 2020 2020 2020 2320 7465 7374 2069 7465        # test ite
-00005410: 7261 7469 6f6e 206f 7665 7220 6174 7472  ration over attr
-00005420: 6962 7574 6573 0a20 2020 2020 2020 2073  ibutes.        s
-00005430: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00005440: 6c69 7374 2873 6368 656d 6129 2c20 5b61  list(schema), [a
-00005450: 312c 2061 325d 290a 0a20 2020 2020 2020  1, a2])..       
-00005460: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-00005470: 7452 6169 7365 7352 6567 6578 280a 2020  tRaisesRegex(.  
-00005480: 2020 2020 2020 2020 2020 7469 6c65 6462            tiledb
-00005490: 2e54 696c 6544 4245 7272 6f72 2c0a 2020  .TileDBError,.  
-000054a0: 2020 2020 2020 2020 2020 2243 616e 6e6f            "Canno
-000054b0: 7420 7365 7420 7469 6c65 206f 7264 6572  t set tile order
-000054c0: 3b20 4869 6c62 6572 7420 6f72 6465 7220  ; Hilbert order 
-000054d0: 6973 206e 6f74 2061 7070 6c69 6361 626c  is not applicabl
-000054e0: 6520 746f 2074 696c 6573 222c 0a20 2020  e to tiles",.   
-000054f0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-00005500: 2020 2020 7469 6c65 6462 2e41 7272 6179      tiledb.Array
-00005510: 5363 6865 6d61 280a 2020 2020 2020 2020  Schema(.        
-00005520: 2020 2020 2020 2020 646f 6d61 696e 3d64          domain=d
-00005530: 6f6d 6169 6e2c 2061 7474 7273 3d28 6131  omain, attrs=(a1
-00005540: 2c29 2c20 7370 6172 7365 3d54 7275 652c  ,), sparse=True,
-00005550: 2074 696c 655f 6f72 6465 723d 2268 696c   tile_order="hil
-00005560: 6265 7274 220a 2020 2020 2020 2020 2020  bert".          
-00005570: 2020 290a 0a20 2020 2064 6566 2074 6573    )..    def tes
-00005580: 745f 7370 6172 7365 5f73 6368 656d 615f  t_sparse_schema_
-00005590: 6669 6c74 6572 5f6c 6973 7428 7365 6c66  filter_list(self
-000055a0: 2c20 6361 7066 6429 3a0a 2020 2020 2020  , capfd):.      
-000055b0: 2020 2320 6372 6561 7465 2064 696d 656e    # create dimen
-000055c0: 7369 6f6e 730a 2020 2020 2020 2020 6431  sions.        d1
-000055d0: 203d 2074 696c 6564 622e 4469 6d28 2264   = tiledb.Dim("d
-000055e0: 3122 2c20 646f 6d61 696e 3d28 312c 2031  1", domain=(1, 1
-000055f0: 3030 3029 2c20 7469 6c65 3d31 302c 2064  000), tile=10, d
-00005600: 7479 7065 3d22 7569 6e74 3634 2229 0a20  type="uint64"). 
-00005610: 2020 2020 2020 2064 3220 3d20 7469 6c65         d2 = tile
-00005620: 6462 2e44 696d 2822 6432 222c 2064 6f6d  db.Dim("d2", dom
-00005630: 6169 6e3d 2831 3031 2c20 3130 3030 3029  ain=(101, 10000)
-00005640: 2c20 7469 6c65 3d31 3030 2c20 6474 7970  , tile=100, dtyp
-00005650: 653d 2275 696e 7436 3422 290a 0a20 2020  e="uint64")..   
-00005660: 2020 2020 2023 2063 7265 6174 6520 646f       # create do
-00005670: 6d61 696e 0a20 2020 2020 2020 2064 6f6d  main.        dom
-00005680: 6169 6e20 3d20 7469 6c65 6462 2e44 6f6d  ain = tiledb.Dom
-00005690: 6169 6e28 6431 2c20 6432 290a 0a20 2020  ain(d1, d2)..   
-000056a0: 2020 2020 2023 2063 7265 6174 6520 6174       # create at
-000056b0: 7472 6962 7574 6573 0a20 2020 2020 2020  tributes.       
-000056c0: 2061 3120 3d20 7469 6c65 6462 2e41 7474   a1 = tiledb.Att
-000056d0: 7228 2261 3122 2c20 6474 7970 653d 2269  r("a1", dtype="i
-000056e0: 6e74 3332 2c69 6e74 3332 2c69 6e74 3332  nt32,int32,int32
-000056f0: 2229 0a20 2020 2020 2020 2066 696c 7465  ").        filte
-00005700: 725f 6c69 7374 203d 2074 696c 6564 622e  r_list = tiledb.
-00005710: 4669 6c74 6572 4c69 7374 285b 7469 6c65  FilterList([tile
-00005720: 6462 2e47 7a69 7046 696c 7465 7228 295d  db.GzipFilter()]
-00005730: 290a 2020 2020 2020 2020 6132 203d 2074  ).        a2 = t
-00005740: 696c 6564 622e 4174 7472 2822 6132 222c  iledb.Attr("a2",
-00005750: 2066 696c 7465 7273 3d66 696c 7465 725f   filters=filter_
-00005760: 6c69 7374 2c20 6474 7970 653d 2266 6c6f  list, dtype="flo
-00005770: 6174 3332 2229 0a0a 2020 2020 2020 2020  at32")..        
-00005780: 6f66 665f 6669 6c74 6572 735f 7079 6c69  off_filters_pyli
-00005790: 7374 203d 205b 7469 6c65 6462 2e6c 6962  st = [tiledb.lib
-000057a0: 7469 6c65 6462 2e5a 7374 6446 696c 7465  tiledb.ZstdFilte
-000057b0: 7228 6c65 7665 6c3d 3130 295d 0a20 2020  r(level=10)].   
-000057c0: 2020 2020 206f 6666 5f66 696c 7465 7273       off_filters
-000057d0: 203d 2074 696c 6564 622e 6c69 6274 696c   = tiledb.libtil
-000057e0: 6564 622e 4669 6c74 6572 4c69 7374 280a  edb.FilterList(.
-000057f0: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-00005800: 6572 733d 6f66 665f 6669 6c74 6572 735f  ers=off_filters_
-00005810: 7079 6c69 7374 2c20 6368 756e 6b73 697a  pylist, chunksiz
-00005820: 653d 3230 3438 0a20 2020 2020 2020 2029  e=2048.        )
-00005830: 0a0a 2020 2020 2020 2020 636f 6f72 6473  ..        coords
-00005840: 5f66 696c 7465 7273 5f70 796c 6973 7420  _filters_pylist 
-00005850: 3d20 5b74 696c 6564 622e 6c69 6274 696c  = [tiledb.libtil
-00005860: 6564 622e 427a 6970 3246 696c 7465 7228  edb.Bzip2Filter(
-00005870: 6c65 7665 6c3d 3529 5d0a 2020 2020 2020  level=5)].      
-00005880: 2020 636f 6f72 6473 5f66 696c 7465 7273    coords_filters
-00005890: 203d 2074 696c 6564 622e 6c69 6274 696c   = tiledb.libtil
-000058a0: 6564 622e 4669 6c74 6572 4c69 7374 280a  edb.FilterList(.
-000058b0: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-000058c0: 6572 733d 636f 6f72 6473 5f66 696c 7465  ers=coords_filte
-000058d0: 7273 5f70 796c 6973 742c 2063 6875 6e6b  rs_pylist, chunk
-000058e0: 7369 7a65 3d34 3039 360a 2020 2020 2020  size=4096.      
-000058f0: 2020 290a 0a20 2020 2020 2020 2023 2063    )..        # c
-00005900: 7265 6174 6520 7370 6172 7365 2061 7272  reate sparse arr
-00005910: 6179 2077 6974 6820 7363 6865 6d61 0a20  ay with schema. 
-00005920: 2020 2020 2020 2073 6368 656d 6120 3d20         schema = 
-00005930: 7469 6c65 6462 2e41 7272 6179 5363 6865  tiledb.ArraySche
-00005940: 6d61 280a 2020 2020 2020 2020 2020 2020  ma(.            
-00005950: 646f 6d61 696e 3d64 6f6d 6169 6e2c 0a20  domain=domain,. 
-00005960: 2020 2020 2020 2020 2020 2061 7474 7273             attrs
-00005970: 3d28 6131 2c20 6132 292c 0a20 2020 2020  =(a1, a2),.     
-00005980: 2020 2020 2020 2063 6170 6163 6974 793d         capacity=
-00005990: 3130 2c0a 2020 2020 2020 2020 2020 2020  10,.            
-000059a0: 6365 6c6c 5f6f 7264 6572 3d22 636f 6c2d  cell_order="col-
-000059b0: 6d61 6a6f 7222 2c0a 2020 2020 2020 2020  major",.        
-000059c0: 2020 2020 7469 6c65 5f6f 7264 6572 3d22      tile_order="
-000059d0: 726f 772d 6d61 6a6f 7222 2c0a 2020 2020  row-major",.    
-000059e0: 2020 2020 2020 2020 636f 6f72 6473 5f66          coords_f
-000059f0: 696c 7465 7273 3d63 6f6f 7264 735f 6669  ilters=coords_fi
-00005a00: 6c74 6572 732c 0a20 2020 2020 2020 2020  lters,.         
-00005a10: 2020 206f 6666 7365 7473 5f66 696c 7465     offsets_filte
-00005a20: 7273 3d6f 6666 5f66 696c 7465 7273 2c0a  rs=off_filters,.
-00005a30: 2020 2020 2020 2020 2020 2020 7370 6172              spar
-00005a40: 7365 3d54 7275 652c 0a20 2020 2020 2020  se=True,.       
-00005a50: 2029 0a20 2020 2020 2020 2073 656c 662e   ).        self.
-00005a60: 6173 7365 7274 5472 7565 2873 6368 656d  assertTrue(schem
-00005a70: 612e 7370 6172 7365 290a 0a20 2020 2020  a.sparse)..     
-00005a80: 2020 2073 6368 656d 612e 6475 6d70 2829     schema.dump()
-00005a90: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
-00005aa0: 6361 7074 7572 6564 2863 6170 6664 2c20  captured(capfd, 
-00005ab0: 2241 7272 6179 2074 7970 653a 2073 7061  "Array type: spa
-00005ac0: 7273 6522 290a 0a20 2020 2020 2020 2023  rse")..        #
-00005ad0: 206d 616b 6520 7375 7265 2077 6520 6361   make sure we ca
-00005ae0: 6e20 636f 6e73 7472 7563 7420 4172 7261  n construct Arra
-00005af0: 7953 6368 656d 6120 7769 7468 2070 7974  ySchema with pyt
-00005b00: 686f 6e20 6c69 7374 7320 6f66 2066 696c  hon lists of fil
-00005b10: 7465 7273 0a20 2020 2020 2020 2073 6368  ters.        sch
-00005b20: 656d 6132 203d 2074 696c 6564 622e 4172  ema2 = tiledb.Ar
-00005b30: 7261 7953 6368 656d 6128 0a20 2020 2020  raySchema(.     
-00005b40: 2020 2020 2020 2064 6f6d 6169 6e3d 646f         domain=do
-00005b50: 6d61 696e 2c0a 2020 2020 2020 2020 2020  main,.          
-00005b60: 2020 6174 7472 733d 2861 312c 2061 3229    attrs=(a1, a2)
-00005b70: 2c0a 2020 2020 2020 2020 2020 2020 6361  ,.            ca
-00005b80: 7061 6369 7479 3d31 302c 0a20 2020 2020  pacity=10,.     
-00005b90: 2020 2020 2020 2063 656c 6c5f 6f72 6465         cell_orde
-00005ba0: 723d 2263 6f6c 2d6d 616a 6f72 222c 0a20  r="col-major",. 
-00005bb0: 2020 2020 2020 2020 2020 2074 696c 655f             tile_
-00005bc0: 6f72 6465 723d 2272 6f77 2d6d 616a 6f72  order="row-major
-00005bd0: 222c 0a20 2020 2020 2020 2020 2020 2063  ",.            c
-00005be0: 6f6f 7264 735f 6669 6c74 6572 733d 636f  oords_filters=co
-00005bf0: 6f72 6473 5f66 696c 7465 7273 5f70 796c  ords_filters_pyl
-00005c00: 6973 742c 0a20 2020 2020 2020 2020 2020  ist,.           
-00005c10: 206f 6666 7365 7473 5f66 696c 7465 7273   offsets_filters
-00005c20: 3d6f 6666 5f66 696c 7465 7273 2c0a 2020  =off_filters,.  
-00005c30: 2020 2020 2020 2020 2020 7370 6172 7365            sparse
-00005c40: 3d54 7275 652c 0a20 2020 2020 2020 2029  =True,.        )
-00005c50: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00005c60: 7365 7274 4571 7561 6c28 6c65 6e28 7363  sertEqual(len(sc
-00005c70: 6865 6d61 322e 636f 6f72 6473 5f66 696c  hema2.coords_fil
-00005c80: 7465 7273 292c 2031 290a 2020 2020 2020  ters), 1).      
-00005c90: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00005ca0: 616c 286c 656e 2873 6368 656d 6132 2e6f  al(len(schema2.o
-00005cb0: 6666 7365 7473 5f66 696c 7465 7273 292c  ffsets_filters),
-00005cc0: 2031 290a 0a20 2020 2064 6566 2074 6573   1)..    def tes
-00005cd0: 745f 6d69 7865 645f 7374 7269 6e67 5f73  t_mixed_string_s
-00005ce0: 6368 656d 6128 7365 6c66 293a 0a20 2020  chema(self):.   
-00005cf0: 2020 2020 2064 696d 7320 3d20 5b0a 2020       dims = [.  
-00005d00: 2020 2020 2020 2020 2020 7469 6c65 6462            tiledb
-00005d10: 2e44 696d 286e 616d 653d 2264 706f 7322  .Dim(name="dpos"
-00005d20: 2c20 646f 6d61 696e 3d28 2d31 3030 2e30  , domain=(-100.0
-00005d30: 2c20 3130 302e 3029 2c20 7469 6c65 3d31  , 100.0), tile=1
-00005d40: 302c 2064 7479 7065 3d6e 702e 666c 6f61  0, dtype=np.floa
-00005d50: 7436 3429 2c0a 2020 2020 2020 2020 2020  t64),.          
-00005d60: 2020 7469 6c65 6462 2e44 696d 280a 2020    tiledb.Dim(.  
-00005d70: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-00005d80: 6d65 3d22 7374 725f 696e 6465 7822 2c20  me="str_index", 
-00005d90: 646f 6d61 696e 3d28 4e6f 6e65 2c20 4e6f  domain=(None, No
-00005da0: 6e65 292c 2074 696c 653d 4e6f 6e65 2c20  ne), tile=None, 
-00005db0: 6474 7970 653d 6e70 2e62 7974 6573 5f0a  dtype=np.bytes_.
-00005dc0: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-00005dd0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00005de0: 2064 6f6d 203d 2074 696c 6564 622e 446f   dom = tiledb.Do
-00005df0: 6d61 696e 282a 6469 6d73 290a 2020 2020  main(*dims).    
-00005e00: 2020 2020 6174 7472 7320 3d20 5b74 696c      attrs = [til
-00005e10: 6564 622e 4174 7472 286e 616d 653d 2276  edb.Attr(name="v
-00005e20: 616c 222c 2064 7479 7065 3d6e 702e 666c  al", dtype=np.fl
-00005e30: 6f61 7436 3429 5d0a 0a20 2020 2020 2020  oat64)]..       
-00005e40: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
-00005e50: 2e41 7272 6179 5363 6865 6d61 2864 6f6d  .ArraySchema(dom
-00005e60: 6169 6e3d 646f 6d2c 2061 7474 7273 3d61  ain=dom, attrs=a
-00005e70: 7474 7273 2c20 7370 6172 7365 3d54 7275  ttrs, sparse=Tru
-00005e80: 6529 0a0a 2020 2020 2020 2020 7365 6c66  e)..        self
-00005e90: 2e61 7373 6572 7454 7275 6528 7363 6865  .assertTrue(sche
-00005ea0: 6d61 2e64 6f6d 6169 6e2e 6861 735f 6469  ma.domain.has_di
-00005eb0: 6d28 2273 7472 5f69 6e64 6578 2229 290a  m("str_index")).
-00005ec0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00005ed0: 6572 7446 616c 7365 2873 6368 656d 612e  ertFalse(schema.
-00005ee0: 646f 6d61 696e 2e68 6173 5f64 696d 2822  domain.has_dim("
-00005ef0: 6e6f 6e6f 6e6f 5f73 7472 5f69 6e64 6578  nonono_str_index
-00005f00: 2229 290a 2020 2020 2020 2020 7365 6c66  ")).        self
-00005f10: 2e61 7373 6572 7454 7275 6528 7363 6865  .assertTrue(sche
-00005f20: 6d61 2e64 6f6d 6169 6e2e 6469 6d28 2273  ma.domain.dim("s
-00005f30: 7472 5f69 6e64 6578 2229 2e69 7376 6172  tr_index").isvar
-00005f40: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00005f50: 7373 6572 7446 616c 7365 2873 6368 656d  ssertFalse(schem
-00005f60: 612e 646f 6d61 696e 2e64 696d 2822 6470  a.domain.dim("dp
-00005f70: 6f73 2229 2e69 7376 6172 290a 2020 2020  os").isvar).    
-00005f80: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00005f90: 7175 616c 2873 6368 656d 612e 646f 6d61  qual(schema.doma
-00005fa0: 696e 2e64 696d 2822 6470 6f73 2229 2e64  in.dim("dpos").d
-00005fb0: 7479 7065 2c20 6e70 2e64 6f75 626c 6529  type, np.double)
-00005fc0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-00005fd0: 7365 7274 4571 7561 6c28 7363 6865 6d61  sertEqual(schema
-00005fe0: 2e64 6f6d 6169 6e2e 6469 6d28 2273 7472  .domain.dim("str
-00005ff0: 5f69 6e64 6578 2229 2e64 7479 7065 2c20  _index").dtype, 
-00006000: 6e70 2e62 7974 6573 5f29 0a20 2020 2020  np.bytes_).     
-00006010: 2020 2073 656c 662e 6173 7365 7274 4661     self.assertFa
-00006020: 6c73 6528 7363 6865 6d61 2e64 6f6d 6169  lse(schema.domai
-00006030: 6e2e 686f 6d6f 6765 6e65 6f75 7329 0a0a  n.homogeneous)..
-00006040: 0a63 6c61 7373 2041 7272 6179 5465 7374  .class ArrayTest
-00006050: 2844 6973 6b54 6573 7443 6173 6529 3a0a  (DiskTestCase):.
-00006060: 2020 2020 6465 6620 6372 6561 7465 5f61      def create_a
-00006070: 7272 6179 5f73 6368 656d 6128 7365 6c66  rray_schema(self
-00006080: 293a 0a20 2020 2020 2020 2064 6f6d 6169  ):.        domai
-00006090: 6e20 3d20 7469 6c65 6462 2e44 6f6d 6169  n = tiledb.Domai
-000060a0: 6e28 0a20 2020 2020 2020 2020 2020 2074  n(.            t
-000060b0: 696c 6564 622e 4469 6d28 646f 6d61 696e  iledb.Dim(domain
-000060c0: 3d28 312c 2038 292c 2074 696c 653d 3229  =(1, 8), tile=2)
-000060d0: 2c20 7469 6c65 6462 2e44 696d 2864 6f6d  , tiledb.Dim(dom
-000060e0: 6169 6e3d 2831 2c20 3829 2c20 7469 6c65  ain=(1, 8), tile
-000060f0: 3d32 290a 2020 2020 2020 2020 290a 2020  =2).        ).  
-00006100: 2020 2020 2020 6131 203d 2074 696c 6564        a1 = tiled
-00006110: 622e 4174 7472 2822 7661 6c22 2c20 6474  b.Attr("val", dt
-00006120: 7970 653d 2266 3822 290a 2020 2020 2020  ype="f8").      
-00006130: 2020 7265 7475 726e 2074 696c 6564 622e    return tiledb.
-00006140: 4172 7261 7953 6368 656d 6128 646f 6d61  ArraySchema(doma
-00006150: 696e 3d64 6f6d 6169 6e2c 2061 7474 7273  in=domain, attrs
-00006160: 3d28 6131 2c29 290a 0a20 2020 2064 6566  =(a1,))..    def
-00006170: 2074 6573 745f 6172 7261 795f 6372 6561   test_array_crea
-00006180: 7465 2873 656c 6629 3a0a 2020 2020 2020  te(self):.      
-00006190: 2020 636f 6e66 6967 203d 2074 696c 6564    config = tiled
-000061a0: 622e 436f 6e66 6967 2829 0a20 2020 2020  b.Config().     
-000061b0: 2020 2063 6f6e 6669 675b 2273 6d2e 636f     config["sm.co
-000061c0: 6e73 6f6c 6964 6174 696f 6e2e 7374 6570  nsolidation.step
-000061d0: 5f6d 696e 5f66 7261 6722 5d20 3d20 300a  _min_frag"] = 0.
-000061e0: 2020 2020 2020 2020 636f 6e66 6967 5b22          config["
-000061f0: 736d 2e63 6f6e 736f 6c69 6461 7469 6f6e  sm.consolidation
-00006200: 2e73 7465 7073 225d 203d 2031 0a20 2020  .steps"] = 1.   
-00006210: 2020 2020 2073 6368 656d 6120 3d20 7365       schema = se
-00006220: 6c66 2e63 7265 6174 655f 6172 7261 795f  lf.create_array_
-00006230: 7363 6865 6d61 2829 0a0a 2020 2020 2020  schema()..      
-00006240: 2020 2320 7065 7273 6973 7420 6172 7261    # persist arra
-00006250: 7920 7363 6865 6d61 0a20 2020 2020 2020  y schema.       
-00006260: 2074 696c 6564 622e 6c69 6274 696c 6564   tiledb.libtiled
-00006270: 622e 4172 7261 792e 6372 6561 7465 2873  b.Array.create(s
-00006280: 656c 662e 7061 7468 2822 666f 6f22 292c  elf.path("foo"),
-00006290: 2073 6368 656d 6129 0a0a 2020 2020 2020   schema)..      
-000062a0: 2020 2320 7468 6573 6520 7368 6f75 6c64    # these should
-000062b0: 2062 6520 6e6f 2d6f 7073 0a20 2020 2020   be no-ops.     
-000062c0: 2020 2023 2020 2066 756c 6c20 7369 676e     #   full sign
-000062d0: 6174 7572 650a 2020 2020 2020 2020 7469  ature.        ti
-000062e0: 6c65 6462 2e63 6f6e 736f 6c69 6461 7465  ledb.consolidate
-000062f0: 2873 656c 662e 7061 7468 2822 666f 6f22  (self.path("foo"
-00006300: 292c 2063 6f6e 6669 673d 636f 6e66 6967  ), config=config
-00006310: 290a 2020 2020 2020 2020 2320 2020 6b77  ).        #   kw
-00006320: 2073 6967 6e61 7475 7265 0a20 2020 2020   signature.     
-00006330: 2020 2074 696c 6564 622e 636f 6e73 6f6c     tiledb.consol
-00006340: 6964 6174 6528 7572 693d 7365 6c66 2e70  idate(uri=self.p
-00006350: 6174 6828 2266 6f6f 2229 290a 0a20 2020  ath("foo"))..   
-00006360: 2020 2020 2023 206c 6f61 6420 6172 7261       # load arra
-00006370: 7920 696e 2072 6561 646f 6e6c 7920 6d6f  y in readonly mo
-00006380: 6465 0a20 2020 2020 2020 2061 7272 6179  de.        array
-00006390: 203d 2074 696c 6564 622e 6c69 6274 696c   = tiledb.libtil
-000063a0: 6564 622e 4172 7261 7928 7365 6c66 2e70  edb.Array(self.p
-000063b0: 6174 6828 2266 6f6f 2229 2c20 6d6f 6465  ath("foo"), mode
-000063c0: 3d22 7222 290a 2020 2020 2020 2020 7365  ="r").        se
-000063d0: 6c66 2e61 7373 6572 7454 7275 6528 6172  lf.assertTrue(ar
-000063e0: 7261 792e 6973 6f70 656e 290a 2020 2020  ray.isopen).    
-000063f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00006400: 7175 616c 2861 7272 6179 2e73 6368 656d  qual(array.schem
-00006410: 612c 2073 6368 656d 6129 0a20 2020 2020  a, schema).     
-00006420: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00006430: 7561 6c28 6172 7261 792e 6d6f 6465 2c20  ual(array.mode, 
-00006440: 2272 2229 0a20 2020 2020 2020 2073 656c  "r").        sel
-00006450: 662e 6173 7365 7274 4571 7561 6c28 6172  f.assertEqual(ar
-00006460: 7261 792e 7572 692c 2073 656c 662e 7061  ray.uri, self.pa
-00006470: 7468 2822 666f 6f22 2929 0a0a 2020 2020  th("foo"))..    
-00006480: 2020 2020 2320 7465 7374 2074 6861 7420      # test that 
-00006490: 7765 2063 616e 6e6f 7420 636f 6e73 6f6c  we cannot consol
-000064a0: 6964 6174 6520 616e 2061 7272 6179 2069  idate an array i
-000064b0: 6e20 7265 6164 6f6e 6c79 206d 6f64 650a  n readonly mode.
-000064c0: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-000064d0: 662e 6173 7365 7274 5261 6973 6573 2874  f.assertRaises(t
-000064e0: 696c 6564 622e 5469 6c65 4442 4572 726f  iledb.TileDBErro
-000064f0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00006500: 6172 7261 792e 636f 6e73 6f6c 6964 6174  array.consolidat
-00006510: 6528 290a 0a20 2020 2020 2020 2023 2077  e()..        # w
-00006520: 6520 6861 7665 206e 6f74 2077 7269 7474  e have not writt
-00006530: 656e 2061 6e79 7468 696e 672c 2073 6f20  en anything, so 
-00006540: 7468 6520 6172 7261 7920 6973 2065 6d70  the array is emp
-00006550: 7479 0a20 2020 2020 2020 2073 656c 662e  ty.        self.
-00006560: 6173 7365 7274 4973 4e6f 6e65 2861 7272  assertIsNone(arr
-00006570: 6179 2e6e 6f6e 656d 7074 795f 646f 6d61  ay.nonempty_doma
-00006580: 696e 2829 290a 0a20 2020 2020 2020 2061  in())..        a
-00006590: 7272 6179 2e72 656f 7065 6e28 290a 2020  rray.reopen().  
-000065a0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000065b0: 7454 7275 6528 6172 7261 792e 6973 6f70  tTrue(array.isop
-000065c0: 656e 290a 0a20 2020 2020 2020 2061 7272  en)..        arr
-000065d0: 6179 2e63 6c6f 7365 2829 0a20 2020 2020  ay.close().     
-000065e0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000065f0: 7561 6c28 6172 7261 792e 6973 6f70 656e  ual(array.isopen
-00006600: 2c20 4661 6c73 6529 0a0a 2020 2020 2020  , False)..      
-00006610: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-00006620: 7274 5261 6973 6573 2874 696c 6564 622e  rtRaises(tiledb.
-00006630: 5469 6c65 4442 4572 726f 7229 3a0a 2020  TileDBError):.  
-00006640: 2020 2020 2020 2020 2020 2320 6361 6e6e            # cann
-00006650: 6f74 2067 6574 2073 6368 656d 6120 6672  ot get schema fr
-00006660: 6f6d 2063 6c6f 7365 6420 6172 7261 790a  om closed array.
-00006670: 2020 2020 2020 2020 2020 2020 6172 7261              arra
-00006680: 792e 7363 6865 6d61 0a0a 2020 2020 2020  y.schema..      
-00006690: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-000066a0: 7274 5261 6973 6573 2874 696c 6564 622e  rtRaises(tiledb.
-000066b0: 5469 6c65 4442 4572 726f 7229 3a0a 2020  TileDBError):.  
-000066c0: 2020 2020 2020 2020 2020 2320 6361 6e6e            # cann
-000066d0: 6f74 2072 652d 6f70 656e 2061 2063 6c6f  ot re-open a clo
-000066e0: 7365 6420 6172 7261 790a 2020 2020 2020  sed array.      
-000066f0: 2020 2020 2020 6172 7261 792e 7265 6f70        array.reop
-00006700: 656e 2829 0a0a 2020 2020 6465 6620 7465  en()..    def te
-00006710: 7374 5f61 7272 6179 5f63 7265 6174 655f  st_array_create_
-00006720: 7769 7468 5f63 7478 2873 656c 6629 3a0a  with_ctx(self):.
-00006730: 2020 2020 2020 2020 7363 6865 6d61 203d          schema =
-00006740: 2073 656c 662e 6372 6561 7465 5f61 7272   self.create_arr
-00006750: 6179 5f73 6368 656d 6128 290a 0a20 2020  ay_schema()..   
-00006760: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
-00006770: 7373 6572 7452 6169 7365 7328 5479 7065  ssertRaises(Type
-00006780: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-00006790: 2020 2020 7469 6c65 6462 2e6c 6962 7469      tiledb.libti
-000067a0: 6c65 6462 2e41 7272 6179 2e63 7265 6174  ledb.Array.creat
-000067b0: 6528 7365 6c66 2e70 6174 6828 2266 6f6f  e(self.path("foo
-000067c0: 2229 2c20 7363 6865 6d61 2c20 6374 783d  "), schema, ctx=
-000067d0: 2266 6f6f 2229 0a0a 2020 2020 2020 2020  "foo")..        
-000067e0: 2320 7065 7273 6973 7420 6172 7261 7920  # persist array 
-000067f0: 7363 6865 6d61 0a20 2020 2020 2020 2074  schema.        t
-00006800: 696c 6564 622e 6c69 6274 696c 6564 622e  iledb.libtiledb.
-00006810: 4172 7261 792e 6372 6561 7465 2873 656c  Array.create(sel
-00006820: 662e 7061 7468 2822 666f 6f22 292c 2073  f.path("foo"), s
-00006830: 6368 656d 612c 2063 7478 3d74 696c 6564  chema, ctx=tiled
-00006840: 622e 4374 7828 2929 0a0a 2020 2020 4070  b.Ctx())..    @p
-00006850: 7974 6573 742e 6d61 726b 2e73 6b69 7069  ytest.mark.skipi
-00006860: 6628 0a20 2020 2020 2020 206e 6f74 2028  f(.        not (
-00006870: 7379 732e 706c 6174 666f 726d 203d 3d20  sys.platform == 
-00006880: 2277 696e 3332 2220 616e 6420 7469 6c65  "win32" and tile
-00006890: 6462 2e6c 6962 7469 6c65 6462 2e76 6572  db.libtiledb.ver
-000068a0: 7369 6f6e 2829 203e 3d20 2832 2c20 332c  sion() >= (2, 3,
-000068b0: 2030 2929 2c0a 2020 2020 2020 2020 7265   0)),.        re
-000068c0: 6173 6f6e 3d22 5368 6172 6564 206e 6574  ason="Shared net
-000068d0: 776f 726b 2064 7269 7665 206f 6e6c 7920  work drive only 
-000068e0: 6f6e 2057 696e 3332 222c 0a20 2020 2029  on Win32",.    )
-000068f0: 0a20 2020 2064 6566 2074 6573 745f 6172  .    def test_ar
-00006900: 7261 795f 6372 6561 7465 5f6f 6e5f 7368  ray_create_on_sh
-00006910: 6172 6564 5f64 7269 7665 2873 656c 6629  ared_drive(self)
-00006920: 3a0a 2020 2020 2020 2020 7363 6865 6d61  :.        schema
-00006930: 203d 2073 656c 662e 6372 6561 7465 5f61   = self.create_a
-00006940: 7272 6179 5f73 6368 656d 6128 290a 2020  rray_schema().  
-00006950: 2020 2020 2020 7572 6920 3d20 7365 6c66        uri = self
-00006960: 2e70 6174 6828 6261 7365 6e61 6d65 3d22  .path(basename="
-00006970: 666f 6f22 2c20 7368 6172 6564 3d54 7275  foo", shared=Tru
-00006980: 6529 0a0a 2020 2020 2020 2020 7469 6c65  e)..        tile
-00006990: 6462 2e6c 6962 7469 6c65 6462 2e41 7272  db.libtiledb.Arr
-000069a0: 6179 2e63 7265 6174 6528 7572 692c 2073  ay.create(uri, s
-000069b0: 6368 656d 6129 0a0a 2020 2020 2020 2020  chema)..        
-000069c0: 2320 6c6f 6164 2061 7272 6179 2069 6e20  # load array in 
-000069d0: 7265 6164 6f6e 6c79 206d 6f64 650a 2020  readonly mode.  
-000069e0: 2020 2020 2020 6172 7261 7920 3d20 7469        array = ti
-000069f0: 6c65 6462 2e6c 6962 7469 6c65 6462 2e41  ledb.libtiledb.A
-00006a00: 7272 6179 2875 7269 2c20 6d6f 6465 3d22  rray(uri, mode="
-00006a10: 7222 290a 2020 2020 2020 2020 7365 6c66  r").        self
-00006a20: 2e61 7373 6572 7454 7275 6528 6172 7261  .assertTrue(arra
-00006a30: 792e 6973 6f70 656e 290a 2020 2020 2020  y.isopen).      
-00006a40: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00006a50: 616c 2861 7272 6179 2e73 6368 656d 612c  al(array.schema,
-00006a60: 2073 6368 656d 6129 0a20 2020 2020 2020   schema).       
-00006a70: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00006a80: 6c28 6172 7261 792e 6d6f 6465 2c20 2272  l(array.mode, "r
-00006a90: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-00006aa0: 6173 7365 7274 4571 7561 6c28 6172 7261  assertEqual(arra
-00006ab0: 792e 7572 692c 2075 7269 290a 0a20 2020  y.uri, uri)..   
-00006ac0: 2020 2020 2023 2077 6520 6861 7665 206e       # we have n
-00006ad0: 6f74 2077 7269 7474 656e 2061 6e79 7468  ot written anyth
-00006ae0: 696e 672c 2073 6f20 7468 6520 6172 7261  ing, so the arra
-00006af0: 7920 6973 2065 6d70 7479 0a20 2020 2020  y is empty.     
-00006b00: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
-00006b10: 4e6f 6e65 2861 7272 6179 2e6e 6f6e 656d  None(array.nonem
-00006b20: 7074 795f 646f 6d61 696e 2829 290a 0a20  pty_domain()).. 
-00006b30: 2020 2020 2020 2061 7272 6179 2e72 656f         array.reo
-00006b40: 7065 6e28 290a 2020 2020 2020 2020 7365  pen().        se
-00006b50: 6c66 2e61 7373 6572 7454 7275 6528 6172  lf.assertTrue(ar
-00006b60: 7261 792e 6973 6f70 656e 290a 0a20 2020  ray.isopen)..   
-00006b70: 2020 2020 2061 7272 6179 2e63 6c6f 7365       array.close
-00006b80: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-00006b90: 6173 7365 7274 4571 7561 6c28 6172 7261  assertEqual(arra
-00006ba0: 792e 6973 6f70 656e 2c20 4661 6c73 6529  y.isopen, False)
-00006bb0: 0a0a 2020 2020 2020 2020 7769 7468 2073  ..        with s
-00006bc0: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-00006bd0: 2874 696c 6564 622e 5469 6c65 4442 4572  (tiledb.TileDBEr
-00006be0: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
-00006bf0: 2020 2320 6361 6e6e 6f74 2067 6574 2073    # cannot get s
-00006c00: 6368 656d 6120 6672 6f6d 2063 6c6f 7365  chema from close
-00006c10: 6420 6172 7261 790a 2020 2020 2020 2020  d array.        
-00006c20: 2020 2020 6172 7261 792e 7363 6865 6d61      array.schema
-00006c30: 0a0a 2020 2020 2020 2020 7769 7468 2073  ..        with s
-00006c40: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-00006c50: 2874 696c 6564 622e 5469 6c65 4442 4572  (tiledb.TileDBEr
-00006c60: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
-00006c70: 2020 2320 6361 6e6e 6f74 2072 652d 6f70    # cannot re-op
-00006c80: 656e 2061 2063 6c6f 7365 6420 6172 7261  en a closed arra
-00006c90: 790a 2020 2020 2020 2020 2020 2020 6172  y.            ar
-00006ca0: 7261 792e 7265 6f70 656e 2829 0a0a 2020  ray.reopen()..  
-00006cb0: 2020 6465 6620 7465 7374 5f61 7272 6179    def test_array
-00006cc0: 5f63 7265 6174 655f 656e 6372 7970 7465  _create_encrypte
-00006cd0: 6428 7365 6c66 293a 0a20 2020 2020 2020  d(self):.       
-00006ce0: 2063 6f6e 6669 6720 3d20 7469 6c65 6462   config = tiledb
-00006cf0: 2e43 6f6e 6669 6728 290a 2020 2020 2020  .Config().      
-00006d00: 2020 636f 6e66 6967 5b22 736d 2e63 6f6e    config["sm.con
-00006d10: 736f 6c69 6461 7469 6f6e 2e73 7465 705f  solidation.step_
-00006d20: 6d69 6e5f 6672 6167 7322 5d20 3d20 300a  min_frags"] = 0.
-00006d30: 2020 2020 2020 2020 636f 6e66 6967 5b22          config["
-00006d40: 736d 2e63 6f6e 736f 6c69 6461 7469 6f6e  sm.consolidation
-00006d50: 2e73 7465 7073 225d 203d 2031 0a20 2020  .steps"] = 1.   
-00006d60: 2020 2020 2073 6368 656d 6120 3d20 7365       schema = se
-00006d70: 6c66 2e63 7265 6174 655f 6172 7261 795f  lf.create_array_
-00006d80: 7363 6865 6d61 2829 0a20 2020 2020 2020  schema().       
-00006d90: 2023 2070 6572 7369 7374 2061 7272 6179   # persist array
-00006da0: 2073 6368 656d 610a 2020 2020 2020 2020   schema.        
-00006db0: 7469 6c65 6462 2e6c 6962 7469 6c65 6462  tiledb.libtiledb
-00006dc0: 2e41 7272 6179 2e63 7265 6174 6528 0a20  .Array.create(. 
-00006dd0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006de0: 7061 7468 2822 666f 6f22 292c 2073 6368  path("foo"), sch
-00006df0: 656d 612c 206b 6579 3d62 2230 3132 3334  ema, key=b"01234
-00006e00: 3536 3738 3961 6263 6465 4630 3132 3334  56789abcdeF01234
-00006e10: 3536 3738 3961 6263 6465 4622 0a20 2020  56789abcdeF".   
-00006e20: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00006e30: 2320 6368 6563 6b20 7468 6174 2077 6520  # check that we 
-00006e40: 6361 6e20 6f70 656e 2074 6865 2061 7272  can open the arr
-00006e50: 6179 2073 7563 6573 7366 756c 6c79 0a20  ay sucessfully. 
-00006e60: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
-00006e70: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
-00006e80: 6222 3031 3233 3435 3637 3839 6162 6364  b"0123456789abcd
-00006e90: 6546 3031 3233 3435 3637 3839 6162 6364  eF0123456789abcd
-00006ea0: 6546 222c 0a20 2020 2020 2020 2020 2020  eF",.           
-00006eb0: 2022 3031 3233 3435 3637 3839 6162 6364   "0123456789abcd
-00006ec0: 6546 3031 3233 3435 3637 3839 6162 6364  eF0123456789abcd
-00006ed0: 6546 222c 0a20 2020 2020 2020 2029 3a0a  eF",.        ):.
-00006ee0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00006ef0: 2074 696c 6564 622e 6c69 6274 696c 6564   tiledb.libtiled
-00006f00: 622e 4172 7261 7928 7365 6c66 2e70 6174  b.Array(self.pat
-00006f10: 6828 2266 6f6f 2229 2c20 6d6f 6465 3d22  h("foo"), mode="
-00006f20: 7222 2c20 6b65 793d 6b65 7929 2061 7320  r", key=key) as 
-00006f30: 6172 7261 793a 0a20 2020 2020 2020 2020  array:.         
-00006f40: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00006f50: 7274 5472 7565 2861 7272 6179 2e69 736f  rtTrue(array.iso
-00006f60: 7065 6e29 0a20 2020 2020 2020 2020 2020  pen).           
-00006f70: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00006f80: 4571 7561 6c28 6172 7261 792e 7363 6865  Equal(array.sche
-00006f90: 6d61 2c20 7363 6865 6d61 290a 2020 2020  ma, schema).    
-00006fa0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006fb0: 2e61 7373 6572 7445 7175 616c 2861 7272  .assertEqual(arr
-00006fc0: 6179 2e6d 6f64 652c 2022 7222 290a 2020  ay.mode, "r").  
-00006fd0: 2020 2020 2020 2020 2020 7769 7468 2074            with t
-00006fe0: 696c 6564 622e 6f70 656e 2873 656c 662e  iledb.open(self.
-00006ff0: 7061 7468 2822 666f 6f22 292c 206d 6f64  path("foo"), mod
-00007000: 653d 2272 222c 206b 6579 3d6b 6579 2920  e="r", key=key) 
-00007010: 6173 2061 7272 6179 3a0a 2020 2020 2020  as array:.      
-00007020: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00007030: 7373 6572 7454 7275 6528 6172 7261 792e  ssertTrue(array.
-00007040: 6973 6f70 656e 290a 2020 2020 2020 2020  isopen).        
-00007050: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00007060: 6572 7445 7175 616c 2861 7272 6179 2e73  ertEqual(array.s
-00007070: 6368 656d 612c 2073 6368 656d 6129 0a20  chema, schema). 
-00007080: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00007090: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-000070a0: 6172 7261 792e 6d6f 6465 2c20 2272 2229  array.mode, "r")
-000070b0: 0a0a 2020 2020 2020 2020 2020 2020 7469  ..            ti
-000070c0: 6c65 6462 2e63 6f6e 736f 6c69 6461 7465  ledb.consolidate
-000070d0: 2875 7269 3d73 656c 662e 7061 7468 2822  (uri=self.path("
-000070e0: 666f 6f22 292c 2063 6f6e 6669 673d 636f  foo"), config=co
-000070f0: 6e66 6967 2c20 6b65 793d 6b65 7929 0a0a  nfig, key=key)..
-00007100: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
-00007110: 7468 6174 206f 7065 6e69 6e67 2074 6865  that opening the
-00007120: 2061 7272 6179 2077 6974 6820 7468 6520   array with the 
-00007130: 7772 6f6e 6720 6b65 7920 6661 696c 733a  wrong key fails:
-00007140: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
-00007150: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
-00007160: 7469 6c65 6462 2e54 696c 6544 4245 7272  tiledb.TileDBErr
-00007170: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-00007180: 2074 696c 6564 622e 6c69 6274 696c 6564   tiledb.libtiled
-00007190: 622e 4172 7261 7928 0a20 2020 2020 2020  b.Array(.       
-000071a0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-000071b0: 7468 2822 666f 6f22 292c 206d 6f64 653d  th("foo"), mode=
-000071c0: 2272 222c 206b 6579 3d62 2230 3132 3334  "r", key=b"01234
-000071d0: 3536 3738 3961 6263 6465 4630 3132 3334  56789abcdeF01234
-000071e0: 3536 3738 3961 6263 6465 5822 0a20 2020  56789abcdeX".   
-000071f0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00007200: 2020 2020 2320 6368 6563 6b20 7468 6174      # check that
-00007210: 206f 7065 6e69 6e67 2074 6865 2061 7272   opening the arr
-00007220: 6179 2077 6974 6820 7468 6520 7772 6f6e  ay with the wron
-00007230: 6720 6b65 7920 6c65 6e67 7468 2066 6169  g key length fai
-00007240: 6c73 3a0a 2020 2020 2020 2020 7769 7468  ls:.        with
-00007250: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-00007260: 6573 2874 696c 6564 622e 5469 6c65 4442  es(tiledb.TileDB
-00007270: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-00007280: 2020 2020 7469 6c65 6462 2e6c 6962 7469      tiledb.libti
-00007290: 6c65 6462 2e41 7272 6179 280a 2020 2020  ledb.Array(.    
-000072a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000072b0: 2e70 6174 6828 2266 6f6f 2229 2c20 6d6f  .path("foo"), mo
-000072c0: 6465 3d22 7222 2c20 6b65 793d 6222 3031  de="r", key=b"01
-000072d0: 3233 3435 3637 3839 6162 6364 6546 3031  23456789abcdeF01
-000072e0: 3233 3435 3637 3839 6162 6364 6522 0a20  23456789abcde". 
-000072f0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00007300: 2020 2020 2020 2320 6368 6563 6b20 7468        # check th
-00007310: 6174 2063 6f6e 736f 6c69 6461 7469 6e67  at consolidating
-00007320: 2074 6865 2061 7272 6179 2077 6974 6820   the array with 
-00007330: 7468 6520 7772 6f6e 6720 6b65 7920 6661  the wrong key fa
-00007340: 696c 733a 0a20 2020 2020 2020 2077 6974  ils:.        wit
-00007350: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
-00007360: 7365 7328 7469 6c65 6462 2e54 696c 6544  ses(tiledb.TileD
-00007370: 4245 7272 6f72 293a 0a20 2020 2020 2020  BError):.       
-00007380: 2020 2020 2074 696c 6564 622e 636f 6e73       tiledb.cons
-00007390: 6f6c 6964 6174 6528 0a20 2020 2020 2020  olidate(.       
-000073a0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-000073b0: 7468 2822 666f 6f22 292c 2063 6f6e 6669  th("foo"), confi
-000073c0: 673d 636f 6e66 6967 2c20 6b65 793d 6222  g=config, key=b"
-000073d0: 3031 3233 3435 3637 3839 6162 6364 6546  0123456789abcdeF
-000073e0: 3031 3233 3435 3637 3839 6162 6364 6522  0123456789abcde"
-000073f0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00007400: 2020 2020 2320 6e65 6564 7320 636f 7265      # needs core
-00007410: 2066 6978 2069 6e20 322e 322e 340a 2020   fix in 2.2.4.  
-00007420: 2020 4070 7974 6573 742e 6d61 726b 2e73    @pytest.mark.s
-00007430: 6b69 7069 6628 0a20 2020 2020 2020 2028  kipif(.        (
-00007440: 7379 732e 706c 6174 666f 726d 203d 3d20  sys.platform == 
-00007450: 2277 696e 3332 2220 616e 6420 7469 6c65  "win32" and tile
-00007460: 6462 2e6c 6962 7469 6c65 6462 2e76 6572  db.libtiledb.ver
-00007470: 7369 6f6e 2829 203d 3d20 2832 2c20 322c  sion() == (2, 2,
-00007480: 2033 2929 2c0a 2020 2020 2020 2020 7265   3)),.        re
-00007490: 6173 6f6e 3d22 536b 6970 2061 7272 6179  ason="Skip array
-000074a0: 5f64 6f65 736e 745f 6578 6973 7420 7465  _doesnt_exist te
-000074b0: 7374 206f 6e20 5769 6e33 3220 2f20 6c69  st on Win32 / li
-000074c0: 6274 696c 6564 6220 322e 322e 3322 2c0a  btiledb 2.2.3",.
-000074d0: 2020 2020 290a 2020 2020 6465 6620 7465      ).    def te
-000074e0: 7374 5f61 7272 6179 5f64 6f65 736e 745f  st_array_doesnt_
-000074f0: 6578 6973 7428 7365 6c66 293a 0a20 2020  exist(self):.   
-00007500: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
-00007510: 7373 6572 7452 6169 7365 7328 7469 6c65  ssertRaises(tile
-00007520: 6462 2e54 696c 6544 4245 7272 6f72 293a  db.TileDBError):
-00007530: 0a20 2020 2020 2020 2020 2020 2074 696c  .            til
-00007540: 6564 622e 6c69 6274 696c 6564 622e 4172  edb.libtiledb.Ar
-00007550: 7261 7928 7365 6c66 2e70 6174 6828 2266  ray(self.path("f
-00007560: 6f6f 2229 2c20 6d6f 6465 3d22 7222 290a  oo"), mode="r").
-00007570: 0a20 2020 2064 6566 2074 6573 745f 6372  .    def test_cr
-00007580: 6561 7465 5f73 6368 656d 615f 6d61 7463  eate_schema_matc
-00007590: 6865 7328 7365 6c66 293a 0a20 2020 2020  hes(self):.     
-000075a0: 2020 2064 696d 7320 3d20 2874 696c 6564     dims = (tiled
-000075b0: 622e 4469 6d28 646f 6d61 696e 3d28 302c  b.Dim(domain=(0,
-000075c0: 2036 292c 2074 696c 653d 3229 2c29 0a20   6), tile=2),). 
-000075d0: 2020 2020 2020 2064 6f6d 203d 2074 696c         dom = til
-000075e0: 6564 622e 446f 6d61 696e 282a 6469 6d73  edb.Domain(*dims
-000075f0: 290a 2020 2020 2020 2020 6174 7420 3d20  ).        att = 
-00007600: 7469 6c65 6462 2e41 7474 7228 6474 7970  tiledb.Attr(dtyp
-00007610: 653d 6e70 2e62 7974 6529 0a0a 2020 2020  e=np.byte)..    
-00007620: 2020 2020 7363 6865 6d61 203d 2074 696c      schema = til
-00007630: 6564 622e 4172 7261 7953 6368 656d 6128  edb.ArraySchema(
-00007640: 646f 6d61 696e 3d64 6f6d 2c20 6174 7472  domain=dom, attr
-00007650: 733d 2861 7474 2c29 2c20 7370 6172 7365  s=(att,), sparse
-00007660: 3d54 7275 6529 0a20 2020 2020 2020 2075  =True).        u
-00007670: 7269 203d 2073 656c 662e 7061 7468 2822  ri = self.path("
-00007680: 7331 2229 0a20 2020 2020 2020 2077 6974  s1").        wit
-00007690: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
-000076a0: 7365 7328 5661 6c75 6545 7272 6f72 293a  ses(ValueError):
-000076b0: 0a20 2020 2020 2020 2020 2020 2074 696c  .            til
-000076c0: 6564 622e 4465 6e73 6541 7272 6179 2e63  edb.DenseArray.c
-000076d0: 7265 6174 6528 7572 692c 2073 6368 656d  reate(uri, schem
-000076e0: 6129 0a0a 2020 2020 2020 2020 6465 6e73  a)..        dens
-000076f0: 655f 7363 6865 6d61 203d 2074 696c 6564  e_schema = tiled
-00007700: 622e 4172 7261 7953 6368 656d 6128 646f  b.ArraySchema(do
-00007710: 6d61 696e 3d64 6f6d 2c20 6174 7472 733d  main=dom, attrs=
-00007720: 2861 7474 2c29 290a 2020 2020 2020 2020  (att,)).        
-00007730: 7572 6920 3d20 7365 6c66 2e70 6174 6828  uri = self.path(
-00007740: 2264 3122 290a 2020 2020 2020 2020 7769  "d1").        wi
-00007750: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
-00007760: 6973 6573 2856 616c 7565 4572 726f 7229  ises(ValueError)
-00007770: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
-00007780: 6c65 6462 2e53 7061 7273 6541 7272 6179  ledb.SparseArray
-00007790: 2e63 7265 6174 6528 7572 692c 2064 656e  .create(uri, den
-000077a0: 7365 5f73 6368 656d 6129 0a0a 2020 2020  se_schema)..    
-000077b0: 2020 2020 636c 6173 7320 4d79 5370 6172      class MySpar
-000077c0: 7365 4172 7261 7928 7469 6c65 6462 2e53  seArray(tiledb.S
-000077d0: 7061 7273 6541 7272 6179 293a 0a20 2020  parseArray):.   
-000077e0: 2020 2020 2020 2020 2070 6173 730a 0a20           pass.. 
-000077f0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-00007800: 2e61 7373 6572 7452 6169 7365 7328 5661  .assertRaises(Va
-00007810: 6c75 6545 7272 6f72 293a 0a20 2020 2020  lueError):.     
-00007820: 2020 2020 2020 204d 7953 7061 7273 6541         MySparseA
-00007830: 7272 6179 2e63 7265 6174 6528 7572 692c  rray.create(uri,
-00007840: 2064 656e 7365 5f73 6368 656d 6129 0a0a   dense_schema)..
-00007850: 0a63 6c61 7373 2044 656e 7365 4172 7261  .class DenseArra
-00007860: 7954 6573 7428 4469 736b 5465 7374 4361  yTest(DiskTestCa
-00007870: 7365 293a 0a20 2020 2064 6566 2074 6573  se):.    def tes
-00007880: 745f 6172 7261 795f 3164 2873 656c 6629  t_array_1d(self)
-00007890: 3a0a 2020 2020 2020 2020 4120 3d20 6e70  :.        A = np
-000078a0: 2e61 7261 6e67 6528 3130 3530 290a 0a20  .arange(1050).. 
-000078b0: 2020 2020 2020 2064 6f6d 203d 2074 696c         dom = til
-000078c0: 6564 622e 446f 6d61 696e 2874 696c 6564  edb.Domain(tiled
-000078d0: 622e 4469 6d28 646f 6d61 696e 3d28 302c  b.Dim(domain=(0,
-000078e0: 2031 3034 3929 2c20 7469 6c65 3d31 3030   1049), tile=100
-000078f0: 2c20 6474 7970 653d 6e70 2e69 6e74 3634  , dtype=np.int64
-00007900: 2929 0a20 2020 2020 2020 2061 7474 203d  )).        att =
-00007910: 2074 696c 6564 622e 4174 7472 2864 7479   tiledb.Attr(dty
-00007920: 7065 3d41 2e64 7479 7065 290a 2020 2020  pe=A.dtype).    
-00007930: 2020 2020 7363 6865 6d61 203d 2074 696c      schema = til
-00007940: 6564 622e 4172 7261 7953 6368 656d 6128  edb.ArraySchema(
-00007950: 646f 6d61 696e 3d64 6f6d 2c20 6174 7472  domain=dom, attr
-00007960: 733d 2861 7474 2c29 290a 2020 2020 2020  s=(att,)).      
-00007970: 2020 7469 6c65 6462 2e44 656e 7365 4172    tiledb.DenseAr
-00007980: 7261 792e 6372 6561 7465 2873 656c 662e  ray.create(self.
-00007990: 7061 7468 2822 666f 6f22 292c 2073 6368  path("foo"), sch
-000079a0: 656d 6129 0a0a 2020 2020 2020 2020 7769  ema)..        wi
-000079b0: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
-000079c0: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
-000079d0: 666f 6f22 292c 206d 6f64 653d 2272 2229  foo"), mode="r")
-000079e0: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
-000079f0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00007a00: 7561 6c28 6c65 6e28 4129 2c20 6c65 6e28  ual(len(A), len(
-00007a10: 5429 290a 2020 2020 2020 2020 2020 2020  T)).            
-00007a20: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00007a30: 2841 2e6e 6469 6d2c 2054 2e6e 6469 6d29  (A.ndim, T.ndim)
-00007a40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007a50: 662e 6173 7365 7274 4571 7561 6c28 412e  f.assertEqual(A.
-00007a60: 7368 6170 652c 2054 2e73 6861 7065 290a  shape, T.shape).
-00007a70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007a80: 662e 6173 7365 7274 4571 7561 6c28 312c  f.assertEqual(1,
-00007a90: 2054 2e6e 6174 7472 290a 2020 2020 2020   T.nattr).      
-00007aa0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00007ab0: 7445 7175 616c 2841 2e64 7479 7065 2c20  tEqual(A.dtype, 
-00007ac0: 542e 6174 7472 2830 292e 6474 7970 6529  T.attr(0).dtype)
-00007ad0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007ae0: 662e 6173 7365 7274 4571 7561 6c28 542e  f.assertEqual(T.
-00007af0: 6469 6d28 542e 7363 6865 6d61 2e64 6f6d  dim(T.schema.dom
-00007b00: 6169 6e2e 6469 6d28 3029 2e6e 616d 6529  ain.dim(0).name)
-00007b10: 2c20 542e 6469 6d28 3029 290a 2020 2020  , T.dim(0)).    
-00007b20: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-00007b30: 662e 6173 7365 7274 5261 6973 6573 2856  f.assertRaises(V
-00007b40: 616c 7565 4572 726f 7229 3a0a 2020 2020  alueError):.    
-00007b50: 2020 2020 2020 2020 2020 2020 542e 6469              T.di
-00007b60: 6d28 312e 3029 0a0a 2020 2020 2020 2020  m(1.0)..        
-00007b70: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-00007b80: 7349 6e73 7461 6e63 6528 542e 7469 6d65  sInstance(T.time
-00007b90: 7374 616d 705f 7261 6e67 652c 2074 7570  stamp_range, tup
-00007ba0: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-00007bb0: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
-00007bc0: 542e 7469 6d65 7374 616d 705f 7261 6e67  T.timestamp_rang
-00007bd0: 655b 315d 203e 2030 290a 0a20 2020 2020  e[1] > 0)..     
-00007be0: 2020 2020 2020 2023 2063 6865 636b 2065         # check e
-00007bf0: 6d70 7479 2061 7272 6179 0a20 2020 2020  mpty array.     
-00007c00: 2020 2020 2020 2042 203d 2054 5b3a 5d0a         B = T[:].
-00007c10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007c20: 662e 6173 7365 7274 4571 7561 6c28 412e  f.assertEqual(A.
-00007c30: 7368 6170 652c 2042 2e73 6861 7065 290a  shape, B.shape).
-00007c40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007c50: 2e61 7373 6572 7445 7175 616c 2841 2e64  .assertEqual(A.d
-00007c60: 7479 7065 2c20 422e 6474 7970 6529 0a20  type, B.dtype). 
-00007c70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007c80: 6173 7365 7274 4973 4e6f 6e65 2854 2e6e  assertIsNone(T.n
-00007c90: 6f6e 656d 7074 795f 646f 6d61 696e 2829  onempty_domain()
-00007ca0: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
-00007cb0: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-00007cc0: 7928 7365 6c66 2e70 6174 6828 2266 6f6f  y(self.path("foo
-00007cd0: 2229 2c20 6d6f 6465 3d22 7722 2920 6173  "), mode="w") as
-00007ce0: 2054 3a0a 2020 2020 2020 2020 2020 2020   T:.            
-00007cf0: 2320 6368 6563 6b20 7365 7420 6172 7261  # check set arra
-00007d00: 790a 2020 2020 2020 2020 2020 2020 545b  y.            T[
-00007d10: 3a5d 203d 2041 0a0a 2020 2020 2020 2020  :] = A..        
-00007d20: 7265 6164 315f 7469 6d65 7374 616d 7020  read1_timestamp 
-00007d30: 3d20 2d31 0a20 2020 2020 2020 2077 6974  = -1.        wit
-00007d40: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
-00007d50: 7261 7928 7365 6c66 2e70 6174 6828 2266  ray(self.path("f
-00007d60: 6f6f 2229 2c20 6d6f 6465 3d22 7222 2920  oo"), mode="r") 
-00007d70: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
-00007d80: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00007d90: 616c 2828 2830 2c20 3130 3439 292c 292c  al(((0, 1049),),
-00007da0: 2054 2e6e 6f6e 656d 7074 795f 646f 6d61   T.nonempty_doma
-00007db0: 696e 2829 290a 0a20 2020 2020 2020 2020  in())..         
-00007dc0: 2020 2023 2063 6865 636b 2074 696d 6573     # check times
-00007dd0: 7461 6d70 0a20 2020 2020 2020 2020 2020  tamp.           
-00007de0: 2072 6561 6431 5f74 696d 6573 7461 6d70   read1_timestamp
-00007df0: 203d 2054 2e74 696d 6573 7461 6d70 5f72   = T.timestamp_r
-00007e00: 616e 6765 0a20 2020 2020 2020 2020 2020  ange.           
-00007e10: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
-00007e20: 2872 6561 6431 5f74 696d 6573 7461 6d70  (read1_timestamp
-00007e30: 5b31 5d20 3e20 3029 0a0a 2020 2020 2020  [1] > 0)..      
-00007e40: 2020 2020 2020 2320 6368 6563 6b20 736c        # check sl
-00007e50: 6963 696e 670a 2020 2020 2020 2020 2020  icing.          
-00007e60: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-00007e70: 7175 616c 2841 2c20 6e70 2e61 7272 6179  qual(A, np.array
-00007e80: 2854 2929 0a20 2020 2020 2020 2020 2020  (T)).           
-00007e90: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-00007ea0: 7561 6c28 412c 2054 5b3a 5d29 0a20 2020  ual(A, T[:]).   
-00007eb0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-00007ec0: 6172 7261 795f 6571 7561 6c28 412c 2054  array_equal(A, T
-00007ed0: 5b2e 2e2e 5d29 0a20 2020 2020 2020 2020  [...]).         
-00007ee0: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
-00007ef0: 6571 7561 6c28 412c 2054 5b73 6c69 6365  equal(A, T[slice
-00007f00: 284e 6f6e 6529 5d29 0a20 2020 2020 2020  (None)]).       
-00007f10: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-00007f20: 795f 6571 7561 6c28 415b 3a31 305d 2c20  y_equal(A[:10], 
-00007f30: 545b 3a31 305d 290a 2020 2020 2020 2020  T[:10]).        
-00007f40: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
-00007f50: 5f65 7175 616c 2841 5b31 303a 3230 5d2c  _equal(A[10:20],
-00007f60: 2054 5b31 303a 3230 5d29 0a20 2020 2020   T[10:20]).     
-00007f70: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-00007f80: 7261 795f 6571 7561 6c28 415b 2d31 303a  ray_equal(A[-10:
-00007f90: 5d2c 2054 5b2d 3130 3a5d 290a 0a20 2020  ], T[-10:])..   
-00007fa0: 2020 2020 2020 2020 2023 2065 6c6c 6970           # ellip
-00007fb0: 7369 730a 2020 2020 2020 2020 2020 2020  sis.            
-00007fc0: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-00007fd0: 616c 2841 5b3a 3130 2c20 2e2e 2e5d 2c20  al(A[:10, ...], 
-00007fe0: 545b 3a31 302c 202e 2e2e 5d29 0a20 2020  T[:10, ...]).   
-00007ff0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-00008000: 6172 7261 795f 6571 7561 6c28 415b 3130  array_equal(A[10
-00008010: 3a35 302c 202e 2e2e 5d2c 2054 5b31 303a  :50, ...], T[10:
-00008020: 3530 2c20 2e2e 2e5d 290a 2020 2020 2020  50, ...]).      
-00008030: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
-00008040: 6179 5f65 7175 616c 2841 5b2d 3530 3a2c  ay_equal(A[-50:,
-00008050: 202e 2e2e 5d2c 2054 5b2d 3530 3a2c 202e   ...], T[-50:, .
-00008060: 2e2e 5d29 0a20 2020 2020 2020 2020 2020  ..]).           
-00008070: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-00008080: 7561 6c28 415b 2e2e 2e2c 203a 3130 5d2c  ual(A[..., :10],
-00008090: 2054 5b2e 2e2e 2c20 3a31 305d 290a 2020   T[..., :10]).  
-000080a0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-000080b0: 5f61 7272 6179 5f65 7175 616c 2841 5b2e  _array_equal(A[.
-000080c0: 2e2e 2c20 3130 3a32 305d 2c20 545b 2e2e  .., 10:20], T[..
-000080d0: 2e2c 2031 303a 3230 5d29 0a20 2020 2020  ., 10:20]).     
-000080e0: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-000080f0: 7261 795f 6571 7561 6c28 415b 2e2e 2e2c  ray_equal(A[...,
-00008100: 202d 3530 3a5d 2c20 545b 2e2e 2e2c 202d   -50:], T[..., -
-00008110: 3530 3a5d 290a 0a20 2020 2020 2020 2020  50:])..         
-00008120: 2020 2023 2061 6372 6f73 7320 7469 6c65     # across tile
-00008130: 730a 2020 2020 2020 2020 2020 2020 6173  s.            as
-00008140: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
-00008150: 2841 5b3a 3135 305d 2c20 545b 3a31 3530  (A[:150], T[:150
-00008160: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
-00008170: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
-00008180: 6c28 415b 2d32 3530 3a5d 2c20 545b 2d32  l(A[-250:], T[-2
-00008190: 3530 3a5d 290a 0a20 2020 2020 2020 2020  50:])..         
-000081a0: 2020 2023 2070 6f69 6e74 2069 6e64 6578     # point index
-000081b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000081c0: 662e 6173 7365 7274 4571 7561 6c28 415b  f.assertEqual(A[
-000081d0: 305d 2c20 545b 305d 290a 2020 2020 2020  0], T[0]).      
-000081e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000081f0: 7445 7175 616c 2841 5b2d 315d 2c20 545b  tEqual(A[-1], T[
-00008200: 2d31 5d29 0a0a 2020 2020 2020 2020 2020  -1])..          
-00008210: 2020 2320 706f 696e 7420 696e 6465 7820    # point index 
-00008220: 7769 7468 2061 6c6c 2069 6e64 6578 2074  with all index t
-00008230: 7970 6573 0a20 2020 2020 2020 2020 2020  ypes.           
-00008240: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00008250: 6c28 415b 3132 335d 2c20 545b 6e70 2e69  l(A[123], T[np.i
-00008260: 6e74 3828 3132 3329 5d29 0a20 2020 2020  nt8(123)]).     
-00008270: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00008280: 7274 4571 7561 6c28 415b 3132 335d 2c20  rtEqual(A[123], 
-00008290: 545b 6e70 2e75 696e 7438 2831 3233 295d  T[np.uint8(123)]
-000082a0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000082b0: 6c66 2e61 7373 6572 7445 7175 616c 2841  lf.assertEqual(A
-000082c0: 5b31 3233 5d2c 2054 5b6e 702e 696e 7431  [123], T[np.int1
-000082d0: 3628 3132 3329 5d29 0a20 2020 2020 2020  6(123)]).       
-000082e0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000082f0: 4571 7561 6c28 415b 3132 335d 2c20 545b  Equal(A[123], T[
-00008300: 6e70 2e75 696e 7431 3628 3132 3329 5d29  np.uint16(123)])
-00008310: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00008320: 662e 6173 7365 7274 4571 7561 6c28 415b  f.assertEqual(A[
-00008330: 3132 335d 2c20 545b 6e70 2e69 6e74 3634  123], T[np.int64
-00008340: 2831 3233 295d 290a 2020 2020 2020 2020  (123)]).        
-00008350: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00008360: 7175 616c 2841 5b31 3233 5d2c 2054 5b6e  qual(A[123], T[n
-00008370: 702e 7569 6e74 3634 2831 3233 295d 290a  p.uint64(123)]).
-00008380: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008390: 2e61 7373 6572 7445 7175 616c 2841 5b31  .assertEqual(A[1
-000083a0: 3233 5d2c 2054 5b6e 702e 696e 7433 3228  23], T[np.int32(
-000083b0: 3132 3329 5d29 0a20 2020 2020 2020 2020  123)]).         
-000083c0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-000083d0: 7561 6c28 415b 3132 335d 2c20 545b 6e70  ual(A[123], T[np
-000083e0: 2e75 696e 7433 3228 3132 3329 5d29 0a0a  .uint32(123)])..
-000083f0: 2020 2020 2020 2020 2020 2020 2320 6d69              # mi
-00008400: 7865 642d 7479 7065 2073 6c69 6369 6e67  xed-type slicing
-00008410: 0a20 2020 2020 2020 2020 2020 2023 2068  .            # h
-00008420: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-00008430: 6d2f 5469 6c65 4442 2d49 6e63 2f54 696c  m/TileDB-Inc/Til
-00008440: 6544 422d 5079 2f69 7373 7565 732f 3134  eDB-Py/issues/14
-00008450: 300a 2020 2020 2020 2020 2020 2020 7365  0.            se
-00008460: 6c66 2e61 7373 6572 7445 7175 616c 2841  lf.assertEqual(A
-00008470: 5b30 3a31 5d2c 2054 5b30 203a 206e 702e  [0:1], T[0 : np.
-00008480: 7569 6e74 3136 2831 295d 290a 2020 2020  uint16(1)]).    
-00008490: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000084a0: 6572 7445 7175 616c 2841 5b30 3a31 5d2c  ertEqual(A[0:1],
-000084b0: 2054 5b6e 702e 696e 7436 3428 3029 203a   T[np.int64(0) :
-000084c0: 2031 5d29 0a20 2020 2020 2020 2020 2020   1]).           
-000084d0: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-000084e0: 7452 6169 7365 7328 496e 6465 7845 7272  tRaises(IndexErr
-000084f0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-00008500: 2020 2020 2023 2074 6869 7320 6973 2061       # this is a
-00008510: 2063 6f6e 7365 7175 656e 6365 206f 6620   consequence of 
-00008520: 4e75 6d50 7920 7072 6f6d 6f74 696f 6e20  NumPy promotion 
-00008530: 7275 6c65 730a 2020 2020 2020 2020 2020  rules.          
-00008540: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00008550: 7445 7175 616c 2841 5b30 3a31 5d2c 2054  tEqual(A[0:1], T
-00008560: 5b6e 702e 7569 6e74 3634 2830 2920 3a20  [np.uint64(0) : 
-00008570: 315d 290a 0a20 2020 2020 2020 2020 2020  1])..           
-00008580: 2023 2062 6173 6963 2073 7465 700a 2020   # basic step.  
-00008590: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-000085a0: 5f61 7272 6179 5f65 7175 616c 2841 5b3a  _array_equal(A[:
-000085b0: 3530 3a32 5d2c 2054 5b3a 3530 3a32 5d29  50:2], T[:50:2])
-000085c0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-000085d0: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
-000085e0: 415b 3a32 3a35 305d 2c20 545b 3a32 3a35  A[:2:50], T[:2:5
-000085f0: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
-00008600: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-00008610: 616c 2841 5b31 303a 2d31 3a35 305d 2c20  al(A[10:-1:50], 
-00008620: 545b 3130 3a2d 313a 3530 5d29 0a0a 2020  T[10:-1:50])..  
-00008630: 2020 2020 2020 2020 2020 2320 696e 6465            # inde
-00008640: 7869 6e67 2065 7272 6f72 730a 2020 2020  xing errors.    
-00008650: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-00008660: 662e 6173 7365 7274 5261 6973 6573 2849  f.assertRaises(I
-00008670: 6e64 6578 4572 726f 7229 3a0a 2020 2020  ndexError):.    
-00008680: 2020 2020 2020 2020 2020 2020 545b 3a2c              T[:,
-00008690: 203a 5d0a 2020 2020 2020 2020 2020 2020   :].            
-000086a0: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
-000086b0: 5261 6973 6573 2849 6e64 6578 4572 726f  Raises(IndexErro
-000086c0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-000086d0: 2020 2020 545b 3a2c 2035 305d 0a20 2020      T[:, 50].   
-000086e0: 2020 2020 2020 2020 2077 6974 6820 7365           with se
-000086f0: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
-00008700: 496e 6465 7845 7272 6f72 293a 0a20 2020  IndexError):.   
-00008710: 2020 2020 2020 2020 2020 2020 2054 5b35               T[5
-00008720: 302c 203a 5d0a 2020 2020 2020 2020 2020  0, :].          
-00008730: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-00008740: 7274 5261 6973 6573 2849 6e64 6578 4572  rtRaises(IndexEr
-00008750: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
-00008760: 2020 2020 2020 545b 302c 2030 5d0a 0a20        T[0, 0].. 
-00008770: 2020 2020 2020 2020 2020 2023 2063 6865             # che
-00008780: 636b 2073 696e 676c 6520 656c 6c69 7073  ck single ellips
-00008790: 6973 0a20 2020 2020 2020 2020 2020 2077  is.            w
-000087a0: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
-000087b0: 6169 7365 7328 496e 6465 7845 7272 6f72  aises(IndexError
-000087c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000087d0: 2020 2054 5b2e 2e2e 2c20 313a 352c 202e     T[..., 1:5, .
-000087e0: 2e2e 5d0a 0a20 2020 2020 2020 2077 6974  ..]..        wit
-000087f0: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
-00008800: 7261 7928 7365 6c66 2e70 6174 6828 2266  ray(self.path("f
-00008810: 6f6f 2229 2c20 6d6f 6465 3d22 7722 2920  oo"), mode="w") 
-00008820: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
-00008830: 2020 2320 6368 6563 6b20 7061 7274 6961    # check partia
-00008840: 6c20 6173 7369 676e 6d65 6e74 0a20 2020  l assignment.   
-00008850: 2020 2020 2020 2020 2042 203d 206e 702e           B = np.
-00008860: 6172 616e 6765 2831 6535 2c20 3265 3529  arange(1e5, 2e5)
-00008870: 2e61 7374 7970 6528 412e 6474 7970 6529  .astype(A.dtype)
-00008880: 0a20 2020 2020 2020 2020 2020 2054 5b31  .            T[1
-00008890: 3930 3a33 3130 5d20 3d20 425b 3139 303a  90:310] = B[190:
-000088a0: 3331 305d 0a0a 2020 2020 2020 2020 7265  310]..        re
-000088b0: 6164 325f 7469 6d65 7374 616d 7020 3d20  ad2_timestamp = 
-000088c0: 2d31 0a20 2020 2020 2020 2077 6974 6820  -1.        with 
-000088d0: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-000088e0: 7928 7365 6c66 2e70 6174 6828 2266 6f6f  y(self.path("foo
-000088f0: 2229 2c20 6d6f 6465 3d22 7222 2920 6173  "), mode="r") as
-00008900: 2054 3a0a 2020 2020 2020 2020 2020 2020   T:.            
-00008910: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-00008920: 616c 2841 5b3a 3139 305d 2c20 545b 3a31  al(A[:190], T[:1
-00008930: 3930 5d29 0a20 2020 2020 2020 2020 2020  90]).           
-00008940: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-00008950: 7561 6c28 425b 3139 303a 3331 305d 2c20  ual(B[190:310], 
-00008960: 545b 3139 303a 3331 305d 290a 2020 2020  T[190:310]).    
-00008970: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
-00008980: 7272 6179 5f65 7175 616c 2841 5b33 3130  rray_equal(A[310
-00008990: 3a5d 2c20 545b 3331 303a 5d29 0a0a 2020  :], T[310:])..  
-000089a0: 2020 2020 2020 2020 2020 2320 7465 7374            # test
-000089b0: 2074 696d 6573 7461 6d70 7320 6172 6520   timestamps are 
-000089c0: 7570 6461 7465 640a 2020 2020 2020 2020  updated.        
-000089d0: 2020 2020 7265 6164 325f 7469 6d65 7374      read2_timest
-000089e0: 616d 7020 3d20 542e 7469 6d65 7374 616d  amp = T.timestam
-000089f0: 705f 7261 6e67 650a 2020 2020 2020 2020  p_range.        
-00008a00: 2020 2020 7365 6c66 2e61 7373 6572 7454      self.assertT
-00008a10: 7275 6528 7265 6164 325f 7469 6d65 7374  rue(read2_timest
-00008a20: 616d 7020 3e20 7265 6164 315f 7469 6d65  amp > read1_time
-00008a30: 7374 616d 7029 0a0a 2020 2020 6465 6620  stamp)..    def 
-00008a40: 7465 7374 5f61 7272 6179 5f31 645f 7365  test_array_1d_se
-00008a50: 745f 7363 616c 6172 2873 656c 6629 3a0a  t_scalar(self):.
-00008a60: 2020 2020 2020 2020 4120 3d20 6e70 2e7a          A = np.z
-00008a70: 6572 6f73 2835 3029 0a0a 2020 2020 2020  eros(50)..      
-00008a80: 2020 646f 6d20 3d20 7469 6c65 6462 2e44    dom = tiledb.D
-00008a90: 6f6d 6169 6e28 7469 6c65 6462 2e44 696d  omain(tiledb.Dim
-00008aa0: 2864 6f6d 6169 6e3d 2830 2c20 3439 292c  (domain=(0, 49),
-00008ab0: 2074 696c 653d 3530 2929 0a20 2020 2020   tile=50)).     
-00008ac0: 2020 2061 7474 203d 2074 696c 6564 622e     att = tiledb.
-00008ad0: 4174 7472 2864 7479 7065 3d41 2e64 7479  Attr(dtype=A.dty
-00008ae0: 7065 290a 2020 2020 2020 2020 7363 6865  pe).        sche
-00008af0: 6d61 203d 2074 696c 6564 622e 4172 7261  ma = tiledb.Arra
-00008b00: 7953 6368 656d 6128 646f 6d2c 2028 6174  ySchema(dom, (at
-00008b10: 742c 2929 0a0a 2020 2020 2020 2020 7469  t,))..        ti
-00008b20: 6c65 6462 2e44 656e 7365 4172 7261 792e  ledb.DenseArray.
-00008b30: 6372 6561 7465 2873 656c 662e 7061 7468  create(self.path
-00008b40: 2822 666f 6f22 292c 2073 6368 656d 6129  ("foo"), schema)
-00008b50: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
-00008b60: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
-00008b70: 2873 656c 662e 7061 7468 2822 666f 6f22  (self.path("foo"
-00008b80: 292c 206d 6f64 653d 2277 2229 2061 7320  ), mode="w") as 
-00008b90: 543a 0a20 2020 2020 2020 2020 2020 2054  T:.            T
-00008ba0: 5b3a 5d20 3d20 410a 0a20 2020 2020 2020  [:] = A..       
-00008bb0: 2077 6974 6820 7469 6c65 6462 2e44 656e   with tiledb.Den
-00008bc0: 7365 4172 7261 7928 7365 6c66 2e70 6174  seArray(self.pat
-00008bd0: 6828 2266 6f6f 2229 2c20 6d6f 6465 3d22  h("foo"), mode="
-00008be0: 7222 2920 6173 2054 3a0a 2020 2020 2020  r") as T:.      
-00008bf0: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
-00008c00: 6179 5f65 7175 616c 2841 2c20 545b 3a5d  ay_equal(A, T[:]
-00008c10: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
-00008c20: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-00008c30: 7928 7365 6c66 2e70 6174 6828 2266 6f6f  y(self.path("foo
-00008c40: 2229 2c20 6d6f 6465 3d22 7722 2920 6173  "), mode="w") as
-00008c50: 2054 3a0a 2020 2020 2020 2020 2020 2020   T:.            
-00008c60: 7661 6c75 6520 3d20 2d31 2c20 332c 2031  value = -1, 3, 1
-00008c70: 300a 2020 2020 2020 2020 2020 2020 415b  0.            A[
-00008c80: 305d 2c20 415b 315d 2c20 415b 335d 203d  0], A[1], A[3] =
-00008c90: 2076 616c 7565 0a20 2020 2020 2020 2020   value.         
-00008ca0: 2020 2054 5b30 5d2c 2054 5b31 5d2c 2054     T[0], T[1], T
-00008cb0: 5b33 5d20 3d20 7661 6c75 650a 2020 2020  [3] = value.    
-00008cc0: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
-00008cd0: 4465 6e73 6541 7272 6179 2873 656c 662e  DenseArray(self.
-00008ce0: 7061 7468 2822 666f 6f22 292c 206d 6f64  path("foo"), mod
-00008cf0: 653d 2272 2229 2061 7320 543a 0a20 2020  e="r") as T:.   
-00008d00: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-00008d10: 6172 7261 795f 6571 7561 6c28 412c 2054  array_equal(A, T
-00008d20: 5b3a 5d29 0a0a 2020 2020 2020 2020 666f  [:])..        fo
-00008d30: 7220 7661 6c75 6520 696e 2028 2d31 2c20  r value in (-1, 
-00008d40: 332c 2031 3029 3a0a 2020 2020 2020 2020  3, 10):.        
-00008d50: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
-00008d60: 4465 6e73 6541 7272 6179 2873 656c 662e  DenseArray(self.
-00008d70: 7061 7468 2822 666f 6f22 292c 206d 6f64  path("foo"), mod
-00008d80: 653d 2277 2229 2061 7320 543a 0a20 2020  e="w") as T:.   
-00008d90: 2020 2020 2020 2020 2020 2020 2041 5b35               A[5
-00008da0: 3a32 355d 203d 2076 616c 7565 0a20 2020  :25] = value.   
-00008db0: 2020 2020 2020 2020 2020 2020 2054 5b35               T[5
-00008dc0: 3a32 355d 203d 2076 616c 7565 0a20 2020  :25] = value.   
-00008dd0: 2020 2020 2020 2020 2077 6974 6820 7469           with ti
-00008de0: 6c65 6462 2e44 656e 7365 4172 7261 7928  ledb.DenseArray(
-00008df0: 7365 6c66 2e70 6174 6828 2266 6f6f 2229  self.path("foo")
-00008e00: 2c20 6d6f 6465 3d22 7222 2920 6173 2054  , mode="r") as T
-00008e10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008e20: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-00008e30: 7175 616c 2841 2c20 545b 3a5d 290a 2020  qual(A, T[:]).  
-00008e40: 2020 2020 2020 2020 2020 7769 7468 2074            with t
-00008e50: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
-00008e60: 2873 656c 662e 7061 7468 2822 666f 6f22  (self.path("foo"
-00008e70: 292c 206d 6f64 653d 2277 2229 2061 7320  ), mode="w") as 
-00008e80: 543a 0a20 2020 2020 2020 2020 2020 2020  T:.             
-00008e90: 2020 2041 5b3a 5d20 3d20 7661 6c75 650a     A[:] = value.
-00008ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008eb0: 545b 3a5d 203d 2076 616c 7565 0a20 2020  T[:] = value.   
-00008ec0: 2020 2020 2020 2020 2077 6974 6820 7469           with ti
-00008ed0: 6c65 6462 2e44 656e 7365 4172 7261 7928  ledb.DenseArray(
-00008ee0: 7365 6c66 2e70 6174 6828 2266 6f6f 2229  self.path("foo")
-00008ef0: 2c20 6d6f 6465 3d22 7222 2920 6173 2054  , mode="r") as T
-00008f00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008f10: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-00008f20: 7175 616c 2841 2c20 545b 3a5d 290a 0a20  qual(A, T[:]).. 
-00008f30: 2020 2064 6566 2074 6573 745f 6172 7261     def test_arra
-00008f40: 795f 6964 5f70 6f69 6e74 5f71 7565 7269  y_id_point_queri
-00008f50: 6573 2873 656c 6629 3a0a 2020 2020 2020  es(self):.      
-00008f60: 2020 2320 544f 444f 3a20 6861 6e64 6c65    # TODO: handle
-00008f70: 2071 7565 7269 6573 206c 696b 6520 545b   queries like T[
-00008f80: 5b32 2c20 352c 2031 305d 5d20 3d20 3f0a  [2, 5, 10]] = ?.
-00008f90: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
-00008fa0: 2020 4070 7974 6573 742e 6d61 726b 2e70    @pytest.mark.p
-00008fb0: 6172 616d 6574 7269 7a65 2822 6474 7970  arametrize("dtyp
-00008fc0: 6522 2c20 494e 5445 4745 525f 4454 5950  e", INTEGER_DTYP
-00008fd0: 4553 290a 2020 2020 6465 6620 7465 7374  ES).    def test
-00008fe0: 5f64 656e 7365 5f69 6e64 6578 5f64 7479  _dense_index_dty
-00008ff0: 7065 7328 7365 6c66 2c20 6474 7970 6529  pes(self, dtype)
-00009000: 3a0a 2020 2020 2020 2020 7061 7468 203d  :.        path =
-00009010: 2073 656c 662e 7061 7468 2829 0a20 2020   self.path().   
-00009020: 2020 2020 2064 6174 6120 3d20 6e70 2e61       data = np.a
-00009030: 7261 6e67 6528 302c 2033 292e 6173 7479  range(0, 3).asty
-00009040: 7065 2864 7479 7065 290a 2020 2020 2020  pe(dtype).      
-00009050: 2020 7769 7468 2074 696c 6564 622e 6672    with tiledb.fr
-00009060: 6f6d 5f6e 756d 7079 2870 6174 682c 2064  om_numpy(path, d
-00009070: 6174 6129 2061 7320 413a 0a20 2020 2020  ata) as A:.     
-00009080: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00009090: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
-000090a0: 6f70 656e 2870 6174 6829 2061 7320 423a  open(path) as B:
-000090b0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-000090c0: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
-000090d0: 425b 3a5d 2c20 6461 7461 290a 0a20 2020  B[:], data)..   
-000090e0: 2064 6566 2074 6573 745f 6172 7261 795f   def test_array_
-000090f0: 3264 2873 656c 6629 3a0a 2020 2020 2020  2d(self):.      
-00009100: 2020 4120 3d20 6e70 2e61 7261 6e67 6528    A = np.arange(
-00009110: 3130 3030 3029 2e72 6573 6861 7065 2828  10000).reshape((
-00009120: 3130 3030 2c20 3130 2929 0a0a 2020 2020  1000, 10))..    
-00009130: 2020 2020 646f 6d20 3d20 7469 6c65 6462      dom = tiledb
-00009140: 2e44 6f6d 6169 6e28 0a20 2020 2020 2020  .Domain(.       
-00009150: 2020 2020 2074 696c 6564 622e 4469 6d28       tiledb.Dim(
-00009160: 646f 6d61 696e 3d28 302c 2039 3939 292c  domain=(0, 999),
-00009170: 2074 696c 653d 3130 3029 2c20 7469 6c65   tile=100), tile
-00009180: 6462 2e44 696d 2864 6f6d 6169 6e3d 2830  db.Dim(domain=(0
-00009190: 2c20 3929 2c20 7469 6c65 3d32 290a 2020  , 9), tile=2).  
-000091a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000091b0: 6174 7420 3d20 7469 6c65 6462 2e41 7474  att = tiledb.Att
-000091c0: 7228 6474 7970 653d 412e 6474 7970 6529  r(dtype=A.dtype)
-000091d0: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
-000091e0: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
-000091f0: 6865 6d61 2864 6f6d 2c20 2861 7474 2c29  hema(dom, (att,)
-00009200: 290a 0a20 2020 2020 2020 2074 696c 6564  )..        tiled
-00009210: 622e 4465 6e73 6541 7272 6179 2e63 7265  b.DenseArray.cre
-00009220: 6174 6528 7365 6c66 2e70 6174 6828 2266  ate(self.path("f
-00009230: 6f6f 2229 2c20 7363 6865 6d61 290a 0a20  oo"), schema).. 
-00009240: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
-00009250: 6462 2e44 656e 7365 4172 7261 7928 7365  db.DenseArray(se
-00009260: 6c66 2e70 6174 6828 2266 6f6f 2229 2c20  lf.path("foo"), 
-00009270: 6d6f 6465 3d22 7222 2920 6173 2054 3a0a  mode="r") as T:.
-00009280: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00009290: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-000092a0: 2841 292c 206c 656e 2854 2929 0a20 2020  (A), len(T)).   
-000092b0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-000092c0: 7365 7274 4571 7561 6c28 412e 6e64 696d  sertEqual(A.ndim
-000092d0: 2c20 542e 6e64 696d 290a 2020 2020 2020  , T.ndim).      
-000092e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000092f0: 7445 7175 616c 2841 2e73 6861 7065 2c20  tEqual(A.shape, 
-00009300: 542e 7368 6170 6529 0a0a 2020 2020 2020  T.shape)..      
-00009310: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00009320: 7445 7175 616c 2831 2c20 542e 6e61 7474  tEqual(1, T.natt
-00009330: 7229 0a20 2020 2020 2020 2020 2020 2073  r).            s
-00009340: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-00009350: 412e 6474 7970 652c 2054 2e61 7474 7228  A.dtype, T.attr(
-00009360: 3029 2e64 7479 7065 290a 0a20 2020 2020  0).dtype)..     
-00009370: 2020 2020 2020 2023 2063 6865 636b 2074         # check t
-00009380: 6861 7420 7468 6520 6e6f 6e2d 656d 7074  hat the non-empt
-00009390: 7920 646f 6d61 696e 2069 7320 4e6f 6e65  y domain is None
-000093a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000093b0: 662e 6173 7365 7274 4973 4e6f 6e65 2854  f.assertIsNone(T
-000093c0: 2e6e 6f6e 656d 7074 795f 646f 6d61 696e  .nonempty_domain
-000093d0: 2829 290a 0a20 2020 2020 2020 2077 6974  ())..        wit
-000093e0: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
-000093f0: 7261 7928 7365 6c66 2e70 6174 6828 2266  ray(self.path("f
-00009400: 6f6f 2229 2c20 6d6f 6465 3d22 7722 2920  oo"), mode="w") 
-00009410: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
-00009420: 2020 2320 5365 7420 6461 7461 0a20 2020    # Set data.   
-00009430: 2020 2020 2020 2020 2054 5b3a 5d20 3d20           T[:] = 
-00009440: 410a 0a20 2020 2020 2020 2077 6974 6820  A..        with 
-00009450: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-00009460: 7928 7365 6c66 2e70 6174 6828 2266 6f6f  y(self.path("foo
-00009470: 2229 2c20 6d6f 6465 3d22 7222 2920 6173  "), mode="r") as
-00009480: 2054 3a0a 2020 2020 2020 2020 2020 2020   T:.            
-00009490: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-000094a0: 616c 2841 2c20 545b 3a5d 290a 0a20 2020  al(A, T[:])..   
-000094b0: 2020 2020 2020 2020 2023 2063 6865 636b           # check
-000094c0: 2074 6865 206e 6f6e 2d65 6d70 7479 2064   the non-empty d
-000094d0: 6f6d 6169 6e20 7370 616e 7320 7468 6520  omain spans the 
-000094e0: 7768 6f6c 6520 646f 6d61 696e 0a20 2020  whole domain.   
-000094f0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00009500: 7365 7274 4571 7561 6c28 2828 302c 2039  sertEqual(((0, 9
-00009510: 3939 292c 2028 302c 2039 2929 2c20 542e  99), (0, 9)), T.
-00009520: 6e6f 6e65 6d70 7479 5f64 6f6d 6169 6e28  nonempty_domain(
-00009530: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-00009540: 2320 6368 6563 6b20 6172 7261 792d 6c69  # check array-li
-00009550: 6b65 0a20 2020 2020 2020 2020 2020 2061  ke.            a
-00009560: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
-00009570: 6c28 412c 206e 702e 6172 7261 7928 5429  l(A, np.array(T)
-00009580: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00009590: 2073 6c69 6369 6e67 0a20 2020 2020 2020   slicing.       
-000095a0: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-000095b0: 795f 6571 7561 6c28 412c 2054 5b3a 5d29  y_equal(A, T[:])
-000095c0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-000095d0: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
-000095e0: 412c 2054 5b2e 2e2e 5d29 0a20 2020 2020  A, T[...]).     
-000095f0: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-00009600: 7261 795f 6571 7561 6c28 412c 2054 5b73  ray_equal(A, T[s
-00009610: 6c69 6365 284e 6f6e 6529 5d29 0a0a 2020  lice(None)])..  
-00009620: 2020 2020 2020 2020 2020 2320 736c 6963            # slic
-00009630: 6520 6669 7273 7420 6469 6d65 6e73 696f  e first dimensio
-00009640: 6e0a 2020 2020 2020 2020 2020 2020 6173  n.            as
-00009650: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
-00009660: 2841 5b3a 3130 5d2c 2054 5b3a 3130 5d29  (A[:10], T[:10])
-00009670: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00009680: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
-00009690: 415b 3a31 305d 2c20 545b 3a31 305d 290a  A[:10], T[:10]).
-000096a0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-000096b0: 7274 5f61 7272 6179 5f65 7175 616c 2841  rt_array_equal(A
-000096c0: 5b31 303a 3230 5d2c 2054 5b31 303a 3230  [10:20], T[10:20
-000096d0: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
-000096e0: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
-000096f0: 6c28 415b 2d31 303a 5d2c 2054 5b2d 3130  l(A[-10:], T[-10
-00009700: 3a5d 290a 2020 2020 2020 2020 2020 2020  :]).            
-00009710: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-00009720: 616c 2841 5b3a 3130 2c20 3a5d 2c20 545b  al(A[:10, :], T[
-00009730: 3a31 302c 203a 5d29 0a20 2020 2020 2020  :10, :]).       
-00009740: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-00009750: 795f 6571 7561 6c28 415b 3130 3a32 302c  y_equal(A[10:20,
-00009760: 203a 5d2c 2054 5b31 303a 3230 2c20 3a5d   :], T[10:20, :]
-00009770: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-00009780: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
-00009790: 2841 5b2d 3130 3a2c 203a 5d2c 2054 5b2d  (A[-10:, :], T[-
-000097a0: 3130 3a2c 203a 5d29 0a20 2020 2020 2020  10:, :]).       
-000097b0: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-000097c0: 795f 6571 7561 6c28 415b 3a31 302c 202e  y_equal(A[:10, .
-000097d0: 2e2e 5d2c 2054 5b3a 3130 2c20 2e2e 2e5d  ..], T[:10, ...]
-000097e0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-000097f0: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
-00009800: 2841 5b31 303a 3230 2c20 2e2e 2e5d 2c20  (A[10:20, ...], 
-00009810: 545b 3130 3a32 302c 202e 2e2e 5d29 0a20  T[10:20, ...]). 
-00009820: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00009830: 745f 6172 7261 795f 6571 7561 6c28 415b  t_array_equal(A[
-00009840: 2d31 303a 2c20 2e2e 2e5d 2c20 545b 2d31  -10:, ...], T[-1
-00009850: 303a 2c20 2e2e 2e5d 290a 2020 2020 2020  0:, ...]).      
-00009860: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
-00009870: 6179 5f65 7175 616c 2841 5b3a 3130 2c20  ay_equal(A[:10, 
-00009880: 3a2c 202e 2e2e 5d2c 2054 5b3a 3130 2c20  :, ...], T[:10, 
-00009890: 3a2c 202e 2e2e 5d29 0a20 2020 2020 2020  :, ...]).       
-000098a0: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-000098b0: 795f 6571 7561 6c28 415b 3130 3a32 302c  y_equal(A[10:20,
-000098c0: 203a 2c20 2e2e 2e5d 2c20 545b 3130 3a32   :, ...], T[10:2
-000098d0: 302c 203a 2c20 2e2e 2e5d 290a 2020 2020  0, :, ...]).    
-000098e0: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
-000098f0: 7272 6179 5f65 7175 616c 2841 5b2d 3130  rray_equal(A[-10
-00009900: 3a2c 203a 2c20 2e2e 2e5d 2c20 545b 2d31  :, :, ...], T[-1
-00009910: 303a 2c20 3a2c 202e 2e2e 5d29 0a0a 2020  0:, :, ...])..  
-00009920: 2020 2020 2020 2020 2020 2320 736c 6963            # slic
-00009930: 6520 7365 636f 6e64 2064 696d 656e 7369  e second dimensi
-00009940: 6f6e 0a20 2020 2020 2020 2020 2020 2061  on.            a
-00009950: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
-00009960: 6c28 415b 3a2c 203a 325d 2c20 545b 3a2c  l(A[:, :2], T[:,
-00009970: 203a 325d 290a 2020 2020 2020 2020 2020   :2]).          
-00009980: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-00009990: 7175 616c 2841 5b3a 2c20 323a 345d 2c20  qual(A[:, 2:4], 
-000099a0: 545b 3a2c 2032 3a34 5d29 0a20 2020 2020  T[:, 2:4]).     
-000099b0: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-000099c0: 7261 795f 6571 7561 6c28 415b 3a2c 202d  ray_equal(A[:, -
-000099d0: 323a 5d2c 2054 5b3a 2c20 2d32 3a5d 290a  2:], T[:, -2:]).
-000099e0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-000099f0: 7274 5f61 7272 6179 5f65 7175 616c 2841  rt_array_equal(A
-00009a00: 5b2e 2e2e 2c20 3a32 5d2c 2054 5b2e 2e2e  [..., :2], T[...
-00009a10: 2c20 3a32 5d29 0a20 2020 2020 2020 2020  , :2]).         
-00009a20: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
-00009a30: 6571 7561 6c28 415b 2e2e 2e2c 2032 3a34  equal(A[..., 2:4
-00009a40: 5d2c 2054 5b2e 2e2e 2c20 323a 345d 290a  ], T[..., 2:4]).
-00009a50: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00009a60: 7274 5f61 7272 6179 5f65 7175 616c 2841  rt_array_equal(A
-00009a70: 5b2e 2e2e 2c20 2d32 3a5d 2c20 545b 2e2e  [..., -2:], T[..
-00009a80: 2e2c 202d 323a 5d29 0a20 2020 2020 2020  ., -2:]).       
-00009a90: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-00009aa0: 795f 6571 7561 6c28 415b 3a2c 202e 2e2e  y_equal(A[:, ...
-00009ab0: 2c20 3a32 5d2c 2054 5b3a 2c20 2e2e 2e2c  , :2], T[:, ...,
-00009ac0: 203a 325d 290a 2020 2020 2020 2020 2020   :2]).          
-00009ad0: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-00009ae0: 7175 616c 2841 5b3a 2c20 2e2e 2e2c 2032  qual(A[:, ..., 2
-00009af0: 3a34 5d2c 2054 5b3a 2c20 2e2e 2e2c 2032  :4], T[:, ..., 2
-00009b00: 3a34 5d29 0a20 2020 2020 2020 2020 2020  :4]).           
-00009b10: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-00009b20: 7561 6c28 415b 3a2c 202e 2e2e 2c20 2d32  ual(A[:, ..., -2
-00009b30: 3a5d 2c20 545b 3a2c 202e 2e2e 2c20 2d32  :], T[:, ..., -2
-00009b40: 3a5d 290a 0a20 2020 2020 2020 2020 2020  :])..           
-00009b50: 2023 2073 6c69 6365 2062 6f74 6820 6469   # slice both di
-00009b60: 6d65 6e73 696f 6e73 0a20 2020 2020 2020  mensions.       
-00009b70: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-00009b80: 795f 6571 7561 6c28 415b 3a31 302c 203a  y_equal(A[:10, :
-00009b90: 325d 2c20 545b 3a31 302c 203a 325d 290a  2], T[:10, :2]).
-00009ba0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00009bb0: 7274 5f61 7272 6179 5f65 7175 616c 2841  rt_array_equal(A
-00009bc0: 5b31 303a 3230 2c20 323a 345d 2c20 545b  [10:20, 2:4], T[
-00009bd0: 3130 3a32 302c 2032 3a34 5d29 0a20 2020  10:20, 2:4]).   
-00009be0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-00009bf0: 6172 7261 795f 6571 7561 6c28 415b 2d31  array_equal(A[-1
-00009c00: 303a 2c20 2d32 3a5d 2c20 545b 2d31 303a  0:, -2:], T[-10:
-00009c10: 2c20 2d32 3a5d 290a 0a20 2020 2020 2020  , -2:])..       
-00009c20: 2020 2020 2023 2073 6c69 6365 2061 6372       # slice acr
-00009c30: 6f73 7320 7469 6c65 2062 6f75 6e64 7269  oss tile boundri
-00009c40: 6573 0a20 2020 2020 2020 2020 2020 2061  es.            a
-00009c50: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
-00009c60: 6c28 415b 3a31 3130 5d2c 2054 5b3a 3131  l(A[:110], T[:11
-00009c70: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
-00009c80: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-00009c90: 616c 2841 5b31 3930 3a33 3130 5d2c 2054  al(A[190:310], T
-00009ca0: 5b31 3930 3a33 3130 5d29 0a20 2020 2020  [190:310]).     
-00009cb0: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-00009cc0: 7261 795f 6571 7561 6c28 415b 2d31 3130  ray_equal(A[-110
-00009cd0: 3a5d 2c20 545b 2d31 3130 3a5d 290a 2020  :], T[-110:]).  
-00009ce0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00009cf0: 5f61 7272 6179 5f65 7175 616c 2841 5b3a  _array_equal(A[:
-00009d00: 3131 302c 203a 5d2c 2054 5b3a 3131 302c  110, :], T[:110,
-00009d10: 203a 5d29 0a20 2020 2020 2020 2020 2020   :]).           
-00009d20: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-00009d30: 7561 6c28 415b 3139 303a 3331 302c 203a  ual(A[190:310, :
-00009d40: 5d2c 2054 5b31 3930 3a33 3130 2c20 3a5d  ], T[190:310, :]
-00009d50: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-00009d60: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
-00009d70: 2841 5b2d 3131 303a 2c20 3a5d 2c20 545b  (A[-110:, :], T[
-00009d80: 2d31 3130 3a2c 203a 5d29 0a20 2020 2020  -110:, :]).     
-00009d90: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-00009da0: 7261 795f 6571 7561 6c28 415b 3a2c 203a  ray_equal(A[:, :
-00009db0: 335d 2c20 545b 3a2c 203a 335d 290a 2020  3], T[:, :3]).  
-00009dc0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00009dd0: 5f61 7272 6179 5f65 7175 616c 2841 5b3a  _array_equal(A[:
-00009de0: 2c20 333a 375d 2c20 545b 3a2c 2033 3a37  , 3:7], T[:, 3:7
-00009df0: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
-00009e00: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
-00009e10: 6c28 415b 3a2c 202d 333a 5d2c 2054 5b3a  l(A[:, -3:], T[:
-00009e20: 2c20 2d33 3a5d 290a 2020 2020 2020 2020  , -3:]).        
-00009e30: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
-00009e40: 5f65 7175 616c 2841 5b3a 3131 302c 203a  _equal(A[:110, :
-00009e50: 335d 2c20 545b 3a31 3130 2c20 3a33 5d29  3], T[:110, :3])
-00009e60: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00009e70: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
-00009e80: 415b 3139 303a 3331 302c 2033 3a37 5d2c  A[190:310, 3:7],
-00009e90: 2054 5b31 3930 3a33 3130 2c20 333a 375d   T[190:310, 3:7]
-00009ea0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-00009eb0: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
-00009ec0: 2841 5b2d 3131 303a 2c20 2d33 3a5d 2c20  (A[-110:, -3:], 
-00009ed0: 545b 2d31 3130 3a2c 202d 333a 5d29 0a0a  T[-110:, -3:])..
-00009ee0: 2020 2020 2020 2020 2020 2020 2320 7369              # si
-00009ef0: 6e67 6c65 2072 6f77 2f63 6f6c 2f69 7465  ngle row/col/ite
-00009f00: 6d0a 2020 2020 2020 2020 2020 2020 6173  m.            as
+00004180: 6536 3429 0a0a 2020 2020 4070 7974 6573  e64)..    @pytes
+00004190: 742e 6d61 726b 2e70 6172 616d 6574 7269  t.mark.parametri
+000041a0: 7a65 2822 7370 6172 7365 222c 205b 5472  ze("sparse", [Tr
+000041b0: 7565 2c20 4661 6c73 655d 290a 2020 2020  ue, False]).    
+000041c0: 6465 6620 7465 7374 5f61 7363 6969 5f61  def test_ascii_a
+000041d0: 7474 7269 6275 7465 2873 656c 662c 2073  ttribute(self, s
+000041e0: 7061 7273 652c 2063 6170 6664 293a 0a20  parse, capfd):. 
+000041f0: 2020 2020 2020 2070 6174 6820 3d20 7365         path = se
+00004200: 6c66 2e70 6174 6828 2274 6573 745f 6173  lf.path("test_as
+00004210: 6369 6922 290a 2020 2020 2020 2020 646f  cii").        do
+00004220: 6d20 3d20 7469 6c65 6462 2e44 6f6d 6169  m = tiledb.Domai
+00004230: 6e28 0a20 2020 2020 2020 2020 2020 2074  n(.            t
+00004240: 696c 6564 622e 4469 6d28 6e61 6d65 3d22  iledb.Dim(name="
+00004250: 6422 2c20 646f 6d61 696e 3d28 312c 2034  d", domain=(1, 4
+00004260: 292c 2074 696c 653d 312c 2064 7479 7065  ), tile=1, dtype
+00004270: 3d6e 702e 7569 6e74 3332 290a 2020 2020  =np.uint32).    
+00004280: 2020 2020 290a 2020 2020 2020 2020 6174      ).        at
+00004290: 7472 7320 3d20 5b74 696c 6564 622e 4174  trs = [tiledb.At
+000042a0: 7472 286e 616d 653d 2241 222c 2064 7479  tr(name="A", dty
+000042b0: 7065 3d22 6173 6369 6922 2c20 7661 723d  pe="ascii", var=
+000042c0: 5472 7565 295d 0a20 2020 2020 2020 2073  True)].        s
+000042d0: 6368 656d 6120 3d20 7469 6c65 6462 2e41  chema = tiledb.A
+000042e0: 7272 6179 5363 6865 6d61 2864 6f6d 6169  rraySchema(domai
+000042f0: 6e3d 646f 6d2c 2061 7474 7273 3d61 7474  n=dom, attrs=att
+00004300: 7273 2c20 7370 6172 7365 3d73 7061 7273  rs, sparse=spars
+00004310: 6529 0a20 2020 2020 2020 2074 696c 6564  e).        tiled
+00004320: 622e 4172 7261 792e 6372 6561 7465 2870  b.Array.create(p
+00004330: 6174 682c 2073 6368 656d 6129 0a0a 2020  ath, schema)..  
+00004340: 2020 2020 2020 6173 6369 695f 6461 7461        ascii_data
+00004350: 203d 205b 2261 222c 2022 6222 2c20 2263   = ["a", "b", "c
+00004360: 222c 2022 4142 4322 5d0a 2020 2020 2020  ", "ABC"].      
+00004370: 2020 756e 6963 6f64 655f 6461 7461 203d    unicode_data =
+00004380: 205b 22c2 b122 2c20 22c3 9722 2c20 22c3   ["..", "..", ".
+00004390: b722 2c20 22e2 889a 225d 0a0a 2020 2020  .", "..."]..    
+000043a0: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+000043b0: 6f70 656e 2870 6174 682c 2022 7722 2920  open(path, "w") 
+000043c0: 6173 2041 3a0a 2020 2020 2020 2020 2020  as A:.          
+000043d0: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
+000043e0: 7274 5261 6973 6573 2874 696c 6564 622e  rtRaises(tiledb.
+000043f0: 5469 6c65 4442 4572 726f 7229 3a0a 2020  TileDBError):.  
+00004400: 2020 2020 2020 2020 2020 2020 2020 415b                A[
+00004410: 6e70 2e61 7261 6e67 6528 312c 2035 295d  np.arange(1, 5)]
+00004420: 203d 2075 6e69 636f 6465 5f64 6174 610a   = unicode_data.
+00004430: 2020 2020 2020 2020 2020 2020 415b 6e70              A[np
+00004440: 2e61 7261 6e67 6528 312c 2035 295d 203d  .arange(1, 5)] =
+00004450: 2061 7363 6969 5f64 6174 610a 0a20 2020   ascii_data..   
+00004460: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+00004470: 2e6f 7065 6e28 7061 7468 2c20 2272 2229  .open(path, "r")
+00004480: 2061 7320 413a 0a20 2020 2020 2020 2020   as A:.         
+00004490: 2020 2061 7373 6572 7420 412e 7363 6865     assert A.sche
+000044a0: 6d61 2e6e 6174 7472 203d 3d20 310a 2020  ma.nattr == 1.  
+000044b0: 2020 2020 2020 2020 2020 412e 7363 6865            A.sche
+000044c0: 6d61 2e64 756d 7028 290a 2020 2020 2020  ma.dump().      
+000044d0: 2020 2020 2020 6173 7365 7274 5f63 6170        assert_cap
+000044e0: 7475 7265 6428 6361 7066 642c 2022 5479  tured(capfd, "Ty
+000044f0: 7065 3a20 5354 5249 4e47 5f41 5343 4949  pe: STRING_ASCII
+00004500: 2229 0a20 2020 2020 2020 2020 2020 2061  ").            a
+00004510: 7373 6572 7420 412e 7363 6865 6d61 2e61  ssert A.schema.a
+00004520: 7474 7228 2241 2229 2e64 7479 7065 203d  ttr("A").dtype =
+00004530: 3d20 6e70 2e62 7974 6573 5f0a 2020 2020  = np.bytes_.    
+00004540: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+00004550: 7272 6179 5f65 7175 616c 2841 5b3a 5d5b  rray_equal(A[:][
+00004560: 2241 225d 2c20 6e70 2e61 7361 7272 6179  "A"], np.asarray
+00004570: 2861 7363 6969 5f64 6174 612c 2064 7479  (ascii_data, dty
+00004580: 7065 3d6e 702e 6279 7465 735f 2929 0a0a  pe=np.bytes_))..
+00004590: 0a63 6c61 7373 2041 7272 6179 5363 6865  .class ArraySche
+000045a0: 6d61 5465 7374 2844 6973 6b54 6573 7443  maTest(DiskTestC
+000045b0: 6173 6529 3a0a 2020 2020 6465 6620 7465  ase):.    def te
+000045c0: 7374 5f73 6368 656d 615f 6261 7369 6328  st_schema_basic(
+000045d0: 7365 6c66 293a 0a20 2020 2020 2020 2064  self):.        d
+000045e0: 6f6d 203d 2074 696c 6564 622e 446f 6d61  om = tiledb.Doma
+000045f0: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
+00004600: 7469 6c65 6462 2e44 696d 2822 6431 222c  tiledb.Dim("d1",
+00004610: 2028 312c 2034 292c 2032 2c20 6474 7970   (1, 4), 2, dtyp
+00004620: 653d 2275 3822 292c 0a20 2020 2020 2020  e="u8"),.       
+00004630: 2020 2020 2074 696c 6564 622e 4469 6d28       tiledb.Dim(
+00004640: 2264 3222 2c20 2831 2c20 3429 2c20 322c  "d2", (1, 4), 2,
+00004650: 2064 7479 7065 3d22 7538 2229 2c0a 2020   dtype="u8"),.  
+00004660: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00004670: 2061 7474 7231 203d 2074 696c 6564 622e   attr1 = tiledb.
+00004680: 4174 7472 2822 666f 6f22 2c20 6474 7970  Attr("foo", dtyp
+00004690: 653d 666c 6f61 7429 0a20 2020 2020 2020  e=float).       
+000046a0: 2061 7474 7232 203d 2074 696c 6564 622e   attr2 = tiledb.
+000046b0: 4174 7472 2822 666f 6f22 2c20 6474 7970  Attr("foo", dtyp
+000046c0: 653d 696e 7429 0a0a 2020 2020 2020 2020  e=int)..        
+000046d0: 2320 7465 7374 2075 6e69 7175 6520 6174  # test unique at
+000046e0: 7472 6962 7574 6573 0a20 2020 2020 2020  tributes.       
+000046f0: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+00004700: 7452 6169 7365 7328 7469 6c65 6462 2e54  tRaises(tiledb.T
+00004710: 696c 6544 4245 7272 6f72 293a 0a20 2020  ileDBError):.   
+00004720: 2020 2020 2020 2020 2074 696c 6564 622e           tiledb.
+00004730: 4172 7261 7953 6368 656d 6128 646f 6d61  ArraySchema(doma
+00004740: 696e 3d64 6f6d 2c20 6174 7472 733d 2861  in=dom, attrs=(a
+00004750: 7474 7231 2c20 6174 7472 3229 290a 0a20  ttr1, attr2)).. 
+00004760: 2020 2020 2020 2023 2074 6573 7420 7363         # test sc
+00004770: 6865 6d61 2e63 6865 636b 0a20 2020 2020  hema.check.     
+00004780: 2020 2073 6368 656d 6120 3d20 7469 6c65     schema = tile
+00004790: 6462 2e41 7272 6179 5363 6865 6d61 2864  db.ArraySchema(d
+000047a0: 6f6d 6169 6e3d 646f 6d2c 2061 7474 7273  omain=dom, attrs
+000047b0: 3d28 6174 7472 312c 2929 0a20 2020 2020  =(attr1,)).     
+000047c0: 2020 2023 2076 616c 6964 2073 6368 656d     # valid schem
+000047d0: 6120 646f 6573 206e 6f74 2072 6169 7365  a does not raise
+000047e0: 0a20 2020 2020 2020 2073 6368 656d 612e  .        schema.
+000047f0: 6368 6563 6b28 290a 2020 2020 2020 2020  check().        
+00004800: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
+00004810: 5261 6973 6573 2874 696c 6564 622e 5469  Raises(tiledb.Ti
+00004820: 6c65 4442 4572 726f 7229 3a0a 2020 2020  leDBError):.    
+00004830: 2020 2020 2020 2020 7363 6865 6d61 2e5f          schema._
+00004840: 6d61 6b65 5f69 6e76 616c 6964 2829 0a20  make_invalid(). 
+00004850: 2020 2020 2020 2020 2020 2073 6368 656d             schem
+00004860: 612e 6368 6563 6b28 290a 0a20 2020 2064  a.check()..    d
+00004870: 6566 2074 6573 745f 6465 6e73 655f 6172  ef test_dense_ar
+00004880: 7261 795f 7363 6865 6d61 2873 656c 6629  ray_schema(self)
+00004890: 3a0a 2020 2020 2020 2020 646f 6d61 696e  :.        domain
+000048a0: 203d 2074 696c 6564 622e 446f 6d61 696e   = tiledb.Domain
+000048b0: 280a 2020 2020 2020 2020 2020 2020 7469  (.            ti
+000048c0: 6c65 6462 2e44 696d 2864 6f6d 6169 6e3d  ledb.Dim(domain=
+000048d0: 2831 2c20 3829 2c20 7469 6c65 3d32 292c  (1, 8), tile=2),
+000048e0: 2074 696c 6564 622e 4469 6d28 646f 6d61   tiledb.Dim(doma
+000048f0: 696e 3d28 312c 2038 292c 2074 696c 653d  in=(1, 8), tile=
+00004900: 3229 0a20 2020 2020 2020 2029 0a20 2020  2).        ).   
+00004910: 2020 2020 2061 3120 3d20 7469 6c65 6462       a1 = tiledb
+00004920: 2e41 7474 7228 2276 616c 222c 2064 7479  .Attr("val", dty
+00004930: 7065 3d22 6638 2229 0a20 2020 2020 2020  pe="f8").       
+00004940: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
+00004950: 2e41 7272 6179 5363 6865 6d61 2864 6f6d  .ArraySchema(dom
+00004960: 6169 6e3d 646f 6d61 696e 2c20 6174 7472  ain=domain, attr
+00004970: 733d 2861 312c 2929 0a20 2020 2020 2020  s=(a1,)).       
+00004980: 2073 656c 662e 6173 7365 7274 4661 6c73   self.assertFals
+00004990: 6528 7363 6865 6d61 2e73 7061 7273 6529  e(schema.sparse)
+000049a0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+000049b0: 7365 7274 4571 7561 6c28 7363 6865 6d61  sertEqual(schema
+000049c0: 2e63 656c 6c5f 6f72 6465 722c 2022 726f  .cell_order, "ro
+000049d0: 772d 6d61 6a6f 7222 290a 2020 2020 2020  w-major").      
+000049e0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000049f0: 616c 2873 6368 656d 612e 7469 6c65 5f6f  al(schema.tile_o
+00004a00: 7264 6572 2c20 2272 6f77 2d6d 616a 6f72  rder, "row-major
+00004a10: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+00004a20: 6173 7365 7274 4571 7561 6c28 7363 6865  assertEqual(sche
+00004a30: 6d61 2e64 6f6d 6169 6e2c 2064 6f6d 6169  ma.domain, domai
+00004a40: 6e29 0a20 2020 2020 2020 2073 656c 662e  n).        self.
+00004a50: 6173 7365 7274 4571 7561 6c28 7363 6865  assertEqual(sche
+00004a60: 6d61 2e6e 6469 6d2c 2032 290a 2020 2020  ma.ndim, 2).    
+00004a70: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00004a80: 7175 616c 2873 6368 656d 612e 7368 6170  qual(schema.shap
+00004a90: 652c 2028 382c 2038 2929 0a20 2020 2020  e, (8, 8)).     
+00004aa0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00004ab0: 7561 6c28 7363 6865 6d61 2e6e 6174 7472  ual(schema.nattr
+00004ac0: 2c20 3129 0a20 2020 2020 2020 2073 656c  , 1).        sel
+00004ad0: 662e 6173 7365 7274 4571 7561 6c28 7363  f.assertEqual(sc
+00004ae0: 6865 6d61 2e64 6f6d 6169 6e2e 686f 6d6f  hema.domain.homo
+00004af0: 6765 6e65 6f75 732c 2054 7275 6529 0a20  geneous, True). 
+00004b00: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00004b10: 7274 4571 7561 6c28 7363 6865 6d61 2e61  rtEqual(schema.a
+00004b20: 7474 7228 3029 2c20 6131 290a 2020 2020  ttr(0), a1).    
+00004b30: 2020 2020 7365 6c66 2e61 7373 6572 7454      self.assertT
+00004b40: 7275 6528 7363 6865 6d61 2e68 6173 5f61  rue(schema.has_a
+00004b50: 7474 7228 2276 616c 2229 290a 2020 2020  ttr("val")).    
+00004b60: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
+00004b70: 616c 7365 2873 6368 656d 612e 6861 735f  alse(schema.has_
+00004b80: 6174 7472 2822 6e6f 6e6f 6e6f 6174 7472  attr("nononoattr
+00004b90: 2229 290a 2020 2020 2020 2020 7365 6c66  ")).        self
+00004ba0: 2e61 7373 6572 7445 7175 616c 2873 6368  .assertEqual(sch
+00004bb0: 656d 612c 2074 696c 6564 622e 4172 7261  ema, tiledb.Arra
+00004bc0: 7953 6368 656d 6128 646f 6d61 696e 3d64  ySchema(domain=d
+00004bd0: 6f6d 6169 6e2c 2061 7474 7273 3d28 6131  omain, attrs=(a1
+00004be0: 2c29 2929 0a20 2020 2020 2020 2073 656c  ,))).        sel
+00004bf0: 662e 6173 7365 7274 4e6f 7445 7175 616c  f.assertNotEqual
+00004c00: 280a 2020 2020 2020 2020 2020 2020 7363  (.            sc
+00004c10: 6865 6d61 2c20 7469 6c65 6462 2e41 7272  hema, tiledb.Arr
+00004c20: 6179 5363 6865 6d61 2864 6f6d 6169 6e3d  aySchema(domain=
+00004c30: 646f 6d61 696e 2c20 6174 7472 733d 2861  domain, attrs=(a
+00004c40: 312c 292c 2073 7061 7273 653d 5472 7565  1,), sparse=True
+00004c50: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+00004c60: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
+00004c70: 7365 7274 5261 6973 6573 2874 696c 6564  sertRaises(tiled
+00004c80: 622e 5469 6c65 4442 4572 726f 7229 3a0a  b.TileDBError):.
+00004c90: 2020 2020 2020 2020 2020 2020 7363 6865              sche
+00004ca0: 6d61 2e61 6c6c 6f77 735f 6475 706c 6963  ma.allows_duplic
+00004cb0: 6174 6573 0a20 2020 2020 2020 2023 2074  ates.        # t
+00004cc0: 6573 7420 6974 6572 6174 696f 6e20 6f76  est iteration ov
+00004cd0: 6572 2061 7474 7269 6275 7465 730a 2020  er attributes.  
+00004ce0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00004cf0: 7445 7175 616c 286c 6973 7428 7363 6865  tEqual(list(sche
+00004d00: 6d61 292c 205b 6131 5d29 0a0a 2020 2020  ma), [a1])..    
+00004d10: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
+00004d20: 7365 7274 5261 6973 6573 5265 6765 7828  sertRaisesRegex(
+00004d30: 0a20 2020 2020 2020 2020 2020 2074 696c  .            til
+00004d40: 6564 622e 5469 6c65 4442 4572 726f 722c  edb.TileDBError,
+00004d50: 0a20 2020 2020 2020 2020 2020 2022 4361  .            "Ca
+00004d60: 6e6e 6f74 2073 6574 2063 656c 6c20 6f72  nnot set cell or
+00004d70: 6465 723b 2048 696c 6265 7274 206f 7264  der; Hilbert ord
+00004d80: 6572 2069 7320 6f6e 6c79 2061 7070 6c69  er is only appli
+00004d90: 6361 626c 6520 746f 2073 7061 7273 6520  cable to sparse 
+00004da0: 6172 7261 7973 222c 0a20 2020 2020 2020  arrays",.       
+00004db0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00004dc0: 7469 6c65 6462 2e41 7272 6179 5363 6865  tiledb.ArraySche
+00004dd0: 6d61 280a 2020 2020 2020 2020 2020 2020  ma(.            
+00004de0: 2020 2020 646f 6d61 696e 3d64 6f6d 6169      domain=domai
+00004df0: 6e2c 2061 7474 7273 3d28 6131 2c29 2c20  n, attrs=(a1,), 
+00004e00: 7370 6172 7365 3d46 616c 7365 2c20 6365  sparse=False, ce
+00004e10: 6c6c 5f6f 7264 6572 3d22 6869 6c62 6572  ll_order="hilber
+00004e20: 7422 0a20 2020 2020 2020 2020 2020 2029  t".            )
+00004e30: 0a0a 2020 2020 6465 6620 7465 7374 5f64  ..    def test_d
+00004e40: 656e 7365 5f61 7272 6179 5f73 6368 656d  ense_array_schem
+00004e50: 615f 6670 5f64 6f6d 6169 6e5f 6572 726f  a_fp_domain_erro
+00004e60: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
+00004e70: 2064 6f6d 203d 2074 696c 6564 622e 446f   dom = tiledb.Do
+00004e80: 6d61 696e 2874 696c 6564 622e 4469 6d28  main(tiledb.Dim(
+00004e90: 646f 6d61 696e 3d28 312c 2038 292c 2074  domain=(1, 8), t
+00004ea0: 696c 653d 322c 2064 7479 7065 3d6e 702e  ile=2, dtype=np.
+00004eb0: 666c 6f61 7436 3429 290a 2020 2020 2020  float64)).      
+00004ec0: 2020 6174 7420 3d20 7469 6c65 6462 2e41    att = tiledb.A
+00004ed0: 7474 7228 2276 616c 222c 2064 7479 7065  ttr("val", dtype
+00004ee0: 3d6e 702e 666c 6f61 7436 3429 0a0a 2020  =np.float64)..  
+00004ef0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
+00004f00: 6173 7365 7274 5261 6973 6573 2874 696c  assertRaises(til
+00004f10: 6564 622e 5469 6c65 4442 4572 726f 7229  edb.TileDBError)
+00004f20: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
+00004f30: 6c65 6462 2e41 7272 6179 5363 6865 6d61  ledb.ArraySchema
+00004f40: 2864 6f6d 6169 6e3d 646f 6d2c 2061 7474  (domain=dom, att
+00004f50: 7273 3d28 6174 742c 2929 0a0a 2020 2020  rs=(att,))..    
+00004f60: 6465 6620 7465 7374 5f73 7061 7273 655f  def test_sparse_
+00004f70: 7363 6865 6d61 2873 656c 662c 2063 6170  schema(self, cap
+00004f80: 6664 293a 0a20 2020 2020 2020 2023 2063  fd):.        # c
+00004f90: 7265 6174 6520 6469 6d65 6e73 696f 6e73  reate dimensions
+00004fa0: 0a20 2020 2020 2020 2064 3120 3d20 7469  .        d1 = ti
+00004fb0: 6c65 6462 2e44 696d 2822 6431 222c 2064  ledb.Dim("d1", d
+00004fc0: 6f6d 6169 6e3d 2831 2c20 3130 3030 292c  omain=(1, 1000),
+00004fd0: 2074 696c 653d 3130 2c20 6474 7970 653d   tile=10, dtype=
+00004fe0: 2275 696e 7436 3422 290a 2020 2020 2020  "uint64").      
+00004ff0: 2020 6432 203d 2074 696c 6564 622e 4469    d2 = tiledb.Di
+00005000: 6d28 2264 3222 2c20 646f 6d61 696e 3d28  m("d2", domain=(
+00005010: 3130 312c 2031 3030 3030 292c 2074 696c  101, 10000), til
+00005020: 653d 3130 302c 2064 7479 7065 3d22 7569  e=100, dtype="ui
+00005030: 6e74 3634 2229 0a0a 2020 2020 2020 2020  nt64")..        
+00005040: 2320 6372 6561 7465 2064 6f6d 6169 6e0a  # create domain.
+00005050: 2020 2020 2020 2020 646f 6d61 696e 203d          domain =
+00005060: 2074 696c 6564 622e 446f 6d61 696e 2864   tiledb.Domain(d
+00005070: 312c 2064 3229 0a0a 2020 2020 2020 2020  1, d2)..        
+00005080: 2320 6372 6561 7465 2061 7474 7269 6275  # create attribu
+00005090: 7465 730a 2020 2020 2020 2020 6131 203d  tes.        a1 =
+000050a0: 2074 696c 6564 622e 4174 7472 2822 6131   tiledb.Attr("a1
+000050b0: 222c 2064 7479 7065 3d22 696e 7433 322c  ", dtype="int32,
+000050c0: 696e 7433 322c 696e 7433 3222 290a 2020  int32,int32").  
+000050d0: 2020 2020 2020 6132 203d 2074 696c 6564        a2 = tiled
+000050e0: 622e 4174 7472 280a 2020 2020 2020 2020  b.Attr(.        
+000050f0: 2020 2020 2261 3222 2c20 6669 6c74 6572      "a2", filter
+00005100: 733d 7469 6c65 6462 2e46 696c 7465 724c  s=tiledb.FilterL
+00005110: 6973 7428 5b74 696c 6564 622e 477a 6970  ist([tiledb.Gzip
+00005120: 4669 6c74 6572 282d 3129 5d29 2c20 6474  Filter(-1)]), dt
+00005130: 7970 653d 2266 6c6f 6174 3332 220a 2020  ype="float32".  
+00005140: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00005150: 2023 2063 7265 6174 6520 7370 6172 7365   # create sparse
+00005160: 2061 7272 6179 2077 6974 6820 7363 6865   array with sche
+00005170: 6d61 0a20 2020 2020 2020 2063 6f6f 7264  ma.        coord
+00005180: 735f 6669 6c74 6572 7320 3d20 7469 6c65  s_filters = tile
+00005190: 6462 2e46 696c 7465 724c 6973 7428 5b74  db.FilterList([t
+000051a0: 696c 6564 622e 5a73 7464 4669 6c74 6572  iledb.ZstdFilter
+000051b0: 2834 295d 290a 2020 2020 2020 2020 6f66  (4)]).        of
+000051c0: 6673 6574 735f 6669 6c74 6572 7320 3d20  fsets_filters = 
+000051d0: 7469 6c65 6462 2e46 696c 7465 724c 6973  tiledb.FilterLis
+000051e0: 7428 5b74 696c 6564 622e 4c5a 3446 696c  t([tiledb.LZ4Fil
+000051f0: 7465 7228 3529 5d29 0a0a 2020 2020 2020  ter(5)])..      
+00005200: 2020 7363 6865 6d61 203d 2074 696c 6564    schema = tiled
+00005210: 622e 4172 7261 7953 6368 656d 6128 0a20  b.ArraySchema(. 
+00005220: 2020 2020 2020 2020 2020 2064 6f6d 6169             domai
+00005230: 6e3d 646f 6d61 696e 2c0a 2020 2020 2020  n=domain,.      
+00005240: 2020 2020 2020 6174 7472 733d 2861 312c        attrs=(a1,
+00005250: 2061 3229 2c0a 2020 2020 2020 2020 2020   a2),.          
+00005260: 2020 6361 7061 6369 7479 3d31 302c 0a20    capacity=10,. 
+00005270: 2020 2020 2020 2020 2020 2063 656c 6c5f             cell_
+00005280: 6f72 6465 723d 2263 6f6c 2d6d 616a 6f72  order="col-major
+00005290: 222c 0a20 2020 2020 2020 2020 2020 2074  ",.            t
+000052a0: 696c 655f 6f72 6465 723d 2272 6f77 2d6d  ile_order="row-m
+000052b0: 616a 6f72 222c 0a20 2020 2020 2020 2020  ajor",.         
+000052c0: 2020 2061 6c6c 6f77 735f 6475 706c 6963     allows_duplic
+000052d0: 6174 6573 3d54 7275 652c 0a20 2020 2020  ates=True,.     
+000052e0: 2020 2020 2020 2073 7061 7273 653d 5472         sparse=Tr
+000052f0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00005300: 636f 6f72 6473 5f66 696c 7465 7273 3d63  coords_filters=c
+00005310: 6f6f 7264 735f 6669 6c74 6572 732c 0a20  oords_filters,. 
+00005320: 2020 2020 2020 2020 2020 206f 6666 7365             offse
+00005330: 7473 5f66 696c 7465 7273 3d6f 6666 7365  ts_filters=offse
+00005340: 7473 5f66 696c 7465 7273 2c0a 2020 2020  ts_filters,.    
+00005350: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
+00005360: 6368 656d 612e 6475 6d70 2829 0a20 2020  chema.dump().   
+00005370: 2020 2020 2061 7373 6572 745f 6361 7074       assert_capt
+00005380: 7572 6564 2863 6170 6664 2c20 2241 7272  ured(capfd, "Arr
+00005390: 6179 2074 7970 653a 2073 7061 7273 6522  ay type: sparse"
+000053a0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000053b0: 6173 7365 7274 5472 7565 2873 6368 656d  assertTrue(schem
+000053c0: 612e 7370 6172 7365 290a 2020 2020 2020  a.sparse).      
+000053d0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000053e0: 616c 2873 6368 656d 612e 6361 7061 6369  al(schema.capaci
+000053f0: 7479 2c20 3130 290a 2020 2020 2020 2020  ty, 10).        
+00005400: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00005410: 2873 6368 656d 612e 6365 6c6c 5f6f 7264  (schema.cell_ord
+00005420: 6572 2c20 2263 6f6c 2d6d 616a 6f72 2229  er, "col-major")
+00005430: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00005440: 7365 7274 4571 7561 6c28 7363 6865 6d61  sertEqual(schema
+00005450: 2e74 696c 655f 6f72 6465 722c 2022 726f  .tile_order, "ro
+00005460: 772d 6d61 6a6f 7222 290a 0a20 2020 2020  w-major")..     
+00005470: 2020 2023 203c 746f 646f 3e0a 2020 2020     # <todo>.    
+00005480: 2020 2020 2320 7365 6c66 2e61 7373 6572      # self.asser
+00005490: 7445 7175 616c 2873 6368 656d 612e 636f  tEqual(schema.co
+000054a0: 6f72 6473 5f63 6f6d 7072 6573 736f 722c  ords_compressor,
+000054b0: 2028 277a 7374 6427 2c20 3429 290a 2020   ('zstd', 4)).  
+000054c0: 2020 2020 2020 2320 7365 6c66 2e61 7373        # self.ass
+000054d0: 6572 7445 7175 616c 2873 6368 656d 612e  ertEqual(schema.
+000054e0: 6f66 6673 6574 735f 636f 6d70 7265 7373  offsets_compress
+000054f0: 6f72 2c20 2827 6c7a 3427 2c20 3529 290a  or, ('lz4', 5)).
+00005500: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00005510: 7365 7274 4571 7561 6c28 7363 6865 6d61  sertEqual(schema
+00005520: 2e64 6f6d 6169 6e2c 2064 6f6d 6169 6e29  .domain, domain)
+00005530: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00005540: 7365 7274 4571 7561 6c28 7363 6865 6d61  sertEqual(schema
+00005550: 2e6e 6469 6d2c 2032 290a 2020 2020 2020  .ndim, 2).      
+00005560: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00005570: 616c 2873 6368 656d 612e 7368 6170 652c  al(schema.shape,
+00005580: 2028 3130 3030 2c20 3939 3030 2929 0a20   (1000, 9900)). 
+00005590: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000055a0: 7274 4571 7561 6c28 7363 6865 6d61 2e6e  rtEqual(schema.n
+000055b0: 6174 7472 2c20 3229 0a20 2020 2020 2020  attr, 2).       
+000055c0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000055d0: 6c28 7363 6865 6d61 2e61 7474 7228 3029  l(schema.attr(0)
+000055e0: 2c20 6131 290a 2020 2020 2020 2020 7365  , a1).        se
+000055f0: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+00005600: 6368 656d 612e 6174 7472 2822 6132 2229  chema.attr("a2")
+00005610: 2c20 6132 290a 2020 2020 2020 2020 7365  , a2).        se
+00005620: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+00005630: 6368 656d 612e 616c 6c6f 7773 5f64 7570  chema.allows_dup
+00005640: 6c69 6361 7465 732c 2054 7275 6529 0a20  licates, True). 
+00005650: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00005660: 7274 4571 7561 6c28 0a20 2020 2020 2020  rtEqual(.       
+00005670: 2020 2020 2073 6368 656d 612c 0a20 2020       schema,.   
+00005680: 2020 2020 2020 2020 2074 696c 6564 622e           tiledb.
+00005690: 4172 7261 7953 6368 656d 6128 0a20 2020  ArraySchema(.   
+000056a0: 2020 2020 2020 2020 2020 2020 2064 6f6d               dom
+000056b0: 6169 6e3d 646f 6d61 696e 2c0a 2020 2020  ain=domain,.    
+000056c0: 2020 2020 2020 2020 2020 2020 6174 7472              attr
+000056d0: 733d 2861 312c 2061 3229 2c0a 2020 2020  s=(a1, a2),.    
+000056e0: 2020 2020 2020 2020 2020 2020 6361 7061              capa
+000056f0: 6369 7479 3d31 302c 0a20 2020 2020 2020  city=10,.       
+00005700: 2020 2020 2020 2020 2063 656c 6c5f 6f72           cell_or
+00005710: 6465 723d 2263 6f6c 2d6d 616a 6f72 222c  der="col-major",
+00005720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005730: 2074 696c 655f 6f72 6465 723d 2272 6f77   tile_order="row
+00005740: 2d6d 616a 6f72 222c 0a20 2020 2020 2020  -major",.       
+00005750: 2020 2020 2020 2020 2061 6c6c 6f77 735f           allows_
+00005760: 6475 706c 6963 6174 6573 3d54 7275 652c  duplicates=True,
+00005770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005780: 2073 7061 7273 653d 5472 7565 2c0a 2020   sparse=True,.  
+00005790: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000057a0: 6f72 6473 5f66 696c 7465 7273 3d63 6f6f  ords_filters=coo
+000057b0: 7264 735f 6669 6c74 6572 732c 0a20 2020  rds_filters,.   
+000057c0: 2020 2020 2020 2020 2020 2020 206f 6666               off
+000057d0: 7365 7473 5f66 696c 7465 7273 3d6f 6666  sets_filters=off
+000057e0: 7365 7473 5f66 696c 7465 7273 2c0a 2020  sets_filters,.  
+000057f0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+00005800: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00005810: 2320 7465 7374 2069 7465 7261 7469 6f6e  # test iteration
+00005820: 206f 7665 7220 6174 7472 6962 7574 6573   over attributes
+00005830: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00005840: 7365 7274 4571 7561 6c28 6c69 7374 2873  sertEqual(list(s
+00005850: 6368 656d 6129 2c20 5b61 312c 2061 325d  chema), [a1, a2]
+00005860: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
+00005870: 7365 6c66 2e61 7373 6572 7452 6169 7365  self.assertRaise
+00005880: 7352 6567 6578 280a 2020 2020 2020 2020  sRegex(.        
+00005890: 2020 2020 7469 6c65 6462 2e54 696c 6544      tiledb.TileD
+000058a0: 4245 7272 6f72 2c0a 2020 2020 2020 2020  BError,.        
+000058b0: 2020 2020 2243 616e 6e6f 7420 7365 7420      "Cannot set 
+000058c0: 7469 6c65 206f 7264 6572 3b20 4869 6c62  tile order; Hilb
+000058d0: 6572 7420 6f72 6465 7220 6973 206e 6f74  ert order is not
+000058e0: 2061 7070 6c69 6361 626c 6520 746f 2074   applicable to t
+000058f0: 696c 6573 222c 0a20 2020 2020 2020 2029  iles",.        )
+00005900: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
+00005910: 6c65 6462 2e41 7272 6179 5363 6865 6d61  ledb.ArraySchema
+00005920: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00005930: 2020 646f 6d61 696e 3d64 6f6d 6169 6e2c    domain=domain,
+00005940: 2061 7474 7273 3d28 6131 2c29 2c20 7370   attrs=(a1,), sp
+00005950: 6172 7365 3d54 7275 652c 2074 696c 655f  arse=True, tile_
+00005960: 6f72 6465 723d 2268 696c 6265 7274 220a  order="hilbert".
+00005970: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00005980: 2020 2064 6566 2074 6573 745f 7370 6172     def test_spar
+00005990: 7365 5f73 6368 656d 615f 6669 6c74 6572  se_schema_filter
+000059a0: 5f6c 6973 7428 7365 6c66 2c20 6361 7066  _list(self, capf
+000059b0: 6429 3a0a 2020 2020 2020 2020 2320 6372  d):.        # cr
+000059c0: 6561 7465 2064 696d 656e 7369 6f6e 730a  eate dimensions.
+000059d0: 2020 2020 2020 2020 6431 203d 2074 696c          d1 = til
+000059e0: 6564 622e 4469 6d28 2264 3122 2c20 646f  edb.Dim("d1", do
+000059f0: 6d61 696e 3d28 312c 2031 3030 3029 2c20  main=(1, 1000), 
+00005a00: 7469 6c65 3d31 302c 2064 7479 7065 3d22  tile=10, dtype="
+00005a10: 7569 6e74 3634 2229 0a20 2020 2020 2020  uint64").       
+00005a20: 2064 3220 3d20 7469 6c65 6462 2e44 696d   d2 = tiledb.Dim
+00005a30: 2822 6432 222c 2064 6f6d 6169 6e3d 2831  ("d2", domain=(1
+00005a40: 3031 2c20 3130 3030 3029 2c20 7469 6c65  01, 10000), tile
+00005a50: 3d31 3030 2c20 6474 7970 653d 2275 696e  =100, dtype="uin
+00005a60: 7436 3422 290a 0a20 2020 2020 2020 2023  t64")..        #
+00005a70: 2063 7265 6174 6520 646f 6d61 696e 0a20   create domain. 
+00005a80: 2020 2020 2020 2064 6f6d 6169 6e20 3d20         domain = 
+00005a90: 7469 6c65 6462 2e44 6f6d 6169 6e28 6431  tiledb.Domain(d1
+00005aa0: 2c20 6432 290a 0a20 2020 2020 2020 2023  , d2)..        #
+00005ab0: 2063 7265 6174 6520 6174 7472 6962 7574   create attribut
+00005ac0: 6573 0a20 2020 2020 2020 2061 3120 3d20  es.        a1 = 
+00005ad0: 7469 6c65 6462 2e41 7474 7228 2261 3122  tiledb.Attr("a1"
+00005ae0: 2c20 6474 7970 653d 2269 6e74 3332 2c69  , dtype="int32,i
+00005af0: 6e74 3332 2c69 6e74 3332 2229 0a20 2020  nt32,int32").   
+00005b00: 2020 2020 2066 696c 7465 725f 6c69 7374       filter_list
+00005b10: 203d 2074 696c 6564 622e 4669 6c74 6572   = tiledb.Filter
+00005b20: 4c69 7374 285b 7469 6c65 6462 2e47 7a69  List([tiledb.Gzi
+00005b30: 7046 696c 7465 7228 295d 290a 2020 2020  pFilter()]).    
+00005b40: 2020 2020 6132 203d 2074 696c 6564 622e      a2 = tiledb.
+00005b50: 4174 7472 2822 6132 222c 2066 696c 7465  Attr("a2", filte
+00005b60: 7273 3d66 696c 7465 725f 6c69 7374 2c20  rs=filter_list, 
+00005b70: 6474 7970 653d 2266 6c6f 6174 3332 2229  dtype="float32")
+00005b80: 0a0a 2020 2020 2020 2020 6f66 665f 6669  ..        off_fi
+00005b90: 6c74 6572 735f 7079 6c69 7374 203d 205b  lters_pylist = [
+00005ba0: 7469 6c65 6462 2e6c 6962 7469 6c65 6462  tiledb.libtiledb
+00005bb0: 2e5a 7374 6446 696c 7465 7228 6c65 7665  .ZstdFilter(leve
+00005bc0: 6c3d 3130 295d 0a20 2020 2020 2020 206f  l=10)].        o
+00005bd0: 6666 5f66 696c 7465 7273 203d 2074 696c  ff_filters = til
+00005be0: 6564 622e 6c69 6274 696c 6564 622e 4669  edb.libtiledb.Fi
+00005bf0: 6c74 6572 4c69 7374 280a 2020 2020 2020  lterList(.      
+00005c00: 2020 2020 2020 6669 6c74 6572 733d 6f66        filters=of
+00005c10: 665f 6669 6c74 6572 735f 7079 6c69 7374  f_filters_pylist
+00005c20: 2c20 6368 756e 6b73 697a 653d 3230 3438  , chunksize=2048
+00005c30: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00005c40: 2020 2020 636f 6f72 6473 5f66 696c 7465      coords_filte
+00005c50: 7273 5f70 796c 6973 7420 3d20 5b74 696c  rs_pylist = [til
+00005c60: 6564 622e 6c69 6274 696c 6564 622e 427a  edb.libtiledb.Bz
+00005c70: 6970 3246 696c 7465 7228 6c65 7665 6c3d  ip2Filter(level=
+00005c80: 3529 5d0a 2020 2020 2020 2020 636f 6f72  5)].        coor
+00005c90: 6473 5f66 696c 7465 7273 203d 2074 696c  ds_filters = til
+00005ca0: 6564 622e 6c69 6274 696c 6564 622e 4669  edb.libtiledb.Fi
+00005cb0: 6c74 6572 4c69 7374 280a 2020 2020 2020  lterList(.      
+00005cc0: 2020 2020 2020 6669 6c74 6572 733d 636f        filters=co
+00005cd0: 6f72 6473 5f66 696c 7465 7273 5f70 796c  ords_filters_pyl
+00005ce0: 6973 742c 2063 6875 6e6b 7369 7a65 3d34  ist, chunksize=4
+00005cf0: 3039 360a 2020 2020 2020 2020 290a 0a20  096.        ).. 
+00005d00: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+00005d10: 7370 6172 7365 2061 7272 6179 2077 6974  sparse array wit
+00005d20: 6820 7363 6865 6d61 0a20 2020 2020 2020  h schema.       
+00005d30: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
+00005d40: 2e41 7272 6179 5363 6865 6d61 280a 2020  .ArraySchema(.  
+00005d50: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
+00005d60: 3d64 6f6d 6169 6e2c 0a20 2020 2020 2020  =domain,.       
+00005d70: 2020 2020 2061 7474 7273 3d28 6131 2c20       attrs=(a1, 
+00005d80: 6132 292c 0a20 2020 2020 2020 2020 2020  a2),.           
+00005d90: 2063 6170 6163 6974 793d 3130 2c0a 2020   capacity=10,.  
+00005da0: 2020 2020 2020 2020 2020 6365 6c6c 5f6f            cell_o
+00005db0: 7264 6572 3d22 636f 6c2d 6d61 6a6f 7222  rder="col-major"
+00005dc0: 2c0a 2020 2020 2020 2020 2020 2020 7469  ,.            ti
+00005dd0: 6c65 5f6f 7264 6572 3d22 726f 772d 6d61  le_order="row-ma
+00005de0: 6a6f 7222 2c0a 2020 2020 2020 2020 2020  jor",.          
+00005df0: 2020 636f 6f72 6473 5f66 696c 7465 7273    coords_filters
+00005e00: 3d63 6f6f 7264 735f 6669 6c74 6572 732c  =coords_filters,
+00005e10: 0a20 2020 2020 2020 2020 2020 206f 6666  .            off
+00005e20: 7365 7473 5f66 696c 7465 7273 3d6f 6666  sets_filters=off
+00005e30: 5f66 696c 7465 7273 2c0a 2020 2020 2020  _filters,.      
+00005e40: 2020 2020 2020 7370 6172 7365 3d54 7275        sparse=Tru
+00005e50: 652c 0a20 2020 2020 2020 2029 0a20 2020  e,.        ).   
+00005e60: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00005e70: 5472 7565 2873 6368 656d 612e 7370 6172  True(schema.spar
+00005e80: 7365 290a 0a20 2020 2020 2020 2073 6368  se)..        sch
+00005e90: 656d 612e 6475 6d70 2829 0a20 2020 2020  ema.dump().     
+00005ea0: 2020 2061 7373 6572 745f 6361 7074 7572     assert_captur
+00005eb0: 6564 2863 6170 6664 2c20 2241 7272 6179  ed(capfd, "Array
+00005ec0: 2074 7970 653a 2073 7061 7273 6522 290a   type: sparse").
+00005ed0: 0a20 2020 2020 2020 2023 206d 616b 6520  .        # make 
+00005ee0: 7375 7265 2077 6520 6361 6e20 636f 6e73  sure we can cons
+00005ef0: 7472 7563 7420 4172 7261 7953 6368 656d  truct ArraySchem
+00005f00: 6120 7769 7468 2070 7974 686f 6e20 6c69  a with python li
+00005f10: 7374 7320 6f66 2066 696c 7465 7273 0a20  sts of filters. 
+00005f20: 2020 2020 2020 2073 6368 656d 6132 203d         schema2 =
+00005f30: 2074 696c 6564 622e 4172 7261 7953 6368   tiledb.ArraySch
+00005f40: 656d 6128 0a20 2020 2020 2020 2020 2020  ema(.           
+00005f50: 2064 6f6d 6169 6e3d 646f 6d61 696e 2c0a   domain=domain,.
+00005f60: 2020 2020 2020 2020 2020 2020 6174 7472              attr
+00005f70: 733d 2861 312c 2061 3229 2c0a 2020 2020  s=(a1, a2),.    
+00005f80: 2020 2020 2020 2020 6361 7061 6369 7479          capacity
+00005f90: 3d31 302c 0a20 2020 2020 2020 2020 2020  =10,.           
+00005fa0: 2063 656c 6c5f 6f72 6465 723d 2263 6f6c   cell_order="col
+00005fb0: 2d6d 616a 6f72 222c 0a20 2020 2020 2020  -major",.       
+00005fc0: 2020 2020 2074 696c 655f 6f72 6465 723d       tile_order=
+00005fd0: 2272 6f77 2d6d 616a 6f72 222c 0a20 2020  "row-major",.   
+00005fe0: 2020 2020 2020 2020 2063 6f6f 7264 735f           coords_
+00005ff0: 6669 6c74 6572 733d 636f 6f72 6473 5f66  filters=coords_f
+00006000: 696c 7465 7273 5f70 796c 6973 742c 0a20  ilters_pylist,. 
+00006010: 2020 2020 2020 2020 2020 206f 6666 7365             offse
+00006020: 7473 5f66 696c 7465 7273 3d6f 6666 5f66  ts_filters=off_f
+00006030: 696c 7465 7273 2c0a 2020 2020 2020 2020  ilters,.        
+00006040: 2020 2020 7370 6172 7365 3d54 7275 652c      sparse=True,
+00006050: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00006060: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00006070: 7561 6c28 6c65 6e28 7363 6865 6d61 322e  ual(len(schema2.
+00006080: 636f 6f72 6473 5f66 696c 7465 7273 292c  coords_filters),
+00006090: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
+000060a0: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
+000060b0: 2873 6368 656d 6132 2e6f 6666 7365 7473  (schema2.offsets
+000060c0: 5f66 696c 7465 7273 292c 2031 290a 0a20  _filters), 1).. 
+000060d0: 2020 2064 6566 2074 6573 745f 6d69 7865     def test_mixe
+000060e0: 645f 7374 7269 6e67 5f73 6368 656d 6128  d_string_schema(
+000060f0: 7365 6c66 293a 0a20 2020 2020 2020 2064  self):.        d
+00006100: 696d 7320 3d20 5b0a 2020 2020 2020 2020  ims = [.        
+00006110: 2020 2020 7469 6c65 6462 2e44 696d 286e      tiledb.Dim(n
+00006120: 616d 653d 2264 706f 7322 2c20 646f 6d61  ame="dpos", doma
+00006130: 696e 3d28 2d31 3030 2e30 2c20 3130 302e  in=(-100.0, 100.
+00006140: 3029 2c20 7469 6c65 3d31 302c 2064 7479  0), tile=10, dty
+00006150: 7065 3d6e 702e 666c 6f61 7436 3429 2c0a  pe=np.float64),.
+00006160: 2020 2020 2020 2020 2020 2020 7469 6c65              tile
+00006170: 6462 2e44 696d 280a 2020 2020 2020 2020  db.Dim(.        
+00006180: 2020 2020 2020 2020 6e61 6d65 3d22 7374          name="st
+00006190: 725f 696e 6465 7822 2c20 646f 6d61 696e  r_index", domain
+000061a0: 3d28 4e6f 6e65 2c20 4e6f 6e65 292c 2074  =(None, None), t
+000061b0: 696c 653d 4e6f 6e65 2c20 6474 7970 653d  ile=None, dtype=
+000061c0: 6e70 2e62 7974 6573 5f0a 2020 2020 2020  np.bytes_.      
+000061d0: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+000061e0: 205d 0a20 2020 2020 2020 2064 6f6d 203d   ].        dom =
+000061f0: 2074 696c 6564 622e 446f 6d61 696e 282a   tiledb.Domain(*
+00006200: 6469 6d73 290a 2020 2020 2020 2020 6174  dims).        at
+00006210: 7472 7320 3d20 5b74 696c 6564 622e 4174  trs = [tiledb.At
+00006220: 7472 286e 616d 653d 2276 616c 222c 2064  tr(name="val", d
+00006230: 7479 7065 3d6e 702e 666c 6f61 7436 3429  type=np.float64)
+00006240: 5d0a 0a20 2020 2020 2020 2073 6368 656d  ]..        schem
+00006250: 6120 3d20 7469 6c65 6462 2e41 7272 6179  a = tiledb.Array
+00006260: 5363 6865 6d61 2864 6f6d 6169 6e3d 646f  Schema(domain=do
+00006270: 6d2c 2061 7474 7273 3d61 7474 7273 2c20  m, attrs=attrs, 
+00006280: 7370 6172 7365 3d54 7275 6529 0a0a 2020  sparse=True)..  
+00006290: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000062a0: 7454 7275 6528 7363 6865 6d61 2e64 6f6d  tTrue(schema.dom
+000062b0: 6169 6e2e 6861 735f 6469 6d28 2273 7472  ain.has_dim("str
+000062c0: 5f69 6e64 6578 2229 290a 2020 2020 2020  _index")).      
+000062d0: 2020 7365 6c66 2e61 7373 6572 7446 616c    self.assertFal
+000062e0: 7365 2873 6368 656d 612e 646f 6d61 696e  se(schema.domain
+000062f0: 2e68 6173 5f64 696d 2822 6e6f 6e6f 6e6f  .has_dim("nonono
+00006300: 5f73 7472 5f69 6e64 6578 2229 290a 2020  _str_index")).  
+00006310: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00006320: 7454 7275 6528 7363 6865 6d61 2e64 6f6d  tTrue(schema.dom
+00006330: 6169 6e2e 6469 6d28 2273 7472 5f69 6e64  ain.dim("str_ind
+00006340: 6578 2229 2e69 7376 6172 290a 2020 2020  ex").isvar).    
+00006350: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
+00006360: 616c 7365 2873 6368 656d 612e 646f 6d61  alse(schema.doma
+00006370: 696e 2e64 696d 2822 6470 6f73 2229 2e69  in.dim("dpos").i
+00006380: 7376 6172 290a 2020 2020 2020 2020 7365  svar).        se
+00006390: 6c66 2e61 7373 6572 7445 7175 616c 2873  lf.assertEqual(s
+000063a0: 6368 656d 612e 646f 6d61 696e 2e64 696d  chema.domain.dim
+000063b0: 2822 6470 6f73 2229 2e64 7479 7065 2c20  ("dpos").dtype, 
+000063c0: 6e70 2e64 6f75 626c 6529 0a20 2020 2020  np.double).     
+000063d0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000063e0: 7561 6c28 7363 6865 6d61 2e64 6f6d 6169  ual(schema.domai
+000063f0: 6e2e 6469 6d28 2273 7472 5f69 6e64 6578  n.dim("str_index
+00006400: 2229 2e64 7479 7065 2c20 6e70 2e62 7974  ").dtype, np.byt
+00006410: 6573 5f29 0a20 2020 2020 2020 2073 656c  es_).        sel
+00006420: 662e 6173 7365 7274 4661 6c73 6528 7363  f.assertFalse(sc
+00006430: 6865 6d61 2e64 6f6d 6169 6e2e 686f 6d6f  hema.domain.homo
+00006440: 6765 6e65 6f75 7329 0a0a 0a63 6c61 7373  geneous)...class
+00006450: 2041 7272 6179 5465 7374 2844 6973 6b54   ArrayTest(DiskT
+00006460: 6573 7443 6173 6529 3a0a 2020 2020 6465  estCase):.    de
+00006470: 6620 6372 6561 7465 5f61 7272 6179 5f73  f create_array_s
+00006480: 6368 656d 6128 7365 6c66 293a 0a20 2020  chema(self):.   
+00006490: 2020 2020 2064 6f6d 6169 6e20 3d20 7469       domain = ti
+000064a0: 6c65 6462 2e44 6f6d 6169 6e28 0a20 2020  ledb.Domain(.   
+000064b0: 2020 2020 2020 2020 2074 696c 6564 622e           tiledb.
+000064c0: 4469 6d28 646f 6d61 696e 3d28 312c 2038  Dim(domain=(1, 8
+000064d0: 292c 2074 696c 653d 3229 2c20 7469 6c65  ), tile=2), tile
+000064e0: 6462 2e44 696d 2864 6f6d 6169 6e3d 2831  db.Dim(domain=(1
+000064f0: 2c20 3829 2c20 7469 6c65 3d32 290a 2020  , 8), tile=2).  
+00006500: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00006510: 6131 203d 2074 696c 6564 622e 4174 7472  a1 = tiledb.Attr
+00006520: 2822 7661 6c22 2c20 6474 7970 653d 2266  ("val", dtype="f
+00006530: 3822 290a 2020 2020 2020 2020 7265 7475  8").        retu
+00006540: 726e 2074 696c 6564 622e 4172 7261 7953  rn tiledb.ArrayS
+00006550: 6368 656d 6128 646f 6d61 696e 3d64 6f6d  chema(domain=dom
+00006560: 6169 6e2c 2061 7474 7273 3d28 6131 2c29  ain, attrs=(a1,)
+00006570: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00006580: 6172 7261 795f 6372 6561 7465 2873 656c  array_create(sel
+00006590: 6629 3a0a 2020 2020 2020 2020 636f 6e66  f):.        conf
+000065a0: 6967 203d 2074 696c 6564 622e 436f 6e66  ig = tiledb.Conf
+000065b0: 6967 2829 0a20 2020 2020 2020 2063 6f6e  ig().        con
+000065c0: 6669 675b 2273 6d2e 636f 6e73 6f6c 6964  fig["sm.consolid
+000065d0: 6174 696f 6e2e 7374 6570 5f6d 696e 5f66  ation.step_min_f
+000065e0: 7261 6722 5d20 3d20 300a 2020 2020 2020  rag"] = 0.      
+000065f0: 2020 636f 6e66 6967 5b22 736d 2e63 6f6e    config["sm.con
+00006600: 736f 6c69 6461 7469 6f6e 2e73 7465 7073  solidation.steps
+00006610: 225d 203d 2031 0a20 2020 2020 2020 2073  "] = 1.        s
+00006620: 6368 656d 6120 3d20 7365 6c66 2e63 7265  chema = self.cre
+00006630: 6174 655f 6172 7261 795f 7363 6865 6d61  ate_array_schema
+00006640: 2829 0a0a 2020 2020 2020 2020 2320 7065  ()..        # pe
+00006650: 7273 6973 7420 6172 7261 7920 7363 6865  rsist array sche
+00006660: 6d61 0a20 2020 2020 2020 2074 696c 6564  ma.        tiled
+00006670: 622e 6c69 6274 696c 6564 622e 4172 7261  b.libtiledb.Arra
+00006680: 792e 6372 6561 7465 2873 656c 662e 7061  y.create(self.pa
+00006690: 7468 2822 666f 6f22 292c 2073 6368 656d  th("foo"), schem
+000066a0: 6129 0a0a 2020 2020 2020 2020 2320 7468  a)..        # th
+000066b0: 6573 6520 7368 6f75 6c64 2062 6520 6e6f  ese should be no
+000066c0: 2d6f 7073 0a20 2020 2020 2020 2023 2020  -ops.        #  
+000066d0: 2066 756c 6c20 7369 676e 6174 7572 650a   full signature.
+000066e0: 2020 2020 2020 2020 7469 6c65 6462 2e63          tiledb.c
+000066f0: 6f6e 736f 6c69 6461 7465 2873 656c 662e  onsolidate(self.
+00006700: 7061 7468 2822 666f 6f22 292c 2063 6f6e  path("foo"), con
+00006710: 6669 673d 636f 6e66 6967 290a 2020 2020  fig=config).    
+00006720: 2020 2020 2320 2020 6b77 2073 6967 6e61      #   kw signa
+00006730: 7475 7265 0a20 2020 2020 2020 2074 696c  ture.        til
+00006740: 6564 622e 636f 6e73 6f6c 6964 6174 6528  edb.consolidate(
+00006750: 7572 693d 7365 6c66 2e70 6174 6828 2266  uri=self.path("f
+00006760: 6f6f 2229 290a 0a20 2020 2020 2020 2023  oo"))..        #
+00006770: 206c 6f61 6420 6172 7261 7920 696e 2072   load array in r
+00006780: 6561 646f 6e6c 7920 6d6f 6465 0a20 2020  eadonly mode.   
+00006790: 2020 2020 2061 7272 6179 203d 2074 696c       array = til
+000067a0: 6564 622e 6c69 6274 696c 6564 622e 4172  edb.libtiledb.Ar
+000067b0: 7261 7928 7365 6c66 2e70 6174 6828 2266  ray(self.path("f
+000067c0: 6f6f 2229 2c20 6d6f 6465 3d22 7222 290a  oo"), mode="r").
+000067d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000067e0: 6572 7454 7275 6528 6172 7261 792e 6973  ertTrue(array.is
+000067f0: 6f70 656e 290a 2020 2020 2020 2020 7365  open).        se
+00006800: 6c66 2e61 7373 6572 7445 7175 616c 2861  lf.assertEqual(a
+00006810: 7272 6179 2e73 6368 656d 612c 2073 6368  rray.schema, sch
+00006820: 656d 6129 0a20 2020 2020 2020 2073 656c  ema).        sel
+00006830: 662e 6173 7365 7274 4571 7561 6c28 6172  f.assertEqual(ar
+00006840: 7261 792e 6d6f 6465 2c20 2272 2229 0a20  ray.mode, "r"). 
+00006850: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00006860: 7274 4571 7561 6c28 6172 7261 792e 7572  rtEqual(array.ur
+00006870: 692c 2073 656c 662e 7061 7468 2822 666f  i, self.path("fo
+00006880: 6f22 2929 0a0a 2020 2020 2020 2020 2320  o"))..        # 
+00006890: 7465 7374 2074 6861 7420 7765 2063 616e  test that we can
+000068a0: 6e6f 7420 636f 6e73 6f6c 6964 6174 6520  not consolidate 
+000068b0: 616e 2061 7272 6179 2069 6e20 7265 6164  an array in read
+000068c0: 6f6e 6c79 206d 6f64 650a 2020 2020 2020  only mode.      
+000068d0: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
+000068e0: 7274 5261 6973 6573 2874 696c 6564 622e  rtRaises(tiledb.
+000068f0: 5469 6c65 4442 4572 726f 7229 3a0a 2020  TileDBError):.  
+00006900: 2020 2020 2020 2020 2020 6172 7261 792e            array.
+00006910: 636f 6e73 6f6c 6964 6174 6528 290a 0a20  consolidate().. 
+00006920: 2020 2020 2020 2023 2077 6520 6861 7665         # we have
+00006930: 206e 6f74 2077 7269 7474 656e 2061 6e79   not written any
+00006940: 7468 696e 672c 2073 6f20 7468 6520 6172  thing, so the ar
+00006950: 7261 7920 6973 2065 6d70 7479 0a20 2020  ray is empty.   
+00006960: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006970: 4973 4e6f 6e65 2861 7272 6179 2e6e 6f6e  IsNone(array.non
+00006980: 656d 7074 795f 646f 6d61 696e 2829 290a  empty_domain()).
+00006990: 0a20 2020 2020 2020 2061 7272 6179 2e72  .        array.r
+000069a0: 656f 7065 6e28 290a 2020 2020 2020 2020  eopen().        
+000069b0: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
+000069c0: 6172 7261 792e 6973 6f70 656e 290a 0a20  array.isopen).. 
+000069d0: 2020 2020 2020 2061 7272 6179 2e63 6c6f         array.clo
+000069e0: 7365 2829 0a20 2020 2020 2020 2073 656c  se().        sel
+000069f0: 662e 6173 7365 7274 4571 7561 6c28 6172  f.assertEqual(ar
+00006a00: 7261 792e 6973 6f70 656e 2c20 4661 6c73  ray.isopen, Fals
+00006a10: 6529 0a0a 2020 2020 2020 2020 7769 7468  e)..        with
+00006a20: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
+00006a30: 6573 2874 696c 6564 622e 5469 6c65 4442  es(tiledb.TileDB
+00006a40: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+00006a50: 2020 2020 2320 6361 6e6e 6f74 2067 6574      # cannot get
+00006a60: 2073 6368 656d 6120 6672 6f6d 2063 6c6f   schema from clo
+00006a70: 7365 6420 6172 7261 790a 2020 2020 2020  sed array.      
+00006a80: 2020 2020 2020 6172 7261 792e 7363 6865        array.sche
+00006a90: 6d61 0a0a 2020 2020 2020 2020 7769 7468  ma..        with
+00006aa0: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
+00006ab0: 6573 2874 696c 6564 622e 5469 6c65 4442  es(tiledb.TileDB
+00006ac0: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+00006ad0: 2020 2020 2320 6361 6e6e 6f74 2072 652d      # cannot re-
+00006ae0: 6f70 656e 2061 2063 6c6f 7365 6420 6172  open a closed ar
+00006af0: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
+00006b00: 6172 7261 792e 7265 6f70 656e 2829 0a0a  array.reopen()..
+00006b10: 2020 2020 6465 6620 7465 7374 5f61 7272      def test_arr
+00006b20: 6179 5f63 7265 6174 655f 7769 7468 5f63  ay_create_with_c
+00006b30: 7478 2873 656c 6629 3a0a 2020 2020 2020  tx(self):.      
+00006b40: 2020 7363 6865 6d61 203d 2073 656c 662e    schema = self.
+00006b50: 6372 6561 7465 5f61 7272 6179 5f73 6368  create_array_sch
+00006b60: 656d 6128 290a 0a20 2020 2020 2020 2077  ema()..        w
+00006b70: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
+00006b80: 6169 7365 7328 5479 7065 4572 726f 7229  aises(TypeError)
+00006b90: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
+00006ba0: 6c65 6462 2e6c 6962 7469 6c65 6462 2e41  ledb.libtiledb.A
+00006bb0: 7272 6179 2e63 7265 6174 6528 7365 6c66  rray.create(self
+00006bc0: 2e70 6174 6828 2266 6f6f 2229 2c20 7363  .path("foo"), sc
+00006bd0: 6865 6d61 2c20 6374 783d 2266 6f6f 2229  hema, ctx="foo")
+00006be0: 0a0a 2020 2020 2020 2020 2320 7065 7273  ..        # pers
+00006bf0: 6973 7420 6172 7261 7920 7363 6865 6d61  ist array schema
+00006c00: 0a20 2020 2020 2020 2074 696c 6564 622e  .        tiledb.
+00006c10: 6c69 6274 696c 6564 622e 4172 7261 792e  libtiledb.Array.
+00006c20: 6372 6561 7465 2873 656c 662e 7061 7468  create(self.path
+00006c30: 2822 666f 6f22 292c 2073 6368 656d 612c  ("foo"), schema,
+00006c40: 2063 7478 3d74 696c 6564 622e 4374 7828   ctx=tiledb.Ctx(
+00006c50: 2929 0a0a 2020 2020 4070 7974 6573 742e  ))..    @pytest.
+00006c60: 6d61 726b 2e73 6b69 7069 6628 0a20 2020  mark.skipif(.   
+00006c70: 2020 2020 206e 6f74 2028 7379 732e 706c       not (sys.pl
+00006c80: 6174 666f 726d 203d 3d20 2277 696e 3332  atform == "win32
+00006c90: 2220 616e 6420 7469 6c65 6462 2e6c 6962  " and tiledb.lib
+00006ca0: 7469 6c65 6462 2e76 6572 7369 6f6e 2829  tiledb.version()
+00006cb0: 203e 3d20 2832 2c20 332c 2030 2929 2c0a   >= (2, 3, 0)),.
+00006cc0: 2020 2020 2020 2020 7265 6173 6f6e 3d22          reason="
+00006cd0: 5368 6172 6564 206e 6574 776f 726b 2064  Shared network d
+00006ce0: 7269 7665 206f 6e6c 7920 6f6e 2057 696e  rive only on Win
+00006cf0: 3332 222c 0a20 2020 2029 0a20 2020 2064  32",.    ).    d
+00006d00: 6566 2074 6573 745f 6172 7261 795f 6372  ef test_array_cr
+00006d10: 6561 7465 5f6f 6e5f 7368 6172 6564 5f64  eate_on_shared_d
+00006d20: 7269 7665 2873 656c 6629 3a0a 2020 2020  rive(self):.    
+00006d30: 2020 2020 7363 6865 6d61 203d 2073 656c      schema = sel
+00006d40: 662e 6372 6561 7465 5f61 7272 6179 5f73  f.create_array_s
+00006d50: 6368 656d 6128 290a 2020 2020 2020 2020  chema().        
+00006d60: 7572 6920 3d20 7365 6c66 2e70 6174 6828  uri = self.path(
+00006d70: 6261 7365 6e61 6d65 3d22 666f 6f22 2c20  basename="foo", 
+00006d80: 7368 6172 6564 3d54 7275 6529 0a0a 2020  shared=True)..  
+00006d90: 2020 2020 2020 7469 6c65 6462 2e6c 6962        tiledb.lib
+00006da0: 7469 6c65 6462 2e41 7272 6179 2e63 7265  tiledb.Array.cre
+00006db0: 6174 6528 7572 692c 2073 6368 656d 6129  ate(uri, schema)
+00006dc0: 0a0a 2020 2020 2020 2020 2320 6c6f 6164  ..        # load
+00006dd0: 2061 7272 6179 2069 6e20 7265 6164 6f6e   array in readon
+00006de0: 6c79 206d 6f64 650a 2020 2020 2020 2020  ly mode.        
+00006df0: 6172 7261 7920 3d20 7469 6c65 6462 2e6c  array = tiledb.l
+00006e00: 6962 7469 6c65 6462 2e41 7272 6179 2875  ibtiledb.Array(u
+00006e10: 7269 2c20 6d6f 6465 3d22 7222 290a 2020  ri, mode="r").  
+00006e20: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00006e30: 7454 7275 6528 6172 7261 792e 6973 6f70  tTrue(array.isop
+00006e40: 656e 290a 2020 2020 2020 2020 7365 6c66  en).        self
+00006e50: 2e61 7373 6572 7445 7175 616c 2861 7272  .assertEqual(arr
+00006e60: 6179 2e73 6368 656d 612c 2073 6368 656d  ay.schema, schem
+00006e70: 6129 0a20 2020 2020 2020 2073 656c 662e  a).        self.
+00006e80: 6173 7365 7274 4571 7561 6c28 6172 7261  assertEqual(arra
+00006e90: 792e 6d6f 6465 2c20 2272 2229 0a20 2020  y.mode, "r").   
+00006ea0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006eb0: 4571 7561 6c28 6172 7261 792e 7572 692c  Equal(array.uri,
+00006ec0: 2075 7269 290a 0a20 2020 2020 2020 2023   uri)..        #
+00006ed0: 2077 6520 6861 7665 206e 6f74 2077 7269   we have not wri
+00006ee0: 7474 656e 2061 6e79 7468 696e 672c 2073  tten anything, s
+00006ef0: 6f20 7468 6520 6172 7261 7920 6973 2065  o the array is e
+00006f00: 6d70 7479 0a20 2020 2020 2020 2073 656c  mpty.        sel
+00006f10: 662e 6173 7365 7274 4973 4e6f 6e65 2861  f.assertIsNone(a
+00006f20: 7272 6179 2e6e 6f6e 656d 7074 795f 646f  rray.nonempty_do
+00006f30: 6d61 696e 2829 290a 0a20 2020 2020 2020  main())..       
+00006f40: 2061 7272 6179 2e72 656f 7065 6e28 290a   array.reopen().
+00006f50: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00006f60: 6572 7454 7275 6528 6172 7261 792e 6973  ertTrue(array.is
+00006f70: 6f70 656e 290a 0a20 2020 2020 2020 2061  open)..        a
+00006f80: 7272 6179 2e63 6c6f 7365 2829 0a20 2020  rray.close().   
+00006f90: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00006fa0: 4571 7561 6c28 6172 7261 792e 6973 6f70  Equal(array.isop
+00006fb0: 656e 2c20 4661 6c73 6529 0a0a 2020 2020  en, False)..    
+00006fc0: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
+00006fd0: 7365 7274 5261 6973 6573 2874 696c 6564  sertRaises(tiled
+00006fe0: 622e 5469 6c65 4442 4572 726f 7229 3a0a  b.TileDBError):.
+00006ff0: 2020 2020 2020 2020 2020 2020 2320 6361              # ca
+00007000: 6e6e 6f74 2067 6574 2073 6368 656d 6120  nnot get schema 
+00007010: 6672 6f6d 2063 6c6f 7365 6420 6172 7261  from closed arra
+00007020: 790a 2020 2020 2020 2020 2020 2020 6172  y.            ar
+00007030: 7261 792e 7363 6865 6d61 0a0a 2020 2020  ray.schema..    
+00007040: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
+00007050: 7365 7274 5261 6973 6573 2874 696c 6564  sertRaises(tiled
+00007060: 622e 5469 6c65 4442 4572 726f 7229 3a0a  b.TileDBError):.
+00007070: 2020 2020 2020 2020 2020 2020 2320 6361              # ca
+00007080: 6e6e 6f74 2072 652d 6f70 656e 2061 2063  nnot re-open a c
+00007090: 6c6f 7365 6420 6172 7261 790a 2020 2020  losed array.    
+000070a0: 2020 2020 2020 2020 6172 7261 792e 7265          array.re
+000070b0: 6f70 656e 2829 0a0a 2020 2020 6465 6620  open()..    def 
+000070c0: 7465 7374 5f61 7272 6179 5f63 7265 6174  test_array_creat
+000070d0: 655f 656e 6372 7970 7465 6428 7365 6c66  e_encrypted(self
+000070e0: 293a 0a20 2020 2020 2020 2063 6f6e 6669  ):.        confi
+000070f0: 6720 3d20 7469 6c65 6462 2e43 6f6e 6669  g = tiledb.Confi
+00007100: 6728 290a 2020 2020 2020 2020 636f 6e66  g().        conf
+00007110: 6967 5b22 736d 2e63 6f6e 736f 6c69 6461  ig["sm.consolida
+00007120: 7469 6f6e 2e73 7465 705f 6d69 6e5f 6672  tion.step_min_fr
+00007130: 6167 7322 5d20 3d20 300a 2020 2020 2020  ags"] = 0.      
+00007140: 2020 636f 6e66 6967 5b22 736d 2e63 6f6e    config["sm.con
+00007150: 736f 6c69 6461 7469 6f6e 2e73 7465 7073  solidation.steps
+00007160: 225d 203d 2031 0a20 2020 2020 2020 2073  "] = 1.        s
+00007170: 6368 656d 6120 3d20 7365 6c66 2e63 7265  chema = self.cre
+00007180: 6174 655f 6172 7261 795f 7363 6865 6d61  ate_array_schema
+00007190: 2829 0a20 2020 2020 2020 2023 2070 6572  ().        # per
+000071a0: 7369 7374 2061 7272 6179 2073 6368 656d  sist array schem
+000071b0: 610a 2020 2020 2020 2020 7469 6c65 6462  a.        tiledb
+000071c0: 2e6c 6962 7469 6c65 6462 2e41 7272 6179  .libtiledb.Array
+000071d0: 2e63 7265 6174 6528 0a20 2020 2020 2020  .create(.       
+000071e0: 2020 2020 2073 656c 662e 7061 7468 2822       self.path("
+000071f0: 666f 6f22 292c 2073 6368 656d 612c 206b  foo"), schema, k
+00007200: 6579 3d62 2230 3132 3334 3536 3738 3961  ey=b"0123456789a
+00007210: 6263 6465 4630 3132 3334 3536 3738 3961  bcdeF0123456789a
+00007220: 6263 6465 4622 0a20 2020 2020 2020 2029  bcdeF".        )
+00007230: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
+00007240: 6b20 7468 6174 2077 6520 6361 6e20 6f70  k that we can op
+00007250: 656e 2074 6865 2061 7272 6179 2073 7563  en the array suc
+00007260: 6573 7366 756c 6c79 0a20 2020 2020 2020  essfully.       
+00007270: 2066 6f72 206b 6579 2069 6e20 280a 2020   for key in (.  
+00007280: 2020 2020 2020 2020 2020 6222 3031 3233            b"0123
+00007290: 3435 3637 3839 6162 6364 6546 3031 3233  456789abcdeF0123
+000072a0: 3435 3637 3839 6162 6364 6546 222c 0a20  456789abcdeF",. 
+000072b0: 2020 2020 2020 2020 2020 2022 3031 3233             "0123
+000072c0: 3435 3637 3839 6162 6364 6546 3031 3233  456789abcdeF0123
+000072d0: 3435 3637 3839 6162 6364 6546 222c 0a20  456789abcdeF",. 
+000072e0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+000072f0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+00007300: 622e 6c69 6274 696c 6564 622e 4172 7261  b.libtiledb.Arra
+00007310: 7928 7365 6c66 2e70 6174 6828 2266 6f6f  y(self.path("foo
+00007320: 2229 2c20 6d6f 6465 3d22 7222 2c20 6b65  "), mode="r", ke
+00007330: 793d 6b65 7929 2061 7320 6172 7261 793a  y=key) as array:
+00007340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007350: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
+00007360: 2861 7272 6179 2e69 736f 7065 6e29 0a20  (array.isopen). 
+00007370: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00007380: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00007390: 6172 7261 792e 7363 6865 6d61 2c20 7363  array.schema, sc
+000073a0: 6865 6d61 290a 2020 2020 2020 2020 2020  hema).          
+000073b0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+000073c0: 7445 7175 616c 2861 7272 6179 2e6d 6f64  tEqual(array.mod
+000073d0: 652c 2022 7222 290a 2020 2020 2020 2020  e, "r").        
+000073e0: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+000073f0: 6f70 656e 2873 656c 662e 7061 7468 2822  open(self.path("
+00007400: 666f 6f22 292c 206d 6f64 653d 2272 222c  foo"), mode="r",
+00007410: 206b 6579 3d6b 6579 2920 6173 2061 7272   key=key) as arr
+00007420: 6179 3a0a 2020 2020 2020 2020 2020 2020  ay:.            
+00007430: 2020 2020 7365 6c66 2e61 7373 6572 7454      self.assertT
+00007440: 7275 6528 6172 7261 792e 6973 6f70 656e  rue(array.isopen
+00007450: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00007460: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00007470: 616c 2861 7272 6179 2e73 6368 656d 612c  al(array.schema,
+00007480: 2073 6368 656d 6129 0a20 2020 2020 2020   schema).       
+00007490: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000074a0: 7365 7274 4571 7561 6c28 6172 7261 792e  sertEqual(array.
+000074b0: 6d6f 6465 2c20 2272 2229 0a0a 2020 2020  mode, "r")..    
+000074c0: 2020 2020 2020 2020 7469 6c65 6462 2e63          tiledb.c
+000074d0: 6f6e 736f 6c69 6461 7465 2875 7269 3d73  onsolidate(uri=s
+000074e0: 656c 662e 7061 7468 2822 666f 6f22 292c  elf.path("foo"),
+000074f0: 2063 6f6e 6669 673d 636f 6e66 6967 2c20   config=config, 
+00007500: 6b65 793d 6b65 7929 0a0a 2020 2020 2020  key=key)..      
+00007510: 2020 2320 6368 6563 6b20 7468 6174 206f    # check that o
+00007520: 7065 6e69 6e67 2074 6865 2061 7272 6179  pening the array
+00007530: 2077 6974 6820 7468 6520 7772 6f6e 6720   with the wrong 
+00007540: 6b65 7920 6661 696c 733a 0a20 2020 2020  key fails:.     
+00007550: 2020 2077 6974 6820 7365 6c66 2e61 7373     with self.ass
+00007560: 6572 7452 6169 7365 7328 7469 6c65 6462  ertRaises(tiledb
+00007570: 2e54 696c 6544 4245 7272 6f72 293a 0a20  .TileDBError):. 
+00007580: 2020 2020 2020 2020 2020 2074 696c 6564             tiled
+00007590: 622e 6c69 6274 696c 6564 622e 4172 7261  b.libtiledb.Arra
+000075a0: 7928 0a20 2020 2020 2020 2020 2020 2020  y(.             
+000075b0: 2020 2073 656c 662e 7061 7468 2822 666f     self.path("fo
+000075c0: 6f22 292c 206d 6f64 653d 2272 222c 206b  o"), mode="r", k
+000075d0: 6579 3d62 2230 3132 3334 3536 3738 3961  ey=b"0123456789a
+000075e0: 6263 6465 4630 3132 3334 3536 3738 3961  bcdeF0123456789a
+000075f0: 6263 6465 5822 0a20 2020 2020 2020 2020  bcdeX".         
+00007600: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+00007610: 6368 6563 6b20 7468 6174 206f 7065 6e69  check that openi
+00007620: 6e67 2074 6865 2061 7272 6179 2077 6974  ng the array wit
+00007630: 6820 7468 6520 7772 6f6e 6720 6b65 7920  h the wrong key 
+00007640: 6c65 6e67 7468 2066 6169 6c73 3a0a 2020  length fails:.  
+00007650: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
+00007660: 6173 7365 7274 5261 6973 6573 2874 696c  assertRaises(til
+00007670: 6564 622e 5469 6c65 4442 4572 726f 7229  edb.TileDBError)
+00007680: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
+00007690: 6c65 6462 2e6c 6962 7469 6c65 6462 2e41  ledb.libtiledb.A
+000076a0: 7272 6179 280a 2020 2020 2020 2020 2020  rray(.          
+000076b0: 2020 2020 2020 7365 6c66 2e70 6174 6828        self.path(
+000076c0: 2266 6f6f 2229 2c20 6d6f 6465 3d22 7222  "foo"), mode="r"
+000076d0: 2c20 6b65 793d 6222 3031 3233 3435 3637  , key=b"01234567
+000076e0: 3839 6162 6364 6546 3031 3233 3435 3637  89abcdeF01234567
+000076f0: 3839 6162 6364 6522 0a20 2020 2020 2020  89abcde".       
+00007700: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00007710: 2320 6368 6563 6b20 7468 6174 2063 6f6e  # check that con
+00007720: 736f 6c69 6461 7469 6e67 2074 6865 2061  solidating the a
+00007730: 7272 6179 2077 6974 6820 7468 6520 7772  rray with the wr
+00007740: 6f6e 6720 6b65 7920 6661 696c 733a 0a20  ong key fails:. 
+00007750: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+00007760: 2e61 7373 6572 7452 6169 7365 7328 7469  .assertRaises(ti
+00007770: 6c65 6462 2e54 696c 6544 4245 7272 6f72  ledb.TileDBError
+00007780: 293a 0a20 2020 2020 2020 2020 2020 2074  ):.            t
+00007790: 696c 6564 622e 636f 6e73 6f6c 6964 6174  iledb.consolidat
+000077a0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+000077b0: 2020 2073 656c 662e 7061 7468 2822 666f     self.path("fo
+000077c0: 6f22 292c 2063 6f6e 6669 673d 636f 6e66  o"), config=conf
+000077d0: 6967 2c20 6b65 793d 6222 3031 3233 3435  ig, key=b"012345
+000077e0: 3637 3839 6162 6364 6546 3031 3233 3435  6789abcdeF012345
+000077f0: 3637 3839 6162 6364 6522 0a20 2020 2020  6789abcde".     
+00007800: 2020 2020 2020 2029 0a0a 2020 2020 2320         )..    # 
+00007810: 6e65 6564 7320 636f 7265 2066 6978 2069  needs core fix i
+00007820: 6e20 322e 322e 340a 2020 2020 4070 7974  n 2.2.4.    @pyt
+00007830: 6573 742e 6d61 726b 2e73 6b69 7069 6628  est.mark.skipif(
+00007840: 0a20 2020 2020 2020 2028 7379 732e 706c  .        (sys.pl
+00007850: 6174 666f 726d 203d 3d20 2277 696e 3332  atform == "win32
+00007860: 2220 616e 6420 7469 6c65 6462 2e6c 6962  " and tiledb.lib
+00007870: 7469 6c65 6462 2e76 6572 7369 6f6e 2829  tiledb.version()
+00007880: 203d 3d20 2832 2c20 322c 2033 2929 2c0a   == (2, 2, 3)),.
+00007890: 2020 2020 2020 2020 7265 6173 6f6e 3d22          reason="
+000078a0: 536b 6970 2061 7272 6179 5f64 6f65 736e  Skip array_doesn
+000078b0: 745f 6578 6973 7420 7465 7374 206f 6e20  t_exist test on 
+000078c0: 5769 6e33 3220 2f20 6c69 6274 696c 6564  Win32 / libtiled
+000078d0: 6220 322e 322e 3322 2c0a 2020 2020 290a  b 2.2.3",.    ).
+000078e0: 2020 2020 6465 6620 7465 7374 5f61 7272      def test_arr
+000078f0: 6179 5f64 6f65 736e 745f 6578 6973 7428  ay_doesnt_exist(
+00007900: 7365 6c66 293a 0a20 2020 2020 2020 2077  self):.        w
+00007910: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
+00007920: 6169 7365 7328 7469 6c65 6462 2e54 696c  aises(tiledb.Til
+00007930: 6544 4245 7272 6f72 293a 0a20 2020 2020  eDBError):.     
+00007940: 2020 2020 2020 2074 696c 6564 622e 6c69         tiledb.li
+00007950: 6274 696c 6564 622e 4172 7261 7928 7365  btiledb.Array(se
+00007960: 6c66 2e70 6174 6828 2266 6f6f 2229 2c20  lf.path("foo"), 
+00007970: 6d6f 6465 3d22 7222 290a 0a20 2020 2064  mode="r")..    d
+00007980: 6566 2074 6573 745f 6372 6561 7465 5f73  ef test_create_s
+00007990: 6368 656d 615f 6d61 7463 6865 7328 7365  chema_matches(se
+000079a0: 6c66 293a 0a20 2020 2020 2020 2064 696d  lf):.        dim
+000079b0: 7320 3d20 2874 696c 6564 622e 4469 6d28  s = (tiledb.Dim(
+000079c0: 646f 6d61 696e 3d28 302c 2036 292c 2074  domain=(0, 6), t
+000079d0: 696c 653d 3229 2c29 0a20 2020 2020 2020  ile=2),).       
+000079e0: 2064 6f6d 203d 2074 696c 6564 622e 446f   dom = tiledb.Do
+000079f0: 6d61 696e 282a 6469 6d73 290a 2020 2020  main(*dims).    
+00007a00: 2020 2020 6174 7420 3d20 7469 6c65 6462      att = tiledb
+00007a10: 2e41 7474 7228 6474 7970 653d 6e70 2e62  .Attr(dtype=np.b
+00007a20: 7974 6529 0a0a 2020 2020 2020 2020 7363  yte)..        sc
+00007a30: 6865 6d61 203d 2074 696c 6564 622e 4172  hema = tiledb.Ar
+00007a40: 7261 7953 6368 656d 6128 646f 6d61 696e  raySchema(domain
+00007a50: 3d64 6f6d 2c20 6174 7472 733d 2861 7474  =dom, attrs=(att
+00007a60: 2c29 2c20 7370 6172 7365 3d54 7275 6529  ,), sparse=True)
+00007a70: 0a20 2020 2020 2020 2075 7269 203d 2073  .        uri = s
+00007a80: 656c 662e 7061 7468 2822 7331 2229 0a20  elf.path("s1"). 
+00007a90: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+00007aa0: 2e61 7373 6572 7452 6169 7365 7328 5661  .assertRaises(Va
+00007ab0: 6c75 6545 7272 6f72 293a 0a20 2020 2020  lueError):.     
+00007ac0: 2020 2020 2020 2074 696c 6564 622e 4465         tiledb.De
+00007ad0: 6e73 6541 7272 6179 2e63 7265 6174 6528  nseArray.create(
+00007ae0: 7572 692c 2073 6368 656d 6129 0a0a 2020  uri, schema)..  
+00007af0: 2020 2020 2020 6465 6e73 655f 7363 6865        dense_sche
+00007b00: 6d61 203d 2074 696c 6564 622e 4172 7261  ma = tiledb.Arra
+00007b10: 7953 6368 656d 6128 646f 6d61 696e 3d64  ySchema(domain=d
+00007b20: 6f6d 2c20 6174 7472 733d 2861 7474 2c29  om, attrs=(att,)
+00007b30: 290a 2020 2020 2020 2020 7572 6920 3d20  ).        uri = 
+00007b40: 7365 6c66 2e70 6174 6828 2264 3122 290a  self.path("d1").
+00007b50: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+00007b60: 662e 6173 7365 7274 5261 6973 6573 2856  f.assertRaises(V
+00007b70: 616c 7565 4572 726f 7229 3a0a 2020 2020  alueError):.    
+00007b80: 2020 2020 2020 2020 7469 6c65 6462 2e53          tiledb.S
+00007b90: 7061 7273 6541 7272 6179 2e63 7265 6174  parseArray.creat
+00007ba0: 6528 7572 692c 2064 656e 7365 5f73 6368  e(uri, dense_sch
+00007bb0: 656d 6129 0a0a 2020 2020 2020 2020 636c  ema)..        cl
+00007bc0: 6173 7320 4d79 5370 6172 7365 4172 7261  ass MySparseArra
+00007bd0: 7928 7469 6c65 6462 2e53 7061 7273 6541  y(tiledb.SparseA
+00007be0: 7272 6179 293a 0a20 2020 2020 2020 2020  rray):.         
+00007bf0: 2020 2070 6173 730a 0a20 2020 2020 2020     pass..       
+00007c00: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+00007c10: 7452 6169 7365 7328 5661 6c75 6545 7272  tRaises(ValueErr
+00007c20: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+00007c30: 204d 7953 7061 7273 6541 7272 6179 2e63   MySparseArray.c
+00007c40: 7265 6174 6528 7572 692c 2064 656e 7365  reate(uri, dense
+00007c50: 5f73 6368 656d 6129 0a0a 2020 2020 6465  _schema)..    de
+00007c60: 6620 7465 7374 5f6e 6f6e 656d 7074 795f  f test_nonempty_
+00007c70: 646f 6d61 696e 5f73 6361 6c61 7228 7365  domain_scalar(se
+00007c80: 6c66 293a 0a20 2020 2020 2020 2075 7269  lf):.        uri
+00007c90: 203d 2073 656c 662e 7061 7468 2822 7465   = self.path("te
+00007ca0: 7374 5f6e 6f6e 656d 7074 795f 646f 6d61  st_nonempty_doma
+00007cb0: 696e 5f73 6361 6c61 7222 290a 2020 2020  in_scalar").    
+00007cc0: 2020 2020 6469 6d73 203d 2074 696c 6564      dims = tiled
+00007cd0: 622e 4469 6d28 646f 6d61 696e 3d28 2d31  b.Dim(domain=(-1
+00007ce0: 302c 2031 3029 2c20 6474 7970 653d 6e70  0, 10), dtype=np
+00007cf0: 2e69 6e74 3634 2c20 7469 6c65 3d31 290a  .int64, tile=1).
+00007d00: 2020 2020 2020 2020 7363 6865 6d61 203d          schema =
+00007d10: 2074 696c 6564 622e 4172 7261 7953 6368   tiledb.ArraySch
+00007d20: 656d 6128 0a20 2020 2020 2020 2020 2020  ema(.           
+00007d30: 2074 696c 6564 622e 446f 6d61 696e 2864   tiledb.Domain(d
+00007d40: 696d 7329 2c0a 2020 2020 2020 2020 2020  ims),.          
+00007d50: 2020 6174 7472 733d 5b74 696c 6564 622e    attrs=[tiledb.
+00007d60: 4174 7472 2864 7479 7065 3d6e 702e 696e  Attr(dtype=np.in
+00007d70: 7433 3229 5d2c 0a20 2020 2020 2020 2020  t32)],.         
+00007d80: 2020 2073 7061 7273 653d 5472 7565 2c0a     sparse=True,.
+00007d90: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00007da0: 2020 2074 696c 6564 622e 4172 7261 792e     tiledb.Array.
+00007db0: 6372 6561 7465 2875 7269 2c20 7363 6865  create(uri, sche
+00007dc0: 6d61 290a 0a20 2020 2020 2020 2077 6974  ma)..        wit
+00007dd0: 6820 7469 6c65 6462 2e6f 7065 6e28 7572  h tiledb.open(ur
+00007de0: 692c 2022 7722 2920 6173 2041 3a0a 2020  i, "w") as A:.  
+00007df0: 2020 2020 2020 2020 2020 415b 2d31 5d20            A[-1] 
+00007e00: 3d20 3130 0a20 2020 2020 2020 2020 2020  = 10.           
+00007e10: 2041 5b31 5d20 3d20 3131 0a0a 2020 2020   A[1] = 11..    
+00007e20: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+00007e30: 6f70 656e 2875 7269 2c20 2272 2229 2061  open(uri, "r") a
+00007e40: 7320 413a 0a20 2020 2020 2020 2020 2020  s A:.           
+00007e50: 206e 6564 203d 2041 2e6e 6f6e 656d 7074   ned = A.nonempt
+00007e60: 795f 646f 6d61 696e 2829 0a20 2020 2020  y_domain().     
+00007e70: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+00007e80: 7261 795f 6571 7561 6c28 6e65 642c 2028  ray_equal(ned, (
+00007e90: 282d 312c 2031 292c 2929 0a20 2020 2020  (-1, 1),)).     
+00007ea0: 2020 2020 2020 2061 7373 6572 7420 6973         assert is
+00007eb0: 696e 7374 616e 6365 286e 6564 5b30 5d5b  instance(ned[0][
+00007ec0: 305d 2c20 696e 7429 0a20 2020 2020 2020  0], int).       
+00007ed0: 2020 2020 2061 7373 6572 7420 6973 696e       assert isin
+00007ee0: 7374 616e 6365 286e 6564 5b30 5d5b 315d  stance(ned[0][1]
+00007ef0: 2c20 696e 7429 0a0a 0a63 6c61 7373 2044  , int)...class D
+00007f00: 656e 7365 4172 7261 7954 6573 7428 4469  enseArrayTest(Di
+00007f10: 736b 5465 7374 4361 7365 293a 0a20 2020  skTestCase):.   
+00007f20: 2064 6566 2074 6573 745f 6172 7261 795f   def test_array_
+00007f30: 3164 2873 656c 6629 3a0a 2020 2020 2020  1d(self):.      
+00007f40: 2020 4120 3d20 6e70 2e61 7261 6e67 6528    A = np.arange(
+00007f50: 3130 3530 290a 0a20 2020 2020 2020 2064  1050)..        d
+00007f60: 6f6d 203d 2074 696c 6564 622e 446f 6d61  om = tiledb.Doma
+00007f70: 696e 2874 696c 6564 622e 4469 6d28 646f  in(tiledb.Dim(do
+00007f80: 6d61 696e 3d28 302c 2031 3034 3929 2c20  main=(0, 1049), 
+00007f90: 7469 6c65 3d31 3030 2c20 6474 7970 653d  tile=100, dtype=
+00007fa0: 6e70 2e69 6e74 3634 2929 0a20 2020 2020  np.int64)).     
+00007fb0: 2020 2061 7474 203d 2074 696c 6564 622e     att = tiledb.
+00007fc0: 4174 7472 2864 7479 7065 3d41 2e64 7479  Attr(dtype=A.dty
+00007fd0: 7065 290a 2020 2020 2020 2020 7363 6865  pe).        sche
+00007fe0: 6d61 203d 2074 696c 6564 622e 4172 7261  ma = tiledb.Arra
+00007ff0: 7953 6368 656d 6128 646f 6d61 696e 3d64  ySchema(domain=d
+00008000: 6f6d 2c20 6174 7472 733d 2861 7474 2c29  om, attrs=(att,)
+00008010: 290a 2020 2020 2020 2020 7469 6c65 6462  ).        tiledb
+00008020: 2e44 656e 7365 4172 7261 792e 6372 6561  .DenseArray.crea
+00008030: 7465 2873 656c 662e 7061 7468 2822 666f  te(self.path("fo
+00008040: 6f22 292c 2073 6368 656d 6129 0a0a 2020  o"), schema)..  
+00008050: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+00008060: 622e 4465 6e73 6541 7272 6179 2873 656c  b.DenseArray(sel
+00008070: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
+00008080: 6f64 653d 2272 2229 2061 7320 543a 0a20  ode="r") as T:. 
+00008090: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000080a0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
+000080b0: 4129 2c20 6c65 6e28 5429 290a 2020 2020  A), len(T)).    
+000080c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000080d0: 6572 7445 7175 616c 2841 2e6e 6469 6d2c  ertEqual(A.ndim,
+000080e0: 2054 2e6e 6469 6d29 0a20 2020 2020 2020   T.ndim).       
+000080f0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00008100: 4571 7561 6c28 412e 7368 6170 652c 2054  Equal(A.shape, T
+00008110: 2e73 6861 7065 290a 0a20 2020 2020 2020  .shape)..       
+00008120: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00008130: 4571 7561 6c28 312c 2054 2e6e 6174 7472  Equal(1, T.nattr
+00008140: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00008150: 6c66 2e61 7373 6572 7445 7175 616c 2841  lf.assertEqual(A
+00008160: 2e64 7479 7065 2c20 542e 6174 7472 2830  .dtype, T.attr(0
+00008170: 292e 6474 7970 6529 0a20 2020 2020 2020  ).dtype).       
+00008180: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00008190: 4571 7561 6c28 542e 6469 6d28 542e 7363  Equal(T.dim(T.sc
+000081a0: 6865 6d61 2e64 6f6d 6169 6e2e 6469 6d28  hema.domain.dim(
+000081b0: 3029 2e6e 616d 6529 2c20 542e 6469 6d28  0).name), T.dim(
+000081c0: 3029 290a 2020 2020 2020 2020 2020 2020  0)).            
+000081d0: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
+000081e0: 5261 6973 6573 2856 616c 7565 4572 726f  Raises(ValueErro
+000081f0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00008200: 2020 2020 542e 6469 6d28 312e 3029 0a0a      T.dim(1.0)..
+00008210: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008220: 2e61 7373 6572 7449 7349 6e73 7461 6e63  .assertIsInstanc
+00008230: 6528 542e 7469 6d65 7374 616d 705f 7261  e(T.timestamp_ra
+00008240: 6e67 652c 2074 7570 6c65 290a 2020 2020  nge, tuple).    
+00008250: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00008260: 6572 7454 7275 6528 542e 7469 6d65 7374  ertTrue(T.timest
+00008270: 616d 705f 7261 6e67 655b 315d 203e 2030  amp_range[1] > 0
+00008280: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00008290: 2063 6865 636b 2065 6d70 7479 2061 7272   check empty arr
+000082a0: 6179 0a20 2020 2020 2020 2020 2020 2042  ay.            B
+000082b0: 203d 2054 5b3a 5d0a 0a20 2020 2020 2020   = T[:]..       
+000082c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000082d0: 4571 7561 6c28 412e 7368 6170 652c 2042  Equal(A.shape, B
+000082e0: 2e73 6861 7065 290a 2020 2020 2020 2020  .shape).        
+000082f0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00008300: 7175 616c 2841 2e64 7479 7065 2c20 422e  qual(A.dtype, B.
+00008310: 6474 7970 6529 0a20 2020 2020 2020 2020  dtype).         
+00008320: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
+00008330: 4e6f 6e65 2854 2e6e 6f6e 656d 7074 795f  None(T.nonempty_
+00008340: 646f 6d61 696e 2829 290a 0a20 2020 2020  domain())..     
+00008350: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
+00008360: 656e 7365 4172 7261 7928 7365 6c66 2e70  enseArray(self.p
+00008370: 6174 6828 2266 6f6f 2229 2c20 6d6f 6465  ath("foo"), mode
+00008380: 3d22 7722 2920 6173 2054 3a0a 2020 2020  ="w") as T:.    
+00008390: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+000083a0: 7365 7420 6172 7261 790a 2020 2020 2020  set array.      
+000083b0: 2020 2020 2020 545b 3a5d 203d 2041 0a0a        T[:] = A..
+000083c0: 2020 2020 2020 2020 7265 6164 315f 7469          read1_ti
+000083d0: 6d65 7374 616d 7020 3d20 2d31 0a20 2020  mestamp = -1.   
+000083e0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+000083f0: 2e44 656e 7365 4172 7261 7928 7365 6c66  .DenseArray(self
+00008400: 2e70 6174 6828 2266 6f6f 2229 2c20 6d6f  .path("foo"), mo
+00008410: 6465 3d22 7222 2920 6173 2054 3a0a 2020  de="r") as T:.  
+00008420: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00008430: 7373 6572 7445 7175 616c 2828 2830 2c20  ssertEqual(((0, 
+00008440: 3130 3439 292c 292c 2054 2e6e 6f6e 656d  1049),), T.nonem
+00008450: 7074 795f 646f 6d61 696e 2829 290a 0a20  pty_domain()).. 
+00008460: 2020 2020 2020 2020 2020 2023 2063 6865             # che
+00008470: 636b 2074 696d 6573 7461 6d70 0a20 2020  ck timestamp.   
+00008480: 2020 2020 2020 2020 2072 6561 6431 5f74           read1_t
+00008490: 696d 6573 7461 6d70 203d 2054 2e74 696d  imestamp = T.tim
+000084a0: 6573 7461 6d70 5f72 616e 6765 0a20 2020  estamp_range.   
+000084b0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000084c0: 7365 7274 5472 7565 2872 6561 6431 5f74  sertTrue(read1_t
+000084d0: 696d 6573 7461 6d70 5b31 5d20 3e20 3029  imestamp[1] > 0)
+000084e0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000084f0: 6368 6563 6b20 736c 6963 696e 670a 2020  check slicing.  
+00008500: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00008510: 5f61 7272 6179 5f65 7175 616c 2841 2c20  _array_equal(A, 
+00008520: 6e70 2e61 7272 6179 2854 2929 0a20 2020  np.array(T)).   
+00008530: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+00008540: 6172 7261 795f 6571 7561 6c28 412c 2054  array_equal(A, T
+00008550: 5b3a 5d29 0a20 2020 2020 2020 2020 2020  [:]).           
+00008560: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+00008570: 7561 6c28 412c 2054 5b2e 2e2e 5d29 0a20  ual(A, T[...]). 
+00008580: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+00008590: 745f 6172 7261 795f 6571 7561 6c28 412c  t_array_equal(A,
+000085a0: 2054 5b73 6c69 6365 284e 6f6e 6529 5d29   T[slice(None)])
+000085b0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+000085c0: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+000085d0: 415b 3a31 305d 2c20 545b 3a31 305d 290a  A[:10], T[:10]).
+000085e0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+000085f0: 7274 5f61 7272 6179 5f65 7175 616c 2841  rt_array_equal(A
+00008600: 5b31 303a 3230 5d2c 2054 5b31 303a 3230  [10:20], T[10:20
+00008610: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+00008620: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+00008630: 6c28 415b 2d31 303a 5d2c 2054 5b2d 3130  l(A[-10:], T[-10
+00008640: 3a5d 290a 0a20 2020 2020 2020 2020 2020  :])..           
+00008650: 2023 2065 6c6c 6970 7369 730a 2020 2020   # ellipsis.    
+00008660: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+00008670: 7272 6179 5f65 7175 616c 2841 5b3a 3130  rray_equal(A[:10
+00008680: 2c20 2e2e 2e5d 2c20 545b 3a31 302c 202e  , ...], T[:10, .
+00008690: 2e2e 5d29 0a20 2020 2020 2020 2020 2020  ..]).           
+000086a0: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+000086b0: 7561 6c28 415b 3130 3a35 302c 202e 2e2e  ual(A[10:50, ...
+000086c0: 5d2c 2054 5b31 303a 3530 2c20 2e2e 2e5d  ], T[10:50, ...]
+000086d0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+000086e0: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
+000086f0: 2841 5b2d 3530 3a2c 202e 2e2e 5d2c 2054  (A[-50:, ...], T
+00008700: 5b2d 3530 3a2c 202e 2e2e 5d29 0a20 2020  [-50:, ...]).   
+00008710: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+00008720: 6172 7261 795f 6571 7561 6c28 415b 2e2e  array_equal(A[..
+00008730: 2e2c 203a 3130 5d2c 2054 5b2e 2e2e 2c20  ., :10], T[..., 
+00008740: 3a31 305d 290a 2020 2020 2020 2020 2020  :10]).          
+00008750: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
+00008760: 7175 616c 2841 5b2e 2e2e 2c20 3130 3a32  qual(A[..., 10:2
+00008770: 305d 2c20 545b 2e2e 2e2c 2031 303a 3230  0], T[..., 10:20
+00008780: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+00008790: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+000087a0: 6c28 415b 2e2e 2e2c 202d 3530 3a5d 2c20  l(A[..., -50:], 
+000087b0: 545b 2e2e 2e2c 202d 3530 3a5d 290a 0a20  T[..., -50:]).. 
+000087c0: 2020 2020 2020 2020 2020 2023 2061 6372             # acr
+000087d0: 6f73 7320 7469 6c65 730a 2020 2020 2020  oss tiles.      
+000087e0: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
+000087f0: 6179 5f65 7175 616c 2841 5b3a 3135 305d  ay_equal(A[:150]
+00008800: 2c20 545b 3a31 3530 5d29 0a20 2020 2020  , T[:150]).     
+00008810: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+00008820: 7261 795f 6571 7561 6c28 415b 2d32 3530  ray_equal(A[-250
+00008830: 3a5d 2c20 545b 2d32 3530 3a5d 290a 0a20  :], T[-250:]).. 
+00008840: 2020 2020 2020 2020 2020 2023 2070 6f69             # poi
+00008850: 6e74 2069 6e64 6578 0a20 2020 2020 2020  nt index.       
+00008860: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00008870: 4571 7561 6c28 415b 305d 2c20 545b 305d  Equal(A[0], T[0]
+00008880: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00008890: 6c66 2e61 7373 6572 7445 7175 616c 2841  lf.assertEqual(A
+000088a0: 5b2d 315d 2c20 545b 2d31 5d29 0a0a 2020  [-1], T[-1])..  
+000088b0: 2020 2020 2020 2020 2020 2320 706f 696e            # poin
+000088c0: 7420 696e 6465 7820 7769 7468 2061 6c6c  t index with all
+000088d0: 2069 6e64 6578 2074 7970 6573 0a20 2020   index types.   
+000088e0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+000088f0: 7365 7274 4571 7561 6c28 415b 3132 335d  sertEqual(A[123]
+00008900: 2c20 545b 6e70 2e69 6e74 3828 3132 3329  , T[np.int8(123)
+00008910: 5d29 0a20 2020 2020 2020 2020 2020 2073  ]).            s
+00008920: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00008930: 415b 3132 335d 2c20 545b 6e70 2e75 696e  A[123], T[np.uin
+00008940: 7438 2831 3233 295d 290a 2020 2020 2020  t8(123)]).      
+00008950: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00008960: 7445 7175 616c 2841 5b31 3233 5d2c 2054  tEqual(A[123], T
+00008970: 5b6e 702e 696e 7431 3628 3132 3329 5d29  [np.int16(123)])
+00008980: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008990: 662e 6173 7365 7274 4571 7561 6c28 415b  f.assertEqual(A[
+000089a0: 3132 335d 2c20 545b 6e70 2e75 696e 7431  123], T[np.uint1
+000089b0: 3628 3132 3329 5d29 0a20 2020 2020 2020  6(123)]).       
+000089c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000089d0: 4571 7561 6c28 415b 3132 335d 2c20 545b  Equal(A[123], T[
+000089e0: 6e70 2e69 6e74 3634 2831 3233 295d 290a  np.int64(123)]).
+000089f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008a00: 2e61 7373 6572 7445 7175 616c 2841 5b31  .assertEqual(A[1
+00008a10: 3233 5d2c 2054 5b6e 702e 7569 6e74 3634  23], T[np.uint64
+00008a20: 2831 3233 295d 290a 2020 2020 2020 2020  (123)]).        
+00008a30: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00008a40: 7175 616c 2841 5b31 3233 5d2c 2054 5b6e  qual(A[123], T[n
+00008a50: 702e 696e 7433 3228 3132 3329 5d29 0a20  p.int32(123)]). 
+00008a60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008a70: 6173 7365 7274 4571 7561 6c28 415b 3132  assertEqual(A[12
+00008a80: 335d 2c20 545b 6e70 2e75 696e 7433 3228  3], T[np.uint32(
+00008a90: 3132 3329 5d29 0a0a 2020 2020 2020 2020  123)])..        
+00008aa0: 2020 2020 2320 6d69 7865 642d 7479 7065      # mixed-type
+00008ab0: 2073 6c69 6369 6e67 0a20 2020 2020 2020   slicing.       
+00008ac0: 2020 2020 2023 2068 7474 7073 3a2f 2f67       # https://g
+00008ad0: 6974 6875 622e 636f 6d2f 5469 6c65 4442  ithub.com/TileDB
+00008ae0: 2d49 6e63 2f54 696c 6544 422d 5079 2f69  -Inc/TileDB-Py/i
+00008af0: 7373 7565 732f 3134 300a 2020 2020 2020  ssues/140.      
+00008b00: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00008b10: 7445 7175 616c 2841 5b30 3a31 5d2c 2054  tEqual(A[0:1], T
+00008b20: 5b30 203a 206e 702e 7569 6e74 3136 2831  [0 : np.uint16(1
+00008b30: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
+00008b40: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00008b50: 2841 5b30 3a31 5d2c 2054 5b6e 702e 696e  (A[0:1], T[np.in
+00008b60: 7436 3428 3029 203a 2031 5d29 0a20 2020  t64(0) : 1]).   
+00008b70: 2020 2020 2020 2020 2077 6974 6820 7365           with se
+00008b80: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+00008b90: 496e 6465 7845 7272 6f72 293a 0a20 2020  IndexError):.   
+00008ba0: 2020 2020 2020 2020 2020 2020 2023 2074               # t
+00008bb0: 6869 7320 6973 2061 2063 6f6e 7365 7175  his is a consequ
+00008bc0: 656e 6365 206f 6620 4e75 6d50 7920 7072  ence of NumPy pr
+00008bd0: 6f6d 6f74 696f 6e20 7275 6c65 730a 2020  omotion rules.  
+00008be0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00008bf0: 6c66 2e61 7373 6572 7445 7175 616c 2841  lf.assertEqual(A
+00008c00: 5b30 3a31 5d2c 2054 5b6e 702e 7569 6e74  [0:1], T[np.uint
+00008c10: 3634 2830 2920 3a20 315d 290a 0a20 2020  64(0) : 1])..   
+00008c20: 2020 2020 2020 2020 2023 2062 6173 6963           # basic
+00008c30: 2073 7465 700a 2020 2020 2020 2020 2020   step.          
+00008c40: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
+00008c50: 7175 616c 2841 5b3a 3530 3a32 5d2c 2054  qual(A[:50:2], T
+00008c60: 5b3a 3530 3a32 5d29 0a20 2020 2020 2020  [:50:2]).       
+00008c70: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
+00008c80: 795f 6571 7561 6c28 415b 3a32 3a35 305d  y_equal(A[:2:50]
+00008c90: 2c20 545b 3a32 3a35 305d 290a 2020 2020  , T[:2:50]).    
+00008ca0: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+00008cb0: 7272 6179 5f65 7175 616c 2841 5b31 303a  rray_equal(A[10:
+00008cc0: 2d31 3a35 305d 2c20 545b 3130 3a2d 313a  -1:50], T[10:-1:
+00008cd0: 3530 5d29 0a0a 2020 2020 2020 2020 2020  50])..          
+00008ce0: 2020 2320 696e 6465 7869 6e67 2065 7272    # indexing err
+00008cf0: 6f72 730a 2020 2020 2020 2020 2020 2020  ors.            
+00008d00: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
+00008d10: 5261 6973 6573 2849 6e64 6578 4572 726f  Raises(IndexErro
+00008d20: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00008d30: 2020 2020 545b 3a2c 203a 5d0a 2020 2020      T[:, :].    
+00008d40: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+00008d50: 662e 6173 7365 7274 5261 6973 6573 2849  f.assertRaises(I
+00008d60: 6e64 6578 4572 726f 7229 3a0a 2020 2020  ndexError):.    
+00008d70: 2020 2020 2020 2020 2020 2020 545b 3a2c              T[:,
+00008d80: 2035 305d 0a20 2020 2020 2020 2020 2020   50].           
+00008d90: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+00008da0: 7452 6169 7365 7328 496e 6465 7845 7272  tRaises(IndexErr
+00008db0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+00008dc0: 2020 2020 2054 5b35 302c 203a 5d0a 2020       T[50, :].  
+00008dd0: 2020 2020 2020 2020 2020 7769 7468 2073            with s
+00008de0: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+00008df0: 2849 6e64 6578 4572 726f 7229 3a0a 2020  (IndexError):.  
+00008e00: 2020 2020 2020 2020 2020 2020 2020 545b                T[
+00008e10: 302c 2030 5d0a 0a20 2020 2020 2020 2020  0, 0]..         
+00008e20: 2020 2023 2063 6865 636b 2073 696e 676c     # check singl
+00008e30: 6520 656c 6c69 7073 6973 0a20 2020 2020  e ellipsis.     
+00008e40: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+00008e50: 2e61 7373 6572 7452 6169 7365 7328 496e  .assertRaises(In
+00008e60: 6465 7845 7272 6f72 293a 0a20 2020 2020  dexError):.     
+00008e70: 2020 2020 2020 2020 2020 2054 5b2e 2e2e             T[...
+00008e80: 2c20 313a 352c 202e 2e2e 5d0a 0a20 2020  , 1:5, ...]..   
+00008e90: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+00008ea0: 2e44 656e 7365 4172 7261 7928 7365 6c66  .DenseArray(self
+00008eb0: 2e70 6174 6828 2266 6f6f 2229 2c20 6d6f  .path("foo"), mo
+00008ec0: 6465 3d22 7722 2920 6173 2054 3a0a 2020  de="w") as T:.  
+00008ed0: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
+00008ee0: 6b20 7061 7274 6961 6c20 6173 7369 676e  k partial assign
+00008ef0: 6d65 6e74 0a20 2020 2020 2020 2020 2020  ment.           
+00008f00: 2042 203d 206e 702e 6172 616e 6765 2831   B = np.arange(1
+00008f10: 6535 2c20 3265 3529 2e61 7374 7970 6528  e5, 2e5).astype(
+00008f20: 412e 6474 7970 6529 0a20 2020 2020 2020  A.dtype).       
+00008f30: 2020 2020 2054 5b31 3930 3a33 3130 5d20       T[190:310] 
+00008f40: 3d20 425b 3139 303a 3331 305d 0a0a 2020  = B[190:310]..  
+00008f50: 2020 2020 2020 7265 6164 325f 7469 6d65        read2_time
+00008f60: 7374 616d 7020 3d20 2d31 0a20 2020 2020  stamp = -1.     
+00008f70: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
+00008f80: 656e 7365 4172 7261 7928 7365 6c66 2e70  enseArray(self.p
+00008f90: 6174 6828 2266 6f6f 2229 2c20 6d6f 6465  ath("foo"), mode
+00008fa0: 3d22 7222 2920 6173 2054 3a0a 2020 2020  ="r") as T:.    
+00008fb0: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+00008fc0: 7272 6179 5f65 7175 616c 2841 5b3a 3139  rray_equal(A[:19
+00008fd0: 305d 2c20 545b 3a31 3930 5d29 0a20 2020  0], T[:190]).   
+00008fe0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+00008ff0: 6172 7261 795f 6571 7561 6c28 425b 3139  array_equal(B[19
+00009000: 303a 3331 305d 2c20 545b 3139 303a 3331  0:310], T[190:31
+00009010: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
+00009020: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
+00009030: 616c 2841 5b33 3130 3a5d 2c20 545b 3331  al(A[310:], T[31
+00009040: 303a 5d29 0a0a 2020 2020 2020 2020 2020  0:])..          
+00009050: 2020 2320 7465 7374 2074 696d 6573 7461    # test timesta
+00009060: 6d70 7320 6172 6520 7570 6461 7465 640a  mps are updated.
+00009070: 2020 2020 2020 2020 2020 2020 7265 6164              read
+00009080: 325f 7469 6d65 7374 616d 7020 3d20 542e  2_timestamp = T.
+00009090: 7469 6d65 7374 616d 705f 7261 6e67 650a  timestamp_range.
+000090a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000090b0: 2e61 7373 6572 7454 7275 6528 7265 6164  .assertTrue(read
+000090c0: 325f 7469 6d65 7374 616d 7020 3e20 7265  2_timestamp > re
+000090d0: 6164 315f 7469 6d65 7374 616d 7029 0a0a  ad1_timestamp)..
+000090e0: 2020 2020 6465 6620 7465 7374 5f61 7272      def test_arr
+000090f0: 6179 5f31 645f 7365 745f 7363 616c 6172  ay_1d_set_scalar
+00009100: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00009110: 4120 3d20 6e70 2e7a 6572 6f73 2835 3029  A = np.zeros(50)
+00009120: 0a0a 2020 2020 2020 2020 646f 6d20 3d20  ..        dom = 
+00009130: 7469 6c65 6462 2e44 6f6d 6169 6e28 7469  tiledb.Domain(ti
+00009140: 6c65 6462 2e44 696d 2864 6f6d 6169 6e3d  ledb.Dim(domain=
+00009150: 2830 2c20 3439 292c 2074 696c 653d 3530  (0, 49), tile=50
+00009160: 2929 0a20 2020 2020 2020 2061 7474 203d  )).        att =
+00009170: 2074 696c 6564 622e 4174 7472 2864 7479   tiledb.Attr(dty
+00009180: 7065 3d41 2e64 7479 7065 290a 2020 2020  pe=A.dtype).    
+00009190: 2020 2020 7363 6865 6d61 203d 2074 696c      schema = til
+000091a0: 6564 622e 4172 7261 7953 6368 656d 6128  edb.ArraySchema(
+000091b0: 646f 6d2c 2028 6174 742c 2929 0a0a 2020  dom, (att,))..  
+000091c0: 2020 2020 2020 7469 6c65 6462 2e44 656e        tiledb.Den
+000091d0: 7365 4172 7261 792e 6372 6561 7465 2873  seArray.create(s
+000091e0: 656c 662e 7061 7468 2822 666f 6f22 292c  elf.path("foo"),
+000091f0: 2073 6368 656d 6129 0a0a 2020 2020 2020   schema)..      
+00009200: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
+00009210: 6e73 6541 7272 6179 2873 656c 662e 7061  nseArray(self.pa
+00009220: 7468 2822 666f 6f22 292c 206d 6f64 653d  th("foo"), mode=
+00009230: 2277 2229 2061 7320 543a 0a20 2020 2020  "w") as T:.     
+00009240: 2020 2020 2020 2054 5b3a 5d20 3d20 410a         T[:] = A.
+00009250: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
+00009260: 6c65 6462 2e44 656e 7365 4172 7261 7928  ledb.DenseArray(
+00009270: 7365 6c66 2e70 6174 6828 2266 6f6f 2229  self.path("foo")
+00009280: 2c20 6d6f 6465 3d22 7222 2920 6173 2054  , mode="r") as T
+00009290: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
+000092a0: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
+000092b0: 2841 2c20 545b 3a5d 290a 0a20 2020 2020  (A, T[:])..     
+000092c0: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
+000092d0: 656e 7365 4172 7261 7928 7365 6c66 2e70  enseArray(self.p
+000092e0: 6174 6828 2266 6f6f 2229 2c20 6d6f 6465  ath("foo"), mode
+000092f0: 3d22 7722 2920 6173 2054 3a0a 2020 2020  ="w") as T:.    
+00009300: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
+00009310: 2d31 2c20 332c 2031 300a 2020 2020 2020  -1, 3, 10.      
+00009320: 2020 2020 2020 415b 305d 2c20 415b 315d        A[0], A[1]
+00009330: 2c20 415b 335d 203d 2076 616c 7565 0a20  , A[3] = value. 
+00009340: 2020 2020 2020 2020 2020 2054 5b30 5d2c             T[0],
+00009350: 2054 5b31 5d2c 2054 5b33 5d20 3d20 7661   T[1], T[3] = va
+00009360: 6c75 650a 2020 2020 2020 2020 7769 7468  lue.        with
+00009370: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
+00009380: 6179 2873 656c 662e 7061 7468 2822 666f  ay(self.path("fo
+00009390: 6f22 292c 206d 6f64 653d 2272 2229 2061  o"), mode="r") a
+000093a0: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
+000093b0: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+000093c0: 7561 6c28 412c 2054 5b3a 5d29 0a0a 2020  ual(A, T[:])..  
+000093d0: 2020 2020 2020 666f 7220 7661 6c75 6520        for value 
+000093e0: 696e 2028 2d31 2c20 332c 2031 3029 3a0a  in (-1, 3, 10):.
+000093f0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00009400: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
+00009410: 6179 2873 656c 662e 7061 7468 2822 666f  ay(self.path("fo
+00009420: 6f22 292c 206d 6f64 653d 2277 2229 2061  o"), mode="w") a
+00009430: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
+00009440: 2020 2020 2041 5b35 3a32 355d 203d 2076       A[5:25] = v
+00009450: 616c 7565 0a20 2020 2020 2020 2020 2020  alue.           
+00009460: 2020 2020 2054 5b35 3a32 355d 203d 2076       T[5:25] = v
+00009470: 616c 7565 0a20 2020 2020 2020 2020 2020  alue.           
+00009480: 2077 6974 6820 7469 6c65 6462 2e44 656e   with tiledb.Den
+00009490: 7365 4172 7261 7928 7365 6c66 2e70 6174  seArray(self.pat
+000094a0: 6828 2266 6f6f 2229 2c20 6d6f 6465 3d22  h("foo"), mode="
+000094b0: 7222 2920 6173 2054 3a0a 2020 2020 2020  r") as T:.      
+000094c0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+000094d0: 5f61 7272 6179 5f65 7175 616c 2841 2c20  _array_equal(A, 
+000094e0: 545b 3a5d 290a 2020 2020 2020 2020 2020  T[:]).          
+000094f0: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
+00009500: 6e73 6541 7272 6179 2873 656c 662e 7061  nseArray(self.pa
+00009510: 7468 2822 666f 6f22 292c 206d 6f64 653d  th("foo"), mode=
+00009520: 2277 2229 2061 7320 543a 0a20 2020 2020  "w") as T:.     
+00009530: 2020 2020 2020 2020 2020 2041 5b3a 5d20             A[:] 
+00009540: 3d20 7661 6c75 650a 2020 2020 2020 2020  = value.        
+00009550: 2020 2020 2020 2020 545b 3a5d 203d 2076          T[:] = v
+00009560: 616c 7565 0a20 2020 2020 2020 2020 2020  alue.           
+00009570: 2077 6974 6820 7469 6c65 6462 2e44 656e   with tiledb.Den
+00009580: 7365 4172 7261 7928 7365 6c66 2e70 6174  seArray(self.pat
+00009590: 6828 2266 6f6f 2229 2c20 6d6f 6465 3d22  h("foo"), mode="
+000095a0: 7222 2920 6173 2054 3a0a 2020 2020 2020  r") as T:.      
+000095b0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+000095c0: 5f61 7272 6179 5f65 7175 616c 2841 2c20  _array_equal(A, 
+000095d0: 545b 3a5d 290a 0a20 2020 2064 6566 2074  T[:])..    def t
+000095e0: 6573 745f 6172 7261 795f 6964 5f70 6f69  est_array_id_poi
+000095f0: 6e74 5f71 7565 7269 6573 2873 656c 6629  nt_queries(self)
+00009600: 3a0a 2020 2020 2020 2020 2320 544f 444f  :.        # TODO
+00009610: 3a20 6861 6e64 6c65 2071 7565 7269 6573  : handle queries
+00009620: 206c 696b 6520 545b 5b32 2c20 352c 2031   like T[[2, 5, 1
+00009630: 305d 5d20 3d20 3f0a 2020 2020 2020 2020  0]] = ?.        
+00009640: 7061 7373 0a0a 2020 2020 4070 7974 6573  pass..    @pytes
+00009650: 742e 6d61 726b 2e70 6172 616d 6574 7269  t.mark.parametri
+00009660: 7a65 2822 6474 7970 6522 2c20 494e 5445  ze("dtype", INTE
+00009670: 4745 525f 4454 5950 4553 290a 2020 2020  GER_DTYPES).    
+00009680: 6465 6620 7465 7374 5f64 656e 7365 5f69  def test_dense_i
+00009690: 6e64 6578 5f64 7479 7065 7328 7365 6c66  ndex_dtypes(self
+000096a0: 2c20 6474 7970 6529 3a0a 2020 2020 2020  , dtype):.      
+000096b0: 2020 7061 7468 203d 2073 656c 662e 7061    path = self.pa
+000096c0: 7468 2829 0a20 2020 2020 2020 2064 6174  th().        dat
+000096d0: 6120 3d20 6e70 2e61 7261 6e67 6528 302c  a = np.arange(0,
+000096e0: 2033 292e 6173 7479 7065 2864 7479 7065   3).astype(dtype
+000096f0: 290a 2020 2020 2020 2020 7769 7468 2074  ).        with t
+00009700: 696c 6564 622e 6672 6f6d 5f6e 756d 7079  iledb.from_numpy
+00009710: 2870 6174 682c 2064 6174 6129 2061 7320  (path, data) as 
+00009720: 413a 0a20 2020 2020 2020 2020 2020 2070  A:.            p
+00009730: 6173 730a 2020 2020 2020 2020 7769 7468  ass.        with
+00009740: 2074 696c 6564 622e 6f70 656e 2870 6174   tiledb.open(pat
+00009750: 6829 2061 7320 423a 0a20 2020 2020 2020  h) as B:.       
+00009760: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
+00009770: 795f 6571 7561 6c28 425b 3a5d 2c20 6461  y_equal(B[:], da
+00009780: 7461 290a 0a20 2020 2064 6566 2074 6573  ta)..    def tes
+00009790: 745f 6172 7261 795f 3264 2873 656c 6629  t_array_2d(self)
+000097a0: 3a0a 2020 2020 2020 2020 4120 3d20 6e70  :.        A = np
+000097b0: 2e61 7261 6e67 6528 3130 3030 3029 2e72  .arange(10000).r
+000097c0: 6573 6861 7065 2828 3130 3030 2c20 3130  eshape((1000, 10
+000097d0: 2929 0a0a 2020 2020 2020 2020 646f 6d20  ))..        dom 
+000097e0: 3d20 7469 6c65 6462 2e44 6f6d 6169 6e28  = tiledb.Domain(
+000097f0: 0a20 2020 2020 2020 2020 2020 2074 696c  .            til
+00009800: 6564 622e 4469 6d28 646f 6d61 696e 3d28  edb.Dim(domain=(
+00009810: 302c 2039 3939 292c 2074 696c 653d 3130  0, 999), tile=10
+00009820: 3029 2c20 7469 6c65 6462 2e44 696d 2864  0), tiledb.Dim(d
+00009830: 6f6d 6169 6e3d 2830 2c20 3929 2c20 7469  omain=(0, 9), ti
+00009840: 6c65 3d32 290a 2020 2020 2020 2020 290a  le=2).        ).
+00009850: 2020 2020 2020 2020 6174 7420 3d20 7469          att = ti
+00009860: 6c65 6462 2e41 7474 7228 6474 7970 653d  ledb.Attr(dtype=
+00009870: 412e 6474 7970 6529 0a20 2020 2020 2020  A.dtype).       
+00009880: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
+00009890: 2e41 7272 6179 5363 6865 6d61 2864 6f6d  .ArraySchema(dom
+000098a0: 2c20 2861 7474 2c29 290a 0a20 2020 2020  , (att,))..     
+000098b0: 2020 2074 696c 6564 622e 4465 6e73 6541     tiledb.DenseA
+000098c0: 7272 6179 2e63 7265 6174 6528 7365 6c66  rray.create(self
+000098d0: 2e70 6174 6828 2266 6f6f 2229 2c20 7363  .path("foo"), sc
+000098e0: 6865 6d61 290a 0a20 2020 2020 2020 2077  hema)..        w
+000098f0: 6974 6820 7469 6c65 6462 2e44 656e 7365  ith tiledb.Dense
+00009900: 4172 7261 7928 7365 6c66 2e70 6174 6828  Array(self.path(
+00009910: 2266 6f6f 2229 2c20 6d6f 6465 3d22 7222  "foo"), mode="r"
+00009920: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
+00009930: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00009940: 7175 616c 286c 656e 2841 292c 206c 656e  qual(len(A), len
+00009950: 2854 2929 0a20 2020 2020 2020 2020 2020  (T)).           
+00009960: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00009970: 6c28 412e 6e64 696d 2c20 542e 6e64 696d  l(A.ndim, T.ndim
+00009980: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00009990: 6c66 2e61 7373 6572 7445 7175 616c 2841  lf.assertEqual(A
+000099a0: 2e73 6861 7065 2c20 542e 7368 6170 6529  .shape, T.shape)
+000099b0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000099c0: 6c66 2e61 7373 6572 7445 7175 616c 2831  lf.assertEqual(1
+000099d0: 2c20 542e 6e61 7474 7229 0a20 2020 2020  , T.nattr).     
+000099e0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+000099f0: 7274 4571 7561 6c28 412e 6474 7970 652c  rtEqual(A.dtype,
+00009a00: 2054 2e61 7474 7228 3029 2e64 7479 7065   T.attr(0).dtype
+00009a10: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00009a20: 2063 6865 636b 2074 6861 7420 7468 6520   check that the 
+00009a30: 6e6f 6e2d 656d 7074 7920 646f 6d61 696e  non-empty domain
+00009a40: 2069 7320 4e6f 6e65 0a20 2020 2020 2020   is None.       
+00009a50: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00009a60: 4973 4e6f 6e65 2854 2e6e 6f6e 656d 7074  IsNone(T.nonempt
+00009a70: 795f 646f 6d61 696e 2829 290a 0a20 2020  y_domain())..   
+00009a80: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+00009a90: 2e44 656e 7365 4172 7261 7928 7365 6c66  .DenseArray(self
+00009aa0: 2e70 6174 6828 2266 6f6f 2229 2c20 6d6f  .path("foo"), mo
+00009ab0: 6465 3d22 7722 2920 6173 2054 3a0a 2020  de="w") as T:.  
+00009ac0: 2020 2020 2020 2020 2020 2320 5365 7420            # Set 
+00009ad0: 6461 7461 0a20 2020 2020 2020 2020 2020  data.           
+00009ae0: 2054 5b3a 5d20 3d20 410a 0a20 2020 2020   T[:] = A..     
+00009af0: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
+00009b00: 656e 7365 4172 7261 7928 7365 6c66 2e70  enseArray(self.p
+00009b10: 6174 6828 2266 6f6f 2229 2c20 6d6f 6465  ath("foo"), mode
+00009b20: 3d22 7222 2920 6173 2054 3a0a 2020 2020  ="r") as T:.    
+00009b30: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+00009b40: 7272 6179 5f65 7175 616c 2841 2c20 545b  rray_equal(A, T[
+00009b50: 3a5d 290a 0a20 2020 2020 2020 2020 2020  :])..           
+00009b60: 2023 2063 6865 636b 2074 6865 206e 6f6e   # check the non
+00009b70: 2d65 6d70 7479 2064 6f6d 6169 6e20 7370  -empty domain sp
+00009b80: 616e 7320 7468 6520 7768 6f6c 6520 646f  ans the whole do
+00009b90: 6d61 696e 0a20 2020 2020 2020 2020 2020  main.           
+00009ba0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00009bb0: 6c28 2828 302c 2039 3939 292c 2028 302c  l(((0, 999), (0,
+00009bc0: 2039 2929 2c20 542e 6e6f 6e65 6d70 7479   9)), T.nonempty
+00009bd0: 5f64 6f6d 6169 6e28 2929 0a0a 2020 2020  _domain())..    
+00009be0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+00009bf0: 6172 7261 792d 6c69 6b65 0a20 2020 2020  array-like.     
+00009c00: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+00009c10: 7261 795f 6571 7561 6c28 412c 206e 702e  ray_equal(A, np.
+00009c20: 6172 7261 7928 5429 290a 0a20 2020 2020  array(T))..     
+00009c30: 2020 2020 2020 2023 2073 6c69 6369 6e67         # slicing
+00009c40: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00009c50: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+00009c60: 412c 2054 5b3a 5d29 0a20 2020 2020 2020  A, T[:]).       
+00009c70: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
+00009c80: 795f 6571 7561 6c28 412c 2054 5b2e 2e2e  y_equal(A, T[...
+00009c90: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+00009ca0: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+00009cb0: 6c28 412c 2054 5b73 6c69 6365 284e 6f6e  l(A, T[slice(Non
+00009cc0: 6529 5d29 0a0a 2020 2020 2020 2020 2020  e)])..          
+00009cd0: 2020 2320 736c 6963 6520 6669 7273 7420    # slice first 
+00009ce0: 6469 6d65 6e73 696f 6e0a 2020 2020 2020  dimension.      
+00009cf0: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
+00009d00: 6179 5f65 7175 616c 2841 5b3a 3130 5d2c  ay_equal(A[:10],
+00009d10: 2054 5b3a 3130 5d29 0a20 2020 2020 2020   T[:10]).       
+00009d20: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
+00009d30: 795f 6571 7561 6c28 415b 3a31 305d 2c20  y_equal(A[:10], 
+00009d40: 545b 3a31 305d 290a 2020 2020 2020 2020  T[:10]).        
+00009d50: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
+00009d60: 5f65 7175 616c 2841 5b31 303a 3230 5d2c  _equal(A[10:20],
+00009d70: 2054 5b31 303a 3230 5d29 0a20 2020 2020   T[10:20]).     
+00009d80: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+00009d90: 7261 795f 6571 7561 6c28 415b 2d31 303a  ray_equal(A[-10:
+00009da0: 5d2c 2054 5b2d 3130 3a5d 290a 2020 2020  ], T[-10:]).    
+00009db0: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+00009dc0: 7272 6179 5f65 7175 616c 2841 5b3a 3130  rray_equal(A[:10
+00009dd0: 2c20 3a5d 2c20 545b 3a31 302c 203a 5d29  , :], T[:10, :])
+00009de0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00009df0: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+00009e00: 415b 3130 3a32 302c 203a 5d2c 2054 5b31  A[10:20, :], T[1
+00009e10: 303a 3230 2c20 3a5d 290a 2020 2020 2020  0:20, :]).      
+00009e20: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
+00009e30: 6179 5f65 7175 616c 2841 5b2d 3130 3a2c  ay_equal(A[-10:,
+00009e40: 203a 5d2c 2054 5b2d 3130 3a2c 203a 5d29   :], T[-10:, :])
+00009e50: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00009e60: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+00009e70: 415b 3a31 302c 202e 2e2e 5d2c 2054 5b3a  A[:10, ...], T[:
+00009e80: 3130 2c20 2e2e 2e5d 290a 2020 2020 2020  10, ...]).      
+00009e90: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
+00009ea0: 6179 5f65 7175 616c 2841 5b31 303a 3230  ay_equal(A[10:20
+00009eb0: 2c20 2e2e 2e5d 2c20 545b 3130 3a32 302c  , ...], T[10:20,
+00009ec0: 202e 2e2e 5d29 0a20 2020 2020 2020 2020   ...]).         
+00009ed0: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
+00009ee0: 6571 7561 6c28 415b 2d31 303a 2c20 2e2e  equal(A[-10:, ..
+00009ef0: 2e5d 2c20 545b 2d31 303a 2c20 2e2e 2e5d  .], T[-10:, ...]
+00009f00: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
 00009f10: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
-00009f20: 2841 5b30 5d2c 2054 5b30 5d29 0a20 2020  (A[0], T[0]).   
-00009f30: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-00009f40: 6172 7261 795f 6571 7561 6c28 415b 2d31  array_equal(A[-1
-00009f50: 5d2c 2054 5b2d 315d 290a 2020 2020 2020  ], T[-1]).      
-00009f60: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
-00009f70: 6179 5f65 7175 616c 2841 5b3a 2c20 305d  ay_equal(A[:, 0]
-00009f80: 2c20 545b 3a2c 2030 5d29 0a20 2020 2020  , T[:, 0]).     
-00009f90: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-00009fa0: 7261 795f 6571 7561 6c28 415b 3a2c 202d  ray_equal(A[:, -
-00009fb0: 315d 2c20 545b 3a2c 202d 315d 290a 2020  1], T[:, -1]).  
-00009fc0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00009fd0: 7373 6572 7445 7175 616c 2841 5b30 2c20  ssertEqual(A[0, 
-00009fe0: 305d 2c20 545b 302c 2030 5d29 0a20 2020  0], T[0, 0]).   
-00009ff0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-0000a000: 7365 7274 4571 7561 6c28 415b 2d31 2c20  sertEqual(A[-1, 
-0000a010: 2d31 5d2c 2054 5b2d 312c 202d 315d 290a  -1], T[-1, -1]).
-0000a020: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
-0000a030: 6f6f 206d 616e 7920 696e 6469 6365 730a  oo many indices.
-0000a040: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0000a050: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-0000a060: 6573 2849 6e64 6578 4572 726f 7229 3a0a  es(IndexError):.
-0000a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a080: 545b 3a2c 203a 2c20 3a5d 0a20 2020 2020  T[:, :, :].     
-0000a090: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-0000a0a0: 2e61 7373 6572 7452 6169 7365 7328 496e  .assertRaises(In
-0000a0b0: 6465 7845 7272 6f72 293a 0a20 2020 2020  dexError):.     
-0000a0c0: 2020 2020 2020 2020 2020 2054 5b30 2c20             T[0, 
-0000a0d0: 3a2c 203a 5d0a 2020 2020 2020 2020 2020  :, :].          
-0000a0e0: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
-0000a0f0: 7274 5261 6973 6573 2849 6e64 6578 4572  rtRaises(IndexEr
-0000a100: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
-0000a110: 2020 2020 2020 545b 3a2c 2030 2c20 3a5d        T[:, 0, :]
-0000a120: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-0000a130: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
-0000a140: 7365 7328 496e 6465 7845 7272 6f72 293a  ses(IndexError):
-0000a150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a160: 2054 5b3a 2c20 3a2c 2030 5d0a 2020 2020   T[:, :, 0].    
-0000a170: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-0000a180: 662e 6173 7365 7274 5261 6973 6573 2849  f.assertRaises(I
-0000a190: 6e64 6578 4572 726f 7229 3a0a 2020 2020  ndexError):.    
-0000a1a0: 2020 2020 2020 2020 2020 2020 545b 302c              T[0,
-0000a1b0: 2030 2c20 305d 0a0a 2020 2020 2020 2020   0, 0]..        
-0000a1c0: 2020 2020 2320 6f6e 6c79 2073 696e 676c      # only singl
-0000a1d0: 6520 656c 6c69 7073 6973 2061 6c6c 6f77  e ellipsis allow
-0000a1e0: 6564 0a20 2020 2020 2020 2020 2020 2077  ed.            w
-0000a1f0: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
-0000a200: 6169 7365 7328 496e 6465 7845 7272 6f72  aises(IndexError
-0000a210: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000a220: 2020 2054 5b2e 2e2e 2c20 2e2e 2e5d 0a0a     T[..., ...]..
-0000a230: 2020 2020 2020 2020 7769 7468 2074 696c          with til
-0000a240: 6564 622e 4465 6e73 6541 7272 6179 2873  edb.DenseArray(s
-0000a250: 656c 662e 7061 7468 2822 666f 6f22 292c  elf.path("foo"),
-0000a260: 206d 6f64 653d 2277 2229 2061 7320 543a   mode="w") as T:
-0000a270: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-0000a280: 6865 636b 2070 6172 7469 616c 2061 7373  heck partial ass
-0000a290: 6967 6e6d 656e 740a 2020 2020 2020 2020  ignment.        
-0000a2a0: 2020 2020 4220 3d20 6e70 2e61 7261 6e67      B = np.arang
-0000a2b0: 6528 3130 3030 302c 2032 3030 3030 292e  e(10000, 20000).
-0000a2c0: 7265 7368 6170 6528 2831 3030 302c 2031  reshape((1000, 1
-0000a2d0: 3029 290a 2020 2020 2020 2020 2020 2020  0)).            
-0000a2e0: 545b 3139 303a 3331 302c 2033 3a37 5d20  T[190:310, 3:7] 
-0000a2f0: 3d20 425b 3139 303a 3331 302c 2033 3a37  = B[190:310, 3:7
-0000a300: 5d0a 0a20 2020 2020 2020 2077 6974 6820  ]..        with 
-0000a310: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-0000a320: 7928 7365 6c66 2e70 6174 6828 2266 6f6f  y(self.path("foo
-0000a330: 2229 2c20 6d6f 6465 3d22 7222 2920 6173  "), mode="r") as
-0000a340: 2054 3a0a 2020 2020 2020 2020 2020 2020   T:.            
-0000a350: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-0000a360: 616c 2841 5b3a 3139 305d 2c20 545b 3a31  al(A[:190], T[:1
-0000a370: 3930 5d29 0a20 2020 2020 2020 2020 2020  90]).           
-0000a380: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-0000a390: 7561 6c28 415b 3a2c 203a 335d 2c20 545b  ual(A[:, :3], T[
-0000a3a0: 3a2c 203a 335d 290a 2020 2020 2020 2020  :, :3]).        
-0000a3b0: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
-0000a3c0: 5f65 7175 616c 2842 5b31 3930 3a33 3130  _equal(B[190:310
-0000a3d0: 2c20 333a 375d 2c20 545b 3139 303a 3331  , 3:7], T[190:31
-0000a3e0: 302c 2033 3a37 5d29 0a20 2020 2020 2020  0, 3:7]).       
-0000a3f0: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-0000a400: 795f 6571 7561 6c28 415b 3331 303a 5d2c  y_equal(A[310:],
-0000a410: 2054 5b33 3130 3a5d 290a 2020 2020 2020   T[310:]).      
-0000a420: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
-0000a430: 6179 5f65 7175 616c 2841 5b3a 2c20 373a  ay_equal(A[:, 7:
-0000a440: 5d2c 2054 5b3a 2c20 373a 5d29 0a0a 2020  ], T[:, 7:])..  
-0000a450: 2020 4070 7974 6573 742e 6d61 726b 2e73    @pytest.mark.s
-0000a460: 6b69 7069 6628 0a20 2020 2020 2020 206e  kipif(.        n
-0000a470: 6f74 2028 7379 732e 706c 6174 666f 726d  ot (sys.platform
-0000a480: 203d 3d20 2277 696e 3332 2220 616e 6420   == "win32" and 
-0000a490: 7469 6c65 6462 2e6c 6962 7469 6c65 6462  tiledb.libtiledb
-0000a4a0: 2e76 6572 7369 6f6e 2829 203e 3d20 2832  .version() >= (2
-0000a4b0: 2c20 332c 2030 2929 2c0a 2020 2020 2020  , 3, 0)),.      
-0000a4c0: 2020 7265 6173 6f6e 3d22 5368 6172 6564    reason="Shared
-0000a4d0: 206e 6574 776f 726b 2064 7269 7665 206f   network drive o
-0000a4e0: 6e6c 7920 6f6e 2057 696e 3332 222c 0a20  nly on Win32",. 
-0000a4f0: 2020 2029 0a20 2020 2064 6566 2074 6573     ).    def tes
-0000a500: 745f 6172 7261 795f 3164 5f73 6861 7265  t_array_1d_share
-0000a510: 645f 6472 6976 6528 7365 6c66 293a 0a20  d_drive(self):. 
-0000a520: 2020 2020 2020 2041 203d 206e 702e 7a65         A = np.ze
-0000a530: 726f 7328 3530 290a 0a20 2020 2020 2020  ros(50)..       
-0000a540: 2064 6f6d 203d 2074 696c 6564 622e 446f   dom = tiledb.Do
-0000a550: 6d61 696e 2874 696c 6564 622e 4469 6d28  main(tiledb.Dim(
-0000a560: 646f 6d61 696e 3d28 302c 2034 3929 2c20  domain=(0, 49), 
-0000a570: 7469 6c65 3d35 3029 290a 2020 2020 2020  tile=50)).      
-0000a580: 2020 6174 7420 3d20 7469 6c65 6462 2e41    att = tiledb.A
-0000a590: 7474 7228 6474 7970 653d 412e 6474 7970  ttr(dtype=A.dtyp
-0000a5a0: 6529 0a20 2020 2020 2020 2073 6368 656d  e).        schem
-0000a5b0: 6120 3d20 7469 6c65 6462 2e41 7272 6179  a = tiledb.Array
-0000a5c0: 5363 6865 6d61 2864 6f6d 2c20 2861 7474  Schema(dom, (att
-0000a5d0: 2c29 290a 2020 2020 2020 2020 7572 6920  ,)).        uri 
-0000a5e0: 3d20 7365 6c66 2e70 6174 6828 2266 6f6f  = self.path("foo
-0000a5f0: 222c 2073 6861 7265 643d 5472 7565 290a  ", shared=True).
-0000a600: 0a20 2020 2020 2020 2074 696c 6564 622e  .        tiledb.
-0000a610: 4465 6e73 6541 7272 6179 2e63 7265 6174  DenseArray.creat
-0000a620: 6528 7572 692c 2073 6368 656d 6129 0a0a  e(uri, schema)..
-0000a630: 2020 2020 2020 2020 7769 7468 2074 696c          with til
-0000a640: 6564 622e 4465 6e73 6541 7272 6179 2875  edb.DenseArray(u
-0000a650: 7269 2c20 6d6f 6465 3d22 7722 2920 6173  ri, mode="w") as
-0000a660: 2054 3a0a 2020 2020 2020 2020 2020 2020   T:.            
-0000a670: 545b 3a5d 203d 2041 0a0a 2020 2020 2020  T[:] = A..      
-0000a680: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
-0000a690: 6e73 6541 7272 6179 2875 7269 2c20 6d6f  nseArray(uri, mo
-0000a6a0: 6465 3d22 7222 2920 6173 2054 3a0a 2020  de="r") as T:.  
-0000a6b0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-0000a6c0: 5f61 7272 6179 5f65 7175 616c 2841 2c20  _array_equal(A, 
-0000a6d0: 545b 3a5d 290a 0a20 2020 2020 2020 2077  T[:])..        w
-0000a6e0: 6974 6820 7469 6c65 6462 2e44 656e 7365  ith tiledb.Dense
-0000a6f0: 4172 7261 7928 7572 692c 206d 6f64 653d  Array(uri, mode=
-0000a700: 2277 2229 2061 7320 543a 0a20 2020 2020  "w") as T:.     
-0000a710: 2020 2020 2020 2076 616c 7565 203d 202d         value = -
-0000a720: 312c 2033 2c20 3130 0a20 2020 2020 2020  1, 3, 10.       
-0000a730: 2020 2020 2041 5b30 5d2c 2041 5b31 5d2c       A[0], A[1],
-0000a740: 2041 5b33 5d20 3d20 7661 6c75 650a 2020   A[3] = value.  
-0000a750: 2020 2020 2020 2020 2020 545b 305d 2c20            T[0], 
-0000a760: 545b 315d 2c20 545b 335d 203d 2076 616c  T[1], T[3] = val
-0000a770: 7565 0a20 2020 2020 2020 2077 6974 6820  ue.        with 
-0000a780: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-0000a790: 7928 7572 692c 206d 6f64 653d 2272 2229  y(uri, mode="r")
-0000a7a0: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
-0000a7b0: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
-0000a7c0: 6571 7561 6c28 412c 2054 5b3a 5d29 0a0a  equal(A, T[:])..
-0000a7d0: 2020 2020 2020 2020 666f 7220 7661 6c75          for valu
-0000a7e0: 6520 696e 2028 2d31 2c20 332c 2031 3029  e in (-1, 3, 10)
-0000a7f0: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
-0000a800: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
-0000a810: 7272 6179 2875 7269 2c20 6d6f 6465 3d22  rray(uri, mode="
-0000a820: 7722 2920 6173 2054 3a0a 2020 2020 2020  w") as T:.      
-0000a830: 2020 2020 2020 2020 2020 415b 353a 3235            A[5:25
-0000a840: 5d20 3d20 7661 6c75 650a 2020 2020 2020  ] = value.      
-0000a850: 2020 2020 2020 2020 2020 545b 353a 3235            T[5:25
-0000a860: 5d20 3d20 7661 6c75 650a 2020 2020 2020  ] = value.      
-0000a870: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-0000a880: 622e 4465 6e73 6541 7272 6179 2875 7269  b.DenseArray(uri
-0000a890: 2c20 6d6f 6465 3d22 7222 2920 6173 2054  , mode="r") as T
-0000a8a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a8b0: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-0000a8c0: 7175 616c 2841 2c20 545b 3a5d 290a 2020  qual(A, T[:]).  
-0000a8d0: 2020 2020 2020 2020 2020 7769 7468 2074            with t
-0000a8e0: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
-0000a8f0: 2875 7269 2c20 6d6f 6465 3d22 7722 2920  (uri, mode="w") 
-0000a900: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
-0000a910: 2020 2020 2020 415b 3a5d 203d 2076 616c        A[:] = val
-0000a920: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0000a930: 2020 2054 5b3a 5d20 3d20 7661 6c75 650a     T[:] = value.
-0000a940: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0000a950: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
-0000a960: 6179 2875 7269 2c20 6d6f 6465 3d22 7222  ay(uri, mode="r"
-0000a970: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
-0000a980: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
-0000a990: 7272 6179 5f65 7175 616c 2841 2c20 545b  rray_equal(A, T[
-0000a9a0: 3a5d 290a 0a20 2020 2064 6566 2074 6573  :])..    def tes
-0000a9b0: 745f 6669 7865 645f 7374 7269 6e67 2873  t_fixed_string(s
-0000a9c0: 656c 6629 3a0a 2020 2020 2020 2020 6120  elf):.        a 
-0000a9d0: 3d20 6e70 2e61 7272 6179 285b 2261 6222  = np.array(["ab"
-0000a9e0: 2c20 2263 6422 2c20 2265 6622 2c20 2267  , "cd", "ef", "g
-0000a9f0: 6822 2c20 2269 6a22 2c20 226b 6c22 2c20  h", "ij", "kl", 
-0000aa00: 2222 2c20 226f 7022 5d2c 2064 7479 7065  "", "op"], dtype
-0000aa10: 3d22 7c53 3222 290a 2020 2020 2020 2020  ="|S2").        
-0000aa20: 7769 7468 2074 696c 6564 622e 6672 6f6d  with tiledb.from
-0000aa30: 5f6e 756d 7079 2873 656c 662e 7061 7468  _numpy(self.path
-0000aa40: 2822 6669 7865 645f 7374 7269 6e67 2229  ("fixed_string")
-0000aa50: 2c20 6129 2061 7320 543a 0a20 2020 2020  , a) as T:.     
-0000aa60: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
-0000aa70: 6462 2e6f 7065 6e28 7365 6c66 2e70 6174  db.open(self.pat
-0000aa80: 6828 2266 6978 6564 5f73 7472 696e 6722  h("fixed_string"
-0000aa90: 2929 2061 7320 523a 0a20 2020 2020 2020  )) as R:.       
-0000aaa0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-0000aab0: 7365 7274 4571 7561 6c28 542e 6474 7970  sertEqual(T.dtyp
-0000aac0: 652c 2052 2e64 7479 7065 290a 2020 2020  e, R.dtype).    
-0000aad0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000aae0: 2e61 7373 6572 7445 7175 616c 2852 2e61  .assertEqual(R.a
-0000aaf0: 7474 7228 3029 2e6e 6365 6c6c 732c 2032  ttr(0).ncells, 2
-0000ab00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ab10: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-0000ab20: 7175 616c 2854 2c20 5229 0a0a 2020 2020  qual(T, R)..    
-0000ab30: 6465 6620 7465 7374 5f6e 6365 6c6c 5f69  def test_ncell_i
-0000ab40: 6e74 2873 656c 6629 3a0a 2020 2020 2020  nt(self):.      
-0000ab50: 2020 6120 3d20 6e70 2e61 7272 6179 285b    a = np.array([
-0000ab60: 2831 2c20 3229 2c20 2833 2c20 3429 2c20  (1, 2), (3, 4), 
-0000ab70: 2835 2c20 3629 5d2c 2064 7479 7065 3d5b  (5, 6)], dtype=[
-0000ab80: 2822 222c 206e 702e 696e 7431 3629 2c20  ("", np.int16), 
-0000ab90: 2822 222c 206e 702e 696e 7431 3629 5d29  ("", np.int16)])
-0000aba0: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
-0000abb0: 6c65 6462 2e66 726f 6d5f 6e75 6d70 7928  ledb.from_numpy(
-0000abc0: 7365 6c66 2e70 6174 6828 226e 6365 6c6c  self.path("ncell
-0000abd0: 5f69 6e74 3136 2229 2c20 6129 2061 7320  _int16"), a) as 
-0000abe0: 543a 0a20 2020 2020 2020 2020 2020 2077  T:.            w
-0000abf0: 6974 6820 7469 6c65 6462 2e6f 7065 6e28  ith tiledb.open(
-0000ac00: 7365 6c66 2e70 6174 6828 226e 6365 6c6c  self.path("ncell
-0000ac10: 5f69 6e74 3136 2229 2920 6173 2052 3a0a  _int16")) as R:.
-0000ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac30: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000ac40: 2854 2e64 7479 7065 2c20 522e 6474 7970  (T.dtype, R.dtyp
-0000ac50: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0000ac60: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0000ac70: 7561 6c28 522e 6174 7472 2830 292e 6e63  ual(R.attr(0).nc
-0000ac80: 656c 6c73 2c20 3229 0a20 2020 2020 2020  ells, 2).       
-0000ac90: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-0000aca0: 6172 7261 795f 6571 7561 6c28 542c 2052  array_equal(T, R
-0000acb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000acc0: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-0000acd0: 7175 616c 2854 2c20 522e 6d75 6c74 695f  qual(T, R.multi_
-0000ace0: 696e 6465 785b 303a 325d 5b22 225d 290a  index[0:2][""]).
-0000acf0: 0a20 2020 2064 6566 2074 6573 745f 6f70  .    def test_op
-0000ad00: 656e 5f77 6974 685f 7469 6d65 7374 616d  en_with_timestam
-0000ad10: 7028 7365 6c66 293a 0a20 2020 2020 2020  p(self):.       
-0000ad20: 2041 203d 206e 702e 7a65 726f 7328 3329   A = np.zeros(3)
-0000ad30: 0a0a 2020 2020 2020 2020 646f 6d20 3d20  ..        dom = 
-0000ad40: 7469 6c65 6462 2e44 6f6d 6169 6e28 7469  tiledb.Domain(ti
-0000ad50: 6c65 6462 2e44 696d 2864 6f6d 6169 6e3d  ledb.Dim(domain=
-0000ad60: 2830 2c20 3229 2c20 7469 6c65 3d33 2c20  (0, 2), tile=3, 
-0000ad70: 6474 7970 653d 6e70 2e69 6e74 3634 2929  dtype=np.int64))
-0000ad80: 0a20 2020 2020 2020 2061 7474 203d 2074  .        att = t
-0000ad90: 696c 6564 622e 4174 7472 2864 7479 7065  iledb.Attr(dtype
-0000ada0: 3d41 2e64 7479 7065 290a 2020 2020 2020  =A.dtype).      
-0000adb0: 2020 7363 6865 6d61 203d 2074 696c 6564    schema = tiled
-0000adc0: 622e 4172 7261 7953 6368 656d 6128 646f  b.ArraySchema(do
-0000add0: 6d61 696e 3d64 6f6d 2c20 6174 7472 733d  main=dom, attrs=
-0000ade0: 2861 7474 2c29 290a 2020 2020 2020 2020  (att,)).        
-0000adf0: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-0000ae00: 792e 6372 6561 7465 2873 656c 662e 7061  y.create(self.pa
-0000ae10: 7468 2822 666f 6f22 292c 2073 6368 656d  th("foo"), schem
-0000ae20: 6129 0a0a 2020 2020 2020 2020 2320 7772  a)..        # wr
-0000ae30: 6974 650a 2020 2020 2020 2020 7769 7468  ite.        with
-0000ae40: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
-0000ae50: 6179 2873 656c 662e 7061 7468 2822 666f  ay(self.path("fo
-0000ae60: 6f22 292c 206d 6f64 653d 2277 2229 2061  o"), mode="w") a
-0000ae70: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
-0000ae80: 2054 5b3a 5d20 3d20 410a 0a20 2020 2020   T[:] = A..     
-0000ae90: 2020 2072 6561 6431 5f74 696d 6573 7461     read1_timesta
-0000aea0: 6d70 203d 202d 310a 2020 2020 2020 2020  mp = -1.        
-0000aeb0: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
-0000aec0: 6541 7272 6179 2873 656c 662e 7061 7468  eArray(self.path
-0000aed0: 2822 666f 6f22 292c 206d 6f64 653d 2272  ("foo"), mode="r
-0000aee0: 2229 2061 7320 543a 0a20 2020 2020 2020  ") as T:.       
-0000aef0: 2020 2020 2072 6561 6431 5f74 696d 6573       read1_times
-0000af00: 7461 6d70 203d 2054 2e74 696d 6573 7461  tamp = T.timesta
-0000af10: 6d70 5f72 616e 6765 0a20 2020 2020 2020  mp_range.       
-0000af20: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000af30: 4571 7561 6c28 545b 305d 2c20 3029 0a20  Equal(T[0], 0). 
-0000af40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000af50: 6173 7365 7274 4571 7561 6c28 545b 315d  assertEqual(T[1]
-0000af60: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
-0000af70: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000af80: 6c28 545b 325d 2c20 3029 0a0a 2020 2020  l(T[2], 0)..    
-0000af90: 2020 2020 2320 736c 6565 7020 3230 306d      # sleep 200m
-0000afa0: 7320 616e 6420 7772 6974 650a 2020 2020  s and write.    
-0000afb0: 2020 2020 7469 6d65 2e73 6c65 6570 2830      time.sleep(0
-0000afc0: 2e32 290a 2020 2020 2020 2020 7769 7468  .2).        with
-0000afd0: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
-0000afe0: 6179 2873 656c 662e 7061 7468 2822 666f  ay(self.path("fo
-0000aff0: 6f22 292c 206d 6f64 653d 2277 2229 2061  o"), mode="w") a
-0000b000: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
-0000b010: 2054 5b30 3a31 5d20 3d20 310a 0a20 2020   T[0:1] = 1..   
-0000b020: 2020 2020 2072 6561 6432 5f74 696d 6573       read2_times
-0000b030: 7461 6d70 203d 202d 310a 2020 2020 2020  tamp = -1.      
-0000b040: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
-0000b050: 6e73 6541 7272 6179 2873 656c 662e 7061  nseArray(self.pa
-0000b060: 7468 2822 666f 6f22 292c 206d 6f64 653d  th("foo"), mode=
-0000b070: 2272 2229 2061 7320 543a 0a20 2020 2020  "r") as T:.     
-0000b080: 2020 2020 2020 2072 6561 6432 5f74 696d         read2_tim
-0000b090: 6573 7461 6d70 203d 2054 2e74 696d 6573  estamp = T.times
-0000b0a0: 7461 6d70 5f72 616e 6765 0a20 2020 2020  tamp_range.     
-0000b0b0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000b0c0: 7274 5472 7565 2872 6561 6432 5f74 696d  rtTrue(read2_tim
-0000b0d0: 6573 7461 6d70 203e 2072 6561 6431 5f74  estamp > read1_t
-0000b0e0: 696d 6573 7461 6d70 290a 0a20 2020 2020  imestamp)..     
-0000b0f0: 2020 2023 2073 6c65 6570 2032 3030 6d73     # sleep 200ms
-0000b100: 2061 6e64 2077 7269 7465 0a20 2020 2020   and write.     
-0000b110: 2020 2074 696d 652e 736c 6565 7028 302e     time.sleep(0.
-0000b120: 3229 0a20 2020 2020 2020 2077 6974 6820  2).        with 
-0000b130: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-0000b140: 7928 7365 6c66 2e70 6174 6828 2266 6f6f  y(self.path("foo
-0000b150: 2229 2c20 6d6f 6465 3d22 7722 2920 6173  "), mode="w") as
-0000b160: 2054 3a0a 2020 2020 2020 2020 2020 2020   T:.            
-0000b170: 545b 313a 325d 203d 2032 0a0a 2020 2020  T[1:2] = 2..    
-0000b180: 2020 2020 7265 6164 335f 7469 6d65 7374      read3_timest
-0000b190: 616d 7020 3d20 2d31 0a20 2020 2020 2020  amp = -1.       
-0000b1a0: 2077 6974 6820 7469 6c65 6462 2e44 656e   with tiledb.Den
-0000b1b0: 7365 4172 7261 7928 7365 6c66 2e70 6174  seArray(self.pat
-0000b1c0: 6828 2266 6f6f 2229 2c20 6d6f 6465 3d22  h("foo"), mode="
-0000b1d0: 7222 2920 6173 2054 3a0a 2020 2020 2020  r") as T:.      
-0000b1e0: 2020 2020 2020 7265 6164 335f 7469 6d65        read3_time
-0000b1f0: 7374 616d 7020 3d20 542e 7469 6d65 7374  stamp = T.timest
-0000b200: 616d 705f 7261 6e67 650a 2020 2020 2020  amp_range.      
-0000b210: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0000b220: 7454 7275 6528 7265 6164 335f 7469 6d65  tTrue(read3_time
-0000b230: 7374 616d 7020 3e20 7265 6164 325f 7469  stamp > read2_ti
-0000b240: 6d65 7374 616d 7020 3e20 7265 6164 315f  mestamp > read1_
-0000b250: 7469 6d65 7374 616d 7029 0a0a 2020 2020  timestamp)..    
-0000b260: 2020 2020 2320 7265 6164 2061 7420 6669      # read at fi
-0000b270: 7273 7420 7469 6d65 7374 616d 700a 2020  rst timestamp.  
-0000b280: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-0000b290: 622e 4465 6e73 6541 7272 6179 280a 2020  b.DenseArray(.  
-0000b2a0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000b2b0: 6174 6828 2266 6f6f 2229 2c20 7469 6d65  ath("foo"), time
-0000b2c0: 7374 616d 703d 7265 6164 315f 7469 6d65  stamp=read1_time
-0000b2d0: 7374 616d 702c 206d 6f64 653d 2272 220a  stamp, mode="r".
-0000b2e0: 2020 2020 2020 2020 2920 6173 2054 3a0a          ) as T:.
-0000b2f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000b300: 2e61 7373 6572 7445 7175 616c 2854 5b30  .assertEqual(T[0
-0000b310: 5d2c 2030 290a 2020 2020 2020 2020 2020  ], 0).          
-0000b320: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000b330: 616c 2854 5b31 5d2c 2030 290a 2020 2020  al(T[1], 0).    
-0000b340: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000b350: 6572 7445 7175 616c 2854 5b32 5d2c 2030  ertEqual(T[2], 0
-0000b360: 290a 0a20 2020 2020 2020 2023 2072 6561  )..        # rea
-0000b370: 6420 6174 2073 6563 6f6e 6420 7469 6d65  d at second time
-0000b380: 7374 616d 700a 2020 2020 2020 2020 7769  stamp.        wi
-0000b390: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
-0000b3a0: 7272 6179 280a 2020 2020 2020 2020 2020  rray(.          
-0000b3b0: 2020 7365 6c66 2e70 6174 6828 2266 6f6f    self.path("foo
-0000b3c0: 2229 2c20 7469 6d65 7374 616d 703d 7265  "), timestamp=re
-0000b3d0: 6164 325f 7469 6d65 7374 616d 702c 206d  ad2_timestamp, m
-0000b3e0: 6f64 653d 2272 220a 2020 2020 2020 2020  ode="r".        
-0000b3f0: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
-0000b400: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0000b410: 7175 616c 2854 5b30 5d2c 2031 290a 2020  qual(T[0], 1).  
-0000b420: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000b430: 7373 6572 7445 7175 616c 2854 5b31 5d2c  ssertEqual(T[1],
-0000b440: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
-0000b450: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0000b460: 2854 5b32 5d2c 2030 290a 0a20 2020 2020  (T[2], 0)..     
-0000b470: 2020 2023 2072 6561 6420 6174 2074 6869     # read at thi
-0000b480: 7264 2074 696d 6573 7461 6d70 0a20 2020  rd timestamp.   
-0000b490: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-0000b4a0: 2e44 656e 7365 4172 7261 7928 0a20 2020  .DenseArray(.   
-0000b4b0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-0000b4c0: 7468 2822 666f 6f22 292c 2074 696d 6573  th("foo"), times
-0000b4d0: 7461 6d70 3d72 6561 6433 5f74 696d 6573  tamp=read3_times
-0000b4e0: 7461 6d70 2c20 6d6f 6465 3d22 7222 0a20  tamp, mode="r". 
-0000b4f0: 2020 2020 2020 2029 2061 7320 543a 0a20         ) as T:. 
-0000b500: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b510: 6173 7365 7274 4571 7561 6c28 545b 305d  assertEqual(T[0]
-0000b520: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
-0000b530: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000b540: 6c28 545b 315d 2c20 3229 0a20 2020 2020  l(T[1], 2).     
-0000b550: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000b560: 7274 4571 7561 6c28 545b 325d 2c20 3029  rtEqual(T[2], 0)
-0000b570: 0a0a 2020 2020 6465 6620 7465 7374 5f6f  ..    def test_o
-0000b580: 7065 6e5f 7469 6d65 7374 616d 705f 7261  pen_timestamp_ra
-0000b590: 6e67 6528 7365 6c66 293a 0a20 2020 2020  nge(self):.     
-0000b5a0: 2020 2041 203d 206e 702e 7a65 726f 7328     A = np.zeros(
-0000b5b0: 3329 0a20 2020 2020 2020 2070 6174 6820  3).        path 
-0000b5c0: 3d20 7365 6c66 2e70 6174 6828 226f 7065  = self.path("ope
-0000b5d0: 6e5f 7469 6d65 7374 616d 705f 7261 6e67  n_timestamp_rang
-0000b5e0: 6522 290a 0a20 2020 2020 2020 2064 6f6d  e")..        dom
-0000b5f0: 203d 2074 696c 6564 622e 446f 6d61 696e   = tiledb.Domain
-0000b600: 2874 696c 6564 622e 4469 6d28 646f 6d61  (tiledb.Dim(doma
-0000b610: 696e 3d28 302c 2032 292c 2074 696c 653d  in=(0, 2), tile=
-0000b620: 332c 2064 7479 7065 3d6e 702e 696e 7436  3, dtype=np.int6
-0000b630: 3429 290a 2020 2020 2020 2020 6174 7420  4)).        att 
-0000b640: 3d20 7469 6c65 6462 2e41 7474 7228 6474  = tiledb.Attr(dt
-0000b650: 7970 653d 412e 6474 7970 6529 0a20 2020  ype=A.dtype).   
-0000b660: 2020 2020 2073 6368 656d 6120 3d20 7469       schema = ti
-0000b670: 6c65 6462 2e41 7272 6179 5363 6865 6d61  ledb.ArraySchema
-0000b680: 2864 6f6d 6169 6e3d 646f 6d2c 2061 7474  (domain=dom, att
-0000b690: 7273 3d28 6174 742c 2929 0a20 2020 2020  rs=(att,)).     
-0000b6a0: 2020 2074 696c 6564 622e 4465 6e73 6541     tiledb.DenseA
-0000b6b0: 7272 6179 2e63 7265 6174 6528 7061 7468  rray.create(path
-0000b6c0: 2c20 7363 6865 6d61 290a 0a20 2020 2020  , schema)..     
-0000b6d0: 2020 2023 2077 7269 7465 0a20 2020 2020     # write.     
-0000b6e0: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
-0000b6f0: 656e 7365 4172 7261 7928 7061 7468 2c20  enseArray(path, 
-0000b700: 7469 6d65 7374 616d 703d 312c 206d 6f64  timestamp=1, mod
-0000b710: 653d 2277 2229 2061 7320 543a 0a20 2020  e="w") as T:.   
-0000b720: 2020 2020 2020 2020 2054 5b3a 5d20 3d20           T[:] = 
-0000b730: 4120 2a20 310a 2020 2020 2020 2020 7769  A * 1.        wi
-0000b740: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
-0000b750: 7272 6179 2870 6174 682c 2074 696d 6573  rray(path, times
-0000b760: 7461 6d70 3d32 2c20 6d6f 6465 3d22 7722  tamp=2, mode="w"
-0000b770: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
-0000b780: 2020 2020 545b 3a5d 203d 2041 202a 2032      T[:] = A * 2
-0000b790: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
-0000b7a0: 6c65 6462 2e44 656e 7365 4172 7261 7928  ledb.DenseArray(
-0000b7b0: 7061 7468 2c20 7469 6d65 7374 616d 703d  path, timestamp=
-0000b7c0: 332c 206d 6f64 653d 2277 2229 2061 7320  3, mode="w") as 
-0000b7d0: 543a 0a20 2020 2020 2020 2020 2020 2054  T:.            T
-0000b7e0: 5b3a 5d20 3d20 4120 2a20 330a 2020 2020  [:] = A * 3.    
-0000b7f0: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
-0000b800: 4465 6e73 6541 7272 6179 2870 6174 682c  DenseArray(path,
-0000b810: 2074 696d 6573 7461 6d70 3d34 2c20 6d6f   timestamp=4, mo
-0000b820: 6465 3d22 7722 2920 6173 2054 3a0a 2020  de="w") as T:.  
-0000b830: 2020 2020 2020 2020 2020 545b 3a5d 203d            T[:] =
-0000b840: 2041 202a 2034 0a0a 2020 2020 2020 2020   A * 4..        
-0000b850: 6465 6620 6173 7365 7274 5f74 7328 7469  def assert_ts(ti
-0000b860: 6d65 7374 616d 702c 2072 6573 756c 7429  mestamp, result)
-0000b870: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
-0000b880: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
-0000b890: 7272 6179 2870 6174 682c 206d 6f64 653d  rray(path, mode=
-0000b8a0: 2272 222c 2074 696d 6573 7461 6d70 3d74  "r", timestamp=t
-0000b8b0: 696d 6573 7461 6d70 2920 6173 2054 3a0a  imestamp) as T:.
-0000b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8d0: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-0000b8e0: 616c 2854 2c20 7265 7375 6c74 290a 0a20  al(T, result).. 
-0000b8f0: 2020 2020 2020 2061 7373 6572 745f 7473         assert_ts
-0000b900: 2830 2c20 4120 2a20 6e70 2e6e 616e 290a  (0, A * np.nan).
-0000b910: 2020 2020 2020 2020 6173 7365 7274 5f74          assert_t
-0000b920: 7328 312c 2041 202a 2031 290a 2020 2020  s(1, A * 1).    
-0000b930: 2020 2020 6173 7365 7274 5f74 7328 322c      assert_ts(2,
-0000b940: 2041 202a 2032 290a 2020 2020 2020 2020   A * 2).        
-0000b950: 6173 7365 7274 5f74 7328 332c 2041 202a  assert_ts(3, A *
-0000b960: 2033 290a 2020 2020 2020 2020 6173 7365   3).        asse
-0000b970: 7274 5f74 7328 2831 2c20 3229 2c20 4120  rt_ts((1, 2), A 
-0000b980: 2a20 3229 0a20 2020 2020 2020 2061 7373  * 2).        ass
-0000b990: 6572 745f 7473 2828 302c 2033 292c 2041  ert_ts((0, 3), A
-0000b9a0: 202a 2033 290a 2020 2020 2020 2020 6173   * 3).        as
-0000b9b0: 7365 7274 5f74 7328 2831 2c20 3329 2c20  sert_ts((1, 3), 
-0000b9c0: 4120 2a20 3329 0a20 2020 2020 2020 2061  A * 3).        a
-0000b9d0: 7373 6572 745f 7473 2828 322c 2033 292c  ssert_ts((2, 3),
-0000b9e0: 2041 202a 2033 290a 2020 2020 2020 2020   A * 3).        
-0000b9f0: 6173 7365 7274 5f74 7328 2832 2c20 3429  assert_ts((2, 4)
-0000ba00: 2c20 4120 2a20 3329 0a20 2020 2020 2020  , A * 3).       
-0000ba10: 2061 7373 6572 745f 7473 2828 4e6f 6e65   assert_ts((None
-0000ba20: 2c20 3229 2c20 4120 2a20 3229 0a20 2020  , 2), A * 2).   
-0000ba30: 2020 2020 2061 7373 6572 745f 7473 2828       assert_ts((
-0000ba40: 4e6f 6e65 2c20 3329 2c20 4120 2a20 3329  None, 3), A * 3)
-0000ba50: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
-0000ba60: 7473 2828 322c 204e 6f6e 6529 2c20 4120  ts((2, None), A 
-0000ba70: 2a20 3329 0a20 2020 2020 2020 2061 7373  * 3).        ass
-0000ba80: 6572 745f 7473 2828 332c 204e 6f6e 6529  ert_ts((3, None)
-0000ba90: 2c20 4120 2a20 3329 0a20 2020 2020 2020  , A * 3).       
-0000baa0: 2061 7373 6572 745f 7473 2828 332c 204e   assert_ts((3, N
-0000bab0: 6f6e 6529 2c20 4120 2a20 3329 0a0a 2020  one), A * 3)..  
-0000bac0: 2020 6465 6620 7465 7374 5f6e 6365 6c6c    def test_ncell
-0000bad0: 5f61 7474 7269 6275 7465 7328 7365 6c66  _attributes(self
-0000bae0: 293a 0a20 2020 2020 2020 2064 6f6d 203d  ):.        dom =
-0000baf0: 2074 696c 6564 622e 446f 6d61 696e 2874   tiledb.Domain(t
-0000bb00: 696c 6564 622e 4469 6d28 646f 6d61 696e  iledb.Dim(domain
-0000bb10: 3d28 302c 2039 292c 2074 696c 653d 3130  =(0, 9), tile=10
-0000bb20: 2c20 6474 7970 653d 696e 7429 290a 2020  , dtype=int)).  
-0000bb30: 2020 2020 2020 6174 7472 203d 2074 696c        attr = til
-0000bb40: 6564 622e 4174 7472 2864 7479 7065 3d5b  edb.Attr(dtype=[
-0000bb50: 2822 222c 206e 702e 696e 7433 3229 2c20  ("", np.int32), 
-0000bb60: 2822 222c 206e 702e 696e 7433 3229 2c20  ("", np.int32), 
-0000bb70: 2822 222c 206e 702e 696e 7433 3229 5d29  ("", np.int32)])
-0000bb80: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
-0000bb90: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
-0000bba0: 6865 6d61 2864 6f6d 6169 6e3d 646f 6d2c  hema(domain=dom,
-0000bbb0: 2061 7474 7273 3d28 6174 7472 2c29 290a   attrs=(attr,)).
-0000bbc0: 2020 2020 2020 2020 7469 6c65 6462 2e44          tiledb.D
-0000bbd0: 656e 7365 4172 7261 792e 6372 6561 7465  enseArray.create
-0000bbe0: 2873 656c 662e 7061 7468 2822 666f 6f22  (self.path("foo"
-0000bbf0: 292c 2073 6368 656d 6129 0a0a 2020 2020  ), schema)..    
-0000bc00: 2020 2020 4120 3d20 6e70 2e6f 6e65 7328      A = np.ones(
-0000bc10: 2831 302c 292c 2064 7479 7065 3d5b 2822  (10,), dtype=[("
-0000bc20: 222c 206e 702e 696e 7433 3229 2c20 2822  ", np.int32), ("
-0000bc30: 222c 206e 702e 696e 7433 3229 2c20 2822  ", np.int32), ("
-0000bc40: 222c 206e 702e 696e 7433 3229 5d29 0a20  ", np.int32)]). 
-0000bc50: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0000bc60: 7274 4571 7561 6c28 412e 6474 7970 652c  rtEqual(A.dtype,
-0000bc70: 2061 7474 722e 6474 7970 6529 0a0a 2020   attr.dtype)..  
-0000bc80: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-0000bc90: 622e 4465 6e73 6541 7272 6179 2873 656c  b.DenseArray(sel
-0000bca0: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
-0000bcb0: 6f64 653d 2277 2229 2061 7320 543a 0a20  ode="w") as T:. 
-0000bcc0: 2020 2020 2020 2020 2020 2054 5b3a 5d20             T[:] 
-0000bcd0: 3d20 410a 2020 2020 2020 2020 7769 7468  = A.        with
-0000bce0: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
-0000bcf0: 6179 2873 656c 662e 7061 7468 2822 666f  ay(self.path("fo
-0000bd00: 6f22 292c 206d 6f64 653d 2272 2229 2061  o"), mode="r") a
-0000bd10: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
-0000bd20: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-0000bd30: 7561 6c28 412c 2054 5b3a 5d29 0a20 2020  ual(A, T[:]).   
-0000bd40: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-0000bd50: 6172 7261 795f 6571 7561 6c28 415b 3a35  array_equal(A[:5
-0000bd60: 5d2c 2054 5b3a 355d 290a 0a20 2020 2064  ], T[:5])..    d
-0000bd70: 6566 2074 6573 745f 636f 6d70 6c65 785f  ef test_complex_
-0000bd80: 6174 7472 6962 7574 6573 2873 656c 6629  attributes(self)
-0000bd90: 3a0a 2020 2020 2020 2020 646f 6d20 3d20  :.        dom = 
-0000bda0: 7469 6c65 6462 2e44 6f6d 6169 6e28 7469  tiledb.Domain(ti
-0000bdb0: 6c65 6462 2e44 696d 2864 6f6d 6169 6e3d  ledb.Dim(domain=
-0000bdc0: 2830 2c20 3929 2c20 7469 6c65 3d31 302c  (0, 9), tile=10,
-0000bdd0: 2064 7479 7065 3d69 6e74 2929 0a20 2020   dtype=int)).   
-0000bde0: 2020 2020 2061 7474 7220 3d20 7469 6c65       attr = tile
-0000bdf0: 6462 2e41 7474 7228 6474 7970 653d 6e70  db.Attr(dtype=np
-0000be00: 2e63 6f6d 706c 6578 3634 290a 2020 2020  .complex64).    
-0000be10: 2020 2020 7363 6865 6d61 203d 2074 696c      schema = til
-0000be20: 6564 622e 4172 7261 7953 6368 656d 6128  edb.ArraySchema(
-0000be30: 646f 6d61 696e 3d64 6f6d 2c20 6174 7472  domain=dom, attr
-0000be40: 733d 2861 7474 722c 2929 0a20 2020 2020  s=(attr,)).     
-0000be50: 2020 2074 696c 6564 622e 4465 6e73 6541     tiledb.DenseA
-0000be60: 7272 6179 2e63 7265 6174 6528 7365 6c66  rray.create(self
-0000be70: 2e70 6174 6828 2266 6f6f 2229 2c20 7363  .path("foo"), sc
-0000be80: 6865 6d61 290a 0a20 2020 2020 2020 2041  hema)..        A
-0000be90: 203d 206e 702e 7261 6e64 6f6d 2e72 616e   = np.random.ran
-0000bea0: 6428 3230 292e 6173 7479 7065 286e 702e  d(20).astype(np.
-0000beb0: 666c 6f61 7433 3229 2e76 6965 7728 6474  float32).view(dt
-0000bec0: 7970 653d 6e70 2e63 6f6d 706c 6578 3634  ype=np.complex64
-0000bed0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0000bee0: 6173 7365 7274 4571 7561 6c28 7363 6865  assertEqual(sche
-0000bef0: 6d61 2c20 7469 6c65 6462 2e73 6368 656d  ma, tiledb.schem
-0000bf00: 615f 6c69 6b65 2841 2c20 6469 6d5f 6474  a_like(A, dim_dt
-0000bf10: 7970 653d 696e 7429 290a 2020 2020 2020  ype=int)).      
-0000bf20: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0000bf30: 616c 2841 2e64 7479 7065 2c20 6174 7472  al(A.dtype, attr
-0000bf40: 2e64 7479 7065 290a 0a20 2020 2020 2020  .dtype)..       
-0000bf50: 2077 6974 6820 7469 6c65 6462 2e44 656e   with tiledb.Den
-0000bf60: 7365 4172 7261 7928 7365 6c66 2e70 6174  seArray(self.pat
-0000bf70: 6828 2266 6f6f 2229 2c20 6d6f 6465 3d22  h("foo"), mode="
-0000bf80: 7722 2920 6173 2054 3a0a 2020 2020 2020  w") as T:.      
-0000bf90: 2020 2020 2020 545b 3a5d 203d 2041 0a0a        T[:] = A..
-0000bfa0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
-0000bfb0: 6564 622e 4465 6e73 6541 7272 6179 2873  edb.DenseArray(s
-0000bfc0: 656c 662e 7061 7468 2822 666f 6f22 292c  elf.path("foo"),
-0000bfd0: 206d 6f64 653d 2272 2229 2061 7320 543a   mode="r") as T:
-0000bfe0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-0000bff0: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
-0000c000: 412c 2054 5b3a 5d29 0a20 2020 2020 2020  A, T[:]).       
-0000c010: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-0000c020: 795f 6571 7561 6c28 415b 3a35 5d2c 2054  y_equal(A[:5], T
-0000c030: 5b3a 355d 290a 0a20 2020 2064 6566 2074  [:5])..    def t
-0000c040: 6573 745f 6d75 6c74 6970 6c65 5f61 7474  est_multiple_att
-0000c050: 7269 6275 7465 7328 7365 6c66 293a 0a20  ributes(self):. 
-0000c060: 2020 2020 2020 2064 6f6d 203d 2074 696c         dom = til
-0000c070: 6564 622e 446f 6d61 696e 280a 2020 2020  edb.Domain(.    
-0000c080: 2020 2020 2020 2020 7469 6c65 6462 2e44          tiledb.D
-0000c090: 696d 2864 6f6d 6169 6e3d 2830 2c20 3129  im(domain=(0, 1)
-0000c0a0: 2c20 7469 6c65 3d31 2c20 6474 7970 653d  , tile=1, dtype=
-0000c0b0: 6e70 2e69 6e74 3634 292c 0a20 2020 2020  np.int64),.     
-0000c0c0: 2020 2020 2020 2074 696c 6564 622e 4469         tiledb.Di
-0000c0d0: 6d28 646f 6d61 696e 3d28 302c 2033 292c  m(domain=(0, 3),
-0000c0e0: 2074 696c 653d 342c 2064 7479 7065 3d6e   tile=4, dtype=n
-0000c0f0: 702e 696e 7436 3429 2c0a 2020 2020 2020  p.int64),.      
-0000c100: 2020 290a 2020 2020 2020 2020 6174 7472    ).        attr
-0000c110: 5f69 6e74 203d 2074 696c 6564 622e 4174  _int = tiledb.At
-0000c120: 7472 2822 696e 7473 222c 2064 7479 7065  tr("ints", dtype
-0000c130: 3d69 6e74 290a 2020 2020 2020 2020 6174  =int).        at
-0000c140: 7472 5f66 6c6f 6174 203d 2074 696c 6564  tr_float = tiled
-0000c150: 622e 4174 7472 2822 666c 6f61 7473 222c  b.Attr("floats",
-0000c160: 2064 7479 7065 3d66 6c6f 6174 290a 2020   dtype=float).  
-0000c170: 2020 2020 2020 7363 6865 6d61 203d 2074        schema = t
-0000c180: 696c 6564 622e 4172 7261 7953 6368 656d  iledb.ArraySchem
-0000c190: 6128 646f 6d61 696e 3d64 6f6d 2c20 6174  a(domain=dom, at
-0000c1a0: 7472 733d 2861 7474 725f 696e 742c 2061  trs=(attr_int, a
-0000c1b0: 7474 725f 666c 6f61 7429 290a 2020 2020  ttr_float)).    
-0000c1c0: 2020 2020 7469 6c65 6462 2e44 656e 7365      tiledb.Dense
-0000c1d0: 4172 7261 792e 6372 6561 7465 2873 656c  Array.create(sel
-0000c1e0: 662e 7061 7468 2822 666f 6f22 292c 2073  f.path("foo"), s
-0000c1f0: 6368 656d 6129 0a0a 2020 2020 2020 2020  chema)..        
-0000c200: 565f 696e 7473 203d 206e 702e 6172 7261  V_ints = np.arra
-0000c210: 7928 5b5b 302c 2031 2c20 322c 2033 5d2c  y([[0, 1, 2, 3],
-0000c220: 205b 342c 2036 2c20 372c 2035 5d5d 290a   [4, 6, 7, 5]]).
-0000c230: 2020 2020 2020 2020 565f 666c 6f61 7473          V_floats
-0000c240: 203d 206e 702e 6172 7261 7928 5b5b 302e   = np.array([[0.
-0000c250: 302c 2031 2e30 2c20 322e 302c 2033 2e30  0, 1.0, 2.0, 3.0
-0000c260: 5d2c 205b 342e 302c 2036 2e30 2c20 372e  ], [4.0, 6.0, 7.
-0000c270: 302c 2035 2e30 5d5d 290a 0a20 2020 2020  0, 5.0]])..     
-0000c280: 2020 2056 203d 207b 2269 6e74 7322 3a20     V = {"ints": 
-0000c290: 565f 696e 7473 2c20 2266 6c6f 6174 7322  V_ints, "floats"
-0000c2a0: 3a20 565f 666c 6f61 7473 7d0a 2020 2020  : V_floats}.    
-0000c2b0: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
-0000c2c0: 4465 6e73 6541 7272 6179 2873 656c 662e  DenseArray(self.
-0000c2d0: 7061 7468 2822 666f 6f22 292c 206d 6f64  path("foo"), mod
-0000c2e0: 653d 2277 2229 2061 7320 543a 0a20 2020  e="w") as T:.   
-0000c2f0: 2020 2020 2020 2020 2054 5b3a 5d20 3d20           T[:] = 
-0000c300: 560a 0a20 2020 2020 2020 2023 2063 6865  V..        # che
-0000c310: 636b 2073 6574 7469 6e67 2061 7474 7269  ck setting attri
-0000c320: 6275 7465 2069 6e20 6469 6666 6572 656e  bute in differen
-0000c330: 7420 6f72 6465 7220 6672 6f6d 2041 7474  t order from Att
-0000c340: 7220 6465 6669 6e69 7469 6f6e 0a20 2020  r definition.   
-0000c350: 2020 2020 2023 2020 2068 7474 7073 3a2f       #   https:/
-0000c360: 2f67 6974 6875 622e 636f 6d2f 5469 6c65  /github.com/Tile
-0000c370: 4442 2d49 6e63 2f54 696c 6544 422d 5079  DB-Inc/TileDB-Py
-0000c380: 2f69 7373 7565 732f 3239 390a 2020 2020  /issues/299.    
-0000c390: 2020 2020 5632 203d 207b 2266 6c6f 6174      V2 = {"float
-0000c3a0: 7322 3a20 565f 666c 6f61 7473 2c20 2269  s": V_floats, "i
-0000c3b0: 6e74 7322 3a20 565f 696e 7473 7d0a 2020  nts": V_ints}.  
-0000c3c0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-0000c3d0: 622e 4465 6e73 6541 7272 6179 2873 656c  b.DenseArray(sel
-0000c3e0: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
-0000c3f0: 6f64 653d 2277 2229 2061 7320 543a 0a20  ode="w") as T:. 
-0000c400: 2020 2020 2020 2020 2020 2054 5b3a 5d20             T[:] 
-0000c410: 3d20 560a 0a20 2020 2020 2020 2077 6974  = V..        wit
-0000c420: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
-0000c430: 7261 7928 7365 6c66 2e70 6174 6828 2266  ray(self.path("f
-0000c440: 6f6f 2229 2c20 6d6f 6465 3d22 7222 2920  oo"), mode="r") 
-0000c450: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
-0000c460: 2020 5220 3d20 545b 3a5d 0a20 2020 2020    R = T[:].     
-0000c470: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-0000c480: 7261 795f 6571 7561 6c28 565b 2269 6e74  ray_equal(V["int
-0000c490: 7322 5d2c 2052 5b22 696e 7473 225d 290a  s"], R["ints"]).
-0000c4a0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-0000c4b0: 7274 5f61 7272 6179 5f65 7175 616c 2856  rt_array_equal(V
-0000c4c0: 5b22 666c 6f61 7473 225d 2c20 525b 2266  ["floats"], R["f
-0000c4d0: 6c6f 6174 7322 5d29 0a0a 2020 2020 2020  loats"])..      
-0000c4e0: 2020 2020 2020 5220 3d20 542e 7175 6572        R = T.quer
-0000c4f0: 7928 6174 7472 733d 2822 696e 7473 222c  y(attrs=("ints",
-0000c500: 2929 5b31 3a33 5d0a 2020 2020 2020 2020  ))[1:3].        
-0000c510: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
-0000c520: 5f65 7175 616c 2856 5b22 696e 7473 225d  _equal(V["ints"]
-0000c530: 5b31 3a33 5d2c 2052 5b22 696e 7473 225d  [1:3], R["ints"]
-0000c540: 290a 0a20 2020 2020 2020 2020 2020 2052  )..            R
-0000c550: 203d 2054 2e71 7565 7279 2861 7474 7273   = T.query(attrs
-0000c560: 3d28 2266 6c6f 6174 7322 2c29 2c20 6f72  =("floats",), or
-0000c570: 6465 723d 2246 2229 5b3a 5d0a 2020 2020  der="F")[:].    
-0000c580: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000c590: 6572 7454 7275 6528 525b 2266 6c6f 6174  ertTrue(R["float
-0000c5a0: 7322 5d2e 666c 6167 732e 665f 636f 6e74  s"].flags.f_cont
-0000c5b0: 6967 756f 7573 290a 0a20 2020 2020 2020  iguous)..       
-0000c5c0: 2020 2020 2052 203d 2054 2e71 7565 7279       R = T.query
-0000c5d0: 2861 7474 7273 3d28 2269 6e74 7322 2c29  (attrs=("ints",)
-0000c5e0: 2c20 636f 6f72 6473 3d54 7275 6529 5b30  , coords=True)[0
-0000c5f0: 2c20 303a 335d 0a20 2020 2020 2020 2020  , 0:3].         
-0000c600: 2020 2073 656c 662e 6173 7365 7274 5472     self.assertTr
-0000c610: 7565 2822 5f5f 6469 6d5f 3022 2069 6e20  ue("__dim_0" in 
-0000c620: 5229 0a20 2020 2020 2020 2020 2020 2073  R).            s
-0000c630: 656c 662e 6173 7365 7274 5472 7565 2822  elf.assertTrue("
-0000c640: 5f5f 6469 6d5f 3122 2069 6e20 5229 0a20  __dim_1" in R). 
-0000c650: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-0000c660: 745f 6172 7261 795f 6571 7561 6c28 525b  t_array_equal(R[
-0000c670: 225f 5f64 696d 5f30 225d 2c20 6e70 2e61  "__dim_0"], np.a
-0000c680: 7272 6179 285b 302c 2030 2c20 305d 2929  rray([0, 0, 0]))
-0000c690: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-0000c6a0: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
-0000c6b0: 525b 225f 5f64 696d 5f31 225d 2c20 6e70  R["__dim_1"], np
-0000c6c0: 2e61 7272 6179 285b 302c 2031 2c20 325d  .array([0, 1, 2]
-0000c6d0: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-0000c6e0: 2320 476c 6f62 616c 206f 7264 6572 2072  # Global order r
-0000c6f0: 6574 7572 6e73 2072 6573 756c 7473 2061  eturns results a
-0000c700: 7320 6120 6c69 6e65 6172 2062 7566 6665  s a linear buffe
-0000c710: 720a 2020 2020 2020 2020 2020 2020 5220  r.            R 
-0000c720: 3d20 542e 7175 6572 7928 6174 7472 733d  = T.query(attrs=
-0000c730: 2822 696e 7473 222c 292c 206f 7264 6572  ("ints",), order
-0000c740: 3d22 4722 295b 3a5d 0a20 2020 2020 2020  ="G")[:].       
-0000c750: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000c760: 4571 7561 6c28 525b 2269 6e74 7322 5d2e  Equal(R["ints"].
-0000c770: 7368 6170 652c 2028 382c 2929 0a0a 2020  shape, (8,))..  
-0000c780: 2020 2020 2020 2020 2020 7769 7468 2073            with s
-0000c790: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-0000c7a0: 2874 696c 6564 622e 5469 6c65 4442 4572  (tiledb.TileDBEr
-0000c7b0: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
-0000c7c0: 2020 2020 2020 542e 7175 6572 7928 6174        T.query(at
-0000c7d0: 7472 733d 2822 756e 6b6e 6f77 6e22 2c29  trs=("unknown",)
-0000c7e0: 295b 3a5d 0a0a 2020 2020 2020 2020 7769  )[:]..        wi
-0000c7f0: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
-0000c800: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
-0000c810: 666f 6f22 292c 206d 6f64 653d 2277 2229  foo"), mode="w")
-0000c820: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
-0000c830: 2020 2023 2063 6865 636b 2065 7272 6f72     # check error
-0000c840: 206e 6365 6c6c 7320 6c65 6e67 7468 0a20   ncells length. 
-0000c850: 2020 2020 2020 2020 2020 2056 5b22 696e             V["in
-0000c860: 7473 225d 203d 2056 5b22 696e 7473 225d  ts"] = V["ints"]
-0000c870: 5b31 3a32 5d2e 636f 7079 2829 0a20 2020  [1:2].copy().   
-0000c880: 2020 2020 2020 2020 2077 6974 6820 7365           with se
-0000c890: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
-0000c8a0: 7469 6c65 6462 2e54 696c 6544 4245 7272  tiledb.TileDBErr
-0000c8b0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-0000c8c0: 2020 2020 2054 5b3a 5d20 3d20 560a 0a20       T[:] = V.. 
-0000c8d0: 2020 2020 2020 2020 2020 2023 2063 6865             # che
-0000c8e0: 636b 2065 7272 6f72 2061 7474 7269 6275  ck error attribu
-0000c8f0: 7465 2064 6f65 7320 6e6f 7420 6578 6973  te does not exis
-0000c900: 740a 2020 2020 2020 2020 2020 2020 565b  t.            V[
-0000c910: 2266 6f6f 225d 203d 2056 5b22 696e 7473  "foo"] = V["ints
-0000c920: 225d 2e61 7374 7970 6528 6e70 2e69 6e74  "].astype(np.int
-0000c930: 3829 0a20 2020 2020 2020 2020 2020 2077  8).            w
-0000c940: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
-0000c950: 6169 7365 7328 7469 6c65 6462 2e54 696c  aises(tiledb.Til
-0000c960: 6544 4245 7272 6f72 293a 0a20 2020 2020  eDBError):.     
-0000c970: 2020 2020 2020 2020 2020 2054 5b3a 5d20             T[:] 
-0000c980: 3d20 560a 0a20 2020 2064 6566 2074 6573  = V..    def tes
-0000c990: 745f 6172 7261 795f 3264 5f73 3128 7365  t_array_2d_s1(se
-0000c9a0: 6c66 293a 0a20 2020 2020 2020 2023 2054  lf):.        # T
-0000c9b0: 6869 7320 6172 7261 7920 6973 2063 7572  his array is cur
-0000c9c0: 7265 6e74 6c79 2072 6561 6420 6261 636b  rently read back
-0000c9d0: 2077 6974 6820 6474 7970 6520 6f62 6a65   with dtype obje
-0000c9e0: 6374 0a20 2020 2020 2020 2041 203d 206e  ct.        A = n
-0000c9f0: 702e 6172 7261 7928 5b5b 2241 222c 2022  p.array([["A", "
-0000ca00: 4222 5d2c 205b 2243 222c 2022 225d 5d2c  B"], ["C", ""]],
-0000ca10: 2064 7479 7065 3d22 5322 290a 0a20 2020   dtype="S")..   
-0000ca20: 2020 2020 2075 7269 203d 2073 656c 662e       uri = self.
-0000ca30: 7061 7468 2829 0a20 2020 2020 2020 2064  path().        d
-0000ca40: 6f6d 203d 2074 696c 6564 622e 446f 6d61  om = tiledb.Doma
-0000ca50: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
-0000ca60: 7469 6c65 6462 2e44 696d 286e 616d 653d  tiledb.Dim(name=
-0000ca70: 2272 6f77 7322 2c20 646f 6d61 696e 3d28  "rows", domain=(
-0000ca80: 302c 2031 292c 2074 696c 653d 322c 2064  0, 1), tile=2, d
-0000ca90: 7479 7065 3d6e 702e 696e 7436 3429 2c0a  type=np.int64),.
-0000caa0: 2020 2020 2020 2020 2020 2020 7469 6c65              tile
-0000cab0: 6462 2e44 696d 286e 616d 653d 2263 6f6c  db.Dim(name="col
-0000cac0: 7322 2c20 646f 6d61 696e 3d28 302c 2031  s", domain=(0, 1
-0000cad0: 292c 2074 696c 653d 322c 2064 7479 7065  ), tile=2, dtype
-0000cae0: 3d6e 702e 696e 7436 3429 2c0a 2020 2020  =np.int64),.    
-0000caf0: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
-0000cb00: 6368 656d 6120 3d20 7469 6c65 6462 2e41  chema = tiledb.A
-0000cb10: 7272 6179 5363 6865 6d61 280a 2020 2020  rraySchema(.    
-0000cb20: 2020 2020 2020 2020 646f 6d61 696e 3d64          domain=d
-0000cb30: 6f6d 2c20 7370 6172 7365 3d46 616c 7365  om, sparse=False
-0000cb40: 2c20 6174 7472 733d 5b74 696c 6564 622e  , attrs=[tiledb.
-0000cb50: 4174 7472 286e 616d 653d 2261 222c 2064  Attr(name="a", d
-0000cb60: 7479 7065 3d22 5322 295d 0a20 2020 2020  type="S")].     
-0000cb70: 2020 2029 0a0a 2020 2020 2020 2020 7469     )..        ti
-0000cb80: 6c65 6462 2e44 656e 7365 4172 7261 792e  ledb.DenseArray.
-0000cb90: 6372 6561 7465 2875 7269 2c20 7363 6865  create(uri, sche
-0000cba0: 6d61 290a 0a20 2020 2020 2020 2077 6974  ma)..        wit
-0000cbb0: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
-0000cbc0: 7261 7928 7572 692c 206d 6f64 653d 2277  ray(uri, mode="w
-0000cbd0: 2229 2061 7320 543a 0a20 2020 2020 2020  ") as T:.       
-0000cbe0: 2020 2020 2054 5b2e 2e2e 5d20 3d20 410a       T[...] = A.
-0000cbf0: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
-0000cc00: 6c65 6462 2e44 656e 7365 4172 7261 7928  ledb.DenseArray(
-0000cc10: 7572 6929 2061 7320 543a 0a20 2020 2020  uri) as T:.     
-0000cc20: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-0000cc30: 7261 795f 6571 7561 6c28 412c 2054 290a  ray_equal(A, T).
-0000cc40: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-0000cc50: 203d 2054 2e6d 756c 7469 5f69 6e64 6578   = T.multi_index
-0000cc60: 5b28 302c 2031 292c 2028 302c 2031 295d  [(0, 1), (0, 1)]
-0000cc70: 5b22 6122 5d0a 2020 2020 2020 2020 2020  ["a"].          
-0000cc80: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-0000cc90: 7175 616c 2841 2c20 7265 7329 0a0a 2020  qual(A, res)..  
-0000cca0: 2020 6465 6620 7465 7374 5f6e 645f 726f    def test_nd_ro
-0000ccb0: 756e 6474 7269 7028 7365 6c66 293a 0a20  undtrip(self):. 
-0000ccc0: 2020 2020 2020 2064 696d 5f73 6574 203d         dim_set =
-0000ccd0: 206e 702e 696e 7436 3428 5b33 202b 2078   np.int64([3 + x
-0000cce0: 2025 2032 2066 6f72 2078 2069 6e20 7261   % 2 for x in ra
-0000ccf0: 6e67 6528 322c 2031 3229 5d29 0a20 2020  nge(2, 12)]).   
-0000cd00: 2020 2020 2066 6f72 2069 2c20 6c61 7374       for i, last
-0000cd10: 2069 6e20 656e 756d 6572 6174 6528 7261   in enumerate(ra
-0000cd20: 6e67 6528 322c 206c 656e 2864 696d 5f73  nge(2, len(dim_s
-0000cd30: 6574 2929 293a 0a20 2020 2020 2020 2020  et))):.         
-0000cd40: 2020 2064 696d 7320 3d20 6469 6d5f 7365     dims = dim_se
-0000cd50: 745b 3a6c 6173 745d 0a20 2020 2020 2020  t[:last].       
-0000cd60: 2020 2020 2064 6174 6120 3d20 6e70 2e72       data = np.r
-0000cd70: 616e 646f 6d2e 7261 6e64 282a 6469 6d73  andom.rand(*dims
-0000cd80: 292e 6173 7479 7065 2822 696e 7433 3222  ).astype("int32"
-0000cd90: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
-0000cda0: 7468 2074 696c 6564 622e 6672 6f6d 5f6e  th tiledb.from_n
-0000cdb0: 756d 7079 2873 656c 662e 7061 7468 2866  umpy(self.path(f
-0000cdc0: 226e 645f 726f 756e 6474 7269 707b 697d  "nd_roundtrip{i}
-0000cdd0: 2229 2c20 6461 7461 2920 6173 2041 3a0a  "), data) as A:.
-0000cde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cdf0: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-0000ce00: 616c 2864 6174 612c 2041 5b3a 5d29 0a0a  al(data, A[:])..
-0000ce10: 2020 2020 6465 6620 7465 7374 5f61 7272      def test_arr
-0000ce20: 6179 5f32 645f 7333 5f6d 6978 6564 2873  ay_2d_s3_mixed(s
-0000ce30: 656c 6629 3a0a 2020 2020 2020 2020 2320  elf):.        # 
-0000ce40: 5468 6973 2061 7272 6179 2069 7320 6375  This array is cu
-0000ce50: 7272 656e 746c 7920 7265 6164 2062 6163  rrently read bac
-0000ce60: 6b20 7769 7468 2064 7479 7065 206f 626a  k with dtype obj
-0000ce70: 6563 740a 2020 2020 2020 2020 4120 3d20  ect.        A = 
-0000ce80: 6e70 2e61 7272 6179 285b 5b22 4141 4122  np.array([["AAA"
-0000ce90: 2c20 2242 225d 2c20 5b22 4142 222c 2022  , "B"], ["AB", "
-0000cea0: 4322 5d5d 2c20 6474 7970 653d 2253 3322  C"]], dtype="S3"
-0000ceb0: 290a 0a20 2020 2020 2020 2075 7269 203d  )..        uri =
-0000cec0: 2073 656c 662e 7061 7468 2829 0a20 2020   self.path().   
-0000ced0: 2020 2020 2064 6f6d 203d 2074 696c 6564       dom = tiled
-0000cee0: 622e 446f 6d61 696e 280a 2020 2020 2020  b.Domain(.      
-0000cef0: 2020 2020 2020 7469 6c65 6462 2e44 696d        tiledb.Dim
-0000cf00: 286e 616d 653d 2272 6f77 7322 2c20 646f  (name="rows", do
-0000cf10: 6d61 696e 3d28 302c 2031 292c 2074 696c  main=(0, 1), til
-0000cf20: 653d 322c 2064 7479 7065 3d6e 702e 696e  e=2, dtype=np.in
-0000cf30: 7436 3429 2c0a 2020 2020 2020 2020 2020  t64),.          
-0000cf40: 2020 7469 6c65 6462 2e44 696d 286e 616d    tiledb.Dim(nam
-0000cf50: 653d 2263 6f6c 7322 2c20 646f 6d61 696e  e="cols", domain
-0000cf60: 3d28 302c 2031 292c 2074 696c 653d 322c  =(0, 1), tile=2,
-0000cf70: 2064 7479 7065 3d6e 702e 696e 7436 3429   dtype=np.int64)
-0000cf80: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0000cf90: 2020 2020 2073 6368 656d 6120 3d20 7469       schema = ti
-0000cfa0: 6c65 6462 2e41 7272 6179 5363 6865 6d61  ledb.ArraySchema
-0000cfb0: 280a 2020 2020 2020 2020 2020 2020 646f  (.            do
-0000cfc0: 6d61 696e 3d64 6f6d 2c20 7370 6172 7365  main=dom, sparse
-0000cfd0: 3d46 616c 7365 2c20 6174 7472 733d 5b74  =False, attrs=[t
-0000cfe0: 696c 6564 622e 4174 7472 286e 616d 653d  iledb.Attr(name=
-0000cff0: 2261 222c 2064 7479 7065 3d22 5333 2229  "a", dtype="S3")
-0000d000: 5d0a 2020 2020 2020 2020 290a 0a20 2020  ].        )..   
-0000d010: 2020 2020 2074 696c 6564 622e 4465 6e73       tiledb.Dens
-0000d020: 6541 7272 6179 2e63 7265 6174 6528 7572  eArray.create(ur
-0000d030: 692c 2073 6368 656d 6129 0a0a 2020 2020  i, schema)..    
-0000d040: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
-0000d050: 4465 6e73 6541 7272 6179 2875 7269 2c20  DenseArray(uri, 
-0000d060: 6d6f 6465 3d22 7722 2920 6173 2054 3a0a  mode="w") as T:.
-0000d070: 2020 2020 2020 2020 2020 2020 545b 2e2e              T[..
-0000d080: 2e5d 203d 2041 0a0a 2020 2020 2020 2020  .] = A..        
-0000d090: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
-0000d0a0: 6541 7272 6179 2875 7269 2920 6173 2054  eArray(uri) as T
-0000d0b0: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
-0000d0c0: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
-0000d0d0: 2841 2c20 5429 0a0a 2020 2020 2020 2020  (A, T)..        
-0000d0e0: 2020 2020 7265 7320 3d20 542e 6d75 6c74      res = T.mult
-0000d0f0: 695f 696e 6465 785b 2830 2c20 3129 2c20  i_index[(0, 1), 
-0000d100: 2830 2c20 3129 5d5b 2261 225d 0a20 2020  (0, 1)]["a"].   
-0000d110: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-0000d120: 6172 7261 795f 6571 7561 6c28 412c 2072  array_equal(A, r
-0000d130: 6573 290a 0a20 2020 2064 6566 2074 6573  es)..    def tes
-0000d140: 745f 696e 636f 6d70 6c65 7465 5f64 656e  t_incomplete_den
-0000d150: 7365 2873 656c 6629 3a0a 2020 2020 2020  se(self):.      
-0000d160: 2020 7061 7468 203d 2073 656c 662e 7061    path = self.pa
-0000d170: 7468 2822 696e 636f 6d70 6c65 7465 5f64  th("incomplete_d
-0000d180: 656e 7365 2229 0a20 2020 2020 2020 2023  ense").        #
-0000d190: 2063 7265 6174 6520 3130 204d 4220 6172   create 10 MB ar
-0000d1a0: 7261 790a 2020 2020 2020 2020 6461 7461  ray.        data
-0000d1b0: 203d 206e 702e 6172 616e 6765 2831 3331   = np.arange(131
-0000d1c0: 3037 3230 2c20 6474 7970 653d 6e70 2e69  0720, dtype=np.i
-0000d1d0: 6e74 3634 290a 2020 2020 2020 2020 2320  nt64).        # 
-0000d1e0: 6966 2060 7469 6c65 6020 6973 206e 6f74  if `tile` is not
-0000d1f0: 2073 6574 2c20 6974 2064 6566 6175 6c74   set, it default
-0000d200: 7320 746f 2074 6865 2066 756c 6c20 6172  s to the full ar
-0000d210: 7261 7920 616e 6420 7765 0a20 2020 2020  ray and we.     
-0000d220: 2020 2023 206f 6e6c 7920 7265 6164 2038     # only read 8
-0000d230: 2062 7974 6573 2061 7420 6120 7469 6d65   bytes at a time
-0000d240: 2e0a 2020 2020 2020 2020 7573 655f 7469  ..        use_ti
-0000d250: 6c65 203d 2031 3331 3037 320a 2020 2020  le = 131072.    
-0000d260: 2020 2020 2320 7573 655f 7469 6c65 203d      # use_tile =
-0000d270: 204e 6f6e 650a 2020 2020 2020 2020 7769   None.        wi
-0000d280: 7468 2074 696c 6564 622e 6672 6f6d 5f6e  th tiledb.from_n
-0000d290: 756d 7079 2870 6174 682c 2064 6174 612c  umpy(path, data,
-0000d2a0: 2074 696c 653d 7573 655f 7469 6c65 2920   tile=use_tile) 
-0000d2b0: 6173 2041 3a0a 2020 2020 2020 2020 2020  as A:.          
-0000d2c0: 2020 7061 7373 0a0a 2020 2020 2020 2020    pass..        
-0000d2d0: 2320 6372 6561 7465 2063 6f6e 7465 7874  # create context
-0000d2e0: 2077 6974 6820 3120 4d42 206d 656d 6f72   with 1 MB memor
-0000d2f0: 7920 6275 6467 6574 2028 3220 4d42 2074  y budget (2 MB t
-0000d300: 6f74 616c 2c20 3120 4d42 2075 7361 626c  otal, 1 MB usabl
-0000d310: 6529 0a20 2020 2020 2020 2063 6f6e 6669  e).        confi
-0000d320: 6720 3d20 7469 6c65 6462 2e43 6f6e 6669  g = tiledb.Confi
-0000d330: 6728 0a20 2020 2020 2020 2020 2020 207b  g(.            {
-0000d340: 2273 6d2e 6d65 6d6f 7279 5f62 7564 6765  "sm.memory_budge
-0000d350: 7422 3a20 3220 2a20 3130 3234 202a 2a20  t": 2 * 1024 ** 
-0000d360: 322c 2022 7079 2e69 6e69 745f 6275 6666  2, "py.init_buff
-0000d370: 6572 5f62 7974 6573 223a 2031 3032 3420  er_bytes": 1024 
-0000d380: 2a2a 2032 7d0a 2020 2020 2020 2020 290a  ** 2}.        ).
-0000d390: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0000d3a0: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
-0000d3b0: 2270 792e 696e 6974 5f62 7566 6665 725f  "py.init_buffer_
-0000d3c0: 6279 7465 7322 5d2c 2073 7472 2831 3032  bytes"], str(102
-0000d3d0: 3420 2a2a 2032 2929 0a20 2020 2020 2020  4 ** 2)).       
-0000d3e0: 2023 2054 4f44 4f20 776f 756c 6420 6265   # TODO would be
-0000d3f0: 2067 6f6f 6420 746f 2063 6865 636b 2072   good to check r
-0000d400: 6570 6561 7420 636f 756e 7420 6865 7265  epeat count here
-0000d410: 2e20 4e6f 7420 6375 7272 656e 746c 7920  . Not currently 
-0000d420: 6578 706f 7365 6420 6279 2072 6574 7279  exposed by retry
-0000d430: 206c 6f6f 702e 0a20 2020 2020 2020 2077   loop..        w
-0000d440: 6974 6820 7469 6c65 6462 2e44 656e 7365  ith tiledb.Dense
-0000d450: 4172 7261 7928 7061 7468 2c20 6374 783d  Array(path, ctx=
-0000d460: 7469 6c65 6462 2e43 7478 2863 6f6e 6669  tiledb.Ctx(confi
-0000d470: 6729 2920 6173 2041 3a0a 2020 2020 2020  g)) as A:.      
-0000d480: 2020 2020 2020 7265 735f 6d72 203d 2041        res_mr = A
-0000d490: 2e6d 756c 7469 5f69 6e64 6578 5b73 6c69  .multi_index[sli
-0000d4a0: 6365 2830 2c20 6c65 6e28 6461 7461 2920  ce(0, len(data) 
-0000d4b0: 2d20 3129 5d0a 2020 2020 2020 2020 2020  - 1)].          
-0000d4c0: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-0000d4d0: 7175 616c 2872 6573 5f6d 725b 2222 5d2c  qual(res_mr[""],
-0000d4e0: 2064 6174 6129 0a20 2020 2020 2020 2020   data).         
-0000d4f0: 2020 2072 6573 5f69 6478 203d 2041 5b3a     res_idx = A[:
-0000d500: 5d0a 2020 2020 2020 2020 2020 2020 6173  ].            as
-0000d510: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
-0000d520: 2872 6573 5f69 6478 2c20 6461 7461 290a  (res_idx, data).
-0000d530: 0a20 2020 2020 2020 2020 2020 2064 6620  .            df 
-0000d540: 3d20 412e 6466 5b3a 5d0a 2020 2020 2020  = A.df[:].      
-0000d550: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
-0000d560: 6179 5f65 7175 616c 2864 665b 2222 5d2c  ay_equal(df[""],
-0000d570: 2064 6174 6129 0a0a 2020 2020 6465 6620   data)..    def 
-0000d580: 7465 7374 5f77 7269 7474 656e 5f66 7261  test_written_fra
-0000d590: 676d 656e 745f 696e 666f 2873 656c 6629  gment_info(self)
-0000d5a0: 3a0a 2020 2020 2020 2020 7572 6920 3d20  :.        uri = 
-0000d5b0: 7365 6c66 2e70 6174 6828 2274 6573 745f  self.path("test_
-0000d5c0: 7772 6974 7465 6e5f 6672 6167 6d65 6e74  written_fragment
-0000d5d0: 5f69 6e66 6f22 290a 0a20 2020 2020 2020  _info")..       
-0000d5e0: 2064 6f6d 203d 2074 696c 6564 622e 446f   dom = tiledb.Do
-0000d5f0: 6d61 696e 2874 696c 6564 622e 4469 6d28  main(tiledb.Dim(
-0000d600: 646f 6d61 696e 3d28 302c 2039 292c 2074  domain=(0, 9), t
-0000d610: 696c 653d 3130 2c20 6474 7970 653d 6e70  ile=10, dtype=np
-0000d620: 2e69 6e74 3634 2929 0a20 2020 2020 2020  .int64)).       
-0000d630: 2061 7474 203d 2074 696c 6564 622e 4174   att = tiledb.At
-0000d640: 7472 2864 7479 7065 3d6e 702e 696e 7436  tr(dtype=np.int6
-0000d650: 3429 0a20 2020 2020 2020 2073 6368 656d  4).        schem
-0000d660: 6120 3d20 7469 6c65 6462 2e41 7272 6179  a = tiledb.Array
-0000d670: 5363 6865 6d61 2864 6f6d 6169 6e3d 646f  Schema(domain=do
-0000d680: 6d2c 2061 7474 7273 3d28 6174 742c 2929  m, attrs=(att,))
-0000d690: 0a20 2020 2020 2020 2074 696c 6564 622e  .        tiledb.
-0000d6a0: 4465 6e73 6541 7272 6179 2e63 7265 6174  DenseArray.creat
-0000d6b0: 6528 7572 692c 2073 6368 656d 6129 0a0a  e(uri, schema)..
-0000d6c0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
-0000d6d0: 6564 622e 4465 6e73 6541 7272 6179 2875  edb.DenseArray(u
-0000d6e0: 7269 2c20 6d6f 6465 3d22 7722 2920 6173  ri, mode="w") as
-0000d6f0: 2054 3a0a 2020 2020 2020 2020 2020 2020   T:.            
-0000d700: 545b 3a5d 203d 206e 702e 6172 616e 6765  T[:] = np.arange
-0000d710: 2830 2c20 3130 2c20 6474 7970 653d 6e70  (0, 10, dtype=np
-0000d720: 2e69 6e74 3634 290a 0a20 2020 2020 2020  .int64)..       
-0000d730: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0000d740: 5472 7565 2854 2e6c 6173 745f 7772 6974  True(T.last_writ
-0000d750: 655f 696e 666f 2069 7320 6e6f 7420 4e6f  e_info is not No
-0000d760: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
-0000d770: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
-0000d780: 6c65 6e28 542e 6c61 7374 5f77 7269 7465  len(T.last_write
-0000d790: 5f69 6e66 6f2e 6b65 7973 2829 2920 3d3d  _info.keys()) ==
-0000d7a0: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
-0000d7b0: 745f 7731 2c20 745f 7732 203d 206c 6973  t_w1, t_w2 = lis
-0000d7c0: 7428 542e 6c61 7374 5f77 7269 7465 5f69  t(T.last_write_i
-0000d7d0: 6e66 6f2e 7661 6c75 6573 2829 295b 305d  nfo.values())[0]
-0000d7e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000d7f0: 662e 6173 7365 7274 5472 7565 2874 5f77  f.assertTrue(t_w
-0000d800: 3120 3e20 3029 0a20 2020 2020 2020 2020  1 > 0).         
-0000d810: 2020 2073 656c 662e 6173 7365 7274 5472     self.assertTr
-0000d820: 7565 2874 5f77 3220 3e20 3029 0a0a 2020  ue(t_w2 > 0)..  
-0000d830: 2020 6465 6620 7465 7374 5f6d 6973 7369    def test_missi
-0000d840: 6e67 5f73 6368 656d 615f 6572 726f 7228  ng_schema_error(
-0000d850: 7365 6c66 293a 0a20 2020 2020 2020 2075  self):.        u
-0000d860: 7269 203d 2073 656c 662e 7061 7468 2822  ri = self.path("
-0000d870: 7465 7374 5f6d 6973 7369 6e67 5f73 6368  test_missing_sch
-0000d880: 656d 615f 6572 726f 7222 290a 0a20 2020  ema_error")..   
-0000d890: 2020 2020 2064 6f6d 203d 2074 696c 6564       dom = tiled
-0000d8a0: 622e 446f 6d61 696e 2874 696c 6564 622e  b.Domain(tiledb.
-0000d8b0: 4469 6d28 646f 6d61 696e 3d28 302c 2039  Dim(domain=(0, 9
-0000d8c0: 292c 2074 696c 653d 3130 2c20 6474 7970  ), tile=10, dtyp
-0000d8d0: 653d 6e70 2e69 6e74 3634 2929 0a20 2020  e=np.int64)).   
-0000d8e0: 2020 2020 2061 7474 203d 2074 696c 6564       att = tiled
-0000d8f0: 622e 4174 7472 2864 7479 7065 3d6e 702e  b.Attr(dtype=np.
-0000d900: 696e 7436 3429 0a20 2020 2020 2020 2073  int64).        s
-0000d910: 6368 656d 6120 3d20 7469 6c65 6462 2e41  chema = tiledb.A
-0000d920: 7272 6179 5363 6865 6d61 2864 6f6d 6169  rraySchema(domai
-0000d930: 6e3d 646f 6d2c 2061 7474 7273 3d28 6174  n=dom, attrs=(at
-0000d940: 742c 2929 0a20 2020 2020 2020 2074 696c  t,)).        til
-0000d950: 6564 622e 4465 6e73 6541 7272 6179 2e63  edb.DenseArray.c
-0000d960: 7265 6174 6528 7572 692c 2073 6368 656d  reate(uri, schem
-0000d970: 6129 0a0a 2020 2020 2020 2020 7769 7468  a)..        with
-0000d980: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
-0000d990: 6179 2875 7269 2c20 6d6f 6465 3d22 7722  ay(uri, mode="w"
-0000d9a0: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
-0000d9b0: 2020 2020 545b 3a5d 203d 206e 702e 6172      T[:] = np.ar
-0000d9c0: 616e 6765 2830 2c20 3130 2c20 6474 7970  ange(0, 10, dtyp
-0000d9d0: 653d 6e70 2e69 6e74 3634 290a 0a20 2020  e=np.int64)..   
-0000d9e0: 2020 2020 2069 6620 7469 6c65 6462 2e6c       if tiledb.l
-0000d9f0: 6962 7469 6c65 6462 2e76 6572 7369 6f6e  ibtiledb.version
-0000da00: 2829 203c 2028 322c 2034 293a 0a20 2020  () < (2, 4):.   
-0000da10: 2020 2020 2020 2020 2074 696c 6564 622e           tiledb.
-0000da20: 5646 5328 292e 7265 6d6f 7665 5f66 696c  VFS().remove_fil
-0000da30: 6528 6f73 2e70 6174 682e 6a6f 696e 2875  e(os.path.join(u
-0000da40: 7269 2c20 225f 5f61 7272 6179 5f73 6368  ri, "__array_sch
-0000da50: 656d 612e 7464 6222 2929 0a20 2020 2020  ema.tdb")).     
-0000da60: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000da70: 2020 2020 2074 696c 6564 622e 5646 5328       tiledb.VFS(
-0000da80: 292e 7265 6d6f 7665 5f64 6972 286f 732e  ).remove_dir(os.
-0000da90: 7061 7468 2e6a 6f69 6e28 7572 692c 2022  path.join(uri, "
-0000daa0: 5f5f 7363 6865 6d61 2229 290a 0a20 2020  __schema"))..   
-0000dab0: 2020 2020 2023 206e 6577 2063 7478 2069       # new ctx i
-0000dac0: 7320 7265 7175 6972 6564 2072 756e 6e69  s required runni
-0000dad0: 6e67 2061 6761 696e 7374 2053 3320 6265  ng against S3 be
-0000dae0: 6361 7573 6520 6f74 6865 7277 6973 6520  cause otherwise 
-0000daf0: 7468 6520 7363 6865 6d61 0a20 2020 2020  the schema.     
-0000db00: 2020 2023 2077 696c 6c20 7369 6d70 6c79     # will simply
-0000db10: 2062 6520 7265 6164 2066 726f 6d20 7468   be read from th
-0000db20: 6520 6361 6368 652e 0a20 2020 2020 2020  e cache..       
-0000db30: 2077 6974 6820 7469 6c65 6462 2e73 636f   with tiledb.sco
-0000db40: 7065 5f63 7478 2829 3a0a 2020 2020 2020  pe_ctx():.      
-0000db50: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-0000db60: 6173 7365 7274 5261 6973 6573 2874 696c  assertRaises(til
-0000db70: 6564 622e 5469 6c65 4442 4572 726f 7229  edb.TileDBError)
-0000db80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000db90: 2020 7469 6c65 6462 2e44 656e 7365 4172    tiledb.DenseAr
-0000dba0: 7261 7928 7572 6929 0a0a 2020 2020 6465  ray(uri)..    de
-0000dbb0: 6620 7465 7374 5f73 7061 7273 655f 7772  f test_sparse_wr
-0000dbc0: 6974 655f 746f 5f64 656e 7365 2873 656c  ite_to_dense(sel
-0000dbd0: 6629 3a0a 2020 2020 2020 2020 636c 6173  f):.        clas
-0000dbe0: 7320 4173 7369 676e 416e 6443 6865 636b  s AssignAndCheck
-0000dbf0: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-0000dc00: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0000dc10: 206f 7574 6572 2c20 2a73 6861 7065 293a   outer, *shape):
-0000dc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dc30: 2073 656c 662e 6f75 7465 7220 3d20 6f75   self.outer = ou
-0000dc40: 7465 720a 2020 2020 2020 2020 2020 2020  ter.            
-0000dc50: 2020 2020 7365 6c66 2e73 6861 7065 203d      self.shape =
-0000dc60: 2073 6861 7065 0a0a 2020 2020 2020 2020   shape..        
-0000dc70: 2020 2020 6465 6620 5f5f 7365 7469 7465      def __setite
-0000dc80: 6d5f 5f28 7365 6c66 2c20 732c 2076 293a  m__(self, s, v):
-0000dc90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dca0: 2041 203d 206e 702e 7261 6e64 6f6d 2e72   A = np.random.r
-0000dcb0: 616e 6428 2a73 656c 662e 7368 6170 6529  and(*self.shape)
-0000dcc0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000dcd0: 2020 7572 6920 3d20 7365 6c66 2e6f 7574    uri = self.out
-0000dce0: 6572 2e70 6174 6828 0a20 2020 2020 2020  er.path(.       
-0000dcf0: 2020 2020 2020 2020 2020 2020 2066 2273               f"s
-0000dd00: 7061 7273 655f 7772 6974 655f 746f 5f64  parse_write_to_d
-0000dd10: 656e 7365 7b72 616e 646f 6d2e 7261 6e64  ense{random.rand
-0000dd20: 696e 7428 302c 6e70 2e75 696e 7436 3428  int(0,np.uint64(
-0000dd30: 2d31 2929 7d22 0a20 2020 2020 2020 2020  -1))}".         
-0000dd40: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000dd50: 2020 2020 2020 2020 2020 7469 6c65 6462            tiledb
-0000dd60: 2e66 726f 6d5f 6e75 6d70 7928 7572 692c  .from_numpy(uri,
-0000dd70: 2041 292e 636c 6f73 6528 290a 2020 2020   A).close().    
-0000dd80: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0000dd90: 2074 696c 6564 622e 6f70 656e 2875 7269   tiledb.open(uri
-0000dda0: 2c20 2277 2229 2061 7320 423a 0a20 2020  , "w") as B:.   
-0000ddb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ddc0: 2042 5b73 5d20 3d20 760a 0a20 2020 2020   B[s] = v..     
-0000ddd0: 2020 2020 2020 2020 2020 2041 5b73 5d20             A[s] 
-0000dde0: 3d20 760a 2020 2020 2020 2020 2020 2020  = v.            
-0000ddf0: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
-0000de00: 6f70 656e 2875 7269 2920 6173 2042 3a0a  open(uri) as B:.
-0000de10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000de20: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
-0000de30: 5f65 7175 616c 2841 2c20 425b 3a5d 290a  _equal(A, B[:]).
-0000de40: 0a20 2020 2020 2020 2044 203d 2041 7373  .        D = Ass
-0000de50: 6967 6e41 6e64 4368 6563 6b28 7365 6c66  ignAndCheck(self
-0000de60: 2c20 352c 2035 290a 2020 2020 2020 2020  , 5, 5).        
-0000de70: 445b 6e70 2e61 7272 6179 285b 312c 2032  D[np.array([1, 2
-0000de80: 5d29 2c20 6e70 2e61 7272 6179 285b 302c  ]), np.array([0,
-0000de90: 2030 5d29 5d20 3d20 6e70 2e61 7272 6179   0])] = np.array
-0000dea0: 285b 302c 2032 5d29 0a0a 2020 2020 2020  ([0, 2])..      
-0000deb0: 2020 6431 203d 206e 702e 6172 7261 7928    d1 = np.array(
-0000dec0: 5b33 2c20 312c 2032 2c20 332c 2034 5d29  [3, 1, 2, 3, 4])
-0000ded0: 0a20 2020 2020 2020 2064 3220 3d20 6e70  .        d2 = np
-0000dee0: 2e61 7272 6179 285b 302c 2031 2c20 312c  .array([0, 1, 1,
-0000def0: 2032 2c20 345d 290a 2020 2020 2020 2020   2, 4]).        
-0000df00: 6461 7461 203d 206e 702e 6172 7261 7928  data = np.array(
-0000df10: 5b39 392c 2031 302c 2032 302c 2033 302c  [99, 10, 20, 30,
-0000df20: 2034 305d 290a 2020 2020 2020 2020 445b   40]).        D[
-0000df30: 6431 2c20 6432 5d20 3d20 6461 7461 0a0a  d1, d2] = data..
-0000df40: 2020 2020 2020 2020 2320 544f 444f 2066          # TODO f
-0000df50: 6978 2062 726f 6164 6361 7374 2061 7373  ix broadcast ass
-0000df60: 6967 6e6d 656e 742c 2065 7870 616e 6420  ignment, expand 
-0000df70: 636f 7665 7261 6765 0a20 2020 2020 2020  coverage.       
-0000df80: 2023 2044 5b31 2c20 6432 5d20 3d20 6461   # D[1, d2] = da
-0000df90: 7461 0a20 2020 2020 2020 2023 2044 5b64  ta.        # D[d
-0000dfa0: 312c 2031 5d0a 0a20 2020 2064 6566 2074  1, 1]..    def t
-0000dfb0: 6573 745f 7265 6f70 656e 5f64 656e 7365  est_reopen_dense
-0000dfc0: 5f61 7272 6179 2873 656c 6629 3a0a 2020  _array(self):.  
-0000dfd0: 2020 2020 2020 7572 6920 3d20 7365 6c66        uri = self
-0000dfe0: 2e70 6174 6828 2274 6573 745f 7265 6f70  .path("test_reop
-0000dff0: 656e 5f64 656e 7365 5f61 7272 6179 2229  en_dense_array")
-0000e000: 0a0a 2020 2020 2020 2020 646f 6d20 3d20  ..        dom = 
-0000e010: 7469 6c65 6462 2e44 6f6d 6169 6e28 7469  tiledb.Domain(ti
-0000e020: 6c65 6462 2e44 696d 2864 6f6d 6169 6e3d  ledb.Dim(domain=
-0000e030: 2830 2c20 3929 2c20 7469 6c65 3d31 302c  (0, 9), tile=10,
-0000e040: 2064 7479 7065 3d6e 702e 696e 7436 3429   dtype=np.int64)
-0000e050: 290a 2020 2020 2020 2020 6174 7420 3d20  ).        att = 
-0000e060: 7469 6c65 6462 2e41 7474 7228 6474 7970  tiledb.Attr(dtyp
-0000e070: 653d 6e70 2e69 6e74 3634 290a 2020 2020  e=np.int64).    
-0000e080: 2020 2020 7363 6865 6d61 203d 2074 696c      schema = til
-0000e090: 6564 622e 4172 7261 7953 6368 656d 6128  edb.ArraySchema(
-0000e0a0: 646f 6d61 696e 3d64 6f6d 2c20 6174 7472  domain=dom, attr
-0000e0b0: 733d 2861 7474 2c29 290a 2020 2020 2020  s=(att,)).      
-0000e0c0: 2020 7469 6c65 6462 2e44 656e 7365 4172    tiledb.DenseAr
-0000e0d0: 7261 792e 6372 6561 7465 2875 7269 2c20  ray.create(uri, 
-0000e0e0: 7363 6865 6d61 290a 0a20 2020 2020 2020  schema)..       
-0000e0f0: 2064 6174 6120 3d20 6e70 2e61 7261 6e67   data = np.arang
-0000e100: 6528 302c 2031 302c 2064 7479 7065 3d6e  e(0, 10, dtype=n
-0000e110: 702e 696e 7436 3429 0a0a 2020 2020 2020  p.int64)..      
-0000e120: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
-0000e130: 6e73 6541 7272 6179 2875 7269 2c20 6d6f  nseArray(uri, mo
-0000e140: 6465 3d22 7722 2c20 7469 6d65 7374 616d  de="w", timestam
-0000e150: 703d 3129 2061 7320 543a 0a20 2020 2020  p=1) as T:.     
-0000e160: 2020 2020 2020 2054 5b3a 5d20 3d20 6461         T[:] = da
-0000e170: 7461 0a0a 2020 2020 2020 2020 7769 7468  ta..        with
-0000e180: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
-0000e190: 6179 2875 7269 2c20 6d6f 6465 3d22 7722  ay(uri, mode="w"
-0000e1a0: 2c20 7469 6d65 7374 616d 703d 3229 2061  , timestamp=2) a
-0000e1b0: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
-0000e1c0: 2054 5b3a 5d20 3d20 6461 7461 202a 2032   T[:] = data * 2
-0000e1d0: 0a0a 2020 2020 2020 2020 5420 3d20 7469  ..        T = ti
-0000e1e0: 6c65 6462 2e44 656e 7365 4172 7261 7928  ledb.DenseArray(
-0000e1f0: 7572 692c 206d 6f64 653d 2272 222c 2074  uri, mode="r", t
-0000e200: 696d 6573 7461 6d70 3d31 290a 2020 2020  imestamp=1).    
-0000e210: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
-0000e220: 5f65 7175 616c 2854 5b3a 5d2c 2064 6174  _equal(T[:], dat
-0000e230: 6129 0a0a 2020 2020 2020 2020 542e 7265  a)..        T.re
-0000e240: 6f70 656e 2829 0a20 2020 2020 2020 2061  open().        a
-0000e250: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
-0000e260: 6c28 545b 3a5d 2c20 6461 7461 202a 2032  l(T[:], data * 2
-0000e270: 290a 0a20 2020 2020 2020 2054 2e63 6c6f  )..        T.clo
-0000e280: 7365 2829 0a0a 0a63 6c61 7373 2054 6573  se()...class Tes
-0000e290: 7456 6172 6c65 6e28 4469 736b 5465 7374  tVarlen(DiskTest
-0000e2a0: 4361 7365 293a 0a20 2020 2064 6566 2074  Case):.    def t
-0000e2b0: 6573 745f 7661 726c 656e 5f77 7269 7465  est_varlen_write
-0000e2c0: 5f62 7974 6573 2873 656c 6629 3a0a 2020  _bytes(self):.  
-0000e2d0: 2020 2020 2020 4120 3d20 6e70 2e61 7272        A = np.arr
-0000e2e0: 6179 280a 2020 2020 2020 2020 2020 2020  ay(.            
-0000e2f0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-0000e300: 2020 2261 6122 2c0a 2020 2020 2020 2020    "aa",.        
-0000e310: 2020 2020 2020 2020 2262 6262 222c 0a20          "bbb",. 
-0000e320: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000e330: 6363 6363 6322 2c0a 2020 2020 2020 2020  ccccc",.        
-0000e340: 2020 2020 2020 2020 2264 6464 6464 6464          "ddddddd
-0000e350: 6464 6464 6464 6464 6464 6464 6464 222c  dddddddddddddd",
-0000e360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e370: 2022 6565 222c 0a20 2020 2020 2020 2020   "ee",.         
-0000e380: 2020 2020 2020 2022 6666 6666 6666 222c         "ffffff",
+00009f20: 2841 5b3a 3130 2c20 3a2c 202e 2e2e 5d2c  (A[:10, :, ...],
+00009f30: 2054 5b3a 3130 2c20 3a2c 202e 2e2e 5d29   T[:10, :, ...])
+00009f40: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00009f50: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+00009f60: 415b 3130 3a32 302c 203a 2c20 2e2e 2e5d  A[10:20, :, ...]
+00009f70: 2c20 545b 3130 3a32 302c 203a 2c20 2e2e  , T[10:20, :, ..
+00009f80: 2e5d 290a 2020 2020 2020 2020 2020 2020  .]).            
+00009f90: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
+00009fa0: 616c 2841 5b2d 3130 3a2c 203a 2c20 2e2e  al(A[-10:, :, ..
+00009fb0: 2e5d 2c20 545b 2d31 303a 2c20 3a2c 202e  .], T[-10:, :, .
+00009fc0: 2e2e 5d29 0a0a 2020 2020 2020 2020 2020  ..])..          
+00009fd0: 2020 2320 736c 6963 6520 7365 636f 6e64    # slice second
+00009fe0: 2064 696d 656e 7369 6f6e 0a20 2020 2020   dimension.     
+00009ff0: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+0000a000: 7261 795f 6571 7561 6c28 415b 3a2c 203a  ray_equal(A[:, :
+0000a010: 325d 2c20 545b 3a2c 203a 325d 290a 2020  2], T[:, :2]).  
+0000a020: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0000a030: 5f61 7272 6179 5f65 7175 616c 2841 5b3a  _array_equal(A[:
+0000a040: 2c20 323a 345d 2c20 545b 3a2c 2032 3a34  , 2:4], T[:, 2:4
+0000a050: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+0000a060: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+0000a070: 6c28 415b 3a2c 202d 323a 5d2c 2054 5b3a  l(A[:, -2:], T[:
+0000a080: 2c20 2d32 3a5d 290a 2020 2020 2020 2020  , -2:]).        
+0000a090: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
+0000a0a0: 5f65 7175 616c 2841 5b2e 2e2e 2c20 3a32  _equal(A[..., :2
+0000a0b0: 5d2c 2054 5b2e 2e2e 2c20 3a32 5d29 0a20  ], T[..., :2]). 
+0000a0c0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+0000a0d0: 745f 6172 7261 795f 6571 7561 6c28 415b  t_array_equal(A[
+0000a0e0: 2e2e 2e2c 2032 3a34 5d2c 2054 5b2e 2e2e  ..., 2:4], T[...
+0000a0f0: 2c20 323a 345d 290a 2020 2020 2020 2020  , 2:4]).        
+0000a100: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
+0000a110: 5f65 7175 616c 2841 5b2e 2e2e 2c20 2d32  _equal(A[..., -2
+0000a120: 3a5d 2c20 545b 2e2e 2e2c 202d 323a 5d29  :], T[..., -2:])
+0000a130: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+0000a140: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+0000a150: 415b 3a2c 202e 2e2e 2c20 3a32 5d2c 2054  A[:, ..., :2], T
+0000a160: 5b3a 2c20 2e2e 2e2c 203a 325d 290a 2020  [:, ..., :2]).  
+0000a170: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0000a180: 5f61 7272 6179 5f65 7175 616c 2841 5b3a  _array_equal(A[:
+0000a190: 2c20 2e2e 2e2c 2032 3a34 5d2c 2054 5b3a  , ..., 2:4], T[:
+0000a1a0: 2c20 2e2e 2e2c 2032 3a34 5d29 0a20 2020  , ..., 2:4]).   
+0000a1b0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+0000a1c0: 6172 7261 795f 6571 7561 6c28 415b 3a2c  array_equal(A[:,
+0000a1d0: 202e 2e2e 2c20 2d32 3a5d 2c20 545b 3a2c   ..., -2:], T[:,
+0000a1e0: 202e 2e2e 2c20 2d32 3a5d 290a 0a20 2020   ..., -2:])..   
+0000a1f0: 2020 2020 2020 2020 2023 2073 6c69 6365           # slice
+0000a200: 2062 6f74 6820 6469 6d65 6e73 696f 6e73   both dimensions
+0000a210: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+0000a220: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+0000a230: 415b 3a31 302c 203a 325d 2c20 545b 3a31  A[:10, :2], T[:1
+0000a240: 302c 203a 325d 290a 2020 2020 2020 2020  0, :2]).        
+0000a250: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
+0000a260: 5f65 7175 616c 2841 5b31 303a 3230 2c20  _equal(A[10:20, 
+0000a270: 323a 345d 2c20 545b 3130 3a32 302c 2032  2:4], T[10:20, 2
+0000a280: 3a34 5d29 0a20 2020 2020 2020 2020 2020  :4]).           
+0000a290: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+0000a2a0: 7561 6c28 415b 2d31 303a 2c20 2d32 3a5d  ual(A[-10:, -2:]
+0000a2b0: 2c20 545b 2d31 303a 2c20 2d32 3a5d 290a  , T[-10:, -2:]).
+0000a2c0: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
+0000a2d0: 6c69 6365 2061 6372 6f73 7320 7469 6c65  lice across tile
+0000a2e0: 2062 6f75 6e64 7269 6573 0a20 2020 2020   boundries.     
+0000a2f0: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+0000a300: 7261 795f 6571 7561 6c28 415b 3a31 3130  ray_equal(A[:110
+0000a310: 5d2c 2054 5b3a 3131 305d 290a 2020 2020  ], T[:110]).    
+0000a320: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+0000a330: 7272 6179 5f65 7175 616c 2841 5b31 3930  rray_equal(A[190
+0000a340: 3a33 3130 5d2c 2054 5b31 3930 3a33 3130  :310], T[190:310
+0000a350: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+0000a360: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+0000a370: 6c28 415b 2d31 3130 3a5d 2c20 545b 2d31  l(A[-110:], T[-1
+0000a380: 3130 3a5d 290a 2020 2020 2020 2020 2020  10:]).          
+0000a390: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
+0000a3a0: 7175 616c 2841 5b3a 3131 302c 203a 5d2c  qual(A[:110, :],
+0000a3b0: 2054 5b3a 3131 302c 203a 5d29 0a20 2020   T[:110, :]).   
+0000a3c0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+0000a3d0: 6172 7261 795f 6571 7561 6c28 415b 3139  array_equal(A[19
+0000a3e0: 303a 3331 302c 203a 5d2c 2054 5b31 3930  0:310, :], T[190
+0000a3f0: 3a33 3130 2c20 3a5d 290a 2020 2020 2020  :310, :]).      
+0000a400: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
+0000a410: 6179 5f65 7175 616c 2841 5b2d 3131 303a  ay_equal(A[-110:
+0000a420: 2c20 3a5d 2c20 545b 2d31 3130 3a2c 203a  , :], T[-110:, :
+0000a430: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+0000a440: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+0000a450: 6c28 415b 3a2c 203a 335d 2c20 545b 3a2c  l(A[:, :3], T[:,
+0000a460: 203a 335d 290a 2020 2020 2020 2020 2020   :3]).          
+0000a470: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
+0000a480: 7175 616c 2841 5b3a 2c20 333a 375d 2c20  qual(A[:, 3:7], 
+0000a490: 545b 3a2c 2033 3a37 5d29 0a20 2020 2020  T[:, 3:7]).     
+0000a4a0: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+0000a4b0: 7261 795f 6571 7561 6c28 415b 3a2c 202d  ray_equal(A[:, -
+0000a4c0: 333a 5d2c 2054 5b3a 2c20 2d33 3a5d 290a  3:], T[:, -3:]).
+0000a4d0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+0000a4e0: 7274 5f61 7272 6179 5f65 7175 616c 2841  rt_array_equal(A
+0000a4f0: 5b3a 3131 302c 203a 335d 2c20 545b 3a31  [:110, :3], T[:1
+0000a500: 3130 2c20 3a33 5d29 0a20 2020 2020 2020  10, :3]).       
+0000a510: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
+0000a520: 795f 6571 7561 6c28 415b 3139 303a 3331  y_equal(A[190:31
+0000a530: 302c 2033 3a37 5d2c 2054 5b31 3930 3a33  0, 3:7], T[190:3
+0000a540: 3130 2c20 333a 375d 290a 2020 2020 2020  10, 3:7]).      
+0000a550: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
+0000a560: 6179 5f65 7175 616c 2841 5b2d 3131 303a  ay_equal(A[-110:
+0000a570: 2c20 2d33 3a5d 2c20 545b 2d31 3130 3a2c  , -3:], T[-110:,
+0000a580: 202d 333a 5d29 0a0a 2020 2020 2020 2020   -3:])..        
+0000a590: 2020 2020 2320 7369 6e67 6c65 2072 6f77      # single row
+0000a5a0: 2f63 6f6c 2f69 7465 6d0a 2020 2020 2020  /col/item.      
+0000a5b0: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
+0000a5c0: 6179 5f65 7175 616c 2841 5b30 5d2c 2054  ay_equal(A[0], T
+0000a5d0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+0000a5e0: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+0000a5f0: 7561 6c28 415b 2d31 5d2c 2054 5b2d 315d  ual(A[-1], T[-1]
+0000a600: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+0000a610: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
+0000a620: 2841 5b3a 2c20 305d 2c20 545b 3a2c 2030  (A[:, 0], T[:, 0
+0000a630: 5d29 0a20 2020 2020 2020 2020 2020 2061  ]).            a
+0000a640: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+0000a650: 6c28 415b 3a2c 202d 315d 2c20 545b 3a2c  l(A[:, -1], T[:,
+0000a660: 202d 315d 290a 2020 2020 2020 2020 2020   -1]).          
+0000a670: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000a680: 616c 2841 5b30 2c20 305d 2c20 545b 302c  al(A[0, 0], T[0,
+0000a690: 2030 5d29 0a20 2020 2020 2020 2020 2020   0]).           
+0000a6a0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000a6b0: 6c28 415b 2d31 2c20 2d31 5d2c 2054 5b2d  l(A[-1, -1], T[-
+0000a6c0: 312c 202d 315d 290a 0a20 2020 2020 2020  1, -1])..       
+0000a6d0: 2020 2020 2023 2074 6f6f 206d 616e 7920       # too many 
+0000a6e0: 696e 6469 6365 730a 2020 2020 2020 2020  indices.        
+0000a6f0: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
+0000a700: 7365 7274 5261 6973 6573 2849 6e64 6578  sertRaises(Index
+0000a710: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+0000a720: 2020 2020 2020 2020 545b 3a2c 203a 2c20          T[:, :, 
+0000a730: 3a5d 0a20 2020 2020 2020 2020 2020 2077  :].            w
+0000a740: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
+0000a750: 6169 7365 7328 496e 6465 7845 7272 6f72  aises(IndexError
+0000a760: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000a770: 2020 2054 5b30 2c20 3a2c 203a 5d0a 2020     T[0, :, :].  
+0000a780: 2020 2020 2020 2020 2020 7769 7468 2073            with s
+0000a790: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
+0000a7a0: 2849 6e64 6578 4572 726f 7229 3a0a 2020  (IndexError):.  
+0000a7b0: 2020 2020 2020 2020 2020 2020 2020 545b                T[
+0000a7c0: 3a2c 2030 2c20 3a5d 0a20 2020 2020 2020  :, 0, :].       
+0000a7d0: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
+0000a7e0: 7373 6572 7452 6169 7365 7328 496e 6465  ssertRaises(Inde
+0000a7f0: 7845 7272 6f72 293a 0a20 2020 2020 2020  xError):.       
+0000a800: 2020 2020 2020 2020 2054 5b3a 2c20 3a2c           T[:, :,
+0000a810: 2030 5d0a 2020 2020 2020 2020 2020 2020   0].            
+0000a820: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
+0000a830: 5261 6973 6573 2849 6e64 6578 4572 726f  Raises(IndexErro
+0000a840: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+0000a850: 2020 2020 545b 302c 2030 2c20 305d 0a0a      T[0, 0, 0]..
+0000a860: 2020 2020 2020 2020 2020 2020 2320 6f6e              # on
+0000a870: 6c79 2073 696e 676c 6520 656c 6c69 7073  ly single ellips
+0000a880: 6973 2061 6c6c 6f77 6564 0a20 2020 2020  is allowed.     
+0000a890: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+0000a8a0: 2e61 7373 6572 7452 6169 7365 7328 496e  .assertRaises(In
+0000a8b0: 6465 7845 7272 6f72 293a 0a20 2020 2020  dexError):.     
+0000a8c0: 2020 2020 2020 2020 2020 2054 5b2e 2e2e             T[...
+0000a8d0: 2c20 2e2e 2e5d 0a0a 2020 2020 2020 2020  , ...]..        
+0000a8e0: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
+0000a8f0: 6541 7272 6179 2873 656c 662e 7061 7468  eArray(self.path
+0000a900: 2822 666f 6f22 292c 206d 6f64 653d 2277  ("foo"), mode="w
+0000a910: 2229 2061 7320 543a 0a20 2020 2020 2020  ") as T:.       
+0000a920: 2020 2020 2023 2063 6865 636b 2070 6172       # check par
+0000a930: 7469 616c 2061 7373 6967 6e6d 656e 740a  tial assignment.
+0000a940: 2020 2020 2020 2020 2020 2020 4220 3d20              B = 
+0000a950: 6e70 2e61 7261 6e67 6528 3130 3030 302c  np.arange(10000,
+0000a960: 2032 3030 3030 292e 7265 7368 6170 6528   20000).reshape(
+0000a970: 2831 3030 302c 2031 3029 290a 2020 2020  (1000, 10)).    
+0000a980: 2020 2020 2020 2020 545b 3139 303a 3331          T[190:31
+0000a990: 302c 2033 3a37 5d20 3d20 425b 3139 303a  0, 3:7] = B[190:
+0000a9a0: 3331 302c 2033 3a37 5d0a 0a20 2020 2020  310, 3:7]..     
+0000a9b0: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
+0000a9c0: 656e 7365 4172 7261 7928 7365 6c66 2e70  enseArray(self.p
+0000a9d0: 6174 6828 2266 6f6f 2229 2c20 6d6f 6465  ath("foo"), mode
+0000a9e0: 3d22 7222 2920 6173 2054 3a0a 2020 2020  ="r") as T:.    
+0000a9f0: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+0000aa00: 7272 6179 5f65 7175 616c 2841 5b3a 3139  rray_equal(A[:19
+0000aa10: 305d 2c20 545b 3a31 3930 5d29 0a20 2020  0], T[:190]).   
+0000aa20: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+0000aa30: 6172 7261 795f 6571 7561 6c28 415b 3a2c  array_equal(A[:,
+0000aa40: 203a 335d 2c20 545b 3a2c 203a 335d 290a   :3], T[:, :3]).
+0000aa50: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+0000aa60: 7274 5f61 7272 6179 5f65 7175 616c 2842  rt_array_equal(B
+0000aa70: 5b31 3930 3a33 3130 2c20 333a 375d 2c20  [190:310, 3:7], 
+0000aa80: 545b 3139 303a 3331 302c 2033 3a37 5d29  T[190:310, 3:7])
+0000aa90: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+0000aaa0: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+0000aab0: 415b 3331 303a 5d2c 2054 5b33 3130 3a5d  A[310:], T[310:]
+0000aac0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+0000aad0: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
+0000aae0: 2841 5b3a 2c20 373a 5d2c 2054 5b3a 2c20  (A[:, 7:], T[:, 
+0000aaf0: 373a 5d29 0a0a 2020 2020 4070 7974 6573  7:])..    @pytes
+0000ab00: 742e 6d61 726b 2e73 6b69 7069 6628 0a20  t.mark.skipif(. 
+0000ab10: 2020 2020 2020 206e 6f74 2028 7379 732e         not (sys.
+0000ab20: 706c 6174 666f 726d 203d 3d20 2277 696e  platform == "win
+0000ab30: 3332 2220 616e 6420 7469 6c65 6462 2e6c  32" and tiledb.l
+0000ab40: 6962 7469 6c65 6462 2e76 6572 7369 6f6e  ibtiledb.version
+0000ab50: 2829 203e 3d20 2832 2c20 332c 2030 2929  () >= (2, 3, 0))
+0000ab60: 2c0a 2020 2020 2020 2020 7265 6173 6f6e  ,.        reason
+0000ab70: 3d22 5368 6172 6564 206e 6574 776f 726b  ="Shared network
+0000ab80: 2064 7269 7665 206f 6e6c 7920 6f6e 2057   drive only on W
+0000ab90: 696e 3332 222c 0a20 2020 2029 0a20 2020  in32",.    ).   
+0000aba0: 2064 6566 2074 6573 745f 6172 7261 795f   def test_array_
+0000abb0: 3164 5f73 6861 7265 645f 6472 6976 6528  1d_shared_drive(
+0000abc0: 7365 6c66 293a 0a20 2020 2020 2020 2041  self):.        A
+0000abd0: 203d 206e 702e 7a65 726f 7328 3530 290a   = np.zeros(50).
+0000abe0: 0a20 2020 2020 2020 2064 6f6d 203d 2074  .        dom = t
+0000abf0: 696c 6564 622e 446f 6d61 696e 2874 696c  iledb.Domain(til
+0000ac00: 6564 622e 4469 6d28 646f 6d61 696e 3d28  edb.Dim(domain=(
+0000ac10: 302c 2034 3929 2c20 7469 6c65 3d35 3029  0, 49), tile=50)
+0000ac20: 290a 2020 2020 2020 2020 6174 7420 3d20  ).        att = 
+0000ac30: 7469 6c65 6462 2e41 7474 7228 6474 7970  tiledb.Attr(dtyp
+0000ac40: 653d 412e 6474 7970 6529 0a20 2020 2020  e=A.dtype).     
+0000ac50: 2020 2073 6368 656d 6120 3d20 7469 6c65     schema = tile
+0000ac60: 6462 2e41 7272 6179 5363 6865 6d61 2864  db.ArraySchema(d
+0000ac70: 6f6d 2c20 2861 7474 2c29 290a 2020 2020  om, (att,)).    
+0000ac80: 2020 2020 7572 6920 3d20 7365 6c66 2e70      uri = self.p
+0000ac90: 6174 6828 2266 6f6f 222c 2073 6861 7265  ath("foo", share
+0000aca0: 643d 5472 7565 290a 0a20 2020 2020 2020  d=True)..       
+0000acb0: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
+0000acc0: 6179 2e63 7265 6174 6528 7572 692c 2073  ay.create(uri, s
+0000acd0: 6368 656d 6129 0a0a 2020 2020 2020 2020  chema)..        
+0000ace0: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
+0000acf0: 6541 7272 6179 2875 7269 2c20 6d6f 6465  eArray(uri, mode
+0000ad00: 3d22 7722 2920 6173 2054 3a0a 2020 2020  ="w") as T:.    
+0000ad10: 2020 2020 2020 2020 545b 3a5d 203d 2041          T[:] = A
+0000ad20: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
+0000ad30: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
+0000ad40: 2875 7269 2c20 6d6f 6465 3d22 7222 2920  (uri, mode="r") 
+0000ad50: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
+0000ad60: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
+0000ad70: 7175 616c 2841 2c20 545b 3a5d 290a 0a20  qual(A, T[:]).. 
+0000ad80: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
+0000ad90: 6462 2e44 656e 7365 4172 7261 7928 7572  db.DenseArray(ur
+0000ada0: 692c 206d 6f64 653d 2277 2229 2061 7320  i, mode="w") as 
+0000adb0: 543a 0a20 2020 2020 2020 2020 2020 2076  T:.            v
+0000adc0: 616c 7565 203d 202d 312c 2033 2c20 3130  alue = -1, 3, 10
+0000add0: 0a20 2020 2020 2020 2020 2020 2041 5b30  .            A[0
+0000ade0: 5d2c 2041 5b31 5d2c 2041 5b33 5d20 3d20  ], A[1], A[3] = 
+0000adf0: 7661 6c75 650a 2020 2020 2020 2020 2020  value.          
+0000ae00: 2020 545b 305d 2c20 545b 315d 2c20 545b    T[0], T[1], T[
+0000ae10: 335d 203d 2076 616c 7565 0a20 2020 2020  3] = value.     
+0000ae20: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
+0000ae30: 656e 7365 4172 7261 7928 7572 692c 206d  enseArray(uri, m
+0000ae40: 6f64 653d 2272 2229 2061 7320 543a 0a20  ode="r") as T:. 
+0000ae50: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+0000ae60: 745f 6172 7261 795f 6571 7561 6c28 412c  t_array_equal(A,
+0000ae70: 2054 5b3a 5d29 0a0a 2020 2020 2020 2020   T[:])..        
+0000ae80: 666f 7220 7661 6c75 6520 696e 2028 2d31  for value in (-1
+0000ae90: 2c20 332c 2031 3029 3a0a 2020 2020 2020  , 3, 10):.      
+0000aea0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+0000aeb0: 622e 4465 6e73 6541 7272 6179 2875 7269  b.DenseArray(uri
+0000aec0: 2c20 6d6f 6465 3d22 7722 2920 6173 2054  , mode="w") as T
+0000aed0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000aee0: 2020 415b 353a 3235 5d20 3d20 7661 6c75    A[5:25] = valu
+0000aef0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000af00: 2020 545b 353a 3235 5d20 3d20 7661 6c75    T[5:25] = valu
+0000af10: 650a 2020 2020 2020 2020 2020 2020 7769  e.            wi
+0000af20: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
+0000af30: 7272 6179 2875 7269 2c20 6d6f 6465 3d22  rray(uri, mode="
+0000af40: 7222 2920 6173 2054 3a0a 2020 2020 2020  r") as T:.      
+0000af50: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0000af60: 5f61 7272 6179 5f65 7175 616c 2841 2c20  _array_equal(A, 
+0000af70: 545b 3a5d 290a 2020 2020 2020 2020 2020  T[:]).          
+0000af80: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
+0000af90: 6e73 6541 7272 6179 2875 7269 2c20 6d6f  nseArray(uri, mo
+0000afa0: 6465 3d22 7722 2920 6173 2054 3a0a 2020  de="w") as T:.  
+0000afb0: 2020 2020 2020 2020 2020 2020 2020 415b                A[
+0000afc0: 3a5d 203d 2076 616c 7565 0a20 2020 2020  :] = value.     
+0000afd0: 2020 2020 2020 2020 2020 2054 5b3a 5d20             T[:] 
+0000afe0: 3d20 7661 6c75 650a 2020 2020 2020 2020  = value.        
+0000aff0: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+0000b000: 4465 6e73 6541 7272 6179 2875 7269 2c20  DenseArray(uri, 
+0000b010: 6d6f 6465 3d22 7222 2920 6173 2054 3a0a  mode="r") as T:.
+0000b020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b030: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
+0000b040: 616c 2841 2c20 545b 3a5d 290a 0a20 2020  al(A, T[:])..   
+0000b050: 2064 6566 2074 6573 745f 6669 7865 645f   def test_fixed_
+0000b060: 7374 7269 6e67 2873 656c 6629 3a0a 2020  string(self):.  
+0000b070: 2020 2020 2020 6120 3d20 6e70 2e61 7272        a = np.arr
+0000b080: 6179 285b 2261 6222 2c20 2263 6422 2c20  ay(["ab", "cd", 
+0000b090: 2265 6622 2c20 2267 6822 2c20 2269 6a22  "ef", "gh", "ij"
+0000b0a0: 2c20 226b 6c22 2c20 2222 2c20 226f 7022  , "kl", "", "op"
+0000b0b0: 5d2c 2064 7479 7065 3d22 7c53 3222 290a  ], dtype="|S2").
+0000b0c0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
+0000b0d0: 6564 622e 6672 6f6d 5f6e 756d 7079 2873  edb.from_numpy(s
+0000b0e0: 656c 662e 7061 7468 2822 6669 7865 645f  elf.path("fixed_
+0000b0f0: 7374 7269 6e67 2229 2c20 6129 2061 7320  string"), a) as 
+0000b100: 543a 0a20 2020 2020 2020 2020 2020 2077  T:.            w
+0000b110: 6974 6820 7469 6c65 6462 2e6f 7065 6e28  ith tiledb.open(
+0000b120: 7365 6c66 2e70 6174 6828 2266 6978 6564  self.path("fixed
+0000b130: 5f73 7472 696e 6722 2929 2061 7320 523a  _string")) as R:
+0000b140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b150: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0000b160: 6c28 542e 6474 7970 652c 2052 2e64 7479  l(T.dtype, R.dty
+0000b170: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
+0000b180: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000b190: 7175 616c 2852 2e61 7474 7228 3029 2e6e  qual(R.attr(0).n
+0000b1a0: 6365 6c6c 732c 2032 290a 2020 2020 2020  cells, 2).      
+0000b1b0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0000b1c0: 5f61 7272 6179 5f65 7175 616c 2854 2c20  _array_equal(T, 
+0000b1d0: 5229 0a0a 2020 2020 6465 6620 7465 7374  R)..    def test
+0000b1e0: 5f6e 6365 6c6c 5f69 6e74 2873 656c 6629  _ncell_int(self)
+0000b1f0: 3a0a 2020 2020 2020 2020 6120 3d20 6e70  :.        a = np
+0000b200: 2e61 7272 6179 285b 2831 2c20 3229 2c20  .array([(1, 2), 
+0000b210: 2833 2c20 3429 2c20 2835 2c20 3629 5d2c  (3, 4), (5, 6)],
+0000b220: 2064 7479 7065 3d5b 2822 222c 206e 702e   dtype=[("", np.
+0000b230: 696e 7431 3629 2c20 2822 222c 206e 702e  int16), ("", np.
+0000b240: 696e 7431 3629 5d29 0a20 2020 2020 2020  int16)]).       
+0000b250: 2077 6974 6820 7469 6c65 6462 2e66 726f   with tiledb.fro
+0000b260: 6d5f 6e75 6d70 7928 7365 6c66 2e70 6174  m_numpy(self.pat
+0000b270: 6828 226e 6365 6c6c 5f69 6e74 3136 2229  h("ncell_int16")
+0000b280: 2c20 6129 2061 7320 543a 0a20 2020 2020  , a) as T:.     
+0000b290: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
+0000b2a0: 6462 2e6f 7065 6e28 7365 6c66 2e70 6174  db.open(self.pat
+0000b2b0: 6828 226e 6365 6c6c 5f69 6e74 3136 2229  h("ncell_int16")
+0000b2c0: 2920 6173 2052 3a0a 2020 2020 2020 2020  ) as R:.        
+0000b2d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000b2e0: 6572 7445 7175 616c 2854 2e64 7479 7065  ertEqual(T.dtype
+0000b2f0: 2c20 522e 6474 7970 6529 0a20 2020 2020  , R.dtype).     
+0000b300: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000b310: 6173 7365 7274 4571 7561 6c28 522e 6174  assertEqual(R.at
+0000b320: 7472 2830 292e 6e63 656c 6c73 2c20 3229  tr(0).ncells, 2)
+0000b330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b340: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+0000b350: 7561 6c28 542c 2052 290a 2020 2020 2020  ual(T, R).      
+0000b360: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0000b370: 5f61 7272 6179 5f65 7175 616c 2854 2c20  _array_equal(T, 
+0000b380: 522e 6d75 6c74 695f 696e 6465 785b 303a  R.multi_index[0:
+0000b390: 325d 5b22 225d 290a 0a20 2020 2064 6566  2][""])..    def
+0000b3a0: 2074 6573 745f 6f70 656e 5f77 6974 685f   test_open_with_
+0000b3b0: 7469 6d65 7374 616d 7028 7365 6c66 293a  timestamp(self):
+0000b3c0: 0a20 2020 2020 2020 2041 203d 206e 702e  .        A = np.
+0000b3d0: 7a65 726f 7328 3329 0a0a 2020 2020 2020  zeros(3)..      
+0000b3e0: 2020 646f 6d20 3d20 7469 6c65 6462 2e44    dom = tiledb.D
+0000b3f0: 6f6d 6169 6e28 7469 6c65 6462 2e44 696d  omain(tiledb.Dim
+0000b400: 2864 6f6d 6169 6e3d 2830 2c20 3229 2c20  (domain=(0, 2), 
+0000b410: 7469 6c65 3d33 2c20 6474 7970 653d 6e70  tile=3, dtype=np
+0000b420: 2e69 6e74 3634 2929 0a20 2020 2020 2020  .int64)).       
+0000b430: 2061 7474 203d 2074 696c 6564 622e 4174   att = tiledb.At
+0000b440: 7472 2864 7479 7065 3d41 2e64 7479 7065  tr(dtype=A.dtype
+0000b450: 290a 2020 2020 2020 2020 7363 6865 6d61  ).        schema
+0000b460: 203d 2074 696c 6564 622e 4172 7261 7953   = tiledb.ArrayS
+0000b470: 6368 656d 6128 646f 6d61 696e 3d64 6f6d  chema(domain=dom
+0000b480: 2c20 6174 7472 733d 2861 7474 2c29 290a  , attrs=(att,)).
+0000b490: 2020 2020 2020 2020 7469 6c65 6462 2e44          tiledb.D
+0000b4a0: 656e 7365 4172 7261 792e 6372 6561 7465  enseArray.create
+0000b4b0: 2873 656c 662e 7061 7468 2822 666f 6f22  (self.path("foo"
+0000b4c0: 292c 2073 6368 656d 6129 0a0a 2020 2020  ), schema)..    
+0000b4d0: 2020 2020 2320 7772 6974 650a 2020 2020      # write.    
+0000b4e0: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+0000b4f0: 4465 6e73 6541 7272 6179 2873 656c 662e  DenseArray(self.
+0000b500: 7061 7468 2822 666f 6f22 292c 206d 6f64  path("foo"), mod
+0000b510: 653d 2277 2229 2061 7320 543a 0a20 2020  e="w") as T:.   
+0000b520: 2020 2020 2020 2020 2054 5b3a 5d20 3d20           T[:] = 
+0000b530: 410a 0a20 2020 2020 2020 2072 6561 6431  A..        read1
+0000b540: 5f74 696d 6573 7461 6d70 203d 202d 310a  _timestamp = -1.
+0000b550: 2020 2020 2020 2020 7769 7468 2074 696c          with til
+0000b560: 6564 622e 4465 6e73 6541 7272 6179 2873  edb.DenseArray(s
+0000b570: 656c 662e 7061 7468 2822 666f 6f22 292c  elf.path("foo"),
+0000b580: 206d 6f64 653d 2272 2229 2061 7320 543a   mode="r") as T:
+0000b590: 0a20 2020 2020 2020 2020 2020 2072 6561  .            rea
+0000b5a0: 6431 5f74 696d 6573 7461 6d70 203d 2054  d1_timestamp = T
+0000b5b0: 2e74 696d 6573 7461 6d70 5f72 616e 6765  .timestamp_range
+0000b5c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000b5d0: 662e 6173 7365 7274 4571 7561 6c28 545b  f.assertEqual(T[
+0000b5e0: 305d 2c20 3029 0a20 2020 2020 2020 2020  0], 0).         
+0000b5f0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000b600: 7561 6c28 545b 315d 2c20 3029 0a20 2020  ual(T[1], 0).   
+0000b610: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+0000b620: 7365 7274 4571 7561 6c28 545b 325d 2c20  sertEqual(T[2], 
+0000b630: 3029 0a0a 2020 2020 2020 2020 2320 736c  0)..        # sl
+0000b640: 6565 7020 3230 306d 7320 616e 6420 7772  eep 200ms and wr
+0000b650: 6974 650a 2020 2020 2020 2020 7469 6d65  ite.        time
+0000b660: 2e73 6c65 6570 2830 2e32 290a 2020 2020  .sleep(0.2).    
+0000b670: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+0000b680: 4465 6e73 6541 7272 6179 2873 656c 662e  DenseArray(self.
+0000b690: 7061 7468 2822 666f 6f22 292c 206d 6f64  path("foo"), mod
+0000b6a0: 653d 2277 2229 2061 7320 543a 0a20 2020  e="w") as T:.   
+0000b6b0: 2020 2020 2020 2020 2054 5b30 3a31 5d20           T[0:1] 
+0000b6c0: 3d20 310a 0a20 2020 2020 2020 2072 6561  = 1..        rea
+0000b6d0: 6432 5f74 696d 6573 7461 6d70 203d 202d  d2_timestamp = -
+0000b6e0: 310a 2020 2020 2020 2020 7769 7468 2074  1.        with t
+0000b6f0: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
+0000b700: 2873 656c 662e 7061 7468 2822 666f 6f22  (self.path("foo"
+0000b710: 292c 206d 6f64 653d 2272 2229 2061 7320  ), mode="r") as 
+0000b720: 543a 0a20 2020 2020 2020 2020 2020 2072  T:.            r
+0000b730: 6561 6432 5f74 696d 6573 7461 6d70 203d  ead2_timestamp =
+0000b740: 2054 2e74 696d 6573 7461 6d70 5f72 616e   T.timestamp_ran
+0000b750: 6765 0a20 2020 2020 2020 2020 2020 2073  ge.            s
+0000b760: 656c 662e 6173 7365 7274 5472 7565 2872  elf.assertTrue(r
+0000b770: 6561 6432 5f74 696d 6573 7461 6d70 203e  ead2_timestamp >
+0000b780: 2072 6561 6431 5f74 696d 6573 7461 6d70   read1_timestamp
+0000b790: 290a 0a20 2020 2020 2020 2023 2073 6c65  )..        # sle
+0000b7a0: 6570 2032 3030 6d73 2061 6e64 2077 7269  ep 200ms and wri
+0000b7b0: 7465 0a20 2020 2020 2020 2074 696d 652e  te.        time.
+0000b7c0: 736c 6565 7028 302e 3229 0a20 2020 2020  sleep(0.2).     
+0000b7d0: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
+0000b7e0: 656e 7365 4172 7261 7928 7365 6c66 2e70  enseArray(self.p
+0000b7f0: 6174 6828 2266 6f6f 2229 2c20 6d6f 6465  ath("foo"), mode
+0000b800: 3d22 7722 2920 6173 2054 3a0a 2020 2020  ="w") as T:.    
+0000b810: 2020 2020 2020 2020 545b 313a 325d 203d          T[1:2] =
+0000b820: 2032 0a0a 2020 2020 2020 2020 7265 6164   2..        read
+0000b830: 335f 7469 6d65 7374 616d 7020 3d20 2d31  3_timestamp = -1
+0000b840: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
+0000b850: 6c65 6462 2e44 656e 7365 4172 7261 7928  ledb.DenseArray(
+0000b860: 7365 6c66 2e70 6174 6828 2266 6f6f 2229  self.path("foo")
+0000b870: 2c20 6d6f 6465 3d22 7222 2920 6173 2054  , mode="r") as T
+0000b880: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000b890: 6164 335f 7469 6d65 7374 616d 7020 3d20  ad3_timestamp = 
+0000b8a0: 542e 7469 6d65 7374 616d 705f 7261 6e67  T.timestamp_rang
+0000b8b0: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
+0000b8c0: 6c66 2e61 7373 6572 7454 7275 6528 7265  lf.assertTrue(re
+0000b8d0: 6164 335f 7469 6d65 7374 616d 7020 3e20  ad3_timestamp > 
+0000b8e0: 7265 6164 325f 7469 6d65 7374 616d 7020  read2_timestamp 
+0000b8f0: 3e20 7265 6164 315f 7469 6d65 7374 616d  > read1_timestam
+0000b900: 7029 0a0a 2020 2020 2020 2020 2320 7265  p)..        # re
+0000b910: 6164 2061 7420 6669 7273 7420 7469 6d65  ad at first time
+0000b920: 7374 616d 700a 2020 2020 2020 2020 7769  stamp.        wi
+0000b930: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
+0000b940: 7272 6179 280a 2020 2020 2020 2020 2020  rray(.          
+0000b950: 2020 7365 6c66 2e70 6174 6828 2266 6f6f    self.path("foo
+0000b960: 2229 2c20 7469 6d65 7374 616d 703d 7265  "), timestamp=re
+0000b970: 6164 315f 7469 6d65 7374 616d 702c 206d  ad1_timestamp, m
+0000b980: 6f64 653d 2272 220a 2020 2020 2020 2020  ode="r".        
+0000b990: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
+0000b9a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0000b9b0: 7175 616c 2854 5b30 5d2c 2030 290a 2020  qual(T[0], 0).  
+0000b9c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000b9d0: 7373 6572 7445 7175 616c 2854 5b31 5d2c  ssertEqual(T[1],
+0000b9e0: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
+0000b9f0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000ba00: 2854 5b32 5d2c 2030 290a 0a20 2020 2020  (T[2], 0)..     
+0000ba10: 2020 2023 2072 6561 6420 6174 2073 6563     # read at sec
+0000ba20: 6f6e 6420 7469 6d65 7374 616d 700a 2020  ond timestamp.  
+0000ba30: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+0000ba40: 622e 4465 6e73 6541 7272 6179 280a 2020  b.DenseArray(.  
+0000ba50: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000ba60: 6174 6828 2266 6f6f 2229 2c20 7469 6d65  ath("foo"), time
+0000ba70: 7374 616d 703d 7265 6164 325f 7469 6d65  stamp=read2_time
+0000ba80: 7374 616d 702c 206d 6f64 653d 2272 220a  stamp, mode="r".
+0000ba90: 2020 2020 2020 2020 2920 6173 2054 3a0a          ) as T:.
+0000baa0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bab0: 2e61 7373 6572 7445 7175 616c 2854 5b30  .assertEqual(T[0
+0000bac0: 5d2c 2031 290a 2020 2020 2020 2020 2020  ], 1).          
+0000bad0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000bae0: 616c 2854 5b31 5d2c 2030 290a 2020 2020  al(T[1], 0).    
+0000baf0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000bb00: 6572 7445 7175 616c 2854 5b32 5d2c 2030  ertEqual(T[2], 0
+0000bb10: 290a 0a20 2020 2020 2020 2023 2072 6561  )..        # rea
+0000bb20: 6420 6174 2074 6869 7264 2074 696d 6573  d at third times
+0000bb30: 7461 6d70 0a20 2020 2020 2020 2077 6974  tamp.        wit
+0000bb40: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
+0000bb50: 7261 7928 0a20 2020 2020 2020 2020 2020  ray(.           
+0000bb60: 2073 656c 662e 7061 7468 2822 666f 6f22   self.path("foo"
+0000bb70: 292c 2074 696d 6573 7461 6d70 3d72 6561  ), timestamp=rea
+0000bb80: 6433 5f74 696d 6573 7461 6d70 2c20 6d6f  d3_timestamp, mo
+0000bb90: 6465 3d22 7222 0a20 2020 2020 2020 2029  de="r".        )
+0000bba0: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
+0000bbb0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000bbc0: 7561 6c28 545b 305d 2c20 3129 0a20 2020  ual(T[0], 1).   
+0000bbd0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+0000bbe0: 7365 7274 4571 7561 6c28 545b 315d 2c20  sertEqual(T[1], 
+0000bbf0: 3229 0a20 2020 2020 2020 2020 2020 2073  2).            s
+0000bc00: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000bc10: 545b 325d 2c20 3029 0a0a 2020 2020 6465  T[2], 0)..    de
+0000bc20: 6620 7465 7374 5f6f 7065 6e5f 7469 6d65  f test_open_time
+0000bc30: 7374 616d 705f 7261 6e67 6528 7365 6c66  stamp_range(self
+0000bc40: 293a 0a20 2020 2020 2020 2041 203d 206e  ):.        A = n
+0000bc50: 702e 7a65 726f 7328 3329 0a20 2020 2020  p.zeros(3).     
+0000bc60: 2020 2070 6174 6820 3d20 7365 6c66 2e70     path = self.p
+0000bc70: 6174 6828 226f 7065 6e5f 7469 6d65 7374  ath("open_timest
+0000bc80: 616d 705f 7261 6e67 6522 290a 0a20 2020  amp_range")..   
+0000bc90: 2020 2020 2064 6f6d 203d 2074 696c 6564       dom = tiled
+0000bca0: 622e 446f 6d61 696e 2874 696c 6564 622e  b.Domain(tiledb.
+0000bcb0: 4469 6d28 646f 6d61 696e 3d28 302c 2032  Dim(domain=(0, 2
+0000bcc0: 292c 2074 696c 653d 332c 2064 7479 7065  ), tile=3, dtype
+0000bcd0: 3d6e 702e 696e 7436 3429 290a 2020 2020  =np.int64)).    
+0000bce0: 2020 2020 6174 7420 3d20 7469 6c65 6462      att = tiledb
+0000bcf0: 2e41 7474 7228 6474 7970 653d 412e 6474  .Attr(dtype=A.dt
+0000bd00: 7970 6529 0a20 2020 2020 2020 2073 6368  ype).        sch
+0000bd10: 656d 6120 3d20 7469 6c65 6462 2e41 7272  ema = tiledb.Arr
+0000bd20: 6179 5363 6865 6d61 2864 6f6d 6169 6e3d  aySchema(domain=
+0000bd30: 646f 6d2c 2061 7474 7273 3d28 6174 742c  dom, attrs=(att,
+0000bd40: 2929 0a20 2020 2020 2020 2074 696c 6564  )).        tiled
+0000bd50: 622e 4465 6e73 6541 7272 6179 2e63 7265  b.DenseArray.cre
+0000bd60: 6174 6528 7061 7468 2c20 7363 6865 6d61  ate(path, schema
+0000bd70: 290a 0a20 2020 2020 2020 2023 2077 7269  )..        # wri
+0000bd80: 7465 0a20 2020 2020 2020 2077 6974 6820  te.        with 
+0000bd90: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
+0000bda0: 7928 7061 7468 2c20 7469 6d65 7374 616d  y(path, timestam
+0000bdb0: 703d 312c 206d 6f64 653d 2277 2229 2061  p=1, mode="w") a
+0000bdc0: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
+0000bdd0: 2054 5b3a 5d20 3d20 4120 2a20 310a 2020   T[:] = A * 1.  
+0000bde0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+0000bdf0: 622e 4465 6e73 6541 7272 6179 2870 6174  b.DenseArray(pat
+0000be00: 682c 2074 696d 6573 7461 6d70 3d32 2c20  h, timestamp=2, 
+0000be10: 6d6f 6465 3d22 7722 2920 6173 2054 3a0a  mode="w") as T:.
+0000be20: 2020 2020 2020 2020 2020 2020 545b 3a5d              T[:]
+0000be30: 203d 2041 202a 2032 0a20 2020 2020 2020   = A * 2.       
+0000be40: 2077 6974 6820 7469 6c65 6462 2e44 656e   with tiledb.Den
+0000be50: 7365 4172 7261 7928 7061 7468 2c20 7469  seArray(path, ti
+0000be60: 6d65 7374 616d 703d 332c 206d 6f64 653d  mestamp=3, mode=
+0000be70: 2277 2229 2061 7320 543a 0a20 2020 2020  "w") as T:.     
+0000be80: 2020 2020 2020 2054 5b3a 5d20 3d20 4120         T[:] = A 
+0000be90: 2a20 330a 2020 2020 2020 2020 7769 7468  * 3.        with
+0000bea0: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
+0000beb0: 6179 2870 6174 682c 2074 696d 6573 7461  ay(path, timesta
+0000bec0: 6d70 3d34 2c20 6d6f 6465 3d22 7722 2920  mp=4, mode="w") 
+0000bed0: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
+0000bee0: 2020 545b 3a5d 203d 2041 202a 2034 0a0a    T[:] = A * 4..
+0000bef0: 2020 2020 2020 2020 6465 6620 6173 7365          def asse
+0000bf00: 7274 5f74 7328 7469 6d65 7374 616d 702c  rt_ts(timestamp,
+0000bf10: 2072 6573 756c 7429 3a0a 2020 2020 2020   result):.      
+0000bf20: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+0000bf30: 622e 4465 6e73 6541 7272 6179 2870 6174  b.DenseArray(pat
+0000bf40: 682c 206d 6f64 653d 2272 222c 2074 696d  h, mode="r", tim
+0000bf50: 6573 7461 6d70 3d74 696d 6573 7461 6d70  estamp=timestamp
+0000bf60: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
+0000bf70: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+0000bf80: 7272 6179 5f65 7175 616c 2854 2c20 7265  rray_equal(T, re
+0000bf90: 7375 6c74 290a 0a20 2020 2020 2020 2061  sult)..        a
+0000bfa0: 7373 6572 745f 7473 2830 2c20 4120 2a20  ssert_ts(0, A * 
+0000bfb0: 6e70 2e6e 616e 290a 2020 2020 2020 2020  np.nan).        
+0000bfc0: 6173 7365 7274 5f74 7328 312c 2041 202a  assert_ts(1, A *
+0000bfd0: 2031 290a 2020 2020 2020 2020 6173 7365   1).        asse
+0000bfe0: 7274 5f74 7328 322c 2041 202a 2032 290a  rt_ts(2, A * 2).
+0000bff0: 2020 2020 2020 2020 6173 7365 7274 5f74          assert_t
+0000c000: 7328 332c 2041 202a 2033 290a 2020 2020  s(3, A * 3).    
+0000c010: 2020 2020 6173 7365 7274 5f74 7328 2831      assert_ts((1
+0000c020: 2c20 3229 2c20 4120 2a20 3229 0a20 2020  , 2), A * 2).   
+0000c030: 2020 2020 2061 7373 6572 745f 7473 2828       assert_ts((
+0000c040: 302c 2033 292c 2041 202a 2033 290a 2020  0, 3), A * 3).  
+0000c050: 2020 2020 2020 6173 7365 7274 5f74 7328        assert_ts(
+0000c060: 2831 2c20 3329 2c20 4120 2a20 3329 0a20  (1, 3), A * 3). 
+0000c070: 2020 2020 2020 2061 7373 6572 745f 7473         assert_ts
+0000c080: 2828 322c 2033 292c 2041 202a 2033 290a  ((2, 3), A * 3).
+0000c090: 2020 2020 2020 2020 6173 7365 7274 5f74          assert_t
+0000c0a0: 7328 2832 2c20 3429 2c20 4120 2a20 3329  s((2, 4), A * 3)
+0000c0b0: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
+0000c0c0: 7473 2828 4e6f 6e65 2c20 3229 2c20 4120  ts((None, 2), A 
+0000c0d0: 2a20 3229 0a20 2020 2020 2020 2061 7373  * 2).        ass
+0000c0e0: 6572 745f 7473 2828 4e6f 6e65 2c20 3329  ert_ts((None, 3)
+0000c0f0: 2c20 4120 2a20 3329 0a20 2020 2020 2020  , A * 3).       
+0000c100: 2061 7373 6572 745f 7473 2828 322c 204e   assert_ts((2, N
+0000c110: 6f6e 6529 2c20 4120 2a20 3329 0a20 2020  one), A * 3).   
+0000c120: 2020 2020 2061 7373 6572 745f 7473 2828       assert_ts((
+0000c130: 332c 204e 6f6e 6529 2c20 4120 2a20 3329  3, None), A * 3)
+0000c140: 0a20 2020 2020 2020 2061 7373 6572 745f  .        assert_
+0000c150: 7473 2828 332c 204e 6f6e 6529 2c20 4120  ts((3, None), A 
+0000c160: 2a20 3329 0a0a 2020 2020 6465 6620 7465  * 3)..    def te
+0000c170: 7374 5f6e 6365 6c6c 5f61 7474 7269 6275  st_ncell_attribu
+0000c180: 7465 7328 7365 6c66 293a 0a20 2020 2020  tes(self):.     
+0000c190: 2020 2064 6f6d 203d 2074 696c 6564 622e     dom = tiledb.
+0000c1a0: 446f 6d61 696e 2874 696c 6564 622e 4469  Domain(tiledb.Di
+0000c1b0: 6d28 646f 6d61 696e 3d28 302c 2039 292c  m(domain=(0, 9),
+0000c1c0: 2074 696c 653d 3130 2c20 6474 7970 653d   tile=10, dtype=
+0000c1d0: 696e 7429 290a 2020 2020 2020 2020 6174  int)).        at
+0000c1e0: 7472 203d 2074 696c 6564 622e 4174 7472  tr = tiledb.Attr
+0000c1f0: 2864 7479 7065 3d5b 2822 222c 206e 702e  (dtype=[("", np.
+0000c200: 696e 7433 3229 2c20 2822 222c 206e 702e  int32), ("", np.
+0000c210: 696e 7433 3229 2c20 2822 222c 206e 702e  int32), ("", np.
+0000c220: 696e 7433 3229 5d29 0a20 2020 2020 2020  int32)]).       
+0000c230: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
+0000c240: 2e41 7272 6179 5363 6865 6d61 2864 6f6d  .ArraySchema(dom
+0000c250: 6169 6e3d 646f 6d2c 2061 7474 7273 3d28  ain=dom, attrs=(
+0000c260: 6174 7472 2c29 290a 2020 2020 2020 2020  attr,)).        
+0000c270: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
+0000c280: 792e 6372 6561 7465 2873 656c 662e 7061  y.create(self.pa
+0000c290: 7468 2822 666f 6f22 292c 2073 6368 656d  th("foo"), schem
+0000c2a0: 6129 0a0a 2020 2020 2020 2020 4120 3d20  a)..        A = 
+0000c2b0: 6e70 2e6f 6e65 7328 2831 302c 292c 2064  np.ones((10,), d
+0000c2c0: 7479 7065 3d5b 2822 222c 206e 702e 696e  type=[("", np.in
+0000c2d0: 7433 3229 2c20 2822 222c 206e 702e 696e  t32), ("", np.in
+0000c2e0: 7433 3229 2c20 2822 222c 206e 702e 696e  t32), ("", np.in
+0000c2f0: 7433 3229 5d29 0a20 2020 2020 2020 2073  t32)]).        s
+0000c300: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0000c310: 412e 6474 7970 652c 2061 7474 722e 6474  A.dtype, attr.dt
+0000c320: 7970 6529 0a0a 2020 2020 2020 2020 7769  ype)..        wi
+0000c330: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
+0000c340: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
+0000c350: 666f 6f22 292c 206d 6f64 653d 2277 2229  foo"), mode="w")
+0000c360: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
+0000c370: 2020 2054 5b3a 5d20 3d20 410a 2020 2020     T[:] = A.    
+0000c380: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+0000c390: 4465 6e73 6541 7272 6179 2873 656c 662e  DenseArray(self.
+0000c3a0: 7061 7468 2822 666f 6f22 292c 206d 6f64  path("foo"), mod
+0000c3b0: 653d 2272 2229 2061 7320 543a 0a20 2020  e="r") as T:.   
+0000c3c0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+0000c3d0: 6172 7261 795f 6571 7561 6c28 412c 2054  array_equal(A, T
+0000c3e0: 5b3a 5d29 0a20 2020 2020 2020 2020 2020  [:]).           
+0000c3f0: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+0000c400: 7561 6c28 415b 3a35 5d2c 2054 5b3a 355d  ual(A[:5], T[:5]
+0000c410: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0000c420: 636f 6d70 6c65 785f 6174 7472 6962 7574  complex_attribut
+0000c430: 6573 2873 656c 6629 3a0a 2020 2020 2020  es(self):.      
+0000c440: 2020 646f 6d20 3d20 7469 6c65 6462 2e44    dom = tiledb.D
+0000c450: 6f6d 6169 6e28 7469 6c65 6462 2e44 696d  omain(tiledb.Dim
+0000c460: 2864 6f6d 6169 6e3d 2830 2c20 3929 2c20  (domain=(0, 9), 
+0000c470: 7469 6c65 3d31 302c 2064 7479 7065 3d69  tile=10, dtype=i
+0000c480: 6e74 2929 0a20 2020 2020 2020 2061 7474  nt)).        att
+0000c490: 7220 3d20 7469 6c65 6462 2e41 7474 7228  r = tiledb.Attr(
+0000c4a0: 6474 7970 653d 6e70 2e63 6f6d 706c 6578  dtype=np.complex
+0000c4b0: 3634 290a 2020 2020 2020 2020 7363 6865  64).        sche
+0000c4c0: 6d61 203d 2074 696c 6564 622e 4172 7261  ma = tiledb.Arra
+0000c4d0: 7953 6368 656d 6128 646f 6d61 696e 3d64  ySchema(domain=d
+0000c4e0: 6f6d 2c20 6174 7472 733d 2861 7474 722c  om, attrs=(attr,
+0000c4f0: 2929 0a20 2020 2020 2020 2074 696c 6564  )).        tiled
+0000c500: 622e 4465 6e73 6541 7272 6179 2e63 7265  b.DenseArray.cre
+0000c510: 6174 6528 7365 6c66 2e70 6174 6828 2266  ate(self.path("f
+0000c520: 6f6f 2229 2c20 7363 6865 6d61 290a 0a20  oo"), schema).. 
+0000c530: 2020 2020 2020 2041 203d 206e 702e 7261         A = np.ra
+0000c540: 6e64 6f6d 2e72 616e 6428 3230 292e 6173  ndom.rand(20).as
+0000c550: 7479 7065 286e 702e 666c 6f61 7433 3229  type(np.float32)
+0000c560: 2e76 6965 7728 6474 7970 653d 6e70 2e63  .view(dtype=np.c
+0000c570: 6f6d 706c 6578 3634 290a 0a20 2020 2020  omplex64)..     
+0000c580: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0000c590: 7561 6c28 7363 6865 6d61 2c20 7469 6c65  ual(schema, tile
+0000c5a0: 6462 2e73 6368 656d 615f 6c69 6b65 2841  db.schema_like(A
+0000c5b0: 2c20 6469 6d5f 6474 7970 653d 696e 7429  , dim_dtype=int)
+0000c5c0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0000c5d0: 7373 6572 7445 7175 616c 2841 2e64 7479  ssertEqual(A.dty
+0000c5e0: 7065 2c20 6174 7472 2e64 7479 7065 290a  pe, attr.dtype).
+0000c5f0: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
+0000c600: 6c65 6462 2e44 656e 7365 4172 7261 7928  ledb.DenseArray(
+0000c610: 7365 6c66 2e70 6174 6828 2266 6f6f 2229  self.path("foo")
+0000c620: 2c20 6d6f 6465 3d22 7722 2920 6173 2054  , mode="w") as T
+0000c630: 3a0a 2020 2020 2020 2020 2020 2020 545b  :.            T[
+0000c640: 3a5d 203d 2041 0a0a 2020 2020 2020 2020  :] = A..        
+0000c650: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
+0000c660: 6541 7272 6179 2873 656c 662e 7061 7468  eArray(self.path
+0000c670: 2822 666f 6f22 292c 206d 6f64 653d 2272  ("foo"), mode="r
+0000c680: 2229 2061 7320 543a 0a20 2020 2020 2020  ") as T:.       
+0000c690: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
+0000c6a0: 795f 6571 7561 6c28 412c 2054 5b3a 5d29  y_equal(A, T[:])
+0000c6b0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+0000c6c0: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+0000c6d0: 415b 3a35 5d2c 2054 5b3a 355d 290a 0a20  A[:5], T[:5]).. 
+0000c6e0: 2020 2064 6566 2074 6573 745f 6d75 6c74     def test_mult
+0000c6f0: 6970 6c65 5f61 7474 7269 6275 7465 7328  iple_attributes(
+0000c700: 7365 6c66 293a 0a20 2020 2020 2020 2064  self):.        d
+0000c710: 6f6d 203d 2074 696c 6564 622e 446f 6d61  om = tiledb.Doma
+0000c720: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
+0000c730: 7469 6c65 6462 2e44 696d 2864 6f6d 6169  tiledb.Dim(domai
+0000c740: 6e3d 2830 2c20 3129 2c20 7469 6c65 3d31  n=(0, 1), tile=1
+0000c750: 2c20 6474 7970 653d 6e70 2e69 6e74 3634  , dtype=np.int64
+0000c760: 292c 0a20 2020 2020 2020 2020 2020 2074  ),.            t
+0000c770: 696c 6564 622e 4469 6d28 646f 6d61 696e  iledb.Dim(domain
+0000c780: 3d28 302c 2033 292c 2074 696c 653d 342c  =(0, 3), tile=4,
+0000c790: 2064 7479 7065 3d6e 702e 696e 7436 3429   dtype=np.int64)
+0000c7a0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+0000c7b0: 2020 2020 6174 7472 5f69 6e74 203d 2074      attr_int = t
+0000c7c0: 696c 6564 622e 4174 7472 2822 696e 7473  iledb.Attr("ints
+0000c7d0: 222c 2064 7479 7065 3d69 6e74 290a 2020  ", dtype=int).  
+0000c7e0: 2020 2020 2020 6174 7472 5f66 6c6f 6174        attr_float
+0000c7f0: 203d 2074 696c 6564 622e 4174 7472 2822   = tiledb.Attr("
+0000c800: 666c 6f61 7473 222c 2064 7479 7065 3d66  floats", dtype=f
+0000c810: 6c6f 6174 290a 2020 2020 2020 2020 7363  loat).        sc
+0000c820: 6865 6d61 203d 2074 696c 6564 622e 4172  hema = tiledb.Ar
+0000c830: 7261 7953 6368 656d 6128 646f 6d61 696e  raySchema(domain
+0000c840: 3d64 6f6d 2c20 6174 7472 733d 2861 7474  =dom, attrs=(att
+0000c850: 725f 696e 742c 2061 7474 725f 666c 6f61  r_int, attr_floa
+0000c860: 7429 290a 2020 2020 2020 2020 7469 6c65  t)).        tile
+0000c870: 6462 2e44 656e 7365 4172 7261 792e 6372  db.DenseArray.cr
+0000c880: 6561 7465 2873 656c 662e 7061 7468 2822  eate(self.path("
+0000c890: 666f 6f22 292c 2073 6368 656d 6129 0a0a  foo"), schema)..
+0000c8a0: 2020 2020 2020 2020 565f 696e 7473 203d          V_ints =
+0000c8b0: 206e 702e 6172 7261 7928 5b5b 302c 2031   np.array([[0, 1
+0000c8c0: 2c20 322c 2033 5d2c 205b 342c 2036 2c20  , 2, 3], [4, 6, 
+0000c8d0: 372c 2035 5d5d 290a 2020 2020 2020 2020  7, 5]]).        
+0000c8e0: 565f 666c 6f61 7473 203d 206e 702e 6172  V_floats = np.ar
+0000c8f0: 7261 7928 5b5b 302e 302c 2031 2e30 2c20  ray([[0.0, 1.0, 
+0000c900: 322e 302c 2033 2e30 5d2c 205b 342e 302c  2.0, 3.0], [4.0,
+0000c910: 2036 2e30 2c20 372e 302c 2035 2e30 5d5d   6.0, 7.0, 5.0]]
+0000c920: 290a 0a20 2020 2020 2020 2056 203d 207b  )..        V = {
+0000c930: 2269 6e74 7322 3a20 565f 696e 7473 2c20  "ints": V_ints, 
+0000c940: 2266 6c6f 6174 7322 3a20 565f 666c 6f61  "floats": V_floa
+0000c950: 7473 7d0a 2020 2020 2020 2020 7769 7468  ts}.        with
+0000c960: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
+0000c970: 6179 2873 656c 662e 7061 7468 2822 666f  ay(self.path("fo
+0000c980: 6f22 292c 206d 6f64 653d 2277 2229 2061  o"), mode="w") a
+0000c990: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
+0000c9a0: 2054 5b3a 5d20 3d20 560a 0a20 2020 2020   T[:] = V..     
+0000c9b0: 2020 2023 2063 6865 636b 2073 6574 7469     # check setti
+0000c9c0: 6e67 2061 7474 7269 6275 7465 2069 6e20  ng attribute in 
+0000c9d0: 6469 6666 6572 656e 7420 6f72 6465 7220  different order 
+0000c9e0: 6672 6f6d 2041 7474 7220 6465 6669 6e69  from Attr defini
+0000c9f0: 7469 6f6e 0a20 2020 2020 2020 2023 2020  tion.        #  
+0000ca00: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
+0000ca10: 636f 6d2f 5469 6c65 4442 2d49 6e63 2f54  com/TileDB-Inc/T
+0000ca20: 696c 6544 422d 5079 2f69 7373 7565 732f  ileDB-Py/issues/
+0000ca30: 3239 390a 2020 2020 2020 2020 5632 203d  299.        V2 =
+0000ca40: 207b 2266 6c6f 6174 7322 3a20 565f 666c   {"floats": V_fl
+0000ca50: 6f61 7473 2c20 2269 6e74 7322 3a20 565f  oats, "ints": V_
+0000ca60: 696e 7473 7d0a 2020 2020 2020 2020 7769  ints}.        wi
+0000ca70: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
+0000ca80: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
+0000ca90: 666f 6f22 292c 206d 6f64 653d 2277 2229  foo"), mode="w")
+0000caa0: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
+0000cab0: 2020 2054 5b3a 5d20 3d20 560a 0a20 2020     T[:] = V..   
+0000cac0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+0000cad0: 2e44 656e 7365 4172 7261 7928 7365 6c66  .DenseArray(self
+0000cae0: 2e70 6174 6828 2266 6f6f 2229 2c20 6d6f  .path("foo"), mo
+0000caf0: 6465 3d22 7222 2920 6173 2054 3a0a 2020  de="r") as T:.  
+0000cb00: 2020 2020 2020 2020 2020 5220 3d20 545b            R = T[
+0000cb10: 3a5d 0a20 2020 2020 2020 2020 2020 2061  :].            a
+0000cb20: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+0000cb30: 6c28 565b 2269 6e74 7322 5d2c 2052 5b22  l(V["ints"], R["
+0000cb40: 696e 7473 225d 290a 2020 2020 2020 2020  ints"]).        
+0000cb50: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
+0000cb60: 5f65 7175 616c 2856 5b22 666c 6f61 7473  _equal(V["floats
+0000cb70: 225d 2c20 525b 2266 6c6f 6174 7322 5d29  "], R["floats"])
+0000cb80: 0a0a 2020 2020 2020 2020 2020 2020 5220  ..            R 
+0000cb90: 3d20 542e 7175 6572 7928 6174 7472 733d  = T.query(attrs=
+0000cba0: 2822 696e 7473 222c 2929 5b31 3a33 5d0a  ("ints",))[1:3].
+0000cbb0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+0000cbc0: 7274 5f61 7272 6179 5f65 7175 616c 2856  rt_array_equal(V
+0000cbd0: 5b22 696e 7473 225d 5b31 3a33 5d2c 2052  ["ints"][1:3], R
+0000cbe0: 5b22 696e 7473 225d 290a 0a20 2020 2020  ["ints"])..     
+0000cbf0: 2020 2020 2020 2052 203d 2054 2e71 7565         R = T.que
+0000cc00: 7279 2861 7474 7273 3d28 2266 6c6f 6174  ry(attrs=("float
+0000cc10: 7322 2c29 2c20 6f72 6465 723d 2246 2229  s",), order="F")
+0000cc20: 5b3a 5d0a 2020 2020 2020 2020 2020 2020  [:].            
+0000cc30: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
+0000cc40: 525b 2266 6c6f 6174 7322 5d2e 666c 6167  R["floats"].flag
+0000cc50: 732e 665f 636f 6e74 6967 756f 7573 290a  s.f_contiguous).
+0000cc60: 0a20 2020 2020 2020 2020 2020 2052 203d  .            R =
+0000cc70: 2054 2e71 7565 7279 2861 7474 7273 3d28   T.query(attrs=(
+0000cc80: 2269 6e74 7322 2c29 2c20 636f 6f72 6473  "ints",), coords
+0000cc90: 3d54 7275 6529 5b30 2c20 303a 335d 0a20  =True)[0, 0:3]. 
+0000cca0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000ccb0: 6173 7365 7274 5472 7565 2822 5f5f 6469  assertTrue("__di
+0000ccc0: 6d5f 3022 2069 6e20 5229 0a20 2020 2020  m_0" in R).     
+0000ccd0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0000cce0: 7274 5472 7565 2822 5f5f 6469 6d5f 3122  rtTrue("__dim_1"
+0000ccf0: 2069 6e20 5229 0a20 2020 2020 2020 2020   in R).         
+0000cd00: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
+0000cd10: 6571 7561 6c28 525b 225f 5f64 696d 5f30  equal(R["__dim_0
+0000cd20: 225d 2c20 6e70 2e61 7272 6179 285b 302c  "], np.array([0,
+0000cd30: 2030 2c20 305d 2929 0a20 2020 2020 2020   0, 0])).       
+0000cd40: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
+0000cd50: 795f 6571 7561 6c28 525b 225f 5f64 696d  y_equal(R["__dim
+0000cd60: 5f31 225d 2c20 6e70 2e61 7272 6179 285b  _1"], np.array([
+0000cd70: 302c 2031 2c20 325d 2929 0a0a 2020 2020  0, 1, 2]))..    
+0000cd80: 2020 2020 2020 2020 2320 476c 6f62 616c          # Global
+0000cd90: 206f 7264 6572 2072 6574 7572 6e73 2072   order returns r
+0000cda0: 6573 756c 7473 2061 7320 6120 6c69 6e65  esults as a line
+0000cdb0: 6172 2062 7566 6665 720a 2020 2020 2020  ar buffer.      
+0000cdc0: 2020 2020 2020 5220 3d20 542e 7175 6572        R = T.quer
+0000cdd0: 7928 6174 7472 733d 2822 696e 7473 222c  y(attrs=("ints",
+0000cde0: 292c 206f 7264 6572 3d22 4722 295b 3a5d  ), order="G")[:]
+0000cdf0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000ce00: 662e 6173 7365 7274 4571 7561 6c28 525b  f.assertEqual(R[
+0000ce10: 2269 6e74 7322 5d2e 7368 6170 652c 2028  "ints"].shape, (
+0000ce20: 382c 2929 0a0a 2020 2020 2020 2020 2020  8,))..          
+0000ce30: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
+0000ce40: 7274 5261 6973 6573 2874 696c 6564 622e  rtRaises(tiledb.
+0000ce50: 5469 6c65 4442 4572 726f 7229 3a0a 2020  TileDBError):.  
+0000ce60: 2020 2020 2020 2020 2020 2020 2020 542e                T.
+0000ce70: 7175 6572 7928 6174 7472 733d 2822 756e  query(attrs=("un
+0000ce80: 6b6e 6f77 6e22 2c29 295b 3a5d 0a0a 2020  known",))[:]..  
+0000ce90: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+0000cea0: 622e 4465 6e73 6541 7272 6179 2873 656c  b.DenseArray(sel
+0000ceb0: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
+0000cec0: 6f64 653d 2277 2229 2061 7320 543a 0a20  ode="w") as T:. 
+0000ced0: 2020 2020 2020 2020 2020 2023 2063 6865             # che
+0000cee0: 636b 2065 7272 6f72 206e 6365 6c6c 7320  ck error ncells 
+0000cef0: 6c65 6e67 7468 0a20 2020 2020 2020 2020  length.         
+0000cf00: 2020 2056 5b22 696e 7473 225d 203d 2056     V["ints"] = V
+0000cf10: 5b22 696e 7473 225d 5b31 3a32 5d2e 636f  ["ints"][1:2].co
+0000cf20: 7079 2829 0a20 2020 2020 2020 2020 2020  py().           
+0000cf30: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+0000cf40: 7452 6169 7365 7328 7469 6c65 6462 2e54  tRaises(tiledb.T
+0000cf50: 696c 6544 4245 7272 6f72 293a 0a20 2020  ileDBError):.   
+0000cf60: 2020 2020 2020 2020 2020 2020 2054 5b3a               T[:
+0000cf70: 5d20 3d20 560a 0a20 2020 2020 2020 2020  ] = V..         
+0000cf80: 2020 2023 2063 6865 636b 2065 7272 6f72     # check error
+0000cf90: 2061 7474 7269 6275 7465 2064 6f65 7320   attribute does 
+0000cfa0: 6e6f 7420 6578 6973 740a 2020 2020 2020  not exist.      
+0000cfb0: 2020 2020 2020 565b 2266 6f6f 225d 203d        V["foo"] =
+0000cfc0: 2056 5b22 696e 7473 225d 2e61 7374 7970   V["ints"].astyp
+0000cfd0: 6528 6e70 2e69 6e74 3829 0a20 2020 2020  e(np.int8).     
+0000cfe0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+0000cff0: 2e61 7373 6572 7452 6169 7365 7328 7469  .assertRaises(ti
+0000d000: 6c65 6462 2e54 696c 6544 4245 7272 6f72  ledb.TileDBError
+0000d010: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000d020: 2020 2054 5b3a 5d20 3d20 560a 0a20 2020     T[:] = V..   
+0000d030: 2064 6566 2074 6573 745f 6172 7261 795f   def test_array_
+0000d040: 3264 5f73 3128 7365 6c66 293a 0a20 2020  2d_s1(self):.   
+0000d050: 2020 2020 2023 2054 6869 7320 6172 7261       # This arra
+0000d060: 7920 6973 2063 7572 7265 6e74 6c79 2072  y is currently r
+0000d070: 6561 6420 6261 636b 2077 6974 6820 6474  ead back with dt
+0000d080: 7970 6520 6f62 6a65 6374 0a20 2020 2020  ype object.     
+0000d090: 2020 2041 203d 206e 702e 6172 7261 7928     A = np.array(
+0000d0a0: 5b5b 2241 222c 2022 4222 5d2c 205b 2243  [["A", "B"], ["C
+0000d0b0: 222c 2022 225d 5d2c 2064 7479 7065 3d22  ", ""]], dtype="
+0000d0c0: 5322 290a 0a20 2020 2020 2020 2075 7269  S")..        uri
+0000d0d0: 203d 2073 656c 662e 7061 7468 2829 0a20   = self.path(). 
+0000d0e0: 2020 2020 2020 2064 6f6d 203d 2074 696c         dom = til
+0000d0f0: 6564 622e 446f 6d61 696e 280a 2020 2020  edb.Domain(.    
+0000d100: 2020 2020 2020 2020 7469 6c65 6462 2e44          tiledb.D
+0000d110: 696d 286e 616d 653d 2272 6f77 7322 2c20  im(name="rows", 
+0000d120: 646f 6d61 696e 3d28 302c 2031 292c 2074  domain=(0, 1), t
+0000d130: 696c 653d 322c 2064 7479 7065 3d6e 702e  ile=2, dtype=np.
+0000d140: 696e 7436 3429 2c0a 2020 2020 2020 2020  int64),.        
+0000d150: 2020 2020 7469 6c65 6462 2e44 696d 286e      tiledb.Dim(n
+0000d160: 616d 653d 2263 6f6c 7322 2c20 646f 6d61  ame="cols", doma
+0000d170: 696e 3d28 302c 2031 292c 2074 696c 653d  in=(0, 1), tile=
+0000d180: 322c 2064 7479 7065 3d6e 702e 696e 7436  2, dtype=np.int6
+0000d190: 3429 2c0a 2020 2020 2020 2020 290a 0a20  4),.        ).. 
+0000d1a0: 2020 2020 2020 2073 6368 656d 6120 3d20         schema = 
+0000d1b0: 7469 6c65 6462 2e41 7272 6179 5363 6865  tiledb.ArraySche
+0000d1c0: 6d61 280a 2020 2020 2020 2020 2020 2020  ma(.            
+0000d1d0: 646f 6d61 696e 3d64 6f6d 2c20 7370 6172  domain=dom, spar
+0000d1e0: 7365 3d46 616c 7365 2c20 6174 7472 733d  se=False, attrs=
+0000d1f0: 5b74 696c 6564 622e 4174 7472 286e 616d  [tiledb.Attr(nam
+0000d200: 653d 2261 222c 2064 7479 7065 3d22 5322  e="a", dtype="S"
+0000d210: 295d 0a20 2020 2020 2020 2029 0a0a 2020  )].        )..  
+0000d220: 2020 2020 2020 7469 6c65 6462 2e44 656e        tiledb.Den
+0000d230: 7365 4172 7261 792e 6372 6561 7465 2875  seArray.create(u
+0000d240: 7269 2c20 7363 6865 6d61 290a 0a20 2020  ri, schema)..   
+0000d250: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+0000d260: 2e44 656e 7365 4172 7261 7928 7572 692c  .DenseArray(uri,
+0000d270: 206d 6f64 653d 2277 2229 2061 7320 543a   mode="w") as T:
+0000d280: 0a20 2020 2020 2020 2020 2020 2054 5b2e  .            T[.
+0000d290: 2e2e 5d20 3d20 410a 0a20 2020 2020 2020  ..] = A..       
+0000d2a0: 2077 6974 6820 7469 6c65 6462 2e44 656e   with tiledb.Den
+0000d2b0: 7365 4172 7261 7928 7572 6929 2061 7320  seArray(uri) as 
+0000d2c0: 543a 0a20 2020 2020 2020 2020 2020 2061  T:.            a
+0000d2d0: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+0000d2e0: 6c28 412c 2054 290a 0a20 2020 2020 2020  l(A, T)..       
+0000d2f0: 2020 2020 2072 6573 203d 2054 2e6d 756c       res = T.mul
+0000d300: 7469 5f69 6e64 6578 5b28 302c 2031 292c  ti_index[(0, 1),
+0000d310: 2028 302c 2031 295d 5b22 6122 5d0a 2020   (0, 1)]["a"].  
+0000d320: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0000d330: 5f61 7272 6179 5f65 7175 616c 2841 2c20  _array_equal(A, 
+0000d340: 7265 7329 0a0a 2020 2020 6465 6620 7465  res)..    def te
+0000d350: 7374 5f6e 645f 726f 756e 6474 7269 7028  st_nd_roundtrip(
+0000d360: 7365 6c66 293a 0a20 2020 2020 2020 2064  self):.        d
+0000d370: 696d 5f73 6574 203d 206e 702e 696e 7436  im_set = np.int6
+0000d380: 3428 5b33 202b 2078 2025 2032 2066 6f72  4([3 + x % 2 for
+0000d390: 2078 2069 6e20 7261 6e67 6528 322c 2031   x in range(2, 1
+0000d3a0: 3229 5d29 0a20 2020 2020 2020 2066 6f72  2)]).        for
+0000d3b0: 2069 2c20 6c61 7374 2069 6e20 656e 756d   i, last in enum
+0000d3c0: 6572 6174 6528 7261 6e67 6528 322c 206c  erate(range(2, l
+0000d3d0: 656e 2864 696d 5f73 6574 2929 293a 0a20  en(dim_set))):. 
+0000d3e0: 2020 2020 2020 2020 2020 2064 696d 7320             dims 
+0000d3f0: 3d20 6469 6d5f 7365 745b 3a6c 6173 745d  = dim_set[:last]
+0000d400: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+0000d410: 6120 3d20 6e70 2e72 616e 646f 6d2e 7261  a = np.random.ra
+0000d420: 6e64 282a 6469 6d73 292e 6173 7479 7065  nd(*dims).astype
+0000d430: 2822 696e 7433 3222 290a 2020 2020 2020  ("int32").      
+0000d440: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+0000d450: 622e 6672 6f6d 5f6e 756d 7079 2873 656c  b.from_numpy(sel
+0000d460: 662e 7061 7468 2866 226e 645f 726f 756e  f.path(f"nd_roun
+0000d470: 6474 7269 707b 697d 2229 2c20 6461 7461  dtrip{i}"), data
+0000d480: 2920 6173 2041 3a0a 2020 2020 2020 2020  ) as A:.        
+0000d490: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+0000d4a0: 7272 6179 5f65 7175 616c 2864 6174 612c  rray_equal(data,
+0000d4b0: 2041 5b3a 5d29 0a0a 2020 2020 6465 6620   A[:])..    def 
+0000d4c0: 7465 7374 5f61 7272 6179 5f32 645f 7333  test_array_2d_s3
+0000d4d0: 5f6d 6978 6564 2873 656c 6629 3a0a 2020  _mixed(self):.  
+0000d4e0: 2020 2020 2020 2320 5468 6973 2061 7272        # This arr
+0000d4f0: 6179 2069 7320 6375 7272 656e 746c 7920  ay is currently 
+0000d500: 7265 6164 2062 6163 6b20 7769 7468 2064  read back with d
+0000d510: 7479 7065 206f 626a 6563 740a 2020 2020  type object.    
+0000d520: 2020 2020 4120 3d20 6e70 2e61 7272 6179      A = np.array
+0000d530: 285b 5b22 4141 4122 2c20 2242 225d 2c20  ([["AAA", "B"], 
+0000d540: 5b22 4142 222c 2022 4322 5d5d 2c20 6474  ["AB", "C"]], dt
+0000d550: 7970 653d 2253 3322 290a 0a20 2020 2020  ype="S3")..     
+0000d560: 2020 2075 7269 203d 2073 656c 662e 7061     uri = self.pa
+0000d570: 7468 2829 0a20 2020 2020 2020 2064 6f6d  th().        dom
+0000d580: 203d 2074 696c 6564 622e 446f 6d61 696e   = tiledb.Domain
+0000d590: 280a 2020 2020 2020 2020 2020 2020 7469  (.            ti
+0000d5a0: 6c65 6462 2e44 696d 286e 616d 653d 2272  ledb.Dim(name="r
+0000d5b0: 6f77 7322 2c20 646f 6d61 696e 3d28 302c  ows", domain=(0,
+0000d5c0: 2031 292c 2074 696c 653d 322c 2064 7479   1), tile=2, dty
+0000d5d0: 7065 3d6e 702e 696e 7436 3429 2c0a 2020  pe=np.int64),.  
+0000d5e0: 2020 2020 2020 2020 2020 7469 6c65 6462            tiledb
+0000d5f0: 2e44 696d 286e 616d 653d 2263 6f6c 7322  .Dim(name="cols"
+0000d600: 2c20 646f 6d61 696e 3d28 302c 2031 292c  , domain=(0, 1),
+0000d610: 2074 696c 653d 322c 2064 7479 7065 3d6e   tile=2, dtype=n
+0000d620: 702e 696e 7436 3429 2c0a 2020 2020 2020  p.int64),.      
+0000d630: 2020 290a 0a20 2020 2020 2020 2073 6368    )..        sch
+0000d640: 656d 6120 3d20 7469 6c65 6462 2e41 7272  ema = tiledb.Arr
+0000d650: 6179 5363 6865 6d61 280a 2020 2020 2020  aySchema(.      
+0000d660: 2020 2020 2020 646f 6d61 696e 3d64 6f6d        domain=dom
+0000d670: 2c20 7370 6172 7365 3d46 616c 7365 2c20  , sparse=False, 
+0000d680: 6174 7472 733d 5b74 696c 6564 622e 4174  attrs=[tiledb.At
+0000d690: 7472 286e 616d 653d 2261 222c 2064 7479  tr(name="a", dty
+0000d6a0: 7065 3d22 5333 2229 5d0a 2020 2020 2020  pe="S3")].      
+0000d6b0: 2020 290a 0a20 2020 2020 2020 2074 696c    )..        til
+0000d6c0: 6564 622e 4465 6e73 6541 7272 6179 2e63  edb.DenseArray.c
+0000d6d0: 7265 6174 6528 7572 692c 2073 6368 656d  reate(uri, schem
+0000d6e0: 6129 0a0a 2020 2020 2020 2020 7769 7468  a)..        with
+0000d6f0: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
+0000d700: 6179 2875 7269 2c20 6d6f 6465 3d22 7722  ay(uri, mode="w"
+0000d710: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
+0000d720: 2020 2020 545b 2e2e 2e5d 203d 2041 0a0a      T[...] = A..
+0000d730: 2020 2020 2020 2020 7769 7468 2074 696c          with til
+0000d740: 6564 622e 4465 6e73 6541 7272 6179 2875  edb.DenseArray(u
+0000d750: 7269 2920 6173 2054 3a0a 2020 2020 2020  ri) as T:.      
+0000d760: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
+0000d770: 6179 5f65 7175 616c 2841 2c20 5429 0a0a  ay_equal(A, T)..
+0000d780: 2020 2020 2020 2020 2020 2020 7265 7320              res 
+0000d790: 3d20 542e 6d75 6c74 695f 696e 6465 785b  = T.multi_index[
+0000d7a0: 2830 2c20 3129 2c20 2830 2c20 3129 5d5b  (0, 1), (0, 1)][
+0000d7b0: 2261 225d 0a20 2020 2020 2020 2020 2020  "a"].           
+0000d7c0: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+0000d7d0: 7561 6c28 412c 2072 6573 290a 0a20 2020  ual(A, res)..   
+0000d7e0: 2064 6566 2074 6573 745f 696e 636f 6d70   def test_incomp
+0000d7f0: 6c65 7465 5f64 656e 7365 2873 656c 6629  lete_dense(self)
+0000d800: 3a0a 2020 2020 2020 2020 7061 7468 203d  :.        path =
+0000d810: 2073 656c 662e 7061 7468 2822 696e 636f   self.path("inco
+0000d820: 6d70 6c65 7465 5f64 656e 7365 2229 0a20  mplete_dense"). 
+0000d830: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+0000d840: 3130 204d 4220 6172 7261 790a 2020 2020  10 MB array.    
+0000d850: 2020 2020 6461 7461 203d 206e 702e 6172      data = np.ar
+0000d860: 616e 6765 2831 3331 3037 3230 2c20 6474  ange(1310720, dt
+0000d870: 7970 653d 6e70 2e69 6e74 3634 290a 2020  ype=np.int64).  
+0000d880: 2020 2020 2020 2320 6966 2060 7469 6c65        # if `tile
+0000d890: 6020 6973 206e 6f74 2073 6574 2c20 6974  ` is not set, it
+0000d8a0: 2064 6566 6175 6c74 7320 746f 2074 6865   defaults to the
+0000d8b0: 2066 756c 6c20 6172 7261 7920 616e 6420   full array and 
+0000d8c0: 7765 0a20 2020 2020 2020 2023 206f 6e6c  we.        # onl
+0000d8d0: 7920 7265 6164 2038 2062 7974 6573 2061  y read 8 bytes a
+0000d8e0: 7420 6120 7469 6d65 2e0a 2020 2020 2020  t a time..      
+0000d8f0: 2020 7573 655f 7469 6c65 203d 2031 3331    use_tile = 131
+0000d900: 3037 320a 2020 2020 2020 2020 2320 7573  072.        # us
+0000d910: 655f 7469 6c65 203d 204e 6f6e 650a 2020  e_tile = None.  
+0000d920: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+0000d930: 622e 6672 6f6d 5f6e 756d 7079 2870 6174  b.from_numpy(pat
+0000d940: 682c 2064 6174 612c 2074 696c 653d 7573  h, data, tile=us
+0000d950: 655f 7469 6c65 2920 6173 2041 3a0a 2020  e_tile) as A:.  
+0000d960: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
+0000d970: 2020 2020 2020 2020 2320 6372 6561 7465          # create
+0000d980: 2063 6f6e 7465 7874 2077 6974 6820 3120   context with 1 
+0000d990: 4d42 206d 656d 6f72 7920 6275 6467 6574  MB memory budget
+0000d9a0: 2028 3220 4d42 2074 6f74 616c 2c20 3120   (2 MB total, 1 
+0000d9b0: 4d42 2075 7361 626c 6529 0a20 2020 2020  MB usable).     
+0000d9c0: 2020 2063 6f6e 6669 6720 3d20 7469 6c65     config = tile
+0000d9d0: 6462 2e43 6f6e 6669 6728 0a20 2020 2020  db.Config(.     
+0000d9e0: 2020 2020 2020 207b 2273 6d2e 6d65 6d6f         {"sm.memo
+0000d9f0: 7279 5f62 7564 6765 7422 3a20 3220 2a20  ry_budget": 2 * 
+0000da00: 3130 3234 202a 2a20 322c 2022 7079 2e69  1024 ** 2, "py.i
+0000da10: 6e69 745f 6275 6666 6572 5f62 7974 6573  nit_buffer_bytes
+0000da20: 223a 2031 3032 3420 2a2a 2032 7d0a 2020  ": 1024 ** 2}.  
+0000da30: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000da40: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0000da50: 2863 6f6e 6669 675b 2270 792e 696e 6974  (config["py.init
+0000da60: 5f62 7566 6665 725f 6279 7465 7322 5d2c  _buffer_bytes"],
+0000da70: 2073 7472 2831 3032 3420 2a2a 2032 2929   str(1024 ** 2))
+0000da80: 0a20 2020 2020 2020 2023 2054 4f44 4f20  .        # TODO 
+0000da90: 776f 756c 6420 6265 2067 6f6f 6420 746f  would be good to
+0000daa0: 2063 6865 636b 2072 6570 6561 7420 636f   check repeat co
+0000dab0: 756e 7420 6865 7265 2e20 4e6f 7420 6375  unt here. Not cu
+0000dac0: 7272 656e 746c 7920 6578 706f 7365 6420  rrently exposed 
+0000dad0: 6279 2072 6574 7279 206c 6f6f 702e 0a20  by retry loop.. 
+0000dae0: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
+0000daf0: 6462 2e44 656e 7365 4172 7261 7928 7061  db.DenseArray(pa
+0000db00: 7468 2c20 6374 783d 7469 6c65 6462 2e43  th, ctx=tiledb.C
+0000db10: 7478 2863 6f6e 6669 6729 2920 6173 2041  tx(config)) as A
+0000db20: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000db30: 735f 6d72 203d 2041 2e6d 756c 7469 5f69  s_mr = A.multi_i
+0000db40: 6e64 6578 5b73 6c69 6365 2830 2c20 6c65  ndex[slice(0, le
+0000db50: 6e28 6461 7461 2920 2d20 3129 5d0a 2020  n(data) - 1)].  
+0000db60: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0000db70: 5f61 7272 6179 5f65 7175 616c 2872 6573  _array_equal(res
+0000db80: 5f6d 725b 2222 5d2c 2064 6174 6129 0a20  _mr[""], data). 
+0000db90: 2020 2020 2020 2020 2020 2072 6573 5f69             res_i
+0000dba0: 6478 203d 2041 5b3a 5d0a 2020 2020 2020  dx = A[:].      
+0000dbb0: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
+0000dbc0: 6179 5f65 7175 616c 2872 6573 5f69 6478  ay_equal(res_idx
+0000dbd0: 2c20 6461 7461 290a 0a20 2020 2020 2020  , data)..       
+0000dbe0: 2020 2020 2064 6620 3d20 412e 6466 5b3a       df = A.df[:
+0000dbf0: 5d0a 2020 2020 2020 2020 2020 2020 6173  ].            as
+0000dc00: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
+0000dc10: 2864 665b 2222 5d2c 2064 6174 6129 0a0a  (df[""], data)..
+0000dc20: 2020 2020 6465 6620 7465 7374 5f77 7269      def test_wri
+0000dc30: 7474 656e 5f66 7261 676d 656e 745f 696e  tten_fragment_in
+0000dc40: 666f 2873 656c 6629 3a0a 2020 2020 2020  fo(self):.      
+0000dc50: 2020 7572 6920 3d20 7365 6c66 2e70 6174    uri = self.pat
+0000dc60: 6828 2274 6573 745f 7772 6974 7465 6e5f  h("test_written_
+0000dc70: 6672 6167 6d65 6e74 5f69 6e66 6f22 290a  fragment_info").
+0000dc80: 0a20 2020 2020 2020 2064 6f6d 203d 2074  .        dom = t
+0000dc90: 696c 6564 622e 446f 6d61 696e 2874 696c  iledb.Domain(til
+0000dca0: 6564 622e 4469 6d28 646f 6d61 696e 3d28  edb.Dim(domain=(
+0000dcb0: 302c 2039 292c 2074 696c 653d 3130 2c20  0, 9), tile=10, 
+0000dcc0: 6474 7970 653d 6e70 2e69 6e74 3634 2929  dtype=np.int64))
+0000dcd0: 0a20 2020 2020 2020 2061 7474 203d 2074  .        att = t
+0000dce0: 696c 6564 622e 4174 7472 2864 7479 7065  iledb.Attr(dtype
+0000dcf0: 3d6e 702e 696e 7436 3429 0a20 2020 2020  =np.int64).     
+0000dd00: 2020 2073 6368 656d 6120 3d20 7469 6c65     schema = tile
+0000dd10: 6462 2e41 7272 6179 5363 6865 6d61 2864  db.ArraySchema(d
+0000dd20: 6f6d 6169 6e3d 646f 6d2c 2061 7474 7273  omain=dom, attrs
+0000dd30: 3d28 6174 742c 2929 0a20 2020 2020 2020  =(att,)).       
+0000dd40: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
+0000dd50: 6179 2e63 7265 6174 6528 7572 692c 2073  ay.create(uri, s
+0000dd60: 6368 656d 6129 0a0a 2020 2020 2020 2020  chema)..        
+0000dd70: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
+0000dd80: 6541 7272 6179 2875 7269 2c20 6d6f 6465  eArray(uri, mode
+0000dd90: 3d22 7722 2920 6173 2054 3a0a 2020 2020  ="w") as T:.    
+0000dda0: 2020 2020 2020 2020 545b 3a5d 203d 206e          T[:] = n
+0000ddb0: 702e 6172 616e 6765 2830 2c20 3130 2c20  p.arange(0, 10, 
+0000ddc0: 6474 7970 653d 6e70 2e69 6e74 3634 290a  dtype=np.int64).
+0000ddd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000dde0: 662e 6173 7365 7274 5472 7565 2854 2e6c  f.assertTrue(T.l
+0000ddf0: 6173 745f 7772 6974 655f 696e 666f 2069  ast_write_info i
+0000de00: 7320 6e6f 7420 4e6f 6e65 290a 2020 2020  s not None).    
+0000de10: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0000de20: 6572 7454 7275 6528 6c65 6e28 542e 6c61  ertTrue(len(T.la
+0000de30: 7374 5f77 7269 7465 5f69 6e66 6f2e 6b65  st_write_info.ke
+0000de40: 7973 2829 2920 3d3d 2031 290a 2020 2020  ys()) == 1).    
+0000de50: 2020 2020 2020 2020 745f 7731 2c20 745f          t_w1, t_
+0000de60: 7732 203d 206c 6973 7428 542e 6c61 7374  w2 = list(T.last
+0000de70: 5f77 7269 7465 5f69 6e66 6f2e 7661 6c75  _write_info.valu
+0000de80: 6573 2829 295b 305d 0a20 2020 2020 2020  es())[0].       
+0000de90: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0000dea0: 5472 7565 2874 5f77 3120 3e20 3029 0a20  True(t_w1 > 0). 
+0000deb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000dec0: 6173 7365 7274 5472 7565 2874 5f77 3220  assertTrue(t_w2 
+0000ded0: 3e20 3029 0a0a 2020 2020 6465 6620 7465  > 0)..    def te
+0000dee0: 7374 5f6d 6973 7369 6e67 5f73 6368 656d  st_missing_schem
+0000def0: 615f 6572 726f 7228 7365 6c66 293a 0a20  a_error(self):. 
+0000df00: 2020 2020 2020 2075 7269 203d 2073 656c         uri = sel
+0000df10: 662e 7061 7468 2822 7465 7374 5f6d 6973  f.path("test_mis
+0000df20: 7369 6e67 5f73 6368 656d 615f 6572 726f  sing_schema_erro
+0000df30: 7222 290a 0a20 2020 2020 2020 2064 6f6d  r")..        dom
+0000df40: 203d 2074 696c 6564 622e 446f 6d61 696e   = tiledb.Domain
+0000df50: 2874 696c 6564 622e 4469 6d28 646f 6d61  (tiledb.Dim(doma
+0000df60: 696e 3d28 302c 2039 292c 2074 696c 653d  in=(0, 9), tile=
+0000df70: 3130 2c20 6474 7970 653d 6e70 2e69 6e74  10, dtype=np.int
+0000df80: 3634 2929 0a20 2020 2020 2020 2061 7474  64)).        att
+0000df90: 203d 2074 696c 6564 622e 4174 7472 2864   = tiledb.Attr(d
+0000dfa0: 7479 7065 3d6e 702e 696e 7436 3429 0a20  type=np.int64). 
+0000dfb0: 2020 2020 2020 2073 6368 656d 6120 3d20         schema = 
+0000dfc0: 7469 6c65 6462 2e41 7272 6179 5363 6865  tiledb.ArraySche
+0000dfd0: 6d61 2864 6f6d 6169 6e3d 646f 6d2c 2061  ma(domain=dom, a
+0000dfe0: 7474 7273 3d28 6174 742c 2929 0a20 2020  ttrs=(att,)).   
+0000dff0: 2020 2020 2074 696c 6564 622e 4465 6e73       tiledb.Dens
+0000e000: 6541 7272 6179 2e63 7265 6174 6528 7572  eArray.create(ur
+0000e010: 692c 2073 6368 656d 6129 0a0a 2020 2020  i, schema)..    
+0000e020: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+0000e030: 4465 6e73 6541 7272 6179 2875 7269 2c20  DenseArray(uri, 
+0000e040: 6d6f 6465 3d22 7722 2920 6173 2054 3a0a  mode="w") as T:.
+0000e050: 2020 2020 2020 2020 2020 2020 545b 3a5d              T[:]
+0000e060: 203d 206e 702e 6172 616e 6765 2830 2c20   = np.arange(0, 
+0000e070: 3130 2c20 6474 7970 653d 6e70 2e69 6e74  10, dtype=np.int
+0000e080: 3634 290a 0a20 2020 2020 2020 2069 6620  64)..        if 
+0000e090: 7469 6c65 6462 2e6c 6962 7469 6c65 6462  tiledb.libtiledb
+0000e0a0: 2e76 6572 7369 6f6e 2829 203c 2028 322c  .version() < (2,
+0000e0b0: 2034 293a 0a20 2020 2020 2020 2020 2020   4):.           
+0000e0c0: 2074 696c 6564 622e 5646 5328 292e 7265   tiledb.VFS().re
+0000e0d0: 6d6f 7665 5f66 696c 6528 6f73 2e70 6174  move_file(os.pat
+0000e0e0: 682e 6a6f 696e 2875 7269 2c20 225f 5f61  h.join(uri, "__a
+0000e0f0: 7272 6179 5f73 6368 656d 612e 7464 6222  rray_schema.tdb"
+0000e100: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
+0000e110: 0a20 2020 2020 2020 2020 2020 2074 696c  .            til
+0000e120: 6564 622e 5646 5328 292e 7265 6d6f 7665  edb.VFS().remove
+0000e130: 5f64 6972 286f 732e 7061 7468 2e6a 6f69  _dir(os.path.joi
+0000e140: 6e28 7572 692c 2022 5f5f 7363 6865 6d61  n(uri, "__schema
+0000e150: 2229 290a 0a20 2020 2020 2020 2023 206e  "))..        # n
+0000e160: 6577 2063 7478 2069 7320 7265 7175 6972  ew ctx is requir
+0000e170: 6564 2072 756e 6e69 6e67 2061 6761 696e  ed running again
+0000e180: 7374 2053 3320 6265 6361 7573 6520 6f74  st S3 because ot
+0000e190: 6865 7277 6973 6520 7468 6520 7363 6865  herwise the sche
+0000e1a0: 6d61 0a20 2020 2020 2020 2023 2077 696c  ma.        # wil
+0000e1b0: 6c20 7369 6d70 6c79 2062 6520 7265 6164  l simply be read
+0000e1c0: 2066 726f 6d20 7468 6520 6361 6368 652e   from the cache.
+0000e1d0: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
+0000e1e0: 6c65 6462 2e73 636f 7065 5f63 7478 2829  ledb.scope_ctx()
+0000e1f0: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
+0000e200: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+0000e210: 6973 6573 2874 696c 6564 622e 5469 6c65  ises(tiledb.Tile
+0000e220: 4442 4572 726f 7229 3a0a 2020 2020 2020  DBError):.      
+0000e230: 2020 2020 2020 2020 2020 7469 6c65 6462            tiledb
+0000e240: 2e44 656e 7365 4172 7261 7928 7572 6929  .DenseArray(uri)
+0000e250: 0a0a 2020 2020 6465 6620 7465 7374 5f73  ..    def test_s
+0000e260: 7061 7273 655f 7772 6974 655f 746f 5f64  parse_write_to_d
+0000e270: 656e 7365 2873 656c 6629 3a0a 2020 2020  ense(self):.    
+0000e280: 2020 2020 636c 6173 7320 4173 7369 676e      class Assign
+0000e290: 416e 6443 6865 636b 3a0a 2020 2020 2020  AndCheck:.      
+0000e2a0: 2020 2020 2020 6465 6620 5f5f 696e 6974        def __init
+0000e2b0: 5f5f 2873 656c 662c 206f 7574 6572 2c20  __(self, outer, 
+0000e2c0: 2a73 6861 7065 293a 0a20 2020 2020 2020  *shape):.       
+0000e2d0: 2020 2020 2020 2020 2073 656c 662e 6f75           self.ou
+0000e2e0: 7465 7220 3d20 6f75 7465 720a 2020 2020  ter = outer.    
+0000e2f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000e300: 2e73 6861 7065 203d 2073 6861 7065 0a0a  .shape = shape..
+0000e310: 2020 2020 2020 2020 2020 2020 6465 6620              def 
+0000e320: 5f5f 7365 7469 7465 6d5f 5f28 7365 6c66  __setitem__(self
+0000e330: 2c20 732c 2076 293a 0a20 2020 2020 2020  , s, v):.       
+0000e340: 2020 2020 2020 2020 2041 203d 206e 702e           A = np.
+0000e350: 7261 6e64 6f6d 2e72 616e 6428 2a73 656c  random.rand(*sel
+0000e360: 662e 7368 6170 6529 0a0a 2020 2020 2020  f.shape)..      
+0000e370: 2020 2020 2020 2020 2020 7572 6920 3d20            uri = 
+0000e380: 7365 6c66 2e6f 7574 6572 2e70 6174 6828  self.outer.path(
 0000e390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e3a0: 2022 6722 2c0a 2020 2020 2020 2020 2020   "g",.          
-0000e3b0: 2020 2020 2020 2268 6868 6868 6868 6868        "hhhhhhhhh
-0000e3c0: 6822 2c0a 2020 2020 2020 2020 2020 2020  h",.            
-0000e3d0: 5d2c 0a20 2020 2020 2020 2020 2020 2064  ],.            d
-0000e3e0: 7479 7065 3d62 7974 6573 2c0a 2020 2020  type=bytes,.    
-0000e3f0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
-0000e400: 2062 6173 6963 2077 7269 7465 0a20 2020   basic write.   
-0000e410: 2020 2020 2064 6f6d 203d 2074 696c 6564       dom = tiled
-0000e420: 622e 446f 6d61 696e 2874 696c 6564 622e  b.Domain(tiledb.
-0000e430: 4469 6d28 646f 6d61 696e 3d28 312c 206c  Dim(domain=(1, l
-0000e440: 656e 2841 2929 2c20 7469 6c65 3d6c 656e  en(A)), tile=len
-0000e450: 2841 2929 290a 2020 2020 2020 2020 6174  (A))).        at
-0000e460: 7420 3d20 7469 6c65 6462 2e41 7474 7228  t = tiledb.Attr(
-0000e470: 6474 7970 653d 6e70 2e62 7974 6573 5f29  dtype=np.bytes_)
-0000e480: 0a0a 2020 2020 2020 2020 7363 6865 6d61  ..        schema
-0000e490: 203d 2074 696c 6564 622e 4172 7261 7953   = tiledb.ArrayS
-0000e4a0: 6368 656d 6128 646f 6d2c 2028 6174 742c  chema(dom, (att,
-0000e4b0: 2929 0a0a 2020 2020 2020 2020 7469 6c65  ))..        tile
-0000e4c0: 6462 2e44 656e 7365 4172 7261 792e 6372  db.DenseArray.cr
-0000e4d0: 6561 7465 2873 656c 662e 7061 7468 2822  eate(self.path("
-0000e4e0: 666f 6f22 292c 2073 6368 656d 6129 0a20  foo"), schema). 
-0000e4f0: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
-0000e500: 6462 2e44 656e 7365 4172 7261 7928 7365  db.DenseArray(se
-0000e510: 6c66 2e70 6174 6828 2266 6f6f 2229 2c20  lf.path("foo"), 
-0000e520: 6d6f 6465 3d22 7722 2920 6173 2054 3a0a  mode="w") as T:.
-0000e530: 2020 2020 2020 2020 2020 2020 545b 3a5d              T[:]
-0000e540: 203d 2041 0a0a 2020 2020 2020 2020 7769   = A..        wi
-0000e550: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
-0000e560: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
-0000e570: 666f 6f22 292c 206d 6f64 653d 2272 2229  foo"), mode="r")
-0000e580: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
-0000e590: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
-0000e5a0: 6571 7561 6c28 415b 3a5d 2c20 545b 3a5d  equal(A[:], T[:]
-0000e5b0: 290a 0a20 2020 2020 2020 2020 2020 2061  )..            a
-0000e5c0: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
-0000e5d0: 6c28 412c 2054 2e6d 756c 7469 5f69 6e64  l(A, T.multi_ind
-0000e5e0: 6578 5b31 203a 206c 656e 2841 295d 5b22  ex[1 : len(A)]["
-0000e5f0: 225d 290a 0a20 2020 2064 6566 2074 6573  "])..    def tes
-0000e600: 745f 7661 726c 656e 5f73 7061 7273 655f  t_varlen_sparse_
-0000e610: 616c 6c5f 656d 7074 795f 7374 7269 6e67  all_empty_string
-0000e620: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-0000e630: 2023 2074 6869 7320 7465 7374 2061 6464   # this test add
-0000e640: 7265 7373 6573 2061 2066 6978 2066 6f72  resses a fix for
-0000e650: 2073 7065 6369 6669 6320 6e65 6564 2066   specific need f
-0000e660: 6f72 2072 6561 6473 206f 6e20 610a 2020  or reads on a.  
-0000e670: 2020 2020 2020 2320 6c61 7267 6520 6578        # large ex
-0000e680: 6973 7469 6e67 2061 7272 6179 2c20 7365  isting array, se
-0000e690: 650a 2020 2020 2020 2020 2320 2020 6874  e.        #   ht
-0000e6a0: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
-0000e6b0: 2f54 696c 6544 422d 496e 632f 5469 6c65  /TileDB-Inc/Tile
-0000e6c0: 4442 2d50 792f 7075 6c6c 2f34 3735 0a20  DB-Py/pull/475. 
-0000e6d0: 2020 2020 2020 2023 2077 6520 6375 7272         # we curr
-0000e6e0: 656e 746c 7920 6861 7665 2074 6f20 7772  ently have to wr
-0000e6f0: 6974 6520 6120 706c 6163 6568 6f6c 6465  ite a placeholde
-0000e700: 7220 6174 2074 6865 2065 6e64 2074 6f0a  r at the end to.
-0000e710: 2020 2020 2020 2020 2320 6176 6f69 6420          # avoid 
-0000e720: 7a65 726f 2d6c 656e 6774 6820 6365 6c6c  zero-length cell
-0000e730: 2065 7272 6f72 0a20 2020 2020 2020 2023   error.        #
-0000e740: 2054 4f44 4f3a 2066 6f6c 6c6f 772d 7570   TODO: follow-up
-0000e750: 2077 6974 6820 696d 7072 6f76 6564 2074   with improved t
-0000e760: 6573 7469 6e67 2066 6f72 2065 6d70 7479  esting for empty
-0000e770: 2076 6172 2d6c 656e 6774 682f 7374 7269   var-length/stri
-0000e780: 6e67 730a 2020 2020 2020 2020 4120 3d20  ngs.        A = 
-0000e790: 6e70 2e61 7272 6179 285b 2222 2c20 2222  np.array(["", ""
-0000e7a0: 2c20 2222 2c20 2222 2c20 2222 2c20 225c  , "", "", "", "\
-0000e7b0: 7830 3022 5d2c 2064 7479 7065 3d6f 626a  x00"], dtype=obj
-0000e7c0: 6563 7429 0a20 2020 2020 2020 2064 696d  ect).        dim
-0000e7d0: 5f6c 656e 203d 206c 656e 2841 290a 2020  _len = len(A).  
-0000e7e0: 2020 2020 2020 7572 6920 3d20 7365 6c66        uri = self
-0000e7f0: 2e70 6174 6828 2276 6172 6c65 6e5f 616c  .path("varlen_al
-0000e800: 6c5f 656d 7074 795f 7374 7269 6e67 7322  l_empty_strings"
-0000e810: 290a 0a20 2020 2020 2020 2064 6f6d 203d  )..        dom =
-0000e820: 2074 696c 6564 622e 446f 6d61 696e 2874   tiledb.Domain(t
-0000e830: 696c 6564 622e 4469 6d28 646f 6d61 696e  iledb.Dim(domain
-0000e840: 3d28 312c 2064 696d 5f6c 656e 292c 2074  =(1, dim_len), t
-0000e850: 696c 653d 6469 6d5f 6c65 6e29 290a 2020  ile=dim_len)).  
-0000e860: 2020 2020 2020 6174 7420 3d20 7469 6c65        att = tile
-0000e870: 6462 2e41 7474 7228 6e61 6d65 3d22 6131  db.Attr(name="a1
-0000e880: 222c 2064 7479 7065 3d6e 702e 7374 725f  ", dtype=np.str_
-0000e890: 2c20 7661 723d 5472 7565 290a 0a20 2020  , var=True)..   
-0000e8a0: 2020 2020 2073 6368 656d 6120 3d20 7469       schema = ti
-0000e8b0: 6c65 6462 2e41 7272 6179 5363 6865 6d61  ledb.ArraySchema
-0000e8c0: 2864 6f6d 2c20 2861 7474 2c29 2c20 7370  (dom, (att,), sp
-0000e8d0: 6172 7365 3d54 7275 6529 0a0a 2020 2020  arse=True)..    
-0000e8e0: 2020 2020 7469 6c65 6462 2e41 7272 6179      tiledb.Array
-0000e8f0: 2e63 7265 6174 6528 7572 692c 2073 6368  .create(uri, sch
-0000e900: 656d 6129 0a0a 2020 2020 2020 2020 7769  ema)..        wi
-0000e910: 7468 2074 696c 6564 622e 6f70 656e 2875  th tiledb.open(u
-0000e920: 7269 2c20 6d6f 6465 3d22 7722 2920 6173  ri, mode="w") as
-0000e930: 2054 3a0a 2020 2020 2020 2020 2020 2020   T:.            
-0000e940: 545b 6e70 2e61 7261 6e67 6528 312c 2064  T[np.arange(1, d
-0000e950: 696d 5f6c 656e 202b 2031 295d 203d 207b  im_len + 1)] = {
-0000e960: 2261 3122 3a20 417d 0a0a 2020 2020 2020  "a1": A}..      
-0000e970: 2020 7769 7468 2074 696c 6564 622e 6f70    with tiledb.op
-0000e980: 656e 2875 7269 2c20 6d6f 6465 3d22 7222  en(uri, mode="r"
-0000e990: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
-0000e9a0: 2020 2020 2320 6368 6563 6b20 696e 7465      # check inte
-0000e9b0: 7269 6f72 2072 616e 6765 0a20 2020 2020  rior range.     
-0000e9c0: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-0000e9d0: 7261 795f 6571 7561 6c28 415b 313a 2d31  ray_equal(A[1:-1
-0000e9e0: 5d2c 2054 5b32 3a2d 315d 5b22 6131 225d  ], T[2:-1]["a1"]
-0000e9f0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-0000ea00: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
-0000ea10: 2841 5b31 3a2d 315d 2c20 542e 6d75 6c74  (A[1:-1], T.mult
-0000ea20: 695f 696e 6465 785b 3220 3a20 6469 6d5f  i_index[2 : dim_
-0000ea30: 6c65 6e20 2d20 315d 5b22 6131 225d 290a  len - 1]["a1"]).
-0000ea40: 0a20 2020 2064 6566 2074 6573 745f 7661  .    def test_va
-0000ea50: 726c 656e 5f77 7269 7465 5f75 6e69 636f  rlen_write_unico
-0000ea60: 6465 2873 656c 6629 3a0a 2020 2020 2020  de(self):.      
-0000ea70: 2020 4120 3d20 6e70 2e61 7272 6179 280a    A = np.array(.
-0000ea80: 2020 2020 2020 2020 2020 2020 5b0a 2020              [.  
-0000ea90: 2020 2020 2020 2020 2020 2020 2020 2261                "a
-0000eaa0: 6122 2c0a 2020 2020 2020 2020 2020 2020  a",.            
-0000eab0: 2020 2020 2262 6262 222c 0a20 2020 2020      "bbb",.     
-0000eac0: 2020 2020 2020 2020 2020 2022 6363 6363             "cccc
-0000ead0: 6322 2c0a 2020 2020 2020 2020 2020 2020  c",.            
-0000eae0: 2020 2020 2264 6464 6464 6464 6464 6464      "ddddddddddd
-0000eaf0: 6464 6464 6464 6464 6464 222c 0a20 2020  dddddddddd",.   
-0000eb00: 2020 2020 2020 2020 2020 2020 2022 6565               "ee
-0000eb10: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000eb20: 2020 2022 6666 6666 6666 222c 0a20 2020     "ffffff",.   
-0000eb30: 2020 2020 2020 2020 2020 2020 2022 6722               "g"
-0000eb40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000eb50: 2020 2222 2c0a 2020 2020 2020 2020 2020    "",.          
-0000eb60: 2020 2020 2020 2268 6868 6868 6868 6868        "hhhhhhhhh
-0000eb70: 6822 2c0a 2020 2020 2020 2020 2020 2020  h",.            
-0000eb80: 5d2c 0a20 2020 2020 2020 2020 2020 2064  ],.            d
-0000eb90: 7479 7065 3d6e 702e 756e 6963 6f64 655f  type=np.unicode_
-0000eba0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0000ebb0: 2020 2020 2023 2062 6173 6963 2077 7269       # basic wri
-0000ebc0: 7465 0a20 2020 2020 2020 2064 6f6d 203d  te.        dom =
-0000ebd0: 2074 696c 6564 622e 446f 6d61 696e 2874   tiledb.Domain(t
-0000ebe0: 696c 6564 622e 4469 6d28 646f 6d61 696e  iledb.Dim(domain
-0000ebf0: 3d28 312c 206c 656e 2841 2929 2c20 7469  =(1, len(A)), ti
-0000ec00: 6c65 3d6c 656e 2841 2929 290a 2020 2020  le=len(A))).    
-0000ec10: 2020 2020 6174 7420 3d20 7469 6c65 6462      att = tiledb
-0000ec20: 2e41 7474 7228 6474 7970 653d 6e70 2e75  .Attr(dtype=np.u
-0000ec30: 6e69 636f 6465 5f2c 2076 6172 3d54 7275  nicode_, var=Tru
-0000ec40: 6529 0a0a 2020 2020 2020 2020 7363 6865  e)..        sche
-0000ec50: 6d61 203d 2074 696c 6564 622e 4172 7261  ma = tiledb.Arra
-0000ec60: 7953 6368 656d 6128 646f 6d2c 2028 6174  ySchema(dom, (at
-0000ec70: 742c 2929 0a0a 2020 2020 2020 2020 7469  t,))..        ti
-0000ec80: 6c65 6462 2e44 656e 7365 4172 7261 792e  ledb.DenseArray.
-0000ec90: 6372 6561 7465 2873 656c 662e 7061 7468  create(self.path
-0000eca0: 2822 666f 6f22 292c 2073 6368 656d 6129  ("foo"), schema)
-0000ecb0: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
-0000ecc0: 6c65 6462 2e44 656e 7365 4172 7261 7928  ledb.DenseArray(
-0000ecd0: 7365 6c66 2e70 6174 6828 2266 6f6f 2229  self.path("foo")
-0000ece0: 2c20 6d6f 6465 3d22 7722 2920 6173 2054  , mode="w") as T
-0000ecf0: 3a0a 2020 2020 2020 2020 2020 2020 545b  :.            T[
-0000ed00: 3a5d 203d 2041 0a0a 2020 2020 2020 2020  :] = A..        
-0000ed10: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
-0000ed20: 6541 7272 6179 2873 656c 662e 7061 7468  eArray(self.path
-0000ed30: 2822 666f 6f22 292c 206d 6f64 653d 2272  ("foo"), mode="r
-0000ed40: 2229 2061 7320 543a 0a20 2020 2020 2020  ") as T:.       
-0000ed50: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-0000ed60: 795f 6571 7561 6c28 415b 3a5d 2c20 545b  y_equal(A[:], T[
-0000ed70: 3a5d 290a 0a20 2020 2064 6566 2074 6573  :])..    def tes
-0000ed80: 745f 7661 726c 656e 5f77 7269 7465 5f66  t_varlen_write_f
-0000ed90: 6c6f 6174 7328 7365 6c66 293a 0a20 2020  loats(self):.   
-0000eda0: 2020 2020 2023 2047 656e 6572 6174 6573       # Generates
-0000edb0: 2038 2076 6172 6961 626c 652d 6c65 6e67   8 variable-leng
-0000edc0: 7468 2066 6c6f 6174 3634 2073 7562 6172  th float64 subar
-0000edd0: 7261 7973 2028 7375 6261 7272 6179 206c  rays (subarray l
-0000ede0: 656e 2061 6e64 2063 6f6e 7465 6e74 2061  en and content a
-0000edf0: 7265 2072 616e 646f 6d69 7a65 6429 0a20  re randomized). 
-0000ee00: 2020 2020 2020 2041 203d 206e 702e 6172         A = np.ar
-0000ee10: 7261 7928 0a20 2020 2020 2020 2020 2020  ray(.           
-0000ee20: 205b 6e70 2e72 616e 646f 6d2e 7261 6e64   [np.random.rand
-0000ee30: 2878 2920 666f 7220 7820 696e 206e 702e  (x) for x in np.
-0000ee40: 7261 6e64 6f6d 2e72 616e 6469 6e74 2831  random.randint(1
-0000ee50: 2c20 3132 2c20 3829 5d2c 2064 7479 7065  , 12, 8)], dtype
-0000ee60: 3d6f 626a 6563 740a 2020 2020 2020 2020  =object.        
-0000ee70: 290a 0a20 2020 2020 2020 2023 2062 6173  )..        # bas
-0000ee80: 6963 2077 7269 7465 0a20 2020 2020 2020  ic write.       
-0000ee90: 2064 6f6d 203d 2074 696c 6564 622e 446f   dom = tiledb.Do
-0000eea0: 6d61 696e 2874 696c 6564 622e 4469 6d28  main(tiledb.Dim(
-0000eeb0: 646f 6d61 696e 3d28 312c 206c 656e 2841  domain=(1, len(A
-0000eec0: 2929 2c20 7469 6c65 3d6c 656e 2841 2929  )), tile=len(A))
-0000eed0: 290a 2020 2020 2020 2020 6174 7420 3d20  ).        att = 
-0000eee0: 7469 6c65 6462 2e41 7474 7228 6474 7970  tiledb.Attr(dtyp
-0000eef0: 653d 6e70 2e66 6c6f 6174 3634 2c20 7661  e=np.float64, va
-0000ef00: 723d 5472 7565 290a 0a20 2020 2020 2020  r=True)..       
-0000ef10: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
-0000ef20: 2e41 7272 6179 5363 6865 6d61 2864 6f6d  .ArraySchema(dom
-0000ef30: 2c20 2861 7474 2c29 290a 2020 2020 2020  , (att,)).      
-0000ef40: 2020 7469 6c65 6462 2e44 656e 7365 4172    tiledb.DenseAr
-0000ef50: 7261 792e 6372 6561 7465 2873 656c 662e  ray.create(self.
-0000ef60: 7061 7468 2822 666f 6f22 292c 2073 6368  path("foo"), sch
-0000ef70: 656d 6129 0a0a 2020 2020 2020 2020 7769  ema)..        wi
-0000ef80: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
-0000ef90: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
-0000efa0: 666f 6f22 292c 206d 6f64 653d 2277 2229  foo"), mode="w")
-0000efb0: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
-0000efc0: 2020 2054 5b3a 5d20 3d20 410a 0a20 2020     T[:] = A..   
-0000efd0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-0000efe0: 2e44 656e 7365 4172 7261 7928 7365 6c66  .DenseArray(self
-0000eff0: 2e70 6174 6828 2266 6f6f 2229 2c20 6d6f  .path("foo"), mo
-0000f000: 6465 3d22 7222 2920 6173 2054 3a0a 2020  de="r") as T:.  
-0000f010: 2020 2020 2020 2020 2020 545f 203d 2054            T_ = T
-0000f020: 5b3a 5d0a 2020 2020 2020 2020 2020 2020  [:].            
-0000f030: 2320 544f 444f 2f6e 6f74 653a 2074 6865  # TODO/note: the
-0000f040: 2072 6574 7572 6e20 6973 2061 2030 2d65   return is a 0-e
-0000f050: 6c65 6d65 6e74 2061 7272 6179 2e0a 2020  lement array..  
-0000f060: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-0000f070: 5f61 7272 6179 5f65 7175 616c 2841 5b30  _array_equal(A[0
-0000f080: 5d2c 2054 5b31 5d5b 2829 5d29 0a20 2020  ], T[1][()]).   
-0000f090: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-0000f0a0: 6172 7261 795f 6571 7561 6c28 415b 2d31  array_equal(A[-1
-0000f0b0: 5d2c 2054 5b2d 315d 5b28 295d 290a 2020  ], T[-1][()]).  
-0000f0c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000f0d0: 7373 6572 7445 7175 616c 286c 656e 2841  ssertEqual(len(A
-0000f0e0: 292c 206c 656e 2854 5f29 290a 2020 2020  ), len(T_)).    
-0000f0f0: 2020 2020 2020 2020 2320 6361 6e27 7420          # can't 
-0000f100: 7573 6520 6173 7365 7274 5f61 7272 6179  use assert_array
-0000f110: 5f65 7175 616c 2077 2f20 6f62 6a65 6374  _equal w/ object
-0000f120: 2061 7272 6179 0a20 2020 2020 2020 2020   array.         
-0000f130: 2020 2073 656c 662e 6173 7365 7274 5472     self.assertTr
-0000f140: 7565 2861 6c6c 286e 702e 6172 7261 795f  ue(all(np.array_
-0000f150: 6571 7561 6c28 782c 2041 5b69 5d29 2066  equal(x, A[i]) f
-0000f160: 6f72 2069 2c20 7820 696e 2065 6e75 6d65  or i, x in enume
-0000f170: 7261 7465 2854 5f29 2929 0a0a 2020 2020  rate(T_)))..    
-0000f180: 6465 6620 7465 7374 5f76 6172 6c65 6e5f  def test_varlen_
-0000f190: 7772 6974 655f 666c 6f61 7473 5f32 6428  write_floats_2d(
-0000f1a0: 7365 6c66 293a 0a20 2020 2020 2020 2041  self):.        A
-0000f1b0: 203d 206e 702e 6172 7261 7928 0a20 2020   = np.array(.   
-0000f1c0: 2020 2020 2020 2020 205b 6e70 2e72 616e           [np.ran
-0000f1d0: 646f 6d2e 7261 6e64 2878 2920 666f 7220  dom.rand(x) for 
-0000f1e0: 7820 696e 206e 702e 6172 616e 6765 2831  x in np.arange(1
-0000f1f0: 2c20 3130 295d 2c20 6474 7970 653d 6f62  , 10)], dtype=ob
-0000f200: 6a65 6374 0a20 2020 2020 2020 2029 2e72  ject.        ).r
-0000f210: 6573 6861 7065 2833 2c20 3329 0a0a 2020  eshape(3, 3)..  
-0000f220: 2020 2020 2020 2320 6261 7369 6320 7772        # basic wr
-0000f230: 6974 650a 2020 2020 2020 2020 646f 6d20  ite.        dom 
-0000f240: 3d20 7469 6c65 6462 2e44 6f6d 6169 6e28  = tiledb.Domain(
-0000f250: 0a20 2020 2020 2020 2020 2020 2074 696c  .            til
-0000f260: 6564 622e 4469 6d28 646f 6d61 696e 3d28  edb.Dim(domain=(
-0000f270: 312c 2033 292c 2074 696c 653d 6c65 6e28  1, 3), tile=len(
-0000f280: 4129 292c 0a20 2020 2020 2020 2020 2020  A)),.           
-0000f290: 2074 696c 6564 622e 4469 6d28 646f 6d61   tiledb.Dim(doma
-0000f2a0: 696e 3d28 312c 2033 292c 2074 696c 653d  in=(1, 3), tile=
-0000f2b0: 6c65 6e28 4129 292c 0a20 2020 2020 2020  len(A)),.       
-0000f2c0: 2029 0a20 2020 2020 2020 2061 7474 203d   ).        att =
-0000f2d0: 2074 696c 6564 622e 4174 7472 2864 7479   tiledb.Attr(dty
-0000f2e0: 7065 3d6e 702e 666c 6f61 7436 342c 2076  pe=np.float64, v
-0000f2f0: 6172 3d54 7275 6529 0a0a 2020 2020 2020  ar=True)..      
-0000f300: 2020 7363 6865 6d61 203d 2074 696c 6564    schema = tiled
-0000f310: 622e 4172 7261 7953 6368 656d 6128 646f  b.ArraySchema(do
-0000f320: 6d2c 2028 6174 742c 2929 0a20 2020 2020  m, (att,)).     
-0000f330: 2020 2074 696c 6564 622e 4465 6e73 6541     tiledb.DenseA
-0000f340: 7272 6179 2e63 7265 6174 6528 7365 6c66  rray.create(self
-0000f350: 2e70 6174 6828 2266 6f6f 2229 2c20 7363  .path("foo"), sc
-0000f360: 6865 6d61 290a 0a20 2020 2020 2020 2077  hema)..        w
-0000f370: 6974 6820 7469 6c65 6462 2e44 656e 7365  ith tiledb.Dense
-0000f380: 4172 7261 7928 7365 6c66 2e70 6174 6828  Array(self.path(
-0000f390: 2266 6f6f 2229 2c20 6d6f 6465 3d22 7722  "foo"), mode="w"
-0000f3a0: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
-0000f3b0: 2020 2020 545b 3a5d 203d 2041 0a0a 2020      T[:] = A..  
-0000f3c0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-0000f3d0: 622e 4465 6e73 6541 7272 6179 2873 656c  b.DenseArray(sel
-0000f3e0: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
-0000f3f0: 6f64 653d 2272 2229 2061 7320 543a 0a20  ode="r") as T:. 
-0000f400: 2020 2020 2020 2020 2020 2054 5f20 3d20             T_ = 
-0000f410: 545b 3a5d 0a20 2020 2020 2020 2020 2020  T[:].           
-0000f420: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-0000f430: 6c28 6c65 6e28 4129 2c20 6c65 6e28 545f  l(len(A), len(T_
-0000f440: 2929 0a20 2020 2020 2020 2020 2020 2023  )).            #
-0000f450: 2063 616e 2774 2075 7365 2061 7373 6572   can't use asser
-0000f460: 745f 6172 7261 795f 6571 7561 6c20 772f  t_array_equal w/
-0000f470: 206f 626a 6563 7420 6172 7261 790a 2020   object array.  
-0000f480: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000f490: 7373 6572 7454 7275 6528 0a20 2020 2020  ssertTrue(.     
-0000f4a0: 2020 2020 2020 2020 2020 206e 702e 616c             np.al
-0000f4b0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-0000f4c0: 2020 2020 2020 205b 6e70 2e61 7272 6179         [np.array
-0000f4d0: 5f65 7175 616c 2841 2e66 6c61 745b 695d  _equal(A.flat[i]
-0000f4e0: 2c20 545b 3a5d 2e66 6c61 745b 695d 2920  , T[:].flat[i]) 
-0000f4f0: 666f 7220 6920 696e 206e 702e 6172 616e  for i in np.aran
-0000f500: 6765 2830 2c20 3929 5d0a 2020 2020 2020  ge(0, 9)].      
-0000f510: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000f520: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-0000f530: 6566 2074 6573 745f 7661 726c 656e 5f77  ef test_varlen_w
-0000f540: 7269 7465 5f69 6e74 5f73 7562 6172 7261  rite_int_subarra
-0000f550: 7928 7365 6c66 293a 0a20 2020 2020 2020  y(self):.       
-0000f560: 2041 203d 206e 702e 6172 7261 7928 0a20   A = np.array(. 
-0000f570: 2020 2020 2020 2020 2020 206c 6973 7428             list(
-0000f580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f590: 206d 6170 280a 2020 2020 2020 2020 2020   map(.          
-0000f5a0: 2020 2020 2020 2020 2020 6c61 6d62 6461            lambda
-0000f5b0: 2078 3a20 6e70 2e61 7272 6179 2878 2c20   x: np.array(x, 
-0000f5c0: 6474 7970 653d 6e70 2e75 696e 7436 3429  dtype=np.uint64)
-0000f5d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f5e0: 2020 2020 2020 5b6e 702e 6172 616e 6765        [np.arange
-0000f5f0: 2869 2c20 3220 2a20 6920 2b20 3129 2066  (i, 2 * i + 1) f
-0000f600: 6f72 2069 2069 6e20 6e70 2e61 7261 6e67  or i in np.arang
-0000f610: 6528 302c 2031 3629 5d2c 0a20 2020 2020  e(0, 16)],.     
-0000f620: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000f630: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
-0000f640: 2020 2020 2020 2020 6474 7970 653d 224f          dtype="O
-0000f650: 222c 0a20 2020 2020 2020 2029 2e72 6573  ",.        ).res
-0000f660: 6861 7065 2834 2c20 3429 0a0a 2020 2020  hape(4, 4)..    
-0000f670: 2020 2020 7572 6920 3d20 7365 6c66 2e70      uri = self.p
-0000f680: 6174 6828 2274 6573 745f 7661 726c 656e  ath("test_varlen
-0000f690: 5f77 7269 7465 5f69 6e74 5f73 7562 6172  _write_int_subar
-0000f6a0: 7261 7922 290a 0a20 2020 2020 2020 2064  ray")..        d
-0000f6b0: 6f6d 203d 2074 696c 6564 622e 446f 6d61  om = tiledb.Doma
-0000f6c0: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
-0000f6d0: 7469 6c65 6462 2e44 696d 2864 6f6d 6169  tiledb.Dim(domai
-0000f6e0: 6e3d 2830 2c20 3329 2c20 7469 6c65 3d6c  n=(0, 3), tile=l
-0000f6f0: 656e 2841 2929 2c0a 2020 2020 2020 2020  en(A)),.        
-0000f700: 2020 2020 7469 6c65 6462 2e44 696d 2864      tiledb.Dim(d
-0000f710: 6f6d 6169 6e3d 2830 2c20 3329 2c20 7469  omain=(0, 3), ti
-0000f720: 6c65 3d6c 656e 2841 2929 2c0a 2020 2020  le=len(A)),.    
-0000f730: 2020 2020 290a 2020 2020 2020 2020 6174      ).        at
-0000f740: 7420 3d20 7469 6c65 6462 2e41 7474 7228  t = tiledb.Attr(
-0000f750: 6474 7970 653d 6e70 2e75 696e 7436 342c  dtype=np.uint64,
-0000f760: 2076 6172 3d54 7275 6529 0a20 2020 2020   var=True).     
-0000f770: 2020 2073 6368 656d 6120 3d20 7469 6c65     schema = tile
-0000f780: 6462 2e41 7272 6179 5363 6865 6d61 2864  db.ArraySchema(d
-0000f790: 6f6d 2c20 2861 7474 2c29 290a 0a20 2020  om, (att,))..   
-0000f7a0: 2020 2020 2074 696c 6564 622e 4465 6e73       tiledb.Dens
-0000f7b0: 6541 7272 6179 2e63 7265 6174 6528 7572  eArray.create(ur
-0000f7c0: 692c 2073 6368 656d 6129 0a0a 2020 2020  i, schema)..    
-0000f7d0: 2020 2020 2320 4e75 6d50 7920 666f 7263      # NumPy forc
-0000f7e0: 6573 2073 696e 676c 652d 656c 656d 656e  es single-elemen
-0000f7f0: 7420 6f62 6a65 6374 2061 7272 6179 7320  t object arrays 
-0000f800: 696e 746f 2061 2063 6f6e 7469 6775 6f75  into a contiguou
-0000f810: 7320 6c61 796f 7574 0a20 2020 2020 2020  s layout.       
-0000f820: 2023 2020 2020 2020 2073 6f20 7765 2061   #       so we a
-0000f830: 6c74 6572 6e61 7465 2074 6865 2073 697a  lternate the siz
-0000f840: 6520 746f 2067 6574 2061 2063 6f6e 7369  e to get a consi
-0000f850: 7374 656e 7420 6261 7365 6c69 6e65 2061  stent baseline a
-0000f860: 7272 6179 2e0a 2020 2020 2020 2020 415f  rray..        A_
-0000f870: 6f6e 6573 7477 6f73 203d 206e 702e 6172  onestwos = np.ar
-0000f880: 7261 7928 0a20 2020 2020 2020 2020 2020  ray(.           
-0000f890: 206c 6973 7428 0a20 2020 2020 2020 2020   list(.         
-0000f8a0: 2020 2020 2020 206d 6170 280a 2020 2020         map(.    
-0000f8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f8c0: 6c61 6d62 6461 2078 3a20 6e70 2e61 7272  lambda x: np.arr
-0000f8d0: 6179 2878 2c20 6474 7970 653d 6e70 2e75  ay(x, dtype=np.u
-0000f8e0: 696e 7436 3429 2c0a 2020 2020 2020 2020  int64),.        
-0000f8f0: 2020 2020 2020 2020 2020 2020 6c69 7374              list
-0000f900: 285b 2831 2c29 2069 6620 7820 2520 3220  ([(1,) if x % 2 
-0000f910: 3d3d 2030 2065 6c73 6520 2831 2c20 3229  == 0 else (1, 2)
-0000f920: 2066 6f72 2078 2069 6e20 7261 6e67 6528   for x in range(
-0000f930: 3136 295d 292c 0a20 2020 2020 2020 2020  16)]),.         
-0000f940: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000f950: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-0000f960: 2020 2020 6474 7970 653d 6e70 2e64 7479      dtype=np.dty
-0000f970: 7065 2822 4f22 292c 0a20 2020 2020 2020  pe("O"),.       
-0000f980: 2029 2e72 6573 6861 7065 2834 2c20 3429   ).reshape(4, 4)
-0000f990: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
-0000f9a0: 696c 6564 622e 6f70 656e 2875 7269 2c20  iledb.open(uri, 
-0000f9b0: 2277 2229 2061 7320 543a 0a20 2020 2020  "w") as T:.     
-0000f9c0: 2020 2020 2020 2054 5b3a 5d20 3d20 415f         T[:] = A_
-0000f9d0: 6f6e 6573 7477 6f73 0a0a 2020 2020 2020  onestwos..      
-0000f9e0: 2020 7769 7468 2074 696c 6564 622e 6f70    with tiledb.op
-0000f9f0: 656e 2875 7269 2c20 2277 2229 2061 7320  en(uri, "w") as 
-0000fa00: 543a 0a20 2020 2020 2020 2020 2020 2054  T:.            T
-0000fa10: 5b31 3a33 2c20 313a 335d 203d 2041 5b31  [1:3, 1:3] = A[1
-0000fa20: 3a33 2c20 313a 335d 0a0a 2020 2020 2020  :3, 1:3]..      
-0000fa30: 2020 415f 6173 7369 676e 6564 203d 2041    A_assigned = A
-0000fa40: 5f6f 6e65 7374 776f 732e 636f 7079 2829  _onestwos.copy()
-0000fa50: 0a20 2020 2020 2020 2041 5f61 7373 6967  .        A_assig
-0000fa60: 6e65 645b 313a 332c 2031 3a33 5d20 3d20  ned[1:3, 1:3] = 
-0000fa70: 415b 313a 332c 2031 3a33 5d0a 0a20 2020  A[1:3, 1:3]..   
-0000fa80: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-0000fa90: 2e6f 7065 6e28 7572 6929 2061 7320 543a  .open(uri) as T:
-0000faa0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-0000fab0: 6572 745f 7375 6261 7272 6179 735f 6571  ert_subarrays_eq
-0000fac0: 7561 6c28 415f 6173 7369 676e 6564 2c20  ual(A_assigned, 
-0000fad0: 545b 3a5d 290a 0a20 2020 2064 6566 2074  T[:])..    def t
-0000fae0: 6573 745f 7661 726c 656e 5f77 7269 7465  est_varlen_write
-0000faf0: 5f66 6978 6564 6279 7465 7328 7365 6c66  _fixedbytes(self
-0000fb00: 293a 0a20 2020 2020 2020 2023 2054 6865  ):.        # The
-0000fb10: 2061 6374 7561 6c20 6474 7970 6520 6f66   actual dtype of
-0000fb20: 2074 6869 7320 6172 7261 7920 6973 2027   this array is '
-0000fb30: 5332 3127 0a20 2020 2020 2020 2041 203d  S21'.        A =
-0000fb40: 206e 702e 6172 7261 7928 0a20 2020 2020   np.array(.     
-0000fb50: 2020 2020 2020 205b 0a20 2020 2020 2020         [.       
-0000fb60: 2020 2020 2020 2020 2022 6161 222c 0a20           "aa",. 
-0000fb70: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000fb80: 6262 6222 2c0a 2020 2020 2020 2020 2020  bbb",.          
-0000fb90: 2020 2020 2020 2263 6363 6363 222c 0a20        "ccccc",. 
-0000fba0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000fbb0: 6464 6464 6464 6464 6464 6464 6464 6464  dddddddddddddddd
-0000fbc0: 6464 6464 6422 2c0a 2020 2020 2020 2020  ddddd",.        
-0000fbd0: 2020 2020 2020 2020 2265 6522 2c0a 2020          "ee",.  
-0000fbe0: 2020 2020 2020 2020 2020 2020 2020 2266                "f
-0000fbf0: 6666 6666 6622 2c0a 2020 2020 2020 2020  fffff",.        
-0000fc00: 2020 2020 2020 2020 2267 222c 0a20 2020          "g",.   
-0000fc10: 2020 2020 2020 2020 2020 2020 2022 6868               "hh
-0000fc20: 6868 6868 6868 6868 222c 0a20 2020 2020  hhhhhhhh",.     
-0000fc30: 2020 2020 2020 205d 2c0a 2020 2020 2020         ],.      
-0000fc40: 2020 2020 2020 6474 7970 653d 6e70 2e64        dtype=np.d
-0000fc50: 7479 7065 2822 5322 292c 0a20 2020 2020  type("S"),.     
-0000fc60: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-0000fc70: 6261 7369 6320 7772 6974 650a 2020 2020  basic write.    
-0000fc80: 2020 2020 646f 6d20 3d20 7469 6c65 6462      dom = tiledb
-0000fc90: 2e44 6f6d 6169 6e28 7469 6c65 6462 2e44  .Domain(tiledb.D
-0000fca0: 696d 2864 6f6d 6169 6e3d 2831 2c20 6c65  im(domain=(1, le
-0000fcb0: 6e28 4129 292c 2074 696c 653d 6c65 6e28  n(A)), tile=len(
-0000fcc0: 4129 2929 0a20 2020 2020 2020 2061 7474  A))).        att
-0000fcd0: 203d 2074 696c 6564 622e 4174 7472 2864   = tiledb.Attr(d
-0000fce0: 7479 7065 3d6e 702e 6279 7465 735f 290a  type=np.bytes_).
-0000fcf0: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
-0000fd00: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
-0000fd10: 6865 6d61 2864 6f6d 2c20 2861 7474 2c29  hema(dom, (att,)
-0000fd20: 290a 0a20 2020 2020 2020 2074 696c 6564  )..        tiled
-0000fd30: 622e 4465 6e73 6541 7272 6179 2e63 7265  b.DenseArray.cre
-0000fd40: 6174 6528 7365 6c66 2e70 6174 6828 2266  ate(self.path("f
-0000fd50: 6f6f 2229 2c20 7363 6865 6d61 290a 2020  oo"), schema).  
-0000fd60: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-0000fd70: 622e 4465 6e73 6541 7272 6179 2873 656c  b.DenseArray(sel
-0000fd80: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
-0000fd90: 6f64 653d 2277 2229 2061 7320 543a 0a20  ode="w") as T:. 
-0000fda0: 2020 2020 2020 2020 2020 2054 5b3a 5d20             T[:] 
-0000fdb0: 3d20 410a 0a20 2020 2020 2020 2077 6974  = A..        wit
-0000fdc0: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
-0000fdd0: 7261 7928 7365 6c66 2e70 6174 6828 2266  ray(self.path("f
-0000fde0: 6f6f 2229 2c20 6d6f 6465 3d22 7222 2920  oo"), mode="r") 
-0000fdf0: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
-0000fe00: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-0000fe10: 7175 616c 2841 5b3a 5d2c 2054 5b3a 5d29  qual(A[:], T[:])
-0000fe20: 0a0a 2020 2020 6465 6620 7465 7374 5f76  ..    def test_v
-0000fe30: 6172 6c65 6e5f 7772 6974 655f 6669 7865  arlen_write_fixe
-0000fe40: 6475 6e69 636f 6465 2873 656c 6629 3a0a  dunicode(self):.
-0000fe50: 2020 2020 2020 2020 4120 3d20 6e70 2e61          A = np.a
-0000fe60: 7272 6179 280a 2020 2020 2020 2020 2020  rray(.          
-0000fe70: 2020 5b0a 2020 2020 2020 2020 2020 2020    [.            
-0000fe80: 2020 2020 2261 6122 2c0a 2020 2020 2020      "aa",.      
-0000fe90: 2020 2020 2020 2020 2020 2262 6262 222c            "bbb",
-0000fea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000feb0: 2022 6363 6363 6322 2c0a 2020 2020 2020   "ccccc",.      
-0000fec0: 2020 2020 2020 2020 2020 2264 6464 6464            "ddddd
-0000fed0: 6464 6464 6464 6464 6464 6464 6464 6464  dddddddddddddddd
-0000fee0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000fef0: 2020 2022 6565 222c 0a20 2020 2020 2020     "ee",.       
-0000ff00: 2020 2020 2020 2020 2022 6666 6666 6666           "ffffff
-0000ff10: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000ff20: 2020 2022 222c 0a20 2020 2020 2020 2020     "",.         
-0000ff30: 2020 2020 2020 2022 6722 2c0a 2020 2020         "g",.    
-0000ff40: 2020 2020 2020 2020 2020 2020 2268 6868              "hhh
-0000ff50: 6868 6868 6868 6822 2c0a 2020 2020 2020  hhhhhhh",.      
-0000ff60: 2020 2020 2020 5d2c 0a20 2020 2020 2020        ],.       
-0000ff70: 2020 2020 2064 7479 7065 3d6e 702e 6474       dtype=np.dt
-0000ff80: 7970 6528 2255 2229 2c0a 2020 2020 2020  ype("U"),.      
-0000ff90: 2020 290a 0a20 2020 2020 2020 2023 2062    )..        # b
-0000ffa0: 6173 6963 2077 7269 7465 0a20 2020 2020  asic write.     
-0000ffb0: 2020 2064 6f6d 203d 2074 696c 6564 622e     dom = tiledb.
-0000ffc0: 446f 6d61 696e 2874 696c 6564 622e 4469  Domain(tiledb.Di
-0000ffd0: 6d28 646f 6d61 696e 3d28 312c 206c 656e  m(domain=(1, len
-0000ffe0: 2841 2929 2c20 7469 6c65 3d6c 656e 2841  (A)), tile=len(A
-0000fff0: 2929 290a 2020 2020 2020 2020 6174 7420  ))).        att 
-00010000: 3d20 7469 6c65 6462 2e41 7474 7228 6474  = tiledb.Attr(dt
-00010010: 7970 653d 6e70 2e75 6e69 636f 6465 5f29  ype=np.unicode_)
-00010020: 0a0a 2020 2020 2020 2020 7363 6865 6d61  ..        schema
-00010030: 203d 2074 696c 6564 622e 4172 7261 7953   = tiledb.ArrayS
-00010040: 6368 656d 6128 646f 6d2c 2028 6174 742c  chema(dom, (att,
-00010050: 2929 0a0a 2020 2020 2020 2020 7469 6c65  ))..        tile
-00010060: 6462 2e44 656e 7365 4172 7261 792e 6372  db.DenseArray.cr
-00010070: 6561 7465 2873 656c 662e 7061 7468 2822  eate(self.path("
-00010080: 666f 6f22 292c 2073 6368 656d 6129 0a20  foo"), schema). 
-00010090: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
-000100a0: 6462 2e44 656e 7365 4172 7261 7928 7365  db.DenseArray(se
-000100b0: 6c66 2e70 6174 6828 2266 6f6f 2229 2c20  lf.path("foo"), 
-000100c0: 6d6f 6465 3d22 7722 2920 6173 2054 3a0a  mode="w") as T:.
-000100d0: 2020 2020 2020 2020 2020 2020 545b 3a5d              T[:]
-000100e0: 203d 2041 0a0a 2020 2020 2020 2020 7769   = A..        wi
-000100f0: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
-00010100: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
-00010110: 666f 6f22 292c 206d 6f64 653d 2272 2229  foo"), mode="r")
-00010120: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
-00010130: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
-00010140: 6571 7561 6c28 415b 3a5d 2c20 545b 3a5d  equal(A[:], T[:]
-00010150: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-00010160: 7661 726c 656e 5f77 7269 7465 5f69 6e74  varlen_write_int
-00010170: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-00010180: 2041 203d 206e 702e 6172 7261 7928 0a20   A = np.array(. 
-00010190: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
-000101a0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
-000101b0: 7569 6e74 3634 286e 702e 7261 6e64 6f6d  uint64(np.random
-000101c0: 2e72 616e 6469 6e74 2830 2c20 706f 7728  .randint(0, pow(
-000101d0: 3130 2c20 3629 2c20 7829 290a 2020 2020  10, 6), x)).    
-000101e0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000101f0: 7820 696e 206e 702e 7261 6e64 6f6d 2e72  x in np.random.r
-00010200: 616e 6469 6e74 2831 2c20 3132 2c20 3829  andint(1, 12, 8)
-00010210: 0a20 2020 2020 2020 2020 2020 205d 2c0a  .            ],.
-00010220: 2020 2020 2020 2020 2020 2020 6474 7970              dtyp
-00010230: 653d 6f62 6a65 6374 2c0a 2020 2020 2020  e=object,.      
-00010240: 2020 290a 0a20 2020 2020 2020 2023 2062    )..        # b
-00010250: 6173 6963 2077 7269 7465 0a20 2020 2020  asic write.     
-00010260: 2020 2064 6f6d 203d 2074 696c 6564 622e     dom = tiledb.
-00010270: 446f 6d61 696e 2874 696c 6564 622e 4469  Domain(tiledb.Di
-00010280: 6d28 646f 6d61 696e 3d28 312c 206c 656e  m(domain=(1, len
-00010290: 2841 2929 2c20 7469 6c65 3d6c 656e 2841  (A)), tile=len(A
-000102a0: 2929 290a 2020 2020 2020 2020 6174 7420  ))).        att 
-000102b0: 3d20 7469 6c65 6462 2e41 7474 7228 6474  = tiledb.Attr(dt
-000102c0: 7970 653d 6e70 2e69 6e74 3634 2c20 7661  ype=np.int64, va
-000102d0: 723d 5472 7565 290a 0a20 2020 2020 2020  r=True)..       
-000102e0: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
-000102f0: 2e41 7272 6179 5363 6865 6d61 2864 6f6d  .ArraySchema(dom
-00010300: 2c20 2861 7474 2c29 290a 0a20 2020 2020  , (att,))..     
-00010310: 2020 2074 696c 6564 622e 4465 6e73 6541     tiledb.DenseA
-00010320: 7272 6179 2e63 7265 6174 6528 7365 6c66  rray.create(self
-00010330: 2e70 6174 6828 2266 6f6f 2229 2c20 7363  .path("foo"), sc
-00010340: 6865 6d61 290a 2020 2020 2020 2020 7769  hema).        wi
-00010350: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
-00010360: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
-00010370: 666f 6f22 292c 206d 6f64 653d 2277 2229  foo"), mode="w")
-00010380: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
-00010390: 2020 2054 5b3a 5d20 3d20 410a 0a20 2020     T[:] = A..   
-000103a0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-000103b0: 2e44 656e 7365 4172 7261 7928 7365 6c66  .DenseArray(self
-000103c0: 2e70 6174 6828 2266 6f6f 2229 2c20 6d6f  .path("foo"), mo
-000103d0: 6465 3d22 7222 2920 6173 2054 3a0a 2020  de="r") as T:.  
-000103e0: 2020 2020 2020 2020 2020 545f 203d 2054            T_ = T
-000103f0: 5b3a 5d0a 2020 2020 2020 2020 2020 2020  [:].            
-00010400: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00010410: 286c 656e 2841 292c 206c 656e 2854 2929  (len(A), len(T))
-00010420: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-00010430: 616e 2774 2075 7365 2061 7373 6572 745f  an't use assert_
-00010440: 6172 7261 795f 6571 7561 6c20 772f 206f  array_equal w/ o
-00010450: 626a 6563 7420 6172 7261 790a 2020 2020  bject array.    
-00010460: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00010470: 6572 7454 7275 6528 616c 6c28 6e70 2e61  ertTrue(all(np.a
-00010480: 7272 6179 5f65 7175 616c 2878 2c20 415b  rray_equal(x, A[
-00010490: 695d 2920 666f 7220 692c 2078 2069 6e20  i]) for i, x in 
-000104a0: 656e 756d 6572 6174 6528 545f 2929 290a  enumerate(T_))).
-000104b0: 0a20 2020 2064 6566 2074 6573 745f 7661  .    def test_va
-000104c0: 726c 656e 5f77 726f 6e67 5f64 6f6d 6169  rlen_wrong_domai
-000104d0: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
-000104e0: 2041 203d 206e 702e 6172 7261 7928 0a20   A = np.array(. 
-000104f0: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
-00010500: 2020 2020 2020 2020 2020 2020 2022 6161               "aa
-00010510: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00010520: 2020 2022 6262 6222 2c0a 2020 2020 2020     "bbb",.      
-00010530: 2020 2020 2020 2020 2020 2263 6363 6363            "ccccc
-00010540: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00010550: 2020 2022 6464 6464 6464 6464 6464 6464     "dddddddddddd
-00010560: 6464 6464 6464 6464 6422 2c0a 2020 2020  ddddddddd",.    
-00010570: 2020 2020 2020 2020 2020 2020 2265 6522              "ee"
-00010580: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010590: 2020 2266 6666 6666 6622 2c0a 2020 2020    "ffffff",.    
-000105a0: 2020 2020 2020 2020 2020 2020 2267 222c              "g",
-000105b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000105c0: 2022 6868 6868 6868 6868 6868 222c 0a20   "hhhhhhhhhh",. 
-000105d0: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-000105e0: 2020 2020 2029 0a20 2020 2020 2020 2064       ).        d
-000105f0: 6f6d 203d 2074 696c 6564 622e 446f 6d61  om = tiledb.Doma
-00010600: 696e 2874 696c 6564 622e 4469 6d28 646f  in(tiledb.Dim(do
-00010610: 6d61 696e 3d28 312c 2033 292c 2074 696c  main=(1, 3), til
-00010620: 653d 3329 290a 2020 2020 2020 2020 6174  e=3)).        at
-00010630: 7420 3d20 7469 6c65 6462 2e41 7474 7228  t = tiledb.Attr(
-00010640: 6474 7970 653d 6e70 2e62 7974 6573 5f29  dtype=np.bytes_)
-00010650: 0a0a 2020 2020 2020 2020 7363 6865 6d61  ..        schema
-00010660: 203d 2074 696c 6564 622e 4172 7261 7953   = tiledb.ArrayS
-00010670: 6368 656d 6128 646f 6d2c 2028 6174 742c  chema(dom, (att,
-00010680: 2929 0a0a 2020 2020 2020 2020 7469 6c65  ))..        tile
-00010690: 6462 2e44 656e 7365 4172 7261 792e 6372  db.DenseArray.cr
-000106a0: 6561 7465 2873 656c 662e 7061 7468 2822  eate(self.path("
-000106b0: 666f 6f22 292c 2073 6368 656d 6129 0a20  foo"), schema). 
-000106c0: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
-000106d0: 6462 2e44 656e 7365 4172 7261 7928 7365  db.DenseArray(se
-000106e0: 6c66 2e70 6174 6828 2266 6f6f 2229 2c20  lf.path("foo"), 
-000106f0: 6d6f 6465 3d22 7722 2920 6173 2054 3a0a  mode="w") as T:.
-00010700: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00010710: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-00010720: 6573 2874 696c 6564 622e 5469 6c65 4442  es(tiledb.TileDB
-00010730: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-00010740: 2020 2020 2020 2020 545b 3a5d 203d 2041          T[:] = A
-00010750: 0a0a 2020 2020 6465 6620 7465 7374 5f61  ..    def test_a
-00010760: 7272 6179 5f76 6172 6c65 6e5f 6d69 736d  rray_varlen_mism
-00010770: 6174 6368 6564 2873 656c 6629 3a0a 2020  atched(self):.  
-00010780: 2020 2020 2020 2320 5465 7374 2074 6861        # Test tha
-00010790: 7420 7765 2072 6169 7365 2061 2054 7970  t we raise a Typ
-000107a0: 6545 7272 6f72 2077 6865 6e20 7061 7373  eError when pass
-000107b0: 696e 6720 6120 6865 7465 726f 6765 6e65  ing a heterogene
-000107c0: 6f75 7320 6f62 6a65 6374 2061 7272 6179  ous object array
-000107d0: 2e0a 2020 2020 2020 2020 4120 3d20 6e70  ..        A = np
-000107e0: 2e61 7272 6179 285b 6222 6161 222c 2062  .array([b"aa", b
-000107f0: 2262 6262 222c 2062 2263 6363 6322 2c20  "bbb", b"cccc", 
-00010800: 6e70 2e75 696e 7436 3428 5b31 2c20 332c  np.uint64([1, 3,
-00010810: 2034 5d29 5d2c 2064 7479 7065 3d6f 626a   4])], dtype=obj
-00010820: 6563 7429 0a0a 2020 2020 2020 2020 646f  ect)..        do
-00010830: 6d20 3d20 7469 6c65 6462 2e44 6f6d 6169  m = tiledb.Domai
-00010840: 6e28 7469 6c65 6462 2e44 696d 2864 6f6d  n(tiledb.Dim(dom
-00010850: 6169 6e3d 2830 2c20 3329 2c20 7469 6c65  ain=(0, 3), tile
-00010860: 3d34 2929 0a20 2020 2020 2020 2061 7474  =4)).        att
-00010870: 203d 2074 696c 6564 622e 4174 7472 2864   = tiledb.Attr(d
-00010880: 7479 7065 3d6e 702e 6279 7465 735f 2c20  type=np.bytes_, 
-00010890: 7661 723d 5472 7565 290a 0a20 2020 2020  var=True)..     
-000108a0: 2020 2073 6368 656d 6120 3d20 7469 6c65     schema = tile
-000108b0: 6462 2e41 7272 6179 5363 6865 6d61 2864  db.ArraySchema(d
-000108c0: 6f6d 2c20 2861 7474 2c29 290a 0a20 2020  om, (att,))..   
-000108d0: 2020 2020 2074 696c 6564 622e 4465 6e73       tiledb.Dens
-000108e0: 6541 7272 6179 2e63 7265 6174 6528 7365  eArray.create(se
-000108f0: 6c66 2e70 6174 6828 2266 6f6f 2229 2c20  lf.path("foo"), 
-00010900: 7363 6865 6d61 290a 2020 2020 2020 2020  schema).        
-00010910: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
-00010920: 6541 7272 6179 2873 656c 662e 7061 7468  eArray(self.path
-00010930: 2822 666f 6f22 292c 206d 6f64 653d 2277  ("foo"), mode="w
-00010940: 2229 2061 7320 543a 0a20 2020 2020 2020  ") as T:.       
-00010950: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
-00010960: 7373 6572 7452 6169 7365 7328 5479 7065  ssertRaises(Type
-00010970: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-00010980: 2020 2020 2020 2020 545b 3a5d 203d 2041          T[:] = A
-00010990: 0a0a 2020 2020 6465 6620 7465 7374 5f61  ..    def test_a
-000109a0: 7272 6179 5f76 6172 6c65 6e5f 3264 5f73  rray_varlen_2d_s
-000109b0: 5f66 6978 6564 2873 656c 6629 3a0a 2020  _fixed(self):.  
-000109c0: 2020 2020 2020 4120 3d20 6e70 2e61 7272        A = np.arr
-000109d0: 6179 280a 2020 2020 2020 2020 2020 2020  ay(.            
-000109e0: 5b5b 2241 4141 4141 4141 4141 6122 2c20  [["AAAAAAAAAa", 
-000109f0: 2242 4242 225d 2c20 5b22 4143 4343 222c  "BBB"], ["ACCC",
-00010a00: 2022 4242 4243 4243 4243 4243 4343 4242   "BBBCBCBCBCCCBB
-00010a10: 4342 4342 4343 4243 225d 5d2c 2064 7479  CBCBCCBC"]], dty
-00010a20: 7065 3d22 5322 0a20 2020 2020 2020 2029  pe="S".        )
-00010a30: 0a0a 2020 2020 2020 2020 7572 6920 3d20  ..        uri = 
-00010a40: 7365 6c66 2e70 6174 6828 2276 6172 6c65  self.path("varle
-00010a50: 6e5f 3264 5f73 5f66 6978 6564 2229 0a20  n_2d_s_fixed"). 
-00010a60: 2020 2020 2020 2064 6f6d 203d 2074 696c         dom = til
-00010a70: 6564 622e 446f 6d61 696e 280a 2020 2020  edb.Domain(.    
-00010a80: 2020 2020 2020 2020 7469 6c65 6462 2e44          tiledb.D
-00010a90: 696d 286e 616d 653d 2272 6f77 7322 2c20  im(name="rows", 
-00010aa0: 646f 6d61 696e 3d28 302c 2031 292c 2074  domain=(0, 1), t
-00010ab0: 696c 653d 322c 2064 7479 7065 3d6e 702e  ile=2, dtype=np.
-00010ac0: 696e 7436 3429 2c0a 2020 2020 2020 2020  int64),.        
-00010ad0: 2020 2020 7469 6c65 6462 2e44 696d 286e      tiledb.Dim(n
-00010ae0: 616d 653d 2263 6f6c 7322 2c20 646f 6d61  ame="cols", doma
-00010af0: 696e 3d28 302c 2031 292c 2074 696c 653d  in=(0, 1), tile=
-00010b00: 322c 2064 7479 7065 3d6e 702e 696e 7436  2, dtype=np.int6
-00010b10: 3429 2c0a 2020 2020 2020 2020 290a 0a20  4),.        ).. 
-00010b20: 2020 2020 2020 2073 6368 656d 6120 3d20         schema = 
-00010b30: 7469 6c65 6462 2e41 7272 6179 5363 6865  tiledb.ArraySche
-00010b40: 6d61 280a 2020 2020 2020 2020 2020 2020  ma(.            
-00010b50: 646f 6d61 696e 3d64 6f6d 2c20 7370 6172  domain=dom, spar
-00010b60: 7365 3d46 616c 7365 2c20 6174 7472 733d  se=False, attrs=
-00010b70: 5b74 696c 6564 622e 4174 7472 286e 616d  [tiledb.Attr(nam
-00010b80: 653d 2261 222c 2064 7479 7065 3d22 5322  e="a", dtype="S"
-00010b90: 2c20 7661 723d 5472 7565 295d 0a20 2020  , var=True)].   
-00010ba0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00010bb0: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-00010bc0: 792e 6372 6561 7465 2875 7269 2c20 7363  y.create(uri, sc
-00010bd0: 6865 6d61 290a 0a20 2020 2020 2020 2077  hema)..        w
-00010be0: 6974 6820 7469 6c65 6462 2e44 656e 7365  ith tiledb.Dense
-00010bf0: 4172 7261 7928 7572 692c 206d 6f64 653d  Array(uri, mode=
-00010c00: 2277 2229 2061 7320 543a 0a20 2020 2020  "w") as T:.     
-00010c10: 2020 2020 2020 2054 5b2e 2e2e 5d20 3d20         T[...] = 
-00010c20: 410a 0a20 2020 2020 2020 2077 6974 6820  A..        with 
-00010c30: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-00010c40: 7928 7572 6929 2061 7320 543a 0a20 2020  y(uri) as T:.   
-00010c50: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-00010c60: 6172 7261 795f 6571 7561 6c28 412c 2054  array_equal(A, T
-00010c70: 290a 0a0a 636c 6173 7320 5465 7374 5370  )...class TestSp
-00010c80: 6172 7365 4172 7261 7928 4469 736b 5465  arseArray(DiskTe
-00010c90: 7374 4361 7365 293a 0a20 2020 2040 7079  stCase):.    @py
-00010ca0: 7465 7374 2e6d 6172 6b2e 7866 6169 6c0a  test.mark.xfail.
-00010cb0: 2020 2020 6465 6620 7465 7374 5f73 696d      def test_sim
-00010cc0: 706c 655f 3164 5f73 7061 7273 655f 7665  ple_1d_sparse_ve
-00010cd0: 6374 6f72 2873 656c 6629 3a0a 2020 2020  ctor(self):.    
-00010ce0: 2020 2020 646f 6d20 3d20 7469 6c65 6462      dom = tiledb
-00010cf0: 2e44 6f6d 6169 6e28 7469 6c65 6462 2e44  .Domain(tiledb.D
-00010d00: 696d 2864 6f6d 6169 6e3d 2830 2c20 3329  im(domain=(0, 3)
-00010d10: 2c20 7469 6c65 3d34 2c20 6474 7970 653d  , tile=4, dtype=
-00010d20: 696e 7429 290a 2020 2020 2020 2020 6174  int)).        at
-00010d30: 7420 3d20 7469 6c65 6462 2e41 7474 7228  t = tiledb.Attr(
-00010d40: 6474 7970 653d 696e 7429 0a20 2020 2020  dtype=int).     
-00010d50: 2020 2073 6368 656d 6120 3d20 7469 6c65     schema = tile
-00010d60: 6462 2e41 7272 6179 5363 6865 6d61 2864  db.ArraySchema(d
-00010d70: 6f6d 6169 6e3d 646f 6d2c 2061 7474 7273  omain=dom, attrs
-00010d80: 3d28 6174 742c 292c 2073 7061 7273 653d  =(att,), sparse=
-00010d90: 5472 7565 290a 2020 2020 2020 2020 7469  True).        ti
-00010da0: 6c65 6462 2e53 7061 7273 6541 7272 6179  ledb.SparseArray
-00010db0: 2e63 7265 6174 6528 7365 6c66 2e70 6174  .create(self.pat
-00010dc0: 6828 2266 6f6f 2229 2c20 7363 6865 6d61  h("foo"), schema
-00010dd0: 290a 0a20 2020 2020 2020 2076 616c 7565  )..        value
-00010de0: 7320 3d20 6e70 2e61 7272 6179 285b 332c  s = np.array([3,
-00010df0: 2034 5d29 0a20 2020 2020 2020 2077 6974   4]).        wit
-00010e00: 6820 7469 6c65 6462 2e53 7061 7273 6541  h tiledb.SparseA
-00010e10: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
-00010e20: 666f 6f22 292c 206d 6f64 653d 2277 2229  foo"), mode="w")
-00010e30: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
-00010e40: 2020 2054 5b5b 312c 2032 5d5d 203d 2076     T[[1, 2]] = v
-00010e50: 616c 7565 730a 0a20 2020 2020 2020 2077  alues..        w
-00010e60: 6974 6820 7469 6c65 6462 2e53 7061 7273  ith tiledb.Spars
-00010e70: 6541 7272 6179 2873 656c 662e 7061 7468  eArray(self.path
-00010e80: 2822 666f 6f22 292c 206d 6f64 653d 2272  ("foo"), mode="r
-00010e90: 2229 2061 7320 543a 0a20 2020 2020 2020  ") as T:.       
-00010ea0: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-00010eb0: 795f 6571 7561 6c28 545b 5b31 2c20 325d  y_equal(T[[1, 2]
-00010ec0: 5d2c 2076 616c 7565 7329 0a0a 2020 2020  ], values)..    
-00010ed0: 4070 7974 6573 742e 6d61 726b 2e78 6661  @pytest.mark.xfa
-00010ee0: 696c 0a20 2020 2064 6566 2074 6573 745f  il.    def test_
-00010ef0: 7369 6d70 6c65 5f32 645f 7370 6172 7365  simple_2d_sparse
-00010f00: 5f76 6563 746f 7228 7365 6c66 293a 0a20  _vector(self):. 
-00010f10: 2020 2020 2020 2061 7474 7220 3d20 7469         attr = ti
-00010f20: 6c65 6462 2e41 7474 7228 6374 782c 2064  ledb.Attr(ctx, d
-00010f30: 7479 7065 3d66 6c6f 6174 290a 2020 2020  type=float).    
-00010f40: 2020 2020 646f 6d20 3d20 7469 6c65 6462      dom = tiledb
-00010f50: 2e44 6f6d 6169 6e28 0a20 2020 2020 2020  .Domain(.       
-00010f60: 2020 2020 2074 696c 6564 622e 4469 6d28       tiledb.Dim(
-00010f70: 6374 782c 2064 6f6d 6169 6e3d 2830 2c20  ctx, domain=(0, 
-00010f80: 3329 2c20 7469 6c65 3d34 2c20 6474 7970  3), tile=4, dtyp
-00010f90: 653d 696e 7429 2c0a 2020 2020 2020 2020  e=int),.        
-00010fa0: 2020 2020 7469 6c65 6462 2e44 696d 2863      tiledb.Dim(c
-00010fb0: 7478 2c20 646f 6d61 696e 3d28 302c 2033  tx, domain=(0, 3
-00010fc0: 292c 2074 696c 653d 342c 2064 7479 7065  ), tile=4, dtype
-00010fd0: 3d69 6e74 292c 0a20 2020 2020 2020 2029  =int),.        )
-00010fe0: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
-00010ff0: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
-00011000: 6865 6d61 2863 7478 2c20 646f 6d61 696e  hema(ctx, domain
-00011010: 3d64 6f6d 2c20 6174 7472 733d 2861 7474  =dom, attrs=(att
-00011020: 722c 292c 2073 7061 7273 653d 5472 7565  r,), sparse=True
-00011030: 290a 2020 2020 2020 2020 7469 6c65 6462  ).        tiledb
-00011040: 2e53 7061 7273 6541 7272 6179 2e63 7265  .SparseArray.cre
-00011050: 6174 6528 7365 6c66 2e70 6174 6828 2266  ate(self.path("f
-00011060: 6f6f 2229 2c20 7363 6865 6d61 290a 0a20  oo"), schema).. 
-00011070: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
-00011080: 6e70 2e61 7272 6179 285b 332c 2034 5d2c  np.array([3, 4],
-00011090: 2064 7479 7065 3d66 6c6f 6174 290a 2020   dtype=float).  
-000110a0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-000110b0: 622e 5370 6172 7365 4172 7261 7928 6374  b.SparseArray(ct
-000110c0: 782c 2073 656c 662e 7061 7468 2822 666f  x, self.path("fo
-000110d0: 6f22 292c 206d 6f64 653d 2277 2229 2061  o"), mode="w") a
-000110e0: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
-000110f0: 2054 5b5b 312c 2032 5d2c 205b 312c 2032   T[[1, 2], [1, 2
-00011100: 5d5d 203d 2076 616c 7565 730a 0a20 2020  ]] = values..   
-00011110: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-00011120: 2e53 7061 7273 6541 7272 6179 2863 7478  .SparseArray(ctx
-00011130: 2c20 7365 6c66 2e70 6174 6828 2266 6f6f  , self.path("foo
-00011140: 2229 2c20 6d6f 6465 3d22 7222 2920 6173  "), mode="r") as
-00011150: 2054 3a0a 2020 2020 2020 2020 2020 2020   T:.            
-00011160: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-00011170: 616c 2854 5b5b 312c 2032 5d2c 205b 312c  al(T[[1, 2], [1,
-00011180: 2032 5d5d 2c20 7661 6c75 6573 290a 0a20   2]], values).. 
-00011190: 2020 2040 7079 7465 7374 2e6d 6172 6b2e     @pytest.mark.
-000111a0: 7866 6169 6c0a 2020 2020 6465 6620 7465  xfail.    def te
-000111b0: 7374 5f73 696d 706c 6533 645f 7370 6172  st_simple3d_spar
-000111c0: 7365 5f76 6563 746f 7228 7365 6c66 293a  se_vector(self):
-000111d0: 0a20 2020 2020 2020 2064 6f6d 203d 2074  .        dom = t
-000111e0: 696c 6564 622e 446f 6d61 696e 280a 2020  iledb.Domain(.  
-000111f0: 2020 2020 2020 2020 2020 6374 782c 0a20            ctx,. 
-00011200: 2020 2020 2020 2020 2020 2074 696c 6564             tiled
-00011210: 622e 4469 6d28 6374 782c 2022 7822 2c20  b.Dim(ctx, "x", 
-00011220: 646f 6d61 696e 3d28 302c 2033 292c 2074  domain=(0, 3), t
-00011230: 696c 653d 342c 2064 7479 7065 3d69 6e74  ile=4, dtype=int
-00011240: 292c 0a20 2020 2020 2020 2020 2020 2074  ),.            t
-00011250: 696c 6564 622e 4469 6d28 6374 782c 2022  iledb.Dim(ctx, "
-00011260: 7922 2c20 646f 6d61 696e 3d28 302c 2033  y", domain=(0, 3
-00011270: 292c 2074 696c 653d 342c 2064 7479 7065  ), tile=4, dtype
-00011280: 3d69 6e74 292c 0a20 2020 2020 2020 2020  =int),.         
-00011290: 2020 2074 696c 6564 622e 4469 6d28 6374     tiledb.Dim(ct
-000112a0: 782c 2022 7a22 2c20 646f 6d61 696e 3d28  x, "z", domain=(
-000112b0: 302c 2033 292c 2074 696c 653d 342c 2064  0, 3), tile=4, d
-000112c0: 7479 7065 3d69 6e74 292c 0a20 2020 2020  type=int),.     
-000112d0: 2020 2029 0a20 2020 2020 2020 2061 7474     ).        att
-000112e0: 7220 3d20 7469 6c65 6462 2e41 7474 7228  r = tiledb.Attr(
-000112f0: 6374 782c 2064 7479 7065 3d66 6c6f 6174  ctx, dtype=float
-00011300: 290a 2020 2020 2020 2020 7363 6865 6d61  ).        schema
-00011310: 203d 2074 696c 6564 622e 4172 7261 7953   = tiledb.ArrayS
-00011320: 6368 656d 6128 6374 782c 2064 6f6d 6169  chema(ctx, domai
-00011330: 6e3d 646f 6d2c 2061 7474 7273 3d28 6174  n=dom, attrs=(at
-00011340: 7472 2c29 2c20 7370 6172 7365 3d54 7275  tr,), sparse=Tru
-00011350: 6529 0a20 2020 2020 2020 2074 696c 6564  e).        tiled
-00011360: 622e 5370 6172 7365 4172 7261 792e 6372  b.SparseArray.cr
-00011370: 6561 7465 2873 656c 662e 7061 7468 2822  eate(self.path("
-00011380: 666f 6f22 292c 2073 6368 656d 6129 0a0a  foo"), schema)..
-00011390: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
-000113a0: 206e 702e 6172 7261 7928 5b33 2c20 345d   np.array([3, 4]
-000113b0: 2c20 6474 7970 653d 666c 6f61 7429 0a20  , dtype=float). 
-000113c0: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
-000113d0: 6462 2e53 7061 7273 6541 7272 6179 2863  db.SparseArray(c
-000113e0: 7478 2c20 7365 6c66 2e70 6174 6828 2266  tx, self.path("f
-000113f0: 6f6f 2229 2c20 6d6f 6465 3d22 7722 2920  oo"), mode="w") 
-00011400: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
-00011410: 2020 545b 5b31 2c20 325d 2c20 5b31 2c20    T[[1, 2], [1, 
-00011420: 325d 2c20 5b31 2c20 325d 5d20 3d20 7661  2], [1, 2]] = va
-00011430: 6c75 6573 0a0a 2020 2020 2020 2020 7769  lues..        wi
-00011440: 7468 2074 696c 6564 622e 5370 6172 7365  th tiledb.Sparse
-00011450: 4172 7261 7928 6374 782c 2073 656c 662e  Array(ctx, self.
-00011460: 7061 7468 2822 666f 6f22 292c 206d 6f64  path("foo"), mod
-00011470: 653d 2272 2229 2061 7320 543a 0a20 2020  e="r") as T:.   
-00011480: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-00011490: 6172 7261 795f 6571 7561 6c28 545b 5b31  array_equal(T[[1
-000114a0: 2c20 325d 2c20 5b31 2c20 325d 2c20 5b31  , 2], [1, 2], [1
-000114b0: 2c20 325d 5d2c 2076 616c 7565 7329 0a0a  , 2]], values)..
-000114c0: 2020 2020 4070 7974 6573 742e 6d61 726b      @pytest.mark
-000114d0: 2e78 6661 696c 0a20 2020 2064 6566 2074  .xfail.    def t
-000114e0: 6573 745f 7370 6172 7365 5f6f 7264 6572  est_sparse_order
-000114f0: 6564 5f66 705f 646f 6d61 696e 2873 656c  ed_fp_domain(sel
-00011500: 6629 3a0a 2020 2020 2020 2020 646f 6d20  f):.        dom 
-00011510: 3d20 7469 6c65 6462 2e44 6f6d 6169 6e28  = tiledb.Domain(
-00011520: 7469 6c65 6462 2e44 696d 2822 7822 2c20  tiledb.Dim("x", 
-00011530: 646f 6d61 696e 3d28 302e 302c 2031 302e  domain=(0.0, 10.
-00011540: 3029 2c20 7469 6c65 3d32 2e30 2c20 6474  0), tile=2.0, dt
-00011550: 7970 653d 666c 6f61 7429 290a 2020 2020  ype=float)).    
-00011560: 2020 2020 6174 7472 203d 2074 696c 6564      attr = tiled
-00011570: 622e 4174 7472 2864 7479 7065 3d66 6c6f  b.Attr(dtype=flo
-00011580: 6174 290a 2020 2020 2020 2020 6174 7472  at).        attr
-00011590: 203d 2074 696c 6564 622e 4174 7472 2864   = tiledb.Attr(d
-000115a0: 7479 7065 3d66 6c6f 6174 290a 2020 2020  type=float).    
-000115b0: 2020 2020 7363 6865 6d61 203d 2074 696c      schema = til
-000115c0: 6564 622e 4172 7261 7953 6368 656d 6128  edb.ArraySchema(
-000115d0: 646f 6d61 696e 3d64 6f6d 2c20 6174 7472  domain=dom, attr
-000115e0: 733d 2861 7474 722c 292c 2073 7061 7273  s=(attr,), spars
-000115f0: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-00011600: 7469 6c65 6462 2e53 7061 7273 6541 7272  tiledb.SparseArr
-00011610: 6179 2e63 7265 6174 6528 7365 6c66 2e70  ay.create(self.p
-00011620: 6174 6828 2266 6f6f 2229 2c20 7363 6865  ath("foo"), sche
-00011630: 6d61 290a 0a20 2020 2020 2020 2076 616c  ma)..        val
-00011640: 7565 7320 3d20 6e70 2e61 7272 6179 285b  ues = np.array([
-00011650: 332e 332c 2032 2e37 5d29 0a20 2020 2020  3.3, 2.7]).     
-00011660: 2020 2077 6974 6820 7469 6c65 6462 2e53     with tiledb.S
-00011670: 7061 7273 6541 7272 6179 2873 656c 662e  parseArray(self.
-00011680: 7061 7468 2822 666f 6f22 292c 206d 6f64  path("foo"), mod
-00011690: 653d 2277 2229 2061 7320 543a 0a20 2020  e="w") as T:.   
-000116a0: 2020 2020 2020 2020 2054 5b5b 322e 352c           T[[2.5,
-000116b0: 2034 2e32 5d5d 203d 2076 616c 7565 730a   4.2]] = values.
-000116c0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
-000116d0: 6564 622e 5370 6172 7365 4172 7261 7928  edb.SparseArray(
-000116e0: 7365 6c66 2e70 6174 6828 2266 6f6f 2229  self.path("foo")
-000116f0: 2c20 6d6f 6465 3d22 7222 2920 6173 2054  , mode="r") as T
-00011700: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
-00011710: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
-00011720: 2854 5b5b 322e 352c 2034 2e32 5d5d 2c20  (T[[2.5, 4.2]], 
-00011730: 7661 6c75 6573 290a 0a20 2020 2040 7079  values)..    @py
-00011740: 7465 7374 2e6d 6172 6b2e 7866 6169 6c0a  test.mark.xfail.
-00011750: 2020 2020 6465 6620 7465 7374 5f73 7061      def test_spa
-00011760: 7273 655f 756e 6f72 6465 7265 645f 6670  rse_unordered_fp
-00011770: 5f64 6f6d 6169 6e28 7365 6c66 293a 0a20  _domain(self):. 
-00011780: 2020 2020 2020 2064 6f6d 203d 2074 696c         dom = til
-00011790: 6564 622e 446f 6d61 696e 2874 696c 6564  edb.Domain(tiled
-000117a0: 622e 4469 6d28 2278 222c 2064 6f6d 6169  b.Dim("x", domai
-000117b0: 6e3d 2830 2e30 2c20 3130 2e30 292c 2074  n=(0.0, 10.0), t
-000117c0: 696c 653d 322e 302c 2064 7479 7065 3d66  ile=2.0, dtype=f
-000117d0: 6c6f 6174 2929 0a20 2020 2020 2020 2061  loat)).        a
-000117e0: 7474 7220 3d20 7469 6c65 6462 2e41 7474  ttr = tiledb.Att
-000117f0: 7228 6474 7970 653d 666c 6f61 7429 0a20  r(dtype=float). 
-00011800: 2020 2020 2020 2073 6368 656d 6120 3d20         schema = 
-00011810: 7469 6c65 6462 2e41 7272 6179 5363 6865  tiledb.ArraySche
-00011820: 6d61 2864 6f6d 6169 6e3d 646f 6d2c 2061  ma(domain=dom, a
-00011830: 7474 7273 3d28 6174 7472 2c29 2c20 7370  ttrs=(attr,), sp
-00011840: 6172 7365 3d54 7275 6529 0a20 2020 2020  arse=True).     
-00011850: 2020 2074 696c 6564 622e 5370 6172 7365     tiledb.Sparse
-00011860: 4172 7261 792e 6372 6561 7465 2873 656c  Array.create(sel
-00011870: 662e 7061 7468 2822 666f 6f22 292c 2073  f.path("foo"), s
-00011880: 6368 656d 6129 0a20 2020 2020 2020 2076  chema).        v
-00011890: 616c 7565 7320 3d20 6e70 2e61 7272 6179  alues = np.array
-000118a0: 285b 332e 332c 2032 2e37 5d29 0a20 2020  ([3.3, 2.7]).   
-000118b0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-000118c0: 2e53 7061 7273 6541 7272 6179 2873 656c  .SparseArray(sel
-000118d0: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
-000118e0: 6f64 653d 2277 2229 2061 7320 543a 0a20  ode="w") as T:. 
-000118f0: 2020 2020 2020 2020 2020 2054 5b5b 342e             T[[4.
-00011900: 322c 2032 2e35 5d5d 203d 2076 616c 7565  2, 2.5]] = value
-00011910: 730a 0a20 2020 2020 2020 2077 6974 6820  s..        with 
-00011920: 7469 6c65 6462 2e53 7061 7273 6541 7272  tiledb.SparseArr
-00011930: 6179 2873 656c 662e 7061 7468 2822 666f  ay(self.path("fo
-00011940: 6f22 292c 206d 6f64 653d 2272 2229 2061  o"), mode="r") a
-00011950: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
-00011960: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-00011970: 7561 6c28 545b 5b32 2e35 2c20 342e 325d  ual(T[[2.5, 4.2]
-00011980: 5d2c 2076 616c 7565 735b 3a3a 2d31 5d29  ], values[::-1])
-00011990: 0a0a 2020 2020 4070 7974 6573 742e 6d61  ..    @pytest.ma
-000119a0: 726b 2e78 6661 696c 0a20 2020 2064 6566  rk.xfail.    def
-000119b0: 2074 6573 745f 6d75 6c74 6970 6c65 5f61   test_multiple_a
-000119c0: 7474 7269 6275 7465 7328 7365 6c66 293a  ttributes(self):
-000119d0: 0a20 2020 2020 2020 2075 7269 203d 2073  .        uri = s
-000119e0: 656c 662e 7061 7468 2829 0a0a 2020 2020  elf.path()..    
-000119f0: 2020 2020 646f 6d20 3d20 7469 6c65 6462      dom = tiledb
-00011a00: 2e44 6f6d 6169 6e28 0a20 2020 2020 2020  .Domain(.       
-00011a10: 2020 2020 2074 696c 6564 622e 4469 6d28       tiledb.Dim(
-00011a20: 646f 6d61 696e 3d28 312c 2031 3029 2c20  domain=(1, 10), 
-00011a30: 7469 6c65 3d31 302c 2064 7479 7065 3d69  tile=10, dtype=i
-00011a40: 6e74 292c 0a20 2020 2020 2020 2020 2020  nt),.           
-00011a50: 2074 696c 6564 622e 4469 6d28 646f 6d61   tiledb.Dim(doma
-00011a60: 696e 3d28 312c 2031 3029 2c20 7469 6c65  in=(1, 10), tile
-00011a70: 3d31 302c 2064 7479 7065 3d69 6e74 292c  =10, dtype=int),
-00011a80: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00011a90: 2020 2061 7474 725f 696e 7420 3d20 7469     attr_int = ti
-00011aa0: 6c65 6462 2e41 7474 7228 2269 6e74 7322  ledb.Attr("ints"
-00011ab0: 2c20 6474 7970 653d 696e 7429 0a20 2020  , dtype=int).   
-00011ac0: 2020 2020 2061 7474 725f 666c 6f61 7420       attr_float 
-00011ad0: 3d20 7469 6c65 6462 2e41 7474 7228 2266  = tiledb.Attr("f
-00011ae0: 6c6f 6174 7322 2c20 6474 7970 653d 2266  loats", dtype="f
-00011af0: 6c6f 6174 2229 0a20 2020 2020 2020 2073  loat").        s
-00011b00: 6368 656d 6120 3d20 7469 6c65 6462 2e41  chema = tiledb.A
-00011b10: 7272 6179 5363 6865 6d61 280a 2020 2020  rraySchema(.    
-00011b20: 2020 2020 2020 2020 646f 6d61 696e 3d64          domain=d
-00011b30: 6f6d 2c20 6174 7472 733d 2861 7474 725f  om, attrs=(attr_
-00011b40: 696e 742c 2061 7474 725f 666c 6f61 7429  int, attr_float)
-00011b50: 2c20 7370 6172 7365 3d54 7275 650a 2020  , sparse=True.  
-00011b60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00011b70: 7469 6c65 6462 2e53 7061 7273 6541 7272  tiledb.SparseArr
-00011b80: 6179 2e63 7265 6174 6528 7365 6c66 2e70  ay.create(self.p
-00011b90: 6174 6828 2266 6f6f 2229 2c20 7363 6865  ath("foo"), sche
-00011ba0: 6d61 290a 0a20 2020 2020 2020 2049 203d  ma)..        I =
-00011bb0: 206e 702e 6172 7261 7928 5b31 2c20 312c   np.array([1, 1,
-00011bc0: 2031 2c20 322c 2033 2c20 332c 2033 2c20   1, 2, 3, 3, 3, 
-00011bd0: 345d 290a 2020 2020 2020 2020 4a20 3d20  4]).        J = 
-00011be0: 6e70 2e61 7272 6179 285b 312c 2032 2c20  np.array([1, 2, 
-00011bf0: 342c 2033 2c20 312c 2036 2c20 372c 2035  4, 3, 1, 6, 7, 5
-00011c00: 5d29 0a0a 2020 2020 2020 2020 565f 696e  ])..        V_in
-00011c10: 7473 203d 206e 702e 6172 7261 7928 5b30  ts = np.array([0
-00011c20: 2c20 312c 2032 2c20 332c 2034 2c20 362c  , 1, 2, 3, 4, 6,
-00011c30: 2037 2c20 355d 290a 2020 2020 2020 2020   7, 5]).        
-00011c40: 565f 666c 6f61 7473 203d 206e 702e 6172  V_floats = np.ar
-00011c50: 7261 7928 5b30 2e30 2c20 312e 302c 2032  ray([0.0, 1.0, 2
-00011c60: 2e30 2c20 332e 302c 2034 2e30 2c20 362e  .0, 3.0, 4.0, 6.
-00011c70: 302c 2037 2e30 2c20 352e 305d 290a 0a20  0, 7.0, 5.0]).. 
-00011c80: 2020 2020 2020 2056 203d 207b 2269 6e74         V = {"int
-00011c90: 7322 3a20 565f 696e 7473 2c20 2266 6c6f  s": V_ints, "flo
-00011ca0: 6174 7322 3a20 565f 666c 6f61 7473 7d0a  ats": V_floats}.
-00011cb0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
-00011cc0: 6564 622e 5370 6172 7365 4172 7261 7928  edb.SparseArray(
-00011cd0: 7572 692c 206d 6f64 653d 2277 2229 2061  uri, mode="w") a
-00011ce0: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
-00011cf0: 2054 5b49 2c20 4a5d 203d 2056 0a20 2020   T[I, J] = V.   
-00011d00: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-00011d10: 2e53 7061 7273 6541 7272 6179 2875 7269  .SparseArray(uri
-00011d20: 2c20 6d6f 6465 3d22 7222 2920 6173 2054  , mode="r") as T
-00011d30: 3a0a 2020 2020 2020 2020 2020 2020 5220  :.            R 
-00011d40: 3d20 545b 492c 204a 5d0a 2020 2020 2020  = T[I, J].      
-00011d50: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-00011d60: 7175 616c 2856 5b22 696e 7473 225d 2c20  qual(V["ints"], 
-00011d70: 525b 2269 6e74 7322 5d29 0a20 2020 2020  R["ints"]).     
-00011d80: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
-00011d90: 6571 7561 6c28 565b 2266 6c6f 6174 7322  equal(V["floats"
-00011da0: 5d2c 2052 5b22 666c 6f61 7473 225d 290a  ], R["floats"]).
-00011db0: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
-00011dc0: 2065 7272 6f72 2061 7474 7269 6275 7465   error attribute
-00011dd0: 2064 6f65 7320 6e6f 7420 6578 6973 740a   does not exist.
-00011de0: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
-00011df0: 7368 6f75 6c64 2074 6869 7320 6265 2061  should this be a
-00011e00: 6e20 6174 7472 6962 7574 6520 6572 726f  n attribute erro
-00011e10: 723f 0a20 2020 2020 2020 2077 6974 6820  r?.        with 
-00011e20: 7469 6c65 6462 2e53 7061 7273 6541 7272  tiledb.SparseArr
-00011e30: 6179 2875 7269 2c20 6d6f 6465 3d22 7722  ay(uri, mode="w"
-00011e40: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
-00011e50: 2020 2020 565b 2266 6f6f 225d 203d 2056      V["foo"] = V
-00011e60: 5b22 696e 7473 225d 2e61 7374 7970 6528  ["ints"].astype(
-00011e70: 6e70 2e69 6e74 3829 0a20 2020 2020 2020  np.int8).       
-00011e80: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
-00011e90: 7373 6572 7452 6169 7365 7328 7469 6c65  ssertRaises(tile
-00011ea0: 6462 2e54 696c 6544 4245 7272 6f72 293a  db.TileDBError):
-00011eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011ec0: 2054 5b49 2c20 4a5d 203d 2056 0a0a 2020   T[I, J] = V..  
-00011ed0: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
-00011ee0: 6b20 6572 726f 7220 6e63 656c 6c73 206c  k error ncells l
-00011ef0: 656e 6774 680a 2020 2020 2020 2020 2020  ength.          
-00011f00: 2020 565b 2269 6e74 7322 5d20 3d20 565b    V["ints"] = V[
-00011f10: 2269 6e74 7322 5d5b 313a 325d 2e63 6f70  "ints"][1:2].cop
-00011f20: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
-00011f30: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
-00011f40: 5261 6973 6573 2841 7474 7269 6275 7465  Raises(Attribute
-00011f50: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-00011f60: 2020 2020 2020 2020 545b 492c 204a 5d20          T[I, J] 
-00011f70: 3d20 560a 0a20 2020 2064 6566 2074 6573  = V..    def tes
-00011f80: 745f 7175 6572 795f 7265 616c 5f6d 756c  t_query_real_mul
-00011f90: 7469 5f69 6e64 6578 2873 656c 662c 2073  ti_index(self, s
-00011fa0: 7061 7273 655f 6365 6c6c 5f6f 7264 6572  parse_cell_order
-00011fb0: 293a 0a20 2020 2020 2020 2075 7269 203d  ):.        uri =
-00011fc0: 2073 656c 662e 7061 7468 2822 7175 6572   self.path("quer
-00011fd0: 795f 7265 616c 5f6d 756c 7469 5f69 6e64  y_real_multi_ind
-00011fe0: 6578 2229 0a0a 2020 2020 2020 2020 646f  ex")..        do
-00011ff0: 6d20 3d20 7469 6c65 6462 2e44 6f6d 6169  m = tiledb.Domai
-00012000: 6e28 0a20 2020 2020 2020 2020 2020 2074  n(.            t
-00012010: 696c 6564 622e 4469 6d28 2278 222c 2064  iledb.Dim("x", d
-00012020: 6f6d 6169 6e3d 282d 3130 2e30 2c20 3130  omain=(-10.0, 10
-00012030: 2e30 292c 2074 696c 653d 322e 302c 2064  .0), tile=2.0, d
-00012040: 7479 7065 3d66 6c6f 6174 290a 2020 2020  type=float).    
-00012050: 2020 2020 290a 2020 2020 2020 2020 6174      ).        at
-00012060: 7472 203d 2074 696c 6564 622e 4174 7472  tr = tiledb.Attr
-00012070: 2822 6122 2c20 6474 7970 653d 6e70 2e66  ("a", dtype=np.f
-00012080: 6c6f 6174 3332 290a 2020 2020 2020 2020  loat32).        
-00012090: 7363 6865 6d61 203d 2074 696c 6564 622e  schema = tiledb.
-000120a0: 4172 7261 7953 6368 656d 6128 0a20 2020  ArraySchema(.   
-000120b0: 2020 2020 2020 2020 2064 6f6d 6169 6e3d           domain=
-000120c0: 646f 6d2c 2061 7474 7273 3d28 6174 7472  dom, attrs=(attr
-000120d0: 2c29 2c20 7370 6172 7365 3d54 7275 652c  ,), sparse=True,
-000120e0: 2063 656c 6c5f 6f72 6465 723d 7370 6172   cell_order=spar
-000120f0: 7365 5f63 656c 6c5f 6f72 6465 720a 2020  se_cell_order.  
-00012100: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00012110: 7469 6c65 6462 2e53 7061 7273 6541 7272  tiledb.SparseArr
-00012120: 6179 2e63 7265 6174 6528 7572 692c 2073  ay.create(uri, s
-00012130: 6368 656d 6129 0a0a 2020 2020 2020 2020  chema)..        
-00012140: 7661 6c75 6573 203d 206e 702e 6172 7261  values = np.arra
-00012150: 7928 5b33 2e33 2c20 322e 375d 290a 2020  y([3.3, 2.7]).  
-00012160: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-00012170: 622e 5370 6172 7365 4172 7261 7928 7572  b.SparseArray(ur
-00012180: 692c 206d 6f64 653d 2277 2229 2061 7320  i, mode="w") as 
-00012190: 543a 0a20 2020 2020 2020 2020 2020 2054  T:.            T
-000121a0: 5b5b 322e 352c 2034 2e32 5d5d 203d 2076  [[2.5, 4.2]] = v
-000121b0: 616c 7565 730a 2020 2020 2020 2020 7769  alues.        wi
-000121c0: 7468 2074 696c 6564 622e 5370 6172 7365  th tiledb.Sparse
-000121d0: 4172 7261 7928 7572 692c 206d 6f64 653d  Array(uri, mode=
-000121e0: 2272 2229 2061 7320 543a 0a20 2020 2020  "r") as T:.     
-000121f0: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-00012200: 7261 795f 6571 7561 6c28 0a20 2020 2020  ray_equal(.     
-00012210: 2020 2020 2020 2020 2020 2054 2e71 7565             T.que
-00012220: 7279 2863 6f6f 7264 733d 5472 7565 292e  ry(coords=True).
-00012230: 6d75 6c74 695f 696e 6465 785b 2d31 302e  multi_index[-10.
-00012240: 3020 3a20 6e70 2e6e 6578 7461 6674 6572  0 : np.nextafter
-00012250: 2834 2e32 2c20 3029 5d5b 2261 225d 2c0a  (4.2, 0)]["a"],.
-00012260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012270: 6e70 2e66 6c6f 6174 3332 2833 2e33 292c  np.float32(3.3),
-00012280: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00012290: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-000122a0: 745f 6172 7261 795f 6571 7561 6c28 0a20  t_array_equal(. 
-000122b0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-000122c0: 2e71 7565 7279 2863 6f6f 7264 733d 5472  .query(coords=Tr
-000122d0: 7565 292e 6d75 6c74 695f 696e 6465 785b  ue).multi_index[
-000122e0: 2d31 302e 3020 3a20 6e70 2e6e 6578 7461  -10.0 : np.nexta
-000122f0: 6674 6572 2834 2e32 2c20 3029 5d5b 2278  fter(4.2, 0)]["x
-00012300: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-00012310: 2020 2020 6e70 2e66 6c6f 6174 3332 285b      np.float32([
-00012320: 322e 355d 292c 0a20 2020 2020 2020 2020  2.5]),.         
-00012330: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00012340: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-00012350: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
-00012360: 2020 2020 2054 2e71 7565 7279 2863 6f6f       T.query(coo
-00012370: 7264 733d 4661 6c73 6529 2e6d 756c 7469  rds=False).multi
-00012380: 5f69 6e64 6578 5b2d 3130 2e30 3a35 2e30  _index[-10.0:5.0
-00012390: 5d5b 2261 225d 2c0a 2020 2020 2020 2020  ]["a"],.        
-000123a0: 2020 2020 2020 2020 6e70 2e66 6c6f 6174          np.float
-000123b0: 3332 285b 332e 332c 2032 2e37 5d29 2c0a  32([3.3, 2.7]),.
-000123c0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-000123d0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000123e0: 7373 6572 7454 7275 6528 0a20 2020 2020  ssertTrue(.     
-000123f0: 2020 2020 2020 2020 2020 2022 636f 6f72             "coor
-00012400: 6473 2220 6e6f 7420 696e 2054 2e71 7565  ds" not in T.que
-00012410: 7279 2863 6f6f 7264 733d 4661 6c73 6529  ry(coords=False)
-00012420: 2e6d 756c 7469 5f69 6e64 6578 5b2d 3130  .multi_index[-10
-00012430: 2e30 3a35 2e30 5d0a 2020 2020 2020 2020  .0:5.0].        
-00012440: 2020 2020 290a 0a20 2020 2040 7079 7465      )..    @pyte
-00012450: 7374 2e6d 6172 6b2e 7061 7261 6d65 7472  st.mark.parametr
-00012460: 697a 6528 2264 7479 7065 222c 2049 4e54  ize("dtype", INT
-00012470: 4547 4552 5f44 5459 5045 5329 0a20 2020  EGER_DTYPES).   
-00012480: 2064 6566 2074 6573 745f 7370 6172 7365   def test_sparse
-00012490: 5f69 6e64 6578 5f64 7479 7065 7328 7365  _index_dtypes(se
-000124a0: 6c66 2c20 6474 7970 6529 3a0a 2020 2020  lf, dtype):.    
-000124b0: 2020 2020 7061 7468 203d 2073 656c 662e      path = self.
-000124c0: 7061 7468 2829 0a20 2020 2020 2020 2064  path().        d
-000124d0: 6174 6120 3d20 6e70 2e61 7261 6e67 6528  ata = np.arange(
-000124e0: 302c 2033 292e 6173 7479 7065 2864 7479  0, 3).astype(dty
-000124f0: 7065 290a 0a20 2020 2020 2020 2073 6368  pe)..        sch
-00012500: 656d 6120 3d20 7363 6865 6d61 5f66 726f  ema = schema_fro
-00012510: 6d5f 6469 6374 2861 7474 7273 3d7b 2261  m_dict(attrs={"a
-00012520: 7474 7222 3a20 6461 7461 7d2c 2064 696d  ttr": data}, dim
-00012530: 733d 7b22 6430 223a 2064 6174 617d 290a  s={"d0": data}).
-00012540: 2020 2020 2020 2020 7469 6c65 6462 2e53          tiledb.S
-00012550: 7061 7273 6541 7272 6179 2e63 7265 6174  parseArray.creat
-00012560: 6528 7061 7468 2c20 7363 6865 6d61 290a  e(path, schema).
-00012570: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
-00012580: 6c65 6462 2e6f 7065 6e28 7061 7468 2c20  ledb.open(path, 
-00012590: 2277 2229 2061 7320 413a 0a20 2020 2020  "w") as A:.     
-000125a0: 2020 2020 2020 2041 5b64 6174 615d 203d         A[data] =
-000125b0: 2064 6174 610a 0a20 2020 2020 2020 2077   data..        w
-000125c0: 6974 6820 7469 6c65 6462 2e6f 7065 6e28  ith tiledb.open(
-000125d0: 7061 7468 2920 6173 2042 3a0a 2020 2020  path) as B:.    
-000125e0: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
-000125f0: 7272 6179 5f65 7175 616c 2842 5b3a 5d5b  rray_equal(B[:][
-00012600: 2261 7474 7222 5d2c 2064 6174 6129 0a20  "attr"], data). 
-00012610: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00012620: 7420 425b 6461 7461 5b30 5d5d 5b22 6174  t B[data[0]]["at
-00012630: 7472 225d 203d 3d20 6461 7461 5b30 5d0a  tr"] == data[0].
-00012640: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00012650: 7274 2042 5b64 6174 615b 315d 5d5b 2261  rt B[data[1]]["a
-00012660: 7474 7222 5d20 3d3d 2064 6174 615b 315d  ttr"] == data[1]
-00012670: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00012680: 6572 7420 422e 6d75 6c74 695f 696e 6465  ert B.multi_inde
-00012690: 785b 6461 7461 5b30 5d5d 5b22 6174 7472  x[data[0]]["attr
-000126a0: 225d 203d 3d20 6461 7461 5b30 5d0a 0a20  "] == data[0].. 
-000126b0: 2020 2064 6566 2074 6573 745f 7175 6572     def test_quer
-000126c0: 795f 7265 616c 5f65 7861 6374 2873 656c  y_real_exact(sel
-000126d0: 662c 2073 7061 7273 655f 6365 6c6c 5f6f  f, sparse_cell_o
-000126e0: 7264 6572 293a 0a20 2020 2020 2020 2022  rder):.        "
-000126f0: 2222 0a20 2020 2020 2020 2054 6573 7420  "".        Test 
-00012700: 616e 6420 6465 6d6f 206f 6620 7175 6572  and demo of quer
-00012710: 7969 6e67 2061 7420 666c 6f61 7469 6e67  ying at floating
-00012720: 2070 6f69 6e74 2072 6570 7265 7365 6e74   point represent
-00012730: 6162 6c65 2062 6f75 6e64 6172 6965 730a  able boundaries.
-00012740: 0a20 2020 2020 2020 2043 6f6e 6369 7365  .        Concise
-00012750: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
-00012760: 6f66 2065 7870 6563 7465 6420 6265 6861  of expected beha
-00012770: 7669 6f72 3a0a 0a20 2020 2020 2020 2063  vior:..        c
-00012780: 302c 6331 2c63 3220 3d20 5b33 2e30 3130  0,c1,c2 = [3.010
-00012790: 3030 3030 3030 3030 3030 3030 322c 2033  0000000000002, 3
-000127a0: 2e30 3130 3030 3030 3030 3030 3030 3030  .010000000000000
-000127b0: 372c 2033 2e30 3130 3030 3030 3030 3030  7, 3.01000000000
-000127c0: 3030 3031 5d0a 2020 2020 2020 2020 7661  0001].        va
-000127d0: 6c75 6573 203d 205b 312c 322c 335d 0a0a  lues = [1,2,3]..
-000127e0: 2020 2020 2020 2020 5b63 303a 6330 5d20          [c0:c0] 
-000127f0: 2d3e 205b 315d 0a20 2020 2020 2020 205b  -> [1].        [
-00012800: 6331 3a63 315d 202d 3e20 5b32 5d0a 2020  c1:c1] -> [2].  
-00012810: 2020 2020 2020 5b63 323a 6332 5d20 2d3e        [c2:c2] ->
-00012820: 205b 335d 0a0a 2020 2020 2020 2020 5b63   [3]..        [c
-00012830: 303a 6331 5d20 2d3e 205b 312c 325d 0a20  0:c1] -> [1,2]. 
-00012840: 2020 2020 2020 205b 6330 3a63 325d 202d         [c0:c2] -
-00012850: 3e20 5b31 2c32 2c33 5d0a 0a20 2020 2020  > [1,2,3]..     
-00012860: 2020 205b 6330 202d 206e 6578 7461 6674     [c0 - nextaft
-00012870: 6572 2863 302c 3029 203a 2063 305d 202d  er(c0,0) : c0] -
-00012880: 3e20 5b31 5d0a 2020 2020 2020 2020 5b63  > [1].        [c
-00012890: 3020 2d20 6e65 7874 6166 7465 7228 6330  0 - nextafter(c0
-000128a0: 2c30 2920 3a20 6330 202d 206e 6578 7461  ,0) : c0 - nexta
-000128b0: 6674 6572 2863 302c 3029 5d20 2d3e 205b  fter(c0,0)] -> [
-000128c0: 5d0a 0a20 2020 2020 2020 205b 6332 3a63  ]..        [c2:c
-000128d0: 322b 6e65 7874 6166 7465 7228 6332 295d  2+nextafter(c2)]
-000128e0: 202d 3e20 5b33 5d0a 2020 2020 2020 2020   -> [3].        
-000128f0: 5b63 322b 6e65 7874 6166 7465 7228 6332  [c2+nextafter(c2
-00012900: 2920 3a20 6332 2b6e 6578 7461 6674 6572  ) : c2+nextafter
-00012910: 2863 3229 5d20 2d3e 205b 5d0a 0a20 2020  (c2)] -> []..   
-00012920: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00012930: 2075 7269 203d 2073 656c 662e 7061 7468   uri = self.path
-00012940: 2829 0a0a 2020 2020 2020 2020 646f 6d20  ()..        dom 
-00012950: 3d20 7469 6c65 6462 2e44 6f6d 6169 6e28  = tiledb.Domain(
-00012960: 0a20 2020 2020 2020 2020 2020 2074 696c  .            til
-00012970: 6564 622e 4469 6d28 2278 222c 2064 6f6d  edb.Dim("x", dom
-00012980: 6169 6e3d 282d 3130 2e30 2c20 3130 2e30  ain=(-10.0, 10.0
-00012990: 292c 2074 696c 653d 322e 302c 2064 7479  ), tile=2.0, dty
-000129a0: 7065 3d66 6c6f 6174 290a 2020 2020 2020  pe=float).      
-000129b0: 2020 290a 2020 2020 2020 2020 6174 7472    ).        attr
-000129c0: 203d 2074 696c 6564 622e 4174 7472 2822   = tiledb.Attr("
-000129d0: 222c 2064 7479 7065 3d6e 702e 666c 6f61  ", dtype=np.floa
-000129e0: 7433 3229 0a20 2020 2020 2020 2073 6368  t32).        sch
-000129f0: 656d 6120 3d20 7469 6c65 6462 2e41 7272  ema = tiledb.Arr
-00012a00: 6179 5363 6865 6d61 280a 2020 2020 2020  aySchema(.      
-00012a10: 2020 2020 2020 646f 6d61 696e 3d64 6f6d        domain=dom
-00012a20: 2c20 6174 7472 733d 2861 7474 722c 292c  , attrs=(attr,),
-00012a30: 2073 7061 7273 653d 5472 7565 2c20 6365   sparse=True, ce
-00012a40: 6c6c 5f6f 7264 6572 3d73 7061 7273 655f  ll_order=sparse_
-00012a50: 6365 6c6c 5f6f 7264 6572 0a20 2020 2020  cell_order.     
-00012a60: 2020 2029 0a20 2020 2020 2020 2074 696c     ).        til
-00012a70: 6564 622e 5370 6172 7365 4172 7261 792e  edb.SparseArray.
-00012a80: 6372 6561 7465 2875 7269 2c20 7363 6865  create(uri, sche
-00012a90: 6d61 290a 0a20 2020 2020 2020 2063 3020  ma)..        c0 
-00012aa0: 3d20 6e70 2e6e 6578 7461 6674 6572 2833  = np.nextafter(3
-00012ab0: 2e30 312c 2034 2920 2023 2073 6d61 6c6c  .01, 4)  # small
-00012ac0: 6572 0a20 2020 2020 2020 2063 3120 3d20  er.        c1 = 
-00012ad0: 6e70 2e6e 6578 7461 6674 6572 2863 302c  np.nextafter(c0,
-00012ae0: 2034 290a 2020 2020 2020 2020 6332 203d   4).        c2 =
-00012af0: 206e 702e 6e65 7874 6166 7465 7228 6331   np.nextafter(c1
-00012b00: 2c20 3429 2020 2320 6c61 7267 6572 0a0a  , 4)  # larger..
-00012b10: 2020 2020 2020 2020 2320 666f 7220 6465          # for de
-00012b20: 6275 6767 696e 6720 7573 653a 0a20 2020  bugging use:.   
-00012b30: 2020 2020 2023 206e 702e 7365 745f 7072       # np.set_pr
-00012b40: 696e 746f 7074 696f 6e73 2870 7265 6369  intoptions(preci
-00012b50: 7369 6f6e 3d31 362c 2066 6c6f 6174 6d6f  sion=16, floatmo
-00012b60: 6465 3d27 6d61 7870 7265 6327 290a 2020  de='maxprec').  
-00012b70: 2020 2020 2020 2320 7072 696e 7428 6330        # print(c0
-00012b80: 2c63 312c 6332 290a 0a20 2020 2020 2020  ,c1,c2)..       
-00012b90: 2076 616c 7565 7320 3d20 6e70 2e61 7272   values = np.arr
-00012ba0: 6179 285b 312c 2032 2c20 335d 290a 2020  ay([1, 2, 3]).  
-00012bb0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-00012bc0: 622e 5370 6172 7365 4172 7261 7928 7572  b.SparseArray(ur
-00012bd0: 692c 206d 6f64 653d 2277 2229 2061 7320  i, mode="w") as 
-00012be0: 543a 0a20 2020 2020 2020 2020 2020 2054  T:.            T
-00012bf0: 5b5b 6330 2c20 6331 2c20 6332 5d5d 203d  [[c0, c1, c2]] =
-00012c00: 2076 616c 7565 730a 0a20 2020 2020 2020   values..       
-00012c10: 2077 6974 6820 7469 6c65 6462 2e53 7061   with tiledb.Spa
-00012c20: 7273 6541 7272 6179 2875 7269 2c20 6d6f  rseArray(uri, mo
-00012c30: 6465 3d22 7222 2920 6173 2054 3a0a 2020  de="r") as T:.  
-00012c40: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
-00012c50: 2063 2069 6e20 656e 756d 6572 6174 6528   c in enumerate(
-00012c60: 5b63 302c 2063 312c 2063 325d 293a 0a20  [c0, c1, c2]):. 
-00012c70: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00012c80: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
-00012c90: 6c28 542e 7175 6572 7928 636f 6f72 6473  l(T.query(coords
-00012ca0: 3d54 7275 6529 2e6d 756c 7469 5f69 6e64  =True).multi_ind
-00012cb0: 6578 5b63 3a63 5d5b 2222 5d2c 2076 616c  ex[c:c][""], val
-00012cc0: 7565 735b 695d 290a 2020 2020 2020 2020  ues[i]).        
-00012cd0: 2020 2020 2320 7465 7374 2028 636f 6f72      # test (coor
-00012ce0: 642c 2063 6f6f 7264 202b 206e 6578 7461  d, coord + nexta
-00012cf0: 6674 6572 290a 2020 2020 2020 2020 2020  fter).          
-00012d00: 2020 6330 5f70 7265 7620 3d20 6e70 2e6e    c0_prev = np.n
-00012d10: 6578 7461 6674 6572 2863 302c 2030 290a  extafter(c0, 0).
-00012d20: 2020 2020 2020 2020 2020 2020 6332 5f6e              c2_n
-00012d30: 6578 7420 3d20 6e70 2e6e 6578 7461 6674  ext = np.nextaft
-00012d40: 6572 2863 322c 2034 290a 2020 2020 2020  er(c2, 4).      
-00012d50: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
-00012d60: 6179 5f65 7175 616c 2854 2e71 7565 7279  ay_equal(T.query
-00012d70: 2863 6f6f 7264 733d 5472 7565 292e 6d75  (coords=True).mu
-00012d80: 6c74 695f 696e 6465 785b 6330 3a63 315d  lti_index[c0:c1]
-00012d90: 5b22 225d 2c20 5b31 2c20 325d 290a 2020  [""], [1, 2]).  
-00012da0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00012db0: 5f61 7272 6179 5f65 7175 616c 2854 2e71  _array_equal(T.q
-00012dc0: 7565 7279 2863 6f6f 7264 733d 5472 7565  uery(coords=True
-00012dd0: 292e 6d75 6c74 695f 696e 6465 785b 6330  ).multi_index[c0
-00012de0: 3a63 325d 5b22 225d 2c20 5b31 2c20 322c  :c2][""], [1, 2,
-00012df0: 2033 5d29 0a20 2020 2020 2020 2020 2020   3]).           
-00012e00: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-00012e10: 7561 6c28 542e 7175 6572 7928 636f 6f72  ual(T.query(coor
-00012e20: 6473 3d54 7275 6529 2e6d 756c 7469 5f69  ds=True).multi_i
-00012e30: 6e64 6578 5b63 323a 6332 5f6e 6578 745d  ndex[c2:c2_next]
-00012e40: 5b22 225d 2c20 3329 0a20 2020 2020 2020  [""], 3).       
-00012e50: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-00012e60: 795f 6571 7561 6c28 542e 7175 6572 7928  y_equal(T.query(
-00012e70: 636f 6f72 6473 3d54 7275 6529 2e6d 756c  coords=True).mul
-00012e80: 7469 5f69 6e64 6578 5b63 305f 7072 6576  ti_index[c0_prev
-00012e90: 3a63 305d 5b22 225d 2c20 3129 0a20 2020  :c0][""], 1).   
-00012ea0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-00012eb0: 6172 7261 795f 6571 7561 6c28 0a20 2020  array_equal(.   
-00012ec0: 2020 2020 2020 2020 2020 2020 2054 2e71               T.q
-00012ed0: 7565 7279 2863 6f6f 7264 733d 5472 7565  uery(coords=True
-00012ee0: 292e 6d75 6c74 695f 696e 6465 785b 6330  ).multi_index[c0
-00012ef0: 5f70 7265 763a 6330 5f70 7265 765d 5b22  _prev:c0_prev]["
-00012f00: 225d 2c20 5b5d 0a20 2020 2020 2020 2020  "], [].         
-00012f10: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00012f20: 2023 2074 6573 7420 2863 6f6f 7264 202b   # test (coord +
-00012f30: 206e 6578 7461 6674 6572 2c20 636f 6f72   nextafter, coor
-00012f40: 6420 2b20 6e65 7874 6166 7465 7229 0a20  d + nextafter). 
-00012f50: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00012f60: 745f 6172 7261 795f 6571 7561 6c28 0a20  t_array_equal(. 
-00012f70: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-00012f80: 2e71 7565 7279 2863 6f6f 7264 733d 5472  .query(coords=Tr
-00012f90: 7565 292e 6d75 6c74 695f 696e 6465 785b  ue).multi_index[
-00012fa0: 6332 5f6e 6578 743a 6332 5f6e 6578 745d  c2_next:c2_next]
-00012fb0: 5b22 225d 2c20 6e70 2e61 7272 6179 285b  [""], np.array([
-00012fc0: 5d29 0a20 2020 2020 2020 2020 2020 2029  ]).            )
-00012fd0: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
-00012fe0: 6573 7420 2863 6f6f 7264 202d 206e 6578  est (coord - nex
-00012ff0: 7461 6674 6572 2c20 636f 6f72 6429 0a20  tafter, coord). 
-00013000: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00013010: 745f 6172 7261 795f 6571 7561 6c28 0a20  t_array_equal(. 
-00013020: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-00013030: 2e71 7565 7279 2863 6f6f 7264 733d 5472  .query(coords=Tr
-00013040: 7565 292e 6d75 6c74 695f 696e 6465 785b  ue).multi_index[
-00013050: 6330 3a63 315d 5b22 225d 2c20 7661 6c75  c0:c1][""], valu
-00013060: 6573 5b5b 302c 2031 5d5d 0a20 2020 2020  es[[0, 1]].     
-00013070: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00013080: 2020 2020 2023 2074 6573 7420 2863 6f6f       # test (coo
-00013090: 7264 202d 206e 6578 7461 6674 6572 2c20  rd - nextafter, 
-000130a0: 636f 6f72 6420 2b20 6e65 7874 6166 7465  coord + nextafte
-000130b0: 7229 0a20 2020 2020 2020 2020 2020 2061  r).            a
-000130c0: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
-000130d0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-000130e0: 2020 2054 2e71 7565 7279 2863 6f6f 7264     T.query(coord
-000130f0: 733d 5472 7565 292e 6d75 6c74 695f 696e  s=True).multi_in
-00013100: 6465 785b 6330 3a63 325d 5b22 225d 2c20  dex[c0:c2][""], 
-00013110: 7661 6c75 6573 5b5b 302c 2031 2c20 325d  values[[0, 1, 2]
-00013120: 5d0a 2020 2020 2020 2020 2020 2020 290a  ].            ).
-00013130: 0a20 2020 2064 6566 2074 6573 745f 7370  .    def test_sp
-00013140: 6172 7365 5f71 7565 7279 5f73 7065 6369  arse_query_speci
-00013150: 6669 6564 5f64 696d 5f63 6f6f 7264 7328  fied_dim_coords(
-00013160: 7365 6c66 2c20 7370 6172 7365 5f63 656c  self, sparse_cel
-00013170: 6c5f 6f72 6465 7229 3a0a 2020 2020 2020  l_order):.      
-00013180: 2020 7572 6920 3d20 7365 6c66 2e70 6174    uri = self.pat
-00013190: 6828 2273 7061 7273 655f 7175 6572 795f  h("sparse_query_
-000131a0: 7370 6563 6966 6965 645f 6469 6d5f 636f  specified_dim_co
-000131b0: 6f72 6473 2229 0a0a 2020 2020 2020 2020  ords")..        
-000131c0: 646f 6d20 3d20 7469 6c65 6462 2e44 6f6d  dom = tiledb.Dom
-000131d0: 6169 6e28 0a20 2020 2020 2020 2020 2020  ain(.           
-000131e0: 2074 696c 6564 622e 4469 6d28 2269 222c   tiledb.Dim("i",
-000131f0: 2064 6f6d 6169 6e3d 2831 2c20 3130 292c   domain=(1, 10),
-00013200: 2074 696c 653d 312c 2064 7479 7065 3d69   tile=1, dtype=i
-00013210: 6e74 292c 0a20 2020 2020 2020 2020 2020  nt),.           
-00013220: 2074 696c 6564 622e 4469 6d28 226a 222c   tiledb.Dim("j",
-00013230: 2064 6f6d 6169 6e3d 2831 312c 2032 3029   domain=(11, 20)
-00013240: 2c20 7469 6c65 3d31 2c20 6474 7970 653d  , tile=1, dtype=
-00013250: 696e 7429 2c0a 2020 2020 2020 2020 290a  int),.        ).
-00013260: 2020 2020 2020 2020 6174 7420 3d20 7469          att = ti
-00013270: 6c65 6462 2e41 7474 7228 2222 2c20 6474  ledb.Attr("", dt
-00013280: 7970 653d 696e 7429 0a20 2020 2020 2020  ype=int).       
-00013290: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
-000132a0: 2e41 7272 6179 5363 6865 6d61 280a 2020  .ArraySchema(.  
-000132b0: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
-000132c0: 3d64 6f6d 2c20 6174 7472 733d 2861 7474  =dom, attrs=(att
-000132d0: 2c29 2c20 7370 6172 7365 3d54 7275 652c  ,), sparse=True,
-000132e0: 2063 656c 6c5f 6f72 6465 723d 7370 6172   cell_order=spar
-000132f0: 7365 5f63 656c 6c5f 6f72 6465 720a 2020  se_cell_order.  
-00013300: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00013310: 7469 6c65 6462 2e53 7061 7273 6541 7272  tiledb.SparseArr
-00013320: 6179 2e63 7265 6174 6528 7572 692c 2073  ay.create(uri, s
-00013330: 6368 656d 6129 0a0a 2020 2020 2020 2020  chema)..        
-00013340: 6920 3d20 6e70 2e61 7272 6179 285b 312c  i = np.array([1,
-00013350: 2031 2c20 312c 2032 2c20 332c 2033 2c20   1, 1, 2, 3, 3, 
-00013360: 332c 2034 5d29 0a20 2020 2020 2020 206a  3, 4]).        j
-00013370: 203d 206e 702e 6172 7261 7928 5b31 312c   = np.array([11,
-00013380: 2031 322c 2031 342c 2031 332c 2031 312c   12, 14, 13, 11,
-00013390: 2031 362c 2031 372c 2031 355d 290a 0a20   16, 17, 15]).. 
-000133a0: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
-000133b0: 6462 2e53 7061 7273 6541 7272 6179 2875  db.SparseArray(u
-000133c0: 7269 2c20 6d6f 6465 3d22 7722 2920 6173  ri, mode="w") as
-000133d0: 2041 3a0a 2020 2020 2020 2020 2020 2020   A:.            
-000133e0: 415b 692c 206a 5d20 3d20 6e70 2e61 7272  A[i, j] = np.arr
-000133f0: 6179 285b 302c 2031 2c20 322c 2033 2c20  ay([0, 1, 2, 3, 
-00013400: 342c 2036 2c20 372c 2035 5d29 0a0a 2020  4, 6, 7, 5])..  
-00013410: 2020 2020 2020 2320 6461 7461 2069 7320        # data is 
-00013420: 7265 7475 726e 6564 2069 6e20 4869 6c62  returned in Hilb
-00013430: 6572 7420 6f72 6465 722c 2073 6f20 7765  ert order, so we
-00013440: 206e 6565 6420 746f 2063 6865 636b 2073   need to check s
-00013450: 6f72 7465 640a 2020 2020 2020 2020 7769  orted.        wi
-00013460: 7468 2074 696c 6564 622e 5370 6172 7365  th tiledb.Sparse
-00013470: 4172 7261 7928 7572 692c 206d 6f64 653d  Array(uri, mode=
-00013480: 2272 2229 2061 7320 413a 0a20 2020 2020  "r") as A:.     
-00013490: 2020 2020 2020 2041 6920 3d20 412e 7175         Ai = A.qu
-000134a0: 6572 7928 6469 6d73 3d5b 2269 225d 295b  ery(dims=["i"])[
-000134b0: 3a5d 0a20 2020 2020 2020 2020 2020 2073  :].            s
-000134c0: 656c 662e 6173 7365 7274 5472 7565 2822  elf.assertTrue("
-000134d0: 6922 2069 6e20 4169 290a 2020 2020 2020  i" in Ai).      
-000134e0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-000134f0: 7446 616c 7365 2822 6a22 2069 6e20 4169  tFalse("j" in Ai
-00013500: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-00013510: 7365 7274 5f75 6e6f 7264 6572 6564 5f65  sert_unordered_e
-00013520: 7175 616c 2841 695b 2269 225d 2c20 692c  qual(Ai["i"], i,
-00013530: 2073 7061 7273 655f 6365 6c6c 5f6f 7264   sparse_cell_ord
-00013540: 6572 203d 3d20 2268 696c 6265 7274 2229  er == "hilbert")
-00013550: 0a0a 2020 2020 2020 2020 2020 2020 416a  ..            Aj
-00013560: 203d 2041 2e71 7565 7279 2864 696d 733d   = A.query(dims=
-00013570: 5b22 6a22 5d29 5b3a 5d0a 2020 2020 2020  ["j"])[:].      
-00013580: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00013590: 7446 616c 7365 2822 6922 2069 6e20 416a  tFalse("i" in Aj
-000135a0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000135b0: 6c66 2e61 7373 6572 7454 7275 6528 226a  lf.assertTrue("j
-000135c0: 2220 696e 2041 6a29 0a20 2020 2020 2020  " in Aj).       
-000135d0: 2020 2020 2061 7373 6572 745f 756e 6f72       assert_unor
-000135e0: 6465 7265 645f 6571 7561 6c28 416a 5b22  dered_equal(Aj["
-000135f0: 6a22 5d2c 206a 2c20 7370 6172 7365 5f63  j"], j, sparse_c
-00013600: 656c 6c5f 6f72 6465 7220 3d3d 2022 6869  ell_order == "hi
-00013610: 6c62 6572 7422 290a 0a20 2020 2020 2020  lbert")..       
-00013620: 2020 2020 2041 696a 203d 2041 2e71 7565       Aij = A.que
-00013630: 7279 2864 696d 733d 5b22 6922 2c20 226a  ry(dims=["i", "j
-00013640: 225d 295b 3a5d 0a20 2020 2020 2020 2020  "])[:].         
-00013650: 2020 2073 656c 662e 6173 7365 7274 5472     self.assertTr
-00013660: 7565 2822 6922 2069 6e20 4169 6a29 0a20  ue("i" in Aij). 
-00013670: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00013680: 6173 7365 7274 5472 7565 2822 6a22 2069  assertTrue("j" i
-00013690: 6e20 4169 6a29 0a20 2020 2020 2020 2020  n Aij).         
-000136a0: 2020 2061 7373 6572 745f 756e 6f72 6465     assert_unorde
-000136b0: 7265 645f 6571 7561 6c28 4169 6a5b 2269  red_equal(Aij["i
-000136c0: 225d 2c20 692c 2073 7061 7273 655f 6365  "], i, sparse_ce
-000136d0: 6c6c 5f6f 7264 6572 203d 3d20 2268 696c  ll_order == "hil
-000136e0: 6265 7274 2229 0a20 2020 2020 2020 2020  bert").         
-000136f0: 2020 2061 7373 6572 745f 756e 6f72 6465     assert_unorde
-00013700: 7265 645f 6571 7561 6c28 4169 6a5b 226a  red_equal(Aij["j
-00013710: 225d 2c20 6a2c 2073 7061 7273 655f 6365  "], j, sparse_ce
-00013720: 6c6c 5f6f 7264 6572 203d 3d20 2268 696c  ll_order == "hil
-00013730: 6265 7274 2229 0a0a 2020 2020 6465 6620  bert")..    def 
-00013740: 7465 7374 5f64 656e 7365 5f71 7565 7279  test_dense_query
-00013750: 5f73 7065 6369 6669 6564 5f64 696d 5f63  _specified_dim_c
-00013760: 6f6f 7264 7328 7365 6c66 293a 0a20 2020  oords(self):.   
-00013770: 2020 2020 2075 7269 203d 2073 656c 662e       uri = self.
-00013780: 7061 7468 2822 6465 6e73 655f 7175 6572  path("dense_quer
-00013790: 795f 7370 6563 6966 6965 645f 6469 6d5f  y_specified_dim_
-000137a0: 636f 6f72 6473 2229 0a0a 2020 2020 2020  coords")..      
-000137b0: 2020 646f 6d20 3d20 7469 6c65 6462 2e44    dom = tiledb.D
-000137c0: 6f6d 6169 6e28 0a20 2020 2020 2020 2020  omain(.         
-000137d0: 2020 2074 696c 6564 622e 4469 6d28 2269     tiledb.Dim("i
-000137e0: 222c 2064 6f6d 6169 6e3d 2831 2c20 3329  ", domain=(1, 3)
-000137f0: 2c20 7469 6c65 3d31 2c20 6474 7970 653d  , tile=1, dtype=
-00013800: 696e 7429 2c0a 2020 2020 2020 2020 2020  int),.          
-00013810: 2020 7469 6c65 6462 2e44 696d 2822 6a22    tiledb.Dim("j"
-00013820: 2c20 646f 6d61 696e 3d28 342c 2036 292c  , domain=(4, 6),
-00013830: 2074 696c 653d 312c 2064 7479 7065 3d69   tile=1, dtype=i
-00013840: 6e74 292c 0a20 2020 2020 2020 2029 0a20  nt),.        ). 
-00013850: 2020 2020 2020 2061 7474 203d 2074 696c         att = til
-00013860: 6564 622e 4174 7472 2822 222c 2064 7479  edb.Attr("", dty
-00013870: 7065 3d69 6e74 290a 2020 2020 2020 2020  pe=int).        
-00013880: 7363 6865 6d61 203d 2074 696c 6564 622e  schema = tiledb.
-00013890: 4172 7261 7953 6368 656d 6128 646f 6d61  ArraySchema(doma
-000138a0: 696e 3d64 6f6d 2c20 6174 7472 733d 2861  in=dom, attrs=(a
-000138b0: 7474 2c29 2c20 7370 6172 7365 3d46 616c  tt,), sparse=Fal
-000138c0: 7365 290a 2020 2020 2020 2020 7469 6c65  se).        tile
-000138d0: 6462 2e44 656e 7365 4172 7261 792e 6372  db.DenseArray.cr
-000138e0: 6561 7465 2875 7269 2c20 7363 6865 6d61  eate(uri, schema
-000138f0: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
-00013900: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-00013910: 7928 7572 692c 206d 6f64 653d 2277 2229  y(uri, mode="w")
-00013920: 2061 7320 413a 0a20 2020 2020 2020 2020   as A:.         
-00013930: 2020 2041 5b3a 2c20 3a5d 203d 206e 702e     A[:, :] = np.
-00013940: 6172 616e 6765 2839 290a 0a20 2020 2020  arange(9)..     
-00013950: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
-00013960: 656e 7365 4172 7261 7928 7572 692c 206d  enseArray(uri, m
-00013970: 6f64 653d 2272 2229 2061 7320 413a 0a20  ode="r") as A:. 
-00013980: 2020 2020 2020 2020 2020 2069 203d 206e             i = n
-00013990: 702e 6172 7261 7928 5b5b 312c 2031 2c20  p.array([[1, 1, 
-000139a0: 315d 2c20 5b32 2c20 322c 2032 5d2c 205b  1], [2, 2, 2], [
-000139b0: 332c 2033 2c20 335d 5d29 0a20 2020 2020  3, 3, 3]]).     
-000139c0: 2020 2020 2020 206a 203d 206e 702e 6172         j = np.ar
-000139d0: 7261 7928 5b5b 342c 2035 2c20 365d 2c20  ray([[4, 5, 6], 
-000139e0: 5b34 2c20 352c 2036 5d2c 205b 342c 2035  [4, 5, 6], [4, 5
-000139f0: 2c20 365d 5d29 0a0a 2020 2020 2020 2020  , 6]])..        
-00013a00: 2020 2020 4169 203d 2041 2e71 7565 7279      Ai = A.query
-00013a10: 2864 696d 733d 5b22 6922 5d29 5b3a 5d0a  (dims=["i"])[:].
-00013a20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00013a30: 2e61 7373 6572 7454 7275 6528 2269 2220  .assertTrue("i" 
-00013a40: 696e 2041 6929 0a20 2020 2020 2020 2020  in Ai).         
-00013a50: 2020 2073 656c 662e 6173 7365 7274 4661     self.assertFa
-00013a60: 6c73 6528 226a 2220 696e 2041 6929 0a20  lse("j" in Ai). 
-00013a70: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00013a80: 745f 6172 7261 795f 6571 7561 6c28 4169  t_array_equal(Ai
-00013a90: 5b22 6922 5d2c 2069 290a 0a20 2020 2020  ["i"], i)..     
-00013aa0: 2020 2020 2020 2041 6a20 3d20 412e 7175         Aj = A.qu
-00013ab0: 6572 7928 6469 6d73 3d5b 226a 225d 295b  ery(dims=["j"])[
-00013ac0: 3a5d 0a20 2020 2020 2020 2020 2020 2073  :].            s
-00013ad0: 656c 662e 6173 7365 7274 4661 6c73 6528  elf.assertFalse(
-00013ae0: 2269 2220 696e 2041 6a29 0a20 2020 2020  "i" in Aj).     
-00013af0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00013b00: 7274 5472 7565 2822 6a22 2069 6e20 416a  rtTrue("j" in Aj
-00013b10: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
-00013b20: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
-00013b30: 2841 6a5b 226a 225d 2c20 6a29 0a0a 2020  (Aj["j"], j)..  
-00013b40: 2020 2020 2020 2020 2020 4169 6a20 3d20            Aij = 
-00013b50: 412e 7175 6572 7928 6469 6d73 3d5b 2269  A.query(dims=["i
-00013b60: 222c 2022 6a22 5d29 5b3a 5d0a 2020 2020  ", "j"])[:].    
-00013b70: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00013b80: 6572 7454 7275 6528 2269 2220 696e 2041  ertTrue("i" in A
-00013b90: 696a 290a 2020 2020 2020 2020 2020 2020  ij).            
-00013ba0: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
-00013bb0: 226a 2220 696e 2041 696a 290a 2020 2020  "j" in Aij).    
-00013bc0: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
-00013bd0: 7272 6179 5f65 7175 616c 2841 696a 5b22  rray_equal(Aij["
-00013be0: 6922 5d2c 2069 290a 2020 2020 2020 2020  i"], i).        
-00013bf0: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
-00013c00: 5f65 7175 616c 2841 696a 5b22 6a22 5d2c  _equal(Aij["j"],
-00013c10: 206a 290a 0a20 2020 2064 6566 2074 6573   j)..    def tes
-00013c20: 745f 7375 6261 7272 6179 2873 656c 662c  t_subarray(self,
-00013c30: 2073 7061 7273 655f 6365 6c6c 5f6f 7264   sparse_cell_ord
-00013c40: 6572 293a 0a20 2020 2020 2020 2064 6f6d  er):.        dom
-00013c50: 203d 2074 696c 6564 622e 446f 6d61 696e   = tiledb.Domain
-00013c60: 2874 696c 6564 622e 4469 6d28 2278 222c  (tiledb.Dim("x",
-00013c70: 2064 6f6d 6169 6e3d 2831 2c20 3130 3030   domain=(1, 1000
-00013c80: 3029 2c20 7469 6c65 3d31 3030 2c20 6474  0), tile=100, dt
-00013c90: 7970 653d 696e 7429 290a 2020 2020 2020  ype=int)).      
-00013ca0: 2020 6174 7420 3d20 7469 6c65 6462 2e41    att = tiledb.A
-00013cb0: 7474 7228 2222 2c20 6474 7970 653d 666c  ttr("", dtype=fl
-00013cc0: 6f61 7429 0a20 2020 2020 2020 2073 6368  oat).        sch
-00013cd0: 656d 6120 3d20 7469 6c65 6462 2e41 7272  ema = tiledb.Arr
-00013ce0: 6179 5363 6865 6d61 280a 2020 2020 2020  aySchema(.      
-00013cf0: 2020 2020 2020 646f 6d61 696e 3d64 6f6d        domain=dom
-00013d00: 2c20 6174 7472 733d 2861 7474 2c29 2c20  , attrs=(att,), 
-00013d10: 7370 6172 7365 3d54 7275 652c 2063 656c  sparse=True, cel
-00013d20: 6c5f 6f72 6465 723d 7370 6172 7365 5f63  l_order=sparse_c
-00013d30: 656c 6c5f 6f72 6465 720a 2020 2020 2020  ell_order.      
-00013d40: 2020 290a 2020 2020 2020 2020 7469 6c65    ).        tile
-00013d50: 6462 2e53 7061 7273 6541 7272 6179 2e63  db.SparseArray.c
-00013d60: 7265 6174 6528 7365 6c66 2e70 6174 6828  reate(self.path(
-00013d70: 2266 6f6f 2229 2c20 7363 6865 6d61 290a  "foo"), schema).
-00013d80: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
-00013d90: 6c65 6462 2e53 7061 7273 6541 7272 6179  ledb.SparseArray
-00013da0: 2873 656c 662e 7061 7468 2822 666f 6f22  (self.path("foo"
-00013db0: 292c 206d 6f64 653d 2272 2229 2061 7320  ), mode="r") as 
-00013dc0: 543a 0a20 2020 2020 2020 2020 2020 2073  T:.            s
-00013dd0: 656c 662e 6173 7365 7274 4973 4e6f 6e65  elf.assertIsNone
-00013de0: 2854 2e6e 6f6e 656d 7074 795f 646f 6d61  (T.nonempty_doma
-00013df0: 696e 2829 290a 0a20 2020 2020 2020 2077  in())..        w
-00013e00: 6974 6820 7469 6c65 6462 2e53 7061 7273  ith tiledb.Spars
-00013e10: 6541 7272 6179 2873 656c 662e 7061 7468  eArray(self.path
-00013e20: 2822 666f 6f22 292c 206d 6f64 653d 2277  ("foo"), mode="w
-00013e30: 2229 2061 7320 543a 0a20 2020 2020 2020  ") as T:.       
-00013e40: 2020 2020 2054 5b5b 3530 2c20 3630 2c20       T[[50, 60, 
-00013e50: 3130 305d 5d20 3d20 5b31 2e30 2c20 322e  100]] = [1.0, 2.
-00013e60: 302c 2033 2e30 5d0a 0a20 2020 2020 2020  0, 3.0]..       
-00013e70: 2077 6974 6820 7469 6c65 6462 2e53 7061   with tiledb.Spa
-00013e80: 7273 6541 7272 6179 2873 656c 662e 7061  rseArray(self.pa
-00013e90: 7468 2822 666f 6f22 292c 206d 6f64 653d  th("foo"), mode=
-00013ea0: 2272 2229 2061 7320 543a 0a20 2020 2020  "r") as T:.     
-00013eb0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00013ec0: 7274 4571 7561 6c28 2828 3530 2c20 3130  rtEqual(((50, 10
-00013ed0: 3029 2c29 2c20 542e 6e6f 6e65 6d70 7479  0),), T.nonempty
-00013ee0: 5f64 6f6d 6169 6e28 2929 0a0a 2020 2020  _domain())..    
-00013ef0: 2020 2020 2020 2020 2320 7265 7472 6965          # retrie
-00013f00: 7665 206a 7573 7420 7661 6c69 6420 636f  ve just valid co
-00013f10: 6f72 6469 6e61 7465 7320 696e 2073 7562  ordinates in sub
-00013f20: 6172 7261 7920 545b 3430 3a36 305d 0a20  array T[40:60]. 
-00013f30: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00013f40: 745f 6172 7261 795f 6571 7561 6c28 545b  t_array_equal(T[
-00013f50: 3430 3a36 315d 5b22 7822 5d2c 205b 3530  40:61]["x"], [50
-00013f60: 2c20 3630 5d29 0a0a 2020 2020 2020 2020  , 60])..        
-00013f70: 2020 2020 2320 544f 444f 3a20 6472 6f70      # TODO: drop
-00013f80: 7069 6e67 2063 6f6f 7264 7320 7769 7468  ping coords with
-00013f90: 206f 6e65 2061 6e6f 6e20 7661 6c75 6520   one anon value 
-00013fa0: 7265 7475 726e 7320 6a75 7374 2061 6e20  returns just an 
-00013fb0: 6172 7261 790a 2020 2020 2020 2020 2020  array.          
-00013fc0: 2020 7265 7320 3d20 542e 7175 6572 7928    res = T.query(
-00013fd0: 636f 6f72 6473 3d46 616c 7365 295b 3430  coords=False)[40
-00013fe0: 3a36 315d 0a20 2020 2020 2020 2020 2020  :61].           
-00013ff0: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-00014000: 7561 6c28 7265 735b 2222 5d2c 205b 312e  ual(res[""], [1.
-00014010: 302c 2032 2e30 5d29 0a20 2020 2020 2020  0, 2.0]).       
-00014020: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00014030: 4571 7561 6c28 2822 636f 6f72 6473 2220  Equal(("coords" 
-00014040: 696e 2072 6573 292c 2046 616c 7365 290a  in res), False).
-00014050: 0a20 2020 2064 6566 2074 6573 745f 7370  .    def test_sp
-00014060: 6172 7365 5f62 7974 6573 2873 656c 662c  arse_bytes(self,
-00014070: 2073 7061 7273 655f 6365 6c6c 5f6f 7264   sparse_cell_ord
-00014080: 6572 293a 0a20 2020 2020 2020 2064 6f6d  er):.        dom
-00014090: 203d 2074 696c 6564 622e 446f 6d61 696e   = tiledb.Domain
-000140a0: 2874 696c 6564 622e 4469 6d28 2278 222c  (tiledb.Dim("x",
-000140b0: 2064 6f6d 6169 6e3d 2831 2c20 3130 3030   domain=(1, 1000
-000140c0: 3029 2c20 7469 6c65 3d31 3030 2c20 6474  0), tile=100, dt
-000140d0: 7970 653d 696e 7429 290a 2020 2020 2020  ype=int)).      
-000140e0: 2020 6174 7420 3d20 7469 6c65 6462 2e41    att = tiledb.A
-000140f0: 7474 7228 2222 2c20 7661 723d 5472 7565  ttr("", var=True
-00014100: 2c20 6474 7970 653d 6e70 2e62 7974 6573  , dtype=np.bytes
-00014110: 5f29 0a20 2020 2020 2020 2073 6368 656d  _).        schem
-00014120: 6120 3d20 7469 6c65 6462 2e41 7272 6179  a = tiledb.Array
-00014130: 5363 6865 6d61 280a 2020 2020 2020 2020  Schema(.        
-00014140: 2020 2020 646f 6d61 696e 3d64 6f6d 2c20      domain=dom, 
-00014150: 6174 7472 733d 2861 7474 2c29 2c20 7370  attrs=(att,), sp
-00014160: 6172 7365 3d54 7275 652c 2063 656c 6c5f  arse=True, cell_
-00014170: 6f72 6465 723d 7370 6172 7365 5f63 656c  order=sparse_cel
-00014180: 6c5f 6f72 6465 720a 2020 2020 2020 2020  l_order.        
-00014190: 290a 2020 2020 2020 2020 7469 6c65 6462  ).        tiledb
-000141a0: 2e53 7061 7273 6541 7272 6179 2e63 7265  .SparseArray.cre
-000141b0: 6174 6528 7365 6c66 2e70 6174 6828 2266  ate(self.path("f
-000141c0: 6f6f 2229 2c20 7363 6865 6d61 290a 0a20  oo"), schema).. 
-000141d0: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
-000141e0: 6462 2e53 7061 7273 6541 7272 6179 2873  db.SparseArray(s
-000141f0: 656c 662e 7061 7468 2822 666f 6f22 292c  elf.path("foo"),
-00014200: 206d 6f64 653d 2272 2229 2061 7320 543a   mode="r") as T:
-00014210: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00014220: 662e 6173 7365 7274 4973 4e6f 6e65 2854  f.assertIsNone(T
-00014230: 2e6e 6f6e 656d 7074 795f 646f 6d61 696e  .nonempty_domain
-00014240: 2829 290a 2020 2020 2020 2020 4120 3d20  ()).        A = 
-00014250: 6e70 2e61 7272 6179 280a 2020 2020 2020  np.array(.      
-00014260: 2020 2020 2020 5b62 2261 6161 222c 2062        [b"aaa", b
-00014270: 2262 6262 6262 6262 6262 6262 6262 6262  "bbbbbbbbbbbbbbb
-00014280: 6262 6262 6222 2c20 6222 6363 6363 6363  bbbbb", b"cccccc
-00014290: 6363 6363 6363 6363 6363 6363 6363 6363  cccccccccccccccc
-000142a0: 6363 6322 5d2c 0a20 2020 2020 2020 2020  ccc"],.         
-000142b0: 2020 2064 7479 7065 3d6e 702e 6279 7465     dtype=np.byte
-000142c0: 735f 2c0a 2020 2020 2020 2020 290a 0a20  s_,.        ).. 
-000142d0: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
-000142e0: 6462 2e53 7061 7273 6541 7272 6179 2873  db.SparseArray(s
-000142f0: 656c 662e 7061 7468 2822 666f 6f22 292c  elf.path("foo"),
-00014300: 206d 6f64 653d 2277 2229 2061 7320 543a   mode="w") as T:
-00014310: 0a20 2020 2020 2020 2020 2020 2054 5b5b  .            T[[
-00014320: 3530 2c20 3630 2c20 3130 305d 5d20 3d20  50, 60, 100]] = 
-00014330: 410a 0a20 2020 2020 2020 2077 6974 6820  A..        with 
-00014340: 7469 6c65 6462 2e53 7061 7273 6541 7272  tiledb.SparseArr
-00014350: 6179 2873 656c 662e 7061 7468 2822 666f  ay(self.path("fo
-00014360: 6f22 292c 206d 6f64 653d 2272 2229 2061  o"), mode="r") a
-00014370: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
-00014380: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00014390: 6c28 2828 3530 2c20 3130 3029 2c29 2c20  l(((50, 100),), 
-000143a0: 542e 6e6f 6e65 6d70 7479 5f64 6f6d 6169  T.nonempty_domai
-000143b0: 6e28 2929 0a0a 2020 2020 2020 2020 2020  n())..          
-000143c0: 2020 2320 7265 7472 6965 7665 206a 7573    # retrieve jus
-000143d0: 7420 7661 6c69 6420 636f 6f72 6469 6e61  t valid coordina
-000143e0: 7465 7320 696e 2073 7562 6172 7261 7920  tes in subarray 
-000143f0: 545b 3430 3a36 305d 0a20 2020 2020 2020  T[40:60].       
-00014400: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-00014410: 795f 6571 7561 6c28 545b 3430 3a36 315d  y_equal(T[40:61]
-00014420: 5b22 7822 5d2c 205b 3530 2c20 3630 5d29  ["x"], [50, 60])
-00014430: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00014440: 544f 444f 3a20 6472 6f70 7069 6e67 2063  TODO: dropping c
-00014450: 6f6f 7264 7320 7769 7468 206f 6e65 2061  oords with one a
-00014460: 6e6f 6e20 7661 6c75 6520 7265 7475 726e  non value return
-00014470: 7320 6a75 7374 2061 6e20 6172 7261 790a  s just an array.
-00014480: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-00014490: 3d20 542e 7175 6572 7928 636f 6f72 6473  = T.query(coords
-000144a0: 3d46 616c 7365 295b 3430 3a36 315d 0a20  =False)[40:61]. 
-000144b0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-000144c0: 745f 6172 7261 795f 6571 7561 6c28 7265  t_array_equal(re
-000144d0: 735b 2222 5d2c 2041 5b30 3a32 5d29 0a20  s[""], A[0:2]). 
-000144e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000144f0: 6173 7365 7274 4571 7561 6c28 2822 636f  assertEqual(("co
-00014500: 6f72 6473 2220 696e 2072 6573 292c 2046  ords" in res), F
-00014510: 616c 7365 290a 0a20 2020 2020 2020 2020  alse)..         
-00014520: 2020 2023 2065 6d70 7479 2073 7061 7273     # empty spars
-00014530: 6520 7661 726c 656e 2072 6573 756c 740a  e varlen result.
-00014540: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-00014550: 3d20 545b 3130 3030 5d0a 2020 2020 2020  = T[1000].      
-00014560: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
-00014570: 6179 5f65 7175 616c 2872 6573 5b22 225d  ay_equal(res[""]
-00014580: 2c20 6e70 2e61 7272 6179 2822 222c 2064  , np.array("", d
-00014590: 7479 7065 3d22 5331 2229 290a 2020 2020  type="S1")).    
-000145a0: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
-000145b0: 7272 6179 5f65 7175 616c 2872 6573 5b22  rray_equal(res["
-000145c0: 7822 5d2c 206e 702e 6172 7261 7928 5b5d  x"], np.array([]
-000145d0: 2c20 6474 7970 653d 6e70 2e69 6e74 3634  , dtype=np.int64
-000145e0: 2929 0a0a 2020 2020 6465 6620 7465 7374  ))..    def test
-000145f0: 5f73 7061 7273 655f 756e 6963 6f64 6528  _sparse_unicode(
-00014600: 7365 6c66 2c20 7370 6172 7365 5f63 656c  self, sparse_cel
-00014610: 6c5f 6f72 6465 7229 3a0a 2020 2020 2020  l_order):.      
-00014620: 2020 646f 6d20 3d20 7469 6c65 6462 2e44    dom = tiledb.D
-00014630: 6f6d 6169 6e28 7469 6c65 6462 2e44 696d  omain(tiledb.Dim
-00014640: 2822 7822 2c20 646f 6d61 696e 3d28 312c  ("x", domain=(1,
-00014650: 2031 3030 3030 292c 2074 696c 653d 3130   10000), tile=10
-00014660: 302c 2064 7479 7065 3d69 6e74 2929 0a20  0, dtype=int)). 
-00014670: 2020 2020 2020 2061 7474 203d 2074 696c         att = til
-00014680: 6564 622e 4174 7472 2822 222c 2076 6172  edb.Attr("", var
-00014690: 3d54 7275 652c 2064 7479 7065 3d6e 702e  =True, dtype=np.
-000146a0: 756e 6963 6f64 655f 290a 2020 2020 2020  unicode_).      
-000146b0: 2020 7363 6865 6d61 203d 2074 696c 6564    schema = tiled
-000146c0: 622e 4172 7261 7953 6368 656d 6128 0a20  b.ArraySchema(. 
-000146d0: 2020 2020 2020 2020 2020 2064 6f6d 6169             domai
-000146e0: 6e3d 646f 6d2c 2061 7474 7273 3d28 6174  n=dom, attrs=(at
-000146f0: 742c 292c 2073 7061 7273 653d 5472 7565  t,), sparse=True
-00014700: 2c20 6365 6c6c 5f6f 7264 6572 3d73 7061  , cell_order=spa
-00014710: 7273 655f 6365 6c6c 5f6f 7264 6572 0a20  rse_cell_order. 
-00014720: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00014730: 2074 696c 6564 622e 5370 6172 7365 4172   tiledb.SparseAr
-00014740: 7261 792e 6372 6561 7465 2873 656c 662e  ray.create(self.
-00014750: 7061 7468 2822 666f 6f22 292c 2073 6368  path("foo"), sch
-00014760: 656d 6129 0a0a 2020 2020 2020 2020 7769  ema)..        wi
-00014770: 7468 2074 696c 6564 622e 5370 6172 7365  th tiledb.Sparse
-00014780: 4172 7261 7928 7365 6c66 2e70 6174 6828  Array(self.path(
-00014790: 2266 6f6f 2229 2c20 6d6f 6465 3d22 7222  "foo"), mode="r"
-000147a0: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
-000147b0: 2020 2020 7365 6c66 2e61 7373 6572 7449      self.assertI
-000147c0: 734e 6f6e 6528 542e 6e6f 6e65 6d70 7479  sNone(T.nonempty
-000147d0: 5f64 6f6d 6169 6e28 2929 0a0a 2020 2020  _domain())..    
-000147e0: 2020 2020 4120 3d20 6e70 5f61 7272 6179      A = np_array
-000147f0: 203d 206e 702e 6172 7261 7928 0a20 2020   = np.array(.   
-00014800: 2020 2020 2020 2020 205b 0a20 2020 2020           [.     
-00014810: 2020 2020 2020 2020 2020 2022 3132 3334             "1234
-00014820: 3534 356c 6b6a 616c 7364 666a 222c 0a20  545lkjalsdfj",. 
-00014830: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00014840: 6d6e 6f70 7172 7322 2c0a 2020 2020 2020  mnopqrs",.      
-00014850: 2020 2020 2020 2020 2020 2269 6a6b 6c22            "ijkl"
-00014860: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014870: 2020 2267 6822 2c0a 2020 2020 2020 2020    "gh",.        
-00014880: 2020 2020 2020 2020 2261 6263 6465 6622          "abcdef"
-00014890: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000148a0: 2020 2261 ceb1 62ce b2ce b263 ceb3 ceb3    "a..b....c....
-000148b0: ceb3 64ce b4ce b4ce b4ce b422 2c0a 2020  ..d........",.  
-000148c0: 2020 2020 2020 2020 2020 2020 2020 2261                "a
-000148d0: ceb1 62ce b2ce b263 222c 0a20 2020 2020  ..b....c",.     
-000148e0: 2020 2020 2020 2020 2020 2022 222c 0a20             "",. 
-000148f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00014900: ceb3 ceb3 ceb3 64ce b4ce b4ce b4ce b422  ......d........"
-00014910: 2c0a 2020 2020 2020 2020 2020 2020 5d2c  ,.            ],
-00014920: 0a20 2020 2020 2020 2020 2020 2064 7479  .            dty
-00014930: 7065 3d6f 626a 6563 742c 0a20 2020 2020  pe=object,.     
-00014940: 2020 2029 0a0a 2020 2020 2020 2020 7769     )..        wi
-00014950: 7468 2074 696c 6564 622e 5370 6172 7365  th tiledb.Sparse
-00014960: 4172 7261 7928 7365 6c66 2e70 6174 6828  Array(self.path(
-00014970: 2266 6f6f 2229 2c20 6d6f 6465 3d22 7722  "foo"), mode="w"
-00014980: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
-00014990: 2020 2020 545b 5b33 2c20 342c 2035 2c20      T[[3, 4, 5, 
-000149a0: 362c 2037 2c20 3530 2c20 3630 2c20 3730  6, 7, 50, 60, 70
-000149b0: 2c20 3130 305d 5d20 3d20 410a 0a20 2020  , 100]] = A..   
-000149c0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-000149d0: 2e53 7061 7273 6541 7272 6179 2873 656c  .SparseArray(sel
-000149e0: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
-000149f0: 6f64 653d 2272 2229 2061 7320 543a 0a20  ode="r") as T:. 
-00014a00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00014a10: 6173 7365 7274 4571 7561 6c28 2828 332c  assertEqual(((3,
-00014a20: 2031 3030 292c 292c 2054 2e6e 6f6e 656d   100),), T.nonem
-00014a30: 7074 795f 646f 6d61 696e 2829 290a 0a20  pty_domain()).. 
-00014a40: 2020 2020 2020 2020 2020 2023 2072 6574             # ret
-00014a50: 7269 6576 6520 6a75 7374 2076 616c 6964  rieve just valid
-00014a60: 2063 6f6f 7264 696e 6174 6573 2069 6e20   coordinates in 
-00014a70: 7375 6261 7272 6179 2054 5b34 303a 3630  subarray T[40:60
-00014a80: 5d0a 2020 2020 2020 2020 2020 2020 6173  ].            as
-00014a90: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
-00014aa0: 2854 5b34 303a 3631 5d5b 2278 225d 2c20  (T[40:61]["x"], 
-00014ab0: 5b35 302c 2036 305d 290a 0a20 2020 2020  [50, 60])..     
-00014ac0: 2020 2020 2020 2023 2054 4f44 4f3a 2064         # TODO: d
-00014ad0: 726f 7070 696e 6720 636f 6f72 6473 2077  ropping coords w
-00014ae0: 6974 6820 6f6e 6520 616e 6f6e 2076 616c  ith one anon val
-00014af0: 7565 2072 6574 7572 6e73 206a 7573 7420  ue returns just 
-00014b00: 616e 2061 7272 6179 0a20 2020 2020 2020  an array.       
-00014b10: 2020 2020 2072 6573 203d 2054 2e71 7565       res = T.que
-00014b20: 7279 2863 6f6f 7264 733d 4661 6c73 6529  ry(coords=False)
-00014b30: 5b34 303a 3631 5d0a 2020 2020 2020 2020  [40:61].        
-00014b40: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
-00014b50: 5f65 7175 616c 2872 6573 5b22 225d 2c20  _equal(res[""], 
-00014b60: 415b 353a 375d 290a 2020 2020 2020 2020  A[5:7]).        
-00014b70: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00014b80: 7175 616c 2828 2263 6f6f 7264 7322 2069  qual(("coords" i
-00014b90: 6e20 7265 7329 2c20 4661 6c73 6529 0a0a  n res), False)..
-00014ba0: 2020 2020 2020 2020 2020 2020 2320 656d              # em
-00014bb0: 7074 7920 7370 6172 7365 2076 6172 6c65  pty sparse varle
-00014bc0: 6e20 7265 7375 6c74 0a20 2020 2020 2020  n result.       
-00014bd0: 2020 2020 2072 6573 203d 2054 5b31 3030       res = T[100
-00014be0: 305d 0a20 2020 2020 2020 2020 2020 2061  0].            a
-00014bf0: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
-00014c00: 6c28 7265 735b 2222 5d2c 206e 702e 6172  l(res[""], np.ar
-00014c10: 7261 7928 2222 2c20 6474 7970 653d 2255  ray("", dtype="U
-00014c20: 3122 2929 0a20 2020 2020 2020 2020 2020  1")).           
-00014c30: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-00014c40: 7561 6c28 7265 735b 2278 225d 2c20 6e70  ual(res["x"], np
-00014c50: 2e61 7272 6179 285b 5d2c 2064 7479 7065  .array([], dtype
-00014c60: 3d6e 702e 696e 7436 3429 290a 0a20 2020  =np.int64))..   
-00014c70: 2064 6566 2074 6573 745f 7370 6172 7365   def test_sparse
-00014c80: 5f71 7565 7279 2873 656c 662c 2073 7061  _query(self, spa
-00014c90: 7273 655f 6365 6c6c 5f6f 7264 6572 293a  rse_cell_order):
-00014ca0: 0a20 2020 2020 2020 2075 7269 203d 2073  .        uri = s
-00014cb0: 656c 662e 7061 7468 2822 7465 7374 5f73  elf.path("test_s
-00014cc0: 7061 7273 655f 7175 6572 7922 290a 2020  parse_query").  
-00014cd0: 2020 2020 2020 646f 6d20 3d20 7469 6c65        dom = tile
-00014ce0: 6462 2e44 6f6d 6169 6e28 0a20 2020 2020  db.Domain(.     
-00014cf0: 2020 2020 2020 2074 696c 6564 622e 4469         tiledb.Di
-00014d00: 6d28 2278 222c 2064 6f6d 6169 6e3d 2831  m("x", domain=(1
-00014d10: 2c20 3130 3030 3029 2c20 7469 6c65 3d31  , 10000), tile=1
-00014d20: 3030 2c20 6474 7970 653d 6e70 2e66 6c6f  00, dtype=np.flo
-00014d30: 6174 3634 290a 2020 2020 2020 2020 290a  at64).        ).
-00014d40: 0a20 2020 2020 2020 2061 7474 203d 2074  .        att = t
-00014d50: 696c 6564 622e 4174 7472 2822 222c 2064  iledb.Attr("", d
-00014d60: 7479 7065 3d66 6c6f 6174 290a 2020 2020  type=float).    
-00014d70: 2020 2020 7363 6865 6d61 203d 2074 696c      schema = til
-00014d80: 6564 622e 4172 7261 7953 6368 656d 6128  edb.ArraySchema(
-00014d90: 0a20 2020 2020 2020 2020 2020 2064 6f6d  .            dom
-00014da0: 6169 6e3d 646f 6d2c 2061 7474 7273 3d28  ain=dom, attrs=(
-00014db0: 6174 742c 292c 2073 7061 7273 653d 5472  att,), sparse=Tr
-00014dc0: 7565 2c20 6365 6c6c 5f6f 7264 6572 3d73  ue, cell_order=s
-00014dd0: 7061 7273 655f 6365 6c6c 5f6f 7264 6572  parse_cell_order
-00014de0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00014df0: 2020 2074 696c 6564 622e 5370 6172 7365     tiledb.Sparse
-00014e00: 4172 7261 792e 6372 6561 7465 2875 7269  Array.create(uri
-00014e10: 2c20 7363 6865 6d61 290a 0a20 2020 2020  , schema)..     
-00014e20: 2020 2063 6f6f 7264 7320 3d20 6e70 2e72     coords = np.r
-00014e30: 616e 646f 6d2e 756e 6966 6f72 6d28 6c6f  andom.uniform(lo
-00014e40: 773d 312c 2068 6967 683d 3130 3030 302c  w=1, high=10000,
-00014e50: 2073 697a 653d 3130 3029 0a20 2020 2020   size=100).     
-00014e60: 2020 2064 6174 6120 3d20 6e70 2e72 616e     data = np.ran
-00014e70: 646f 6d2e 7261 6e64 2831 3030 290a 0a20  dom.rand(100).. 
-00014e80: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
-00014e90: 6462 2e53 7061 7273 6541 7272 6179 2875  db.SparseArray(u
-00014ea0: 7269 2c20 6d6f 6465 3d22 7722 2920 6173  ri, mode="w") as
-00014eb0: 2054 3a0a 2020 2020 2020 2020 2020 2020   T:.            
-00014ec0: 545b 636f 6f72 6473 5d20 3d20 6461 7461  T[coords] = data
-00014ed0: 0a0a 2020 2020 2020 2020 2320 5465 7374  ..        # Test
-00014ee0: 2074 6861 7420 5449 4c45 4442 5f55 4e4f   that TILEDB_UNO
-00014ef0: 5244 4552 4544 2077 6f72 6b73 2063 6f72  RDERED works cor
-00014f00: 7265 6374 6c79 0a20 2020 2020 2020 2077  rectly.        w
-00014f10: 6974 6820 7469 6c65 6462 2e53 7061 7273  ith tiledb.Spars
-00014f20: 6541 7272 6179 2875 7269 2c20 6d6f 6465  eArray(uri, mode
-00014f30: 3d22 7222 2920 6173 2041 3a0a 2020 2020  ="r") as A:.    
-00014f40: 2020 2020 2020 2020 7265 7320 3d20 415b          res = A[
-00014f50: 313a 3130 3030 315d 5b22 225d 2020 2320  1:10001][""]  # 
-00014f60: 696e 6465 7820 7061 7374 2074 6865 2065  index past the e
-00014f70: 6e64 2068 6572 6520 746f 2065 6e73 7572  nd here to ensur
-00014f80: 6520 696e 636c 7573 6976 6520 7265 7375  e inclusive resu
-00014f90: 6c74 0a20 2020 2020 2020 2020 2020 2072  lt.            r
-00014fa0: 6573 203d 2041 2e6d 756c 7469 5f69 6e64  es = A.multi_ind
-00014fb0: 6578 5b31 3a31 3030 3030 5d5b 2222 5d0a  ex[1:10000][""].
-00014fc0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00014fd0: 7274 5f61 7272 6179 5f65 7175 616c 286e  rt_array_equal(n
-00014fe0: 702e 736f 7274 2872 6573 292c 206e 702e  p.sort(res), np.
-00014ff0: 736f 7274 2864 6174 6129 290a 2020 2020  sort(data)).    
-00015000: 2020 2020 2020 2020 7265 7320 3d20 412e          res = A.
-00015010: 7175 6572 7928 6f72 6465 723d 2255 2229  query(order="U")
-00015020: 2e6d 756c 7469 5f69 6e64 6578 5b31 3a31  .multi_index[1:1
-00015030: 3030 3030 5d5b 2222 5d0a 2020 2020 2020  0000][""].      
-00015040: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
-00015050: 6179 5f65 7175 616c 286e 702e 736f 7274  ay_equal(np.sort
-00015060: 2872 6573 292c 206e 702e 736f 7274 2864  (res), np.sort(d
-00015070: 6174 6129 290a 0a20 2020 2064 6566 2074  ata))..    def t
-00015080: 6573 745f 7370 6172 7365 5f66 6978 6573  est_sparse_fixes
-00015090: 2873 656c 662c 2073 7061 7273 655f 6365  (self, sparse_ce
-000150a0: 6c6c 5f6f 7264 6572 293a 0a20 2020 2020  ll_order):.     
-000150b0: 2020 2075 7269 203d 2073 656c 662e 7061     uri = self.pa
-000150c0: 7468 2822 7465 7374 5f73 7061 7273 655f  th("test_sparse_
-000150d0: 6669 7865 7322 290a 2020 2020 2020 2020  fixes").        
-000150e0: 2320 696e 6465 7869 6e67 2061 2031 2065  # indexing a 1 e
-000150f0: 6c65 6d65 6e74 2069 7465 6d20 696e 2061  lement item in a
-00015100: 2073 7061 7273 6520 6172 7261 790a 2020   sparse array.  
-00015110: 2020 2020 2020 2320 2869 7373 7565 2064        # (issue d
-00015120: 6972 6563 746c 7920 7265 706f 7274 6564  irectly reported
-00015130: 290a 2020 2020 2020 2020 2320 7468 6520  ).        # the 
-00015140: 7465 7374 2068 6572 6520 6973 2074 6861  test here is tha
-00015150: 7420 7468 6520 696e 6465 7869 6e67 2064  t the indexing d
-00015160: 6f65 7320 6e6f 7420 7261 6973 650a 2020  oes not raise.  
-00015170: 2020 2020 2020 6469 6d73 203d 2028 0a20        dims = (. 
-00015180: 2020 2020 2020 2020 2020 2074 696c 6564             tiled
-00015190: 622e 4469 6d28 2266 6f6f 222c 2064 6f6d  b.Dim("foo", dom
-000151a0: 6169 6e3d 2830 2c20 3629 2c20 7469 6c65  ain=(0, 6), tile
-000151b0: 3d32 292c 0a20 2020 2020 2020 2020 2020  =2),.           
-000151c0: 2074 696c 6564 622e 4469 6d28 2262 6172   tiledb.Dim("bar
-000151d0: 222c 2064 6f6d 6169 6e3d 2830 2c20 3629  ", domain=(0, 6)
-000151e0: 2c20 7469 6c65 3d31 292c 0a20 2020 2020  , tile=1),.     
-000151f0: 2020 2020 2020 2074 696c 6564 622e 4469         tiledb.Di
-00015200: 6d28 2262 617a 222c 2064 6f6d 6169 6e3d  m("baz", domain=
-00015210: 2830 2c20 3130 3029 2c20 7469 6c65 3d31  (0, 100), tile=1
-00015220: 292c 0a20 2020 2020 2020 2029 0a20 2020  ),.        ).   
-00015230: 2020 2020 2064 6f6d 203d 2074 696c 6564       dom = tiled
-00015240: 622e 446f 6d61 696e 282a 6469 6d73 290a  b.Domain(*dims).
-00015250: 2020 2020 2020 2020 6174 7420 3d20 7469          att = ti
-00015260: 6c65 6462 2e41 7474 7228 6e61 6d65 3d22  ledb.Attr(name="
-00015270: 7374 7261 7474 7222 2c20 6474 7970 653d  strattr", dtype=
-00015280: 2253 3122 290a 2020 2020 2020 2020 7363  "S1").        sc
-00015290: 6865 6d61 203d 2074 696c 6564 622e 4172  hema = tiledb.Ar
-000152a0: 7261 7953 6368 656d 6128 0a20 2020 2020  raySchema(.     
-000152b0: 2020 2020 2020 2064 6f6d 6169 6e3d 646f         domain=do
-000152c0: 6d2c 2061 7474 7273 3d28 6174 742c 292c  m, attrs=(att,),
-000152d0: 2073 7061 7273 653d 5472 7565 2c20 6365   sparse=True, ce
-000152e0: 6c6c 5f6f 7264 6572 3d73 7061 7273 655f  ll_order=sparse_
-000152f0: 6365 6c6c 5f6f 7264 6572 0a20 2020 2020  cell_order.     
-00015300: 2020 2029 0a20 2020 2020 2020 2074 696c     ).        til
-00015310: 6564 622e 5370 6172 7365 4172 7261 792e  edb.SparseArray.
-00015320: 6372 6561 7465 2875 7269 2c20 7363 6865  create(uri, sche
-00015330: 6d61 290a 2020 2020 2020 2020 7769 7468  ma).        with
-00015340: 2074 696c 6564 622e 5370 6172 7365 4172   tiledb.SparseAr
-00015350: 7261 7928 7572 6929 2061 7320 543a 0a20  ray(uri) as T:. 
-00015360: 2020 2020 2020 2020 2020 2054 5b3a 5d0a             T[:].
-00015370: 0a20 2020 2020 2020 2023 202d 2074 6573  .        # - tes
-00015380: 7420 7468 6174 2061 7373 6967 6e69 6e67  t that assigning
-00015390: 2069 6e63 6f6d 7061 7469 626c 6520 7661   incompatible va
-000153a0: 6c75 6520 746f 2066 6978 6564 2d6c 656e  lue to fixed-len
-000153b0: 2073 7472 2072 6169 7365 7320 6572 726f   str raises erro
-000153c0: 720a 2020 2020 2020 2020 2320 2d20 7465  r.        # - te
-000153d0: 7374 2074 6861 7420 7661 6c75 652d 636f  st that value-co
-000153e0: 6e76 6572 7369 6f6e 2065 7272 6f72 2072  nversion error r
-000153f0: 6169 7365 7320 6578 6365 7074 696f 6e20  aises exception 
-00015400: 772f 2061 7474 7220 6e61 6d65 2063 6f6e  w/ attr name con
-00015410: 7465 7874 0a20 2020 2020 2020 2063 203d  text.        c =
-00015420: 206e 702e 7673 7461 636b 280a 2020 2020   np.vstack(.    
-00015430: 2020 2020 2020 2020 6c69 7374 2828 782c          list((x,
-00015440: 2079 2c20 7a29 2066 6f72 2078 2069 6e20   y, z) for x in 
-00015450: 7261 6e67 6528 3729 2066 6f72 2079 2069  range(7) for y i
-00015460: 6e20 7261 6e67 6528 3729 2066 6f72 207a  n range(7) for z
-00015470: 2069 6e20 7261 6e67 6528 3130 3129 290a   in range(101)).
-00015480: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00015490: 2020 7769 7468 2074 696c 6564 622e 5370    with tiledb.Sp
-000154a0: 6172 7365 4172 7261 7928 7572 692c 2022  arseArray(uri, "
-000154b0: 7722 2920 6173 2054 3a0a 2020 2020 2020  w") as T:.      
-000154c0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-000154d0: 6173 7365 7274 5261 6973 6573 2856 616c  assertRaises(Val
-000154e0: 7565 4572 726f 7229 3a0a 2020 2020 2020  ueError):.      
-000154f0: 2020 2020 2020 2020 2020 545b 635b 3a2c            T[c[:,
-00015500: 2030 5d2c 2063 5b3a 2c20 315d 2c20 635b   0], c[:, 1], c[
-00015510: 3a2c 2032 5d5d 203d 207b 2273 7472 6174  :, 2]] = {"strat
-00015520: 7472 223a 206e 702e 7261 6e64 6f6d 2e72  tr": np.random.r
-00015530: 616e 6428 372c 2037 2c20 3130 3129 7d0a  and(7, 7, 101)}.
-00015540: 2020 2020 2020 2020 2020 2020 7361 7665              save
-00015550: 5f65 7863 203d 206c 6973 7428 290a 2020  _exc = list().  
-00015560: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00015570: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-00015580: 5b63 5b3a 2c20 305d 2c20 635b 3a2c 2031  [c[:, 0], c[:, 1
-00015590: 5d2c 2063 5b3a 2c20 325d 5d20 3d20 7b22  ], c[:, 2]] = {"
-000155a0: 7374 7261 7474 7222 3a20 6e70 2e72 616e  strattr": np.ran
-000155b0: 646f 6d2e 7261 6e64 2837 2c20 372c 2031  dom.rand(7, 7, 1
-000155c0: 3031 297d 0a20 2020 2020 2020 2020 2020  01)}.           
-000155d0: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
-000155e0: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
-000155f0: 2020 2020 2020 2020 2073 6176 655f 6578           save_ex
-00015600: 632e 6170 7065 6e64 2865 290a 2020 2020  c.append(e).    
-00015610: 2020 2020 2020 2020 6578 6320 3d20 7361          exc = sa
-00015620: 7665 5f65 7863 2e70 6f70 2829 0a20 2020  ve_exc.pop().   
-00015630: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00015640: 7365 7274 4571 7561 6c28 0a20 2020 2020  sertEqual(.     
-00015650: 2020 2020 2020 2020 2020 2073 7472 2865             str(e
-00015660: 7863 2e5f 5f63 6f6e 7465 7874 5f5f 292c  xc.__context__),
-00015670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015680: 2022 4361 6e6e 6f74 2077 7269 7465 2061   "Cannot write a
-00015690: 2073 7472 696e 6720 7661 6c75 6520 746f   string value to
-000156a0: 206e 6f6e 2d73 7472 696e 6720 7479 7065   non-string type
-000156b0: 6420 6174 7472 6962 7574 6520 2773 7472  d attribute 'str
-000156c0: 6174 7472 2721 222c 0a20 2020 2020 2020  attr'!",.       
-000156d0: 2020 2020 2029 0a0a 2020 2020 4074 696c       )..    @til
-000156e0: 6564 622e 7363 6f70 655f 6374 7828 7b22  edb.scope_ctx({"
-000156f0: 736d 2e63 6865 636b 5f63 6f6f 7264 5f64  sm.check_coord_d
-00015700: 7570 7322 3a20 4661 6c73 657d 290a 2020  ups": False}).  
-00015710: 2020 6465 6620 7465 7374 5f73 7061 7273    def test_spars
-00015720: 655f 6669 7865 735f 6368 3135 3630 2873  e_fixes_ch1560(s
-00015730: 656c 662c 2073 7061 7273 655f 6365 6c6c  elf, sparse_cell
-00015740: 5f6f 7264 6572 293a 0a20 2020 2020 2020  _order):.       
-00015750: 2075 7269 203d 2073 656c 662e 7061 7468   uri = self.path
-00015760: 2822 7370 6172 7365 5f66 6978 6573 5f63  ("sparse_fixes_c
-00015770: 6831 3536 3022 290a 2020 2020 2020 2020  h1560").        
-00015780: 7363 6865 6d61 203d 2074 696c 6564 622e  schema = tiledb.
-00015790: 4172 7261 7953 6368 656d 6128 0a20 2020  ArraySchema(.   
-000157a0: 2020 2020 2020 2020 2064 6f6d 6169 6e3d           domain=
-000157b0: 7469 6c65 6462 2e44 6f6d 6169 6e28 0a20  tiledb.Domain(. 
-000157c0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-000157d0: 5b74 696c 6564 622e 4469 6d28 6e61 6d65  [tiledb.Dim(name
-000157e0: 3d22 6964 222c 2064 6f6d 6169 6e3d 2831  ="id", domain=(1
-000157f0: 2c20 3530 3030 292c 2074 696c 653d 3235  , 5000), tile=25
-00015800: 2c20 6474 7970 653d 2269 6e74 3332 2229  , dtype="int32")
-00015810: 5d0a 2020 2020 2020 2020 2020 2020 292c  ].            ),
-00015820: 0a20 2020 2020 2020 2020 2020 2061 7474  .            att
-00015830: 7273 3d5b 0a20 2020 2020 2020 2020 2020  rs=[.           
-00015840: 2020 2020 2074 696c 6564 622e 4174 7472       tiledb.Attr
-00015850: 286e 616d 653d 2261 3122 2c20 6474 7970  (name="a1", dtyp
-00015860: 653d 2264 6174 6574 696d 6536 345b 735d  e="datetime64[s]
-00015870: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-00015880: 2020 2020 7469 6c65 6462 2e41 7474 7228      tiledb.Attr(
-00015890: 6e61 6d65 3d22 6132 222c 2064 7479 7065  name="a2", dtype
-000158a0: 3d22 7c53 3022 292c 0a20 2020 2020 2020  ="|S0"),.       
-000158b0: 2020 2020 2020 2020 2074 696c 6564 622e           tiledb.
-000158c0: 4174 7472 286e 616d 653d 2261 3322 2c20  Attr(name="a3", 
-000158d0: 6474 7970 653d 227c 5330 2229 2c0a 2020  dtype="|S0"),.  
-000158e0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-000158f0: 6c65 6462 2e41 7474 7228 6e61 6d65 3d22  ledb.Attr(name="
-00015900: 6134 222c 2064 7479 7065 3d22 696e 7433  a4", dtype="int3
-00015910: 3222 292c 0a20 2020 2020 2020 2020 2020  2"),.           
-00015920: 2020 2020 2074 696c 6564 622e 4174 7472       tiledb.Attr
-00015930: 286e 616d 653d 2261 3522 2c20 6474 7970  (name="a5", dtyp
-00015940: 653d 2269 6e74 3822 292c 0a20 2020 2020  e="int8"),.     
-00015950: 2020 2020 2020 2020 2020 2074 696c 6564             tiled
-00015960: 622e 4174 7472 286e 616d 653d 2261 3622  b.Attr(name="a6"
-00015970: 2c20 6474 7970 653d 2269 6e74 3332 2229  , dtype="int32")
-00015980: 2c0a 2020 2020 2020 2020 2020 2020 5d2c  ,.            ],
-00015990: 0a20 2020 2020 2020 2020 2020 2063 656c  .            cel
-000159a0: 6c5f 6f72 6465 723d 7370 6172 7365 5f63  l_order=sparse_c
-000159b0: 656c 6c5f 6f72 6465 722c 0a20 2020 2020  ell_order,.     
-000159c0: 2020 2020 2020 2074 696c 655f 6f72 6465         tile_orde
-000159d0: 723d 2272 6f77 2d6d 616a 6f72 222c 0a20  r="row-major",. 
-000159e0: 2020 2020 2020 2020 2020 2073 7061 7273             spars
-000159f0: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
-00015a00: 290a 0a20 2020 2020 2020 2074 696c 6564  )..        tiled
-00015a10: 622e 5370 6172 7365 4172 7261 792e 6372  b.SparseArray.cr
-00015a20: 6561 7465 2875 7269 2c20 7363 6865 6d61  eate(uri, schema
-00015a30: 290a 0a20 2020 2020 2020 2064 6174 6120  )..        data 
-00015a40: 3d20 4f72 6465 7265 6444 6963 7428 0a20  = OrderedDict(. 
-00015a50: 2020 2020 2020 2020 2020 205b 0a20 2020             [.   
-00015a60: 2020 2020 2020 2020 2020 2020 2028 0a20               (. 
-00015a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a80: 2020 2022 6131 222c 0a20 2020 2020 2020     "a1",.       
-00015a90: 2020 2020 2020 2020 2020 2020 206e 702e               np.
-00015aa0: 6172 7261 7928 0a20 2020 2020 2020 2020  array(.         
-00015ab0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00015ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015ad0: 2020 2020 2020 2020 2020 2020 2022 3230               "20
-00015ae0: 3137 2d30 342d 3031 5430 343a 3030 3a30  17-04-01T04:00:0
-00015af0: 3022 2c0a 2020 2020 2020 2020 2020 2020  0",.            
-00015b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b10: 2232 3031 392d 3130 2d30 3154 3030 3a30  "2019-10-01T00:0
-00015b20: 303a 3030 222c 0a20 2020 2020 2020 2020  0:00",.         
-00015b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b40: 2020 2022 3230 3139 2d31 302d 3031 5430     "2019-10-01T0
-00015b50: 303a 3030 3a30 3022 2c0a 2020 2020 2020  0:00:00",.      
-00015b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b70: 2020 2020 2020 2232 3031 392d 3130 2d30        "2019-10-0
-00015b80: 3154 3030 3a30 303a 3030 222c 0a20 2020  1T00:00:00",.   
-00015b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ba0: 2020 2020 205d 2c0a 2020 2020 2020 2020       ],.        
-00015bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015bc0: 6474 7970 653d 2264 6174 6574 696d 6536  dtype="datetime6
-00015bd0: 345b 735d 222c 0a20 2020 2020 2020 2020  4[s]",.         
-00015be0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-00015bf0: 2020 2020 2020 2020 2020 2020 2020 292c                ),
-00015c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015c10: 2028 2261 3222 2c20 5b62 2242 7573 222c   ("a2", [b"Bus",
-00015c20: 2062 2254 6865 2052 4944 4522 2c20 6222   b"The RIDE", b"
-00015c30: 5468 6520 5249 4445 222c 2062 2254 6865  The RIDE", b"The
-00015c40: 2052 4944 4522 5d29 2c0a 2020 2020 2020   RIDE"]),.      
-00015c50: 2020 2020 2020 2020 2020 2822 6133 222c            ("a3",
-00015c60: 205b 6222 4275 7322 2c20 6222 5468 6520   [b"Bus", b"The 
-00015c70: 5249 4445 222c 2062 2254 6865 2052 4944  RIDE", b"The RID
-00015c80: 4522 2c20 6222 5468 6520 5249 4445 225d  E", b"The RIDE"]
-00015c90: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00015ca0: 2020 2028 2261 3422 2c20 6e70 2e61 7272     ("a4", np.arr
-00015cb0: 6179 285b 3639 3131 3732 312c 2031 3338  ay([6911721, 138
-00015cc0: 3034 382c 2031 3338 3034 382c 2031 3338  048, 138048, 138
-00015cd0: 3034 385d 2c20 6474 7970 653d 2269 6e74  048], dtype="int
-00015ce0: 3332 2229 292c 0a20 2020 2020 2020 2020  32")),.         
-00015cf0: 2020 2020 2020 2028 2261 3522 2c20 6e70         ("a5", np
-00015d00: 2e61 7272 6179 285b 3230 2c20 3233 2c20  .array([20, 23, 
-00015d10: 3233 2c20 3233 5d2c 2064 7479 7065 3d22  23, 23], dtype="
-00015d20: 696e 7438 2229 292c 0a20 2020 2020 2020  int8")),.       
-00015d30: 2020 2020 2020 2020 2028 2261 3622 2c20           ("a6", 
-00015d40: 6e70 2e61 7272 6179 285b 3334 3535 3836  np.array([345586
-00015d50: 2c20 3630 3032 2c20 3630 3032 2c20 3630  , 6002, 6002, 60
-00015d60: 3032 5d2c 2064 7479 7065 3d22 696e 7433  02], dtype="int3
-00015d70: 3222 2929 2c0a 2020 2020 2020 2020 2020  2")),.          
-00015d80: 2020 5d0a 2020 2020 2020 2020 290a 0a20    ].        ).. 
-00015d90: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
-00015da0: 6462 2e6f 7065 6e28 7572 692c 2022 7722  db.open(uri, "w"
-00015db0: 2920 6173 2041 3a0a 2020 2020 2020 2020  ) as A:.        
-00015dc0: 2020 2020 415b 5b31 2c20 3436 322c 2034      A[[1, 462, 4
-00015dd0: 3632 2c20 3436 325d 5d20 3d20 6461 7461  62, 462]] = data
-00015de0: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
-00015df0: 696c 6564 622e 6f70 656e 2875 7269 2920  iledb.open(uri) 
-00015e00: 6173 2041 3a0a 2020 2020 2020 2020 2020  as A:.          
-00015e10: 2020 7265 7320 3d20 415b 3a5d 0a20 2020    res = A[:].   
-00015e20: 2020 2020 2020 2020 2072 6573 2e70 6f70           res.pop
-00015e30: 2822 6964 2229 0a20 2020 2020 2020 2020  ("id").         
-00015e40: 2020 2066 6f72 206b 2c20 7620 696e 2072     for k, v in r
-00015e50: 6573 2e69 7465 6d73 2829 3a0a 2020 2020  es.items():.    
-00015e60: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00015e70: 7369 6e73 7461 6e63 6528 6461 7461 5b6b  sinstance(data[k
-00015e80: 5d2c 2028 6e70 2e6e 6461 7272 6179 2c20  ], (np.ndarray, 
-00015e90: 6c69 7374 2929 3a0a 2020 2020 2020 2020  list)):.        
-00015ea0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00015eb0: 7274 5f61 7272 6179 5f65 7175 616c 2872  rt_array_equal(r
-00015ec0: 6573 5b6b 5d2c 2064 6174 615b 6b5d 290a  es[k], data[k]).
-00015ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ee0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00015ef0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00015f00: 7373 6572 7445 7175 616c 2872 6573 5b6b  ssertEqual(res[k
-00015f10: 5d2c 2064 6174 615b 6b5d 290a 0a20 2020  ], data[k])..   
-00015f20: 2064 6566 2074 6573 745f 7370 6172 7365   def test_sparse
-00015f30: 5f32 645f 7661 726c 656e 5f69 6e74 2873  _2d_varlen_int(s
-00015f40: 656c 662c 2073 7061 7273 655f 6365 6c6c  elf, sparse_cell
-00015f50: 5f6f 7264 6572 293a 0a20 2020 2020 2020  _order):.       
-00015f60: 2070 6174 6820 3d20 7365 6c66 2e70 6174   path = self.pat
-00015f70: 6828 2274 6573 745f 7370 6172 7365 5f32  h("test_sparse_2
-00015f80: 645f 7661 726c 656e 5f69 6e74 2229 0a20  d_varlen_int"). 
-00015f90: 2020 2020 2020 2064 7479 7065 203d 206e         dtype = n
-00015fa0: 702e 696e 7433 320a 2020 2020 2020 2020  p.int32.        
-00015fb0: 646f 6d20 3d20 7469 6c65 6462 2e44 6f6d  dom = tiledb.Dom
-00015fc0: 6169 6e28 0a20 2020 2020 2020 2020 2020  ain(.           
-00015fd0: 2074 696c 6564 622e 4469 6d28 646f 6d61   tiledb.Dim(doma
-00015fe0: 696e 3d28 312c 2034 292c 2074 696c 653d  in=(1, 4), tile=
-00015ff0: 3229 2c20 7469 6c65 6462 2e44 696d 2864  2), tiledb.Dim(d
-00016000: 6f6d 6169 6e3d 2831 2c20 3429 2c20 7469  omain=(1, 4), ti
-00016010: 6c65 3d32 290a 2020 2020 2020 2020 290a  le=2).        ).
-00016020: 2020 2020 2020 2020 6174 7420 3d20 7469          att = ti
-00016030: 6c65 6462 2e41 7474 7228 6474 7970 653d  ledb.Attr(dtype=
-00016040: 6474 7970 652c 2076 6172 3d54 7275 6529  dtype, var=True)
-00016050: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
-00016060: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
-00016070: 6865 6d61 280a 2020 2020 2020 2020 2020  hema(.          
-00016080: 2020 646f 6d2c 2028 6174 742c 292c 2073    dom, (att,), s
-00016090: 7061 7273 653d 5472 7565 2c20 6365 6c6c  parse=True, cell
-000160a0: 5f6f 7264 6572 3d73 7061 7273 655f 6365  _order=sparse_ce
-000160b0: 6c6c 5f6f 7264 6572 0a20 2020 2020 2020  ll_order.       
-000160c0: 2029 0a0a 2020 2020 2020 2020 7469 6c65   )..        tile
-000160d0: 6462 2e53 7061 7273 6541 7272 6179 2e63  db.SparseArray.c
-000160e0: 7265 6174 6528 7061 7468 2c20 7363 6865  reate(path, sche
-000160f0: 6d61 290a 0a20 2020 2020 2020 2069 6620  ma)..        if 
-00016100: 7469 6c65 6462 2e6c 6962 7469 6c65 6462  tiledb.libtiledb
-00016110: 2e76 6572 7369 6f6e 2829 203e 3d20 2832  .version() >= (2
-00016120: 2c20 3329 2061 6e64 2073 7061 7273 655f  , 3) and sparse_
-00016130: 6365 6c6c 5f6f 7264 6572 203d 3d20 2268  cell_order == "h
-00016140: 696c 6265 7274 223a 0a20 2020 2020 2020  ilbert":.       
-00016150: 2020 2020 2063 3120 3d20 6e70 2e61 7272       c1 = np.arr
-00016160: 6179 285b 322c 2031 2c20 332c 2034 5d29  ay([2, 1, 3, 4])
-00016170: 0a20 2020 2020 2020 2020 2020 2063 3220  .            c2 
-00016180: 3d20 6e70 2e61 7272 6179 285b 312c 2032  = np.array([1, 2
-00016190: 2c20 332c 2034 5d29 0a20 2020 2020 2020  , 3, 4]).       
-000161a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000161b0: 2020 2063 3120 3d20 6e70 2e61 7272 6179     c1 = np.array
-000161c0: 285b 312c 2032 2c20 332c 2034 5d29 0a20  ([1, 2, 3, 4]). 
-000161d0: 2020 2020 2020 2020 2020 2063 3220 3d20             c2 = 
-000161e0: 6e70 2e61 7272 6179 285b 322c 2031 2c20  np.array([2, 1, 
-000161f0: 332c 2034 5d29 0a0a 2020 2020 2020 2020  3, 4])..        
-00016200: 6461 7461 203d 206e 702e 6172 7261 7928  data = np.array(
-00016210: 0a20 2020 2020 2020 2020 2020 205b 0a20  .            [. 
-00016220: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00016230: 702e 6172 7261 7928 5b31 2c20 315d 2c20  p.array([1, 1], 
-00016240: 6474 7970 653d 6e70 2e69 6e74 3332 292c  dtype=np.int32),
-00016250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016260: 206e 702e 6172 7261 7928 5b32 5d2c 2064   np.array([2], d
-00016270: 7479 7065 3d6e 702e 696e 7433 3229 2c0a  type=np.int32),.
+0000e3a0: 2020 2020 2066 2273 7061 7273 655f 7772       f"sparse_wr
+0000e3b0: 6974 655f 746f 5f64 656e 7365 7b72 616e  ite_to_dense{ran
+0000e3c0: 646f 6d2e 7261 6e64 696e 7428 302c 6e70  dom.randint(0,np
+0000e3d0: 2e75 696e 7436 3428 2d31 2929 7d22 0a20  .uint64(-1))}". 
+0000e3e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000e3f0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e400: 2020 7469 6c65 6462 2e66 726f 6d5f 6e75    tiledb.from_nu
+0000e410: 6d70 7928 7572 692c 2041 292e 636c 6f73  mpy(uri, A).clos
+0000e420: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+0000e430: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+0000e440: 6f70 656e 2875 7269 2c20 2277 2229 2061  open(uri, "w") a
+0000e450: 7320 423a 0a20 2020 2020 2020 2020 2020  s B:.           
+0000e460: 2020 2020 2020 2020 2042 5b73 5d20 3d20           B[s] = 
+0000e470: 760a 0a20 2020 2020 2020 2020 2020 2020  v..             
+0000e480: 2020 2041 5b73 5d20 3d20 760a 2020 2020     A[s] = v.    
+0000e490: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0000e4a0: 2074 696c 6564 622e 6f70 656e 2875 7269   tiledb.open(uri
+0000e4b0: 2920 6173 2042 3a0a 2020 2020 2020 2020  ) as B:.        
+0000e4c0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+0000e4d0: 7274 5f61 7272 6179 5f65 7175 616c 2841  rt_array_equal(A
+0000e4e0: 2c20 425b 3a5d 290a 0a20 2020 2020 2020  , B[:])..       
+0000e4f0: 2044 203d 2041 7373 6967 6e41 6e64 4368   D = AssignAndCh
+0000e500: 6563 6b28 7365 6c66 2c20 352c 2035 290a  eck(self, 5, 5).
+0000e510: 2020 2020 2020 2020 445b 6e70 2e61 7272          D[np.arr
+0000e520: 6179 285b 312c 2032 5d29 2c20 6e70 2e61  ay([1, 2]), np.a
+0000e530: 7272 6179 285b 302c 2030 5d29 5d20 3d20  rray([0, 0])] = 
+0000e540: 6e70 2e61 7272 6179 285b 302c 2032 5d29  np.array([0, 2])
+0000e550: 0a0a 2020 2020 2020 2020 6431 203d 206e  ..        d1 = n
+0000e560: 702e 6172 7261 7928 5b33 2c20 312c 2032  p.array([3, 1, 2
+0000e570: 2c20 332c 2034 5d29 0a20 2020 2020 2020  , 3, 4]).       
+0000e580: 2064 3220 3d20 6e70 2e61 7272 6179 285b   d2 = np.array([
+0000e590: 302c 2031 2c20 312c 2032 2c20 345d 290a  0, 1, 1, 2, 4]).
+0000e5a0: 2020 2020 2020 2020 6461 7461 203d 206e          data = n
+0000e5b0: 702e 6172 7261 7928 5b39 392c 2031 302c  p.array([99, 10,
+0000e5c0: 2032 302c 2033 302c 2034 305d 290a 2020   20, 30, 40]).  
+0000e5d0: 2020 2020 2020 445b 6431 2c20 6432 5d20        D[d1, d2] 
+0000e5e0: 3d20 6461 7461 0a0a 2020 2020 2020 2020  = data..        
+0000e5f0: 2320 544f 444f 2066 6978 2062 726f 6164  # TODO fix broad
+0000e600: 6361 7374 2061 7373 6967 6e6d 656e 742c  cast assignment,
+0000e610: 2065 7870 616e 6420 636f 7665 7261 6765   expand coverage
+0000e620: 0a20 2020 2020 2020 2023 2044 5b31 2c20  .        # D[1, 
+0000e630: 6432 5d20 3d20 6461 7461 0a20 2020 2020  d2] = data.     
+0000e640: 2020 2023 2044 5b64 312c 2031 5d0a 0a20     # D[d1, 1].. 
+0000e650: 2020 2064 6566 2074 6573 745f 7265 6f70     def test_reop
+0000e660: 656e 5f64 656e 7365 5f61 7272 6179 2873  en_dense_array(s
+0000e670: 656c 6629 3a0a 2020 2020 2020 2020 7572  elf):.        ur
+0000e680: 6920 3d20 7365 6c66 2e70 6174 6828 2274  i = self.path("t
+0000e690: 6573 745f 7265 6f70 656e 5f64 656e 7365  est_reopen_dense
+0000e6a0: 5f61 7272 6179 2229 0a0a 2020 2020 2020  _array")..      
+0000e6b0: 2020 646f 6d20 3d20 7469 6c65 6462 2e44    dom = tiledb.D
+0000e6c0: 6f6d 6169 6e28 7469 6c65 6462 2e44 696d  omain(tiledb.Dim
+0000e6d0: 2864 6f6d 6169 6e3d 2830 2c20 3929 2c20  (domain=(0, 9), 
+0000e6e0: 7469 6c65 3d31 302c 2064 7479 7065 3d6e  tile=10, dtype=n
+0000e6f0: 702e 696e 7436 3429 290a 2020 2020 2020  p.int64)).      
+0000e700: 2020 6174 7420 3d20 7469 6c65 6462 2e41    att = tiledb.A
+0000e710: 7474 7228 6474 7970 653d 6e70 2e69 6e74  ttr(dtype=np.int
+0000e720: 3634 290a 2020 2020 2020 2020 7363 6865  64).        sche
+0000e730: 6d61 203d 2074 696c 6564 622e 4172 7261  ma = tiledb.Arra
+0000e740: 7953 6368 656d 6128 646f 6d61 696e 3d64  ySchema(domain=d
+0000e750: 6f6d 2c20 6174 7472 733d 2861 7474 2c29  om, attrs=(att,)
+0000e760: 290a 2020 2020 2020 2020 7469 6c65 6462  ).        tiledb
+0000e770: 2e44 656e 7365 4172 7261 792e 6372 6561  .DenseArray.crea
+0000e780: 7465 2875 7269 2c20 7363 6865 6d61 290a  te(uri, schema).
+0000e790: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+0000e7a0: 6e70 2e61 7261 6e67 6528 302c 2031 302c  np.arange(0, 10,
+0000e7b0: 2064 7479 7065 3d6e 702e 696e 7436 3429   dtype=np.int64)
+0000e7c0: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
+0000e7d0: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
+0000e7e0: 2875 7269 2c20 6d6f 6465 3d22 7722 2c20  (uri, mode="w", 
+0000e7f0: 7469 6d65 7374 616d 703d 3129 2061 7320  timestamp=1) as 
+0000e800: 543a 0a20 2020 2020 2020 2020 2020 2054  T:.            T
+0000e810: 5b3a 5d20 3d20 6461 7461 0a0a 2020 2020  [:] = data..    
+0000e820: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+0000e830: 4465 6e73 6541 7272 6179 2875 7269 2c20  DenseArray(uri, 
+0000e840: 6d6f 6465 3d22 7722 2c20 7469 6d65 7374  mode="w", timest
+0000e850: 616d 703d 3229 2061 7320 543a 0a20 2020  amp=2) as T:.   
+0000e860: 2020 2020 2020 2020 2054 5b3a 5d20 3d20           T[:] = 
+0000e870: 6461 7461 202a 2032 0a0a 2020 2020 2020  data * 2..      
+0000e880: 2020 5420 3d20 7469 6c65 6462 2e44 656e    T = tiledb.Den
+0000e890: 7365 4172 7261 7928 7572 692c 206d 6f64  seArray(uri, mod
+0000e8a0: 653d 2272 222c 2074 696d 6573 7461 6d70  e="r", timestamp
+0000e8b0: 3d31 290a 2020 2020 2020 2020 6173 7365  =1).        asse
+0000e8c0: 7274 5f61 7272 6179 5f65 7175 616c 2854  rt_array_equal(T
+0000e8d0: 5b3a 5d2c 2064 6174 6129 0a0a 2020 2020  [:], data)..    
+0000e8e0: 2020 2020 542e 7265 6f70 656e 2829 0a20      T.reopen(). 
+0000e8f0: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+0000e900: 7261 795f 6571 7561 6c28 545b 3a5d 2c20  ray_equal(T[:], 
+0000e910: 6461 7461 202a 2032 290a 0a20 2020 2020  data * 2)..     
+0000e920: 2020 2054 2e63 6c6f 7365 2829 0a0a 0a63     T.close()...c
+0000e930: 6c61 7373 2054 6573 7456 6172 6c65 6e28  lass TestVarlen(
+0000e940: 4469 736b 5465 7374 4361 7365 293a 0a20  DiskTestCase):. 
+0000e950: 2020 2064 6566 2074 6573 745f 7661 726c     def test_varl
+0000e960: 656e 5f77 7269 7465 5f62 7974 6573 2873  en_write_bytes(s
+0000e970: 656c 6629 3a0a 2020 2020 2020 2020 4120  elf):.        A 
+0000e980: 3d20 6e70 2e61 7272 6179 280a 2020 2020  = np.array(.    
+0000e990: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
+0000e9a0: 2020 2020 2020 2020 2020 2261 6122 2c0a            "aa",.
+0000e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9c0: 2262 6262 222c 0a20 2020 2020 2020 2020  "bbb",.         
+0000e9d0: 2020 2020 2020 2022 6363 6363 6322 2c0a         "ccccc",.
+0000e9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9f0: 2264 6464 6464 6464 6464 6464 6464 6464  "ddddddddddddddd
+0000ea00: 6464 6464 6464 222c 0a20 2020 2020 2020  dddddd",.       
+0000ea10: 2020 2020 2020 2020 2022 6565 222c 0a20           "ee",. 
+0000ea20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000ea30: 6666 6666 6666 222c 0a20 2020 2020 2020  ffffff",.       
+0000ea40: 2020 2020 2020 2020 2022 6722 2c0a 2020           "g",.  
+0000ea50: 2020 2020 2020 2020 2020 2020 2020 2268                "h
+0000ea60: 6868 6868 6868 6868 6822 2c0a 2020 2020  hhhhhhhhh",.    
+0000ea70: 2020 2020 2020 2020 5d2c 0a20 2020 2020          ],.     
+0000ea80: 2020 2020 2020 2064 7479 7065 3d62 7974         dtype=byt
+0000ea90: 6573 2c0a 2020 2020 2020 2020 290a 0a20  es,.        ).. 
+0000eaa0: 2020 2020 2020 2023 2062 6173 6963 2077         # basic w
+0000eab0: 7269 7465 0a20 2020 2020 2020 2064 6f6d  rite.        dom
+0000eac0: 203d 2074 696c 6564 622e 446f 6d61 696e   = tiledb.Domain
+0000ead0: 2874 696c 6564 622e 4469 6d28 646f 6d61  (tiledb.Dim(doma
+0000eae0: 696e 3d28 312c 206c 656e 2841 2929 2c20  in=(1, len(A)), 
+0000eaf0: 7469 6c65 3d6c 656e 2841 2929 290a 2020  tile=len(A))).  
+0000eb00: 2020 2020 2020 6174 7420 3d20 7469 6c65        att = tile
+0000eb10: 6462 2e41 7474 7228 6474 7970 653d 6e70  db.Attr(dtype=np
+0000eb20: 2e62 7974 6573 5f29 0a0a 2020 2020 2020  .bytes_)..      
+0000eb30: 2020 7363 6865 6d61 203d 2074 696c 6564    schema = tiled
+0000eb40: 622e 4172 7261 7953 6368 656d 6128 646f  b.ArraySchema(do
+0000eb50: 6d2c 2028 6174 742c 2929 0a0a 2020 2020  m, (att,))..    
+0000eb60: 2020 2020 7469 6c65 6462 2e44 656e 7365      tiledb.Dense
+0000eb70: 4172 7261 792e 6372 6561 7465 2873 656c  Array.create(sel
+0000eb80: 662e 7061 7468 2822 666f 6f22 292c 2073  f.path("foo"), s
+0000eb90: 6368 656d 6129 0a20 2020 2020 2020 2077  chema).        w
+0000eba0: 6974 6820 7469 6c65 6462 2e44 656e 7365  ith tiledb.Dense
+0000ebb0: 4172 7261 7928 7365 6c66 2e70 6174 6828  Array(self.path(
+0000ebc0: 2266 6f6f 2229 2c20 6d6f 6465 3d22 7722  "foo"), mode="w"
+0000ebd0: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
+0000ebe0: 2020 2020 545b 3a5d 203d 2041 0a0a 2020      T[:] = A..  
+0000ebf0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+0000ec00: 622e 4465 6e73 6541 7272 6179 2873 656c  b.DenseArray(sel
+0000ec10: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
+0000ec20: 6f64 653d 2272 2229 2061 7320 543a 0a20  ode="r") as T:. 
+0000ec30: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+0000ec40: 745f 6172 7261 795f 6571 7561 6c28 415b  t_array_equal(A[
+0000ec50: 3a5d 2c20 545b 3a5d 290a 0a20 2020 2020  :], T[:])..     
+0000ec60: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+0000ec70: 7261 795f 6571 7561 6c28 412c 2054 2e6d  ray_equal(A, T.m
+0000ec80: 756c 7469 5f69 6e64 6578 5b31 203a 206c  ulti_index[1 : l
+0000ec90: 656e 2841 295d 5b22 225d 290a 0a20 2020  en(A)][""])..   
+0000eca0: 2064 6566 2074 6573 745f 7661 726c 656e   def test_varlen
+0000ecb0: 5f73 7061 7273 655f 616c 6c5f 656d 7074  _sparse_all_empt
+0000ecc0: 795f 7374 7269 6e67 7328 7365 6c66 293a  y_strings(self):
+0000ecd0: 0a20 2020 2020 2020 2023 2074 6869 7320  .        # this 
+0000ece0: 7465 7374 2061 6464 7265 7373 6573 2061  test addresses a
+0000ecf0: 2066 6978 2066 6f72 2073 7065 6369 6669   fix for specifi
+0000ed00: 6320 6e65 6564 2066 6f72 2072 6561 6473  c need for reads
+0000ed10: 206f 6e20 610a 2020 2020 2020 2020 2320   on a.        # 
+0000ed20: 6c61 7267 6520 6578 6973 7469 6e67 2061  large existing a
+0000ed30: 7272 6179 2c20 7365 650a 2020 2020 2020  rray, see.      
+0000ed40: 2020 2320 2020 6874 7470 733a 2f2f 6769    #   https://gi
+0000ed50: 7468 7562 2e63 6f6d 2f54 696c 6544 422d  thub.com/TileDB-
+0000ed60: 496e 632f 5469 6c65 4442 2d50 792f 7075  Inc/TileDB-Py/pu
+0000ed70: 6c6c 2f34 3735 0a20 2020 2020 2020 2023  ll/475.        #
+0000ed80: 2077 6520 6375 7272 656e 746c 7920 6861   we currently ha
+0000ed90: 7665 2074 6f20 7772 6974 6520 6120 706c  ve to write a pl
+0000eda0: 6163 6568 6f6c 6465 7220 6174 2074 6865  aceholder at the
+0000edb0: 2065 6e64 2074 6f0a 2020 2020 2020 2020   end to.        
+0000edc0: 2320 6176 6f69 6420 7a65 726f 2d6c 656e  # avoid zero-len
+0000edd0: 6774 6820 6365 6c6c 2065 7272 6f72 0a20  gth cell error. 
+0000ede0: 2020 2020 2020 2023 2054 4f44 4f3a 2066         # TODO: f
+0000edf0: 6f6c 6c6f 772d 7570 2077 6974 6820 696d  ollow-up with im
+0000ee00: 7072 6f76 6564 2074 6573 7469 6e67 2066  proved testing f
+0000ee10: 6f72 2065 6d70 7479 2076 6172 2d6c 656e  or empty var-len
+0000ee20: 6774 682f 7374 7269 6e67 730a 2020 2020  gth/strings.    
+0000ee30: 2020 2020 4120 3d20 6e70 2e61 7272 6179      A = np.array
+0000ee40: 285b 2222 2c20 2222 2c20 2222 2c20 2222  (["", "", "", ""
+0000ee50: 2c20 2222 2c20 225c 7830 3022 5d2c 2064  , "", "\x00"], d
+0000ee60: 7479 7065 3d6f 626a 6563 7429 0a20 2020  type=object).   
+0000ee70: 2020 2020 2064 696d 5f6c 656e 203d 206c       dim_len = l
+0000ee80: 656e 2841 290a 2020 2020 2020 2020 7572  en(A).        ur
+0000ee90: 6920 3d20 7365 6c66 2e70 6174 6828 2276  i = self.path("v
+0000eea0: 6172 6c65 6e5f 616c 6c5f 656d 7074 795f  arlen_all_empty_
+0000eeb0: 7374 7269 6e67 7322 290a 0a20 2020 2020  strings")..     
+0000eec0: 2020 2064 6f6d 203d 2074 696c 6564 622e     dom = tiledb.
+0000eed0: 446f 6d61 696e 2874 696c 6564 622e 4469  Domain(tiledb.Di
+0000eee0: 6d28 646f 6d61 696e 3d28 312c 2064 696d  m(domain=(1, dim
+0000eef0: 5f6c 656e 292c 2074 696c 653d 6469 6d5f  _len), tile=dim_
+0000ef00: 6c65 6e29 290a 2020 2020 2020 2020 6174  len)).        at
+0000ef10: 7420 3d20 7469 6c65 6462 2e41 7474 7228  t = tiledb.Attr(
+0000ef20: 6e61 6d65 3d22 6131 222c 2064 7479 7065  name="a1", dtype
+0000ef30: 3d6e 702e 7374 725f 2c20 7661 723d 5472  =np.str_, var=Tr
+0000ef40: 7565 290a 0a20 2020 2020 2020 2073 6368  ue)..        sch
+0000ef50: 656d 6120 3d20 7469 6c65 6462 2e41 7272  ema = tiledb.Arr
+0000ef60: 6179 5363 6865 6d61 2864 6f6d 2c20 2861  aySchema(dom, (a
+0000ef70: 7474 2c29 2c20 7370 6172 7365 3d54 7275  tt,), sparse=Tru
+0000ef80: 6529 0a0a 2020 2020 2020 2020 7469 6c65  e)..        tile
+0000ef90: 6462 2e41 7272 6179 2e63 7265 6174 6528  db.Array.create(
+0000efa0: 7572 692c 2073 6368 656d 6129 0a0a 2020  uri, schema)..  
+0000efb0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+0000efc0: 622e 6f70 656e 2875 7269 2c20 6d6f 6465  b.open(uri, mode
+0000efd0: 3d22 7722 2920 6173 2054 3a0a 2020 2020  ="w") as T:.    
+0000efe0: 2020 2020 2020 2020 545b 6e70 2e61 7261          T[np.ara
+0000eff0: 6e67 6528 312c 2064 696d 5f6c 656e 202b  nge(1, dim_len +
+0000f000: 2031 295d 203d 207b 2261 3122 3a20 417d   1)] = {"a1": A}
+0000f010: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
+0000f020: 696c 6564 622e 6f70 656e 2875 7269 2c20  iledb.open(uri, 
+0000f030: 6d6f 6465 3d22 7222 2920 6173 2054 3a0a  mode="r") as T:.
+0000f040: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
+0000f050: 6563 6b20 696e 7465 7269 6f72 2072 616e  eck interior ran
+0000f060: 6765 0a20 2020 2020 2020 2020 2020 2061  ge.            a
+0000f070: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+0000f080: 6c28 415b 313a 2d31 5d2c 2054 5b32 3a2d  l(A[1:-1], T[2:-
+0000f090: 315d 5b22 6131 225d 290a 2020 2020 2020  1]["a1"]).      
+0000f0a0: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
+0000f0b0: 6179 5f65 7175 616c 2841 5b31 3a2d 315d  ay_equal(A[1:-1]
+0000f0c0: 2c20 542e 6d75 6c74 695f 696e 6465 785b  , T.multi_index[
+0000f0d0: 3220 3a20 6469 6d5f 6c65 6e20 2d20 315d  2 : dim_len - 1]
+0000f0e0: 5b22 6131 225d 290a 0a20 2020 2064 6566  ["a1"])..    def
+0000f0f0: 2074 6573 745f 7661 726c 656e 5f77 7269   test_varlen_wri
+0000f100: 7465 5f75 6e69 636f 6465 2873 656c 6629  te_unicode(self)
+0000f110: 3a0a 2020 2020 2020 2020 4120 3d20 6e70  :.        A = np
+0000f120: 2e61 7272 6179 280a 2020 2020 2020 2020  .array(.        
+0000f130: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
+0000f140: 2020 2020 2020 2261 6122 2c0a 2020 2020        "aa",.    
+0000f150: 2020 2020 2020 2020 2020 2020 2262 6262              "bbb
+0000f160: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000f170: 2020 2022 6363 6363 6322 2c0a 2020 2020     "ccccc",.    
+0000f180: 2020 2020 2020 2020 2020 2020 2264 6464              "ddd
+0000f190: 6464 6464 6464 6464 6464 6464 6464 6464  dddddddddddddddd
+0000f1a0: 6464 222c 0a20 2020 2020 2020 2020 2020  dd",.           
+0000f1b0: 2020 2020 2022 6565 222c 0a20 2020 2020       "ee",.     
+0000f1c0: 2020 2020 2020 2020 2020 2022 6666 6666             "ffff
+0000f1d0: 6666 222c 0a20 2020 2020 2020 2020 2020  ff",.           
+0000f1e0: 2020 2020 2022 6722 2c0a 2020 2020 2020       "g",.      
+0000f1f0: 2020 2020 2020 2020 2020 2222 2c0a 2020            "",.  
+0000f200: 2020 2020 2020 2020 2020 2020 2020 2268                "h
+0000f210: 6868 6868 6868 6868 6822 2c0a 2020 2020  hhhhhhhhh",.    
+0000f220: 2020 2020 2020 2020 5d2c 0a20 2020 2020          ],.     
+0000f230: 2020 2020 2020 2064 7479 7065 3d6e 702e         dtype=np.
+0000f240: 756e 6963 6f64 655f 2c0a 2020 2020 2020  unicode_,.      
+0000f250: 2020 290a 0a20 2020 2020 2020 2023 2062    )..        # b
+0000f260: 6173 6963 2077 7269 7465 0a20 2020 2020  asic write.     
+0000f270: 2020 2064 6f6d 203d 2074 696c 6564 622e     dom = tiledb.
+0000f280: 446f 6d61 696e 2874 696c 6564 622e 4469  Domain(tiledb.Di
+0000f290: 6d28 646f 6d61 696e 3d28 312c 206c 656e  m(domain=(1, len
+0000f2a0: 2841 2929 2c20 7469 6c65 3d6c 656e 2841  (A)), tile=len(A
+0000f2b0: 2929 290a 2020 2020 2020 2020 6174 7420  ))).        att 
+0000f2c0: 3d20 7469 6c65 6462 2e41 7474 7228 6474  = tiledb.Attr(dt
+0000f2d0: 7970 653d 6e70 2e75 6e69 636f 6465 5f2c  ype=np.unicode_,
+0000f2e0: 2076 6172 3d54 7275 6529 0a0a 2020 2020   var=True)..    
+0000f2f0: 2020 2020 7363 6865 6d61 203d 2074 696c      schema = til
+0000f300: 6564 622e 4172 7261 7953 6368 656d 6128  edb.ArraySchema(
+0000f310: 646f 6d2c 2028 6174 742c 2929 0a0a 2020  dom, (att,))..  
+0000f320: 2020 2020 2020 7469 6c65 6462 2e44 656e        tiledb.Den
+0000f330: 7365 4172 7261 792e 6372 6561 7465 2873  seArray.create(s
+0000f340: 656c 662e 7061 7468 2822 666f 6f22 292c  elf.path("foo"),
+0000f350: 2073 6368 656d 6129 0a20 2020 2020 2020   schema).       
+0000f360: 2077 6974 6820 7469 6c65 6462 2e44 656e   with tiledb.Den
+0000f370: 7365 4172 7261 7928 7365 6c66 2e70 6174  seArray(self.pat
+0000f380: 6828 2266 6f6f 2229 2c20 6d6f 6465 3d22  h("foo"), mode="
+0000f390: 7722 2920 6173 2054 3a0a 2020 2020 2020  w") as T:.      
+0000f3a0: 2020 2020 2020 545b 3a5d 203d 2041 0a0a        T[:] = A..
+0000f3b0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
+0000f3c0: 6564 622e 4465 6e73 6541 7272 6179 2873  edb.DenseArray(s
+0000f3d0: 656c 662e 7061 7468 2822 666f 6f22 292c  elf.path("foo"),
+0000f3e0: 206d 6f64 653d 2272 2229 2061 7320 543a   mode="r") as T:
+0000f3f0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+0000f400: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+0000f410: 415b 3a5d 2c20 545b 3a5d 290a 0a20 2020  A[:], T[:])..   
+0000f420: 2064 6566 2074 6573 745f 7661 726c 656e   def test_varlen
+0000f430: 5f77 7269 7465 5f66 6c6f 6174 7328 7365  _write_floats(se
+0000f440: 6c66 293a 0a20 2020 2020 2020 2023 2047  lf):.        # G
+0000f450: 656e 6572 6174 6573 2038 2076 6172 6961  enerates 8 varia
+0000f460: 626c 652d 6c65 6e67 7468 2066 6c6f 6174  ble-length float
+0000f470: 3634 2073 7562 6172 7261 7973 2028 7375  64 subarrays (su
+0000f480: 6261 7272 6179 206c 656e 2061 6e64 2063  barray len and c
+0000f490: 6f6e 7465 6e74 2061 7265 2072 616e 646f  ontent are rando
+0000f4a0: 6d69 7a65 6429 0a20 2020 2020 2020 2041  mized).        A
+0000f4b0: 203d 206e 702e 6172 7261 7928 0a20 2020   = np.array(.   
+0000f4c0: 2020 2020 2020 2020 205b 6e70 2e72 616e           [np.ran
+0000f4d0: 646f 6d2e 7261 6e64 2878 2920 666f 7220  dom.rand(x) for 
+0000f4e0: 7820 696e 206e 702e 7261 6e64 6f6d 2e72  x in np.random.r
+0000f4f0: 616e 6469 6e74 2831 2c20 3132 2c20 3829  andint(1, 12, 8)
+0000f500: 5d2c 2064 7479 7065 3d6f 626a 6563 740a  ], dtype=object.
+0000f510: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000f520: 2020 2023 2062 6173 6963 2077 7269 7465     # basic write
+0000f530: 0a20 2020 2020 2020 2064 6f6d 203d 2074  .        dom = t
+0000f540: 696c 6564 622e 446f 6d61 696e 2874 696c  iledb.Domain(til
+0000f550: 6564 622e 4469 6d28 646f 6d61 696e 3d28  edb.Dim(domain=(
+0000f560: 312c 206c 656e 2841 2929 2c20 7469 6c65  1, len(A)), tile
+0000f570: 3d6c 656e 2841 2929 290a 2020 2020 2020  =len(A))).      
+0000f580: 2020 6174 7420 3d20 7469 6c65 6462 2e41    att = tiledb.A
+0000f590: 7474 7228 6474 7970 653d 6e70 2e66 6c6f  ttr(dtype=np.flo
+0000f5a0: 6174 3634 2c20 7661 723d 5472 7565 290a  at64, var=True).
+0000f5b0: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
+0000f5c0: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
+0000f5d0: 6865 6d61 2864 6f6d 2c20 2861 7474 2c29  hema(dom, (att,)
+0000f5e0: 290a 2020 2020 2020 2020 7469 6c65 6462  ).        tiledb
+0000f5f0: 2e44 656e 7365 4172 7261 792e 6372 6561  .DenseArray.crea
+0000f600: 7465 2873 656c 662e 7061 7468 2822 666f  te(self.path("fo
+0000f610: 6f22 292c 2073 6368 656d 6129 0a0a 2020  o"), schema)..  
+0000f620: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+0000f630: 622e 4465 6e73 6541 7272 6179 2873 656c  b.DenseArray(sel
+0000f640: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
+0000f650: 6f64 653d 2277 2229 2061 7320 543a 0a20  ode="w") as T:. 
+0000f660: 2020 2020 2020 2020 2020 2054 5b3a 5d20             T[:] 
+0000f670: 3d20 410a 0a20 2020 2020 2020 2077 6974  = A..        wit
+0000f680: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
+0000f690: 7261 7928 7365 6c66 2e70 6174 6828 2266  ray(self.path("f
+0000f6a0: 6f6f 2229 2c20 6d6f 6465 3d22 7222 2920  oo"), mode="r") 
+0000f6b0: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
+0000f6c0: 2020 545f 203d 2054 5b3a 5d0a 2020 2020    T_ = T[:].    
+0000f6d0: 2020 2020 2020 2020 2320 544f 444f 2f6e          # TODO/n
+0000f6e0: 6f74 653a 2074 6865 2072 6574 7572 6e20  ote: the return 
+0000f6f0: 6973 2061 2030 2d65 6c65 6d65 6e74 2061  is a 0-element a
+0000f700: 7272 6179 2e0a 2020 2020 2020 2020 2020  rray..          
+0000f710: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
+0000f720: 7175 616c 2841 5b30 5d2c 2054 5b31 5d5b  qual(A[0], T[1][
+0000f730: 2829 5d29 0a20 2020 2020 2020 2020 2020  ()]).           
+0000f740: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+0000f750: 7561 6c28 415b 2d31 5d2c 2054 5b2d 315d  ual(A[-1], T[-1]
+0000f760: 5b28 295d 290a 2020 2020 2020 2020 2020  [()]).          
+0000f770: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0000f780: 616c 286c 656e 2841 292c 206c 656e 2854  al(len(A), len(T
+0000f790: 5f29 290a 2020 2020 2020 2020 2020 2020  _)).            
+0000f7a0: 2320 6361 6e27 7420 7573 6520 6173 7365  # can't use asse
+0000f7b0: 7274 5f61 7272 6179 5f65 7175 616c 2077  rt_array_equal w
+0000f7c0: 2f20 6f62 6a65 6374 2061 7272 6179 0a20  / object array. 
+0000f7d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f7e0: 6173 7365 7274 5472 7565 2861 6c6c 286e  assertTrue(all(n
+0000f7f0: 702e 6172 7261 795f 6571 7561 6c28 782c  p.array_equal(x,
+0000f800: 2041 5b69 5d29 2066 6f72 2069 2c20 7820   A[i]) for i, x 
+0000f810: 696e 2065 6e75 6d65 7261 7465 2854 5f29  in enumerate(T_)
+0000f820: 2929 0a0a 2020 2020 6465 6620 7465 7374  ))..    def test
+0000f830: 5f76 6172 6c65 6e5f 7772 6974 655f 666c  _varlen_write_fl
+0000f840: 6f61 7473 5f32 6428 7365 6c66 293a 0a20  oats_2d(self):. 
+0000f850: 2020 2020 2020 2041 203d 206e 702e 6172         A = np.ar
+0000f860: 7261 7928 0a20 2020 2020 2020 2020 2020  ray(.           
+0000f870: 205b 6e70 2e72 616e 646f 6d2e 7261 6e64   [np.random.rand
+0000f880: 2878 2920 666f 7220 7820 696e 206e 702e  (x) for x in np.
+0000f890: 6172 616e 6765 2831 2c20 3130 295d 2c20  arange(1, 10)], 
+0000f8a0: 6474 7970 653d 6f62 6a65 6374 0a20 2020  dtype=object.   
+0000f8b0: 2020 2020 2029 2e72 6573 6861 7065 2833       ).reshape(3
+0000f8c0: 2c20 3329 0a0a 2020 2020 2020 2020 2320  , 3)..        # 
+0000f8d0: 6261 7369 6320 7772 6974 650a 2020 2020  basic write.    
+0000f8e0: 2020 2020 646f 6d20 3d20 7469 6c65 6462      dom = tiledb
+0000f8f0: 2e44 6f6d 6169 6e28 0a20 2020 2020 2020  .Domain(.       
+0000f900: 2020 2020 2074 696c 6564 622e 4469 6d28       tiledb.Dim(
+0000f910: 646f 6d61 696e 3d28 312c 2033 292c 2074  domain=(1, 3), t
+0000f920: 696c 653d 6c65 6e28 4129 292c 0a20 2020  ile=len(A)),.   
+0000f930: 2020 2020 2020 2020 2074 696c 6564 622e           tiledb.
+0000f940: 4469 6d28 646f 6d61 696e 3d28 312c 2033  Dim(domain=(1, 3
+0000f950: 292c 2074 696c 653d 6c65 6e28 4129 292c  ), tile=len(A)),
+0000f960: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0000f970: 2020 2061 7474 203d 2074 696c 6564 622e     att = tiledb.
+0000f980: 4174 7472 2864 7479 7065 3d6e 702e 666c  Attr(dtype=np.fl
+0000f990: 6f61 7436 342c 2076 6172 3d54 7275 6529  oat64, var=True)
+0000f9a0: 0a0a 2020 2020 2020 2020 7363 6865 6d61  ..        schema
+0000f9b0: 203d 2074 696c 6564 622e 4172 7261 7953   = tiledb.ArrayS
+0000f9c0: 6368 656d 6128 646f 6d2c 2028 6174 742c  chema(dom, (att,
+0000f9d0: 2929 0a20 2020 2020 2020 2074 696c 6564  )).        tiled
+0000f9e0: 622e 4465 6e73 6541 7272 6179 2e63 7265  b.DenseArray.cre
+0000f9f0: 6174 6528 7365 6c66 2e70 6174 6828 2266  ate(self.path("f
+0000fa00: 6f6f 2229 2c20 7363 6865 6d61 290a 0a20  oo"), schema).. 
+0000fa10: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
+0000fa20: 6462 2e44 656e 7365 4172 7261 7928 7365  db.DenseArray(se
+0000fa30: 6c66 2e70 6174 6828 2266 6f6f 2229 2c20  lf.path("foo"), 
+0000fa40: 6d6f 6465 3d22 7722 2920 6173 2054 3a0a  mode="w") as T:.
+0000fa50: 2020 2020 2020 2020 2020 2020 545b 3a5d              T[:]
+0000fa60: 203d 2041 0a0a 2020 2020 2020 2020 7769   = A..        wi
+0000fa70: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
+0000fa80: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
+0000fa90: 666f 6f22 292c 206d 6f64 653d 2272 2229  foo"), mode="r")
+0000faa0: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
+0000fab0: 2020 2054 5f20 3d20 545b 3a5d 0a20 2020     T_ = T[:].   
+0000fac0: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+0000fad0: 7365 7274 4571 7561 6c28 6c65 6e28 4129  sertEqual(len(A)
+0000fae0: 2c20 6c65 6e28 545f 2929 0a20 2020 2020  , len(T_)).     
+0000faf0: 2020 2020 2020 2023 2063 616e 2774 2075         # can't u
+0000fb00: 7365 2061 7373 6572 745f 6172 7261 795f  se assert_array_
+0000fb10: 6571 7561 6c20 772f 206f 626a 6563 7420  equal w/ object 
+0000fb20: 6172 7261 790a 2020 2020 2020 2020 2020  array.          
+0000fb30: 2020 7365 6c66 2e61 7373 6572 7454 7275    self.assertTru
+0000fb40: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+0000fb50: 2020 206e 702e 616c 6c28 0a20 2020 2020     np.all(.     
+0000fb60: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+0000fb70: 6e70 2e61 7272 6179 5f65 7175 616c 2841  np.array_equal(A
+0000fb80: 2e66 6c61 745b 695d 2c20 545b 3a5d 2e66  .flat[i], T[:].f
+0000fb90: 6c61 745b 695d 2920 666f 7220 6920 696e  lat[i]) for i in
+0000fba0: 206e 702e 6172 616e 6765 2830 2c20 3929   np.arange(0, 9)
+0000fbb0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000fbc0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000fbd0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0000fbe0: 7661 726c 656e 5f77 7269 7465 5f69 6e74  varlen_write_int
+0000fbf0: 5f73 7562 6172 7261 7928 7365 6c66 293a  _subarray(self):
+0000fc00: 0a20 2020 2020 2020 2041 203d 206e 702e  .        A = np.
+0000fc10: 6172 7261 7928 0a20 2020 2020 2020 2020  array(.         
+0000fc20: 2020 206c 6973 7428 0a20 2020 2020 2020     list(.       
+0000fc30: 2020 2020 2020 2020 206d 6170 280a 2020           map(.  
+0000fc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc50: 2020 6c61 6d62 6461 2078 3a20 6e70 2e61    lambda x: np.a
+0000fc60: 7272 6179 2878 2c20 6474 7970 653d 6e70  rray(x, dtype=np
+0000fc70: 2e75 696e 7436 3429 2c0a 2020 2020 2020  .uint64),.      
+0000fc80: 2020 2020 2020 2020 2020 2020 2020 5b6e                [n
+0000fc90: 702e 6172 616e 6765 2869 2c20 3220 2a20  p.arange(i, 2 * 
+0000fca0: 6920 2b20 3129 2066 6f72 2069 2069 6e20  i + 1) for i in 
+0000fcb0: 6e70 2e61 7261 6e67 6528 302c 2031 3629  np.arange(0, 16)
+0000fcc0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0000fcd0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0000fce0: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
+0000fcf0: 6474 7970 653d 224f 222c 0a20 2020 2020  dtype="O",.     
+0000fd00: 2020 2029 2e72 6573 6861 7065 2834 2c20     ).reshape(4, 
+0000fd10: 3429 0a0a 2020 2020 2020 2020 7572 6920  4)..        uri 
+0000fd20: 3d20 7365 6c66 2e70 6174 6828 2274 6573  = self.path("tes
+0000fd30: 745f 7661 726c 656e 5f77 7269 7465 5f69  t_varlen_write_i
+0000fd40: 6e74 5f73 7562 6172 7261 7922 290a 0a20  nt_subarray").. 
+0000fd50: 2020 2020 2020 2064 6f6d 203d 2074 696c         dom = til
+0000fd60: 6564 622e 446f 6d61 696e 280a 2020 2020  edb.Domain(.    
+0000fd70: 2020 2020 2020 2020 7469 6c65 6462 2e44          tiledb.D
+0000fd80: 696d 2864 6f6d 6169 6e3d 2830 2c20 3329  im(domain=(0, 3)
+0000fd90: 2c20 7469 6c65 3d6c 656e 2841 2929 2c0a  , tile=len(A)),.
+0000fda0: 2020 2020 2020 2020 2020 2020 7469 6c65              tile
+0000fdb0: 6462 2e44 696d 2864 6f6d 6169 6e3d 2830  db.Dim(domain=(0
+0000fdc0: 2c20 3329 2c20 7469 6c65 3d6c 656e 2841  , 3), tile=len(A
+0000fdd0: 2929 2c0a 2020 2020 2020 2020 290a 2020  )),.        ).  
+0000fde0: 2020 2020 2020 6174 7420 3d20 7469 6c65        att = tile
+0000fdf0: 6462 2e41 7474 7228 6474 7970 653d 6e70  db.Attr(dtype=np
+0000fe00: 2e75 696e 7436 342c 2076 6172 3d54 7275  .uint64, var=Tru
+0000fe10: 6529 0a20 2020 2020 2020 2073 6368 656d  e).        schem
+0000fe20: 6120 3d20 7469 6c65 6462 2e41 7272 6179  a = tiledb.Array
+0000fe30: 5363 6865 6d61 2864 6f6d 2c20 2861 7474  Schema(dom, (att
+0000fe40: 2c29 290a 0a20 2020 2020 2020 2074 696c  ,))..        til
+0000fe50: 6564 622e 4465 6e73 6541 7272 6179 2e63  edb.DenseArray.c
+0000fe60: 7265 6174 6528 7572 692c 2073 6368 656d  reate(uri, schem
+0000fe70: 6129 0a0a 2020 2020 2020 2020 2320 4e75  a)..        # Nu
+0000fe80: 6d50 7920 666f 7263 6573 2073 696e 676c  mPy forces singl
+0000fe90: 652d 656c 656d 656e 7420 6f62 6a65 6374  e-element object
+0000fea0: 2061 7272 6179 7320 696e 746f 2061 2063   arrays into a c
+0000feb0: 6f6e 7469 6775 6f75 7320 6c61 796f 7574  ontiguous layout
+0000fec0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+0000fed0: 2073 6f20 7765 2061 6c74 6572 6e61 7465   so we alternate
+0000fee0: 2074 6865 2073 697a 6520 746f 2067 6574   the size to get
+0000fef0: 2061 2063 6f6e 7369 7374 656e 7420 6261   a consistent ba
+0000ff00: 7365 6c69 6e65 2061 7272 6179 2e0a 2020  seline array..  
+0000ff10: 2020 2020 2020 415f 6f6e 6573 7477 6f73        A_onestwos
+0000ff20: 203d 206e 702e 6172 7261 7928 0a20 2020   = np.array(.   
+0000ff30: 2020 2020 2020 2020 206c 6973 7428 0a20           list(. 
+0000ff40: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000ff50: 6170 280a 2020 2020 2020 2020 2020 2020  ap(.            
+0000ff60: 2020 2020 2020 2020 6c61 6d62 6461 2078          lambda x
+0000ff70: 3a20 6e70 2e61 7272 6179 2878 2c20 6474  : np.array(x, dt
+0000ff80: 7970 653d 6e70 2e75 696e 7436 3429 2c0a  ype=np.uint64),.
+0000ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffa0: 2020 2020 6c69 7374 285b 2831 2c29 2069      list([(1,) i
+0000ffb0: 6620 7820 2520 3220 3d3d 2030 2065 6c73  f x % 2 == 0 els
+0000ffc0: 6520 2831 2c20 3229 2066 6f72 2078 2069  e (1, 2) for x i
+0000ffd0: 6e20 7261 6e67 6528 3136 295d 292c 0a20  n range(16)]),. 
+0000ffe0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000fff0: 0a20 2020 2020 2020 2020 2020 2029 2c0a  .            ),.
+00010000: 2020 2020 2020 2020 2020 2020 6474 7970              dtyp
+00010010: 653d 6e70 2e64 7479 7065 2822 4f22 292c  e=np.dtype("O"),
+00010020: 0a20 2020 2020 2020 2029 2e72 6573 6861  .        ).resha
+00010030: 7065 2834 2c20 3429 0a0a 2020 2020 2020  pe(4, 4)..      
+00010040: 2020 7769 7468 2074 696c 6564 622e 6f70    with tiledb.op
+00010050: 656e 2875 7269 2c20 2277 2229 2061 7320  en(uri, "w") as 
+00010060: 543a 0a20 2020 2020 2020 2020 2020 2054  T:.            T
+00010070: 5b3a 5d20 3d20 415f 6f6e 6573 7477 6f73  [:] = A_onestwos
+00010080: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
+00010090: 696c 6564 622e 6f70 656e 2875 7269 2c20  iledb.open(uri, 
+000100a0: 2277 2229 2061 7320 543a 0a20 2020 2020  "w") as T:.     
+000100b0: 2020 2020 2020 2054 5b31 3a33 2c20 313a         T[1:3, 1:
+000100c0: 335d 203d 2041 5b31 3a33 2c20 313a 335d  3] = A[1:3, 1:3]
+000100d0: 0a0a 2020 2020 2020 2020 415f 6173 7369  ..        A_assi
+000100e0: 676e 6564 203d 2041 5f6f 6e65 7374 776f  gned = A_onestwo
+000100f0: 732e 636f 7079 2829 0a20 2020 2020 2020  s.copy().       
+00010100: 2041 5f61 7373 6967 6e65 645b 313a 332c   A_assigned[1:3,
+00010110: 2031 3a33 5d20 3d20 415b 313a 332c 2031   1:3] = A[1:3, 1
+00010120: 3a33 5d0a 0a20 2020 2020 2020 2077 6974  :3]..        wit
+00010130: 6820 7469 6c65 6462 2e6f 7065 6e28 7572  h tiledb.open(ur
+00010140: 6929 2061 7320 543a 0a20 2020 2020 2020  i) as T:.       
+00010150: 2020 2020 2061 7373 6572 745f 7375 6261       assert_suba
+00010160: 7272 6179 735f 6571 7561 6c28 415f 6173  rrays_equal(A_as
+00010170: 7369 676e 6564 2c20 545b 3a5d 290a 0a20  signed, T[:]).. 
+00010180: 2020 2064 6566 2074 6573 745f 7661 726c     def test_varl
+00010190: 656e 5f77 7269 7465 5f66 6978 6564 6279  en_write_fixedby
+000101a0: 7465 7328 7365 6c66 293a 0a20 2020 2020  tes(self):.     
+000101b0: 2020 2023 2054 6865 2061 6374 7561 6c20     # The actual 
+000101c0: 6474 7970 6520 6f66 2074 6869 7320 6172  dtype of this ar
+000101d0: 7261 7920 6973 2027 5332 3127 0a20 2020  ray is 'S21'.   
+000101e0: 2020 2020 2041 203d 206e 702e 6172 7261       A = np.arra
+000101f0: 7928 0a20 2020 2020 2020 2020 2020 205b  y(.            [
+00010200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010210: 2022 6161 222c 0a20 2020 2020 2020 2020   "aa",.         
+00010220: 2020 2020 2020 2022 6262 6222 2c0a 2020         "bbb",.  
+00010230: 2020 2020 2020 2020 2020 2020 2020 2263                "c
+00010240: 6363 6363 222c 0a20 2020 2020 2020 2020  cccc",.         
+00010250: 2020 2020 2020 2022 6464 6464 6464 6464         "dddddddd
+00010260: 6464 6464 6464 6464 6464 6464 6422 2c0a  ddddddddddddd",.
+00010270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010280: 2265 6522 2c0a 2020 2020 2020 2020 2020  "ee",.          
+00010290: 2020 2020 2020 2266 6666 6666 6622 2c0a        "ffffff",.
+000102a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000102b0: 2267 222c 0a20 2020 2020 2020 2020 2020  "g",.           
+000102c0: 2020 2020 2022 6868 6868 6868 6868 6868       "hhhhhhhhhh
+000102d0: 222c 0a20 2020 2020 2020 2020 2020 205d  ",.            ]
+000102e0: 2c0a 2020 2020 2020 2020 2020 2020 6474  ,.            dt
+000102f0: 7970 653d 6e70 2e64 7479 7065 2822 5322  ype=np.dtype("S"
+00010300: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+00010310: 2020 2020 2020 2320 6261 7369 6320 7772        # basic wr
+00010320: 6974 650a 2020 2020 2020 2020 646f 6d20  ite.        dom 
+00010330: 3d20 7469 6c65 6462 2e44 6f6d 6169 6e28  = tiledb.Domain(
+00010340: 7469 6c65 6462 2e44 696d 2864 6f6d 6169  tiledb.Dim(domai
+00010350: 6e3d 2831 2c20 6c65 6e28 4129 292c 2074  n=(1, len(A)), t
+00010360: 696c 653d 6c65 6e28 4129 2929 0a20 2020  ile=len(A))).   
+00010370: 2020 2020 2061 7474 203d 2074 696c 6564       att = tiled
+00010380: 622e 4174 7472 2864 7479 7065 3d6e 702e  b.Attr(dtype=np.
+00010390: 6279 7465 735f 290a 0a20 2020 2020 2020  bytes_)..       
+000103a0: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
+000103b0: 2e41 7272 6179 5363 6865 6d61 2864 6f6d  .ArraySchema(dom
+000103c0: 2c20 2861 7474 2c29 290a 0a20 2020 2020  , (att,))..     
+000103d0: 2020 2074 696c 6564 622e 4465 6e73 6541     tiledb.DenseA
+000103e0: 7272 6179 2e63 7265 6174 6528 7365 6c66  rray.create(self
+000103f0: 2e70 6174 6828 2266 6f6f 2229 2c20 7363  .path("foo"), sc
+00010400: 6865 6d61 290a 2020 2020 2020 2020 7769  hema).        wi
+00010410: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
+00010420: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
+00010430: 666f 6f22 292c 206d 6f64 653d 2277 2229  foo"), mode="w")
+00010440: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
+00010450: 2020 2054 5b3a 5d20 3d20 410a 0a20 2020     T[:] = A..   
+00010460: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+00010470: 2e44 656e 7365 4172 7261 7928 7365 6c66  .DenseArray(self
+00010480: 2e70 6174 6828 2266 6f6f 2229 2c20 6d6f  .path("foo"), mo
+00010490: 6465 3d22 7222 2920 6173 2054 3a0a 2020  de="r") as T:.  
+000104a0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+000104b0: 5f61 7272 6179 5f65 7175 616c 2841 5b3a  _array_equal(A[:
+000104c0: 5d2c 2054 5b3a 5d29 0a0a 2020 2020 6465  ], T[:])..    de
+000104d0: 6620 7465 7374 5f76 6172 6c65 6e5f 7772  f test_varlen_wr
+000104e0: 6974 655f 6669 7865 6475 6e69 636f 6465  ite_fixedunicode
+000104f0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00010500: 4120 3d20 6e70 2e61 7272 6179 280a 2020  A = np.array(.  
+00010510: 2020 2020 2020 2020 2020 5b0a 2020 2020            [.    
+00010520: 2020 2020 2020 2020 2020 2020 2261 6122              "aa"
+00010530: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010540: 2020 2262 6262 222c 0a20 2020 2020 2020    "bbb",.       
+00010550: 2020 2020 2020 2020 2022 6363 6363 6322           "ccccc"
+00010560: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010570: 2020 2264 6464 6464 6464 6464 6464 6464    "ddddddddddddd
+00010580: 6464 6464 6464 6464 222c 0a20 2020 2020  dddddddd",.     
+00010590: 2020 2020 2020 2020 2020 2022 6565 222c             "ee",
+000105a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000105b0: 2022 6666 6666 6666 222c 0a20 2020 2020   "ffffff",.     
+000105c0: 2020 2020 2020 2020 2020 2022 222c 0a20             "",. 
+000105d0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000105e0: 6722 2c0a 2020 2020 2020 2020 2020 2020  g",.            
+000105f0: 2020 2020 2268 6868 6868 6868 6868 6822      "hhhhhhhhhh"
+00010600: 2c0a 2020 2020 2020 2020 2020 2020 5d2c  ,.            ],
+00010610: 0a20 2020 2020 2020 2020 2020 2064 7479  .            dty
+00010620: 7065 3d6e 702e 6474 7970 6528 2255 2229  pe=np.dtype("U")
+00010630: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00010640: 2020 2020 2023 2062 6173 6963 2077 7269       # basic wri
+00010650: 7465 0a20 2020 2020 2020 2064 6f6d 203d  te.        dom =
+00010660: 2074 696c 6564 622e 446f 6d61 696e 2874   tiledb.Domain(t
+00010670: 696c 6564 622e 4469 6d28 646f 6d61 696e  iledb.Dim(domain
+00010680: 3d28 312c 206c 656e 2841 2929 2c20 7469  =(1, len(A)), ti
+00010690: 6c65 3d6c 656e 2841 2929 290a 2020 2020  le=len(A))).    
+000106a0: 2020 2020 6174 7420 3d20 7469 6c65 6462      att = tiledb
+000106b0: 2e41 7474 7228 6474 7970 653d 6e70 2e75  .Attr(dtype=np.u
+000106c0: 6e69 636f 6465 5f29 0a0a 2020 2020 2020  nicode_)..      
+000106d0: 2020 7363 6865 6d61 203d 2074 696c 6564    schema = tiled
+000106e0: 622e 4172 7261 7953 6368 656d 6128 646f  b.ArraySchema(do
+000106f0: 6d2c 2028 6174 742c 2929 0a0a 2020 2020  m, (att,))..    
+00010700: 2020 2020 7469 6c65 6462 2e44 656e 7365      tiledb.Dense
+00010710: 4172 7261 792e 6372 6561 7465 2873 656c  Array.create(sel
+00010720: 662e 7061 7468 2822 666f 6f22 292c 2073  f.path("foo"), s
+00010730: 6368 656d 6129 0a20 2020 2020 2020 2077  chema).        w
+00010740: 6974 6820 7469 6c65 6462 2e44 656e 7365  ith tiledb.Dense
+00010750: 4172 7261 7928 7365 6c66 2e70 6174 6828  Array(self.path(
+00010760: 2266 6f6f 2229 2c20 6d6f 6465 3d22 7722  "foo"), mode="w"
+00010770: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
+00010780: 2020 2020 545b 3a5d 203d 2041 0a0a 2020      T[:] = A..  
+00010790: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+000107a0: 622e 4465 6e73 6541 7272 6179 2873 656c  b.DenseArray(sel
+000107b0: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
+000107c0: 6f64 653d 2272 2229 2061 7320 543a 0a20  ode="r") as T:. 
+000107d0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+000107e0: 745f 6172 7261 795f 6571 7561 6c28 415b  t_array_equal(A[
+000107f0: 3a5d 2c20 545b 3a5d 290a 0a20 2020 2064  :], T[:])..    d
+00010800: 6566 2074 6573 745f 7661 726c 656e 5f77  ef test_varlen_w
+00010810: 7269 7465 5f69 6e74 7328 7365 6c66 293a  rite_ints(self):
+00010820: 0a20 2020 2020 2020 2041 203d 206e 702e  .        A = np.
+00010830: 6172 7261 7928 0a20 2020 2020 2020 2020  array(.         
+00010840: 2020 205b 0a20 2020 2020 2020 2020 2020     [.           
+00010850: 2020 2020 206e 702e 7569 6e74 3634 286e       np.uint64(n
+00010860: 702e 7261 6e64 6f6d 2e72 616e 6469 6e74  p.random.randint
+00010870: 2830 2c20 706f 7728 3130 2c20 3629 2c20  (0, pow(10, 6), 
+00010880: 7829 290a 2020 2020 2020 2020 2020 2020  x)).            
+00010890: 2020 2020 666f 7220 7820 696e 206e 702e      for x in np.
+000108a0: 7261 6e64 6f6d 2e72 616e 6469 6e74 2831  random.randint(1
+000108b0: 2c20 3132 2c20 3829 0a20 2020 2020 2020  , 12, 8).       
+000108c0: 2020 2020 205d 2c0a 2020 2020 2020 2020       ],.        
+000108d0: 2020 2020 6474 7970 653d 6f62 6a65 6374      dtype=object
+000108e0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+000108f0: 2020 2020 2023 2062 6173 6963 2077 7269       # basic wri
+00010900: 7465 0a20 2020 2020 2020 2064 6f6d 203d  te.        dom =
+00010910: 2074 696c 6564 622e 446f 6d61 696e 2874   tiledb.Domain(t
+00010920: 696c 6564 622e 4469 6d28 646f 6d61 696e  iledb.Dim(domain
+00010930: 3d28 312c 206c 656e 2841 2929 2c20 7469  =(1, len(A)), ti
+00010940: 6c65 3d6c 656e 2841 2929 290a 2020 2020  le=len(A))).    
+00010950: 2020 2020 6174 7420 3d20 7469 6c65 6462      att = tiledb
+00010960: 2e41 7474 7228 6474 7970 653d 6e70 2e69  .Attr(dtype=np.i
+00010970: 6e74 3634 2c20 7661 723d 5472 7565 290a  nt64, var=True).
+00010980: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
+00010990: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
+000109a0: 6865 6d61 2864 6f6d 2c20 2861 7474 2c29  hema(dom, (att,)
+000109b0: 290a 0a20 2020 2020 2020 2074 696c 6564  )..        tiled
+000109c0: 622e 4465 6e73 6541 7272 6179 2e63 7265  b.DenseArray.cre
+000109d0: 6174 6528 7365 6c66 2e70 6174 6828 2266  ate(self.path("f
+000109e0: 6f6f 2229 2c20 7363 6865 6d61 290a 2020  oo"), schema).  
+000109f0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+00010a00: 622e 4465 6e73 6541 7272 6179 2873 656c  b.DenseArray(sel
+00010a10: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
+00010a20: 6f64 653d 2277 2229 2061 7320 543a 0a20  ode="w") as T:. 
+00010a30: 2020 2020 2020 2020 2020 2054 5b3a 5d20             T[:] 
+00010a40: 3d20 410a 0a20 2020 2020 2020 2077 6974  = A..        wit
+00010a50: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
+00010a60: 7261 7928 7365 6c66 2e70 6174 6828 2266  ray(self.path("f
+00010a70: 6f6f 2229 2c20 6d6f 6465 3d22 7222 2920  oo"), mode="r") 
+00010a80: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
+00010a90: 2020 545f 203d 2054 5b3a 5d0a 2020 2020    T_ = T[:].    
+00010aa0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00010ab0: 6572 7445 7175 616c 286c 656e 2841 292c  ertEqual(len(A),
+00010ac0: 206c 656e 2854 2929 0a20 2020 2020 2020   len(T)).       
+00010ad0: 2020 2020 2023 2063 616e 2774 2075 7365       # can't use
+00010ae0: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+00010af0: 7561 6c20 772f 206f 626a 6563 7420 6172  ual w/ object ar
+00010b00: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
+00010b10: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
+00010b20: 616c 6c28 6e70 2e61 7272 6179 5f65 7175  all(np.array_equ
+00010b30: 616c 2878 2c20 415b 695d 2920 666f 7220  al(x, A[i]) for 
+00010b40: 692c 2078 2069 6e20 656e 756d 6572 6174  i, x in enumerat
+00010b50: 6528 545f 2929 290a 0a20 2020 2064 6566  e(T_)))..    def
+00010b60: 2074 6573 745f 7661 726c 656e 5f77 726f   test_varlen_wro
+00010b70: 6e67 5f64 6f6d 6169 6e28 7365 6c66 293a  ng_domain(self):
+00010b80: 0a20 2020 2020 2020 2041 203d 206e 702e  .        A = np.
+00010b90: 6172 7261 7928 0a20 2020 2020 2020 2020  array(.         
+00010ba0: 2020 205b 0a20 2020 2020 2020 2020 2020     [.           
+00010bb0: 2020 2020 2022 6161 222c 0a20 2020 2020       "aa",.     
+00010bc0: 2020 2020 2020 2020 2020 2022 6262 6222             "bbb"
+00010bd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010be0: 2020 2263 6363 6363 222c 0a20 2020 2020    "ccccc",.     
+00010bf0: 2020 2020 2020 2020 2020 2022 6464 6464             "dddd
+00010c00: 6464 6464 6464 6464 6464 6464 6464 6464  dddddddddddddddd
+00010c10: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
+00010c20: 2020 2020 2265 6522 2c0a 2020 2020 2020      "ee",.      
+00010c30: 2020 2020 2020 2020 2020 2266 6666 6666            "fffff
+00010c40: 6622 2c0a 2020 2020 2020 2020 2020 2020  f",.            
+00010c50: 2020 2020 2267 222c 0a20 2020 2020 2020      "g",.       
+00010c60: 2020 2020 2020 2020 2022 6868 6868 6868           "hhhhhh
+00010c70: 6868 6868 222c 0a20 2020 2020 2020 2020  hhhh",.         
+00010c80: 2020 205d 0a20 2020 2020 2020 2029 0a20     ].        ). 
+00010c90: 2020 2020 2020 2064 6f6d 203d 2074 696c         dom = til
+00010ca0: 6564 622e 446f 6d61 696e 2874 696c 6564  edb.Domain(tiled
+00010cb0: 622e 4469 6d28 646f 6d61 696e 3d28 312c  b.Dim(domain=(1,
+00010cc0: 2033 292c 2074 696c 653d 3329 290a 2020   3), tile=3)).  
+00010cd0: 2020 2020 2020 6174 7420 3d20 7469 6c65        att = tile
+00010ce0: 6462 2e41 7474 7228 6474 7970 653d 6e70  db.Attr(dtype=np
+00010cf0: 2e62 7974 6573 5f29 0a0a 2020 2020 2020  .bytes_)..      
+00010d00: 2020 7363 6865 6d61 203d 2074 696c 6564    schema = tiled
+00010d10: 622e 4172 7261 7953 6368 656d 6128 646f  b.ArraySchema(do
+00010d20: 6d2c 2028 6174 742c 2929 0a0a 2020 2020  m, (att,))..    
+00010d30: 2020 2020 7469 6c65 6462 2e44 656e 7365      tiledb.Dense
+00010d40: 4172 7261 792e 6372 6561 7465 2873 656c  Array.create(sel
+00010d50: 662e 7061 7468 2822 666f 6f22 292c 2073  f.path("foo"), s
+00010d60: 6368 656d 6129 0a20 2020 2020 2020 2077  chema).        w
+00010d70: 6974 6820 7469 6c65 6462 2e44 656e 7365  ith tiledb.Dense
+00010d80: 4172 7261 7928 7365 6c66 2e70 6174 6828  Array(self.path(
+00010d90: 2266 6f6f 2229 2c20 6d6f 6465 3d22 7722  "foo"), mode="w"
+00010da0: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
+00010db0: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
+00010dc0: 7365 7274 5261 6973 6573 2874 696c 6564  sertRaises(tiled
+00010dd0: 622e 5469 6c65 4442 4572 726f 7229 3a0a  b.TileDBError):.
+00010de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010df0: 545b 3a5d 203d 2041 0a0a 2020 2020 6465  T[:] = A..    de
+00010e00: 6620 7465 7374 5f61 7272 6179 5f76 6172  f test_array_var
+00010e10: 6c65 6e5f 6d69 736d 6174 6368 6564 2873  len_mismatched(s
+00010e20: 656c 6629 3a0a 2020 2020 2020 2020 2320  elf):.        # 
+00010e30: 5465 7374 2074 6861 7420 7765 2072 6169  Test that we rai
+00010e40: 7365 2061 2054 7970 6545 7272 6f72 2077  se a TypeError w
+00010e50: 6865 6e20 7061 7373 696e 6720 6120 6865  hen passing a he
+00010e60: 7465 726f 6765 6e65 6f75 7320 6f62 6a65  terogeneous obje
+00010e70: 6374 2061 7272 6179 2e0a 2020 2020 2020  ct array..      
+00010e80: 2020 4120 3d20 6e70 2e61 7272 6179 285b    A = np.array([
+00010e90: 6222 6161 222c 2062 2262 6262 222c 2062  b"aa", b"bbb", b
+00010ea0: 2263 6363 6322 2c20 6e70 2e75 696e 7436  "cccc", np.uint6
+00010eb0: 3428 5b31 2c20 332c 2034 5d29 5d2c 2064  4([1, 3, 4])], d
+00010ec0: 7479 7065 3d6f 626a 6563 7429 0a0a 2020  type=object)..  
+00010ed0: 2020 2020 2020 646f 6d20 3d20 7469 6c65        dom = tile
+00010ee0: 6462 2e44 6f6d 6169 6e28 7469 6c65 6462  db.Domain(tiledb
+00010ef0: 2e44 696d 2864 6f6d 6169 6e3d 2830 2c20  .Dim(domain=(0, 
+00010f00: 3329 2c20 7469 6c65 3d34 2929 0a20 2020  3), tile=4)).   
+00010f10: 2020 2020 2061 7474 203d 2074 696c 6564       att = tiled
+00010f20: 622e 4174 7472 2864 7479 7065 3d6e 702e  b.Attr(dtype=np.
+00010f30: 6279 7465 735f 2c20 7661 723d 5472 7565  bytes_, var=True
+00010f40: 290a 0a20 2020 2020 2020 2073 6368 656d  )..        schem
+00010f50: 6120 3d20 7469 6c65 6462 2e41 7272 6179  a = tiledb.Array
+00010f60: 5363 6865 6d61 2864 6f6d 2c20 2861 7474  Schema(dom, (att
+00010f70: 2c29 290a 0a20 2020 2020 2020 2074 696c  ,))..        til
+00010f80: 6564 622e 4465 6e73 6541 7272 6179 2e63  edb.DenseArray.c
+00010f90: 7265 6174 6528 7365 6c66 2e70 6174 6828  reate(self.path(
+00010fa0: 2266 6f6f 2229 2c20 7363 6865 6d61 290a  "foo"), schema).
+00010fb0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
+00010fc0: 6564 622e 4465 6e73 6541 7272 6179 2873  edb.DenseArray(s
+00010fd0: 656c 662e 7061 7468 2822 666f 6f22 292c  elf.path("foo"),
+00010fe0: 206d 6f64 653d 2277 2229 2061 7320 543a   mode="w") as T:
+00010ff0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00011000: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
+00011010: 7365 7328 5479 7065 4572 726f 7229 3a0a  ses(TypeError):.
+00011020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011030: 545b 3a5d 203d 2041 0a0a 2020 2020 6465  T[:] = A..    de
+00011040: 6620 7465 7374 5f61 7272 6179 5f76 6172  f test_array_var
+00011050: 6c65 6e5f 3264 5f73 5f66 6978 6564 2873  len_2d_s_fixed(s
+00011060: 656c 6629 3a0a 2020 2020 2020 2020 4120  elf):.        A 
+00011070: 3d20 6e70 2e61 7272 6179 280a 2020 2020  = np.array(.    
+00011080: 2020 2020 2020 2020 5b5b 2241 4141 4141          [["AAAAA
+00011090: 4141 4141 6122 2c20 2242 4242 225d 2c20  AAAAa", "BBB"], 
+000110a0: 5b22 4143 4343 222c 2022 4242 4243 4243  ["ACCC", "BBBCBC
+000110b0: 4243 4243 4343 4242 4342 4342 4343 4243  BCBCCCBBCBCBCCBC
+000110c0: 225d 5d2c 2064 7479 7065 3d22 5322 0a20  "]], dtype="S". 
+000110d0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+000110e0: 2020 7572 6920 3d20 7365 6c66 2e70 6174    uri = self.pat
+000110f0: 6828 2276 6172 6c65 6e5f 3264 5f73 5f66  h("varlen_2d_s_f
+00011100: 6978 6564 2229 0a20 2020 2020 2020 2064  ixed").        d
+00011110: 6f6d 203d 2074 696c 6564 622e 446f 6d61  om = tiledb.Doma
+00011120: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
+00011130: 7469 6c65 6462 2e44 696d 286e 616d 653d  tiledb.Dim(name=
+00011140: 2272 6f77 7322 2c20 646f 6d61 696e 3d28  "rows", domain=(
+00011150: 302c 2031 292c 2074 696c 653d 322c 2064  0, 1), tile=2, d
+00011160: 7479 7065 3d6e 702e 696e 7436 3429 2c0a  type=np.int64),.
+00011170: 2020 2020 2020 2020 2020 2020 7469 6c65              tile
+00011180: 6462 2e44 696d 286e 616d 653d 2263 6f6c  db.Dim(name="col
+00011190: 7322 2c20 646f 6d61 696e 3d28 302c 2031  s", domain=(0, 1
+000111a0: 292c 2074 696c 653d 322c 2064 7479 7065  ), tile=2, dtype
+000111b0: 3d6e 702e 696e 7436 3429 2c0a 2020 2020  =np.int64),.    
+000111c0: 2020 2020 290a 0a20 2020 2020 2020 2073      )..        s
+000111d0: 6368 656d 6120 3d20 7469 6c65 6462 2e41  chema = tiledb.A
+000111e0: 7272 6179 5363 6865 6d61 280a 2020 2020  rraySchema(.    
+000111f0: 2020 2020 2020 2020 646f 6d61 696e 3d64          domain=d
+00011200: 6f6d 2c20 7370 6172 7365 3d46 616c 7365  om, sparse=False
+00011210: 2c20 6174 7472 733d 5b74 696c 6564 622e  , attrs=[tiledb.
+00011220: 4174 7472 286e 616d 653d 2261 222c 2064  Attr(name="a", d
+00011230: 7479 7065 3d22 5322 2c20 7661 723d 5472  type="S", var=Tr
+00011240: 7565 295d 0a20 2020 2020 2020 2029 0a0a  ue)].        )..
+00011250: 2020 2020 2020 2020 7469 6c65 6462 2e44          tiledb.D
+00011260: 656e 7365 4172 7261 792e 6372 6561 7465  enseArray.create
+00011270: 2875 7269 2c20 7363 6865 6d61 290a 0a20  (uri, schema).. 
+00011280: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
+00011290: 6462 2e44 656e 7365 4172 7261 7928 7572  db.DenseArray(ur
+000112a0: 692c 206d 6f64 653d 2277 2229 2061 7320  i, mode="w") as 
+000112b0: 543a 0a20 2020 2020 2020 2020 2020 2054  T:.            T
+000112c0: 5b2e 2e2e 5d20 3d20 410a 0a20 2020 2020  [...] = A..     
+000112d0: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
+000112e0: 656e 7365 4172 7261 7928 7572 6929 2061  enseArray(uri) a
+000112f0: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
+00011300: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+00011310: 7561 6c28 412c 2054 290a 0a0a 636c 6173  ual(A, T)...clas
+00011320: 7320 5465 7374 5370 6172 7365 4172 7261  s TestSparseArra
+00011330: 7928 4469 736b 5465 7374 4361 7365 293a  y(DiskTestCase):
+00011340: 0a20 2020 2040 7079 7465 7374 2e6d 6172  .    @pytest.mar
+00011350: 6b2e 7866 6169 6c0a 2020 2020 6465 6620  k.xfail.    def 
+00011360: 7465 7374 5f73 696d 706c 655f 3164 5f73  test_simple_1d_s
+00011370: 7061 7273 655f 7665 6374 6f72 2873 656c  parse_vector(sel
+00011380: 6629 3a0a 2020 2020 2020 2020 646f 6d20  f):.        dom 
+00011390: 3d20 7469 6c65 6462 2e44 6f6d 6169 6e28  = tiledb.Domain(
+000113a0: 7469 6c65 6462 2e44 696d 2864 6f6d 6169  tiledb.Dim(domai
+000113b0: 6e3d 2830 2c20 3329 2c20 7469 6c65 3d34  n=(0, 3), tile=4
+000113c0: 2c20 6474 7970 653d 696e 7429 290a 2020  , dtype=int)).  
+000113d0: 2020 2020 2020 6174 7420 3d20 7469 6c65        att = tile
+000113e0: 6462 2e41 7474 7228 6474 7970 653d 696e  db.Attr(dtype=in
+000113f0: 7429 0a20 2020 2020 2020 2073 6368 656d  t).        schem
+00011400: 6120 3d20 7469 6c65 6462 2e41 7272 6179  a = tiledb.Array
+00011410: 5363 6865 6d61 2864 6f6d 6169 6e3d 646f  Schema(domain=do
+00011420: 6d2c 2061 7474 7273 3d28 6174 742c 292c  m, attrs=(att,),
+00011430: 2073 7061 7273 653d 5472 7565 290a 2020   sparse=True).  
+00011440: 2020 2020 2020 7469 6c65 6462 2e53 7061        tiledb.Spa
+00011450: 7273 6541 7272 6179 2e63 7265 6174 6528  rseArray.create(
+00011460: 7365 6c66 2e70 6174 6828 2266 6f6f 2229  self.path("foo")
+00011470: 2c20 7363 6865 6d61 290a 0a20 2020 2020  , schema)..     
+00011480: 2020 2076 616c 7565 7320 3d20 6e70 2e61     values = np.a
+00011490: 7272 6179 285b 332c 2034 5d29 0a20 2020  rray([3, 4]).   
+000114a0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+000114b0: 2e53 7061 7273 6541 7272 6179 2873 656c  .SparseArray(sel
+000114c0: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
+000114d0: 6f64 653d 2277 2229 2061 7320 543a 0a20  ode="w") as T:. 
+000114e0: 2020 2020 2020 2020 2020 2054 5b5b 312c             T[[1,
+000114f0: 2032 5d5d 203d 2076 616c 7565 730a 0a20   2]] = values.. 
+00011500: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
+00011510: 6462 2e53 7061 7273 6541 7272 6179 2873  db.SparseArray(s
+00011520: 656c 662e 7061 7468 2822 666f 6f22 292c  elf.path("foo"),
+00011530: 206d 6f64 653d 2272 2229 2061 7320 543a   mode="r") as T:
+00011540: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00011550: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+00011560: 545b 5b31 2c20 325d 5d2c 2076 616c 7565  T[[1, 2]], value
+00011570: 7329 0a0a 2020 2020 4070 7974 6573 742e  s)..    @pytest.
+00011580: 6d61 726b 2e78 6661 696c 0a20 2020 2064  mark.xfail.    d
+00011590: 6566 2074 6573 745f 7369 6d70 6c65 5f32  ef test_simple_2
+000115a0: 645f 7370 6172 7365 5f76 6563 746f 7228  d_sparse_vector(
+000115b0: 7365 6c66 293a 0a20 2020 2020 2020 2061  self):.        a
+000115c0: 7474 7220 3d20 7469 6c65 6462 2e41 7474  ttr = tiledb.Att
+000115d0: 7228 6374 782c 2064 7479 7065 3d66 6c6f  r(ctx, dtype=flo
+000115e0: 6174 290a 2020 2020 2020 2020 646f 6d20  at).        dom 
+000115f0: 3d20 7469 6c65 6462 2e44 6f6d 6169 6e28  = tiledb.Domain(
+00011600: 0a20 2020 2020 2020 2020 2020 2074 696c  .            til
+00011610: 6564 622e 4469 6d28 6374 782c 2064 6f6d  edb.Dim(ctx, dom
+00011620: 6169 6e3d 2830 2c20 3329 2c20 7469 6c65  ain=(0, 3), tile
+00011630: 3d34 2c20 6474 7970 653d 696e 7429 2c0a  =4, dtype=int),.
+00011640: 2020 2020 2020 2020 2020 2020 7469 6c65              tile
+00011650: 6462 2e44 696d 2863 7478 2c20 646f 6d61  db.Dim(ctx, doma
+00011660: 696e 3d28 302c 2033 292c 2074 696c 653d  in=(0, 3), tile=
+00011670: 342c 2064 7479 7065 3d69 6e74 292c 0a20  4, dtype=int),. 
+00011680: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00011690: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
+000116a0: 2e41 7272 6179 5363 6865 6d61 2863 7478  .ArraySchema(ctx
+000116b0: 2c20 646f 6d61 696e 3d64 6f6d 2c20 6174  , domain=dom, at
+000116c0: 7472 733d 2861 7474 722c 292c 2073 7061  trs=(attr,), spa
+000116d0: 7273 653d 5472 7565 290a 2020 2020 2020  rse=True).      
+000116e0: 2020 7469 6c65 6462 2e53 7061 7273 6541    tiledb.SparseA
+000116f0: 7272 6179 2e63 7265 6174 6528 7365 6c66  rray.create(self
+00011700: 2e70 6174 6828 2266 6f6f 2229 2c20 7363  .path("foo"), sc
+00011710: 6865 6d61 290a 0a20 2020 2020 2020 2076  hema)..        v
+00011720: 616c 7565 7320 3d20 6e70 2e61 7272 6179  alues = np.array
+00011730: 285b 332c 2034 5d2c 2064 7479 7065 3d66  ([3, 4], dtype=f
+00011740: 6c6f 6174 290a 2020 2020 2020 2020 7769  loat).        wi
+00011750: 7468 2074 696c 6564 622e 5370 6172 7365  th tiledb.Sparse
+00011760: 4172 7261 7928 6374 782c 2073 656c 662e  Array(ctx, self.
+00011770: 7061 7468 2822 666f 6f22 292c 206d 6f64  path("foo"), mod
+00011780: 653d 2277 2229 2061 7320 543a 0a20 2020  e="w") as T:.   
+00011790: 2020 2020 2020 2020 2054 5b5b 312c 2032           T[[1, 2
+000117a0: 5d2c 205b 312c 2032 5d5d 203d 2076 616c  ], [1, 2]] = val
+000117b0: 7565 730a 0a20 2020 2020 2020 2077 6974  ues..        wit
+000117c0: 6820 7469 6c65 6462 2e53 7061 7273 6541  h tiledb.SparseA
+000117d0: 7272 6179 2863 7478 2c20 7365 6c66 2e70  rray(ctx, self.p
+000117e0: 6174 6828 2266 6f6f 2229 2c20 6d6f 6465  ath("foo"), mode
+000117f0: 3d22 7222 2920 6173 2054 3a0a 2020 2020  ="r") as T:.    
+00011800: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+00011810: 7272 6179 5f65 7175 616c 2854 5b5b 312c  rray_equal(T[[1,
+00011820: 2032 5d2c 205b 312c 2032 5d5d 2c20 7661   2], [1, 2]], va
+00011830: 6c75 6573 290a 0a20 2020 2040 7079 7465  lues)..    @pyte
+00011840: 7374 2e6d 6172 6b2e 7866 6169 6c0a 2020  st.mark.xfail.  
+00011850: 2020 6465 6620 7465 7374 5f73 696d 706c    def test_simpl
+00011860: 6533 645f 7370 6172 7365 5f76 6563 746f  e3d_sparse_vecto
+00011870: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
+00011880: 2064 6f6d 203d 2074 696c 6564 622e 446f   dom = tiledb.Do
+00011890: 6d61 696e 280a 2020 2020 2020 2020 2020  main(.          
+000118a0: 2020 6374 782c 0a20 2020 2020 2020 2020    ctx,.         
+000118b0: 2020 2074 696c 6564 622e 4469 6d28 6374     tiledb.Dim(ct
+000118c0: 782c 2022 7822 2c20 646f 6d61 696e 3d28  x, "x", domain=(
+000118d0: 302c 2033 292c 2074 696c 653d 342c 2064  0, 3), tile=4, d
+000118e0: 7479 7065 3d69 6e74 292c 0a20 2020 2020  type=int),.     
+000118f0: 2020 2020 2020 2074 696c 6564 622e 4469         tiledb.Di
+00011900: 6d28 6374 782c 2022 7922 2c20 646f 6d61  m(ctx, "y", doma
+00011910: 696e 3d28 302c 2033 292c 2074 696c 653d  in=(0, 3), tile=
+00011920: 342c 2064 7479 7065 3d69 6e74 292c 0a20  4, dtype=int),. 
+00011930: 2020 2020 2020 2020 2020 2074 696c 6564             tiled
+00011940: 622e 4469 6d28 6374 782c 2022 7a22 2c20  b.Dim(ctx, "z", 
+00011950: 646f 6d61 696e 3d28 302c 2033 292c 2074  domain=(0, 3), t
+00011960: 696c 653d 342c 2064 7479 7065 3d69 6e74  ile=4, dtype=int
+00011970: 292c 0a20 2020 2020 2020 2029 0a20 2020  ),.        ).   
+00011980: 2020 2020 2061 7474 7220 3d20 7469 6c65       attr = tile
+00011990: 6462 2e41 7474 7228 6374 782c 2064 7479  db.Attr(ctx, dty
+000119a0: 7065 3d66 6c6f 6174 290a 2020 2020 2020  pe=float).      
+000119b0: 2020 7363 6865 6d61 203d 2074 696c 6564    schema = tiled
+000119c0: 622e 4172 7261 7953 6368 656d 6128 6374  b.ArraySchema(ct
+000119d0: 782c 2064 6f6d 6169 6e3d 646f 6d2c 2061  x, domain=dom, a
+000119e0: 7474 7273 3d28 6174 7472 2c29 2c20 7370  ttrs=(attr,), sp
+000119f0: 6172 7365 3d54 7275 6529 0a20 2020 2020  arse=True).     
+00011a00: 2020 2074 696c 6564 622e 5370 6172 7365     tiledb.Sparse
+00011a10: 4172 7261 792e 6372 6561 7465 2873 656c  Array.create(sel
+00011a20: 662e 7061 7468 2822 666f 6f22 292c 2073  f.path("foo"), s
+00011a30: 6368 656d 6129 0a0a 2020 2020 2020 2020  chema)..        
+00011a40: 7661 6c75 6573 203d 206e 702e 6172 7261  values = np.arra
+00011a50: 7928 5b33 2c20 345d 2c20 6474 7970 653d  y([3, 4], dtype=
+00011a60: 666c 6f61 7429 0a20 2020 2020 2020 2077  float).        w
+00011a70: 6974 6820 7469 6c65 6462 2e53 7061 7273  ith tiledb.Spars
+00011a80: 6541 7272 6179 2863 7478 2c20 7365 6c66  eArray(ctx, self
+00011a90: 2e70 6174 6828 2266 6f6f 2229 2c20 6d6f  .path("foo"), mo
+00011aa0: 6465 3d22 7722 2920 6173 2054 3a0a 2020  de="w") as T:.  
+00011ab0: 2020 2020 2020 2020 2020 545b 5b31 2c20            T[[1, 
+00011ac0: 325d 2c20 5b31 2c20 325d 2c20 5b31 2c20  2], [1, 2], [1, 
+00011ad0: 325d 5d20 3d20 7661 6c75 6573 0a0a 2020  2]] = values..  
+00011ae0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+00011af0: 622e 5370 6172 7365 4172 7261 7928 6374  b.SparseArray(ct
+00011b00: 782c 2073 656c 662e 7061 7468 2822 666f  x, self.path("fo
+00011b10: 6f22 292c 206d 6f64 653d 2272 2229 2061  o"), mode="r") a
+00011b20: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
+00011b30: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+00011b40: 7561 6c28 545b 5b31 2c20 325d 2c20 5b31  ual(T[[1, 2], [1
+00011b50: 2c20 325d 2c20 5b31 2c20 325d 5d2c 2076  , 2], [1, 2]], v
+00011b60: 616c 7565 7329 0a0a 2020 2020 4070 7974  alues)..    @pyt
+00011b70: 6573 742e 6d61 726b 2e78 6661 696c 0a20  est.mark.xfail. 
+00011b80: 2020 2064 6566 2074 6573 745f 7370 6172     def test_spar
+00011b90: 7365 5f6f 7264 6572 6564 5f66 705f 646f  se_ordered_fp_do
+00011ba0: 6d61 696e 2873 656c 6629 3a0a 2020 2020  main(self):.    
+00011bb0: 2020 2020 646f 6d20 3d20 7469 6c65 6462      dom = tiledb
+00011bc0: 2e44 6f6d 6169 6e28 7469 6c65 6462 2e44  .Domain(tiledb.D
+00011bd0: 696d 2822 7822 2c20 646f 6d61 696e 3d28  im("x", domain=(
+00011be0: 302e 302c 2031 302e 3029 2c20 7469 6c65  0.0, 10.0), tile
+00011bf0: 3d32 2e30 2c20 6474 7970 653d 666c 6f61  =2.0, dtype=floa
+00011c00: 7429 290a 2020 2020 2020 2020 6174 7472  t)).        attr
+00011c10: 203d 2074 696c 6564 622e 4174 7472 2864   = tiledb.Attr(d
+00011c20: 7479 7065 3d66 6c6f 6174 290a 2020 2020  type=float).    
+00011c30: 2020 2020 6174 7472 203d 2074 696c 6564      attr = tiled
+00011c40: 622e 4174 7472 2864 7479 7065 3d66 6c6f  b.Attr(dtype=flo
+00011c50: 6174 290a 2020 2020 2020 2020 7363 6865  at).        sche
+00011c60: 6d61 203d 2074 696c 6564 622e 4172 7261  ma = tiledb.Arra
+00011c70: 7953 6368 656d 6128 646f 6d61 696e 3d64  ySchema(domain=d
+00011c80: 6f6d 2c20 6174 7472 733d 2861 7474 722c  om, attrs=(attr,
+00011c90: 292c 2073 7061 7273 653d 5472 7565 290a  ), sparse=True).
+00011ca0: 2020 2020 2020 2020 7469 6c65 6462 2e53          tiledb.S
+00011cb0: 7061 7273 6541 7272 6179 2e63 7265 6174  parseArray.creat
+00011cc0: 6528 7365 6c66 2e70 6174 6828 2266 6f6f  e(self.path("foo
+00011cd0: 2229 2c20 7363 6865 6d61 290a 0a20 2020  "), schema)..   
+00011ce0: 2020 2020 2076 616c 7565 7320 3d20 6e70       values = np
+00011cf0: 2e61 7272 6179 285b 332e 332c 2032 2e37  .array([3.3, 2.7
+00011d00: 5d29 0a20 2020 2020 2020 2077 6974 6820  ]).        with 
+00011d10: 7469 6c65 6462 2e53 7061 7273 6541 7272  tiledb.SparseArr
+00011d20: 6179 2873 656c 662e 7061 7468 2822 666f  ay(self.path("fo
+00011d30: 6f22 292c 206d 6f64 653d 2277 2229 2061  o"), mode="w") a
+00011d40: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
+00011d50: 2054 5b5b 322e 352c 2034 2e32 5d5d 203d   T[[2.5, 4.2]] =
+00011d60: 2076 616c 7565 730a 2020 2020 2020 2020   values.        
+00011d70: 7769 7468 2074 696c 6564 622e 5370 6172  with tiledb.Spar
+00011d80: 7365 4172 7261 7928 7365 6c66 2e70 6174  seArray(self.pat
+00011d90: 6828 2266 6f6f 2229 2c20 6d6f 6465 3d22  h("foo"), mode="
+00011da0: 7222 2920 6173 2054 3a0a 2020 2020 2020  r") as T:.      
+00011db0: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
+00011dc0: 6179 5f65 7175 616c 2854 5b5b 322e 352c  ay_equal(T[[2.5,
+00011dd0: 2034 2e32 5d5d 2c20 7661 6c75 6573 290a   4.2]], values).
+00011de0: 0a20 2020 2040 7079 7465 7374 2e6d 6172  .    @pytest.mar
+00011df0: 6b2e 7866 6169 6c0a 2020 2020 6465 6620  k.xfail.    def 
+00011e00: 7465 7374 5f73 7061 7273 655f 756e 6f72  test_sparse_unor
+00011e10: 6465 7265 645f 6670 5f64 6f6d 6169 6e28  dered_fp_domain(
+00011e20: 7365 6c66 293a 0a20 2020 2020 2020 2064  self):.        d
+00011e30: 6f6d 203d 2074 696c 6564 622e 446f 6d61  om = tiledb.Doma
+00011e40: 696e 2874 696c 6564 622e 4469 6d28 2278  in(tiledb.Dim("x
+00011e50: 222c 2064 6f6d 6169 6e3d 2830 2e30 2c20  ", domain=(0.0, 
+00011e60: 3130 2e30 292c 2074 696c 653d 322e 302c  10.0), tile=2.0,
+00011e70: 2064 7479 7065 3d66 6c6f 6174 2929 0a20   dtype=float)). 
+00011e80: 2020 2020 2020 2061 7474 7220 3d20 7469         attr = ti
+00011e90: 6c65 6462 2e41 7474 7228 6474 7970 653d  ledb.Attr(dtype=
+00011ea0: 666c 6f61 7429 0a20 2020 2020 2020 2073  float).        s
+00011eb0: 6368 656d 6120 3d20 7469 6c65 6462 2e41  chema = tiledb.A
+00011ec0: 7272 6179 5363 6865 6d61 2864 6f6d 6169  rraySchema(domai
+00011ed0: 6e3d 646f 6d2c 2061 7474 7273 3d28 6174  n=dom, attrs=(at
+00011ee0: 7472 2c29 2c20 7370 6172 7365 3d54 7275  tr,), sparse=Tru
+00011ef0: 6529 0a20 2020 2020 2020 2074 696c 6564  e).        tiled
+00011f00: 622e 5370 6172 7365 4172 7261 792e 6372  b.SparseArray.cr
+00011f10: 6561 7465 2873 656c 662e 7061 7468 2822  eate(self.path("
+00011f20: 666f 6f22 292c 2073 6368 656d 6129 0a20  foo"), schema). 
+00011f30: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
+00011f40: 6e70 2e61 7272 6179 285b 332e 332c 2032  np.array([3.3, 2
+00011f50: 2e37 5d29 0a20 2020 2020 2020 2077 6974  .7]).        wit
+00011f60: 6820 7469 6c65 6462 2e53 7061 7273 6541  h tiledb.SparseA
+00011f70: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
+00011f80: 666f 6f22 292c 206d 6f64 653d 2277 2229  foo"), mode="w")
+00011f90: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
+00011fa0: 2020 2054 5b5b 342e 322c 2032 2e35 5d5d     T[[4.2, 2.5]]
+00011fb0: 203d 2076 616c 7565 730a 0a20 2020 2020   = values..     
+00011fc0: 2020 2077 6974 6820 7469 6c65 6462 2e53     with tiledb.S
+00011fd0: 7061 7273 6541 7272 6179 2873 656c 662e  parseArray(self.
+00011fe0: 7061 7468 2822 666f 6f22 292c 206d 6f64  path("foo"), mod
+00011ff0: 653d 2272 2229 2061 7320 543a 0a20 2020  e="r") as T:.   
+00012000: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+00012010: 6172 7261 795f 6571 7561 6c28 545b 5b32  array_equal(T[[2
+00012020: 2e35 2c20 342e 325d 5d2c 2076 616c 7565  .5, 4.2]], value
+00012030: 735b 3a3a 2d31 5d29 0a0a 2020 2020 4070  s[::-1])..    @p
+00012040: 7974 6573 742e 6d61 726b 2e78 6661 696c  ytest.mark.xfail
+00012050: 0a20 2020 2064 6566 2074 6573 745f 6d75  .    def test_mu
+00012060: 6c74 6970 6c65 5f61 7474 7269 6275 7465  ltiple_attribute
+00012070: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+00012080: 2075 7269 203d 2073 656c 662e 7061 7468   uri = self.path
+00012090: 2829 0a0a 2020 2020 2020 2020 646f 6d20  ()..        dom 
+000120a0: 3d20 7469 6c65 6462 2e44 6f6d 6169 6e28  = tiledb.Domain(
+000120b0: 0a20 2020 2020 2020 2020 2020 2074 696c  .            til
+000120c0: 6564 622e 4469 6d28 646f 6d61 696e 3d28  edb.Dim(domain=(
+000120d0: 312c 2031 3029 2c20 7469 6c65 3d31 302c  1, 10), tile=10,
+000120e0: 2064 7479 7065 3d69 6e74 292c 0a20 2020   dtype=int),.   
+000120f0: 2020 2020 2020 2020 2074 696c 6564 622e           tiledb.
+00012100: 4469 6d28 646f 6d61 696e 3d28 312c 2031  Dim(domain=(1, 1
+00012110: 3029 2c20 7469 6c65 3d31 302c 2064 7479  0), tile=10, dty
+00012120: 7065 3d69 6e74 292c 0a20 2020 2020 2020  pe=int),.       
+00012130: 2029 0a20 2020 2020 2020 2061 7474 725f   ).        attr_
+00012140: 696e 7420 3d20 7469 6c65 6462 2e41 7474  int = tiledb.Att
+00012150: 7228 2269 6e74 7322 2c20 6474 7970 653d  r("ints", dtype=
+00012160: 696e 7429 0a20 2020 2020 2020 2061 7474  int).        att
+00012170: 725f 666c 6f61 7420 3d20 7469 6c65 6462  r_float = tiledb
+00012180: 2e41 7474 7228 2266 6c6f 6174 7322 2c20  .Attr("floats", 
+00012190: 6474 7970 653d 2266 6c6f 6174 2229 0a20  dtype="float"). 
+000121a0: 2020 2020 2020 2073 6368 656d 6120 3d20         schema = 
+000121b0: 7469 6c65 6462 2e41 7272 6179 5363 6865  tiledb.ArraySche
+000121c0: 6d61 280a 2020 2020 2020 2020 2020 2020  ma(.            
+000121d0: 646f 6d61 696e 3d64 6f6d 2c20 6174 7472  domain=dom, attr
+000121e0: 733d 2861 7474 725f 696e 742c 2061 7474  s=(attr_int, att
+000121f0: 725f 666c 6f61 7429 2c20 7370 6172 7365  r_float), sparse
+00012200: 3d54 7275 650a 2020 2020 2020 2020 290a  =True.        ).
+00012210: 2020 2020 2020 2020 7469 6c65 6462 2e53          tiledb.S
+00012220: 7061 7273 6541 7272 6179 2e63 7265 6174  parseArray.creat
+00012230: 6528 7365 6c66 2e70 6174 6828 2266 6f6f  e(self.path("foo
+00012240: 2229 2c20 7363 6865 6d61 290a 0a20 2020  "), schema)..   
+00012250: 2020 2020 2049 203d 206e 702e 6172 7261       I = np.arra
+00012260: 7928 5b31 2c20 312c 2031 2c20 322c 2033  y([1, 1, 1, 2, 3
+00012270: 2c20 332c 2033 2c20 345d 290a 2020 2020  , 3, 3, 4]).    
+00012280: 2020 2020 4a20 3d20 6e70 2e61 7272 6179      J = np.array
+00012290: 285b 312c 2032 2c20 342c 2033 2c20 312c  ([1, 2, 4, 3, 1,
+000122a0: 2036 2c20 372c 2035 5d29 0a0a 2020 2020   6, 7, 5])..    
+000122b0: 2020 2020 565f 696e 7473 203d 206e 702e      V_ints = np.
+000122c0: 6172 7261 7928 5b30 2c20 312c 2032 2c20  array([0, 1, 2, 
+000122d0: 332c 2034 2c20 362c 2037 2c20 355d 290a  3, 4, 6, 7, 5]).
+000122e0: 2020 2020 2020 2020 565f 666c 6f61 7473          V_floats
+000122f0: 203d 206e 702e 6172 7261 7928 5b30 2e30   = np.array([0.0
+00012300: 2c20 312e 302c 2032 2e30 2c20 332e 302c  , 1.0, 2.0, 3.0,
+00012310: 2034 2e30 2c20 362e 302c 2037 2e30 2c20   4.0, 6.0, 7.0, 
+00012320: 352e 305d 290a 0a20 2020 2020 2020 2056  5.0])..        V
+00012330: 203d 207b 2269 6e74 7322 3a20 565f 696e   = {"ints": V_in
+00012340: 7473 2c20 2266 6c6f 6174 7322 3a20 565f  ts, "floats": V_
+00012350: 666c 6f61 7473 7d0a 2020 2020 2020 2020  floats}.        
+00012360: 7769 7468 2074 696c 6564 622e 5370 6172  with tiledb.Spar
+00012370: 7365 4172 7261 7928 7572 692c 206d 6f64  seArray(uri, mod
+00012380: 653d 2277 2229 2061 7320 543a 0a20 2020  e="w") as T:.   
+00012390: 2020 2020 2020 2020 2054 5b49 2c20 4a5d           T[I, J]
+000123a0: 203d 2056 0a20 2020 2020 2020 2077 6974   = V.        wit
+000123b0: 6820 7469 6c65 6462 2e53 7061 7273 6541  h tiledb.SparseA
+000123c0: 7272 6179 2875 7269 2c20 6d6f 6465 3d22  rray(uri, mode="
+000123d0: 7222 2920 6173 2054 3a0a 2020 2020 2020  r") as T:.      
+000123e0: 2020 2020 2020 5220 3d20 545b 492c 204a        R = T[I, J
+000123f0: 5d0a 2020 2020 2020 2020 6173 7365 7274  ].        assert
+00012400: 5f61 7272 6179 5f65 7175 616c 2856 5b22  _array_equal(V["
+00012410: 696e 7473 225d 2c20 525b 2269 6e74 7322  ints"], R["ints"
+00012420: 5d29 0a20 2020 2020 2020 2061 7373 6572  ]).        asser
+00012430: 745f 6172 7261 795f 6571 7561 6c28 565b  t_array_equal(V[
+00012440: 2266 6c6f 6174 7322 5d2c 2052 5b22 666c  "floats"], R["fl
+00012450: 6f61 7473 225d 290a 0a20 2020 2020 2020  oats"])..       
+00012460: 2023 2063 6865 636b 2065 7272 6f72 2061   # check error a
+00012470: 7474 7269 6275 7465 2064 6f65 7320 6e6f  ttribute does no
+00012480: 7420 6578 6973 740a 2020 2020 2020 2020  t exist.        
+00012490: 2320 544f 444f 3a20 7368 6f75 6c64 2074  # TODO: should t
+000124a0: 6869 7320 6265 2061 6e20 6174 7472 6962  his be an attrib
+000124b0: 7574 6520 6572 726f 723f 0a20 2020 2020  ute error?.     
+000124c0: 2020 2077 6974 6820 7469 6c65 6462 2e53     with tiledb.S
+000124d0: 7061 7273 6541 7272 6179 2875 7269 2c20  parseArray(uri, 
+000124e0: 6d6f 6465 3d22 7722 2920 6173 2054 3a0a  mode="w") as T:.
+000124f0: 2020 2020 2020 2020 2020 2020 565b 2266              V["f
+00012500: 6f6f 225d 203d 2056 5b22 696e 7473 225d  oo"] = V["ints"]
+00012510: 2e61 7374 7970 6528 6e70 2e69 6e74 3829  .astype(np.int8)
+00012520: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00012530: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
+00012540: 7365 7328 7469 6c65 6462 2e54 696c 6544  ses(tiledb.TileD
+00012550: 4245 7272 6f72 293a 0a20 2020 2020 2020  BError):.       
+00012560: 2020 2020 2020 2020 2054 5b49 2c20 4a5d           T[I, J]
+00012570: 203d 2056 0a0a 2020 2020 2020 2020 2020   = V..          
+00012580: 2020 2320 6368 6563 6b20 6572 726f 7220    # check error 
+00012590: 6e63 656c 6c73 206c 656e 6774 680a 2020  ncells length.  
+000125a0: 2020 2020 2020 2020 2020 565b 2269 6e74            V["int
+000125b0: 7322 5d20 3d20 565b 2269 6e74 7322 5d5b  s"] = V["ints"][
+000125c0: 313a 325d 2e63 6f70 7928 290a 2020 2020  1:2].copy().    
+000125d0: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+000125e0: 662e 6173 7365 7274 5261 6973 6573 2841  f.assertRaises(A
+000125f0: 7474 7269 6275 7465 4572 726f 7229 3a0a  ttributeError):.
+00012600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012610: 545b 492c 204a 5d20 3d20 560a 0a20 2020  T[I, J] = V..   
+00012620: 2064 6566 2074 6573 745f 7175 6572 795f   def test_query_
+00012630: 7265 616c 5f6d 756c 7469 5f69 6e64 6578  real_multi_index
+00012640: 2873 656c 662c 2073 7061 7273 655f 6365  (self, sparse_ce
+00012650: 6c6c 5f6f 7264 6572 293a 0a20 2020 2020  ll_order):.     
+00012660: 2020 2075 7269 203d 2073 656c 662e 7061     uri = self.pa
+00012670: 7468 2822 7175 6572 795f 7265 616c 5f6d  th("query_real_m
+00012680: 756c 7469 5f69 6e64 6578 2229 0a0a 2020  ulti_index")..  
+00012690: 2020 2020 2020 646f 6d20 3d20 7469 6c65        dom = tile
+000126a0: 6462 2e44 6f6d 6169 6e28 0a20 2020 2020  db.Domain(.     
+000126b0: 2020 2020 2020 2074 696c 6564 622e 4469         tiledb.Di
+000126c0: 6d28 2278 222c 2064 6f6d 6169 6e3d 282d  m("x", domain=(-
+000126d0: 3130 2e30 2c20 3130 2e30 292c 2074 696c  10.0, 10.0), til
+000126e0: 653d 322e 302c 2064 7479 7065 3d66 6c6f  e=2.0, dtype=flo
+000126f0: 6174 290a 2020 2020 2020 2020 290a 2020  at).        ).  
+00012700: 2020 2020 2020 6174 7472 203d 2074 696c        attr = til
+00012710: 6564 622e 4174 7472 2822 6122 2c20 6474  edb.Attr("a", dt
+00012720: 7970 653d 6e70 2e66 6c6f 6174 3332 290a  ype=np.float32).
+00012730: 2020 2020 2020 2020 7363 6865 6d61 203d          schema =
+00012740: 2074 696c 6564 622e 4172 7261 7953 6368   tiledb.ArraySch
+00012750: 656d 6128 0a20 2020 2020 2020 2020 2020  ema(.           
+00012760: 2064 6f6d 6169 6e3d 646f 6d2c 2061 7474   domain=dom, att
+00012770: 7273 3d28 6174 7472 2c29 2c20 7370 6172  rs=(attr,), spar
+00012780: 7365 3d54 7275 652c 2063 656c 6c5f 6f72  se=True, cell_or
+00012790: 6465 723d 7370 6172 7365 5f63 656c 6c5f  der=sparse_cell_
+000127a0: 6f72 6465 720a 2020 2020 2020 2020 290a  order.        ).
+000127b0: 2020 2020 2020 2020 7469 6c65 6462 2e53          tiledb.S
+000127c0: 7061 7273 6541 7272 6179 2e63 7265 6174  parseArray.creat
+000127d0: 6528 7572 692c 2073 6368 656d 6129 0a0a  e(uri, schema)..
+000127e0: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
+000127f0: 206e 702e 6172 7261 7928 5b33 2e33 2c20   np.array([3.3, 
+00012800: 322e 375d 290a 2020 2020 2020 2020 7769  2.7]).        wi
+00012810: 7468 2074 696c 6564 622e 5370 6172 7365  th tiledb.Sparse
+00012820: 4172 7261 7928 7572 692c 206d 6f64 653d  Array(uri, mode=
+00012830: 2277 2229 2061 7320 543a 0a20 2020 2020  "w") as T:.     
+00012840: 2020 2020 2020 2054 5b5b 322e 352c 2034         T[[2.5, 4
+00012850: 2e32 5d5d 203d 2076 616c 7565 730a 2020  .2]] = values.  
+00012860: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+00012870: 622e 5370 6172 7365 4172 7261 7928 7572  b.SparseArray(ur
+00012880: 692c 206d 6f64 653d 2272 2229 2061 7320  i, mode="r") as 
+00012890: 543a 0a20 2020 2020 2020 2020 2020 2061  T:.            a
+000128a0: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+000128b0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+000128c0: 2020 2054 2e71 7565 7279 2863 6f6f 7264     T.query(coord
+000128d0: 733d 5472 7565 292e 6d75 6c74 695f 696e  s=True).multi_in
+000128e0: 6465 785b 2d31 302e 3020 3a20 6e70 2e6e  dex[-10.0 : np.n
+000128f0: 6578 7461 6674 6572 2834 2e32 2c20 3029  extafter(4.2, 0)
+00012900: 5d5b 2261 225d 2c0a 2020 2020 2020 2020  ]["a"],.        
+00012910: 2020 2020 2020 2020 6e70 2e66 6c6f 6174          np.float
+00012920: 3332 2833 2e33 292c 0a20 2020 2020 2020  32(3.3),.       
+00012930: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00012940: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
+00012950: 6571 7561 6c28 0a20 2020 2020 2020 2020  equal(.         
+00012960: 2020 2020 2020 2054 2e71 7565 7279 2863         T.query(c
+00012970: 6f6f 7264 733d 5472 7565 292e 6d75 6c74  oords=True).mult
+00012980: 695f 696e 6465 785b 2d31 302e 3020 3a20  i_index[-10.0 : 
+00012990: 6e70 2e6e 6578 7461 6674 6572 2834 2e32  np.nextafter(4.2
+000129a0: 2c20 3029 5d5b 2278 225d 2c0a 2020 2020  , 0)]["x"],.    
+000129b0: 2020 2020 2020 2020 2020 2020 6e70 2e66              np.f
+000129c0: 6c6f 6174 3332 285b 322e 355d 292c 0a20  loat32([2.5]),. 
+000129d0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000129e0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+000129f0: 6172 7261 795f 6571 7561 6c28 0a20 2020  array_equal(.   
+00012a00: 2020 2020 2020 2020 2020 2020 2054 2e71               T.q
+00012a10: 7565 7279 2863 6f6f 7264 733d 4661 6c73  uery(coords=Fals
+00012a20: 6529 2e6d 756c 7469 5f69 6e64 6578 5b2d  e).multi_index[-
+00012a30: 3130 2e30 3a35 2e30 5d5b 2261 225d 2c0a  10.0:5.0]["a"],.
+00012a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a50: 6e70 2e66 6c6f 6174 3332 285b 332e 332c  np.float32([3.3,
+00012a60: 2032 2e37 5d29 2c0a 2020 2020 2020 2020   2.7]),.        
+00012a70: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00012a80: 2020 7365 6c66 2e61 7373 6572 7454 7275    self.assertTru
+00012a90: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+00012aa0: 2020 2022 636f 6f72 6473 2220 6e6f 7420     "coords" not 
+00012ab0: 696e 2054 2e71 7565 7279 2863 6f6f 7264  in T.query(coord
+00012ac0: 733d 4661 6c73 6529 2e6d 756c 7469 5f69  s=False).multi_i
+00012ad0: 6e64 6578 5b2d 3130 2e30 3a35 2e30 5d0a  ndex[-10.0:5.0].
+00012ae0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00012af0: 2020 2040 7079 7465 7374 2e6d 6172 6b2e     @pytest.mark.
+00012b00: 7061 7261 6d65 7472 697a 6528 2264 7479  parametrize("dty
+00012b10: 7065 222c 2049 4e54 4547 4552 5f44 5459  pe", INTEGER_DTY
+00012b20: 5045 5329 0a20 2020 2064 6566 2074 6573  PES).    def tes
+00012b30: 745f 7370 6172 7365 5f69 6e64 6578 5f64  t_sparse_index_d
+00012b40: 7479 7065 7328 7365 6c66 2c20 6474 7970  types(self, dtyp
+00012b50: 6529 3a0a 2020 2020 2020 2020 7061 7468  e):.        path
+00012b60: 203d 2073 656c 662e 7061 7468 2829 0a20   = self.path(). 
+00012b70: 2020 2020 2020 2064 6174 6120 3d20 6e70         data = np
+00012b80: 2e61 7261 6e67 6528 302c 2033 292e 6173  .arange(0, 3).as
+00012b90: 7479 7065 2864 7479 7065 290a 0a20 2020  type(dtype)..   
+00012ba0: 2020 2020 2073 6368 656d 6120 3d20 7363       schema = sc
+00012bb0: 6865 6d61 5f66 726f 6d5f 6469 6374 2861  hema_from_dict(a
+00012bc0: 7474 7273 3d7b 2261 7474 7222 3a20 6461  ttrs={"attr": da
+00012bd0: 7461 7d2c 2064 696d 733d 7b22 6430 223a  ta}, dims={"d0":
+00012be0: 2064 6174 617d 290a 2020 2020 2020 2020   data}).        
+00012bf0: 7469 6c65 6462 2e53 7061 7273 6541 7272  tiledb.SparseArr
+00012c00: 6179 2e63 7265 6174 6528 7061 7468 2c20  ay.create(path, 
+00012c10: 7363 6865 6d61 290a 0a20 2020 2020 2020  schema)..       
+00012c20: 2077 6974 6820 7469 6c65 6462 2e6f 7065   with tiledb.ope
+00012c30: 6e28 7061 7468 2c20 2277 2229 2061 7320  n(path, "w") as 
+00012c40: 413a 0a20 2020 2020 2020 2020 2020 2041  A:.            A
+00012c50: 5b64 6174 615d 203d 2064 6174 610a 0a20  [data] = data.. 
+00012c60: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
+00012c70: 6462 2e6f 7065 6e28 7061 7468 2920 6173  db.open(path) as
+00012c80: 2042 3a0a 2020 2020 2020 2020 2020 2020   B:.            
+00012c90: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
+00012ca0: 616c 2842 5b3a 5d5b 2261 7474 7222 5d2c  al(B[:]["attr"],
+00012cb0: 2064 6174 6129 0a20 2020 2020 2020 2020   data).         
+00012cc0: 2020 2061 7373 6572 7420 425b 6461 7461     assert B[data
+00012cd0: 5b30 5d5d 5b22 6174 7472 225d 203d 3d20  [0]]["attr"] == 
+00012ce0: 6461 7461 5b30 5d0a 2020 2020 2020 2020  data[0].        
+00012cf0: 2020 2020 6173 7365 7274 2042 5b64 6174      assert B[dat
+00012d00: 615b 315d 5d5b 2261 7474 7222 5d20 3d3d  a[1]]["attr"] ==
+00012d10: 2064 6174 615b 315d 0a20 2020 2020 2020   data[1].       
+00012d20: 2020 2020 2061 7373 6572 7420 422e 6d75       assert B.mu
+00012d30: 6c74 695f 696e 6465 785b 6461 7461 5b30  lti_index[data[0
+00012d40: 5d5d 5b22 6174 7472 225d 203d 3d20 6461  ]]["attr"] == da
+00012d50: 7461 5b30 5d0a 0a20 2020 2064 6566 2074  ta[0]..    def t
+00012d60: 6573 745f 7175 6572 795f 7265 616c 5f65  est_query_real_e
+00012d70: 7861 6374 2873 656c 662c 2073 7061 7273  xact(self, spars
+00012d80: 655f 6365 6c6c 5f6f 7264 6572 293a 0a20  e_cell_order):. 
+00012d90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00012da0: 2020 2054 6573 7420 616e 6420 6465 6d6f     Test and demo
+00012db0: 206f 6620 7175 6572 7969 6e67 2061 7420   of querying at 
+00012dc0: 666c 6f61 7469 6e67 2070 6f69 6e74 2072  floating point r
+00012dd0: 6570 7265 7365 6e74 6162 6c65 2062 6f75  epresentable bou
+00012de0: 6e64 6172 6965 730a 0a20 2020 2020 2020  ndaries..       
+00012df0: 2043 6f6e 6369 7365 2072 6570 7265 7365   Concise represe
+00012e00: 6e74 6174 696f 6e20 6f66 2065 7870 6563  ntation of expec
+00012e10: 7465 6420 6265 6861 7669 6f72 3a0a 0a20  ted behavior:.. 
+00012e20: 2020 2020 2020 2063 302c 6331 2c63 3220         c0,c1,c2 
+00012e30: 3d20 5b33 2e30 3130 3030 3030 3030 3030  = [3.01000000000
+00012e40: 3030 3030 322c 2033 2e30 3130 3030 3030  00002, 3.0100000
+00012e50: 3030 3030 3030 3030 372c 2033 2e30 3130  000000007, 3.010
+00012e60: 3030 3030 3030 3030 3030 3031 5d0a 2020  000000000001].  
+00012e70: 2020 2020 2020 7661 6c75 6573 203d 205b        values = [
+00012e80: 312c 322c 335d 0a0a 2020 2020 2020 2020  1,2,3]..        
+00012e90: 5b63 303a 6330 5d20 2d3e 205b 315d 0a20  [c0:c0] -> [1]. 
+00012ea0: 2020 2020 2020 205b 6331 3a63 315d 202d         [c1:c1] -
+00012eb0: 3e20 5b32 5d0a 2020 2020 2020 2020 5b63  > [2].        [c
+00012ec0: 323a 6332 5d20 2d3e 205b 335d 0a0a 2020  2:c2] -> [3]..  
+00012ed0: 2020 2020 2020 5b63 303a 6331 5d20 2d3e        [c0:c1] ->
+00012ee0: 205b 312c 325d 0a20 2020 2020 2020 205b   [1,2].        [
+00012ef0: 6330 3a63 325d 202d 3e20 5b31 2c32 2c33  c0:c2] -> [1,2,3
+00012f00: 5d0a 0a20 2020 2020 2020 205b 6330 202d  ]..        [c0 -
+00012f10: 206e 6578 7461 6674 6572 2863 302c 3029   nextafter(c0,0)
+00012f20: 203a 2063 305d 202d 3e20 5b31 5d0a 2020   : c0] -> [1].  
+00012f30: 2020 2020 2020 5b63 3020 2d20 6e65 7874        [c0 - next
+00012f40: 6166 7465 7228 6330 2c30 2920 3a20 6330  after(c0,0) : c0
+00012f50: 202d 206e 6578 7461 6674 6572 2863 302c   - nextafter(c0,
+00012f60: 3029 5d20 2d3e 205b 5d0a 0a20 2020 2020  0)] -> []..     
+00012f70: 2020 205b 6332 3a63 322b 6e65 7874 6166     [c2:c2+nextaf
+00012f80: 7465 7228 6332 295d 202d 3e20 5b33 5d0a  ter(c2)] -> [3].
+00012f90: 2020 2020 2020 2020 5b63 322b 6e65 7874          [c2+next
+00012fa0: 6166 7465 7228 6332 2920 3a20 6332 2b6e  after(c2) : c2+n
+00012fb0: 6578 7461 6674 6572 2863 3229 5d20 2d3e  extafter(c2)] ->
+00012fc0: 205b 5d0a 0a20 2020 2020 2020 2022 2222   []..        """
+00012fd0: 0a20 2020 2020 2020 2075 7269 203d 2073  .        uri = s
+00012fe0: 656c 662e 7061 7468 2829 0a0a 2020 2020  elf.path()..    
+00012ff0: 2020 2020 646f 6d20 3d20 7469 6c65 6462      dom = tiledb
+00013000: 2e44 6f6d 6169 6e28 0a20 2020 2020 2020  .Domain(.       
+00013010: 2020 2020 2074 696c 6564 622e 4469 6d28       tiledb.Dim(
+00013020: 2278 222c 2064 6f6d 6169 6e3d 282d 3130  "x", domain=(-10
+00013030: 2e30 2c20 3130 2e30 292c 2074 696c 653d  .0, 10.0), tile=
+00013040: 322e 302c 2064 7479 7065 3d66 6c6f 6174  2.0, dtype=float
+00013050: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+00013060: 2020 2020 6174 7472 203d 2074 696c 6564      attr = tiled
+00013070: 622e 4174 7472 2822 222c 2064 7479 7065  b.Attr("", dtype
+00013080: 3d6e 702e 666c 6f61 7433 3229 0a20 2020  =np.float32).   
+00013090: 2020 2020 2073 6368 656d 6120 3d20 7469       schema = ti
+000130a0: 6c65 6462 2e41 7272 6179 5363 6865 6d61  ledb.ArraySchema
+000130b0: 280a 2020 2020 2020 2020 2020 2020 646f  (.            do
+000130c0: 6d61 696e 3d64 6f6d 2c20 6174 7472 733d  main=dom, attrs=
+000130d0: 2861 7474 722c 292c 2073 7061 7273 653d  (attr,), sparse=
+000130e0: 5472 7565 2c20 6365 6c6c 5f6f 7264 6572  True, cell_order
+000130f0: 3d73 7061 7273 655f 6365 6c6c 5f6f 7264  =sparse_cell_ord
+00013100: 6572 0a20 2020 2020 2020 2029 0a20 2020  er.        ).   
+00013110: 2020 2020 2074 696c 6564 622e 5370 6172       tiledb.Spar
+00013120: 7365 4172 7261 792e 6372 6561 7465 2875  seArray.create(u
+00013130: 7269 2c20 7363 6865 6d61 290a 0a20 2020  ri, schema)..   
+00013140: 2020 2020 2063 3020 3d20 6e70 2e6e 6578       c0 = np.nex
+00013150: 7461 6674 6572 2833 2e30 312c 2034 2920  tafter(3.01, 4) 
+00013160: 2023 2073 6d61 6c6c 6572 0a20 2020 2020   # smaller.     
+00013170: 2020 2063 3120 3d20 6e70 2e6e 6578 7461     c1 = np.nexta
+00013180: 6674 6572 2863 302c 2034 290a 2020 2020  fter(c0, 4).    
+00013190: 2020 2020 6332 203d 206e 702e 6e65 7874      c2 = np.next
+000131a0: 6166 7465 7228 6331 2c20 3429 2020 2320  after(c1, 4)  # 
+000131b0: 6c61 7267 6572 0a0a 2020 2020 2020 2020  larger..        
+000131c0: 2320 666f 7220 6465 6275 6767 696e 6720  # for debugging 
+000131d0: 7573 653a 0a20 2020 2020 2020 2023 206e  use:.        # n
+000131e0: 702e 7365 745f 7072 696e 746f 7074 696f  p.set_printoptio
+000131f0: 6e73 2870 7265 6369 7369 6f6e 3d31 362c  ns(precision=16,
+00013200: 2066 6c6f 6174 6d6f 6465 3d27 6d61 7870   floatmode='maxp
+00013210: 7265 6327 290a 2020 2020 2020 2020 2320  rec').        # 
+00013220: 7072 696e 7428 6330 2c63 312c 6332 290a  print(c0,c1,c2).
+00013230: 0a20 2020 2020 2020 2076 616c 7565 7320  .        values 
+00013240: 3d20 6e70 2e61 7272 6179 285b 312c 2032  = np.array([1, 2
+00013250: 2c20 335d 290a 2020 2020 2020 2020 7769  , 3]).        wi
+00013260: 7468 2074 696c 6564 622e 5370 6172 7365  th tiledb.Sparse
+00013270: 4172 7261 7928 7572 692c 206d 6f64 653d  Array(uri, mode=
+00013280: 2277 2229 2061 7320 543a 0a20 2020 2020  "w") as T:.     
+00013290: 2020 2020 2020 2054 5b5b 6330 2c20 6331         T[[c0, c1
+000132a0: 2c20 6332 5d5d 203d 2076 616c 7565 730a  , c2]] = values.
+000132b0: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
+000132c0: 6c65 6462 2e53 7061 7273 6541 7272 6179  ledb.SparseArray
+000132d0: 2875 7269 2c20 6d6f 6465 3d22 7222 2920  (uri, mode="r") 
+000132e0: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
+000132f0: 2020 666f 7220 692c 2063 2069 6e20 656e    for i, c in en
+00013300: 756d 6572 6174 6528 5b63 302c 2063 312c  umerate([c0, c1,
+00013310: 2063 325d 293a 0a20 2020 2020 2020 2020   c2]):.         
+00013320: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+00013330: 7261 795f 6571 7561 6c28 542e 7175 6572  ray_equal(T.quer
+00013340: 7928 636f 6f72 6473 3d54 7275 6529 2e6d  y(coords=True).m
+00013350: 756c 7469 5f69 6e64 6578 5b63 3a63 5d5b  ulti_index[c:c][
+00013360: 2222 5d2c 2076 616c 7565 735b 695d 290a  ""], values[i]).
+00013370: 2020 2020 2020 2020 2020 2020 2320 7465              # te
+00013380: 7374 2028 636f 6f72 642c 2063 6f6f 7264  st (coord, coord
+00013390: 202b 206e 6578 7461 6674 6572 290a 2020   + nextafter).  
+000133a0: 2020 2020 2020 2020 2020 6330 5f70 7265            c0_pre
+000133b0: 7620 3d20 6e70 2e6e 6578 7461 6674 6572  v = np.nextafter
+000133c0: 2863 302c 2030 290a 2020 2020 2020 2020  (c0, 0).        
+000133d0: 2020 2020 6332 5f6e 6578 7420 3d20 6e70      c2_next = np
+000133e0: 2e6e 6578 7461 6674 6572 2863 322c 2034  .nextafter(c2, 4
+000133f0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+00013400: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
+00013410: 2854 2e71 7565 7279 2863 6f6f 7264 733d  (T.query(coords=
+00013420: 5472 7565 292e 6d75 6c74 695f 696e 6465  True).multi_inde
+00013430: 785b 6330 3a63 315d 5b22 225d 2c20 5b31  x[c0:c1][""], [1
+00013440: 2c20 325d 290a 2020 2020 2020 2020 2020  , 2]).          
+00013450: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
+00013460: 7175 616c 2854 2e71 7565 7279 2863 6f6f  qual(T.query(coo
+00013470: 7264 733d 5472 7565 292e 6d75 6c74 695f  rds=True).multi_
+00013480: 696e 6465 785b 6330 3a63 325d 5b22 225d  index[c0:c2][""]
+00013490: 2c20 5b31 2c20 322c 2033 5d29 0a20 2020  , [1, 2, 3]).   
+000134a0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+000134b0: 6172 7261 795f 6571 7561 6c28 542e 7175  array_equal(T.qu
+000134c0: 6572 7928 636f 6f72 6473 3d54 7275 6529  ery(coords=True)
+000134d0: 2e6d 756c 7469 5f69 6e64 6578 5b63 323a  .multi_index[c2:
+000134e0: 6332 5f6e 6578 745d 5b22 225d 2c20 3329  c2_next][""], 3)
+000134f0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00013500: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+00013510: 542e 7175 6572 7928 636f 6f72 6473 3d54  T.query(coords=T
+00013520: 7275 6529 2e6d 756c 7469 5f69 6e64 6578  rue).multi_index
+00013530: 5b63 305f 7072 6576 3a63 305d 5b22 225d  [c0_prev:c0][""]
+00013540: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
+00013550: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+00013560: 7561 6c28 0a20 2020 2020 2020 2020 2020  ual(.           
+00013570: 2020 2020 2054 2e71 7565 7279 2863 6f6f       T.query(coo
+00013580: 7264 733d 5472 7565 292e 6d75 6c74 695f  rds=True).multi_
+00013590: 696e 6465 785b 6330 5f70 7265 763a 6330  index[c0_prev:c0
+000135a0: 5f70 7265 765d 5b22 225d 2c20 5b5d 0a20  _prev][""], []. 
+000135b0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000135c0: 2020 2020 2020 2020 2023 2074 6573 7420           # test 
+000135d0: 2863 6f6f 7264 202b 206e 6578 7461 6674  (coord + nextaft
+000135e0: 6572 2c20 636f 6f72 6420 2b20 6e65 7874  er, coord + next
+000135f0: 6166 7465 7229 0a20 2020 2020 2020 2020  after).         
+00013600: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
+00013610: 6571 7561 6c28 0a20 2020 2020 2020 2020  equal(.         
+00013620: 2020 2020 2020 2054 2e71 7565 7279 2863         T.query(c
+00013630: 6f6f 7264 733d 5472 7565 292e 6d75 6c74  oords=True).mult
+00013640: 695f 696e 6465 785b 6332 5f6e 6578 743a  i_index[c2_next:
+00013650: 6332 5f6e 6578 745d 5b22 225d 2c20 6e70  c2_next][""], np
+00013660: 2e61 7272 6179 285b 5d29 0a20 2020 2020  .array([]).     
+00013670: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00013680: 2020 2020 2023 2074 6573 7420 2863 6f6f       # test (coo
+00013690: 7264 202d 206e 6578 7461 6674 6572 2c20  rd - nextafter, 
+000136a0: 636f 6f72 6429 0a20 2020 2020 2020 2020  coord).         
+000136b0: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
+000136c0: 6571 7561 6c28 0a20 2020 2020 2020 2020  equal(.         
+000136d0: 2020 2020 2020 2054 2e71 7565 7279 2863         T.query(c
+000136e0: 6f6f 7264 733d 5472 7565 292e 6d75 6c74  oords=True).mult
+000136f0: 695f 696e 6465 785b 6330 3a63 315d 5b22  i_index[c0:c1]["
+00013700: 225d 2c20 7661 6c75 6573 5b5b 302c 2031  "], values[[0, 1
+00013710: 5d5d 0a20 2020 2020 2020 2020 2020 2029  ]].            )
+00013720: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
+00013730: 6573 7420 2863 6f6f 7264 202d 206e 6578  est (coord - nex
+00013740: 7461 6674 6572 2c20 636f 6f72 6420 2b20  tafter, coord + 
+00013750: 6e65 7874 6166 7465 7229 0a20 2020 2020  nextafter).     
+00013760: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+00013770: 7261 795f 6571 7561 6c28 0a20 2020 2020  ray_equal(.     
+00013780: 2020 2020 2020 2020 2020 2054 2e71 7565             T.que
+00013790: 7279 2863 6f6f 7264 733d 5472 7565 292e  ry(coords=True).
+000137a0: 6d75 6c74 695f 696e 6465 785b 6330 3a63  multi_index[c0:c
+000137b0: 325d 5b22 225d 2c20 7661 6c75 6573 5b5b  2][""], values[[
+000137c0: 302c 2031 2c20 325d 5d0a 2020 2020 2020  0, 1, 2]].      
+000137d0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+000137e0: 2074 6573 745f 7370 6172 7365 5f71 7565   test_sparse_que
+000137f0: 7279 5f73 7065 6369 6669 6564 5f64 696d  ry_specified_dim
+00013800: 5f63 6f6f 7264 7328 7365 6c66 2c20 7370  _coords(self, sp
+00013810: 6172 7365 5f63 656c 6c5f 6f72 6465 7229  arse_cell_order)
+00013820: 3a0a 2020 2020 2020 2020 7572 6920 3d20  :.        uri = 
+00013830: 7365 6c66 2e70 6174 6828 2273 7061 7273  self.path("spars
+00013840: 655f 7175 6572 795f 7370 6563 6966 6965  e_query_specifie
+00013850: 645f 6469 6d5f 636f 6f72 6473 2229 0a0a  d_dim_coords")..
+00013860: 2020 2020 2020 2020 646f 6d20 3d20 7469          dom = ti
+00013870: 6c65 6462 2e44 6f6d 6169 6e28 0a20 2020  ledb.Domain(.   
+00013880: 2020 2020 2020 2020 2074 696c 6564 622e           tiledb.
+00013890: 4469 6d28 2269 222c 2064 6f6d 6169 6e3d  Dim("i", domain=
+000138a0: 2831 2c20 3130 292c 2074 696c 653d 312c  (1, 10), tile=1,
+000138b0: 2064 7479 7065 3d69 6e74 292c 0a20 2020   dtype=int),.   
+000138c0: 2020 2020 2020 2020 2074 696c 6564 622e           tiledb.
+000138d0: 4469 6d28 226a 222c 2064 6f6d 6169 6e3d  Dim("j", domain=
+000138e0: 2831 312c 2032 3029 2c20 7469 6c65 3d31  (11, 20), tile=1
+000138f0: 2c20 6474 7970 653d 696e 7429 2c0a 2020  , dtype=int),.  
+00013900: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00013910: 6174 7420 3d20 7469 6c65 6462 2e41 7474  att = tiledb.Att
+00013920: 7228 2222 2c20 6474 7970 653d 696e 7429  r("", dtype=int)
+00013930: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
+00013940: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
+00013950: 6865 6d61 280a 2020 2020 2020 2020 2020  hema(.          
+00013960: 2020 646f 6d61 696e 3d64 6f6d 2c20 6174    domain=dom, at
+00013970: 7472 733d 2861 7474 2c29 2c20 7370 6172  trs=(att,), spar
+00013980: 7365 3d54 7275 652c 2063 656c 6c5f 6f72  se=True, cell_or
+00013990: 6465 723d 7370 6172 7365 5f63 656c 6c5f  der=sparse_cell_
+000139a0: 6f72 6465 720a 2020 2020 2020 2020 290a  order.        ).
+000139b0: 2020 2020 2020 2020 7469 6c65 6462 2e53          tiledb.S
+000139c0: 7061 7273 6541 7272 6179 2e63 7265 6174  parseArray.creat
+000139d0: 6528 7572 692c 2073 6368 656d 6129 0a0a  e(uri, schema)..
+000139e0: 2020 2020 2020 2020 6920 3d20 6e70 2e61          i = np.a
+000139f0: 7272 6179 285b 312c 2031 2c20 312c 2032  rray([1, 1, 1, 2
+00013a00: 2c20 332c 2033 2c20 332c 2034 5d29 0a20  , 3, 3, 3, 4]). 
+00013a10: 2020 2020 2020 206a 203d 206e 702e 6172         j = np.ar
+00013a20: 7261 7928 5b31 312c 2031 322c 2031 342c  ray([11, 12, 14,
+00013a30: 2031 332c 2031 312c 2031 362c 2031 372c   13, 11, 16, 17,
+00013a40: 2031 355d 290a 0a20 2020 2020 2020 2077   15])..        w
+00013a50: 6974 6820 7469 6c65 6462 2e53 7061 7273  ith tiledb.Spars
+00013a60: 6541 7272 6179 2875 7269 2c20 6d6f 6465  eArray(uri, mode
+00013a70: 3d22 7722 2920 6173 2041 3a0a 2020 2020  ="w") as A:.    
+00013a80: 2020 2020 2020 2020 415b 692c 206a 5d20          A[i, j] 
+00013a90: 3d20 6e70 2e61 7272 6179 285b 302c 2031  = np.array([0, 1
+00013aa0: 2c20 322c 2033 2c20 342c 2036 2c20 372c  , 2, 3, 4, 6, 7,
+00013ab0: 2035 5d29 0a0a 2020 2020 2020 2020 2320   5])..        # 
+00013ac0: 6461 7461 2069 7320 7265 7475 726e 6564  data is returned
+00013ad0: 2069 6e20 4869 6c62 6572 7420 6f72 6465   in Hilbert orde
+00013ae0: 722c 2073 6f20 7765 206e 6565 6420 746f  r, so we need to
+00013af0: 2063 6865 636b 2073 6f72 7465 640a 2020   check sorted.  
+00013b00: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+00013b10: 622e 5370 6172 7365 4172 7261 7928 7572  b.SparseArray(ur
+00013b20: 692c 206d 6f64 653d 2272 2229 2061 7320  i, mode="r") as 
+00013b30: 413a 0a20 2020 2020 2020 2020 2020 2041  A:.            A
+00013b40: 6920 3d20 412e 7175 6572 7928 6469 6d73  i = A.query(dims
+00013b50: 3d5b 2269 225d 295b 3a5d 0a20 2020 2020  =["i"])[:].     
+00013b60: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00013b70: 7274 5472 7565 2822 6922 2069 6e20 4169  rtTrue("i" in Ai
+00013b80: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00013b90: 6c66 2e61 7373 6572 7446 616c 7365 2822  lf.assertFalse("
+00013ba0: 6a22 2069 6e20 4169 290a 2020 2020 2020  j" in Ai).      
+00013bb0: 2020 2020 2020 6173 7365 7274 5f75 6e6f        assert_uno
+00013bc0: 7264 6572 6564 5f65 7175 616c 2841 695b  rdered_equal(Ai[
+00013bd0: 2269 225d 2c20 692c 2073 7061 7273 655f  "i"], i, sparse_
+00013be0: 6365 6c6c 5f6f 7264 6572 203d 3d20 2268  cell_order == "h
+00013bf0: 696c 6265 7274 2229 0a0a 2020 2020 2020  ilbert")..      
+00013c00: 2020 2020 2020 416a 203d 2041 2e71 7565        Aj = A.que
+00013c10: 7279 2864 696d 733d 5b22 6a22 5d29 5b3a  ry(dims=["j"])[:
+00013c20: 5d0a 2020 2020 2020 2020 2020 2020 7365  ].            se
+00013c30: 6c66 2e61 7373 6572 7446 616c 7365 2822  lf.assertFalse("
+00013c40: 6922 2069 6e20 416a 290a 2020 2020 2020  i" in Aj).      
+00013c50: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00013c60: 7454 7275 6528 226a 2220 696e 2041 6a29  tTrue("j" in Aj)
+00013c70: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00013c80: 6572 745f 756e 6f72 6465 7265 645f 6571  ert_unordered_eq
+00013c90: 7561 6c28 416a 5b22 6a22 5d2c 206a 2c20  ual(Aj["j"], j, 
+00013ca0: 7370 6172 7365 5f63 656c 6c5f 6f72 6465  sparse_cell_orde
+00013cb0: 7220 3d3d 2022 6869 6c62 6572 7422 290a  r == "hilbert").
+00013cc0: 0a20 2020 2020 2020 2020 2020 2041 696a  .            Aij
+00013cd0: 203d 2041 2e71 7565 7279 2864 696d 733d   = A.query(dims=
+00013ce0: 5b22 6922 2c20 226a 225d 295b 3a5d 0a20  ["i", "j"])[:]. 
+00013cf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00013d00: 6173 7365 7274 5472 7565 2822 6922 2069  assertTrue("i" i
+00013d10: 6e20 4169 6a29 0a20 2020 2020 2020 2020  n Aij).         
+00013d20: 2020 2073 656c 662e 6173 7365 7274 5472     self.assertTr
+00013d30: 7565 2822 6a22 2069 6e20 4169 6a29 0a20  ue("j" in Aij). 
+00013d40: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+00013d50: 745f 756e 6f72 6465 7265 645f 6571 7561  t_unordered_equa
+00013d60: 6c28 4169 6a5b 2269 225d 2c20 692c 2073  l(Aij["i"], i, s
+00013d70: 7061 7273 655f 6365 6c6c 5f6f 7264 6572  parse_cell_order
+00013d80: 203d 3d20 2268 696c 6265 7274 2229 0a20   == "hilbert"). 
+00013d90: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+00013da0: 745f 756e 6f72 6465 7265 645f 6571 7561  t_unordered_equa
+00013db0: 6c28 4169 6a5b 226a 225d 2c20 6a2c 2073  l(Aij["j"], j, s
+00013dc0: 7061 7273 655f 6365 6c6c 5f6f 7264 6572  parse_cell_order
+00013dd0: 203d 3d20 2268 696c 6265 7274 2229 0a0a   == "hilbert")..
+00013de0: 2020 2020 6465 6620 7465 7374 5f64 656e      def test_den
+00013df0: 7365 5f71 7565 7279 5f73 7065 6369 6669  se_query_specifi
+00013e00: 6564 5f64 696d 5f63 6f6f 7264 7328 7365  ed_dim_coords(se
+00013e10: 6c66 293a 0a20 2020 2020 2020 2075 7269  lf):.        uri
+00013e20: 203d 2073 656c 662e 7061 7468 2822 6465   = self.path("de
+00013e30: 6e73 655f 7175 6572 795f 7370 6563 6966  nse_query_specif
+00013e40: 6965 645f 6469 6d5f 636f 6f72 6473 2229  ied_dim_coords")
+00013e50: 0a0a 2020 2020 2020 2020 646f 6d20 3d20  ..        dom = 
+00013e60: 7469 6c65 6462 2e44 6f6d 6169 6e28 0a20  tiledb.Domain(. 
+00013e70: 2020 2020 2020 2020 2020 2074 696c 6564             tiled
+00013e80: 622e 4469 6d28 2269 222c 2064 6f6d 6169  b.Dim("i", domai
+00013e90: 6e3d 2831 2c20 3329 2c20 7469 6c65 3d31  n=(1, 3), tile=1
+00013ea0: 2c20 6474 7970 653d 696e 7429 2c0a 2020  , dtype=int),.  
+00013eb0: 2020 2020 2020 2020 2020 7469 6c65 6462            tiledb
+00013ec0: 2e44 696d 2822 6a22 2c20 646f 6d61 696e  .Dim("j", domain
+00013ed0: 3d28 342c 2036 292c 2074 696c 653d 312c  =(4, 6), tile=1,
+00013ee0: 2064 7479 7065 3d69 6e74 292c 0a20 2020   dtype=int),.   
+00013ef0: 2020 2020 2029 0a20 2020 2020 2020 2061       ).        a
+00013f00: 7474 203d 2074 696c 6564 622e 4174 7472  tt = tiledb.Attr
+00013f10: 2822 222c 2064 7479 7065 3d69 6e74 290a  ("", dtype=int).
+00013f20: 2020 2020 2020 2020 7363 6865 6d61 203d          schema =
+00013f30: 2074 696c 6564 622e 4172 7261 7953 6368   tiledb.ArraySch
+00013f40: 656d 6128 646f 6d61 696e 3d64 6f6d 2c20  ema(domain=dom, 
+00013f50: 6174 7472 733d 2861 7474 2c29 2c20 7370  attrs=(att,), sp
+00013f60: 6172 7365 3d46 616c 7365 290a 2020 2020  arse=False).    
+00013f70: 2020 2020 7469 6c65 6462 2e44 656e 7365      tiledb.Dense
+00013f80: 4172 7261 792e 6372 6561 7465 2875 7269  Array.create(uri
+00013f90: 2c20 7363 6865 6d61 290a 0a20 2020 2020  , schema)..     
+00013fa0: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
+00013fb0: 656e 7365 4172 7261 7928 7572 692c 206d  enseArray(uri, m
+00013fc0: 6f64 653d 2277 2229 2061 7320 413a 0a20  ode="w") as A:. 
+00013fd0: 2020 2020 2020 2020 2020 2041 5b3a 2c20             A[:, 
+00013fe0: 3a5d 203d 206e 702e 6172 616e 6765 2839  :] = np.arange(9
+00013ff0: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
+00014000: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
+00014010: 7928 7572 692c 206d 6f64 653d 2272 2229  y(uri, mode="r")
+00014020: 2061 7320 413a 0a20 2020 2020 2020 2020   as A:.         
+00014030: 2020 2069 203d 206e 702e 6172 7261 7928     i = np.array(
+00014040: 5b5b 312c 2031 2c20 315d 2c20 5b32 2c20  [[1, 1, 1], [2, 
+00014050: 322c 2032 5d2c 205b 332c 2033 2c20 335d  2, 2], [3, 3, 3]
+00014060: 5d29 0a20 2020 2020 2020 2020 2020 206a  ]).            j
+00014070: 203d 206e 702e 6172 7261 7928 5b5b 342c   = np.array([[4,
+00014080: 2035 2c20 365d 2c20 5b34 2c20 352c 2036   5, 6], [4, 5, 6
+00014090: 5d2c 205b 342c 2035 2c20 365d 5d29 0a0a  ], [4, 5, 6]])..
+000140a0: 2020 2020 2020 2020 2020 2020 4169 203d              Ai =
+000140b0: 2041 2e71 7565 7279 2864 696d 733d 5b22   A.query(dims=["
+000140c0: 6922 5d29 5b3a 5d0a 2020 2020 2020 2020  i"])[:].        
+000140d0: 2020 2020 7365 6c66 2e61 7373 6572 7454      self.assertT
+000140e0: 7275 6528 2269 2220 696e 2041 6929 0a20  rue("i" in Ai). 
+000140f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00014100: 6173 7365 7274 4661 6c73 6528 226a 2220  assertFalse("j" 
+00014110: 696e 2041 6929 0a20 2020 2020 2020 2020  in Ai).         
+00014120: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
+00014130: 6571 7561 6c28 4169 5b22 6922 5d2c 2069  equal(Ai["i"], i
+00014140: 290a 0a20 2020 2020 2020 2020 2020 2041  )..            A
+00014150: 6a20 3d20 412e 7175 6572 7928 6469 6d73  j = A.query(dims
+00014160: 3d5b 226a 225d 295b 3a5d 0a20 2020 2020  =["j"])[:].     
+00014170: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00014180: 7274 4661 6c73 6528 2269 2220 696e 2041  rtFalse("i" in A
+00014190: 6a29 0a20 2020 2020 2020 2020 2020 2073  j).            s
+000141a0: 656c 662e 6173 7365 7274 5472 7565 2822  elf.assertTrue("
+000141b0: 6a22 2069 6e20 416a 290a 2020 2020 2020  j" in Aj).      
+000141c0: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
+000141d0: 6179 5f65 7175 616c 2841 6a5b 226a 225d  ay_equal(Aj["j"]
+000141e0: 2c20 6a29 0a0a 2020 2020 2020 2020 2020  , j)..          
+000141f0: 2020 4169 6a20 3d20 412e 7175 6572 7928    Aij = A.query(
+00014200: 6469 6d73 3d5b 2269 222c 2022 6a22 5d29  dims=["i", "j"])
+00014210: 5b3a 5d0a 2020 2020 2020 2020 2020 2020  [:].            
+00014220: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
+00014230: 2269 2220 696e 2041 696a 290a 2020 2020  "i" in Aij).    
+00014240: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00014250: 6572 7454 7275 6528 226a 2220 696e 2041  ertTrue("j" in A
+00014260: 696a 290a 2020 2020 2020 2020 2020 2020  ij).            
+00014270: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
+00014280: 616c 2841 696a 5b22 6922 5d2c 2069 290a  al(Aij["i"], i).
+00014290: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+000142a0: 7274 5f61 7272 6179 5f65 7175 616c 2841  rt_array_equal(A
+000142b0: 696a 5b22 6a22 5d2c 206a 290a 0a20 2020  ij["j"], j)..   
+000142c0: 2064 6566 2074 6573 745f 7375 6261 7272   def test_subarr
+000142d0: 6179 2873 656c 662c 2073 7061 7273 655f  ay(self, sparse_
+000142e0: 6365 6c6c 5f6f 7264 6572 293a 0a20 2020  cell_order):.   
+000142f0: 2020 2020 2064 6f6d 203d 2074 696c 6564       dom = tiled
+00014300: 622e 446f 6d61 696e 2874 696c 6564 622e  b.Domain(tiledb.
+00014310: 4469 6d28 2278 222c 2064 6f6d 6169 6e3d  Dim("x", domain=
+00014320: 2831 2c20 3130 3030 3029 2c20 7469 6c65  (1, 10000), tile
+00014330: 3d31 3030 2c20 6474 7970 653d 696e 7429  =100, dtype=int)
+00014340: 290a 2020 2020 2020 2020 6174 7420 3d20  ).        att = 
+00014350: 7469 6c65 6462 2e41 7474 7228 2222 2c20  tiledb.Attr("", 
+00014360: 6474 7970 653d 666c 6f61 7429 0a20 2020  dtype=float).   
+00014370: 2020 2020 2073 6368 656d 6120 3d20 7469       schema = ti
+00014380: 6c65 6462 2e41 7272 6179 5363 6865 6d61  ledb.ArraySchema
+00014390: 280a 2020 2020 2020 2020 2020 2020 646f  (.            do
+000143a0: 6d61 696e 3d64 6f6d 2c20 6174 7472 733d  main=dom, attrs=
+000143b0: 2861 7474 2c29 2c20 7370 6172 7365 3d54  (att,), sparse=T
+000143c0: 7275 652c 2063 656c 6c5f 6f72 6465 723d  rue, cell_order=
+000143d0: 7370 6172 7365 5f63 656c 6c5f 6f72 6465  sparse_cell_orde
+000143e0: 720a 2020 2020 2020 2020 290a 2020 2020  r.        ).    
+000143f0: 2020 2020 7469 6c65 6462 2e53 7061 7273      tiledb.Spars
+00014400: 6541 7272 6179 2e63 7265 6174 6528 7365  eArray.create(se
+00014410: 6c66 2e70 6174 6828 2266 6f6f 2229 2c20  lf.path("foo"), 
+00014420: 7363 6865 6d61 290a 0a20 2020 2020 2020  schema)..       
+00014430: 2077 6974 6820 7469 6c65 6462 2e53 7061   with tiledb.Spa
+00014440: 7273 6541 7272 6179 2873 656c 662e 7061  rseArray(self.pa
+00014450: 7468 2822 666f 6f22 292c 206d 6f64 653d  th("foo"), mode=
+00014460: 2272 2229 2061 7320 543a 0a20 2020 2020  "r") as T:.     
+00014470: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+00014480: 7274 4973 4e6f 6e65 2854 2e6e 6f6e 656d  rtIsNone(T.nonem
+00014490: 7074 795f 646f 6d61 696e 2829 290a 0a20  pty_domain()).. 
+000144a0: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
+000144b0: 6462 2e53 7061 7273 6541 7272 6179 2873  db.SparseArray(s
+000144c0: 656c 662e 7061 7468 2822 666f 6f22 292c  elf.path("foo"),
+000144d0: 206d 6f64 653d 2277 2229 2061 7320 543a   mode="w") as T:
+000144e0: 0a20 2020 2020 2020 2020 2020 2054 5b5b  .            T[[
+000144f0: 3530 2c20 3630 2c20 3130 305d 5d20 3d20  50, 60, 100]] = 
+00014500: 5b31 2e30 2c20 322e 302c 2033 2e30 5d0a  [1.0, 2.0, 3.0].
+00014510: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
+00014520: 6c65 6462 2e53 7061 7273 6541 7272 6179  ledb.SparseArray
+00014530: 2873 656c 662e 7061 7468 2822 666f 6f22  (self.path("foo"
+00014540: 292c 206d 6f64 653d 2272 2229 2061 7320  ), mode="r") as 
+00014550: 543a 0a20 2020 2020 2020 2020 2020 2073  T:.            s
+00014560: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+00014570: 2828 3530 2c20 3130 3029 2c29 2c20 542e  ((50, 100),), T.
+00014580: 6e6f 6e65 6d70 7479 5f64 6f6d 6169 6e28  nonempty_domain(
+00014590: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
+000145a0: 2320 7265 7472 6965 7665 206a 7573 7420  # retrieve just 
+000145b0: 7661 6c69 6420 636f 6f72 6469 6e61 7465  valid coordinate
+000145c0: 7320 696e 2073 7562 6172 7261 7920 545b  s in subarray T[
+000145d0: 3430 3a36 305d 0a20 2020 2020 2020 2020  40:60].         
+000145e0: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
+000145f0: 6571 7561 6c28 545b 3430 3a36 315d 5b22  equal(T[40:61]["
+00014600: 7822 5d2c 205b 3530 2c20 3630 5d29 0a0a  x"], [50, 60])..
+00014610: 2020 2020 2020 2020 2020 2020 2320 544f              # TO
+00014620: 444f 3a20 6472 6f70 7069 6e67 2063 6f6f  DO: dropping coo
+00014630: 7264 7320 7769 7468 206f 6e65 2061 6e6f  rds with one ano
+00014640: 6e20 7661 6c75 6520 7265 7475 726e 7320  n value returns 
+00014650: 6a75 7374 2061 6e20 6172 7261 790a 2020  just an array.  
+00014660: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
+00014670: 542e 7175 6572 7928 636f 6f72 6473 3d46  T.query(coords=F
+00014680: 616c 7365 295b 3430 3a36 315d 0a20 2020  alse)[40:61].   
+00014690: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+000146a0: 6172 7261 795f 6571 7561 6c28 7265 735b  array_equal(res[
+000146b0: 2222 5d2c 205b 312e 302c 2032 2e30 5d29  ""], [1.0, 2.0])
+000146c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000146d0: 662e 6173 7365 7274 4571 7561 6c28 2822  f.assertEqual(("
+000146e0: 636f 6f72 6473 2220 696e 2072 6573 292c  coords" in res),
+000146f0: 2046 616c 7365 290a 0a20 2020 2064 6566   False)..    def
+00014700: 2074 6573 745f 7370 6172 7365 5f62 7974   test_sparse_byt
+00014710: 6573 2873 656c 662c 2073 7061 7273 655f  es(self, sparse_
+00014720: 6365 6c6c 5f6f 7264 6572 293a 0a20 2020  cell_order):.   
+00014730: 2020 2020 2064 6f6d 203d 2074 696c 6564       dom = tiled
+00014740: 622e 446f 6d61 696e 2874 696c 6564 622e  b.Domain(tiledb.
+00014750: 4469 6d28 2278 222c 2064 6f6d 6169 6e3d  Dim("x", domain=
+00014760: 2831 2c20 3130 3030 3029 2c20 7469 6c65  (1, 10000), tile
+00014770: 3d31 3030 2c20 6474 7970 653d 696e 7429  =100, dtype=int)
+00014780: 290a 2020 2020 2020 2020 6174 7420 3d20  ).        att = 
+00014790: 7469 6c65 6462 2e41 7474 7228 2222 2c20  tiledb.Attr("", 
+000147a0: 7661 723d 5472 7565 2c20 6474 7970 653d  var=True, dtype=
+000147b0: 6e70 2e62 7974 6573 5f29 0a20 2020 2020  np.bytes_).     
+000147c0: 2020 2073 6368 656d 6120 3d20 7469 6c65     schema = tile
+000147d0: 6462 2e41 7272 6179 5363 6865 6d61 280a  db.ArraySchema(.
+000147e0: 2020 2020 2020 2020 2020 2020 646f 6d61              doma
+000147f0: 696e 3d64 6f6d 2c20 6174 7472 733d 2861  in=dom, attrs=(a
+00014800: 7474 2c29 2c20 7370 6172 7365 3d54 7275  tt,), sparse=Tru
+00014810: 652c 2063 656c 6c5f 6f72 6465 723d 7370  e, cell_order=sp
+00014820: 6172 7365 5f63 656c 6c5f 6f72 6465 720a  arse_cell_order.
+00014830: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00014840: 2020 7469 6c65 6462 2e53 7061 7273 6541    tiledb.SparseA
+00014850: 7272 6179 2e63 7265 6174 6528 7365 6c66  rray.create(self
+00014860: 2e70 6174 6828 2266 6f6f 2229 2c20 7363  .path("foo"), sc
+00014870: 6865 6d61 290a 0a20 2020 2020 2020 2077  hema)..        w
+00014880: 6974 6820 7469 6c65 6462 2e53 7061 7273  ith tiledb.Spars
+00014890: 6541 7272 6179 2873 656c 662e 7061 7468  eArray(self.path
+000148a0: 2822 666f 6f22 292c 206d 6f64 653d 2272  ("foo"), mode="r
+000148b0: 2229 2061 7320 543a 0a20 2020 2020 2020  ") as T:.       
+000148c0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+000148d0: 4973 4e6f 6e65 2854 2e6e 6f6e 656d 7074  IsNone(T.nonempt
+000148e0: 795f 646f 6d61 696e 2829 290a 2020 2020  y_domain()).    
+000148f0: 2020 2020 4120 3d20 6e70 2e61 7272 6179      A = np.array
+00014900: 280a 2020 2020 2020 2020 2020 2020 5b62  (.            [b
+00014910: 2261 6161 222c 2062 2262 6262 6262 6262  "aaa", b"bbbbbbb
+00014920: 6262 6262 6262 6262 6262 6262 6222 2c20  bbbbbbbbbbbbb", 
+00014930: 6222 6363 6363 6363 6363 6363 6363 6363  b"cccccccccccccc
+00014940: 6363 6363 6363 6363 6363 6322 5d2c 0a20  ccccccccccc"],. 
+00014950: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
+00014960: 3d6e 702e 6279 7465 735f 2c0a 2020 2020  =np.bytes_,.    
+00014970: 2020 2020 290a 0a20 2020 2020 2020 2077      )..        w
+00014980: 6974 6820 7469 6c65 6462 2e53 7061 7273  ith tiledb.Spars
+00014990: 6541 7272 6179 2873 656c 662e 7061 7468  eArray(self.path
+000149a0: 2822 666f 6f22 292c 206d 6f64 653d 2277  ("foo"), mode="w
+000149b0: 2229 2061 7320 543a 0a20 2020 2020 2020  ") as T:.       
+000149c0: 2020 2020 2054 5b5b 3530 2c20 3630 2c20       T[[50, 60, 
+000149d0: 3130 305d 5d20 3d20 410a 0a20 2020 2020  100]] = A..     
+000149e0: 2020 2077 6974 6820 7469 6c65 6462 2e53     with tiledb.S
+000149f0: 7061 7273 6541 7272 6179 2873 656c 662e  parseArray(self.
+00014a00: 7061 7468 2822 666f 6f22 292c 206d 6f64  path("foo"), mod
+00014a10: 653d 2272 2229 2061 7320 543a 0a20 2020  e="r") as T:.   
+00014a20: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+00014a30: 7365 7274 4571 7561 6c28 2828 3530 2c20  sertEqual(((50, 
+00014a40: 3130 3029 2c29 2c20 542e 6e6f 6e65 6d70  100),), T.nonemp
+00014a50: 7479 5f64 6f6d 6169 6e28 2929 0a0a 2020  ty_domain())..  
+00014a60: 2020 2020 2020 2020 2020 2320 7265 7472            # retr
+00014a70: 6965 7665 206a 7573 7420 7661 6c69 6420  ieve just valid 
+00014a80: 636f 6f72 6469 6e61 7465 7320 696e 2073  coordinates in s
+00014a90: 7562 6172 7261 7920 545b 3430 3a36 305d  ubarray T[40:60]
+00014aa0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00014ab0: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+00014ac0: 545b 3430 3a36 315d 5b22 7822 5d2c 205b  T[40:61]["x"], [
+00014ad0: 3530 2c20 3630 5d29 0a0a 2020 2020 2020  50, 60])..      
+00014ae0: 2020 2020 2020 2320 544f 444f 3a20 6472        # TODO: dr
+00014af0: 6f70 7069 6e67 2063 6f6f 7264 7320 7769  opping coords wi
+00014b00: 7468 206f 6e65 2061 6e6f 6e20 7661 6c75  th one anon valu
+00014b10: 6520 7265 7475 726e 7320 6a75 7374 2061  e returns just a
+00014b20: 6e20 6172 7261 790a 2020 2020 2020 2020  n array.        
+00014b30: 2020 2020 7265 7320 3d20 542e 7175 6572      res = T.quer
+00014b40: 7928 636f 6f72 6473 3d46 616c 7365 295b  y(coords=False)[
+00014b50: 3430 3a36 315d 0a20 2020 2020 2020 2020  40:61].         
+00014b60: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
+00014b70: 6571 7561 6c28 7265 735b 2222 5d2c 2041  equal(res[""], A
+00014b80: 5b30 3a32 5d29 0a20 2020 2020 2020 2020  [0:2]).         
+00014b90: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00014ba0: 7561 6c28 2822 636f 6f72 6473 2220 696e  ual(("coords" in
+00014bb0: 2072 6573 292c 2046 616c 7365 290a 0a20   res), False).. 
+00014bc0: 2020 2020 2020 2020 2020 2023 2065 6d70             # emp
+00014bd0: 7479 2073 7061 7273 6520 7661 726c 656e  ty sparse varlen
+00014be0: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
+00014bf0: 2020 2020 7265 7320 3d20 545b 3130 3030      res = T[1000
+00014c00: 5d0a 2020 2020 2020 2020 2020 2020 6173  ].            as
+00014c10: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
+00014c20: 2872 6573 5b22 225d 2c20 6e70 2e61 7272  (res[""], np.arr
+00014c30: 6179 2822 222c 2064 7479 7065 3d22 5331  ay("", dtype="S1
+00014c40: 2229 290a 2020 2020 2020 2020 2020 2020  ")).            
+00014c50: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
+00014c60: 616c 2872 6573 5b22 7822 5d2c 206e 702e  al(res["x"], np.
+00014c70: 6172 7261 7928 5b5d 2c20 6474 7970 653d  array([], dtype=
+00014c80: 6e70 2e69 6e74 3634 2929 0a0a 2020 2020  np.int64))..    
+00014c90: 6465 6620 7465 7374 5f73 7061 7273 655f  def test_sparse_
+00014ca0: 756e 6963 6f64 6528 7365 6c66 2c20 7370  unicode(self, sp
+00014cb0: 6172 7365 5f63 656c 6c5f 6f72 6465 7229  arse_cell_order)
+00014cc0: 3a0a 2020 2020 2020 2020 646f 6d20 3d20  :.        dom = 
+00014cd0: 7469 6c65 6462 2e44 6f6d 6169 6e28 7469  tiledb.Domain(ti
+00014ce0: 6c65 6462 2e44 696d 2822 7822 2c20 646f  ledb.Dim("x", do
+00014cf0: 6d61 696e 3d28 312c 2031 3030 3030 292c  main=(1, 10000),
+00014d00: 2074 696c 653d 3130 302c 2064 7479 7065   tile=100, dtype
+00014d10: 3d69 6e74 2929 0a20 2020 2020 2020 2061  =int)).        a
+00014d20: 7474 203d 2074 696c 6564 622e 4174 7472  tt = tiledb.Attr
+00014d30: 2822 222c 2076 6172 3d54 7275 652c 2064  ("", var=True, d
+00014d40: 7479 7065 3d6e 702e 756e 6963 6f64 655f  type=np.unicode_
+00014d50: 290a 2020 2020 2020 2020 7363 6865 6d61  ).        schema
+00014d60: 203d 2074 696c 6564 622e 4172 7261 7953   = tiledb.ArrayS
+00014d70: 6368 656d 6128 0a20 2020 2020 2020 2020  chema(.         
+00014d80: 2020 2064 6f6d 6169 6e3d 646f 6d2c 2061     domain=dom, a
+00014d90: 7474 7273 3d28 6174 742c 292c 2073 7061  ttrs=(att,), spa
+00014da0: 7273 653d 5472 7565 2c20 6365 6c6c 5f6f  rse=True, cell_o
+00014db0: 7264 6572 3d73 7061 7273 655f 6365 6c6c  rder=sparse_cell
+00014dc0: 5f6f 7264 6572 0a20 2020 2020 2020 2029  _order.        )
+00014dd0: 0a20 2020 2020 2020 2074 696c 6564 622e  .        tiledb.
+00014de0: 5370 6172 7365 4172 7261 792e 6372 6561  SparseArray.crea
+00014df0: 7465 2873 656c 662e 7061 7468 2822 666f  te(self.path("fo
+00014e00: 6f22 292c 2073 6368 656d 6129 0a0a 2020  o"), schema)..  
+00014e10: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+00014e20: 622e 5370 6172 7365 4172 7261 7928 7365  b.SparseArray(se
+00014e30: 6c66 2e70 6174 6828 2266 6f6f 2229 2c20  lf.path("foo"), 
+00014e40: 6d6f 6465 3d22 7222 2920 6173 2054 3a0a  mode="r") as T:.
+00014e50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00014e60: 2e61 7373 6572 7449 734e 6f6e 6528 542e  .assertIsNone(T.
+00014e70: 6e6f 6e65 6d70 7479 5f64 6f6d 6169 6e28  nonempty_domain(
+00014e80: 2929 0a0a 2020 2020 2020 2020 4120 3d20  ))..        A = 
+00014e90: 6e70 5f61 7272 6179 203d 206e 702e 6172  np_array = np.ar
+00014ea0: 7261 7928 0a20 2020 2020 2020 2020 2020  ray(.           
+00014eb0: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+00014ec0: 2020 2022 3132 3334 3534 356c 6b6a 616c     "1234545lkjal
+00014ed0: 7364 666a 222c 0a20 2020 2020 2020 2020  sdfj",.         
+00014ee0: 2020 2020 2020 2022 6d6e 6f70 7172 7322         "mnopqrs"
+00014ef0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014f00: 2020 2269 6a6b 6c22 2c0a 2020 2020 2020    "ijkl",.      
+00014f10: 2020 2020 2020 2020 2020 2267 6822 2c0a            "gh",.
+00014f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f30: 2261 6263 6465 6622 2c0a 2020 2020 2020  "abcdef",.      
+00014f40: 2020 2020 2020 2020 2020 2261 ceb1 62ce            "a..b.
+00014f50: b2ce b263 ceb3 ceb3 ceb3 64ce b4ce b4ce  ...c......d.....
+00014f60: b4ce b422 2c0a 2020 2020 2020 2020 2020  ...",.          
+00014f70: 2020 2020 2020 2261 ceb1 62ce b2ce b263        "a..b....c
+00014f80: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00014f90: 2020 2022 222c 0a20 2020 2020 2020 2020     "",.         
+00014fa0: 2020 2020 2020 2022 ceb3 ceb3 ceb3 64ce         "......d.
+00014fb0: b4ce b4ce b4ce b422 2c0a 2020 2020 2020  .......",.      
+00014fc0: 2020 2020 2020 5d2c 0a20 2020 2020 2020        ],.       
+00014fd0: 2020 2020 2064 7479 7065 3d6f 626a 6563       dtype=objec
+00014fe0: 742c 0a20 2020 2020 2020 2029 0a0a 2020  t,.        )..  
+00014ff0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+00015000: 622e 5370 6172 7365 4172 7261 7928 7365  b.SparseArray(se
+00015010: 6c66 2e70 6174 6828 2266 6f6f 2229 2c20  lf.path("foo"), 
+00015020: 6d6f 6465 3d22 7722 2920 6173 2054 3a0a  mode="w") as T:.
+00015030: 2020 2020 2020 2020 2020 2020 545b 5b33              T[[3
+00015040: 2c20 342c 2035 2c20 362c 2037 2c20 3530  , 4, 5, 6, 7, 50
+00015050: 2c20 3630 2c20 3730 2c20 3130 305d 5d20  , 60, 70, 100]] 
+00015060: 3d20 410a 0a20 2020 2020 2020 2077 6974  = A..        wit
+00015070: 6820 7469 6c65 6462 2e53 7061 7273 6541  h tiledb.SparseA
+00015080: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
+00015090: 666f 6f22 292c 206d 6f64 653d 2272 2229  foo"), mode="r")
+000150a0: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
+000150b0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000150c0: 7561 6c28 2828 332c 2031 3030 292c 292c  ual(((3, 100),),
+000150d0: 2054 2e6e 6f6e 656d 7074 795f 646f 6d61   T.nonempty_doma
+000150e0: 696e 2829 290a 0a20 2020 2020 2020 2020  in())..         
+000150f0: 2020 2023 2072 6574 7269 6576 6520 6a75     # retrieve ju
+00015100: 7374 2076 616c 6964 2063 6f6f 7264 696e  st valid coordin
+00015110: 6174 6573 2069 6e20 7375 6261 7272 6179  ates in subarray
+00015120: 2054 5b34 303a 3630 5d0a 2020 2020 2020   T[40:60].      
+00015130: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
+00015140: 6179 5f65 7175 616c 2854 5b34 303a 3631  ay_equal(T[40:61
+00015150: 5d5b 2278 225d 2c20 5b35 302c 2036 305d  ]["x"], [50, 60]
+00015160: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00015170: 2054 4f44 4f3a 2064 726f 7070 696e 6720   TODO: dropping 
+00015180: 636f 6f72 6473 2077 6974 6820 6f6e 6520  coords with one 
+00015190: 616e 6f6e 2076 616c 7565 2072 6574 7572  anon value retur
+000151a0: 6e73 206a 7573 7420 616e 2061 7272 6179  ns just an array
+000151b0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+000151c0: 203d 2054 2e71 7565 7279 2863 6f6f 7264   = T.query(coord
+000151d0: 733d 4661 6c73 6529 5b34 303a 3631 5d0a  s=False)[40:61].
+000151e0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+000151f0: 7274 5f61 7272 6179 5f65 7175 616c 2872  rt_array_equal(r
+00015200: 6573 5b22 225d 2c20 415b 353a 375d 290a  es[""], A[5:7]).
+00015210: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00015220: 2e61 7373 6572 7445 7175 616c 2828 2263  .assertEqual(("c
+00015230: 6f6f 7264 7322 2069 6e20 7265 7329 2c20  oords" in res), 
+00015240: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
+00015250: 2020 2020 2320 656d 7074 7920 7370 6172      # empty spar
+00015260: 7365 2076 6172 6c65 6e20 7265 7375 6c74  se varlen result
+00015270: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00015280: 203d 2054 5b31 3030 305d 0a20 2020 2020   = T[1000].     
+00015290: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+000152a0: 7261 795f 6571 7561 6c28 7265 735b 2222  ray_equal(res[""
+000152b0: 5d2c 206e 702e 6172 7261 7928 2222 2c20  ], np.array("", 
+000152c0: 6474 7970 653d 2255 3122 2929 0a20 2020  dtype="U1")).   
+000152d0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+000152e0: 6172 7261 795f 6571 7561 6c28 7265 735b  array_equal(res[
+000152f0: 2278 225d 2c20 6e70 2e61 7272 6179 285b  "x"], np.array([
+00015300: 5d2c 2064 7479 7065 3d6e 702e 696e 7436  ], dtype=np.int6
+00015310: 3429 290a 0a20 2020 2064 6566 2074 6573  4))..    def tes
+00015320: 745f 7370 6172 7365 5f71 7565 7279 2873  t_sparse_query(s
+00015330: 656c 662c 2073 7061 7273 655f 6365 6c6c  elf, sparse_cell
+00015340: 5f6f 7264 6572 293a 0a20 2020 2020 2020  _order):.       
+00015350: 2075 7269 203d 2073 656c 662e 7061 7468   uri = self.path
+00015360: 2822 7465 7374 5f73 7061 7273 655f 7175  ("test_sparse_qu
+00015370: 6572 7922 290a 2020 2020 2020 2020 646f  ery").        do
+00015380: 6d20 3d20 7469 6c65 6462 2e44 6f6d 6169  m = tiledb.Domai
+00015390: 6e28 0a20 2020 2020 2020 2020 2020 2074  n(.            t
+000153a0: 696c 6564 622e 4469 6d28 2278 222c 2064  iledb.Dim("x", d
+000153b0: 6f6d 6169 6e3d 2831 2c20 3130 3030 3029  omain=(1, 10000)
+000153c0: 2c20 7469 6c65 3d31 3030 2c20 6474 7970  , tile=100, dtyp
+000153d0: 653d 6e70 2e66 6c6f 6174 3634 290a 2020  e=np.float64).  
+000153e0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+000153f0: 2061 7474 203d 2074 696c 6564 622e 4174   att = tiledb.At
+00015400: 7472 2822 222c 2064 7479 7065 3d66 6c6f  tr("", dtype=flo
+00015410: 6174 290a 2020 2020 2020 2020 7363 6865  at).        sche
+00015420: 6d61 203d 2074 696c 6564 622e 4172 7261  ma = tiledb.Arra
+00015430: 7953 6368 656d 6128 0a20 2020 2020 2020  ySchema(.       
+00015440: 2020 2020 2064 6f6d 6169 6e3d 646f 6d2c       domain=dom,
+00015450: 2061 7474 7273 3d28 6174 742c 292c 2073   attrs=(att,), s
+00015460: 7061 7273 653d 5472 7565 2c20 6365 6c6c  parse=True, cell
+00015470: 5f6f 7264 6572 3d73 7061 7273 655f 6365  _order=sparse_ce
+00015480: 6c6c 5f6f 7264 6572 0a20 2020 2020 2020  ll_order.       
+00015490: 2029 0a20 2020 2020 2020 2074 696c 6564   ).        tiled
+000154a0: 622e 5370 6172 7365 4172 7261 792e 6372  b.SparseArray.cr
+000154b0: 6561 7465 2875 7269 2c20 7363 6865 6d61  eate(uri, schema
+000154c0: 290a 0a20 2020 2020 2020 2063 6f6f 7264  )..        coord
+000154d0: 7320 3d20 6e70 2e72 616e 646f 6d2e 756e  s = np.random.un
+000154e0: 6966 6f72 6d28 6c6f 773d 312c 2068 6967  iform(low=1, hig
+000154f0: 683d 3130 3030 302c 2073 697a 653d 3130  h=10000, size=10
+00015500: 3029 0a20 2020 2020 2020 2064 6174 6120  0).        data 
+00015510: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
+00015520: 2831 3030 290a 0a20 2020 2020 2020 2077  (100)..        w
+00015530: 6974 6820 7469 6c65 6462 2e53 7061 7273  ith tiledb.Spars
+00015540: 6541 7272 6179 2875 7269 2c20 6d6f 6465  eArray(uri, mode
+00015550: 3d22 7722 2920 6173 2054 3a0a 2020 2020  ="w") as T:.    
+00015560: 2020 2020 2020 2020 545b 636f 6f72 6473          T[coords
+00015570: 5d20 3d20 6461 7461 0a0a 2020 2020 2020  ] = data..      
+00015580: 2020 2320 5465 7374 2074 6861 7420 5449    # Test that TI
+00015590: 4c45 4442 5f55 4e4f 5244 4552 4544 2077  LEDB_UNORDERED w
+000155a0: 6f72 6b73 2063 6f72 7265 6374 6c79 0a20  orks correctly. 
+000155b0: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
+000155c0: 6462 2e53 7061 7273 6541 7272 6179 2875  db.SparseArray(u
+000155d0: 7269 2c20 6d6f 6465 3d22 7222 2920 6173  ri, mode="r") as
+000155e0: 2041 3a0a 2020 2020 2020 2020 2020 2020   A:.            
+000155f0: 7265 7320 3d20 415b 313a 3130 3030 315d  res = A[1:10001]
+00015600: 5b22 225d 2020 2320 696e 6465 7820 7061  [""]  # index pa
+00015610: 7374 2074 6865 2065 6e64 2068 6572 6520  st the end here 
+00015620: 746f 2065 6e73 7572 6520 696e 636c 7573  to ensure inclus
+00015630: 6976 6520 7265 7375 6c74 0a20 2020 2020  ive result.     
+00015640: 2020 2020 2020 2072 6573 203d 2041 2e6d         res = A.m
+00015650: 756c 7469 5f69 6e64 6578 5b31 3a31 3030  ulti_index[1:100
+00015660: 3030 5d5b 2222 5d0a 2020 2020 2020 2020  00][""].        
+00015670: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
+00015680: 5f65 7175 616c 286e 702e 736f 7274 2872  _equal(np.sort(r
+00015690: 6573 292c 206e 702e 736f 7274 2864 6174  es), np.sort(dat
+000156a0: 6129 290a 2020 2020 2020 2020 2020 2020  a)).            
+000156b0: 7265 7320 3d20 412e 7175 6572 7928 6f72  res = A.query(or
+000156c0: 6465 723d 2255 2229 2e6d 756c 7469 5f69  der="U").multi_i
+000156d0: 6e64 6578 5b31 3a31 3030 3030 5d5b 2222  ndex[1:10000][""
+000156e0: 5d0a 2020 2020 2020 2020 2020 2020 6173  ].            as
+000156f0: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
+00015700: 286e 702e 736f 7274 2872 6573 292c 206e  (np.sort(res), n
+00015710: 702e 736f 7274 2864 6174 6129 290a 0a20  p.sort(data)).. 
+00015720: 2020 2064 6566 2074 6573 745f 7370 6172     def test_spar
+00015730: 7365 5f66 6978 6573 2873 656c 662c 2073  se_fixes(self, s
+00015740: 7061 7273 655f 6365 6c6c 5f6f 7264 6572  parse_cell_order
+00015750: 293a 0a20 2020 2020 2020 2075 7269 203d  ):.        uri =
+00015760: 2073 656c 662e 7061 7468 2822 7465 7374   self.path("test
+00015770: 5f73 7061 7273 655f 6669 7865 7322 290a  _sparse_fixes").
+00015780: 2020 2020 2020 2020 2320 696e 6465 7869          # indexi
+00015790: 6e67 2061 2031 2065 6c65 6d65 6e74 2069  ng a 1 element i
+000157a0: 7465 6d20 696e 2061 2073 7061 7273 6520  tem in a sparse 
+000157b0: 6172 7261 790a 2020 2020 2020 2020 2320  array.        # 
+000157c0: 2869 7373 7565 2064 6972 6563 746c 7920  (issue directly 
+000157d0: 7265 706f 7274 6564 290a 2020 2020 2020  reported).      
+000157e0: 2020 2320 7468 6520 7465 7374 2068 6572    # the test her
+000157f0: 6520 6973 2074 6861 7420 7468 6520 696e  e is that the in
+00015800: 6465 7869 6e67 2064 6f65 7320 6e6f 7420  dexing does not 
+00015810: 7261 6973 650a 2020 2020 2020 2020 6469  raise.        di
+00015820: 6d73 203d 2028 0a20 2020 2020 2020 2020  ms = (.         
+00015830: 2020 2074 696c 6564 622e 4469 6d28 2266     tiledb.Dim("f
+00015840: 6f6f 222c 2064 6f6d 6169 6e3d 2830 2c20  oo", domain=(0, 
+00015850: 3629 2c20 7469 6c65 3d32 292c 0a20 2020  6), tile=2),.   
+00015860: 2020 2020 2020 2020 2074 696c 6564 622e           tiledb.
+00015870: 4469 6d28 2262 6172 222c 2064 6f6d 6169  Dim("bar", domai
+00015880: 6e3d 2830 2c20 3629 2c20 7469 6c65 3d31  n=(0, 6), tile=1
+00015890: 292c 0a20 2020 2020 2020 2020 2020 2074  ),.            t
+000158a0: 696c 6564 622e 4469 6d28 2262 617a 222c  iledb.Dim("baz",
+000158b0: 2064 6f6d 6169 6e3d 2830 2c20 3130 3029   domain=(0, 100)
+000158c0: 2c20 7469 6c65 3d31 292c 0a20 2020 2020  , tile=1),.     
+000158d0: 2020 2029 0a20 2020 2020 2020 2064 6f6d     ).        dom
+000158e0: 203d 2074 696c 6564 622e 446f 6d61 696e   = tiledb.Domain
+000158f0: 282a 6469 6d73 290a 2020 2020 2020 2020  (*dims).        
+00015900: 6174 7420 3d20 7469 6c65 6462 2e41 7474  att = tiledb.Att
+00015910: 7228 6e61 6d65 3d22 7374 7261 7474 7222  r(name="strattr"
+00015920: 2c20 6474 7970 653d 2253 3122 290a 2020  , dtype="S1").  
+00015930: 2020 2020 2020 7363 6865 6d61 203d 2074        schema = t
+00015940: 696c 6564 622e 4172 7261 7953 6368 656d  iledb.ArraySchem
+00015950: 6128 0a20 2020 2020 2020 2020 2020 2064  a(.            d
+00015960: 6f6d 6169 6e3d 646f 6d2c 2061 7474 7273  omain=dom, attrs
+00015970: 3d28 6174 742c 292c 2073 7061 7273 653d  =(att,), sparse=
+00015980: 5472 7565 2c20 6365 6c6c 5f6f 7264 6572  True, cell_order
+00015990: 3d73 7061 7273 655f 6365 6c6c 5f6f 7264  =sparse_cell_ord
+000159a0: 6572 0a20 2020 2020 2020 2029 0a20 2020  er.        ).   
+000159b0: 2020 2020 2074 696c 6564 622e 5370 6172       tiledb.Spar
+000159c0: 7365 4172 7261 792e 6372 6561 7465 2875  seArray.create(u
+000159d0: 7269 2c20 7363 6865 6d61 290a 2020 2020  ri, schema).    
+000159e0: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+000159f0: 5370 6172 7365 4172 7261 7928 7572 6929  SparseArray(uri)
+00015a00: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
+00015a10: 2020 2054 5b3a 5d0a 0a20 2020 2020 2020     T[:]..       
+00015a20: 2023 202d 2074 6573 7420 7468 6174 2061   # - test that a
+00015a30: 7373 6967 6e69 6e67 2069 6e63 6f6d 7061  ssigning incompa
+00015a40: 7469 626c 6520 7661 6c75 6520 746f 2066  tible value to f
+00015a50: 6978 6564 2d6c 656e 2073 7472 2072 6169  ixed-len str rai
+00015a60: 7365 7320 6572 726f 720a 2020 2020 2020  ses error.      
+00015a70: 2020 2320 2d20 7465 7374 2074 6861 7420    # - test that 
+00015a80: 7661 6c75 652d 636f 6e76 6572 7369 6f6e  value-conversion
+00015a90: 2065 7272 6f72 2072 6169 7365 7320 6578   error raises ex
+00015aa0: 6365 7074 696f 6e20 772f 2061 7474 7220  ception w/ attr 
+00015ab0: 6e61 6d65 2063 6f6e 7465 7874 0a20 2020  name context.   
+00015ac0: 2020 2020 2063 203d 206e 702e 7673 7461       c = np.vsta
+00015ad0: 636b 280a 2020 2020 2020 2020 2020 2020  ck(.            
+00015ae0: 6c69 7374 2828 782c 2079 2c20 7a29 2066  list((x, y, z) f
+00015af0: 6f72 2078 2069 6e20 7261 6e67 6528 3729  or x in range(7)
+00015b00: 2066 6f72 2079 2069 6e20 7261 6e67 6528   for y in range(
+00015b10: 3729 2066 6f72 207a 2069 6e20 7261 6e67  7) for z in rang
+00015b20: 6528 3130 3129 290a 2020 2020 2020 2020  e(101)).        
+00015b30: 290a 2020 2020 2020 2020 7769 7468 2074  ).        with t
+00015b40: 696c 6564 622e 5370 6172 7365 4172 7261  iledb.SparseArra
+00015b50: 7928 7572 692c 2022 7722 2920 6173 2054  y(uri, "w") as T
+00015b60: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
+00015b70: 7468 2073 656c 662e 6173 7365 7274 5261  th self.assertRa
+00015b80: 6973 6573 2856 616c 7565 4572 726f 7229  ises(ValueError)
+00015b90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015ba0: 2020 545b 635b 3a2c 2030 5d2c 2063 5b3a    T[c[:, 0], c[:
+00015bb0: 2c20 315d 2c20 635b 3a2c 2032 5d5d 203d  , 1], c[:, 2]] =
+00015bc0: 207b 2273 7472 6174 7472 223a 206e 702e   {"strattr": np.
+00015bd0: 7261 6e64 6f6d 2e72 616e 6428 372c 2037  random.rand(7, 7
+00015be0: 2c20 3130 3129 7d0a 2020 2020 2020 2020  , 101)}.        
+00015bf0: 2020 2020 7361 7665 5f65 7863 203d 206c      save_exc = l
+00015c00: 6973 7428 290a 2020 2020 2020 2020 2020  ist().          
+00015c10: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00015c20: 2020 2020 2020 2054 5b63 5b3a 2c20 305d         T[c[:, 0]
+00015c30: 2c20 635b 3a2c 2031 5d2c 2063 5b3a 2c20  , c[:, 1], c[:, 
+00015c40: 325d 5d20 3d20 7b22 7374 7261 7474 7222  2]] = {"strattr"
+00015c50: 3a20 6e70 2e72 616e 646f 6d2e 7261 6e64  : np.random.rand
+00015c60: 2837 2c20 372c 2031 3031 297d 0a20 2020  (7, 7, 101)}.   
+00015c70: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00015c80: 5661 6c75 6545 7272 6f72 2061 7320 653a  ValueError as e:
+00015c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015ca0: 2073 6176 655f 6578 632e 6170 7065 6e64   save_exc.append
+00015cb0: 2865 290a 2020 2020 2020 2020 2020 2020  (e).            
+00015cc0: 6578 6320 3d20 7361 7665 5f65 7863 2e70  exc = save_exc.p
+00015cd0: 6f70 2829 0a20 2020 2020 2020 2020 2020  op().           
+00015ce0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00015cf0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+00015d00: 2020 2073 7472 2865 7863 2e5f 5f63 6f6e     str(exc.__con
+00015d10: 7465 7874 5f5f 292c 0a20 2020 2020 2020  text__),.       
+00015d20: 2020 2020 2020 2020 2022 4361 6e6e 6f74           "Cannot
+00015d30: 2077 7269 7465 2061 2073 7472 696e 6720   write a string 
+00015d40: 7661 6c75 6520 746f 206e 6f6e 2d73 7472  value to non-str
+00015d50: 696e 6720 7479 7065 6420 6174 7472 6962  ing typed attrib
+00015d60: 7574 6520 2773 7472 6174 7472 2721 222c  ute 'strattr'!",
+00015d70: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00015d80: 2020 2020 4074 696c 6564 622e 7363 6f70      @tiledb.scop
+00015d90: 655f 6374 7828 7b22 736d 2e63 6865 636b  e_ctx({"sm.check
+00015da0: 5f63 6f6f 7264 5f64 7570 7322 3a20 4661  _coord_dups": Fa
+00015db0: 6c73 657d 290a 2020 2020 6465 6620 7465  lse}).    def te
+00015dc0: 7374 5f73 7061 7273 655f 6669 7865 735f  st_sparse_fixes_
+00015dd0: 6368 3135 3630 2873 656c 662c 2073 7061  ch1560(self, spa
+00015de0: 7273 655f 6365 6c6c 5f6f 7264 6572 293a  rse_cell_order):
+00015df0: 0a20 2020 2020 2020 2075 7269 203d 2073  .        uri = s
+00015e00: 656c 662e 7061 7468 2822 7370 6172 7365  elf.path("sparse
+00015e10: 5f66 6978 6573 5f63 6831 3536 3022 290a  _fixes_ch1560").
+00015e20: 2020 2020 2020 2020 7363 6865 6d61 203d          schema =
+00015e30: 2074 696c 6564 622e 4172 7261 7953 6368   tiledb.ArraySch
+00015e40: 656d 6128 0a20 2020 2020 2020 2020 2020  ema(.           
+00015e50: 2064 6f6d 6169 6e3d 7469 6c65 6462 2e44   domain=tiledb.D
+00015e60: 6f6d 6169 6e28 0a20 2020 2020 2020 2020  omain(.         
+00015e70: 2020 2020 2020 202a 5b74 696c 6564 622e         *[tiledb.
+00015e80: 4469 6d28 6e61 6d65 3d22 6964 222c 2064  Dim(name="id", d
+00015e90: 6f6d 6169 6e3d 2831 2c20 3530 3030 292c  omain=(1, 5000),
+00015ea0: 2074 696c 653d 3235 2c20 6474 7970 653d   tile=25, dtype=
+00015eb0: 2269 6e74 3332 2229 5d0a 2020 2020 2020  "int32")].      
+00015ec0: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+00015ed0: 2020 2020 2061 7474 7273 3d5b 0a20 2020       attrs=[.   
+00015ee0: 2020 2020 2020 2020 2020 2020 2074 696c               til
+00015ef0: 6564 622e 4174 7472 286e 616d 653d 2261  edb.Attr(name="a
+00015f00: 3122 2c20 6474 7970 653d 2264 6174 6574  1", dtype="datet
+00015f10: 696d 6536 345b 735d 2229 2c0a 2020 2020  ime64[s]"),.    
+00015f20: 2020 2020 2020 2020 2020 2020 7469 6c65              tile
+00015f30: 6462 2e41 7474 7228 6e61 6d65 3d22 6132  db.Attr(name="a2
+00015f40: 222c 2064 7479 7065 3d22 7c53 3022 292c  ", dtype="|S0"),
+00015f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015f60: 2074 696c 6564 622e 4174 7472 286e 616d   tiledb.Attr(nam
+00015f70: 653d 2261 3322 2c20 6474 7970 653d 227c  e="a3", dtype="|
+00015f80: 5330 2229 2c0a 2020 2020 2020 2020 2020  S0"),.          
+00015f90: 2020 2020 2020 7469 6c65 6462 2e41 7474        tiledb.Att
+00015fa0: 7228 6e61 6d65 3d22 6134 222c 2064 7479  r(name="a4", dty
+00015fb0: 7065 3d22 696e 7433 3222 292c 0a20 2020  pe="int32"),.   
+00015fc0: 2020 2020 2020 2020 2020 2020 2074 696c               til
+00015fd0: 6564 622e 4174 7472 286e 616d 653d 2261  edb.Attr(name="a
+00015fe0: 3522 2c20 6474 7970 653d 2269 6e74 3822  5", dtype="int8"
+00015ff0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00016000: 2020 2074 696c 6564 622e 4174 7472 286e     tiledb.Attr(n
+00016010: 616d 653d 2261 3622 2c20 6474 7970 653d  ame="a6", dtype=
+00016020: 2269 6e74 3332 2229 2c0a 2020 2020 2020  "int32"),.      
+00016030: 2020 2020 2020 5d2c 0a20 2020 2020 2020        ],.       
+00016040: 2020 2020 2063 656c 6c5f 6f72 6465 723d       cell_order=
+00016050: 7370 6172 7365 5f63 656c 6c5f 6f72 6465  sparse_cell_orde
+00016060: 722c 0a20 2020 2020 2020 2020 2020 2074  r,.            t
+00016070: 696c 655f 6f72 6465 723d 2272 6f77 2d6d  ile_order="row-m
+00016080: 616a 6f72 222c 0a20 2020 2020 2020 2020  ajor",.         
+00016090: 2020 2073 7061 7273 653d 5472 7565 2c0a     sparse=True,.
+000160a0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+000160b0: 2020 2074 696c 6564 622e 5370 6172 7365     tiledb.Sparse
+000160c0: 4172 7261 792e 6372 6561 7465 2875 7269  Array.create(uri
+000160d0: 2c20 7363 6865 6d61 290a 0a20 2020 2020  , schema)..     
+000160e0: 2020 2064 6174 6120 3d20 4f72 6465 7265     data = Ordere
+000160f0: 6444 6963 7428 0a20 2020 2020 2020 2020  dDict(.         
+00016100: 2020 205b 0a20 2020 2020 2020 2020 2020     [.           
+00016110: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
+00016120: 2020 2020 2020 2020 2020 2022 6131 222c             "a1",
+00016130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016140: 2020 2020 206e 702e 6172 7261 7928 0a20       np.array(. 
+00016150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016160: 2020 2020 2020 205b 0a20 2020 2020 2020         [.       
+00016170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016180: 2020 2020 2022 3230 3137 2d30 342d 3031       "2017-04-01
+00016190: 5430 343a 3030 3a30 3022 2c0a 2020 2020  T04:00:00",.    
+000161a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161b0: 2020 2020 2020 2020 2232 3031 392d 3130          "2019-10
+000161c0: 2d30 3154 3030 3a30 303a 3030 222c 0a20  -01T00:00:00",. 
+000161d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161e0: 2020 2020 2020 2020 2020 2022 3230 3139             "2019
+000161f0: 2d31 302d 3031 5430 303a 3030 3a30 3022  -10-01T00:00:00"
+00016200: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00016210: 2020 2020 2020 2020 2020 2020 2020 2232                "2
+00016220: 3031 392d 3130 2d30 3154 3030 3a30 303a  019-10-01T00:00:
+00016230: 3030 222c 0a20 2020 2020 2020 2020 2020  00",.           
+00016240: 2020 2020 2020 2020 2020 2020 205d 2c0a               ],.
+00016250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016260: 2020 2020 2020 2020 6474 7970 653d 2264          dtype="d
+00016270: 6174 6574 696d 6536 345b 735d 222c 0a20  atetime64[s]",. 
 00016280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016290: 6e70 2e61 7272 6179 285b 332c 2033 2c20  np.array([3, 3, 
-000162a0: 335d 2c20 6474 7970 653d 6e70 2e69 6e74  3], dtype=np.int
-000162b0: 3332 292c 0a20 2020 2020 2020 2020 2020  32),.           
-000162c0: 2020 2020 206e 702e 6172 7261 7928 5b34       np.array([4
-000162d0: 5d2c 2064 7479 7065 3d6e 702e 696e 7433  ], dtype=np.int3
-000162e0: 3229 2c0a 2020 2020 2020 2020 2020 2020  2),.            
-000162f0: 5d2c 0a20 2020 2020 2020 2020 2020 2064  ],.            d
-00016300: 7479 7065 3d22 4f22 2c0a 2020 2020 2020  type="O",.      
-00016310: 2020 290a 0a20 2020 2020 2020 2077 6974    )..        wit
-00016320: 6820 7469 6c65 6462 2e53 7061 7273 6541  h tiledb.SparseA
-00016330: 7272 6179 2870 6174 682c 2022 7722 2920  rray(path, "w") 
-00016340: 6173 2041 3a0a 2020 2020 2020 2020 2020  as A:.          
-00016350: 2020 415b 6331 2c20 6332 5d20 3d20 6461    A[c1, c2] = da
-00016360: 7461 0a0a 2020 2020 2020 2020 7769 7468  ta..        with
-00016370: 2074 696c 6564 622e 5370 6172 7365 4172   tiledb.SparseAr
-00016380: 7261 7928 7061 7468 2920 6173 2041 3a0a  ray(path) as A:.
-00016390: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-000163a0: 3d20 415b 3a5d 0a20 2020 2020 2020 2020  = A[:].         
-000163b0: 2020 2061 7373 6572 745f 7375 6261 7272     assert_subarr
-000163c0: 6179 735f 6571 7561 6c28 7265 735b 2222  ays_equal(res[""
-000163d0: 5d2c 2064 6174 6129 0a20 2020 2020 2020  ], data).       
-000163e0: 2020 2020 2061 7373 6572 745f 756e 6f72       assert_unor
-000163f0: 6465 7265 645f 6571 7561 6c28 7265 735b  dered_equal(res[
-00016400: 225f 5f64 696d 5f30 225d 2c20 6331 290a  "__dim_0"], c1).
-00016410: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00016420: 7274 5f75 6e6f 7264 6572 6564 5f65 7175  rt_unordered_equ
-00016430: 616c 2872 6573 5b22 5f5f 6469 6d5f 3122  al(res["__dim_1"
-00016440: 5d2c 2063 3229 0a0a 2020 2020 6465 6620  ], c2)..    def 
-00016450: 7465 7374 5f73 7061 7273 655f 6d69 7865  test_sparse_mixe
-00016460: 645f 646f 6d61 696e 5f75 696e 745f 666c  d_domain_uint_fl
-00016470: 6f61 7436 3428 7365 6c66 2c20 7370 6172  oat64(self, spar
-00016480: 7365 5f63 656c 6c5f 6f72 6465 7229 3a0a  se_cell_order):.
-00016490: 2020 2020 2020 2020 7061 7468 203d 2073          path = s
-000164a0: 656c 662e 7061 7468 2822 6d69 7865 645f  elf.path("mixed_
-000164b0: 646f 6d61 696e 5f75 696e 745f 666c 6f61  domain_uint_floa
-000164c0: 7436 3422 290a 2020 2020 2020 2020 6469  t64").        di
-000164d0: 6d73 203d 205b 0a20 2020 2020 2020 2020  ms = [.         
-000164e0: 2020 2074 696c 6564 622e 4469 6d28 6e61     tiledb.Dim(na
-000164f0: 6d65 3d22 696e 6465 7822 2c20 646f 6d61  me="index", doma
-00016500: 696e 3d28 302c 2035 3129 2c20 7469 6c65  in=(0, 51), tile
-00016510: 3d31 312c 2064 7479 7065 3d6e 702e 7569  =11, dtype=np.ui
-00016520: 6e74 3634 292c 0a20 2020 2020 2020 2020  nt64),.         
-00016530: 2020 2074 696c 6564 622e 4469 6d28 6e61     tiledb.Dim(na
-00016540: 6d65 3d22 6470 6f73 222c 2064 6f6d 6169  me="dpos", domai
-00016550: 6e3d 282d 3130 302e 302c 2031 3030 2e30  n=(-100.0, 100.0
-00016560: 292c 2074 696c 653d 3130 2c20 6474 7970  ), tile=10, dtyp
-00016570: 653d 6e70 2e66 6c6f 6174 3634 292c 0a20  e=np.float64),. 
-00016580: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00016590: 2064 6f6d 203d 2074 696c 6564 622e 446f   dom = tiledb.Do
-000165a0: 6d61 696e 282a 6469 6d73 290a 2020 2020  main(*dims).    
-000165b0: 2020 2020 6174 7472 7320 3d20 5b74 696c      attrs = [til
-000165c0: 6564 622e 4174 7472 286e 616d 653d 2276  edb.Attr(name="v
-000165d0: 616c 222c 2064 7479 7065 3d6e 702e 666c  al", dtype=np.fl
-000165e0: 6f61 7436 3429 5d0a 0a20 2020 2020 2020  oat64)]..       
-000165f0: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
-00016600: 2e41 7272 6179 5363 6865 6d61 280a 2020  .ArraySchema(.  
-00016610: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
-00016620: 3d64 6f6d 2c20 6174 7472 733d 6174 7472  =dom, attrs=attr
-00016630: 732c 2073 7061 7273 653d 5472 7565 2c20  s, sparse=True, 
-00016640: 6365 6c6c 5f6f 7264 6572 3d73 7061 7273  cell_order=spars
-00016650: 655f 6365 6c6c 5f6f 7264 6572 0a20 2020  e_cell_order.   
-00016660: 2020 2020 2029 0a20 2020 2020 2020 2074       ).        t
-00016670: 696c 6564 622e 5370 6172 7365 4172 7261  iledb.SparseArra
-00016680: 792e 6372 6561 7465 2870 6174 682c 2073  y.create(path, s
-00016690: 6368 656d 6129 0a0a 2020 2020 2020 2020  chema)..        
-000166a0: 6461 7461 203d 206e 702e 7261 6e64 6f6d  data = np.random
-000166b0: 2e72 616e 6428 3530 2c20 3633 290a 2020  .rand(50, 63).  
-000166c0: 2020 2020 2020 636f 6f72 6473 3120 3d20        coords1 = 
-000166d0: 6e70 2e72 6570 6561 7428 6e70 2e61 7261  np.repeat(np.ara
-000166e0: 6e67 6528 302c 2035 3029 2c20 3633 290a  nge(0, 50), 63).
-000166f0: 2020 2020 2020 2020 636f 6f72 6473 3220          coords2 
-00016700: 3d20 6e70 2e6c 696e 7370 6163 6528 2d31  = np.linspace(-1
-00016710: 3030 2e30 2c20 3130 302e 302c 206e 756d  00.0, 100.0, num
-00016720: 3d33 3135 3029 0a0a 2020 2020 2020 2020  =3150)..        
-00016730: 7769 7468 2074 696c 6564 622e 6f70 656e  with tiledb.open
-00016740: 2870 6174 682c 2022 7722 2920 6173 2041  (path, "w") as A
-00016750: 3a0a 2020 2020 2020 2020 2020 2020 415b  :.            A[
-00016760: 636f 6f72 6473 312c 2063 6f6f 7264 7332  coords1, coords2
-00016770: 5d20 3d20 6461 7461 0a0a 2020 2020 2020  ] = data..      
-00016780: 2020 2320 7469 6c65 6462 2072 6574 7572    # tiledb retur
-00016790: 6e73 2063 6f6f 7264 696e 6174 6573 2069  ns coordinates i
-000167a0: 6e20 736f 7274 6564 206f 7264 6572 2c20  n sorted order, 
-000167b0: 736f 2077 6520 6e65 6564 2074 6f20 6368  so we need to ch
-000167c0: 6563 6b20 7468 6520 6f75 7470 7574 0a20  eck the output. 
-000167d0: 2020 2020 2020 2023 2073 6f72 7465 6420         # sorted 
-000167e0: 6279 2074 6865 2066 6972 7374 2064 696d  by the first dim
-000167f0: 2063 6f6f 7264 696e 6174 6573 0a20 2020   coordinates.   
-00016800: 2020 2020 2073 6964 7820 3d20 6e70 2e61       sidx = np.a
-00016810: 7267 736f 7274 2863 6f6f 7264 7331 2c20  rgsort(coords1, 
-00016820: 6b69 6e64 3d22 7374 6162 6c65 2229 0a20  kind="stable"). 
-00016830: 2020 2020 2020 2063 6f6f 7264 7332 5f69         coords2_i
-00016840: 6478 203d 206e 702e 7469 6c65 286e 702e  dx = np.tile(np.
-00016850: 6172 616e 6765 2830 2c20 3633 292c 2035  arange(0, 63), 5
-00016860: 3029 5b73 6964 785d 0a0a 2020 2020 2020  0)[sidx]..      
-00016870: 2020 7769 7468 2074 696c 6564 622e 6f70    with tiledb.op
-00016880: 656e 2870 6174 6829 2061 7320 413a 0a20  en(path) as A:. 
-00016890: 2020 2020 2020 2020 2020 2072 6573 203d             res =
-000168a0: 2041 5b3a 5d0a 2020 2020 2020 2020 2020   A[:].          
-000168b0: 2020 6173 7365 7274 5f73 7562 6172 7261    assert_subarra
-000168c0: 7973 5f65 7175 616c 280a 2020 2020 2020  ys_equal(.      
-000168d0: 2020 2020 2020 2020 2020 6461 7461 5b63            data[c
-000168e0: 6f6f 7264 7331 5b73 6964 785d 2c20 636f  oords1[sidx], co
-000168f0: 6f72 6473 325f 6964 785b 7369 6478 5d5d  ords2_idx[sidx]]
-00016900: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00016910: 2020 7265 735b 2276 616c 225d 2c0a 2020    res["val"],.  
-00016920: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-00016930: 6172 7365 5f63 656c 6c5f 6f72 6465 7220  arse_cell_order 
-00016940: 213d 2022 6869 6c62 6572 7422 2c0a 2020  != "hilbert",.  
-00016950: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00016960: 2020 2020 2020 2020 615f 6e6f 6e65 6d70          a_nonemp
-00016970: 7479 203d 2041 2e6e 6f6e 656d 7074 795f  ty = A.nonempty_
-00016980: 646f 6d61 696e 2829 0a20 2020 2020 2020  domain().       
-00016990: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000169a0: 4571 7561 6c28 615f 6e6f 6e65 6d70 7479  Equal(a_nonempty
-000169b0: 5b30 5d2c 2028 302c 2034 3929 290a 2020  [0], (0, 49)).  
-000169c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000169d0: 7373 6572 7445 7175 616c 2861 5f6e 6f6e  ssertEqual(a_non
-000169e0: 656d 7074 795b 315d 2c20 282d 3130 302e  empty[1], (-100.
-000169f0: 302c 2031 3030 2e30 2929 0a0a 2020 2020  0, 100.0))..    
-00016a00: 6465 6620 7465 7374 5f73 7061 7273 655f  def test_sparse_
-00016a10: 7374 7269 6e67 5f64 6f6d 6169 6e28 7365  string_domain(se
-00016a20: 6c66 2c20 7370 6172 7365 5f63 656c 6c5f  lf, sparse_cell_
-00016a30: 6f72 6465 7229 3a0a 2020 2020 2020 2020  order):.        
-00016a40: 7061 7468 203d 2073 656c 662e 7061 7468  path = self.path
-00016a50: 2822 7370 6172 7365 5f73 7472 696e 675f  ("sparse_string_
-00016a60: 646f 6d61 696e 2229 0a20 2020 2020 2020  domain").       
-00016a70: 2064 6f6d 203d 2074 696c 6564 622e 446f   dom = tiledb.Do
-00016a80: 6d61 696e 2874 696c 6564 622e 4469 6d28  main(tiledb.Dim(
-00016a90: 6e61 6d65 3d22 6422 2c20 646f 6d61 696e  name="d", domain
-00016aa0: 3d28 4e6f 6e65 2c20 4e6f 6e65 292c 2064  =(None, None), d
-00016ab0: 7479 7065 3d6e 702e 6279 7465 735f 2929  type=np.bytes_))
-00016ac0: 0a20 2020 2020 2020 2061 7474 203d 2074  .        att = t
-00016ad0: 696c 6564 622e 4174 7472 286e 616d 653d  iledb.Attr(name=
-00016ae0: 2261 222c 2064 7479 7065 3d6e 702e 696e  "a", dtype=np.in
-00016af0: 7436 3429 0a20 2020 2020 2020 2073 6368  t64).        sch
-00016b00: 656d 6120 3d20 7469 6c65 6462 2e41 7272  ema = tiledb.Arr
-00016b10: 6179 5363 6865 6d61 280a 2020 2020 2020  aySchema(.      
-00016b20: 2020 2020 2020 646f 6d61 696e 3d64 6f6d        domain=dom
-00016b30: 2c0a 2020 2020 2020 2020 2020 2020 6174  ,.            at
-00016b40: 7472 733d 2861 7474 2c29 2c0a 2020 2020  trs=(att,),.    
-00016b50: 2020 2020 2020 2020 7370 6172 7365 3d54          sparse=T
-00016b60: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-00016b70: 2063 656c 6c5f 6f72 6465 723d 7370 6172   cell_order=spar
-00016b80: 7365 5f63 656c 6c5f 6f72 6465 722c 0a20  se_cell_order,. 
-00016b90: 2020 2020 2020 2020 2020 2063 6170 6163             capac
-00016ba0: 6974 793d 3130 3030 302c 0a20 2020 2020  ity=10000,.     
-00016bb0: 2020 2029 0a20 2020 2020 2020 2074 696c     ).        til
-00016bc0: 6564 622e 5370 6172 7365 4172 7261 792e  edb.SparseArray.
-00016bd0: 6372 6561 7465 2870 6174 682c 2073 6368  create(path, sch
-00016be0: 656d 6129 0a0a 2020 2020 2020 2020 6461  ema)..        da
-00016bf0: 7461 203d 205b 312c 2032 2c20 332c 2034  ta = [1, 2, 3, 4
-00016c00: 5d0a 2020 2020 2020 2020 636f 6f72 6473  ].        coords
-00016c10: 203d 205b 6222 6161 222c 2062 2262 6262   = [b"aa", b"bbb
-00016c20: 222c 2062 2263 222c 2062 2264 6464 6422  ", b"c", b"dddd"
-00016c30: 5d0a 0a20 2020 2020 2020 2077 6974 6820  ]..        with 
-00016c40: 7469 6c65 6462 2e6f 7065 6e28 7061 7468  tiledb.open(path
-00016c50: 2c20 2277 2229 2061 7320 413a 0a20 2020  , "w") as A:.   
-00016c60: 2020 2020 2020 2020 2041 5b63 6f6f 7264           A[coord
-00016c70: 735d 203d 2064 6174 610a 0a20 2020 2020  s] = data..     
-00016c80: 2020 2077 6974 6820 7469 6c65 6462 2e6f     with tiledb.o
-00016c90: 7065 6e28 7061 7468 2920 6173 2041 3a0a  pen(path) as A:.
-00016ca0: 2020 2020 2020 2020 2020 2020 6e65 6420              ned 
-00016cb0: 3d20 412e 6e6f 6e65 6d70 7479 5f64 6f6d  = A.nonempty_dom
-00016cc0: 6169 6e28 295b 305d 0a20 2020 2020 2020  ain()[0].       
-00016cd0: 2020 2020 2072 6573 203d 2041 5b6e 6564       res = A[ned
-00016ce0: 5b30 5d20 3a20 6e65 645b 315d 5d0a 2020  [0] : ned[1]].  
-00016cf0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00016d00: 5f61 7272 6179 5f65 7175 616c 2872 6573  _array_equal(res
-00016d10: 5b22 6122 5d2c 2064 6174 6129 0a20 2020  ["a"], data).   
-00016d20: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
-00016d30: 7365 7274 4571 7561 6c28 7365 7428 7265  sertEqual(set(re
-00016d40: 735b 2264 225d 292c 2073 6574 2863 6f6f  s["d"]), set(coo
-00016d50: 7264 7329 290a 2020 2020 2020 2020 2020  rds)).          
-00016d60: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00016d70: 616c 2841 2e6e 6f6e 656d 7074 795f 646f  al(A.nonempty_do
-00016d80: 6d61 696e 2829 2c20 2828 6222 6161 222c  main(), ((b"aa",
-00016d90: 2062 2264 6464 6422 292c 2929 0a0a 2020   b"dddd"),))..  
-00016da0: 2020 6465 6620 7465 7374 5f73 7061 7273    def test_spars
-00016db0: 655f 7374 7269 6e67 5f64 6f6d 6169 6e32  e_string_domain2
-00016dc0: 2873 656c 662c 2073 7061 7273 655f 6365  (self, sparse_ce
-00016dd0: 6c6c 5f6f 7264 6572 293a 0a20 2020 2020  ll_order):.     
-00016de0: 2020 2070 6174 6820 3d20 7365 6c66 2e70     path = self.p
-00016df0: 6174 6828 2273 7061 7273 655f 7374 7269  ath("sparse_stri
-00016e00: 6e67 5f64 6f6d 6169 6e32 2229 0a20 2020  ng_domain2").   
-00016e10: 2020 2020 2064 696d 7320 3d20 5b74 696c       dims = [til
-00016e20: 6564 622e 4469 6d28 6e61 6d65 3d22 7374  edb.Dim(name="st
-00016e30: 7222 2c20 646f 6d61 696e 3d28 4e6f 6e65  r", domain=(None
-00016e40: 2c20 4e6f 6e65 292c 2074 696c 653d 4e6f  , None), tile=No
-00016e50: 6e65 2c20 6474 7970 653d 6e70 2e62 7974  ne, dtype=np.byt
-00016e60: 6573 5f29 5d0a 2020 2020 2020 2020 646f  es_)].        do
-00016e70: 6d20 3d20 7469 6c65 6462 2e44 6f6d 6169  m = tiledb.Domai
-00016e80: 6e28 2a64 696d 7329 0a20 2020 2020 2020  n(*dims).       
-00016e90: 2061 7474 7273 203d 205b 7469 6c65 6462   attrs = [tiledb
-00016ea0: 2e41 7474 7228 6e61 6d65 3d22 7661 6c22  .Attr(name="val"
-00016eb0: 2c20 6474 7970 653d 6e70 2e66 6c6f 6174  , dtype=np.float
-00016ec0: 3634 295d 0a0a 2020 2020 2020 2020 7363  64)]..        sc
-00016ed0: 6865 6d61 203d 2074 696c 6564 622e 4172  hema = tiledb.Ar
-00016ee0: 7261 7953 6368 656d 6128 0a20 2020 2020  raySchema(.     
-00016ef0: 2020 2020 2020 2064 6f6d 6169 6e3d 646f         domain=do
-00016f00: 6d2c 2061 7474 7273 3d61 7474 7273 2c20  m, attrs=attrs, 
-00016f10: 7370 6172 7365 3d54 7275 652c 2063 656c  sparse=True, cel
-00016f20: 6c5f 6f72 6465 723d 7370 6172 7365 5f63  l_order=sparse_c
-00016f30: 656c 6c5f 6f72 6465 720a 2020 2020 2020  ell_order.      
-00016f40: 2020 290a 2020 2020 2020 2020 7469 6c65    ).        tile
-00016f50: 6462 2e53 7061 7273 6541 7272 6179 2e63  db.SparseArray.c
-00016f60: 7265 6174 6528 7061 7468 2c20 7363 6865  reate(path, sche
-00016f70: 6d61 290a 0a20 2020 2020 2020 2064 6174  ma)..        dat
-00016f80: 6120 3d20 6e70 2e72 616e 646f 6d2e 7261  a = np.random.ra
-00016f90: 6e64 2831 3029 0a20 2020 2020 2020 2063  nd(10).        c
-00016fa0: 6f6f 7264 7320 3d20 5b72 616e 645f 6173  oords = [rand_as
-00016fb0: 6369 695f 6279 7465 7328 7261 6e64 6f6d  cii_bytes(random
-00016fc0: 2e72 616e 6469 6e74 2835 2c20 3530 2929  .randint(5, 50))
-00016fd0: 2066 6f72 205f 2069 6e20 7261 6e67 6528   for _ in range(
-00016fe0: 3130 295d 0a0a 2020 2020 2020 2020 7769  10)]..        wi
-00016ff0: 7468 2074 696c 6564 622e 6f70 656e 2870  th tiledb.open(p
-00017000: 6174 682c 2022 7722 2920 6173 2041 3a0a  ath, "w") as A:.
-00017010: 2020 2020 2020 2020 2020 2020 415b 636f              A[co
-00017020: 6f72 6473 5d20 3d20 6461 7461 0a0a 2020  ords] = data..  
-00017030: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-00017040: 622e 6f70 656e 2870 6174 6829 2061 7320  b.open(path) as 
-00017050: 413a 0a20 2020 2020 2020 2020 2020 206e  A:.            n
-00017060: 6564 203d 2041 2e6e 6f6e 656d 7074 795f  ed = A.nonempty_
-00017070: 646f 6d61 696e 2829 5b30 5d0a 2020 2020  domain()[0].    
-00017080: 2020 2020 2020 2020 7265 7320 3d20 415b          res = A[
-00017090: 6e65 645b 305d 203a 206e 6564 5b31 5d5d  ned[0] : ned[1]]
-000170a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000170b0: 662e 6173 7365 7274 5472 7565 2873 6574  f.assertTrue(set
-000170c0: 2872 6573 5b22 7374 7222 5d29 203d 3d20  (res["str"]) == 
-000170d0: 7365 7428 636f 6f72 6473 2929 0a20 2020  set(coords)).   
-000170e0: 2020 2020 2020 2020 2023 206d 7573 7420           # must 
-000170f0: 6368 6563 6b20 6461 7461 206f 7264 6572  check data order
-00017100: 6564 2062 7920 636f 6f72 6473 0a20 2020  ed by coords.   
-00017110: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-00017120: 6172 7261 795f 6571 7561 6c28 7265 735b  array_equal(res[
-00017130: 2276 616c 225d 2c20 6461 7461 5b6e 702e  "val"], data[np.
-00017140: 6172 6773 6f72 7428 636f 6f72 6473 2c20  argsort(coords, 
-00017150: 6b69 6e64 3d22 7374 6162 6c65 2229 5d29  kind="stable")])
-00017160: 0a0a 2020 2020 6465 6620 7465 7374 5f73  ..    def test_s
-00017170: 7061 7273 655f 6d69 7865 645f 646f 6d61  parse_mixed_doma
-00017180: 696e 2873 656c 662c 2073 7061 7273 655f  in(self, sparse_
-00017190: 6365 6c6c 5f6f 7264 6572 293a 0a20 2020  cell_order):.   
-000171a0: 2020 2020 2075 7269 203d 2073 656c 662e       uri = self.
-000171b0: 7061 7468 2822 7370 6172 7365 5f6d 6978  path("sparse_mix
-000171c0: 6564 5f64 6f6d 6169 6e22 290a 2020 2020  ed_domain").    
-000171d0: 2020 2020 6469 6d73 203d 205b 0a20 2020      dims = [.   
-000171e0: 2020 2020 2020 2020 2074 696c 6564 622e           tiledb.
-000171f0: 4469 6d28 6e61 6d65 3d22 7022 2c20 646f  Dim(name="p", do
-00017200: 6d61 696e 3d28 2d31 3030 2e30 2c20 3130  main=(-100.0, 10
-00017210: 302e 3029 2c20 7469 6c65 3d31 302c 2064  0.0), tile=10, d
-00017220: 7479 7065 3d6e 702e 666c 6f61 7436 3429  type=np.float64)
-00017230: 2c0a 2020 2020 2020 2020 2020 2020 7469  ,.            ti
-00017240: 6c65 6462 2e44 696d 286e 616d 653d 2273  ledb.Dim(name="s
-00017250: 7472 222c 2064 6f6d 6169 6e3d 284e 6f6e  tr", domain=(Non
-00017260: 652c 204e 6f6e 6529 2c20 7469 6c65 3d4e  e, None), tile=N
-00017270: 6f6e 652c 2064 7479 7065 3d6e 702e 6279  one, dtype=np.by
-00017280: 7465 735f 292c 0a20 2020 2020 2020 205d  tes_),.        ]
-00017290: 0a20 2020 2020 2020 2064 6f6d 203d 2074  .        dom = t
-000172a0: 696c 6564 622e 446f 6d61 696e 282a 6469  iledb.Domain(*di
-000172b0: 6d73 290a 2020 2020 2020 2020 6174 7472  ms).        attr
-000172c0: 7320 3d20 5b74 696c 6564 622e 4174 7472  s = [tiledb.Attr
-000172d0: 286e 616d 653d 2276 616c 222c 2064 7479  (name="val", dty
-000172e0: 7065 3d6e 702e 666c 6f61 7436 3429 5d0a  pe=np.float64)].
-000172f0: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
-00017300: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
-00017310: 6865 6d61 280a 2020 2020 2020 2020 2020  hema(.          
-00017320: 2020 646f 6d61 696e 3d64 6f6d 2c20 6174    domain=dom, at
-00017330: 7472 733d 6174 7472 732c 2073 7061 7273  trs=attrs, spars
-00017340: 653d 5472 7565 2c20 6365 6c6c 5f6f 7264  e=True, cell_ord
-00017350: 6572 3d73 7061 7273 655f 6365 6c6c 5f6f  er=sparse_cell_o
-00017360: 7264 6572 0a20 2020 2020 2020 2029 0a20  rder.        ). 
-00017370: 2020 2020 2020 2074 696c 6564 622e 5370         tiledb.Sp
-00017380: 6172 7365 4172 7261 792e 6372 6561 7465  arseArray.create
-00017390: 2875 7269 2c20 7363 6865 6d61 290a 0a20  (uri, schema).. 
-000173a0: 2020 2020 2020 206e 726f 7773 203d 2035         nrows = 5
-000173b0: 0a20 2020 2020 2020 2069 6478 5f66 3634  .        idx_f64
-000173c0: 203d 206e 702e 7261 6e64 6f6d 2e72 616e   = np.random.ran
-000173d0: 6428 6e72 6f77 7329 0a20 2020 2020 2020  d(nrows).       
-000173e0: 2069 6478 5f73 7472 203d 205b 7261 6e64   idx_str = [rand
-000173f0: 5f61 7363 6969 2835 292e 656e 636f 6465  _ascii(5).encode
-00017400: 2822 7574 662d 3822 2920 666f 7220 5f20  ("utf-8") for _ 
-00017410: 696e 2072 616e 6765 286e 726f 7773 295d  in range(nrows)]
-00017420: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-00017430: 6e70 2e72 616e 646f 6d2e 7261 6e64 286e  np.random.rand(n
-00017440: 726f 7773 290a 0a20 2020 2020 2020 2077  rows)..        w
-00017450: 6974 6820 7469 6c65 6462 2e53 7061 7273  ith tiledb.Spars
-00017460: 6541 7272 6179 2875 7269 2c20 2277 2229  eArray(uri, "w")
-00017470: 2061 7320 413a 0a20 2020 2020 2020 2020   as A:.         
-00017480: 2020 2041 5b69 6478 5f66 3634 2c20 6964     A[idx_f64, id
-00017490: 785f 7374 725d 203d 207b 2276 616c 223a  x_str] = {"val":
-000174a0: 2064 6174 617d 0a0a 2020 2020 2020 2020   data}..        
-000174b0: 2320 7465 7374 2068 6574 6572 6f67 656e  # test heterogen
-000174c0: 656f 7573 2064 696d 206e 6f6e 656d 7074  eous dim nonempt
-000174d0: 795f 646f 6d61 696e 0a20 2020 2020 2020  y_domain.       
-000174e0: 206e 6564 5f66 3634 203d 2028 6e70 2e61   ned_f64 = (np.a
-000174f0: 7272 6179 286e 702e 6d69 6e28 6964 785f  rray(np.min(idx_
-00017500: 6636 3429 292c 206e 702e 6172 7261 7928  f64)), np.array(
-00017510: 6e70 2e6d 6178 2869 6478 5f66 3634 2929  np.max(idx_f64))
-00017520: 290a 2020 2020 2020 2020 6964 785f 7374  ).        idx_st
-00017530: 722e 736f 7274 2829 0a20 2020 2020 2020  r.sort().       
-00017540: 206e 6564 5f73 7472 203d 2069 6478 5f73   ned_str = idx_s
-00017550: 7472 5b30 5d2c 2069 6478 5f73 7472 5b2d  tr[0], idx_str[-
-00017560: 315d 0a0a 2020 2020 2020 2020 7769 7468  1]..        with
-00017570: 2074 696c 6564 622e 5370 6172 7365 4172   tiledb.SparseAr
-00017580: 7261 7928 7572 692c 2022 7222 2920 6173  ray(uri, "r") as
-00017590: 2041 3a0a 2020 2020 2020 2020 2020 2020   A:.            
-000175a0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000175b0: 2841 2e6e 6f6e 656d 7074 795f 646f 6d61  (A.nonempty_doma
-000175c0: 696e 2829 2c20 286e 6564 5f66 3634 2c20  in(), (ned_f64, 
-000175d0: 6e65 645f 7374 7229 290a 0a20 2020 2064  ned_str))..    d
-000175e0: 6566 2074 6573 745f 7370 6172 7365 5f67  ef test_sparse_g
-000175f0: 6574 5f75 6e69 7175 655f 6469 6d5f 7661  et_unique_dim_va
-00017600: 6c75 6573 2873 656c 662c 2073 7061 7273  lues(self, spars
-00017610: 655f 6365 6c6c 5f6f 7264 6572 293a 0a20  e_cell_order):. 
-00017620: 2020 2020 2020 2075 7269 203d 2073 656c         uri = sel
-00017630: 662e 7061 7468 2822 6765 745f 6e6f 6e5f  f.path("get_non_
-00017640: 656d 7074 795f 636f 6f72 6473 2229 0a20  empty_coords"). 
-00017650: 2020 2020 2020 2064 696d 3120 3d20 7469         dim1 = ti
-00017660: 6c65 6462 2e44 696d 286e 616d 653d 2264  ledb.Dim(name="d
-00017670: 696d 3122 2c20 646f 6d61 696e 3d28 4e6f  im1", domain=(No
-00017680: 6e65 2c20 4e6f 6e65 292c 2074 696c 653d  ne, None), tile=
-00017690: 4e6f 6e65 2c20 6474 7970 653d 6e70 2e62  None, dtype=np.b
-000176a0: 7974 6573 5f29 0a20 2020 2020 2020 2064  ytes_).        d
-000176b0: 696d 3220 3d20 7469 6c65 6462 2e44 696d  im2 = tiledb.Dim
-000176c0: 286e 616d 653d 2264 696d 3222 2c20 646f  (name="dim2", do
-000176d0: 6d61 696e 3d28 302c 2031 292c 2074 696c  main=(0, 1), til
-000176e0: 653d 312c 2064 7479 7065 3d6e 702e 666c  e=1, dtype=np.fl
-000176f0: 6f61 7436 3429 0a20 2020 2020 2020 2061  oat64).        a
-00017700: 7474 7220 3d20 7469 6c65 6462 2e41 7474  ttr = tiledb.Att
-00017710: 7228 6e61 6d65 3d22 6174 7472 222c 2064  r(name="attr", d
-00017720: 7479 7065 3d6e 702e 666c 6f61 7433 3229  type=np.float32)
-00017730: 0a20 2020 2020 2020 2064 6f6d 203d 2074  .        dom = t
-00017740: 696c 6564 622e 446f 6d61 696e 2864 696d  iledb.Domain(dim
-00017750: 312c 2064 696d 3229 0a20 2020 2020 2020  1, dim2).       
-00017760: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
-00017770: 2e41 7272 6179 5363 6865 6d61 280a 2020  .ArraySchema(.  
-00017780: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
-00017790: 3d64 6f6d 2c20 7370 6172 7365 3d54 7275  =dom, sparse=Tru
-000177a0: 652c 2063 656c 6c5f 6f72 6465 723d 7370  e, cell_order=sp
-000177b0: 6172 7365 5f63 656c 6c5f 6f72 6465 722c  arse_cell_order,
-000177c0: 2061 7474 7273 3d5b 6174 7472 5d0a 2020   attrs=[attr].  
-000177d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000177e0: 7469 6c65 6462 2e41 7272 6179 2e63 7265  tiledb.Array.cre
-000177f0: 6174 6528 7572 692c 2073 6368 656d 6129  ate(uri, schema)
-00017800: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
-00017810: 696c 6564 622e 6f70 656e 2875 7269 2c20  iledb.open(uri, 
-00017820: 2277 2229 2061 7320 413a 0a20 2020 2020  "w") as A:.     
-00017830: 2020 2020 2020 2041 5b22 6131 222c 2030         A["a1", 0
-00017840: 5d20 3d20 310a 2020 2020 2020 2020 2020  ] = 1.          
-00017850: 2020 415b 2261 3122 2c20 302e 3235 5d20    A["a1", 0.25] 
-00017860: 3d20 320a 2020 2020 2020 2020 2020 2020  = 2.            
-00017870: 415b 2261 3222 2c20 302e 355d 203d 2033  A["a2", 0.5] = 3
-00017880: 0a20 2020 2020 2020 2020 2020 2041 5b22  .            A["
-00017890: 6133 222c 2030 2e32 355d 203d 2034 0a0a  a3", 0.25] = 4..
-000178a0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
-000178b0: 6564 622e 6f70 656e 2875 7269 2c20 2272  edb.open(uri, "r
-000178c0: 2229 2061 7320 413a 0a20 2020 2020 2020  ") as A:.       
-000178d0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-000178e0: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
-000178f0: 2020 2020 2020 2041 2e75 6e69 7175 655f         A.unique_
-00017900: 6469 6d5f 7661 6c75 6573 2829 2c0a 2020  dim_values(),.  
-00017910: 2020 2020 2020 2020 2020 2020 2020 4f72                Or
-00017920: 6465 7265 6444 6963 7428 0a20 2020 2020  deredDict(.     
-00017930: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00017940: 2822 6469 6d31 222c 2028 6222 6131 222c  ("dim1", (b"a1",
-00017950: 2062 2261 3222 2c20 6222 6133 2229 292c   b"a2", b"a3")),
-00017960: 2028 2264 696d 3222 2c20 2830 2e30 2c20   ("dim2", (0.0, 
-00017970: 302e 3235 2c20 302e 3529 295d 0a20 2020  0.25, 0.5))].   
-00017980: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
-00017990: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-000179a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000179b0: 6173 7365 7274 4571 7561 6c28 412e 756e  assertEqual(A.un
-000179c0: 6971 7565 5f64 696d 5f76 616c 7565 7328  ique_dim_values(
-000179d0: 2264 696d 3122 292c 2028 6222 6131 222c  "dim1"), (b"a1",
-000179e0: 2062 2261 3222 2c20 6222 6133 2229 290a   b"a2", b"a3")).
-000179f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00017a00: 2e61 7373 6572 7445 7175 616c 2841 2e75  .assertEqual(A.u
-00017a10: 6e69 7175 655f 6469 6d5f 7661 6c75 6573  nique_dim_values
-00017a20: 2822 6469 6d32 2229 2c20 2830 2c20 302e  ("dim2"), (0, 0.
-00017a30: 3235 2c20 302e 3529 290a 0a20 2020 2020  25, 0.5))..     
-00017a40: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-00017a50: 2e61 7373 6572 7452 6169 7365 7328 5661  .assertRaises(Va
-00017a60: 6c75 6545 7272 6f72 293a 0a20 2020 2020  lueError):.     
-00017a70: 2020 2020 2020 2020 2020 2041 2e75 6e69             A.uni
-00017a80: 7175 655f 6469 6d5f 7661 6c75 6573 2830  que_dim_values(0
-00017a90: 290a 0a20 2020 2020 2020 2020 2020 2077  )..            w
-00017aa0: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
-00017ab0: 6169 7365 7328 5661 6c75 6545 7272 6f72  aises(ValueError
-00017ac0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00017ad0: 2020 2041 2e75 6e69 7175 655f 6469 6d5f     A.unique_dim_
-00017ae0: 7661 6c75 6573 2822 6469 6d33 2229 0a0a  values("dim3")..
-00017af0: 0a63 6c61 7373 2054 6573 7444 656e 7365  .class TestDense
-00017b00: 496e 6465 7869 6e67 2844 6973 6b54 6573  Indexing(DiskTes
-00017b10: 7443 6173 6529 3a0a 2020 2020 6465 6620  tCase):.    def 
-00017b20: 5f74 6573 745f 696e 6465 7828 7365 6c66  _test_index(self
-00017b30: 2c20 412c 2054 2c20 6964 7829 3a0a 2020  , A, T, idx):.  
-00017b40: 2020 2020 2020 6578 7065 6374 6564 203d        expected =
-00017b50: 2041 5b69 6478 5d0a 2020 2020 2020 2020   A[idx].        
-00017b60: 6163 7475 616c 203d 2054 5b69 6478 5d0a  actual = T[idx].
-00017b70: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
-00017b80: 7272 6179 5f65 7175 616c 2865 7870 6563  rray_equal(expec
-00017b90: 7465 642c 2061 6374 7561 6c29 0a0a 2020  ted, actual)..  
-00017ba0: 2020 676f 6f64 5f69 6e64 6578 5f31 6420    good_index_1d 
-00017bb0: 3d20 5b0a 2020 2020 2020 2020 2320 7369  = [.        # si
-00017bc0: 6e67 6c65 2076 616c 7565 0a20 2020 2020  ngle value.     
-00017bd0: 2020 2034 322c 0a20 2020 2020 2020 202d     42,.        -
-00017be0: 312c 0a20 2020 2020 2020 2023 2073 6c69  1,.        # sli
-00017bf0: 6365 730a 2020 2020 2020 2020 736c 6963  ces.        slic
-00017c00: 6528 302c 2031 3035 3029 2c0a 2020 2020  e(0, 1050),.    
-00017c10: 2020 2020 736c 6963 6528 3530 2c20 3135      slice(50, 15
-00017c20: 3029 2c0a 2020 2020 2020 2020 736c 6963  0),.        slic
-00017c30: 6528 302c 2032 3030 3029 2c0a 2020 2020  e(0, 2000),.    
-00017c40: 2020 2020 736c 6963 6528 2d31 3530 2c20      slice(-150, 
-00017c50: 2d35 3029 2c0a 2020 2020 2020 2020 2320  -50),.        # 
-00017c60: 544f 444f 3a20 696e 6465 7869 6e67 2066  TODO: indexing f
-00017c70: 6169 6c75 7265 730a 2020 2020 2020 2020  ailures.        
-00017c80: 2320 736c 6963 6528 2d32 3030 302c 2032  # slice(-2000, 2
-00017c90: 3030 3029 2c0a 2020 2020 2020 2020 2320  000),.        # 
-00017ca0: 736c 6963 6528 302c 2030 292c 2020 2320  slice(0, 0),  # 
-00017cb0: 656d 7074 7920 7265 7375 6c74 0a20 2020  empty result.   
-00017cc0: 2020 2020 2023 2073 6c69 6365 282d 312c       # slice(-1,
-00017cd0: 2030 292c 2020 2320 656d 7074 7920 7265   0),  # empty re
-00017ce0: 7375 6c74 0a20 2020 2020 2020 2023 2074  sult.        # t
-00017cf0: 6f74 616c 2073 656c 6563 7469 6f6e 730a  otal selections.
-00017d00: 2020 2020 2020 2020 736c 6963 6528 4e6f          slice(No
-00017d10: 6e65 292c 0a20 2020 2020 2020 2045 6c6c  ne),.        Ell
-00017d20: 6970 7369 732c 0a20 2020 2020 2020 2028  ipsis,.        (
-00017d30: 292c 0a20 2020 2020 2020 2028 456c 6c69  ),.        (Elli
-00017d40: 7073 6973 2c20 736c 6963 6528 4e6f 6e65  psis, slice(None
-00017d50: 2929 2c0a 2020 2020 2020 2020 2320 736c  )),.        # sl
-00017d60: 6963 6520 7769 7468 2073 7465 700a 2020  ice with step.  
-00017d70: 2020 2020 2020 736c 6963 6528 4e6f 6e65        slice(None
-00017d80: 292c 0a20 2020 2020 2020 2073 6c69 6365  ),.        slice
-00017d90: 284e 6f6e 652c 204e 6f6e 6529 2c0a 2020  (None, None),.  
-00017da0: 2020 2020 2020 736c 6963 6528 4e6f 6e65        slice(None
-00017db0: 2c20 4e6f 6e65 2c20 3129 2c0a 2020 2020  , None, 1),.    
-00017dc0: 2020 2020 736c 6963 6528 4e6f 6e65 2c20      slice(None, 
-00017dd0: 4e6f 6e65 2c20 3130 292c 0a20 2020 2020  None, 10),.     
-00017de0: 2020 2073 6c69 6365 284e 6f6e 652c 204e     slice(None, N
-00017df0: 6f6e 652c 2031 3030 292c 0a20 2020 2020  one, 100),.     
-00017e00: 2020 2073 6c69 6365 284e 6f6e 652c 204e     slice(None, N
-00017e10: 6f6e 652c 2031 3030 3029 2c0a 2020 2020  one, 1000),.    
-00017e20: 2020 2020 736c 6963 6528 4e6f 6e65 2c20      slice(None, 
-00017e30: 4e6f 6e65 2c20 3130 3030 3029 2c0a 2020  None, 10000),.  
-00017e40: 2020 2020 2020 736c 6963 6528 302c 2031        slice(0, 1
-00017e50: 3035 3029 2c0a 2020 2020 2020 2020 736c  050),.        sl
-00017e60: 6963 6528 302c 2031 3035 302c 2031 292c  ice(0, 1050, 1),
-00017e70: 0a20 2020 2020 2020 2073 6c69 6365 2830  .        slice(0
-00017e80: 2c20 3130 3530 2c20 3130 292c 0a20 2020  , 1050, 10),.   
-00017e90: 2020 2020 2073 6c69 6365 2830 2c20 3130       slice(0, 10
-00017ea0: 3530 2c20 3130 3029 2c0a 2020 2020 2020  50, 100),.      
-00017eb0: 2020 736c 6963 6528 302c 2031 3035 302c    slice(0, 1050,
-00017ec0: 2031 3030 3029 2c0a 2020 2020 2020 2020   1000),.        
-00017ed0: 736c 6963 6528 302c 2031 3035 302c 2031  slice(0, 1050, 1
-00017ee0: 3030 3030 292c 0a20 2020 2020 2020 2073  0000),.        s
-00017ef0: 6c69 6365 2831 2c20 3331 2c20 3329 2c0a  lice(1, 31, 3),.
-00017f00: 2020 2020 2020 2020 736c 6963 6528 312c          slice(1,
-00017f10: 2033 312c 2033 3029 2c0a 2020 2020 2020   31, 30),.      
-00017f20: 2020 736c 6963 6528 312c 2033 312c 2033    slice(1, 31, 3
-00017f30: 3030 292c 0a20 2020 2020 2020 2073 6c69  00),.        sli
-00017f40: 6365 2838 312c 2031 3231 2c20 3329 2c0a  ce(81, 121, 3),.
-00017f50: 2020 2020 2020 2020 736c 6963 6528 3831          slice(81
-00017f60: 2c20 3132 312c 2033 3029 2c0a 2020 2020  , 121, 30),.    
-00017f70: 2020 2020 736c 6963 6528 3831 2c20 3132      slice(81, 12
-00017f80: 312c 2033 3030 292c 0a20 2020 2020 2020  1, 300),.       
-00017f90: 2073 6c69 6365 2835 302c 2031 3530 292c   slice(50, 150),
-00017fa0: 0a20 2020 2020 2020 2073 6c69 6365 2835  .        slice(5
-00017fb0: 302c 2031 3530 2c20 3129 2c0a 2020 2020  0, 150, 1),.    
-00017fc0: 2020 2020 736c 6963 6528 3530 2c20 3135      slice(50, 15
-00017fd0: 302c 2031 3029 2c0a 2020 2020 2020 2020  0, 10),.        
-00017fe0: 2320 544f 444f 3a20 6e65 6761 7469 7665  # TODO: negative
-00017ff0: 2073 7465 7073 0a20 2020 2020 2020 2073   steps.        s
-00018000: 6c69 6365 284e 6f6e 652c 204e 6f6e 652c  lice(None, None,
-00018010: 202d 3129 2c0a 2020 2020 2020 2020 736c   -1),.        sl
-00018020: 6963 6528 4e6f 6e65 2c20 4e6f 6e65 2c20  ice(None, None, 
-00018030: 2d31 3029 2c0a 2020 2020 2020 2020 736c  -10),.        sl
-00018040: 6963 6528 4e6f 6e65 2c20 4e6f 6e65 2c20  ice(None, None, 
-00018050: 2d31 3030 292c 0a20 2020 2020 2020 2073  -100),.        s
-00018060: 6c69 6365 284e 6f6e 652c 204e 6f6e 652c  lice(None, None,
-00018070: 202d 3130 3030 292c 0a20 2020 2020 2020   -1000),.       
-00018080: 2073 6c69 6365 284e 6f6e 652c 204e 6f6e   slice(None, Non
-00018090: 652c 202d 3130 3030 3029 2c0a 2020 2020  e, -10000),.    
-000180a0: 2020 2020 2320 736c 6963 6528 3130 3530      # slice(1050
-000180b0: 2c20 2d31 2c20 2d31 292c 0a20 2020 2020  , -1, -1),.     
-000180c0: 2020 2023 2073 6c69 6365 2831 3035 302c     # slice(1050,
-000180d0: 202d 312c 202d 3130 292c 0a20 2020 2020   -1, -10),.     
-000180e0: 2020 2023 2073 6c69 6365 2831 3035 302c     # slice(1050,
-000180f0: 202d 312c 202d 3130 3029 2c0a 2020 2020   -1, -100),.    
-00018100: 2020 2020 2320 736c 6963 6528 3130 3530      # slice(1050
-00018110: 2c20 2d31 2c20 2d31 3030 3029 2c0a 2020  , -1, -1000),.  
-00018120: 2020 2020 2020 2320 736c 6963 6528 3130        # slice(10
-00018130: 3530 2c20 2d31 2c20 2d31 3030 3030 292c  50, -1, -10000),
-00018140: 0a20 2020 2020 2020 2023 2073 6c69 6365  .        # slice
-00018150: 2831 3035 302c 2030 2c20 2d31 292c 0a20  (1050, 0, -1),. 
-00018160: 2020 2020 2020 2023 2073 6c69 6365 2831         # slice(1
-00018170: 3035 302c 2030 2c20 2d31 3029 2c0a 2020  050, 0, -10),.  
-00018180: 2020 2020 2020 2320 736c 6963 6528 3130        # slice(10
-00018190: 3530 2c20 302c 202d 3130 3029 2c0a 2020  50, 0, -100),.  
-000181a0: 2020 2020 2020 2320 736c 6963 6528 3130        # slice(10
-000181b0: 3530 2c20 302c 202d 3130 3030 292c 0a20  50, 0, -1000),. 
-000181c0: 2020 2020 2020 2023 2073 6c69 6365 2831         # slice(1
-000181d0: 3035 302c 2030 2c20 2d31 3030 3030 292c  050, 0, -10000),
-000181e0: 0a20 2020 2020 2020 2023 2073 6c69 6365  .        # slice
-000181f0: 2831 3530 2c20 3530 2c20 2d31 292c 0a20  (150, 50, -1),. 
-00018200: 2020 2020 2020 2023 2073 6c69 6365 2831         # slice(1
-00018210: 3530 2c20 3530 2c20 2d31 3029 2c0a 2020  50, 50, -10),.  
-00018220: 2020 2020 2020 2320 736c 6963 6528 3331        # slice(31
-00018230: 2c20 312c 202d 3329 2c0a 2020 2020 2020  , 1, -3),.      
-00018240: 2020 2320 736c 6963 6528 3132 312c 2038    # slice(121, 8
-00018250: 312c 202d 3329 2c0a 2020 2020 2020 2020  1, -3),.        
-00018260: 2320 736c 6963 6528 2d31 2c20 302c 202d  # slice(-1, 0, -
-00018270: 3129 2c0a 2020 2020 5d0a 0a20 2020 2062  1),.    ]..    b
-00018280: 6164 5f69 6e64 6578 5f31 6420 3d20 5b32  ad_index_1d = [2
-00018290: 2e33 2c20 2266 6f6f 222c 2062 2278 7878  .3, "foo", b"xxx
-000182a0: 222c 204e 6f6e 652c 2028 302c 2030 292c  ", None, (0, 0),
-000182b0: 2028 736c 6963 6528 4e6f 6e65 292c 2073   (slice(None), s
-000182c0: 6c69 6365 284e 6f6e 6529 295d 0a0a 2020  lice(None))]..  
-000182d0: 2020 6465 6620 7465 7374 5f69 6e64 6578    def test_index
-000182e0: 5f31 6428 7365 6c66 293a 0a20 2020 2020  _1d(self):.     
-000182f0: 2020 2041 203d 206e 702e 6172 616e 6765     A = np.arange
-00018300: 2831 3035 302c 2064 7479 7065 3d69 6e74  (1050, dtype=int
-00018310: 290a 0a20 2020 2020 2020 2064 6f6d 203d  )..        dom =
-00018320: 2074 696c 6564 622e 446f 6d61 696e 2874   tiledb.Domain(t
-00018330: 696c 6564 622e 4469 6d28 646f 6d61 696e  iledb.Dim(domain
-00018340: 3d28 302c 2031 3034 3929 2c20 7469 6c65  =(0, 1049), tile
-00018350: 3d31 3030 2929 0a20 2020 2020 2020 2061  =100)).        a
-00018360: 7474 203d 2074 696c 6564 622e 4174 7472  tt = tiledb.Attr
-00018370: 2864 7479 7065 3d69 6e74 290a 2020 2020  (dtype=int).    
-00018380: 2020 2020 7363 6865 6d61 203d 2074 696c      schema = til
-00018390: 6564 622e 4172 7261 7953 6368 656d 6128  edb.ArraySchema(
-000183a0: 646f 6d61 696e 3d64 6f6d 2c20 6174 7472  domain=dom, attr
-000183b0: 733d 2861 7474 2c29 290a 2020 2020 2020  s=(att,)).      
-000183c0: 2020 7469 6c65 6462 2e44 656e 7365 4172    tiledb.DenseAr
-000183d0: 7261 792e 6372 6561 7465 2873 656c 662e  ray.create(self.
-000183e0: 7061 7468 2822 666f 6f22 292c 2073 6368  path("foo"), sch
-000183f0: 656d 6129 0a0a 2020 2020 2020 2020 7769  ema)..        wi
-00018400: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
-00018410: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
-00018420: 666f 6f22 292c 206d 6f64 653d 2277 2229  foo"), mode="w")
-00018430: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
-00018440: 2020 2054 5b3a 5d20 3d20 410a 0a20 2020     T[:] = A..   
-00018450: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-00018460: 2e44 656e 7365 4172 7261 7928 7365 6c66  .DenseArray(self
-00018470: 2e70 6174 6828 2266 6f6f 2229 2c20 6d6f  .path("foo"), mo
-00018480: 6465 3d22 7222 2920 6173 2054 3a0a 2020  de="r") as T:.  
-00018490: 2020 2020 2020 2020 2020 666f 7220 6964            for id
-000184a0: 7820 696e 2073 656c 662e 676f 6f64 5f69  x in self.good_i
-000184b0: 6e64 6578 5f31 643a 0a20 2020 2020 2020  ndex_1d:.       
-000184c0: 2020 2020 2020 2020 2073 656c 662e 5f74           self._t
-000184d0: 6573 745f 696e 6465 7828 412c 2054 2c20  est_index(A, T, 
-000184e0: 6964 7829 0a0a 2020 2020 2020 2020 2020  idx)..          
-000184f0: 2020 666f 7220 6964 7820 696e 2073 656c    for idx in sel
-00018500: 662e 6261 645f 696e 6465 785f 3164 3a0a  f.bad_index_1d:.
-00018510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018520: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
-00018530: 5261 6973 6573 2849 6e64 6578 4572 726f  Raises(IndexErro
-00018540: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00018550: 2020 2020 2020 2020 545b 6964 785d 0a0a          T[idx]..
-00018560: 2020 2020 676f 6f64 5f69 6e64 6578 5f32      good_index_2
-00018570: 6420 3d20 5b0a 2020 2020 2020 2020 2320  d = [.        # 
-00018580: 7369 6e67 6c65 2072 6f77 0a20 2020 2020  single row.     
-00018590: 2020 2034 322c 0a20 2020 2020 2020 202d     42,.        -
-000185a0: 312c 0a20 2020 2020 2020 2028 3432 2c20  1,.        (42, 
-000185b0: 736c 6963 6528 4e6f 6e65 2929 2c0a 2020  slice(None)),.  
-000185c0: 2020 2020 2020 282d 312c 2073 6c69 6365        (-1, slice
-000185d0: 284e 6f6e 6529 292c 0a20 2020 2020 2020  (None)),.       
-000185e0: 2023 2073 696e 676c 6520 636f 6c0a 2020   # single col.  
-000185f0: 2020 2020 2020 2873 6c69 6365 284e 6f6e        (slice(Non
-00018600: 6529 2c20 3429 2c0a 2020 2020 2020 2020  e), 4),.        
-00018610: 2873 6c69 6365 284e 6f6e 6529 2c20 2d31  (slice(None), -1
-00018620: 292c 0a20 2020 2020 2020 2023 2072 6f77  ),.        # row
-00018630: 2073 6c69 6365 730a 2020 2020 2020 2020   slices.        
-00018640: 736c 6963 6528 4e6f 6e65 292c 0a20 2020  slice(None),.   
-00018650: 2020 2020 2073 6c69 6365 2830 2c20 3130       slice(0, 10
-00018660: 3030 292c 0a20 2020 2020 2020 2073 6c69  00),.        sli
-00018670: 6365 2832 3530 2c20 3335 3029 2c0a 2020  ce(250, 350),.  
-00018680: 2020 2020 2020 736c 6963 6528 302c 2032        slice(0, 2
-00018690: 3030 3029 2c0a 2020 2020 2020 2020 736c  000),.        sl
-000186a0: 6963 6528 2d33 3530 2c20 2d32 3530 292c  ice(-350, -250),
-000186b0: 0a20 2020 2020 2020 2073 6c69 6365 2830  .        slice(0
-000186c0: 2c20 3029 2c20 2023 2065 6d70 7479 2072  , 0),  # empty r
-000186d0: 6573 756c 740a 2020 2020 2020 2020 736c  esult.        sl
-000186e0: 6963 6528 2d31 2c20 3029 2c20 2023 2065  ice(-1, 0),  # e
-000186f0: 6d70 7479 2072 6573 756c 740a 2020 2020  mpty result.    
-00018700: 2020 2020 736c 6963 6528 2d32 3030 302c      slice(-2000,
-00018710: 2030 292c 0a20 2020 2020 2020 2073 6c69   0),.        sli
-00018720: 6365 282d 3230 3030 2c20 3230 3030 292c  ce(-2000, 2000),
-00018730: 0a20 2020 2020 2020 2023 2032 4420 736c  .        # 2D sl
-00018740: 6963 6573 0a20 2020 2020 2020 2028 736c  ices.        (sl
-00018750: 6963 6528 4e6f 6e65 292c 2073 6c69 6365  ice(None), slice
-00018760: 2831 2c20 3529 292c 0a20 2020 2020 2020  (1, 5)),.       
-00018770: 2028 736c 6963 6528 3235 302c 2033 3530   (slice(250, 350
-00018780: 292c 2073 6c69 6365 284e 6f6e 6529 292c  ), slice(None)),
-00018790: 0a20 2020 2020 2020 2028 736c 6963 6528  .        (slice(
-000187a0: 3235 302c 2033 3530 292c 2073 6c69 6365  250, 350), slice
-000187b0: 2831 2c20 3529 292c 0a20 2020 2020 2020  (1, 5)),.       
-000187c0: 2028 736c 6963 6528 3235 302c 2033 3530   (slice(250, 350
-000187d0: 292c 2073 6c69 6365 282d 352c 202d 3129  ), slice(-5, -1)
-000187e0: 292c 0a20 2020 2020 2020 2028 736c 6963  ),.        (slic
-000187f0: 6528 3235 302c 2033 3530 292c 2073 6c69  e(250, 350), sli
-00018800: 6365 282d 3530 2c20 3530 2929 2c0a 2020  ce(-50, 50)),.  
-00018810: 2020 2020 2020 2873 6c69 6365 2832 3530        (slice(250
-00018820: 2c20 3335 302c 2031 3029 2c20 736c 6963  , 350, 10), slic
-00018830: 6528 312c 2035 2929 2c0a 2020 2020 2020  e(1, 5)),.      
-00018840: 2020 2873 6c69 6365 2832 3530 2c20 3335    (slice(250, 35
-00018850: 3029 2c20 736c 6963 6528 312c 2035 2c20  0), slice(1, 5, 
-00018860: 3229 292c 0a20 2020 2020 2020 2028 736c  2)),.        (sl
-00018870: 6963 6528 3235 302c 2033 3530 2c20 3333  ice(250, 350, 33
-00018880: 292c 2073 6c69 6365 2831 2c20 352c 2033  ), slice(1, 5, 3
-00018890: 2929 2c0a 2020 2020 2020 2020 2320 746f  )),.        # to
-000188a0: 7461 6c20 7365 6c65 6374 696f 6e73 0a20  tal selections. 
-000188b0: 2020 2020 2020 2028 736c 6963 6528 4e6f         (slice(No
-000188c0: 6e65 292c 2073 6c69 6365 284e 6f6e 6529  ne), slice(None)
-000188d0: 292c 0a20 2020 2020 2020 2045 6c6c 6970  ),.        Ellip
-000188e0: 7369 732c 0a20 2020 2020 2020 2028 292c  sis,.        (),
-000188f0: 0a20 2020 2020 2020 2028 456c 6c69 7073  .        (Ellips
-00018900: 6973 2c20 736c 6963 6528 4e6f 6e65 2929  is, slice(None))
-00018910: 2c0a 2020 2020 2020 2020 2845 6c6c 6970  ,.        (Ellip
-00018920: 7369 732c 2073 6c69 6365 284e 6f6e 6529  sis, slice(None)
-00018930: 2c20 736c 6963 6528 4e6f 6e65 2929 2c0a  , slice(None)),.
-00018940: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
-00018950: 6e65 6761 7469 7665 2073 7465 7073 0a20  negative steps. 
-00018960: 2020 2020 2020 2023 2073 6c69 6365 284e         # slice(N
-00018970: 6f6e 652c 204e 6f6e 652c 202d 3129 2c0a  one, None, -1),.
-00018980: 2020 2020 2020 2020 2320 2873 6c69 6365          # (slice
-00018990: 284e 6f6e 652c 204e 6f6e 652c 202d 3129  (None, None, -1)
-000189a0: 2c20 736c 6963 6528 4e6f 6e65 2929 2c0a  , slice(None)),.
-000189b0: 2020 2020 5d0a 0a20 2020 2062 6164 5f69      ]..    bad_i
-000189c0: 6e64 6578 5f32 6420 3d20 5b0a 2020 2020  ndex_2d = [.    
-000189d0: 2020 2020 322e 332c 0a20 2020 2020 2020      2.3,.       
-000189e0: 2022 666f 6f22 2c0a 2020 2020 2020 2020   "foo",.        
-000189f0: 6222 7878 7822 2c0a 2020 2020 2020 2020  b"xxx",.        
-00018a00: 4e6f 6e65 2c0a 2020 2020 2020 2020 2832  None,.        (2
-00018a10: 2e33 2c20 736c 6963 6528 4e6f 6e65 2929  .3, slice(None))
-00018a20: 2c0a 2020 2020 2020 2020 2830 2c20 302c  ,.        (0, 0,
-00018a30: 2030 292c 0a20 2020 2020 2020 2028 736c   0),.        (sl
-00018a40: 6963 6528 4e6f 6e65 292c 2073 6c69 6365  ice(None), slice
-00018a50: 284e 6f6e 6529 2c20 736c 6963 6528 4e6f  (None), slice(No
-00018a60: 6e65 2929 2c0a 2020 2020 5d0a 0a20 2020  ne)),.    ]..   
-00018a70: 2064 6566 2074 6573 745f 696e 6465 785f   def test_index_
-00018a80: 3264 2873 656c 6629 3a0a 2020 2020 2020  2d(self):.      
-00018a90: 2020 4120 3d20 6e70 2e61 7261 6e67 6528    A = np.arange(
-00018aa0: 3130 3030 3029 2e72 6573 6861 7065 2828  10000).reshape((
-00018ab0: 3130 3030 2c20 3130 2929 0a0a 2020 2020  1000, 10))..    
-00018ac0: 2020 2020 646f 6d20 3d20 7469 6c65 6462      dom = tiledb
-00018ad0: 2e44 6f6d 6169 6e28 0a20 2020 2020 2020  .Domain(.       
-00018ae0: 2020 2020 2074 696c 6564 622e 4469 6d28       tiledb.Dim(
-00018af0: 646f 6d61 696e 3d28 302c 2039 3939 292c  domain=(0, 999),
-00018b00: 2074 696c 653d 3130 3029 2c20 7469 6c65   tile=100), tile
-00018b10: 6462 2e44 696d 2864 6f6d 6169 6e3d 2830  db.Dim(domain=(0
-00018b20: 2c20 3929 2c20 7469 6c65 3d32 290a 2020  , 9), tile=2).  
-00018b30: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00018b40: 6174 7420 3d20 7469 6c65 6462 2e41 7474  att = tiledb.Att
-00018b50: 7228 6474 7970 653d 412e 6474 7970 6529  r(dtype=A.dtype)
-00018b60: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
-00018b70: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
-00018b80: 6865 6d61 2864 6f6d 2c20 2861 7474 2c29  hema(dom, (att,)
-00018b90: 290a 2020 2020 2020 2020 7469 6c65 6462  ).        tiledb
-00018ba0: 2e44 656e 7365 4172 7261 792e 6372 6561  .DenseArray.crea
-00018bb0: 7465 2873 656c 662e 7061 7468 2822 666f  te(self.path("fo
-00018bc0: 6f22 292c 2073 6368 656d 6129 0a0a 2020  o"), schema)..  
-00018bd0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-00018be0: 622e 4465 6e73 6541 7272 6179 2873 656c  b.DenseArray(sel
-00018bf0: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
-00018c00: 6f64 653d 2277 2229 2061 7320 543a 0a20  ode="w") as T:. 
-00018c10: 2020 2020 2020 2020 2020 2054 5b3a 5d20             T[:] 
-00018c20: 3d20 410a 0a20 2020 2020 2020 2077 6974  = A..        wit
-00018c30: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
-00018c40: 7261 7928 7365 6c66 2e70 6174 6828 2266  ray(self.path("f
-00018c50: 6f6f 2229 2c20 6d6f 6465 3d22 7222 2920  oo"), mode="r") 
-00018c60: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
-00018c70: 2020 666f 7220 6964 7820 696e 2073 656c    for idx in sel
-00018c80: 662e 676f 6f64 5f69 6e64 6578 5f31 643a  f.good_index_1d:
-00018c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018ca0: 2073 656c 662e 5f74 6573 745f 696e 6465   self._test_inde
-00018cb0: 7828 412c 2054 2c20 6964 7829 0a0a 2020  x(A, T, idx)..  
-00018cc0: 2020 2020 2020 2020 2020 666f 7220 6964            for id
-00018cd0: 7820 696e 2073 656c 662e 6261 645f 696e  x in self.bad_in
-00018ce0: 6465 785f 3264 3a0a 2020 2020 2020 2020  dex_2d:.        
-00018cf0: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
-00018d00: 662e 6173 7365 7274 5261 6973 6573 2849  f.assertRaises(I
-00018d10: 6e64 6578 4572 726f 7229 3a0a 2020 2020  ndexError):.    
-00018d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d30: 545b 6964 785d 0a0a 0a63 6c61 7373 2054  T[idx]...class T
-00018d40: 6573 7446 696c 7465 7254 6573 7428 756e  estFilterTest(un
-00018d50: 6974 7465 7374 2e54 6573 7443 6173 6529  ittest.TestCase)
-00018d60: 3a0a 2020 2020 6465 6620 7465 7374 5f66  :.    def test_f
-00018d70: 696c 7465 7228 7365 6c66 293a 0a20 2020  ilter(self):.   
-00018d80: 2020 2020 2067 7a69 705f 6669 6c74 6572       gzip_filter
-00018d90: 203d 2074 696c 6564 622e 6c69 6274 696c   = tiledb.libtil
-00018da0: 6564 622e 477a 6970 4669 6c74 6572 286c  edb.GzipFilter(l
-00018db0: 6576 656c 3d31 3029 0a20 2020 2020 2020  evel=10).       
-00018dc0: 2073 656c 662e 6173 7365 7274 4973 496e   self.assertIsIn
-00018dd0: 7374 616e 6365 2867 7a69 705f 6669 6c74  stance(gzip_filt
-00018de0: 6572 2c20 7469 6c65 6462 2e6c 6962 7469  er, tiledb.libti
-00018df0: 6c65 6462 2e46 696c 7465 7229 0a20 2020  ledb.Filter).   
-00018e00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-00018e10: 4571 7561 6c28 677a 6970 5f66 696c 7465  Equal(gzip_filte
-00018e20: 722e 6c65 7665 6c2c 2031 3029 0a0a 2020  r.level, 10)..  
-00018e30: 2020 2020 2020 6277 5f66 696c 7465 7220        bw_filter 
-00018e40: 3d20 7469 6c65 6462 2e6c 6962 7469 6c65  = tiledb.libtile
-00018e50: 6462 2e42 6974 5769 6474 6852 6564 7563  db.BitWidthReduc
-00018e60: 7469 6f6e 4669 6c74 6572 2877 696e 646f  tionFilter(windo
-00018e70: 773d 3130 290a 2020 2020 2020 2020 7365  w=10).        se
-00018e80: 6c66 2e61 7373 6572 7449 7349 6e73 7461  lf.assertIsInsta
-00018e90: 6e63 6528 6277 5f66 696c 7465 722c 2074  nce(bw_filter, t
-00018ea0: 696c 6564 622e 6c69 6274 696c 6564 622e  iledb.libtiledb.
-00018eb0: 4669 6c74 6572 290a 2020 2020 2020 2020  Filter).        
-00018ec0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00018ed0: 2862 775f 6669 6c74 6572 2e77 696e 646f  (bw_filter.windo
-00018ee0: 772c 2031 3029 0a0a 2020 2020 2020 2020  w, 10)..        
-00018ef0: 6669 6c74 6572 5f6c 6973 7420 3d20 7469  filter_list = ti
-00018f00: 6c65 6462 2e6c 6962 7469 6c65 6462 2e46  ledb.libtiledb.F
-00018f10: 696c 7465 724c 6973 7428 0a20 2020 2020  ilterList(.     
-00018f20: 2020 2020 2020 205b 677a 6970 5f66 696c         [gzip_fil
-00018f30: 7465 722c 2062 775f 6669 6c74 6572 5d2c  ter, bw_filter],
-00018f40: 2063 6875 6e6b 7369 7a65 3d31 3032 340a   chunksize=1024.
-00018f50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00018f60: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-00018f70: 616c 2866 696c 7465 725f 6c69 7374 2e63  al(filter_list.c
-00018f80: 6875 6e6b 7369 7a65 2c20 3130 3234 290a  hunksize, 1024).
-00018f90: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00018fa0: 6572 7445 7175 616c 286c 656e 2866 696c  ertEqual(len(fil
-00018fb0: 7465 725f 6c69 7374 292c 2032 290a 2020  ter_list), 2).  
-00018fc0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-00018fd0: 7445 7175 616c 2866 696c 7465 725f 6c69  tEqual(filter_li
-00018fe0: 7374 5b30 5d2e 6c65 7665 6c2c 2067 7a69  st[0].level, gzi
-00018ff0: 705f 6669 6c74 6572 2e6c 6576 656c 290a  p_filter.level).
-00019000: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-00019010: 6572 7445 7175 616c 2866 696c 7465 725f  ertEqual(filter_
-00019020: 6c69 7374 5b31 5d2e 7769 6e64 6f77 2c20  list[1].window, 
-00019030: 6277 5f66 696c 7465 722e 7769 6e64 6f77  bw_filter.window
-00019040: 290a 0a20 2020 2020 2020 2023 2074 6573  )..        # tes
-00019050: 7420 6669 6c74 6572 206c 6973 7420 6974  t filter list it
-00019060: 6572 6174 696f 6e0a 2020 2020 2020 2020  eration.        
-00019070: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00019080: 286c 656e 286c 6973 7428 6669 6c74 6572  (len(list(filter
-00019090: 5f6c 6973 7429 292c 2032 290a 0a20 2020  _list)), 2)..   
-000190a0: 2020 2020 2023 2074 6573 7420 6066 696c       # test `fil
-000190b0: 7465 7273 6020 6b77 6172 6720 6163 6365  ters` kwarg acce
-000190c0: 7074 7320 7079 7468 6f6e 206c 6973 7420  pts python list 
-000190d0: 6f66 2066 696c 7465 7273 0a20 2020 2020  of filters.     
-000190e0: 2020 2074 696c 6564 622e 4174 7472 2822     tiledb.Attr("
-000190f0: 666f 6f22 2c20 6474 7970 653d 6e70 2e69  foo", dtype=np.i
-00019100: 6e74 3634 2c20 6669 6c74 6572 733d 5b67  nt64, filters=[g
-00019110: 7a69 705f 6669 6c74 6572 5d29 0a20 2020  zip_filter]).   
-00019120: 2020 2020 2074 696c 6564 622e 4174 7472       tiledb.Attr
-00019130: 2822 666f 6f22 2c20 6474 7970 653d 6e70  ("foo", dtype=np
-00019140: 2e69 6e74 3634 2c20 6669 6c74 6572 733d  .int64, filters=
-00019150: 2867 7a69 705f 6669 6c74 6572 2c29 290a  (gzip_filter,)).
-00019160: 0a20 2020 2020 2020 2061 7474 7220 3d20  .        attr = 
-00019170: 7469 6c65 6462 2e41 7474 7228 2266 6f6f  tiledb.Attr("foo
-00019180: 222c 2064 7479 7065 3d6e 702e 696e 7436  ", dtype=np.int6
-00019190: 342c 2066 696c 7465 7273 3d66 696c 7465  4, filters=filte
-000191a0: 725f 6c69 7374 290a 0a20 2020 2020 2020  r_list)..       
-000191b0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-000191c0: 6c28 6c65 6e28 6174 7472 2e66 696c 7465  l(len(attr.filte
-000191d0: 7273 292c 2032 290a 2020 2020 2020 2020  rs), 2).        
-000191e0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-000191f0: 2861 7474 722e 6669 6c74 6572 732e 6368  (attr.filters.ch
-00019200: 756e 6b73 697a 652c 2066 696c 7465 725f  unksize, filter_
-00019210: 6c69 7374 2e63 6875 6e6b 7369 7a65 290a  list.chunksize).
-00019220: 0a20 2020 2064 6566 2074 6573 745f 6669  .    def test_fi
-00019230: 6c74 6572 5f6c 6973 7428 7365 6c66 293a  lter_list(self):
-00019240: 0a20 2020 2020 2020 2023 2073 686f 756c  .        # shoul
-00019250: 6420 6265 2063 6f6e 7374 7275 6374 6962  d be constructib
-00019260: 6c65 2077 6974 686f 7574 2061 2060 6669  le without a `fi
-00019270: 6c74 6572 7360 206b 6579 776f 7264 2061  lters` keyword a
-00019280: 7267 2073 6574 0a20 2020 2020 2020 2066  rg set.        f
-00019290: 696c 7465 725f 6c69 7374 3120 3d20 7469  ilter_list1 = ti
-000192a0: 6c65 6462 2e46 696c 7465 724c 6973 7428  ledb.FilterList(
-000192b0: 290a 2020 2020 2020 2020 6669 6c74 6572  ).        filter
-000192c0: 5f6c 6973 7431 2e61 7070 656e 6428 7469  _list1.append(ti
-000192d0: 6c65 6462 2e47 7a69 7046 696c 7465 7228  ledb.GzipFilter(
-000192e0: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-000192f0: 6173 7365 7274 4571 7561 6c28 6c65 6e28  assertEqual(len(
-00019300: 6669 6c74 6572 5f6c 6973 7431 292c 2031  filter_list1), 1
-00019310: 290a 0a20 2020 2020 2020 2066 696c 7465  )..        filte
-00019320: 725f 6c69 7374 3220 3d20 5b78 2066 6f72  r_list2 = [x for
-00019330: 2078 2069 6e20 6669 6c74 6572 5f6c 6973   x in filter_lis
-00019340: 7431 5d0a 2020 2020 2020 2020 6174 7472  t1].        attr
-00019350: 203d 2074 696c 6564 622e 4174 7472 2866   = tiledb.Attr(f
-00019360: 696c 7465 7273 3d66 696c 7465 725f 6c69  ilters=filter_li
-00019370: 7374 3229 0a20 2020 2020 2020 2073 656c  st2).        sel
-00019380: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
-00019390: 6e28 6174 7472 2e66 696c 7465 7273 292c  n(attr.filters),
-000193a0: 2031 290a 0a20 2020 2064 6566 2074 6573   1)..    def tes
-000193b0: 745f 616c 6c5f 6669 6c74 6572 7328 7365  t_all_filters(se
-000193c0: 6c66 293a 0a20 2020 2020 2020 2023 2074  lf):.        # t
-000193d0: 6573 7420 696e 6974 6961 6c69 7a61 7469  est initializati
-000193e0: 6f6e 0a20 2020 2020 2020 2066 696c 7465  on.        filte
-000193f0: 7273 203d 205b 0a20 2020 2020 2020 2020  rs = [.         
-00019400: 2020 2074 696c 6564 622e 4e6f 4f70 4669     tiledb.NoOpFi
-00019410: 6c74 6572 2829 2c0a 2020 2020 2020 2020  lter(),.        
-00019420: 2020 2020 7469 6c65 6462 2e47 7a69 7046      tiledb.GzipF
-00019430: 696c 7465 7228 292c 0a20 2020 2020 2020  ilter(),.       
-00019440: 2020 2020 2074 696c 6564 622e 5a73 7464       tiledb.Zstd
-00019450: 4669 6c74 6572 2829 2c0a 2020 2020 2020  Filter(),.      
-00019460: 2020 2020 2020 7469 6c65 6462 2e4c 5a34        tiledb.LZ4
-00019470: 4669 6c74 6572 2829 2c0a 2020 2020 2020  Filter(),.      
-00019480: 2020 2020 2020 7469 6c65 6462 2e52 6c65        tiledb.Rle
-00019490: 4669 6c74 6572 2829 2c0a 2020 2020 2020  Filter(),.      
-000194a0: 2020 2020 2020 7469 6c65 6462 2e42 7a69        tiledb.Bzi
-000194b0: 7032 4669 6c74 6572 2829 2c0a 2020 2020  p2Filter(),.    
-000194c0: 2020 2020 2020 2020 7469 6c65 6462 2e44          tiledb.D
-000194d0: 6f75 626c 6544 656c 7461 4669 6c74 6572  oubleDeltaFilter
-000194e0: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-000194f0: 7469 6c65 6462 2e42 6974 5769 6474 6852  tiledb.BitWidthR
-00019500: 6564 7563 7469 6f6e 4669 6c74 6572 2829  eductionFilter()
-00019510: 2c0a 2020 2020 2020 2020 2020 2020 7469  ,.            ti
-00019520: 6c65 6462 2e42 6974 5368 7566 666c 6546  ledb.BitShuffleF
-00019530: 696c 7465 7228 292c 0a20 2020 2020 2020  ilter(),.       
-00019540: 2020 2020 2074 696c 6564 622e 4279 7465       tiledb.Byte
-00019550: 5368 7566 666c 6546 696c 7465 7228 292c  ShuffleFilter(),
-00019560: 0a20 2020 2020 2020 2020 2020 2074 696c  .            til
-00019570: 6564 622e 506f 7369 7469 7665 4465 6c74  edb.PositiveDelt
-00019580: 6146 696c 7465 7228 292c 0a20 2020 2020  aFilter(),.     
-00019590: 2020 2020 2020 2074 696c 6564 622e 4368         tiledb.Ch
-000195a0: 6563 6b73 756d 5348 4132 3536 4669 6c74  ecksumSHA256Filt
-000195b0: 6572 2829 2c0a 2020 2020 2020 2020 2020  er(),.          
-000195c0: 2020 7469 6c65 6462 2e43 6865 636b 7375    tiledb.Checksu
-000195d0: 6d4d 4435 4669 6c74 6572 2829 2c0a 2020  mMD5Filter(),.  
-000195e0: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-000195f0: 2320 6d61 6b65 2073 7572 6520 7468 6174  # make sure that
-00019600: 2072 6570 7220 776f 726b 7320 616e 6420   repr works and 
-00019610: 726f 756e 642d 7472 6970 7320 636f 7272  round-trips corr
-00019620: 6563 746c 790a 2020 2020 2020 2020 666f  ectly.        fo
-00019630: 7220 6620 696e 2066 696c 7465 7273 3a0a  r f in filters:.
-00019640: 2020 2020 2020 2020 2020 2020 2320 736f              # so
-00019650: 6d65 206f 6620 7468 6573 6520 6861 7665  me of these have
-00019660: 2061 7474 7269 6275 7465 732c 2073 6f20   attributes, so 
-00019670: 7765 206a 7573 7420 6368 6563 6b20 7468  we just check th
-00019680: 6520 636c 6173 7320 6e61 6d65 2068 6572  e class name her
-00019690: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
-000196a0: 6c66 2e61 7373 6572 7454 7275 6528 7479  lf.assertTrue(ty
-000196b0: 7065 2866 292e 5f5f 6e61 6d65 5f5f 2069  pe(f).__name__ i
-000196c0: 6e20 7265 7072 2866 2929 0a0a 2020 2020  n repr(f))..    
-000196d0: 2020 2020 2020 2020 746d 705f 676c 6f62          tmp_glob
-000196e0: 616c 7320 3d20 6469 6374 2829 0a20 2020  als = dict().   
-000196f0: 2020 2020 2020 2020 2073 6574 7570 203d           setup =
-00019700: 2022 6672 6f6d 2074 696c 6564 6220 696d   "from tiledb im
-00019710: 706f 7274 202a 220a 2020 2020 2020 2020  port *".        
-00019720: 2020 2020 6578 6563 2873 6574 7570 2c20      exec(setup, 
-00019730: 746d 705f 676c 6f62 616c 7329 0a0a 2020  tmp_globals)..  
-00019740: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
-00019750: 5f72 6570 7220 3d20 7265 7072 2866 290a  _repr = repr(f).
-00019760: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00019770: 6669 6c74 6572 203d 204e 6f6e 650a 2020  filter = None.  
-00019780: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00019790: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000197a0: 6577 5f66 696c 7465 7220 3d20 6576 616c  ew_filter = eval
-000197b0: 2866 696c 7465 725f 7265 7072 2c20 746d  (filter_repr, tm
-000197c0: 705f 676c 6f62 616c 7329 0a20 2020 2020  p_globals).     
-000197d0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-000197e0: 6365 7074 696f 6e20 6173 2065 7863 3a0a  ception as exc:.
-000197f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019800: 7761 726e 5f73 7472 203d 2028 0a20 2020  warn_str = (.   
-00019810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019820: 2022 2222 4578 6365 7074 696f 6e20 6475   """Exception du
-00019830: 7269 6e67 2046 696c 7465 7254 6573 7420  ring FilterTest 
-00019840: 6669 6c74 6572 2072 6570 7220 6576 616c  filter repr eval
-00019850: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-00019860: 2020 2020 2020 2020 2b20 2222 222c 2066          + """, f
-00019870: 696c 7465 7220 7265 7072 2073 7472 696e  ilter repr strin
-00019880: 6720 7761 733a 5c6e 2222 220a 2020 2020  g was:\n""".    
-00019890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198a0: 2b20 2222 2227 2727 2222 220a 2020 2020  + """'''""".    
-000198b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198c0: 2b20 2222 225c 6e7b 7d5c 6e27 2727 2222  + """\n{}\n'''""
-000198d0: 222e 666f 726d 6174 2866 696c 7465 725f  ".format(filter_
-000198e0: 7265 7072 290a 2020 2020 2020 2020 2020  repr).          
-000198f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00019900: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
-00019910: 2e77 6172 6e28 7761 726e 5f73 7472 290a  .warn(warn_str).
-00019920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019930: 7261 6973 650a 0a20 2020 2020 2020 2020  raise..         
-00019940: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-00019950: 7561 6c28 6e65 775f 6669 6c74 6572 2c20  ual(new_filter, 
-00019960: 6629 0a0a 0a63 6c61 7373 2054 6573 7444  f)...class TestD
-00019970: 6174 6574 696d 6553 6c69 6369 6e67 2844  atetimeSlicing(D
-00019980: 6973 6b54 6573 7443 6173 6529 3a0a 2020  iskTestCase):.  
-00019990: 2020 6465 6620 7465 7374 5f64 656e 7365    def test_dense
-000199a0: 5f64 6174 6574 696d 655f 7665 6374 6f72  _datetime_vector
-000199b0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000199c0: 7572 6920 3d20 7365 6c66 2e70 6174 6828  uri = self.path(
-000199d0: 2266 6f6f 5f64 6174 6574 696d 655f 7665  "foo_datetime_ve
-000199e0: 6374 6f72 2229 0a0a 2020 2020 2020 2020  ctor")..        
-000199f0: 2320 446f 6d61 696e 2069 7320 3130 2079  # Domain is 10 y
-00019a00: 6561 7273 2c20 6461 7920 7265 736f 6c75  ears, day resolu
-00019a10: 7469 6f6e 2c20 6f6e 6520 7469 6c65 2070  tion, one tile p
-00019a20: 6572 2033 3635 2064 6179 730a 2020 2020  er 365 days.    
-00019a30: 2020 2020 6469 6d20 3d20 7469 6c65 6462      dim = tiledb
-00019a40: 2e44 696d 280a 2020 2020 2020 2020 2020  .Dim(.          
-00019a50: 2020 6e61 6d65 3d22 6431 222c 0a20 2020    name="d1",.   
-00019a60: 2020 2020 2020 2020 2064 6f6d 6169 6e3d           domain=
-00019a70: 286e 702e 6461 7465 7469 6d65 3634 2822  (np.datetime64("
-00019a80: 3230 3130 2d30 312d 3031 2229 2c20 6e70  2010-01-01"), np
-00019a90: 2e64 6174 6574 696d 6536 3428 2232 3032  .datetime64("202
-00019aa0: 302d 3031 2d30 3122 2929 2c0a 2020 2020  0-01-01")),.    
-00019ab0: 2020 2020 2020 2020 7469 6c65 3d6e 702e          tile=np.
-00019ac0: 7469 6d65 6465 6c74 6136 3428 3336 352c  timedelta64(365,
-00019ad0: 2022 4422 292c 0a20 2020 2020 2020 2020   "D"),.         
-00019ae0: 2020 2064 7479 7065 3d6e 702e 6461 7465     dtype=np.date
-00019af0: 7469 6d65 3634 2822 222c 2022 4422 292e  time64("", "D").
-00019b00: 6474 7970 652c 0a20 2020 2020 2020 2029  dtype,.        )
-00019b10: 0a20 2020 2020 2020 2064 6f6d 203d 2074  .        dom = t
-00019b20: 696c 6564 622e 446f 6d61 696e 2864 696d  iledb.Domain(dim
-00019b30: 290a 2020 2020 2020 2020 7363 6865 6d61  ).        schema
-00019b40: 203d 2074 696c 6564 622e 4172 7261 7953   = tiledb.ArrayS
-00019b50: 6368 656d 6128 0a20 2020 2020 2020 2020  chema(.         
-00019b60: 2020 2064 6f6d 6169 6e3d 646f 6d2c 2061     domain=dom, a
-00019b70: 7474 7273 3d28 7469 6c65 6462 2e41 7474  ttrs=(tiledb.Att
-00019b80: 7228 2261 3122 2c20 6474 7970 653d 6e70  r("a1", dtype=np
-00019b90: 2e66 6c6f 6174 3634 292c 290a 2020 2020  .float64),).    
-00019ba0: 2020 2020 290a 2020 2020 2020 2020 7469      ).        ti
-00019bb0: 6c65 6462 2e41 7272 6179 2e63 7265 6174  ledb.Array.creat
-00019bc0: 6528 7572 692c 2073 6368 656d 6129 0a0a  e(uri, schema)..
-00019bd0: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
-00019be0: 6120 6665 7720 7965 6172 7320 6f66 2064  a few years of d
-00019bf0: 6174 6120 6174 2074 6865 2062 6567 696e  ata at the begin
-00019c00: 6e69 6e67 2075 7369 6e67 2061 2074 696d  ning using a tim
-00019c10: 6564 656c 7461 206f 626a 6563 740a 2020  edelta object.  
-00019c20: 2020 2020 2020 6e64 6179 7320 3d20 3336        ndays = 36
-00019c30: 3520 2a20 320a 2020 2020 2020 2020 6131  5 * 2.        a1
-00019c40: 5f76 616c 7320 3d20 6e70 2e72 616e 646f  _vals = np.rando
-00019c50: 6d2e 7261 6e64 286e 6461 7973 290a 2020  m.rand(ndays).  
-00019c60: 2020 2020 2020 7374 6172 7420 3d20 6e70        start = np
-00019c70: 2e64 6174 6574 696d 6536 3428 2232 3031  .datetime64("201
-00019c80: 302d 3031 2d30 3122 290a 2020 2020 2020  0-01-01").      
-00019c90: 2020 2320 4461 7465 7469 6d65 2069 6e64    # Datetime ind
-00019ca0: 6578 696e 6720 6973 2069 6e63 6c75 7369  exing is inclusi
-00019cb0: 7665 2c20 736f 2061 2064 656c 7461 206f  ve, so a delta o
-00019cc0: 6620 6f6e 6520 6c65 7373 0a20 2020 2020  f one less.     
-00019cd0: 2020 2065 6e64 203d 2073 7461 7274 202b     end = start +
-00019ce0: 206e 702e 7469 6d65 6465 6c74 6136 3428   np.timedelta64(
-00019cf0: 6e64 6179 7320 2d20 312c 2022 4422 290a  ndays - 1, "D").
-00019d00: 2020 2020 2020 2020 7769 7468 2074 696c          with til
-00019d10: 6564 622e 4465 6e73 6541 7272 6179 2875  edb.DenseArray(u
-00019d20: 7269 2c20 2277 2229 2061 7320 543a 0a20  ri, "w") as T:. 
-00019d30: 2020 2020 2020 2020 2020 2054 5b73 7461             T[sta
-00019d40: 7274 3a65 6e64 5d20 3d20 7b22 6131 223a  rt:end] = {"a1":
-00019d50: 2061 315f 7661 6c73 7d0a 0a20 2020 2020   a1_vals}..     
-00019d60: 2020 2023 2052 6561 6420 6261 636b 2064     # Read back d
-00019d70: 6174 610a 2020 2020 2020 2020 7769 7468  ata.        with
-00019d80: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
-00019d90: 6179 2875 7269 2c20 2272 222c 2061 7474  ay(uri, "r", att
-00019da0: 723d 2261 3122 2920 6173 2054 3a0a 2020  r="a1") as T:.  
-00019db0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00019dc0: 5f61 7272 6179 5f65 7175 616c 2854 5b73  _array_equal(T[s
-00019dd0: 7461 7274 3a65 6e64 5d2c 2061 315f 7661  tart:end], a1_va
-00019de0: 6c73 290a 0a20 2020 2020 2020 2023 2043  ls)..        # C
-00019df0: 6865 636b 206e 6f6e 656d 7074 7920 646f  heck nonempty do
-00019e00: 6d61 696e 0a20 2020 2020 2020 2077 6974  main.        wit
-00019e10: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
-00019e20: 7261 7928 7572 692c 2022 7222 2920 6173  ray(uri, "r") as
-00019e30: 2054 3a0a 2020 2020 2020 2020 2020 2020   T:.            
-00019e40: 6e6f 6e65 6d70 7479 203d 2054 2e6e 6f6e  nonempty = T.non
-00019e50: 656d 7074 795f 646f 6d61 696e 2829 0a20  empty_domain(). 
-00019e60: 2020 2020 2020 2020 2020 2064 315f 6e6f             d1_no
-00019e70: 6e65 6d70 7479 203d 206e 6f6e 656d 7074  nempty = nonempt
-00019e80: 795b 305d 0a20 2020 2020 2020 2020 2020  y[0].           
-00019e90: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
-00019ea0: 6c28 6431 5f6e 6f6e 656d 7074 795b 305d  l(d1_nonempty[0]
-00019eb0: 2e64 7479 7065 2c20 6e70 2e64 6174 6574  .dtype, np.datet
-00019ec0: 696d 6536 3428 2222 2c20 2244 2229 290a  ime64("", "D")).
-00019ed0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00019ee0: 2e61 7373 6572 7445 7175 616c 2864 315f  .assertEqual(d1_
-00019ef0: 6e6f 6e65 6d70 7479 5b31 5d2e 6474 7970  nonempty[1].dtyp
-00019f00: 652c 206e 702e 6461 7465 7469 6d65 3634  e, np.datetime64
-00019f10: 2822 222c 2022 4422 2929 0a20 2020 2020  ("", "D")).     
-00019f20: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-00019f30: 7274 5475 706c 6545 7175 616c 2864 315f  rtTupleEqual(d1_
-00019f40: 6e6f 6e65 6d70 7479 2c20 2873 7461 7274  nonempty, (start
-00019f50: 2c20 656e 6429 290a 0a20 2020 2020 2020  , end))..       
-00019f60: 2023 2053 6c69 6365 2061 2066 6577 2064   # Slice a few d
-00019f70: 6179 7320 6672 6f6d 2074 6865 206d 6964  ays from the mid
-00019f80: 646c 6520 7573 696e 6720 7477 6f20 6461  dle using two da
-00019f90: 7465 7469 6d65 730a 2020 2020 2020 2020  tetimes.        
-00019fa0: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
-00019fb0: 6541 7272 6179 2875 7269 2c20 2272 222c  eArray(uri, "r",
-00019fc0: 2061 7474 723d 2261 3122 2920 6173 2054   attr="a1") as T
-00019fd0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00019fe0: 536c 6963 6520 7573 696e 6720 6461 7465  Slice using date
-00019ff0: 7469 6d65 730a 2020 2020 2020 2020 2020  times.          
-0001a000: 2020 6163 7475 616c 203d 2054 5b6e 702e    actual = T[np.
-0001a010: 6461 7465 7469 6d65 3634 2822 3230 3130  datetime64("2010
-0001a020: 2d31 312d 3031 2229 203a 206e 702e 6461  -11-01") : np.da
-0001a030: 7465 7469 6d65 3634 2822 3230 3131 2d30  tetime64("2011-0
-0001a040: 312d 3331 2229 5d0a 0a20 2020 2020 2020  1-31")]..       
-0001a050: 2020 2020 2023 2043 6f6e 7665 7274 2064       # Convert d
-0001a060: 6174 6574 696d 6520 696e 7465 7276 616c  atetime interval
-0001a070: 2074 6f20 696e 7465 6765 7220 6f66 6673   to integer offs
-0001a080: 6574 2f6c 656e 6774 6820 696e 746f 206f  et/length into o
-0001a090: 7269 6769 6e61 6c20 6172 7261 790a 2020  riginal array.  
-0001a0a0: 2020 2020 2020 2020 2020 2320 6d75 7374            # must
-0001a0b0: 2062 6520 6361 7374 2074 6f20 696e 7420   be cast to int 
-0001a0c0: 6265 6361 7573 6520 666c 6f61 7420 736c  because float sl
-0001a0d0: 6963 6573 2061 7265 206e 6f74 2061 6c6c  ices are not all
-0001a0e0: 6f77 6564 2069 6e20 4e75 6d50 7920 312e  owed in NumPy 1.
-0001a0f0: 3132 2b0a 2020 2020 2020 2020 2020 2020  12+.            
-0001a100: 7265 6164 5f6f 6666 7365 7420 3d20 696e  read_offset = in
-0001a110: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-0001a120: 2020 2028 6e70 2e64 6174 6574 696d 6536     (np.datetime6
-0001a130: 3428 2232 3031 302d 3131 2d30 3122 2920  4("2010-11-01") 
-0001a140: 2d20 7374 6172 7429 202f 206e 702e 7469  - start) / np.ti
-0001a150: 6d65 6465 6c74 6136 3428 312c 2022 4422  medelta64(1, "D"
-0001a160: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-0001a170: 2020 2020 2020 2020 2020 2020 7265 6164              read
-0001a180: 5f6e 6461 7973 203d 2069 6e74 280a 2020  _ndays = int(.  
-0001a190: 2020 2020 2020 2020 2020 2020 2020 286e                (n
-0001a1a0: 702e 6461 7465 7469 6d65 3634 2822 3230  p.datetime64("20
-0001a1b0: 3131 2d30 312d 3331 2229 202d 206e 702e  11-01-31") - np.
-0001a1c0: 6461 7465 7469 6d65 3634 2822 3230 3130  datetime64("2010
-0001a1d0: 2d31 312d 3031 2229 202b 2031 290a 2020  -11-01") + 1).  
-0001a1e0: 2020 2020 2020 2020 2020 2020 2020 2f20                / 
-0001a1f0: 6e70 2e74 696d 6564 656c 7461 3634 2831  np.timedelta64(1
-0001a200: 2c20 2244 2229 0a20 2020 2020 2020 2020  , "D").         
-0001a210: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0001a220: 2065 7870 6563 7465 6420 3d20 6131 5f76   expected = a1_v
-0001a230: 616c 735b 7265 6164 5f6f 6666 7365 7420  als[read_offset 
-0001a240: 3a20 7265 6164 5f6f 6666 7365 7420 2b20  : read_offset + 
-0001a250: 7265 6164 5f6e 6461 7973 5d0a 2020 2020  read_ndays].    
-0001a260: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
-0001a270: 7272 6179 5f65 7175 616c 2861 6374 7561  rray_equal(actua
-0001a280: 6c2c 2065 7870 6563 7465 6429 0a0a 2020  l, expected)..  
-0001a290: 2020 2020 2020 2320 536c 6963 6520 7468        # Slice th
-0001a2a0: 6520 6669 7273 7420 7965 6172 0a20 2020  e first year.   
-0001a2b0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-0001a2c0: 2e44 656e 7365 4172 7261 7928 7572 692c  .DenseArray(uri,
-0001a2d0: 2022 7222 2c20 6174 7472 3d22 6131 2229   "r", attr="a1")
-0001a2e0: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
-0001a2f0: 2020 2061 6374 7561 6c20 3d20 545b 6e70     actual = T[np
-0001a300: 2e64 6174 6574 696d 6536 3428 2232 3031  .datetime64("201
-0001a310: 3022 2920 3a20 6e70 2e64 6174 6574 696d  0") : np.datetim
-0001a320: 6536 3428 2232 3031 3122 295d 0a0a 2020  e64("2011")]..  
-0001a330: 2020 2020 2020 2020 2020 2320 436f 6e76            # Conv
-0001a340: 6572 7420 6461 7465 7469 6d65 2069 6e74  ert datetime int
-0001a350: 6572 7661 6c20 746f 2069 6e74 6567 6572  erval to integer
-0001a360: 206f 6666 7365 742f 6c65 6e67 7468 2069   offset/length i
-0001a370: 6e74 6f20 6f72 6967 696e 616c 2061 7272  nto original arr
-0001a380: 6179 0a20 2020 2020 2020 2020 2020 2072  ay.            r
-0001a390: 6561 645f 6f66 6673 6574 203d 2069 6e74  ead_offset = int
-0001a3a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001a3b0: 2020 286e 702e 6461 7465 7469 6d65 3634    (np.datetime64
-0001a3c0: 2822 3230 3130 2d30 312d 3031 2229 202d  ("2010-01-01") -
-0001a3d0: 2073 7461 7274 2920 2f20 6e70 2e74 696d   start) / np.tim
-0001a3e0: 6564 656c 7461 3634 2831 2c20 2244 2229  edelta64(1, "D")
-0001a3f0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0001a400: 2020 2020 2020 2020 2020 2072 6561 645f             read_
-0001a410: 6e64 6179 7320 3d20 696e 7428 0a20 2020  ndays = int(.   
-0001a420: 2020 2020 2020 2020 2020 2020 2028 6e70               (np
-0001a430: 2e64 6174 6574 696d 6536 3428 2232 3031  .datetime64("201
-0001a440: 312d 3031 2d30 3122 2920 2d20 6e70 2e64  1-01-01") - np.d
-0001a450: 6174 6574 696d 6536 3428 2232 3031 302d  atetime64("2010-
-0001a460: 3031 2d30 3122 2920 2b20 3129 0a20 2020  01-01") + 1).   
-0001a470: 2020 2020 2020 2020 2020 2020 202f 206e               / n
-0001a480: 702e 7469 6d65 6465 6c74 6136 3428 312c  p.timedelta64(1,
-0001a490: 2022 4422 290a 2020 2020 2020 2020 2020   "D").          
-0001a4a0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0001a4b0: 6578 7065 6374 6564 203d 2061 315f 7661  expected = a1_va
-0001a4c0: 6c73 5b72 6561 645f 6f66 6673 6574 203a  ls[read_offset :
-0001a4d0: 2072 6561 645f 6f66 6673 6574 202b 2072   read_offset + r
-0001a4e0: 6561 645f 6e64 6179 735d 0a20 2020 2020  ead_ndays].     
-0001a4f0: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-0001a500: 7261 795f 6571 7561 6c28 6163 7475 616c  ray_equal(actual
-0001a510: 2c20 6578 7065 6374 6564 290a 0a20 2020  , expected)..   
-0001a520: 2020 2020 2023 2053 6c69 6365 206f 7065       # Slice ope
-0001a530: 6e20 7370 616e 730a 2020 2020 2020 2020  n spans.        
-0001a540: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
-0001a550: 6541 7272 6179 2875 7269 2c20 2272 222c  eArray(uri, "r",
-0001a560: 2061 7474 723d 2261 3122 2920 6173 2054   attr="a1") as T
-0001a570: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
-0001a580: 2043 6f6e 7665 7274 2064 6174 6574 696d   Convert datetim
-0001a590: 6520 696e 7465 7276 616c 2074 6f20 696e  e interval to in
-0001a5a0: 7465 6765 7220 6f66 6673 6574 2f6c 656e  teger offset/len
-0001a5b0: 6774 6820 696e 746f 206f 7269 6769 6e61  gth into origina
-0001a5c0: 6c20 6172 7261 790a 2020 2020 2020 2020  l array.        
-0001a5d0: 2020 2020 7265 6164 5f6f 6666 7365 7420      read_offset 
-0001a5e0: 3d20 696e 7428 0a20 2020 2020 2020 2020  = int(.         
-0001a5f0: 2020 2020 2020 2028 6e70 2e64 6174 6574         (np.datet
-0001a600: 696d 6536 3428 2232 3031 302d 3031 2d30  ime64("2010-01-0
-0001a610: 3122 2920 2d20 7374 6172 7429 202f 206e  1") - start) / n
-0001a620: 702e 7469 6d65 6465 6c74 6136 3428 312c  p.timedelta64(1,
-0001a630: 2022 4422 290a 2020 2020 2020 2020 2020   "D").          
-0001a640: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0001a650: 7265 6164 5f6e 6461 7973 203d 2069 6e74  read_ndays = int
-0001a660: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001a670: 2020 286e 702e 6461 7465 7469 6d65 3634    (np.datetime64
-0001a680: 2822 3230 3131 2d30 312d 3331 2229 202d  ("2011-01-31") -
-0001a690: 206e 702e 6461 7465 7469 6d65 3634 2822   np.datetime64("
-0001a6a0: 3230 3130 2d30 312d 3031 2229 202b 2031  2010-01-01") + 1
-0001a6b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001a6c0: 2020 2f20 6e70 2e74 696d 6564 656c 7461    / np.timedelta
-0001a6d0: 3634 2831 2c20 2244 2229 0a20 2020 2020  64(1, "D").     
-0001a6e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001a6f0: 2020 2020 2065 7870 6563 7465 6420 3d20       expected = 
-0001a700: 6131 5f76 616c 735b 7265 6164 5f6f 6666  a1_vals[read_off
-0001a710: 7365 7420 3a20 7265 6164 5f6f 6666 7365  set : read_offse
-0001a720: 7420 2b20 7265 6164 5f6e 6461 7973 5d0a  t + read_ndays].
-0001a730: 0a20 2020 2020 2020 2020 2020 2023 206e  .            # n
-0001a740: 6f74 6520 7765 206f 6e6c 7920 7772 6f74  ote we only wrot
-0001a750: 6520 6669 7273 7420 7477 6f20 7965 6172  e first two year
-0001a760: 730a 2020 2020 2020 2020 2020 2020 6163  s.            ac
-0001a770: 7475 616c 203d 2054 2e6d 756c 7469 5f69  tual = T.multi_i
-0001a780: 6e64 6578 5b6e 702e 6461 7465 7469 6d65  ndex[np.datetime
-0001a790: 3634 2822 3230 3130 2d30 312d 3031 2229  64("2010-01-01")
-0001a7a0: 203a 5d5b 2261 3122 5d5b 3a72 6561 645f   :]["a1"][:read_
-0001a7b0: 6e64 6179 735d 0a20 2020 2020 2020 2020  ndays].         
-0001a7c0: 2020 2061 7373 6572 745f 6172 7261 795f     assert_array_
-0001a7d0: 6571 7561 6c28 6163 7475 616c 2c20 6578  equal(actual, ex
-0001a7e0: 7065 6374 6564 290a 0a20 2020 2020 2020  pected)..       
-0001a7f0: 2020 2020 2061 6374 7561 6c32 203d 2054       actual2 = T
-0001a800: 5b6e 702e 6461 7465 7469 6d65 3634 2822  [np.datetime64("
-0001a810: 3230 3130 2d30 312d 3031 2229 203a 5d5b  2010-01-01") :][
-0001a820: 3a72 6561 645f 6e64 6179 735d 0a20 2020  :read_ndays].   
-0001a830: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-0001a840: 6172 7261 795f 6571 7561 6c28 6163 7475  array_equal(actu
-0001a850: 616c 322c 2065 7870 6563 7465 6429 0a0a  al2, expected)..
-0001a860: 2020 2020 6465 6620 7465 7374 5f73 7061      def test_spa
-0001a870: 7273 655f 6461 7465 7469 6d65 5f76 6563  rse_datetime_vec
-0001a880: 746f 7228 7365 6c66 2c20 7370 6172 7365  tor(self, sparse
-0001a890: 5f63 656c 6c5f 6f72 6465 7229 3a0a 2020  _cell_order):.  
-0001a8a0: 2020 2020 2020 7572 6920 3d20 7365 6c66        uri = self
-0001a8b0: 2e70 6174 6828 2266 6f6f 5f64 6174 6574  .path("foo_datet
-0001a8c0: 696d 655f 7370 6172 7365 5f76 6563 746f  ime_sparse_vecto
-0001a8d0: 7222 290a 0a20 2020 2020 2020 2023 206e  r")..        # n
-0001a8e0: 7320 7265 736f 6c75 7469 6f6e 2c20 6f6e  s resolution, on
-0001a8f0: 6520 7469 6c65 2070 6572 2073 6563 6f6e  e tile per secon
-0001a900: 642c 206d 6178 2064 6f6d 6169 6e20 706f  d, max domain po
-0001a910: 7373 6962 6c65 0a20 2020 2020 2020 2064  ssible.        d
-0001a920: 696d 203d 2074 696c 6564 622e 4469 6d28  im = tiledb.Dim(
-0001a930: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
-0001a940: 653d 2264 3122 2c0a 2020 2020 2020 2020  e="d1",.        
-0001a950: 2020 2020 646f 6d61 696e 3d28 0a20 2020      domain=(.   
-0001a960: 2020 2020 2020 2020 2020 2020 206e 702e               np.
-0001a970: 6461 7465 7469 6d65 3634 2830 2c20 226e  datetime64(0, "n
-0001a980: 7322 292c 0a20 2020 2020 2020 2020 2020  s"),.           
-0001a990: 2020 2020 206e 702e 6461 7465 7469 6d65       np.datetime
-0001a9a0: 3634 2869 6e74 286e 702e 6969 6e66 6f28  64(int(np.iinfo(
-0001a9b0: 6e70 2e69 6e74 3634 292e 6d61 7829 202d  np.int64).max) -
-0001a9c0: 2031 3030 3030 3030 3030 302c 2022 6e73   1000000000, "ns
-0001a9d0: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-0001a9e0: 292c 0a20 2020 2020 2020 2020 2020 2074  ),.            t
-0001a9f0: 696c 653d 6e70 2e74 696d 6564 656c 7461  ile=np.timedelta
-0001aa00: 3634 2831 2c20 2273 2229 2c0a 2020 2020  64(1, "s"),.    
-0001aa10: 2020 2020 2020 2020 6474 7970 653d 6e70          dtype=np
-0001aa20: 2e64 6174 6574 696d 6536 3428 2222 2c20  .datetime64("", 
-0001aa30: 226e 7322 292e 6474 7970 652c 0a20 2020  "ns").dtype,.   
-0001aa40: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-0001aa50: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
-0001aa60: 6469 6d2e 7469 6c65 2c20 6e70 2e74 696d  dim.tile, np.tim
-0001aa70: 6564 656c 7461 3634 2822 3130 3030 3030  edelta64("100000
-0001aa80: 3030 3030 222c 2022 6e73 2229 290a 2020  0000", "ns")).  
-0001aa90: 2020 2020 2020 646f 6d20 3d20 7469 6c65        dom = tile
-0001aaa0: 6462 2e44 6f6d 6169 6e28 6469 6d29 0a20  db.Domain(dim). 
-0001aab0: 2020 2020 2020 2073 6368 656d 6120 3d20         schema = 
-0001aac0: 7469 6c65 6462 2e41 7272 6179 5363 6865  tiledb.ArraySche
-0001aad0: 6d61 280a 2020 2020 2020 2020 2020 2020  ma(.            
-0001aae0: 646f 6d61 696e 3d64 6f6d 2c0a 2020 2020  domain=dom,.    
-0001aaf0: 2020 2020 2020 2020 7370 6172 7365 3d54          sparse=T
-0001ab00: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-0001ab10: 2063 656c 6c5f 6f72 6465 723d 7370 6172   cell_order=spar
-0001ab20: 7365 5f63 656c 6c5f 6f72 6465 722c 0a20  se_cell_order,. 
-0001ab30: 2020 2020 2020 2020 2020 2061 7474 7273             attrs
-0001ab40: 3d28 7469 6c65 6462 2e41 7474 7228 2261  =(tiledb.Attr("a
-0001ab50: 3122 2c20 6474 7970 653d 6e70 2e66 6c6f  1", dtype=np.flo
-0001ab60: 6174 3634 292c 292c 0a20 2020 2020 2020  at64),),.       
-0001ab70: 2029 0a20 2020 2020 2020 2074 696c 6564   ).        tiled
-0001ab80: 622e 4172 7261 792e 6372 6561 7465 2875  b.Array.create(u
-0001ab90: 7269 2c20 7363 6865 6d61 290a 0a20 2020  ri, schema)..   
-0001aba0: 2020 2020 2023 2057 7269 7465 2031 306b       # Write 10k
-0001abb0: 2063 656c 6c73 2065 7665 7279 2031 3030   cells every 100
-0001abc0: 3020 6e73 2073 7461 7274 696e 6720 6174  0 ns starting at
-0001abd0: 2074 696d 6520 300a 2020 2020 2020 2020   time 0.        
-0001abe0: 636f 6f72 6473 203d 206e 702e 6461 7465  coords = np.date
-0001abf0: 7469 6d65 3634 2830 2c20 226e 7322 2920  time64(0, "ns") 
-0001ac00: 2b20 6e70 2e61 7261 6e67 6528 302c 2031  + np.arange(0, 1
-0001ac10: 3030 3030 202a 2031 3030 302c 2031 3030  0000 * 1000, 100
-0001ac20: 3029 0a20 2020 2020 2020 2061 315f 7661  0).        a1_va
-0001ac30: 6c73 203d 206e 702e 7261 6e64 6f6d 2e72  ls = np.random.r
-0001ac40: 616e 6428 6c65 6e28 636f 6f72 6473 2929  and(len(coords))
-0001ac50: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
-0001ac60: 6c65 6462 2e53 7061 7273 6541 7272 6179  ledb.SparseArray
-0001ac70: 2875 7269 2c20 2277 2229 2061 7320 543a  (uri, "w") as T:
-0001ac80: 0a20 2020 2020 2020 2020 2020 2054 5b63  .            T[c
-0001ac90: 6f6f 7264 735d 203d 207b 2261 3122 3a20  oords] = {"a1": 
-0001aca0: 6131 5f76 616c 737d 0a0a 2020 2020 2020  a1_vals}..      
-0001acb0: 2020 2320 5265 6164 2061 6c6c 0a20 2020    # Read all.   
-0001acc0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-0001acd0: 2e53 7061 7273 6541 7272 6179 2875 7269  .SparseArray(uri
-0001ace0: 2c20 2272 2229 2061 7320 543a 0a20 2020  , "r") as T:.   
-0001acf0: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-0001ad00: 6172 7261 795f 6571 7561 6c28 545b 3a5d  array_equal(T[:]
-0001ad10: 5b22 6131 225d 2c20 6131 5f76 616c 7329  ["a1"], a1_vals)
-0001ad20: 0a0a 2020 2020 2020 2020 2320 5265 6164  ..        # Read
-0001ad30: 2062 6163 6b20 6669 7273 7420 3130 2063   back first 10 c
-0001ad40: 656c 6c73 0a20 2020 2020 2020 2077 6974  ells.        wit
-0001ad50: 6820 7469 6c65 6462 2e53 7061 7273 6541  h tiledb.SparseA
-0001ad60: 7272 6179 2875 7269 2c20 2272 2229 2061  rray(uri, "r") a
-0001ad70: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
-0001ad80: 2073 7461 7274 203d 206e 702e 6461 7465   start = np.date
-0001ad90: 7469 6d65 3634 2830 2c20 226e 7322 290a  time64(0, "ns").
-0001ada0: 2020 2020 2020 2020 2020 2020 7661 6c73              vals
-0001adb0: 203d 2054 5b73 7461 7274 203a 2073 7461   = T[start : sta
-0001adc0: 7274 202b 206e 702e 7469 6d65 6465 6c74  rt + np.timedelt
-0001add0: 6136 3428 3130 3030 302c 2022 6e73 2229  a64(10000, "ns")
-0001ade0: 5d5b 2261 3122 5d0a 2020 2020 2020 2020  ]["a1"].        
-0001adf0: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
-0001ae00: 5f65 7175 616c 2876 616c 732c 2061 315f  _equal(vals, a1_
-0001ae10: 7661 6c73 5b30 3a31 315d 290a 0a20 2020  vals[0:11])..   
-0001ae20: 2020 2020 2020 2020 2023 2054 6573 7420           # Test 
-0001ae30: 6f70 656e 2065 6e64 6564 2072 616e 6765  open ended range
-0001ae40: 7320 6d75 6c74 695f 696e 6465 780a 2020  s multi_index.  
-0001ae50: 2020 2020 2020 2020 2020 7661 6c73 3220            vals2 
-0001ae60: 3d20 542e 6d75 6c74 695f 696e 6465 785b  = T.multi_index[
-0001ae70: 7374 6172 743a 5d5b 2261 3122 5d0a 2020  start:]["a1"].  
-0001ae80: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-0001ae90: 5f61 7272 6179 5f65 7175 616c 2876 616c  _array_equal(val
-0001aea0: 7332 2c20 6131 5f76 616c 7329 0a0a 2020  s2, a1_vals)..  
-0001aeb0: 2020 2020 2020 2020 2020 7374 6f70 203d            stop =
-0001aec0: 206e 702e 6461 7465 7469 6d65 3634 2869   np.datetime64(i
-0001aed0: 6e74 286e 702e 6969 6e66 6f28 6e70 2e69  nt(np.iinfo(np.i
-0001aee0: 6e74 3634 292e 6d61 7829 202d 2031 3030  nt64).max) - 100
-0001aef0: 3030 3030 3030 302c 2022 6e73 2229 0a20  0000000, "ns"). 
-0001af00: 2020 2020 2020 2020 2020 2076 616c 7333             vals3
-0001af10: 203d 2054 2e6d 756c 7469 5f69 6e64 6578   = T.multi_index
-0001af20: 5b3a 7374 6f70 5d5b 2261 3122 5d0a 2020  [:stop]["a1"].  
-0001af30: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-0001af40: 5f61 7272 6179 5f65 7175 616c 2876 616c  _array_equal(val
-0001af50: 7333 2c20 6131 5f76 616c 7329 0a0a 2020  s3, a1_vals)..  
-0001af60: 2020 6465 6620 7465 7374 5f64 6174 6574    def test_datet
-0001af70: 696d 655f 7479 7065 7328 7365 6c66 2c20  ime_types(self, 
-0001af80: 7370 6172 7365 5f63 656c 6c5f 6f72 6465  sparse_cell_orde
-0001af90: 7229 3a0a 2020 2020 2020 2020 756e 6974  r):.        unit
-0001afa0: 7320 3d20 5b22 6822 2c20 226d 222c 2022  s = ["h", "m", "
-0001afb0: 7322 2c20 226d 7322 2c20 2275 7322 2c20  s", "ms", "us", 
-0001afc0: 226e 7322 2c20 2270 7322 2c20 2266 7322  "ns", "ps", "fs"
-0001afd0: 5d0a 0a20 2020 2020 2020 2066 6f72 2072  ]..        for r
-0001afe0: 6573 2069 6e20 756e 6974 733a 0a20 2020  es in units:.   
-0001aff0: 2020 2020 2020 2020 2075 7269 203d 2073           uri = s
-0001b000: 656c 662e 7061 7468 2822 7465 7374 5f64  elf.path("test_d
-0001b010: 6174 6574 696d 655f 7479 7065 5f22 202b  atetime_type_" +
-0001b020: 2072 6573 290a 0a20 2020 2020 2020 2020   res)..         
-0001b030: 2020 2074 6d61 7820 3d20 3130 3030 0a20     tmax = 1000. 
-0001b040: 2020 2020 2020 2020 2020 2074 696c 6520             tile 
-0001b050: 3d20 6e70 2e74 696d 6564 656c 7461 3634  = np.timedelta64
-0001b060: 2831 2c20 7265 7329 0a0a 2020 2020 2020  (1, res)..      
-0001b070: 2020 2020 2020 6469 6d20 3d20 7469 6c65        dim = tile
-0001b080: 6462 2e44 696d 280a 2020 2020 2020 2020  db.Dim(.        
-0001b090: 2020 2020 2020 2020 6e61 6d65 3d22 6431          name="d1
-0001b0a0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0001b0b0: 2020 2064 6f6d 6169 6e3d 284e 6f6e 652c     domain=(None,
-0001b0c0: 204e 6f6e 6529 2c0a 2020 2020 2020 2020   None),.        
-0001b0d0: 2020 2020 2020 2020 7469 6c65 3d74 696c          tile=til
-0001b0e0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0001b0f0: 2020 2064 7479 7065 3d6e 702e 6461 7465     dtype=np.date
-0001b100: 7469 6d65 3634 2822 222c 2072 6573 292e  time64("", res).
-0001b110: 6474 7970 652c 0a20 2020 2020 2020 2020  dtype,.         
-0001b120: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0001b130: 2064 6f6d 203d 2074 696c 6564 622e 446f   dom = tiledb.Do
-0001b140: 6d61 696e 2864 696d 290a 2020 2020 2020  main(dim).      
-0001b150: 2020 2020 2020 7363 6865 6d61 203d 2074        schema = t
-0001b160: 696c 6564 622e 4172 7261 7953 6368 656d  iledb.ArraySchem
-0001b170: 6128 0a20 2020 2020 2020 2020 2020 2020  a(.             
-0001b180: 2020 2064 6f6d 6169 6e3d 646f 6d2c 0a20     domain=dom,. 
-0001b190: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001b1a0: 7061 7273 653d 5472 7565 2c0a 2020 2020  parse=True,.    
-0001b1b0: 2020 2020 2020 2020 2020 2020 6365 6c6c              cell
-0001b1c0: 5f6f 7264 6572 3d73 7061 7273 655f 6365  _order=sparse_ce
-0001b1d0: 6c6c 5f6f 7264 6572 2c0a 2020 2020 2020  ll_order,.      
-0001b1e0: 2020 2020 2020 2020 2020 6174 7472 733d            attrs=
-0001b1f0: 2874 696c 6564 622e 4174 7472 2822 6131  (tiledb.Attr("a1
-0001b200: 222c 2064 7479 7065 3d6e 702e 666c 6f61  ", dtype=np.floa
-0001b210: 7436 3429 2c29 2c0a 2020 2020 2020 2020  t64),),.        
-0001b220: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-0001b230: 2020 2074 696c 6564 622e 4172 7261 792e     tiledb.Array.
-0001b240: 6372 6561 7465 2875 7269 2c20 7363 6865  create(uri, sche
-0001b250: 6d61 290a 0a20 2020 2020 2020 2020 2020  ma)..           
-0001b260: 2023 2057 7269 7465 2074 6d61 7820 6365   # Write tmax ce
-0001b270: 6c6c 7320 6576 6572 7920 3130 2075 6e69  lls every 10 uni
-0001b280: 7473 2073 7461 7274 696e 6720 6174 2074  ts starting at t
-0001b290: 696d 6520 300a 2020 2020 2020 2020 2020  ime 0.          
-0001b2a0: 2020 636f 6f72 6473 203d 206e 702e 6461    coords = np.da
-0001b2b0: 7465 7469 6d65 3634 2830 2c20 7265 7329  tetime64(0, res)
-0001b2c0: 202b 206e 702e 6172 616e 6765 280a 2020   + np.arange(.  
-0001b2d0: 2020 2020 2020 2020 2020 2020 2020 302c                0,
-0001b2e0: 2074 6d61 782c 2031 300a 2020 2020 2020   tmax, 10.      
-0001b2f0: 2020 2020 2020 2920 2023 206e 702e 6172        )  # np.ar
-0001b300: 616e 6765 2830 2c20 3130 3030 3020 2a20  ange(0, 10000 * 
-0001b310: 3130 3030 2c20 3130 3030 290a 2020 2020  1000, 1000).    
-0001b320: 2020 2020 2020 2020 6131 5f76 616c 7320          a1_vals 
-0001b330: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
-0001b340: 286c 656e 2863 6f6f 7264 7329 290a 2020  (len(coords)).  
-0001b350: 2020 2020 2020 2020 2020 7769 7468 2074            with t
-0001b360: 696c 6564 622e 5370 6172 7365 4172 7261  iledb.SparseArra
-0001b370: 7928 7572 692c 2022 7722 2920 6173 2054  y(uri, "w") as T
-0001b380: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001b390: 2020 545b 636f 6f72 6473 5d20 3d20 7b22    T[coords] = {"
-0001b3a0: 6131 223a 2061 315f 7661 6c73 7d0a 0a20  a1": a1_vals}.. 
-0001b3b0: 2020 2020 2020 2020 2020 2023 2052 6561             # Rea
-0001b3c0: 6420 616c 6c0a 2020 2020 2020 2020 2020  d all.          
-0001b3d0: 2020 7769 7468 2074 696c 6564 622e 5370    with tiledb.Sp
-0001b3e0: 6172 7365 4172 7261 7928 7572 692c 2022  arseArray(uri, "
-0001b3f0: 7222 2920 6173 2054 3a0a 2020 2020 2020  r") as T:.      
-0001b400: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-0001b410: 5f61 7272 6179 5f65 7175 616c 2854 5b3a  _array_equal(T[:
-0001b420: 5d5b 2261 3122 5d2c 2061 315f 7661 6c73  ]["a1"], a1_vals
-0001b430: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0001b440: 2052 6561 6420 6261 636b 2066 6972 7374   Read back first
-0001b450: 2031 3020 6365 6c6c 730a 2020 2020 2020   10 cells.      
-0001b460: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-0001b470: 622e 5370 6172 7365 4172 7261 7928 7572  b.SparseArray(ur
-0001b480: 692c 2022 7222 2920 6173 2054 3a0a 2020  i, "r") as T:.  
-0001b490: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0001b4a0: 6172 7420 3d20 6e70 2e64 6174 6574 696d  art = np.datetim
-0001b4b0: 6536 3428 302c 2072 6573 290a 2020 2020  e64(0, res).    
-0001b4c0: 2020 2020 2020 2020 2020 2020 7661 6c73              vals
-0001b4d0: 203d 2054 5b73 7461 7274 203a 2073 7461   = T[start : sta
-0001b4e0: 7274 202b 206e 702e 7469 6d65 6465 6c74  rt + np.timedelt
-0001b4f0: 6136 3428 696e 7428 746d 6178 202f 2031  a64(int(tmax / 1
-0001b500: 3029 2c20 7265 7329 5d5b 2261 3122 5d0a  0), res)]["a1"].
-0001b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b520: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-0001b530: 616c 2876 616c 732c 2061 315f 7661 6c73  al(vals, a1_vals
-0001b540: 5b30 3a31 315d 290a 0a0a 636c 6173 7320  [0:11])...class 
-0001b550: 5069 636b 6c65 5465 7374 2844 6973 6b54  PickleTest(DiskT
-0001b560: 6573 7443 6173 6529 3a0a 2020 2020 2320  estCase):.    # 
-0001b570: 7465 7374 2074 6861 7420 4465 6e73 6541  test that DenseA
-0001b580: 7272 6179 2061 6e64 2056 6965 7720 6361  rray and View ca
-0001b590: 6e20 6265 2070 6963 6b6c 6564 2066 6f72  n be pickled for
-0001b5a0: 206d 756c 7469 7072 6f63 6573 7320 7573   multiprocess us
-0001b5b0: 650a 2020 2020 2320 6e6f 7465 2074 6861  e.    # note tha
-0001b5c0: 7420 7468 6520 6375 7272 656e 7420 7069  t the current pi
-0001b5d0: 636b 6c69 6e67 2069 7320 6279 2055 5249  ckling is by URI
-0001b5e0: 2061 6e64 2061 7474 7269 6275 7465 7320   and attributes 
-0001b5f0: 2869 7420 6973 0a20 2020 2023 2020 2020  (it is.    #    
-0001b600: 206e 6f74 2c20 616e 6420 6c69 6b65 6c79   not, and likely
-0001b610: 2073 686f 756c 6420 6e6f 7420 6265 2c20   should not be, 
-0001b620: 6120 7761 7920 746f 2073 6572 6961 6c69  a way to seriali
-0001b630: 7a65 2061 7272 6179 2064 6174 6129 0a0a  ze array data)..
-0001b640: 2020 2020 4070 7974 6573 742e 6d61 726b      @pytest.mark
-0001b650: 2e70 6172 616d 6574 7269 7a65 2822 7370  .parametrize("sp
-0001b660: 6172 7365 222c 205b 5472 7565 2c20 4661  arse", [True, Fa
-0001b670: 6c73 655d 290a 2020 2020 6465 6620 7465  lse]).    def te
-0001b680: 7374 5f70 6963 6b6c 655f 726f 756e 6474  st_pickle_roundt
-0001b690: 7269 7028 7365 6c66 2c20 7370 6172 7365  rip(self, sparse
-0001b6a0: 293a 0a20 2020 2020 2020 2075 7269 203d  ):.        uri =
-0001b6b0: 2073 656c 662e 7061 7468 2822 7465 7374   self.path("test
-0001b6c0: 5f70 6963 6b6c 655f 726f 756e 6474 7269  _pickle_roundtri
-0001b6d0: 7022 290a 2020 2020 2020 2020 646f 6d20  p").        dom 
-0001b6e0: 3d20 7469 6c65 6462 2e44 6f6d 6169 6e28  = tiledb.Domain(
-0001b6f0: 7469 6c65 6462 2e44 696d 2864 6f6d 6169  tiledb.Dim(domai
-0001b700: 6e3d 2830 2c20 3229 2c20 7469 6c65 3d33  n=(0, 2), tile=3
-0001b710: 2929 0a20 2020 2020 2020 2073 6368 656d  )).        schem
-0001b720: 6120 3d20 7469 6c65 6462 2e41 7272 6179  a = tiledb.Array
-0001b730: 5363 6865 6d61 2864 6f6d 6169 6e3d 646f  Schema(domain=do
-0001b740: 6d2c 2061 7474 7273 3d28 7469 6c65 6462  m, attrs=(tiledb
-0001b750: 2e41 7474 7228 2222 292c 292c 2073 7061  .Attr(""),), spa
-0001b760: 7273 653d 7370 6172 7365 290a 2020 2020  rse=sparse).    
-0001b770: 2020 2020 7469 6c65 6462 2e6c 6962 7469      tiledb.libti
-0001b780: 6c65 6462 2e41 7272 6179 2e63 7265 6174  ledb.Array.creat
-0001b790: 6528 7572 692c 2073 6368 656d 6129 0a0a  e(uri, schema)..
-0001b7a0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
-0001b7b0: 6564 622e 6f70 656e 2875 7269 2c20 2277  edb.open(uri, "w
-0001b7c0: 2229 2061 7320 543a 0a20 2020 2020 2020  ") as T:.       
-0001b7d0: 2020 2020 2069 6620 7370 6172 7365 3a0a       if sparse:.
-0001b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b7f0: 545b 5b30 2c20 312c 2032 5d5d 203d 206e  T[[0, 1, 2]] = n
-0001b800: 702e 7261 6e64 6f6d 2e72 616e 6469 6e74  p.random.randint
-0001b810: 2831 302c 2073 697a 653d 3329 0a20 2020  (10, size=3).   
-0001b820: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001b830: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-0001b840: 5b3a 5d20 3d20 6e70 2e72 616e 646f 6d2e  [:] = np.random.
-0001b850: 7261 6e64 696e 7428 3130 2c20 7369 7a65  randint(10, size
-0001b860: 3d33 290a 0a20 2020 2020 2020 2077 6974  =3)..        wit
-0001b870: 6820 7469 6c65 6462 2e6f 7065 6e28 7572  h tiledb.open(ur
-0001b880: 692c 2022 7222 2920 6173 2054 3a0a 2020  i, "r") as T:.  
-0001b890: 2020 2020 2020 2020 2020 7769 7468 2069            with i
-0001b8a0: 6f2e 4279 7465 7349 4f28 2920 6173 2062  o.BytesIO() as b
-0001b8b0: 7566 3a0a 2020 2020 2020 2020 2020 2020  uf:.            
-0001b8c0: 2020 2020 7069 636b 6c65 2e64 756d 7028      pickle.dump(
-0001b8d0: 542c 2062 7566 290a 2020 2020 2020 2020  T, buf).        
-0001b8e0: 2020 2020 2020 2020 6275 662e 7365 656b          buf.seek
-0001b8f0: 2830 290a 2020 2020 2020 2020 2020 2020  (0).            
-0001b900: 2020 2020 7769 7468 2070 6963 6b6c 652e      with pickle.
-0001b910: 6c6f 6164 2862 7566 2920 6173 2054 323a  load(buf) as T2:
-0001b920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b930: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-0001b940: 795f 6571 7561 6c28 542e 6466 5b3a 5d2c  y_equal(T.df[:],
-0001b950: 2054 322e 6466 5b3a 5d29 0a0a 2020 2020   T2.df[:])..    
-0001b960: 2020 2020 2020 2020 7769 7468 2069 6f2e          with io.
-0001b970: 4279 7465 7349 4f28 2920 6173 2062 7566  BytesIO() as buf
-0001b980: 2c20 7469 6c65 6462 2e6f 7065 6e28 7572  , tiledb.open(ur
-0001b990: 6929 2061 7320 563a 0a20 2020 2020 2020  i) as V:.       
-0001b9a0: 2020 2020 2020 2020 2070 6963 6b6c 652e           pickle.
-0001b9b0: 6475 6d70 2856 2c20 6275 6629 0a20 2020  dump(V, buf).   
-0001b9c0: 2020 2020 2020 2020 2020 2020 2062 7566               buf
-0001b9d0: 2e73 6565 6b28 3029 0a20 2020 2020 2020  .seek(0).       
-0001b9e0: 2020 2020 2020 2020 2077 6974 6820 7069           with pi
-0001b9f0: 636b 6c65 2e6c 6f61 6428 6275 6629 2061  ckle.load(buf) a
-0001ba00: 7320 5632 3a0a 2020 2020 2020 2020 2020  s V2:.          
-0001ba10: 2020 2020 2020 2020 2020 2320 6d61 6b65            # make
-0001ba20: 2073 7572 6520 616e 6f6e 796d 6f75 7320   sure anonymous 
-0001ba30: 7669 6577 2070 6963 6b6c 6573 2061 6e64  view pickles and
-0001ba40: 2072 6f75 6e64 2d74 7269 7073 0a20 2020   round-trips.   
-0001ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba60: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-0001ba70: 7561 6c28 562e 6466 5b3a 5d2c 2056 322e  ual(V.df[:], V2.
-0001ba80: 6466 5b3a 5d29 0a0a 2020 2020 4074 696c  df[:])..    @til
-0001ba90: 6564 622e 7363 6f70 655f 6374 7828 7b22  edb.scope_ctx({"
-0001baa0: 7666 732e 7333 2e72 6567 696f 6e22 3a20  vfs.s3.region": 
-0001bab0: 226b 7579 7065 722d 6265 6c74 2d31 222c  "kuyper-belt-1",
-0001bac0: 2022 7666 732e 6d61 785f 7061 7261 6c6c   "vfs.max_parall
-0001bad0: 656c 5f6f 7073 223a 2022 3122 7d29 0a20  el_ops": "1"}). 
-0001bae0: 2020 2064 6566 2074 6573 745f 7069 636b     def test_pick
-0001baf0: 6c65 5f77 6974 685f 636f 6e66 6967 2873  le_with_config(s
-0001bb00: 656c 6629 3a0a 2020 2020 2020 2020 7572  elf):.        ur
-0001bb10: 6920 3d20 7365 6c66 2e70 6174 6828 2270  i = self.path("p
-0001bb20: 6963 6b6c 655f 636f 6e66 6967 2229 0a20  ickle_config"). 
-0001bb30: 2020 2020 2020 2054 203d 2074 696c 6564         T = tiled
-0001bb40: 622e 4465 6e73 6541 7272 6179 2e66 726f  b.DenseArray.fro
-0001bb50: 6d5f 6e75 6d70 7928 7572 692c 206e 702e  m_numpy(uri, np.
-0001bb60: 7261 6e64 6f6d 2e72 616e 6428 332c 2033  random.rand(3, 3
-0001bb70: 2929 0a0a 2020 2020 2020 2020 7769 7468  ))..        with
-0001bb80: 2069 6f2e 4279 7465 7349 4f28 2920 6173   io.BytesIO() as
-0001bb90: 2062 7566 3a0a 2020 2020 2020 2020 2020   buf:.          
-0001bba0: 2020 7069 636b 6c65 2e64 756d 7028 542c    pickle.dump(T,
-0001bbb0: 2062 7566 290a 2020 2020 2020 2020 2020   buf).          
-0001bbc0: 2020 6275 662e 7365 656b 2830 290a 2020    buf.seek(0).  
-0001bbd0: 2020 2020 2020 2020 2020 5432 203d 2070            T2 = p
-0001bbe0: 6963 6b6c 652e 6c6f 6164 2862 7566 290a  ickle.load(buf).
-0001bbf0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-0001bc00: 7274 5f61 7272 6179 5f65 7175 616c 2854  rt_array_equal(T
-0001bc10: 2c20 5432 290a 2020 2020 2020 2020 2020  , T2).          
-0001bc20: 2020 7365 6c66 2e6d 6178 4469 6666 203d    self.maxDiff =
-0001bc30: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-0001bc40: 2020 6431 203d 2074 696c 6564 622e 6465    d1 = tiledb.de
-0001bc50: 6661 756c 745f 6374 7828 292e 636f 6e66  fault_ctx().conf
-0001bc60: 6967 2829 2e64 6963 7428 290a 2020 2020  ig().dict().    
-0001bc70: 2020 2020 2020 2020 6432 203d 2054 322e          d2 = T2.
-0001bc80: 5f63 7478 5f28 292e 636f 6e66 6967 2829  _ctx_().config()
-0001bc90: 2e64 6963 7428 290a 2020 2020 2020 2020  .dict().        
-0001bca0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0001bcb0: 7175 616c 2864 315b 2276 6673 2e73 332e  qual(d1["vfs.s3.
-0001bcc0: 7265 6769 6f6e 225d 2c20 6432 5b22 7666  region"], d2["vf
-0001bcd0: 732e 7333 2e72 6567 696f 6e22 5d29 0a20  s.s3.region"]). 
-0001bce0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001bcf0: 6173 7365 7274 4571 7561 6c28 6431 5b22  assertEqual(d1["
-0001bd00: 7666 732e 6d61 785f 7061 7261 6c6c 656c  vfs.max_parallel
-0001bd10: 5f6f 7073 225d 2c20 6432 5b22 7666 732e  _ops"], d2["vfs.
-0001bd20: 6d61 785f 7061 7261 6c6c 656c 5f6f 7073  max_parallel_ops
-0001bd30: 225d 290a 2020 2020 2020 2020 542e 636c  "]).        T.cl
-0001bd40: 6f73 6528 290a 2020 2020 2020 2020 5432  ose().        T2
-0001bd50: 2e63 6c6f 7365 2829 0a0a 2020 2020 4070  .close()..    @p
-0001bd60: 7974 6573 742e 6d61 726b 2e70 6172 616d  ytest.mark.param
-0001bd70: 6574 7269 7a65 2822 7370 6172 7365 222c  etrize("sparse",
-0001bd80: 205b 5472 7565 2c20 4661 6c73 655d 290a   [True, False]).
-0001bd90: 2020 2020 6465 6620 7465 7374 5f70 6963      def test_pic
-0001bda0: 6b6c 655f 7769 7468 5f74 7570 6c65 5f74  kle_with_tuple_t
-0001bdb0: 696d 6573 7461 6d70 7328 7365 6c66 2c20  imestamps(self, 
-0001bdc0: 7370 6172 7365 293a 0a20 2020 2020 2020  sparse):.       
-0001bdd0: 2041 203d 206e 702e 7261 6e64 6f6d 2e72   A = np.random.r
-0001bde0: 616e 6469 6e74 2831 302c 2073 697a 653d  andint(10, size=
-0001bdf0: 3329 0a20 2020 2020 2020 2070 6174 6820  3).        path 
-0001be00: 3d20 7365 6c66 2e70 6174 6828 2274 6573  = self.path("tes
-0001be10: 745f 7069 636b 6c65 5f77 6974 685f 7475  t_pickle_with_tu
-0001be20: 706c 655f 7469 6d65 7374 616d 7073 2229  ple_timestamps")
-0001be30: 0a0a 2020 2020 2020 2020 646f 6d20 3d20  ..        dom = 
-0001be40: 7469 6c65 6462 2e44 6f6d 6169 6e28 7469  tiledb.Domain(ti
-0001be50: 6c65 6462 2e44 696d 2864 6f6d 6169 6e3d  ledb.Dim(domain=
-0001be60: 2830 2c20 3229 2c20 7469 6c65 3d33 2c20  (0, 2), tile=3, 
-0001be70: 6474 7970 653d 6e70 2e69 6e74 3634 2929  dtype=np.int64))
-0001be80: 0a20 2020 2020 2020 2061 7474 203d 2074  .        att = t
-0001be90: 696c 6564 622e 4174 7472 2864 7479 7065  iledb.Attr(dtype
-0001bea0: 3d41 2e64 7479 7065 290a 2020 2020 2020  =A.dtype).      
-0001beb0: 2020 7363 6865 6d61 203d 2074 696c 6564    schema = tiled
-0001bec0: 622e 4172 7261 7953 6368 656d 6128 646f  b.ArraySchema(do
-0001bed0: 6d61 696e 3d64 6f6d 2c20 6174 7472 733d  main=dom, attrs=
-0001bee0: 2861 7474 2c29 2c20 7370 6172 7365 3d73  (att,), sparse=s
-0001bef0: 7061 7273 6529 0a20 2020 2020 2020 2074  parse).        t
-0001bf00: 696c 6564 622e 6c69 6274 696c 6564 622e  iledb.libtiledb.
-0001bf10: 4172 7261 792e 6372 6561 7465 2870 6174  Array.create(pat
-0001bf20: 682c 2073 6368 656d 6129 0a0a 2020 2020  h, schema)..    
-0001bf30: 2020 2020 666f 7220 7473 2069 6e20 7261      for ts in ra
-0001bf40: 6e67 6528 312c 2035 293a 0a20 2020 2020  nge(1, 5):.     
-0001bf50: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
-0001bf60: 6462 2e6f 7065 6e28 7061 7468 2c20 7469  db.open(path, ti
-0001bf70: 6d65 7374 616d 703d 7473 2c20 6d6f 6465  mestamp=ts, mode
-0001bf80: 3d22 7722 2920 6173 2054 3a0a 2020 2020  ="w") as T:.    
-0001bf90: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0001bfa0: 7061 7273 653a 0a20 2020 2020 2020 2020  parse:.         
-0001bfb0: 2020 2020 2020 2020 2020 2054 5b5b 302c             T[[0,
-0001bfc0: 2031 2c20 325d 5d20 3d20 4120 2a20 7473   1, 2]] = A * ts
-0001bfd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bfe0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001bff0: 2020 2020 2020 2020 2020 2054 5b3a 5d20             T[:] 
-0001c000: 3d20 4120 2a20 7473 0a0a 2020 2020 2020  = A * ts..      
-0001c010: 2020 7769 7468 2074 696c 6564 622e 6f70    with tiledb.op
-0001c020: 656e 2870 6174 682c 2074 696d 6573 7461  en(path, timesta
-0001c030: 6d70 3d28 322c 2033 292c 206d 6f64 653d  mp=(2, 3), mode=
-0001c040: 2272 2229 2061 7320 543a 0a20 2020 2020  "r") as T:.     
-0001c050: 2020 2020 2020 2077 6974 6820 696f 2e42         with io.B
-0001c060: 7974 6573 494f 2829 2061 7320 6275 663a  ytesIO() as buf:
-0001c070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c080: 2070 6963 6b6c 652e 6475 6d70 2854 2c20   pickle.dump(T, 
-0001c090: 6275 6629 0a20 2020 2020 2020 2020 2020  buf).           
-0001c0a0: 2020 2020 2062 7566 2e73 6565 6b28 3029       buf.seek(0)
-0001c0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c0c0: 2077 6974 6820 7069 636b 6c65 2e6c 6f61   with pickle.loa
-0001c0d0: 6428 6275 6629 2061 7320 5432 3a0a 2020  d(buf) as T2:.  
-0001c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0f0: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-0001c100: 7175 616c 2854 2e64 665b 3a5d 2c20 5432  qual(T.df[:], T2
-0001c110: 2e64 665b 3a5d 290a 2020 2020 2020 2020  .df[:]).        
-0001c120: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-0001c130: 7274 2054 322e 7469 6d65 7374 616d 705f  rt T2.timestamp_
-0001c140: 7261 6e67 6520 3d3d 2028 322c 2033 290a  range == (2, 3).
-0001c150: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-0001c160: 6820 696f 2e42 7974 6573 494f 2829 2061  h io.BytesIO() a
-0001c170: 7320 6275 662c 2074 696c 6564 622e 6f70  s buf, tiledb.op
-0001c180: 656e 2870 6174 682c 2074 696d 6573 7461  en(path, timesta
-0001c190: 6d70 3d28 322c 2033 2929 2061 7320 563a  mp=(2, 3)) as V:
-0001c1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c1b0: 2070 6963 6b6c 652e 6475 6d70 2856 2c20   pickle.dump(V, 
-0001c1c0: 6275 6629 0a20 2020 2020 2020 2020 2020  buf).           
-0001c1d0: 2020 2020 2062 7566 2e73 6565 6b28 3029       buf.seek(0)
-0001c1e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c1f0: 2077 6974 6820 7069 636b 6c65 2e6c 6f61   with pickle.loa
-0001c200: 6428 6275 6629 2061 7320 5632 3a0a 2020  d(buf) as V2:.  
-0001c210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c220: 2020 2320 6d61 6b65 2073 7572 6520 616e    # make sure an
-0001c230: 6f6e 796d 6f75 7320 7669 6577 2070 6963  onymous view pic
-0001c240: 6b6c 6573 2061 6e64 2072 6f75 6e64 2d74  kles and round-t
-0001c250: 7269 7073 0a20 2020 2020 2020 2020 2020  rips.           
-0001c260: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
-0001c270: 6172 7261 795f 6571 7561 6c28 562e 6466  array_equal(V.df
-0001c280: 5b3a 5d2c 2056 322e 6466 5b3a 5d29 0a20  [:], V2.df[:]). 
-0001c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2a0: 2020 2061 7373 6572 7420 5632 2e74 696d     assert V2.tim
-0001c2b0: 6573 7461 6d70 5f72 616e 6765 203d 3d20  estamp_range == 
-0001c2c0: 2832 2c20 3329 0a0a 0a63 6c61 7373 2041  (2, 3)...class A
-0001c2d0: 7272 6179 5669 6577 5465 7374 2844 6973  rrayViewTest(Dis
-0001c2e0: 6b54 6573 7443 6173 6529 3a0a 2020 2020  kTestCase):.    
-0001c2f0: 6465 6620 7465 7374 5f76 6965 775f 6d75  def test_view_mu
-0001c300: 6c74 6961 7474 7228 7365 6c66 293a 0a20  ltiattr(self):. 
-0001c310: 2020 2020 2020 2075 7269 203d 2073 656c         uri = sel
-0001c320: 662e 7061 7468 2822 666f 6f5f 6d75 6c74  f.path("foo_mult
-0001c330: 6961 7474 7222 290a 2020 2020 2020 2020  iattr").        
-0001c340: 646f 6d20 3d20 7469 6c65 6462 2e44 6f6d  dom = tiledb.Dom
-0001c350: 6169 6e28 0a20 2020 2020 2020 2020 2020  ain(.           
-0001c360: 2074 696c 6564 622e 4469 6d28 646f 6d61   tiledb.Dim(doma
-0001c370: 696e 3d28 302c 2032 292c 2074 696c 653d  in=(0, 2), tile=
-0001c380: 3329 2c20 7469 6c65 6462 2e44 696d 2864  3), tiledb.Dim(d
-0001c390: 6f6d 6169 6e3d 2830 2c20 3229 2c20 7469  omain=(0, 2), ti
-0001c3a0: 6c65 3d33 290a 2020 2020 2020 2020 290a  le=3).        ).
-0001c3b0: 2020 2020 2020 2020 7363 6865 6d61 203d          schema =
-0001c3c0: 2074 696c 6564 622e 4172 7261 7953 6368   tiledb.ArraySch
-0001c3d0: 656d 6128 0a20 2020 2020 2020 2020 2020  ema(.           
-0001c3e0: 2064 6f6d 6169 6e3d 646f 6d2c 2061 7474   domain=dom, att
-0001c3f0: 7273 3d28 7469 6c65 6462 2e41 7474 7228  rs=(tiledb.Attr(
-0001c400: 2222 292c 2074 696c 6564 622e 4174 7472  ""), tiledb.Attr
-0001c410: 2822 6e61 6d65 6422 2929 0a20 2020 2020  ("named")).     
-0001c420: 2020 2029 0a20 2020 2020 2020 2074 696c     ).        til
-0001c430: 6564 622e 6c69 6274 696c 6564 622e 4172  edb.libtiledb.Ar
-0001c440: 7261 792e 6372 6561 7465 2875 7269 2c20  ray.create(uri, 
-0001c450: 7363 6865 6d61 290a 0a20 2020 2020 2020  schema)..       
-0001c460: 2061 6e6f 6e5f 6172 203d 206e 702e 7261   anon_ar = np.ra
-0001c470: 6e64 6f6d 2e72 616e 6428 332c 2033 290a  ndom.rand(3, 3).
-0001c480: 2020 2020 2020 2020 6e61 6d65 645f 6172          named_ar
-0001c490: 203d 206e 702e 7261 6e64 6f6d 2e72 616e   = np.random.ran
-0001c4a0: 6428 332c 2033 290a 0a20 2020 2020 2020  d(3, 3)..       
-0001c4b0: 2077 6974 6820 7469 6c65 6462 2e44 656e   with tiledb.Den
-0001c4c0: 7365 4172 7261 7928 7572 692c 2022 7722  seArray(uri, "w"
-0001c4d0: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
-0001c4e0: 2020 2020 545b 3a5d 203d 207b 2222 3a20      T[:] = {"": 
-0001c4f0: 616e 6f6e 5f61 722c 2022 6e61 6d65 6422  anon_ar, "named"
-0001c500: 3a20 6e61 6d65 645f 6172 7d0a 0a20 2020  : named_ar}..   
-0001c510: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
-0001c520: 7373 6572 7452 6169 7365 7328 4b65 7945  ssertRaises(KeyE
-0001c530: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
-0001c540: 2020 2054 203d 2074 696c 6564 622e 4465     T = tiledb.De
-0001c550: 6e73 6541 7272 6179 2875 7269 2c20 2272  nseArray(uri, "r
-0001c560: 222c 2061 7474 723d 2266 6f6f 3131 3122  ", attr="foo111"
-0001c570: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
-0001c580: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-0001c590: 7928 7572 692c 2022 7222 2c20 6174 7472  y(uri, "r", attr
-0001c5a0: 3d22 6e61 6d65 6422 2920 6173 2054 3a0a  ="named") as T:.
-0001c5b0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-0001c5c0: 7274 5f61 7272 6179 5f65 7175 616c 2854  rt_array_equal(T
-0001c5d0: 2c20 6e61 6d65 645f 6172 290a 2020 2020  , named_ar).    
-0001c5e0: 2020 2020 2020 2020 2320 6d61 6b65 2073          # make s
-0001c5f0: 7572 6520 6561 6368 2061 7474 7220 7669  ure each attr vi
-0001c600: 6577 2063 616e 2070 6963 6b6c 6520 616e  ew can pickle an
-0001c610: 6420 726f 756e 642d 7472 6970 0a20 2020  d round-trip.   
-0001c620: 2020 2020 2020 2020 2077 6974 6820 696f           with io
-0001c630: 2e42 7974 6573 494f 2829 2061 7320 6275  .BytesIO() as bu
-0001c640: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-0001c650: 2020 2070 6963 6b6c 652e 6475 6d70 2854     pickle.dump(T
-0001c660: 2c20 6275 6629 0a20 2020 2020 2020 2020  , buf).         
-0001c670: 2020 2020 2020 2062 7566 2e73 6565 6b28         buf.seek(
-0001c680: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-0001c690: 2020 2077 6974 6820 7069 636b 6c65 2e6c     with pickle.l
-0001c6a0: 6f61 6428 6275 6629 2061 7320 545f 7274  oad(buf) as T_rt
-0001c6b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c6c0: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
-0001c6d0: 6179 5f65 7175 616c 2854 2c20 545f 7274  ay_equal(T, T_rt
-0001c6e0: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
-0001c6f0: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-0001c700: 7928 7572 692c 2022 7222 2c20 6174 7472  y(uri, "r", attr
-0001c710: 3d22 2229 2061 7320 543a 0a20 2020 2020  ="") as T:.     
-0001c720: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-0001c730: 7261 795f 6571 7561 6c28 542c 2061 6e6f  ray_equal(T, ano
-0001c740: 6e5f 6172 290a 0a20 2020 2020 2020 2020  n_ar)..         
-0001c750: 2020 2077 6974 6820 696f 2e42 7974 6573     with io.Bytes
-0001c760: 494f 2829 2061 7320 6275 663a 0a20 2020  IO() as buf:.   
-0001c770: 2020 2020 2020 2020 2020 2020 2070 6963               pic
-0001c780: 6b6c 652e 6475 6d70 2854 2c20 6275 6629  kle.dump(T, buf)
-0001c790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c7a0: 2062 7566 2e73 6565 6b28 3029 0a20 2020   buf.seek(0).   
-0001c7b0: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-0001c7c0: 6820 7069 636b 6c65 2e6c 6f61 6428 6275  h pickle.load(bu
-0001c7d0: 6629 2061 7320 746d 703a 0a20 2020 2020  f) as tmp:.     
-0001c7e0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0001c7f0: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
-0001c800: 6c28 746d 702c 2061 6e6f 6e5f 6172 290a  l(tmp, anon_ar).
-0001c810: 0a20 2020 2020 2020 2023 2073 6574 2073  .        # set s
-0001c820: 7562 6172 7261 7920 6f6e 206d 756c 7469  ubarray on multi
-0001c830: 2d61 7474 7269 6275 7465 0a20 2020 2020  -attribute.     
-0001c840: 2020 2072 616e 6765 5f61 7220 3d20 6e70     range_ar = np
-0001c850: 2e61 7261 6e67 6528 302c 2039 292e 7265  .arange(0, 9).re
-0001c860: 7368 6170 6528 332c 2033 290a 2020 2020  shape(3, 3).    
-0001c870: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
-0001c880: 4465 6e73 6541 7272 6179 2875 7269 2c20  DenseArray(uri, 
-0001c890: 2277 222c 2061 7474 723d 226e 616d 6564  "w", attr="named
-0001c8a0: 2229 2061 7320 565f 6e61 6d65 643a 0a20  ") as V_named:. 
-0001c8b0: 2020 2020 2020 2020 2020 2056 5f6e 616d             V_nam
-0001c8c0: 6564 5b31 3a33 2c20 313a 335d 203d 2072  ed[1:3, 1:3] = r
-0001c8d0: 616e 6765 5f61 725b 313a 332c 2031 3a33  ange_ar[1:3, 1:3
-0001c8e0: 5d0a 0a20 2020 2020 2020 2077 6974 6820  ]..        with 
-0001c8f0: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-0001c900: 7928 7572 692c 2022 7222 2c20 6174 7472  y(uri, "r", attr
-0001c910: 3d22 6e61 6d65 6422 2920 6173 2056 5f6e  ="named") as V_n
-0001c920: 616d 6564 3a0a 2020 2020 2020 2020 2020  amed:.          
-0001c930: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-0001c940: 7175 616c 2856 5f6e 616d 6564 5b31 3a33  qual(V_named[1:3
-0001c950: 2c20 313a 335d 2c20 7261 6e67 655f 6172  , 1:3], range_ar
-0001c960: 5b31 3a33 2c20 313a 335d 290a 0a0a 636c  [1:3, 1:3])...cl
-0001c970: 6173 7320 5257 5465 7374 2844 6973 6b54  ass RWTest(DiskT
-0001c980: 6573 7443 6173 6529 3a0a 2020 2020 6465  estCase):.    de
-0001c990: 6620 7465 7374 5f72 6561 645f 7772 6974  f test_read_writ
-0001c9a0: 6528 7365 6c66 2c20 6361 7066 6429 3a0a  e(self, capfd):.
-0001c9b0: 2020 2020 2020 2020 646f 6d20 3d20 7469          dom = ti
-0001c9c0: 6c65 6462 2e44 6f6d 6169 6e28 7469 6c65  ledb.Domain(tile
-0001c9d0: 6462 2e44 696d 2864 6f6d 6169 6e3d 2830  db.Dim(domain=(0
-0001c9e0: 2c20 3229 2c20 7469 6c65 3d33 2929 0a20  , 2), tile=3)). 
-0001c9f0: 2020 2020 2020 2061 7474 203d 2074 696c         att = til
-0001ca00: 6564 622e 4174 7472 2864 7479 7065 3d22  edb.Attr(dtype="
-0001ca10: 696e 7436 3422 290a 2020 2020 2020 2020  int64").        
-0001ca20: 7363 6865 6d61 203d 2074 696c 6564 622e  schema = tiledb.
-0001ca30: 4172 7261 7953 6368 656d 6128 646f 6d61  ArraySchema(doma
-0001ca40: 696e 3d64 6f6d 2c20 6174 7472 733d 2861  in=dom, attrs=(a
-0001ca50: 7474 2c29 290a 2020 2020 2020 2020 7469  tt,)).        ti
-0001ca60: 6c65 6462 2e6c 6962 7469 6c65 6462 2e41  ledb.libtiledb.A
-0001ca70: 7272 6179 2e63 7265 6174 6528 7365 6c66  rray.create(self
-0001ca80: 2e70 6174 6828 2266 6f6f 2229 2c20 7363  .path("foo"), sc
-0001ca90: 6865 6d61 290a 0a20 2020 2020 2020 206e  hema)..        n
-0001caa0: 705f 6172 7261 7920 3d20 6e70 2e61 7272  p_array = np.arr
-0001cab0: 6179 285b 312c 2032 2c20 335d 2c20 6474  ay([1, 2, 3], dt
-0001cac0: 7970 653d 2269 6e74 3634 2229 0a0a 2020  ype="int64")..  
-0001cad0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-0001cae0: 622e 4465 6e73 6541 7272 6179 2873 656c  b.DenseArray(sel
-0001caf0: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
-0001cb00: 6f64 653d 2277 2229 2061 7320 6172 723a  ode="w") as arr:
-0001cb10: 0a20 2020 2020 2020 2020 2020 2061 7272  .            arr
-0001cb20: 2e77 7269 7465 5f64 6972 6563 7428 6e70  .write_direct(np
-0001cb30: 5f61 7272 6179 290a 0a20 2020 2020 2020  _array)..       
-0001cb40: 2077 6974 6820 7469 6c65 6462 2e44 656e   with tiledb.Den
-0001cb50: 7365 4172 7261 7928 7365 6c66 2e70 6174  seArray(self.pat
-0001cb60: 6828 2266 6f6f 2229 2c20 6d6f 6465 3d22  h("foo"), mode="
-0001cb70: 7222 2920 6173 2061 7272 3a0a 2020 2020  r") as arr:.    
-0001cb80: 2020 2020 2020 2020 6172 722e 6475 6d70          arr.dump
-0001cb90: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-0001cba0: 6173 7365 7274 5f63 6170 7475 7265 6428  assert_captured(
-0001cbb0: 6361 7066 642c 2022 4172 7261 7920 7479  capfd, "Array ty
-0001cbc0: 7065 3a20 6465 6e73 6522 290a 2020 2020  pe: dense").    
-0001cbd0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0001cbe0: 6572 7445 7175 616c 2861 7272 2e6e 6f6e  ertEqual(arr.non
-0001cbf0: 656d 7074 795f 646f 6d61 696e 2829 2c20  empty_domain(), 
-0001cc00: 2828 302c 2032 292c 2929 0a20 2020 2020  ((0, 2),)).     
-0001cc10: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0001cc20: 7274 4571 7561 6c28 6172 722e 6e64 696d  rtEqual(arr.ndim
-0001cc30: 2c20 6e70 5f61 7272 6179 2e6e 6469 6d29  , np_array.ndim)
-0001cc40: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-0001cc50: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
-0001cc60: 6172 722e 7265 6164 5f64 6972 6563 7428  arr.read_direct(
-0001cc70: 292c 206e 705f 6172 7261 7929 0a0a 0a63  ), np_array)...c
-0001cc80: 6c61 7373 2054 6573 744e 756d 7079 546f  lass TestNumpyTo
-0001cc90: 4172 7261 7928 4469 736b 5465 7374 4361  Array(DiskTestCa
-0001cca0: 7365 293a 0a20 2020 2064 6566 2074 6573  se):.    def tes
-0001ccb0: 745f 746f 5f61 7272 6179 3064 2873 656c  t_to_array0d(sel
-0001ccc0: 6629 3a0a 2020 2020 2020 2020 2320 4361  f):.        # Ca
-0001ccd0: 6e6e 6f74 2063 7265 6174 6520 302d 6469  nnot create 0-di
-0001cce0: 6d20 6172 7261 7973 2069 6e20 5469 6c65  m arrays in Tile
-0001ccf0: 4442 0a20 2020 2020 2020 206e 705f 6172  DB.        np_ar
-0001cd00: 7261 7920 3d20 6e70 2e61 7272 6179 2831  ray = np.array(1
-0001cd10: 290a 2020 2020 2020 2020 7769 7468 2073  ).        with s
-0001cd20: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-0001cd30: 2874 696c 6564 622e 5469 6c65 4442 4572  (tiledb.TileDBEr
-0001cd40: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
-0001cd50: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
-0001cd60: 6e73 6541 7272 6179 2e66 726f 6d5f 6e75  nseArray.from_nu
-0001cd70: 6d70 7928 7365 6c66 2e70 6174 6828 2266  mpy(self.path("f
-0001cd80: 6f6f 2229 2c20 6e70 5f61 7272 6179 2920  oo"), np_array) 
-0001cd90: 6173 2041 3a0a 2020 2020 2020 2020 2020  as A:.          
-0001cda0: 2020 2020 2020 7061 7373 0a0a 2020 2020        pass..    
-0001cdb0: 6465 6620 7465 7374 5f74 6f5f 6172 7261  def test_to_arra
-0001cdc0: 7931 6428 7365 6c66 293a 0a20 2020 2020  y1d(self):.     
-0001cdd0: 2020 206e 705f 6172 7261 7920 3d20 6e70     np_array = np
-0001cde0: 2e61 7272 6179 285b 312e 302c 2032 2e30  .array([1.0, 2.0
-0001cdf0: 2c20 332e 305d 290a 2020 2020 2020 2020  , 3.0]).        
-0001ce00: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
-0001ce10: 6541 7272 6179 2e66 726f 6d5f 6e75 6d70  eArray.from_nump
-0001ce20: 7928 7365 6c66 2e70 6174 6828 2266 6f6f  y(self.path("foo
-0001ce30: 2229 2c20 6e70 5f61 7272 6179 2920 6173  "), np_array) as
-0001ce40: 2061 7272 3a0a 2020 2020 2020 2020 2020   arr:.          
-0001ce50: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-0001ce60: 7175 616c 2861 7272 5b3a 5d2c 206e 705f  qual(arr[:], np_
-0001ce70: 6172 7261 7929 0a0a 2020 2020 6465 6620  array)..    def 
-0001ce80: 7465 7374 5f74 6f5f 6172 7261 7932 6428  test_to_array2d(
-0001ce90: 7365 6c66 293a 0a20 2020 2020 2020 206e  self):.        n
-0001cea0: 705f 6172 7261 7920 3d20 6e70 2e6f 6e65  p_array = np.one
-0001ceb0: 7328 2831 3030 2c20 3130 3029 2c20 6474  s((100, 100), dt
-0001cec0: 7970 653d 2269 3822 290a 2020 2020 2020  ype="i8").      
-0001ced0: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
-0001cee0: 6e73 6541 7272 6179 2e66 726f 6d5f 6e75  nseArray.from_nu
-0001cef0: 6d70 7928 7365 6c66 2e70 6174 6828 2266  mpy(self.path("f
-0001cf00: 6f6f 2229 2c20 6e70 5f61 7272 6179 2920  oo"), np_array) 
-0001cf10: 6173 2061 7272 3a0a 2020 2020 2020 2020  as arr:.        
-0001cf20: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
-0001cf30: 5f65 7175 616c 2861 7272 5b3a 5d2c 206e  _equal(arr[:], n
-0001cf40: 705f 6172 7261 7929 0a0a 2020 2020 6465  p_array)..    de
-0001cf50: 6620 7465 7374 5f74 6f5f 6172 7261 7933  f test_to_array3
-0001cf60: 6428 7365 6c66 293a 0a20 2020 2020 2020  d(self):.       
-0001cf70: 206e 705f 6172 7261 7920 3d20 6e70 2e6f   np_array = np.o
-0001cf80: 6e65 7328 2831 2c20 312c 2031 292c 2064  nes((1, 1, 1), d
-0001cf90: 7479 7065 3d22 6931 2229 0a20 2020 2020  type="i1").     
-0001cfa0: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
-0001cfb0: 656e 7365 4172 7261 792e 6672 6f6d 5f6e  enseArray.from_n
-0001cfc0: 756d 7079 2873 656c 662e 7061 7468 2822  umpy(self.path("
-0001cfd0: 666f 6f22 292c 206e 705f 6172 7261 7929  foo"), np_array)
-0001cfe0: 2061 7320 6172 723a 0a20 2020 2020 2020   as arr:.       
-0001cff0: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
-0001d000: 795f 6571 7561 6c28 6172 725b 3a5d 2c20  y_equal(arr[:], 
-0001d010: 6e70 5f61 7272 6179 290a 0a20 2020 2064  np_array)..    d
-0001d020: 6566 2074 6573 745f 6279 7465 735f 746f  ef test_bytes_to
-0001d030: 5f61 7272 6179 3164 2873 656c 6629 3a0a  _array1d(self):.
-0001d040: 2020 2020 2020 2020 6e70 5f61 7272 6179          np_array
-0001d050: 203d 206e 702e 6172 7261 7928 0a20 2020   = np.array(.   
-0001d060: 2020 2020 2020 2020 205b 6222 6162 6364           [b"abcd
-0001d070: 6566 222c 2062 2267 6822 2c20 6222 696a  ef", b"gh", b"ij
-0001d080: 6b6c 222c 2062 226d 6e6f 7071 7273 222c  kl", b"mnopqrs",
-0001d090: 2062 2222 2c20 6222 3132 3334 3534 356c   b"", b"1234545l
-0001d0a0: 6b6a 616c 7364 666a 225d 2c0a 2020 2020  kjalsdfj"],.    
-0001d0b0: 2020 2020 2020 2020 6474 7970 653d 6f62          dtype=ob
-0001d0c0: 6a65 6374 2c0a 2020 2020 2020 2020 290a  ject,.        ).
-0001d0d0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
-0001d0e0: 6564 622e 4465 6e73 6541 7272 6179 2e66  edb.DenseArray.f
-0001d0f0: 726f 6d5f 6e75 6d70 7928 7365 6c66 2e70  rom_numpy(self.p
-0001d100: 6174 6828 2266 6f6f 2229 2c20 6e70 5f61  ath("foo"), np_a
-0001d110: 7272 6179 2920 6173 2061 7272 3a0a 2020  rray) as arr:.  
-0001d120: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-0001d130: 5f61 7272 6179 5f65 7175 616c 2861 7272  _array_equal(arr
-0001d140: 5b3a 5d2c 206e 705f 6172 7261 7929 0a0a  [:], np_array)..
-0001d150: 2020 2020 2020 2020 7769 7468 2074 696c          with til
-0001d160: 6564 622e 4465 6e73 6541 7272 6179 2873  edb.DenseArray(s
-0001d170: 656c 662e 7061 7468 2822 666f 6f22 2929  elf.path("foo"))
-0001d180: 2061 7320 6172 725f 7265 6c6f 6164 3a0a   as arr_reload:.
-0001d190: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-0001d1a0: 7274 5f61 7272 6179 5f65 7175 616c 2861  rt_array_equal(a
-0001d1b0: 7272 5f72 656c 6f61 645b 3a5d 2c20 6e70  rr_reload[:], np
-0001d1c0: 5f61 7272 6179 290a 0a20 2020 2064 6566  _array)..    def
-0001d1d0: 2074 6573 745f 756e 6963 6f64 655f 746f   test_unicode_to
-0001d1e0: 5f61 7272 6179 3164 2873 656c 6629 3a0a  _array1d(self):.
-0001d1f0: 2020 2020 2020 2020 6e70 5f61 7272 6179          np_array
-0001d200: 203d 206e 702e 6172 7261 7928 0a20 2020   = np.array(.   
-0001d210: 2020 2020 2020 2020 205b 0a20 2020 2020           [.     
-0001d220: 2020 2020 2020 2020 2020 2022 3132 3334             "1234
-0001d230: 3534 356c 6b6a 616c 7364 666a 222c 0a20  545lkjalsdfj",. 
-0001d240: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001d250: 6d6e 6f70 7172 7322 2c0a 2020 2020 2020  mnopqrs",.      
-0001d260: 2020 2020 2020 2020 2020 2269 6a6b 6c22            "ijkl"
-0001d270: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001d280: 2020 2267 6822 2c0a 2020 2020 2020 2020    "gh",.        
-0001d290: 2020 2020 2020 2020 2261 6263 6465 6622          "abcdef"
-0001d2a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001d2b0: 2020 2261 ceb1 62ce b2ce b263 ceb3 ceb3    "a..b....c....
-0001d2c0: ceb3 64ce b4ce b4ce b4ce b422 2c0a 2020  ..d........",.  
-0001d2d0: 2020 2020 2020 2020 2020 2020 2020 2222                ""
-0001d2e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001d2f0: 2020 2722 61ce b162 ceb2 ceb2 6327 2c0a    '"a..b....c',.
-0001d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d310: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
-0001d320: 2020 2020 22ce b3ce b3ce b364 ceb4 ceb4      "......d....
-0001d330: ceb4 ceb4 222c 0a20 2020 2020 2020 2020  ....",.         
-0001d340: 2020 205d 2c0a 2020 2020 2020 2020 2020     ],.          
-0001d350: 2020 6474 7970 653d 6f62 6a65 6374 2c0a    dtype=object,.
-0001d360: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001d370: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
-0001d380: 6e73 6541 7272 6179 2e66 726f 6d5f 6e75  nseArray.from_nu
-0001d390: 6d70 7928 7365 6c66 2e70 6174 6828 2266  mpy(self.path("f
-0001d3a0: 6f6f 2229 2c20 6e70 5f61 7272 6179 2920  oo"), np_array) 
-0001d3b0: 6173 2061 7272 3a0a 2020 2020 2020 2020  as arr:.        
-0001d3c0: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
-0001d3d0: 5f65 7175 616c 2861 7272 5b3a 5d2c 206e  _equal(arr[:], n
-0001d3e0: 705f 6172 7261 7929 0a0a 2020 2020 2020  p_array)..      
-0001d3f0: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
-0001d400: 6e73 6541 7272 6179 2873 656c 662e 7061  nseArray(self.pa
-0001d410: 7468 2822 666f 6f22 2929 2061 7320 6172  th("foo")) as ar
-0001d420: 725f 7265 6c6f 6164 3a0a 2020 2020 2020  r_reload:.      
-0001d430: 2020 2020 2020 6173 7365 7274 5f61 7272        assert_arr
-0001d440: 6179 5f65 7175 616c 2861 7272 5f72 656c  ay_equal(arr_rel
-0001d450: 6f61 645b 3a5d 2c20 6e70 5f61 7272 6179  oad[:], np_array
-0001d460: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
-0001d470: 6172 7261 795f 696e 7465 7266 6163 6528  array_interface(
-0001d480: 7365 6c66 293a 0a20 2020 2020 2020 2023  self):.        #
-0001d490: 2054 6573 7473 2074 6861 7420 5f5f 6172   Tests that __ar
-0001d4a0: 7261 795f 5f20 696e 7465 7266 6163 6520  ray__ interface 
-0001d4b0: 776f 726b 730a 2020 2020 2020 2020 6e70  works.        np
-0001d4c0: 5f61 7272 6179 3120 3d20 6e70 2e61 7261  _array1 = np.ara
-0001d4d0: 6e67 6528 312c 2031 3029 0a20 2020 2020  nge(1, 10).     
-0001d4e0: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
-0001d4f0: 656e 7365 4172 7261 792e 6672 6f6d 5f6e  enseArray.from_n
-0001d500: 756d 7079 2873 656c 662e 7061 7468 2822  umpy(self.path("
-0001d510: 6172 7231 2229 2c20 6e70 5f61 7272 6179  arr1"), np_array
-0001d520: 3129 2061 7320 6172 7231 3a0a 2020 2020  1) as arr1:.    
-0001d530: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
-0001d540: 7272 6179 5f65 7175 616c 286e 702e 6172  rray_equal(np.ar
-0001d550: 7261 7928 6172 7231 292c 206e 705f 6172  ray(arr1), np_ar
-0001d560: 7261 7931 290a 0a20 2020 2020 2020 2023  ray1)..        #
-0001d570: 2054 6573 7420 7468 6174 205f 5f61 7272   Test that __arr
-0001d580: 6179 5f5f 2069 6e74 6572 6661 6365 2074  ay__ interface t
-0001d590: 6872 6f77 7320 616e 2065 7272 6f72 2077  hrows an error w
-0001d5a0: 6865 6e20 6e75 6d62 6572 206f 6620 6174  hen number of at
-0001d5b0: 7472 6962 7574 6573 203e 2031 0a20 2020  tributes > 1.   
-0001d5c0: 2020 2020 2064 6f6d 203d 2074 696c 6564       dom = tiled
-0001d5d0: 622e 446f 6d61 696e 2874 696c 6564 622e  b.Domain(tiledb.
-0001d5e0: 4469 6d28 646f 6d61 696e 3d28 302c 2032  Dim(domain=(0, 2
-0001d5f0: 292c 2074 696c 653d 3329 290a 2020 2020  ), tile=3)).    
-0001d600: 2020 2020 666f 6f20 3d20 7469 6c65 6462      foo = tiledb
-0001d610: 2e41 7474 7228 2266 6f6f 222c 2064 7479  .Attr("foo", dty
-0001d620: 7065 3d22 6938 2229 0a20 2020 2020 2020  pe="i8").       
-0001d630: 2062 6172 203d 2074 696c 6564 622e 4174   bar = tiledb.At
-0001d640: 7472 2822 6261 7222 2c20 6474 7970 653d  tr("bar", dtype=
-0001d650: 2269 3822 290a 2020 2020 2020 2020 7363  "i8").        sc
-0001d660: 6865 6d61 203d 2074 696c 6564 622e 4172  hema = tiledb.Ar
-0001d670: 7261 7953 6368 656d 6128 646f 6d61 696e  raySchema(domain
-0001d680: 3d64 6f6d 2c20 6174 7472 733d 2866 6f6f  =dom, attrs=(foo
-0001d690: 2c20 6261 7229 290a 2020 2020 2020 2020  , bar)).        
-0001d6a0: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
-0001d6b0: 792e 6372 6561 7465 2873 656c 662e 7061  y.create(self.pa
-0001d6c0: 7468 2822 6172 7232 2229 2c20 7363 6865  th("arr2"), sche
-0001d6d0: 6d61 290a 2020 2020 2020 2020 7769 7468  ma).        with
-0001d6e0: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-0001d6f0: 6573 2856 616c 7565 4572 726f 7229 3a0a  es(ValueError):.
-0001d700: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0001d710: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
-0001d720: 6179 2873 656c 662e 7061 7468 2822 6172  ay(self.path("ar
-0001d730: 7232 2229 2c20 6d6f 6465 3d22 7222 2920  r2"), mode="r") 
-0001d740: 6173 2061 7272 323a 0a20 2020 2020 2020  as arr2:.       
-0001d750: 2020 2020 2020 2020 206e 702e 6172 7261           np.arra
-0001d760: 7928 6172 7232 290a 0a20 2020 2064 6566  y(arr2)..    def
-0001d770: 2074 6573 745f 6172 7261 795f 6765 7469   test_array_geti
-0001d780: 6e64 6578 2873 656c 6629 3a0a 2020 2020  ndex(self):.    
-0001d790: 2020 2020 2320 5465 7374 7320 7468 6174      # Tests that
-0001d7a0: 205f 5f67 6574 696e 6465 785f 5f20 696e   __getindex__ in
-0001d7b0: 7465 7266 6163 6520 776f 726b 730a 2020  terface works.  
-0001d7c0: 2020 2020 2020 6e70 5f61 7272 6179 203d        np_array =
-0001d7d0: 206e 702e 6172 616e 6765 2831 2c20 3130   np.arange(1, 10
-0001d7e0: 290a 2020 2020 2020 2020 7769 7468 2074  ).        with t
-0001d7f0: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
-0001d800: 2e66 726f 6d5f 6e75 6d70 7928 7365 6c66  .from_numpy(self
-0001d810: 2e70 6174 6828 2266 6f6f 2229 2c20 6e70  .path("foo"), np
-0001d820: 5f61 7272 6179 2920 6173 2061 7272 3a0a  _array) as arr:.
-0001d830: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-0001d840: 7274 5f61 7272 6179 5f65 7175 616c 2861  rt_array_equal(a
-0001d850: 7272 5b35 3a31 305d 2c20 6e70 5f61 7272  rr[5:10], np_arr
-0001d860: 6179 5b35 3a31 305d 290a 0a20 2020 2064  ay[5:10])..    d
-0001d870: 6566 2074 6573 745f 746f 5f61 7272 6179  ef test_to_array
-0001d880: 3164 5f61 7474 725f 6e61 6d65 2873 656c  1d_attr_name(sel
-0001d890: 6629 3a0a 2020 2020 2020 2020 6e70 5f61  f):.        np_a
-0001d8a0: 7272 6179 203d 206e 702e 6172 7261 7928  rray = np.array(
-0001d8b0: 5b31 2e30 2c20 322e 302c 2033 2e30 5d29  [1.0, 2.0, 3.0])
-0001d8c0: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
-0001d8d0: 6c65 6462 2e44 656e 7365 4172 7261 792e  ledb.DenseArray.
-0001d8e0: 6672 6f6d 5f6e 756d 7079 280a 2020 2020  from_numpy(.    
-0001d8f0: 2020 2020 2020 2020 7365 6c66 2e70 6174          self.pat
-0001d900: 6828 2266 6f6f 2229 2c20 6e70 5f61 7272  h("foo"), np_arr
-0001d910: 6179 2c20 6174 7472 5f6e 616d 653d 2261  ay, attr_name="a
-0001d920: 220a 2020 2020 2020 2020 2920 6173 2061  ".        ) as a
-0001d930: 7272 3a0a 2020 2020 2020 2020 2020 2020  rr:.            
-0001d940: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-0001d950: 616c 2861 7272 5b3a 5d5b 2261 225d 2c20  al(arr[:]["a"], 
-0001d960: 6e70 5f61 7272 6179 290a 0a0a 636c 6173  np_array)...clas
-0001d970: 7320 5465 7374 5646 5328 4469 736b 5465  s TestVFS(DiskTe
-0001d980: 7374 4361 7365 293a 0a20 2020 2064 6566  stCase):.    def
-0001d990: 2074 6573 745f 7375 7070 6f72 7473 2873   test_supports(s
-0001d9a0: 656c 6629 3a0a 2020 2020 2020 2020 7666  elf):.        vf
-0001d9b0: 7320 3d20 7469 6c65 6462 2e56 4653 2829  s = tiledb.VFS()
-0001d9c0: 0a0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-0001d9d0: 7373 6572 7454 7275 6528 7666 732e 7375  ssertTrue(vfs.su
-0001d9e0: 7070 6f72 7473 2822 6669 6c65 2229 290a  pports("file")).
-0001d9f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0001da00: 6572 7449 7349 6e73 7461 6e63 6528 7666  ertIsInstance(vf
-0001da10: 732e 7375 7070 6f72 7473 2822 7333 2229  s.supports("s3")
-0001da20: 2c20 626f 6f6c 290a 2020 2020 2020 2020  , bool).        
-0001da30: 7365 6c66 2e61 7373 6572 7449 7349 6e73  self.assertIsIns
-0001da40: 7461 6e63 6528 7666 732e 7375 7070 6f72  tance(vfs.suppor
-0001da50: 7473 2822 6864 6673 2229 2c20 626f 6f6c  ts("hdfs"), bool
-0001da60: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0001da70: 7373 6572 7449 7349 6e73 7461 6e63 6528  ssertIsInstance(
-0001da80: 7666 732e 7375 7070 6f72 7473 2822 6763  vfs.supports("gc
-0001da90: 7322 292c 2062 6f6f 6c29 0a20 2020 2020  s"), bool).     
-0001daa0: 2020 2073 656c 662e 6173 7365 7274 4973     self.assertIs
-0001dab0: 496e 7374 616e 6365 2876 6673 2e73 7570  Instance(vfs.sup
-0001dac0: 706f 7274 7328 2261 7a75 7265 2229 2c20  ports("azure"), 
-0001dad0: 626f 6f6c 290a 0a20 2020 2020 2020 2077  bool)..        w
-0001dae0: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
-0001daf0: 6169 7365 7328 5661 6c75 6545 7272 6f72  aises(ValueError
-0001db00: 293a 0a20 2020 2020 2020 2020 2020 2076  ):.            v
-0001db10: 6673 2e73 7570 706f 7274 7328 2269 6e76  fs.supports("inv
-0001db20: 616c 6964 2229 0a0a 2020 2020 6465 6620  alid")..    def 
-0001db30: 7465 7374 5f64 6972 2873 656c 6629 3a0a  test_dir(self):.
-0001db40: 2020 2020 2020 2020 7666 7320 3d20 7469          vfs = ti
-0001db50: 6c65 6462 2e56 4653 2829 0a0a 2020 2020  ledb.VFS()..    
-0001db60: 2020 2020 6469 7220 3d20 7365 6c66 2e70      dir = self.p
-0001db70: 6174 6828 2266 6f6f 2229 0a20 2020 2020  ath("foo").     
-0001db80: 2020 2073 656c 662e 6173 7365 7274 4661     self.assertFa
-0001db90: 6c73 6528 7666 732e 6973 5f64 6972 2864  lse(vfs.is_dir(d
-0001dba0: 6972 2929 0a0a 2020 2020 2020 2020 2320  ir))..        # 
-0001dbb0: 6372 6561 7465 0a20 2020 2020 2020 2076  create.        v
-0001dbc0: 6673 2e63 7265 6174 655f 6469 7228 6469  fs.create_dir(di
-0001dbd0: 7229 0a20 2020 2020 2020 2069 6620 7079  r).        if py
-0001dbe0: 7465 7374 2e74 696c 6564 625f 7666 7320  test.tiledb_vfs 
-0001dbf0: 213d 2022 7333 223a 0a20 2020 2020 2020  != "s3":.       
-0001dc00: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001dc10: 5472 7565 2876 6673 2e69 735f 6469 7228  True(vfs.is_dir(
-0001dc20: 6469 7229 290a 0a20 2020 2020 2020 2023  dir))..        #
-0001dc30: 2072 656d 6f76 650a 2020 2020 2020 2020   remove.        
-0001dc40: 7666 732e 7265 6d6f 7665 5f64 6972 2864  vfs.remove_dir(d
-0001dc50: 6972 290a 2020 2020 2020 2020 7365 6c66  ir).        self
-0001dc60: 2e61 7373 6572 7446 616c 7365 2876 6673  .assertFalse(vfs
-0001dc70: 2e69 735f 6469 7228 6469 7229 290a 0a20  .is_dir(dir)).. 
-0001dc80: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
-0001dc90: 6e65 7374 6564 2070 6174 680a 2020 2020  nested path.    
-0001dca0: 2020 2020 6469 7220 3d20 7365 6c66 2e70      dir = self.p
-0001dcb0: 6174 6828 2266 6f6f 2f62 6172 2229 0a20  ath("foo/bar"). 
-0001dcc0: 2020 2020 2020 2069 6620 7079 7465 7374         if pytest
-0001dcd0: 2e74 696c 6564 625f 7666 7320 213d 2022  .tiledb_vfs != "
-0001dce0: 7333 223a 0a20 2020 2020 2020 2020 2020  s3":.           
-0001dcf0: 2023 2074 6869 7320 6661 696c 7320 6c6f   # this fails lo
-0001dd00: 6361 6c6c 7920 6265 6361 7573 6520 2266  cally because "f
-0001dd10: 6f6f 2220 6261 7365 2070 6174 6820 646f  oo" base path do
-0001dd20: 6573 206e 6f74 2065 7869 7374 0a20 2020  es not exist.   
-0001dd30: 2020 2020 2020 2020 2023 2074 6869 7320           # this 
-0001dd40: 7769 6c6c 206e 6f74 2066 6169 6c20 6f6e  will not fail on
-0001dd50: 2073 3320 6265 6361 7573 6520 7468 6572   s3 because ther
-0001dd60: 6520 6973 206e 6f20 636f 6e63 6570 7420  e is no concept 
-0001dd70: 6f66 2064 6972 6563 746f 7279 0a20 2020  of directory.   
-0001dd80: 2020 2020 2020 2020 2077 6974 6820 7365           with se
-0001dd90: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
-0001dda0: 7469 6c65 6462 2e54 696c 6544 4245 7272  tiledb.TileDBErr
-0001ddb0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-0001ddc0: 2020 2020 2076 6673 2e63 7265 6174 655f       vfs.create_
-0001ddd0: 6469 7228 6469 7229 0a0a 2020 2020 2020  dir(dir)..      
-0001dde0: 2020 7666 732e 6372 6561 7465 5f64 6972    vfs.create_dir
-0001ddf0: 2873 656c 662e 7061 7468 2822 666f 6f22  (self.path("foo"
-0001de00: 2929 0a20 2020 2020 2020 2076 6673 2e63  )).        vfs.c
-0001de10: 7265 6174 655f 6469 7228 7365 6c66 2e70  reate_dir(self.p
-0001de20: 6174 6828 2266 6f6f 2f62 6172 2229 290a  ath("foo/bar")).
-0001de30: 2020 2020 2020 2020 6966 2070 7974 6573          if pytes
-0001de40: 742e 7469 6c65 6462 5f76 6673 2021 3d20  t.tiledb_vfs != 
-0001de50: 2273 3322 3a0a 2020 2020 2020 2020 2020  "s3":.          
-0001de60: 2020 7365 6c66 2e61 7373 6572 7454 7275    self.assertTru
-0001de70: 6528 7666 732e 6973 5f64 6972 2864 6972  e(vfs.is_dir(dir
-0001de80: 2929 0a0a 2020 2020 6465 6620 7465 7374  ))..    def test
-0001de90: 5f66 696c 6528 7365 6c66 293a 0a20 2020  _file(self):.   
-0001dea0: 2020 2020 2076 6673 203d 2074 696c 6564       vfs = tiled
-0001deb0: 622e 5646 5328 290a 0a20 2020 2020 2020  b.VFS()..       
-0001dec0: 2066 696c 6520 3d20 7365 6c66 2e70 6174   file = self.pat
-0001ded0: 6828 2266 6f6f 2229 0a20 2020 2020 2020  h("foo").       
-0001dee0: 2073 656c 662e 6173 7365 7274 4661 6c73   self.assertFals
-0001def0: 6528 7666 732e 6973 5f66 696c 6528 6669  e(vfs.is_file(fi
-0001df00: 6c65 2929 0a0a 2020 2020 2020 2020 2320  le))..        # 
-0001df10: 6372 6561 7465 0a20 2020 2020 2020 2076  create.        v
-0001df20: 6673 2e74 6f75 6368 2866 696c 6529 0a20  fs.touch(file). 
-0001df30: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0001df40: 7274 5472 7565 2876 6673 2e69 735f 6669  rtTrue(vfs.is_fi
-0001df50: 6c65 2866 696c 6529 290a 0a20 2020 2020  le(file))..     
-0001df60: 2020 2023 2072 656d 6f76 650a 2020 2020     # remove.    
-0001df70: 2020 2020 7666 732e 7265 6d6f 7665 5f66      vfs.remove_f
-0001df80: 696c 6528 6669 6c65 290a 2020 2020 2020  ile(file).      
-0001df90: 2020 7365 6c66 2e61 7373 6572 7446 616c    self.assertFal
-0001dfa0: 7365 2876 6673 2e69 735f 6669 6c65 2866  se(vfs.is_file(f
-0001dfb0: 696c 6529 290a 0a20 2020 2020 2020 2023  ile))..        #
-0001dfc0: 2063 6865 636b 206e 6573 7465 6420 7061   check nested pa
-0001dfd0: 7468 0a20 2020 2020 2020 2066 696c 6520  th.        file 
-0001dfe0: 3d20 7365 6c66 2e70 6174 6828 2266 6f6f  = self.path("foo
-0001dff0: 2f62 6172 2229 0a20 2020 2020 2020 2069  /bar").        i
-0001e000: 6620 7079 7465 7374 2e74 696c 6564 625f  f pytest.tiledb_
-0001e010: 7666 7320 213d 2022 7333 223a 0a20 2020  vfs != "s3":.   
-0001e020: 2020 2020 2020 2020 2023 2074 6869 7320           # this 
-0001e030: 6661 696c 7320 6c6f 6361 6c6c 7920 6265  fails locally be
-0001e040: 6361 7573 6520 2266 6f6f 2220 6261 7365  cause "foo" base
-0001e050: 2070 6174 6820 646f 6573 206e 6f74 2065   path does not e
-0001e060: 7869 7374 0a20 2020 2020 2020 2020 2020  xist.           
-0001e070: 2023 2074 6869 7320 7769 6c6c 206e 6f74   # this will not
-0001e080: 2066 6169 6c20 6f6e 2073 3320 6265 6361   fail on s3 beca
-0001e090: 7573 6520 7468 6572 6520 6973 206e 6f20  use there is no 
-0001e0a0: 636f 6e63 6570 7420 6f66 2064 6972 6563  concept of direc
-0001e0b0: 746f 7279 0a20 2020 2020 2020 2020 2020  tory.           
-0001e0c0: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
-0001e0d0: 7452 6169 7365 7328 7469 6c65 6462 2e54  tRaises(tiledb.T
-0001e0e0: 696c 6544 4245 7272 6f72 293a 0a20 2020  ileDBError):.   
-0001e0f0: 2020 2020 2020 2020 2020 2020 2076 6673               vfs
-0001e100: 2e74 6f75 6368 2866 696c 6529 0a0a 2020  .touch(file)..  
-0001e110: 2020 6465 6620 7465 7374 5f6d 6f76 6528    def test_move(
-0001e120: 7365 6c66 293a 0a20 2020 2020 2020 2076  self):.        v
-0001e130: 6673 203d 2074 696c 6564 622e 5646 5328  fs = tiledb.VFS(
-0001e140: 290a 0a20 2020 2020 2020 2076 6673 2e63  )..        vfs.c
-0001e150: 7265 6174 655f 6469 7228 7365 6c66 2e70  reate_dir(self.p
-0001e160: 6174 6828 2266 6f6f 2229 290a 2020 2020  ath("foo")).    
-0001e170: 2020 2020 7666 732e 6372 6561 7465 5f64      vfs.create_d
-0001e180: 6972 2873 656c 662e 7061 7468 2822 6261  ir(self.path("ba
-0001e190: 7222 2929 0a20 2020 2020 2020 2076 6673  r")).        vfs
-0001e1a0: 2e74 6f75 6368 2873 656c 662e 7061 7468  .touch(self.path
-0001e1b0: 2822 6261 722f 6261 7a22 2929 0a0a 2020  ("bar/baz"))..  
-0001e1c0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0001e1d0: 7454 7275 6528 7666 732e 6973 5f66 696c  tTrue(vfs.is_fil
-0001e1e0: 6528 7365 6c66 2e70 6174 6828 2262 6172  e(self.path("bar
-0001e1f0: 2f62 617a 2229 2929 0a0a 2020 2020 2020  /baz")))..      
-0001e200: 2020 7666 732e 6d6f 7665 5f66 696c 6528    vfs.move_file(
-0001e210: 7365 6c66 2e70 6174 6828 2262 6172 2f62  self.path("bar/b
-0001e220: 617a 2229 2c20 7365 6c66 2e70 6174 6828  az"), self.path(
-0001e230: 2266 6f6f 2f62 617a 2229 290a 0a20 2020  "foo/baz"))..   
-0001e240: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001e250: 4661 6c73 6528 7666 732e 6973 5f66 696c  False(vfs.is_fil
-0001e260: 6528 7365 6c66 2e70 6174 6828 2262 6172  e(self.path("bar
-0001e270: 2f62 617a 2229 2929 0a20 2020 2020 2020  /baz"))).       
-0001e280: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
-0001e290: 2876 6673 2e69 735f 6669 6c65 2873 656c  (vfs.is_file(sel
-0001e2a0: 662e 7061 7468 2822 666f 6f2f 6261 7a22  f.path("foo/baz"
-0001e2b0: 2929 290a 0a20 2020 2020 2020 2023 206d  )))..        # m
-0001e2c0: 6f76 696e 6720 746f 2069 6e76 616c 6964  oving to invalid
-0001e2d0: 2064 6972 2073 686f 756c 6420 7261 6973   dir should rais
-0001e2e0: 6520 616e 2065 7272 6f72 0a20 2020 2020  e an error.     
-0001e2f0: 2020 2069 6620 7079 7465 7374 2e74 696c     if pytest.til
-0001e300: 6564 625f 7666 7320 213d 2022 7333 223a  edb_vfs != "s3":
-0001e310: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
-0001e320: 6869 7320 6661 696c 7320 6c6f 6361 6c6c  his fails locall
-0001e330: 7920 6265 6361 7573 6520 2266 6f6f 2220  y because "foo" 
-0001e340: 6261 7365 2070 6174 6820 646f 6573 206e  base path does n
-0001e350: 6f74 2065 7869 7374 0a20 2020 2020 2020  ot exist.       
-0001e360: 2020 2020 2023 2074 6869 7320 7769 6c6c       # this will
-0001e370: 206e 6f74 2066 6169 6c20 6f6e 2073 3320   not fail on s3 
-0001e380: 6265 6361 7573 6520 7468 6572 6520 6973  because there is
-0001e390: 206e 6f20 636f 6e63 6570 7420 6f66 2064   no concept of d
-0001e3a0: 6972 6563 746f 7279 0a20 2020 2020 2020  irectory.       
-0001e3b0: 2020 2020 2077 6974 6820 7365 6c66 2e61       with self.a
-0001e3c0: 7373 6572 7452 6169 7365 7328 7469 6c65  ssertRaises(tile
-0001e3d0: 6462 2e54 696c 6544 4245 7272 6f72 293a  db.TileDBError):
-0001e3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e3f0: 2076 6673 2e6d 6f76 655f 6469 7228 7365   vfs.move_dir(se
-0001e400: 6c66 2e70 6174 6828 2266 6f6f 2f62 617a  lf.path("foo/baz
-0001e410: 2229 2c20 7365 6c66 2e70 6174 6828 2264  "), self.path("d
-0001e420: 6f5f 6e6f 745f 6578 6973 742f 6261 7a22  o_not_exist/baz"
-0001e430: 2929 0a0a 2020 2020 4070 7974 6573 742e  ))..    @pytest.
-0001e440: 6d61 726b 2e73 6b69 7069 6628 0a20 2020  mark.skipif(.   
-0001e450: 2020 2020 2073 7973 2e70 6c61 7466 6f72       sys.platfor
-0001e460: 6d20 3d3d 2022 7769 6e33 3222 2c0a 2020  m == "win32",.  
-0001e470: 2020 2020 2020 7265 6173 6f6e 3d22 5646        reason="VF
-0001e480: 5320 636f 7079 2063 6f6d 6d61 6e64 7320  S copy commands 
-0001e490: 6672 6f6d 2063 6f72 6520 6172 6520 6e6f  from core are no
-0001e4a0: 7420 7375 7070 6f72 7465 6420 6f6e 2057  t supported on W
-0001e4b0: 696e 646f 7773 222c 0a20 2020 2029 0a20  indows",.    ). 
-0001e4c0: 2020 2064 6566 2074 6573 745f 636f 7079     def test_copy
-0001e4d0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001e4e0: 7666 7320 3d20 7469 6c65 6462 2e56 4653  vfs = tiledb.VFS
-0001e4f0: 2829 0a0a 2020 2020 2020 2020 7666 732e  ()..        vfs.
-0001e500: 6372 6561 7465 5f64 6972 2873 656c 662e  create_dir(self.
-0001e510: 7061 7468 2822 666f 6f22 2929 0a20 2020  path("foo")).   
-0001e520: 2020 2020 2076 6673 2e63 7265 6174 655f       vfs.create_
-0001e530: 6469 7228 7365 6c66 2e70 6174 6828 2262  dir(self.path("b
-0001e540: 6172 2229 290a 2020 2020 2020 2020 7666  ar")).        vf
-0001e550: 732e 746f 7563 6828 7365 6c66 2e70 6174  s.touch(self.pat
-0001e560: 6828 2266 6f6f 2f62 617a 2229 290a 0a20  h("foo/baz")).. 
-0001e570: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0001e580: 7274 5472 7565 2876 6673 2e69 735f 6669  rtTrue(vfs.is_fi
-0001e590: 6c65 2873 656c 662e 7061 7468 2822 666f  le(self.path("fo
-0001e5a0: 6f2f 6261 7a22 2929 290a 0a20 2020 2020  o/baz")))..     
-0001e5b0: 2020 2076 6673 2e63 6f70 795f 6669 6c65     vfs.copy_file
-0001e5c0: 2873 656c 662e 7061 7468 2822 666f 6f2f  (self.path("foo/
-0001e5d0: 6261 7a22 292c 2073 656c 662e 7061 7468  baz"), self.path
-0001e5e0: 2822 6261 722f 6261 7a22 2929 0a0a 2020  ("bar/baz"))..  
-0001e5f0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0001e600: 7454 7275 6528 7666 732e 6973 5f66 696c  tTrue(vfs.is_fil
-0001e610: 6528 7365 6c66 2e70 6174 6828 2266 6f6f  e(self.path("foo
-0001e620: 2f62 617a 2229 2929 0a20 2020 2020 2020  /baz"))).       
-0001e630: 2073 656c 662e 6173 7365 7274 5472 7565   self.assertTrue
-0001e640: 2876 6673 2e69 735f 6669 6c65 2873 656c  (vfs.is_file(sel
-0001e650: 662e 7061 7468 2822 6261 722f 6261 7a22  f.path("bar/baz"
-0001e660: 2929 290a 0a20 2020 2020 2020 2076 6673  )))..        vfs
-0001e670: 2e63 6f70 795f 6469 7228 7365 6c66 2e70  .copy_dir(self.p
-0001e680: 6174 6828 2266 6f6f 2229 2c20 7365 6c66  ath("foo"), self
-0001e690: 2e70 6174 6828 2262 617a 2229 290a 0a20  .path("baz")).. 
-0001e6a0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0001e6b0: 7274 5472 7565 2876 6673 2e69 735f 6669  rtTrue(vfs.is_fi
-0001e6c0: 6c65 2873 656c 662e 7061 7468 2822 6261  le(self.path("ba
-0001e6d0: 7a2f 6261 7a22 2929 290a 0a20 2020 2020  z/baz")))..     
-0001e6e0: 2020 2023 2063 6f70 7969 6e67 2074 6f20     # copying to 
-0001e6f0: 696e 7661 6c69 6420 6469 7220 7368 6f75  invalid dir shou
-0001e700: 6c64 2072 6169 7365 2061 6e20 6572 726f  ld raise an erro
-0001e710: 720a 2020 2020 2020 2020 6966 2070 7974  r.        if pyt
-0001e720: 6573 742e 7469 6c65 6462 5f76 6673 2021  est.tiledb_vfs !
-0001e730: 3d20 2273 3322 3a0a 2020 2020 2020 2020  = "s3":.        
-0001e740: 2020 2020 2320 7468 6973 2066 6169 6c73      # this fails
-0001e750: 206c 6f63 616c 6c79 2062 6563 6175 7365   locally because
-0001e760: 2022 666f 6f22 2062 6173 6520 7061 7468   "foo" base path
-0001e770: 2064 6f65 7320 6e6f 7420 6578 6973 740a   does not exist.
-0001e780: 2020 2020 2020 2020 2020 2020 2320 7468              # th
-0001e790: 6973 2077 696c 6c20 6e6f 7420 6661 696c  is will not fail
-0001e7a0: 206f 6e20 7333 2062 6563 6175 7365 2074   on s3 because t
-0001e7b0: 6865 7265 2069 7320 6e6f 2063 6f6e 6365  here is no conce
-0001e7c0: 7074 206f 6620 6469 7265 6374 6f72 790a  pt of directory.
-0001e7d0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0001e7e0: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-0001e7f0: 6573 2874 696c 6564 622e 5469 6c65 4442  es(tiledb.TileDB
-0001e800: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-0001e810: 2020 2020 2020 2020 7666 732e 636f 7079          vfs.copy
-0001e820: 5f64 6972 2873 656c 662e 7061 7468 2822  _dir(self.path("
-0001e830: 666f 6f2f 6261 7a22 292c 2073 656c 662e  foo/baz"), self.
-0001e840: 7061 7468 2822 646f 5f6e 6f74 5f65 7869  path("do_not_exi
-0001e850: 7374 2f62 617a 2229 290a 0a20 2020 2064  st/baz"))..    d
-0001e860: 6566 2074 6573 745f 7772 6974 655f 7265  ef test_write_re
-0001e870: 6164 2873 656c 6629 3a0a 2020 2020 2020  ad(self):.      
-0001e880: 2020 7666 7320 3d20 7469 6c65 6462 2e56    vfs = tiledb.V
-0001e890: 4653 2829 0a0a 2020 2020 2020 2020 6275  FS()..        bu
-0001e8a0: 6666 6572 203d 2062 2262 6172 220a 2020  ffer = b"bar".  
-0001e8b0: 2020 2020 2020 6668 203d 2076 6673 2e6f        fh = vfs.o
-0001e8c0: 7065 6e28 7365 6c66 2e70 6174 6828 2266  pen(self.path("f
-0001e8d0: 6f6f 2229 2c20 2277 6222 290a 2020 2020  oo"), "wb").    
-0001e8e0: 2020 2020 7666 732e 7772 6974 6528 6668      vfs.write(fh
-0001e8f0: 2c20 6275 6666 6572 290a 2020 2020 2020  , buffer).      
-0001e900: 2020 7666 732e 636c 6f73 6528 6668 290a    vfs.close(fh).
-0001e910: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0001e920: 6572 7445 7175 616c 2876 6673 2e66 696c  ertEqual(vfs.fil
-0001e930: 655f 7369 7a65 2873 656c 662e 7061 7468  e_size(self.path
-0001e940: 2822 666f 6f22 2929 2c20 3329 0a0a 2020  ("foo")), 3)..  
-0001e950: 2020 2020 2020 6668 203d 2076 6673 2e6f        fh = vfs.o
-0001e960: 7065 6e28 7365 6c66 2e70 6174 6828 2266  pen(self.path("f
-0001e970: 6f6f 2229 2c20 2272 6222 290a 2020 2020  oo"), "rb").    
-0001e980: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0001e990: 7175 616c 2876 6673 2e72 6561 6428 6668  qual(vfs.read(fh
-0001e9a0: 2c20 302c 2033 292c 2062 7566 6665 7229  , 0, 3), buffer)
-0001e9b0: 0a20 2020 2020 2020 2076 6673 2e63 6c6f  .        vfs.clo
-0001e9c0: 7365 2866 6829 0a0a 2020 2020 2020 2020  se(fh)..        
-0001e9d0: 2320 7772 6974 6520 2f20 7265 6164 2065  # write / read e
-0001e9e0: 6d70 7479 2069 6e70 7574 0a20 2020 2020  mpty input.     
-0001e9f0: 2020 2066 6820 3d20 7666 732e 6f70 656e     fh = vfs.open
-0001ea00: 2873 656c 662e 7061 7468 2822 6261 7a22  (self.path("baz"
-0001ea10: 292c 2022 7762 2229 0a20 2020 2020 2020  ), "wb").       
-0001ea20: 2076 6673 2e77 7269 7465 2866 682c 2062   vfs.write(fh, b
-0001ea30: 2222 290a 2020 2020 2020 2020 7666 732e  "").        vfs.
-0001ea40: 636c 6f73 6528 6668 290a 2020 2020 2020  close(fh).      
-0001ea50: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001ea60: 616c 2876 6673 2e66 696c 655f 7369 7a65  al(vfs.file_size
-0001ea70: 2873 656c 662e 7061 7468 2822 6261 7a22  (self.path("baz"
-0001ea80: 2929 2c20 3029 0a0a 2020 2020 2020 2020  )), 0)..        
-0001ea90: 6668 203d 2076 6673 2e6f 7065 6e28 7365  fh = vfs.open(se
-0001eaa0: 6c66 2e70 6174 6828 2262 617a 2229 2c20  lf.path("baz"), 
-0001eab0: 2272 6222 290a 2020 2020 2020 2020 7365  "rb").        se
-0001eac0: 6c66 2e61 7373 6572 7445 7175 616c 2876  lf.assertEqual(v
-0001ead0: 6673 2e72 6561 6428 6668 2c20 302c 2030  fs.read(fh, 0, 0
-0001eae0: 292c 2062 2222 290a 2020 2020 2020 2020  ), b"").        
-0001eaf0: 7666 732e 636c 6f73 6528 6668 290a 0a20  vfs.close(fh).. 
-0001eb00: 2020 2020 2020 2023 2072 6561 6420 6672         # read fr
-0001eb10: 6f6d 2066 696c 6520 7468 6174 2064 6f65  om file that doe
-0001eb20: 7320 6e6f 7420 6578 6973 740a 2020 2020  s not exist.    
-0001eb30: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
-0001eb40: 7365 7274 5261 6973 6573 2874 696c 6564  sertRaises(tiled
-0001eb50: 622e 5469 6c65 4442 4572 726f 7229 3a0a  b.TileDBError):.
-0001eb60: 2020 2020 2020 2020 2020 2020 7666 732e              vfs.
-0001eb70: 6f70 656e 2873 656c 662e 7061 7468 2822  open(self.path("
-0001eb80: 646f 5f6e 6f74 5f65 7869 7374 2229 2c20  do_not_exist"), 
-0001eb90: 2272 6222 290a 0a20 2020 2064 6566 2074  "rb")..    def t
-0001eba0: 6573 745f 696f 2873 656c 6629 3a0a 2020  est_io(self):.  
-0001ebb0: 2020 2020 2020 7666 7320 3d20 7469 6c65        vfs = tile
-0001ebc0: 6462 2e56 4653 2829 0a0a 2020 2020 2020  db.VFS()..      
-0001ebd0: 2020 6275 6666 6572 203d 2062 2230 3132    buffer = b"012
-0001ebe0: 3334 3536 3738 3922 0a20 2020 2020 2020  3456789".       
-0001ebf0: 2077 6974 6820 7469 6c65 6462 2e46 696c   with tiledb.Fil
-0001ec00: 6549 4f28 7666 732c 2073 656c 662e 7061  eIO(vfs, self.pa
-0001ec10: 7468 2822 666f 6f22 292c 206d 6f64 653d  th("foo"), mode=
-0001ec20: 2277 6222 2920 6173 2066 696f 3a0a 2020  "wb") as fio:.  
-0001ec30: 2020 2020 2020 2020 2020 6669 6f2e 7772            fio.wr
-0001ec40: 6974 6528 6275 6666 6572 290a 2020 2020  ite(buffer).    
-0001ec50: 2020 2020 2020 2020 6669 6f2e 666c 7573          fio.flus
-0001ec60: 6828 290a 2020 2020 2020 2020 2020 2020  h().            
-0001ec70: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0001ec80: 2866 696f 2e74 656c 6c28 292c 206c 656e  (fio.tell(), len
-0001ec90: 2862 7566 6665 7229 290a 0a20 2020 2020  (buffer))..     
-0001eca0: 2020 2077 6974 6820 7469 6c65 6462 2e46     with tiledb.F
-0001ecb0: 696c 6549 4f28 7666 732c 2073 656c 662e  ileIO(vfs, self.
-0001ecc0: 7061 7468 2822 666f 6f22 292c 206d 6f64  path("foo"), mod
-0001ecd0: 653d 2272 6222 2920 6173 2066 696f 3a0a  e="rb") as fio:.
-0001ece0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0001ecf0: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
-0001ed00: 6573 2849 4f45 7272 6f72 293a 0a20 2020  es(IOError):.   
-0001ed10: 2020 2020 2020 2020 2020 2020 2066 696f               fio
-0001ed20: 2e77 7269 7465 2862 2266 6f6f 2229 0a0a  .write(b"foo")..
-0001ed30: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-0001ed40: 6572 7445 7175 616c 2876 6673 2e66 696c  ertEqual(vfs.fil
-0001ed50: 655f 7369 7a65 2873 656c 662e 7061 7468  e_size(self.path
-0001ed60: 2822 666f 6f22 2929 2c20 6c65 6e28 6275  ("foo")), len(bu
-0001ed70: 6666 6572 2929 0a0a 2020 2020 2020 2020  ffer))..        
-0001ed80: 6669 6f20 3d20 7469 6c65 6462 2e46 696c  fio = tiledb.Fil
-0001ed90: 6549 4f28 7666 732c 2073 656c 662e 7061  eIO(vfs, self.pa
-0001eda0: 7468 2822 666f 6f22 292c 206d 6f64 653d  th("foo"), mode=
-0001edb0: 2272 6222 290a 2020 2020 2020 2020 7365  "rb").        se
-0001edc0: 6c66 2e61 7373 6572 7445 7175 616c 2866  lf.assertEqual(f
-0001edd0: 696f 2e72 6561 6428 3329 2c20 6222 3031  io.read(3), b"01
-0001ede0: 3222 290a 2020 2020 2020 2020 7365 6c66  2").        self
-0001edf0: 2e61 7373 6572 7445 7175 616c 2866 696f  .assertEqual(fio
-0001ee00: 2e74 656c 6c28 292c 2033 290a 2020 2020  .tell(), 3).    
-0001ee10: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-0001ee20: 7175 616c 2866 696f 2e72 6561 6428 3329  qual(fio.read(3)
-0001ee30: 2c20 6222 3334 3522 290a 2020 2020 2020  , b"345").      
-0001ee40: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
-0001ee50: 616c 2866 696f 2e74 656c 6c28 292c 2036  al(fio.tell(), 6
-0001ee60: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0001ee70: 7373 6572 7445 7175 616c 2866 696f 2e72  ssertEqual(fio.r
-0001ee80: 6561 6428 3130 292c 2062 2236 3738 3922  ead(10), b"6789"
-0001ee90: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0001eea0: 7373 6572 7445 7175 616c 2866 696f 2e74  ssertEqual(fio.t
-0001eeb0: 656c 6c28 292c 2031 3029 0a0a 2020 2020  ell(), 10)..    
-0001eec0: 2020 2020 2320 7365 656b 2066 726f 6d20      # seek from 
-0001eed0: 6265 6769 6e6e 696e 670a 2020 2020 2020  beginning.      
-0001eee0: 2020 6669 6f2e 7365 656b 2830 290a 2020    fio.seek(0).  
-0001eef0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
-0001ef00: 7445 7175 616c 2866 696f 2e74 656c 6c28  tEqual(fio.tell(
-0001ef10: 292c 2030 290a 2020 2020 2020 2020 7365  ), 0).        se
-0001ef20: 6c66 2e61 7373 6572 7445 7175 616c 2866  lf.assertEqual(f
-0001ef30: 696f 2e72 6561 6428 292c 2062 7566 6665  io.read(), buffe
-0001ef40: 7229 0a0a 2020 2020 2020 2020 2320 7365  r)..        # se
-0001ef50: 656b 206d 7573 7420 6265 2070 6f73 6974  ek must be posit
-0001ef60: 6976 6520 7768 656e 2053 4545 4b5f 5345  ive when SEEK_SE
-0001ef70: 540a 2020 2020 2020 2020 7769 7468 2073  T.        with s
-0001ef80: 656c 662e 6173 7365 7274 5261 6973 6573  elf.assertRaises
-0001ef90: 2856 616c 7565 4572 726f 7229 3a0a 2020  (ValueError):.  
-0001efa0: 2020 2020 2020 2020 2020 6669 6f2e 7365            fio.se
-0001efb0: 656b 282d 312c 2030 290a 0a20 2020 2020  ek(-1, 0)..     
-0001efc0: 2020 2023 2073 6565 6b20 6672 6f6d 2063     # seek from c
-0001efd0: 7572 7265 6e74 2070 6f73 6974 6669 6f6e  urrent positfion
-0001efe0: 0a20 2020 2020 2020 2066 696f 2e73 6565  .        fio.see
-0001eff0: 6b28 3529 0a20 2020 2020 2020 2073 656c  k(5).        sel
-0001f000: 662e 6173 7365 7274 4571 7561 6c28 6669  f.assertEqual(fi
-0001f010: 6f2e 7465 6c6c 2829 2c20 3529 0a20 2020  o.tell(), 5).   
-0001f020: 2020 2020 2066 696f 2e73 6565 6b28 332c       fio.seek(3,
-0001f030: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
-0001f040: 2e61 7373 6572 7445 7175 616c 2866 696f  .assertEqual(fio
-0001f050: 2e74 656c 6c28 292c 2038 290a 2020 2020  .tell(), 8).    
-0001f060: 2020 2020 6669 6f2e 7365 656b 282d 332c      fio.seek(-3,
-0001f070: 2031 290a 2020 2020 2020 2020 7365 6c66   1).        self
-0001f080: 2e61 7373 6572 7445 7175 616c 2866 696f  .assertEqual(fio
-0001f090: 2e74 656c 6c28 292c 2035 290a 0a20 2020  .tell(), 5)..   
-0001f0a0: 2020 2020 2023 2073 6565 6b20 6672 6f6d       # seek from
-0001f0b0: 2065 6e64 0a20 2020 2020 2020 2066 696f   end.        fio
-0001f0c0: 2e73 6565 6b28 2d34 2c20 3229 0a20 2020  .seek(-4, 2).   
-0001f0d0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001f0e0: 4571 7561 6c28 6669 6f2e 7465 6c6c 2829  Equal(fio.tell()
-0001f0f0: 2c20 3629 0a0a 2020 2020 2020 2020 2320  , 6)..        # 
-0001f100: 5465 7374 2072 6561 6461 6c6c 0a20 2020  Test readall.   
-0001f110: 2020 2020 2066 696f 2e73 6565 6b28 3029       fio.seek(0)
-0001f120: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0001f130: 7365 7274 4571 7561 6c28 6669 6f2e 7265  sertEqual(fio.re
-0001f140: 6164 616c 6c28 292c 2062 7566 6665 7229  adall(), buffer)
-0001f150: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0001f160: 7365 7274 4571 7561 6c28 6669 6f2e 7465  sertEqual(fio.te
-0001f170: 6c6c 2829 2c20 3130 290a 0a20 2020 2020  ll(), 10)..     
-0001f180: 2020 2066 696f 2e73 6565 6b28 3529 0a20     fio.seek(5). 
-0001f190: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
-0001f1a0: 7274 4571 7561 6c28 6669 6f2e 7265 6164  rtEqual(fio.read
-0001f1b0: 616c 6c28 292c 2062 7566 6665 725b 353a  all(), buffer[5:
-0001f1c0: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
-0001f1d0: 6173 7365 7274 4571 7561 6c28 6669 6f2e  assertEqual(fio.
-0001f1e0: 7265 6164 616c 6c28 292c 2062 2222 290a  readall(), b"").
-0001f1f0: 0a20 2020 2020 2020 2023 2052 6561 6469  .        # Readi
-0001f200: 6e67 2066 726f 6d20 7468 6520 656e 6420  ng from the end 
-0001f210: 7368 6f75 6c64 2072 6574 7572 6e20 656d  should return em
-0001f220: 7074 790a 2020 2020 2020 2020 6669 6f2e  pty.        fio.
-0001f230: 7365 656b 2830 290a 2020 2020 2020 2020  seek(0).        
-0001f240: 6669 6f2e 7265 6164 2829 0a20 2020 2020  fio.read().     
-0001f250: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
-0001f260: 7561 6c28 6669 6f2e 7265 6164 2829 2c20  ual(fio.read(), 
-0001f270: 6222 2229 0a0a 2020 2020 2020 2020 2320  b"")..        # 
-0001f280: 5465 7374 2077 7269 7469 6e67 2061 6e64  Test writing and
-0001f290: 2072 6561 6469 6e67 206c 696e 6573 2077   reading lines w
-0001f2a0: 6974 6820 5465 7874 494f 5772 6170 7065  ith TextIOWrappe
-0001f2b0: 720a 2020 2020 2020 2020 6c69 6e65 7320  r.        lines 
-0001f2c0: 3d20 5b72 616e 645f 7574 6638 2872 616e  = [rand_utf8(ran
-0001f2d0: 646f 6d2e 7261 6e64 696e 7428 302c 2035  dom.randint(0, 5
-0001f2e0: 3029 2920 2b20 225c 6e22 2066 6f72 205f  0)) + "\n" for _
-0001f2f0: 2069 6e20 7261 6e67 6528 3130 295d 0a20   in range(10)]. 
-0001f300: 2020 2020 2020 2072 616e 645f 7572 6920         rand_uri 
-0001f310: 3d20 7365 6c66 2e70 6174 6828 2274 6573  = self.path("tes
-0001f320: 745f 6669 6f2e 7261 6e64 2229 0a20 2020  t_fio.rand").   
-0001f330: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-0001f340: 2e46 696c 6549 4f28 7666 732c 2072 616e  .FileIO(vfs, ran
-0001f350: 645f 7572 692c 2022 7762 2229 2061 7320  d_uri, "wb") as 
-0001f360: 663a 0a20 2020 2020 2020 2020 2020 2074  f:.            t
-0001f370: 7874 696f 203d 2069 6f2e 5465 7874 494f  xtio = io.TextIO
-0001f380: 5772 6170 7065 7228 662c 2065 6e63 6f64  Wrapper(f, encod
-0001f390: 696e 673d 2275 7466 2d38 2229 0a20 2020  ing="utf-8").   
-0001f3a0: 2020 2020 2020 2020 2074 7874 696f 2e77           txtio.w
-0001f3b0: 7269 7465 6c69 6e65 7328 6c69 6e65 7329  ritelines(lines)
-0001f3c0: 0a20 2020 2020 2020 2020 2020 2074 7874  .            txt
-0001f3d0: 696f 2e66 6c75 7368 2829 0a0a 2020 2020  io.flush()..    
-0001f3e0: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
-0001f3f0: 4669 6c65 494f 2876 6673 2c20 7261 6e64  FileIO(vfs, rand
-0001f400: 5f75 7269 2c20 2272 6222 2920 6173 2066  _uri, "rb") as f
-0001f410: 323a 0a20 2020 2020 2020 2020 2020 2074  2:.            t
-0001f420: 7874 696f 203d 2069 6f2e 5465 7874 494f  xtio = io.TextIO
-0001f430: 5772 6170 7065 7228 6632 2c20 656e 636f  Wrapper(f2, enco
-0001f440: 6469 6e67 3d22 7574 662d 3822 290a 2020  ding="utf-8").  
-0001f450: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0001f460: 7373 6572 7445 7175 616c 2874 7874 696f  ssertEqual(txtio
-0001f470: 2e72 6561 646c 696e 6573 2829 2c20 6c69  .readlines(), li
-0001f480: 6e65 7329 0a0a 2020 2020 6465 6620 7465  nes)..    def te
-0001f490: 7374 5f6c 7328 7365 6c66 293a 0a20 2020  st_ls(self):.   
-0001f4a0: 2020 2020 2062 6173 6570 6174 6820 3d20       basepath = 
-0001f4b0: 7365 6c66 2e70 6174 6828 2274 6573 745f  self.path("test_
-0001f4c0: 7666 735f 6c73 2229 0a20 2020 2020 2020  vfs_ls").       
-0001f4d0: 2073 656c 662e 7666 732e 6372 6561 7465   self.vfs.create
-0001f4e0: 5f64 6972 2862 6173 6570 6174 6829 0a20  _dir(basepath). 
-0001f4f0: 2020 2020 2020 2066 6f72 2069 6420 696e         for id in
-0001f500: 2028 312c 2032 2c20 3329 3a0a 2020 2020   (1, 2, 3):.    
-0001f510: 2020 2020 2020 2020 6469 7220 3d20 6f73          dir = os
-0001f520: 2e70 6174 682e 6a6f 696e 2862 6173 6570  .path.join(basep
-0001f530: 6174 682c 2022 6469 7222 202b 2073 7472  ath, "dir" + str
-0001f540: 2869 6429 290a 2020 2020 2020 2020 2020  (id)).          
-0001f550: 2020 7365 6c66 2e76 6673 2e63 7265 6174    self.vfs.creat
-0001f560: 655f 6469 7228 6469 7229 0a20 2020 2020  e_dir(dir).     
-0001f570: 2020 2020 2020 2066 6e61 6d65 203d 206f         fname = o
-0001f580: 732e 7061 7468 2e6a 6f69 6e28 6261 7365  s.path.join(base
-0001f590: 7061 7468 2c20 2266 696c 655f 2220 2b20  path, "file_" + 
-0001f5a0: 7374 7228 6964 2929 0a20 2020 2020 2020  str(id)).       
-0001f5b0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-0001f5c0: 2e46 696c 6549 4f28 7365 6c66 2e76 6673  .FileIO(self.vfs
-0001f5d0: 2c20 666e 616d 652c 2022 7762 2229 2061  , fname, "wb") a
-0001f5e0: 7320 6669 6f3a 0a20 2020 2020 2020 2020  s fio:.         
-0001f5f0: 2020 2020 2020 2066 696f 2e77 7269 7465         fio.write
-0001f600: 2862 2222 290a 0a20 2020 2020 2020 2065  (b"")..        e
-0001f610: 7870 6563 7465 6420 3d20 2822 6669 6c65  xpected = ("file
-0001f620: 5f31 222c 2022 6669 6c65 5f32 222c 2022  _1", "file_2", "
-0001f630: 6669 6c65 5f33 2229 0a20 2020 2020 2020  file_3").       
-0001f640: 2023 2065 6d70 7479 2064 6972 6563 746f   # empty directo
-0001f650: 7269 6573 2064 6f20 6e6f 7420 2265 7869  ries do not "exi
-0001f660: 7374 2220 6f6e 2073 330a 2020 2020 2020  st" on s3.      
-0001f670: 2020 6966 2070 7974 6573 742e 7469 6c65    if pytest.tile
-0001f680: 6462 5f76 6673 2021 3d20 2273 3322 3a0a  db_vfs != "s3":.
-0001f690: 2020 2020 2020 2020 2020 2020 6578 7065              expe
-0001f6a0: 6374 6564 203d 2065 7870 6563 7465 6420  cted = expected 
-0001f6b0: 2b20 2822 6469 7231 222c 2022 6469 7232  + ("dir1", "dir2
-0001f6c0: 222c 2022 6469 7233 2229 0a0a 2020 2020  ", "dir3")..    
-0001f6d0: 2020 2020 7365 6c66 2e61 7373 6572 7453      self.assertS
-0001f6e0: 6574 4571 7561 6c28 0a20 2020 2020 2020  etEqual(.       
-0001f6f0: 2020 2020 2073 6574 2865 7870 6563 7465       set(expecte
-0001f700: 6429 2c0a 2020 2020 2020 2020 2020 2020  d),.            
-0001f710: 7365 7428 0a20 2020 2020 2020 2020 2020  set(.           
-0001f720: 2020 2020 206d 6170 280a 2020 2020 2020       map(.      
-0001f730: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0001f740: 6d62 6461 2078 3a20 6f73 2e70 6174 682e  mbda x: os.path.
-0001f750: 6261 7365 6e61 6d65 2878 2e73 706c 6974  basename(x.split
-0001f760: 2822 7465 7374 5f76 6673 5f6c 7322 295b  ("test_vfs_ls")[
-0001f770: 315d 292c 0a20 2020 2020 2020 2020 2020  1]),.           
-0001f780: 2020 2020 2020 2020 2073 656c 662e 7666           self.vf
-0001f790: 732e 6c73 2862 6173 6570 6174 6829 2c0a  s.ls(basepath),.
-0001f7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f7b0: 290a 2020 2020 2020 2020 2020 2020 292c  ).            ),
-0001f7c0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0001f7d0: 6465 6620 7465 7374 5f64 6972 5f73 697a  def test_dir_siz
-0001f7e0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-0001f7f0: 2076 6673 203d 2074 696c 6564 622e 5646   vfs = tiledb.VF
-0001f800: 5328 290a 0a20 2020 2020 2020 2070 6174  S()..        pat
-0001f810: 6820 3d20 7365 6c66 2e70 6174 6828 2274  h = self.path("t
-0001f820: 6573 745f 7666 735f 6469 725f 7369 7a65  est_vfs_dir_size
-0001f830: 2229 0a20 2020 2020 2020 2076 6673 2e63  ").        vfs.c
-0001f840: 7265 6174 655f 6469 7228 7061 7468 290a  reate_dir(path).
-0001f850: 2020 2020 2020 2020 7261 6e64 5f73 697a          rand_siz
-0001f860: 6573 203d 206e 702e 7261 6e64 6f6d 2e63  es = np.random.c
-0001f870: 686f 6963 6528 3130 302c 2073 697a 653d  hoice(100, size=
-0001f880: 342c 2072 6570 6c61 6365 3d46 616c 7365  4, replace=False
-0001f890: 290a 2020 2020 2020 2020 666f 7220 7369  ).        for si
-0001f8a0: 7a65 2069 6e20 7261 6e64 5f73 697a 6573  ze in rand_sizes
-0001f8b0: 3a0a 2020 2020 2020 2020 2020 2020 6669  :.            fi
-0001f8c0: 6c65 5f70 6174 6820 3d20 6f73 2e70 6174  le_path = os.pat
-0001f8d0: 682e 6a6f 696e 2870 6174 682c 2022 665f  h.join(path, "f_
-0001f8e0: 2220 2b20 7374 7228 7369 7a65 2929 0a20  " + str(size)). 
-0001f8f0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0001f900: 7469 6c65 6462 2e46 696c 6549 4f28 7666  tiledb.FileIO(vf
-0001f910: 732c 2066 696c 655f 7061 7468 2c20 2277  s, file_path, "w
-0001f920: 6222 2920 6173 2066 3a0a 2020 2020 2020  b") as f:.      
-0001f930: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-0001f940: 206f 732e 7572 616e 646f 6d28 7369 7a65   os.urandom(size
-0001f950: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001f960: 2020 662e 7772 6974 6528 6461 7461 290a    f.write(data).
-0001f970: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
-0001f980: 7365 7274 4571 7561 6c28 7666 732e 6469  sertEqual(vfs.di
-0001f990: 725f 7369 7a65 2870 6174 6829 2c20 7375  r_size(path), su
-0001f9a0: 6d28 7261 6e64 5f73 697a 6573 2929 0a0a  m(rand_sizes))..
-0001f9b0: 0a63 6c61 7373 2043 6f6e 736f 6c69 6461  .class Consolida
-0001f9c0: 7469 6f6e 5465 7374 2844 6973 6b54 6573  tionTest(DiskTes
-0001f9d0: 7443 6173 6529 3a0a 2020 2020 6465 6620  tCase):.    def 
-0001f9e0: 7465 7374 5f61 7272 6179 5f76 6163 7575  test_array_vacuu
-0001f9f0: 6d28 7365 6c66 293a 0a20 2020 2020 2020  m(self):.       
-0001fa00: 2076 6673 203d 2074 696c 6564 622e 5646   vfs = tiledb.VF
-0001fa10: 5328 290a 2020 2020 2020 2020 7061 7468  S().        path
-0001fa20: 203d 2073 656c 662e 7061 7468 2822 7465   = self.path("te
-0001fa30: 7374 5f61 7272 6179 5f76 6163 7575 6d22  st_array_vacuum"
-0001fa40: 290a 0a20 2020 2020 2020 2064 7368 6170  )..        dshap
-0001fa50: 6520 3d20 2830 2c20 3139 290a 2020 2020  e = (0, 19).    
-0001fa60: 2020 2020 6e75 6d5f 7772 6974 6573 203d      num_writes =
-0001fa70: 2031 300a 0a20 2020 2020 2020 2064 6566   10..        def
-0001fa80: 2063 7265 6174 655f 6172 7261 7928 7461   create_array(ta
-0001fa90: 7267 6574 5f70 6174 6829 3a0a 2020 2020  rget_path):.    
-0001faa0: 2020 2020 2020 2020 646f 6d20 3d20 7469          dom = ti
-0001fab0: 6c65 6462 2e44 6f6d 6169 6e28 7469 6c65  ledb.Domain(tile
-0001fac0: 6462 2e44 696d 2864 6f6d 6169 6e3d 6473  db.Dim(domain=ds
-0001fad0: 6861 7065 2c20 7469 6c65 3d33 2929 0a20  hape, tile=3)). 
-0001fae0: 2020 2020 2020 2020 2020 2061 7474 203d             att =
-0001faf0: 2074 696c 6564 622e 4174 7472 2864 7479   tiledb.Attr(dty
-0001fb00: 7065 3d22 696e 7436 3422 290a 2020 2020  pe="int64").    
-0001fb10: 2020 2020 2020 2020 7363 6865 6d61 203d          schema =
-0001fb20: 2074 696c 6564 622e 4172 7261 7953 6368   tiledb.ArraySch
-0001fb30: 656d 6128 646f 6d61 696e 3d64 6f6d 2c20  ema(domain=dom, 
-0001fb40: 6174 7472 733d 2861 7474 2c29 290a 2020  attrs=(att,)).  
-0001fb50: 2020 2020 2020 2020 2020 7469 6c65 6462            tiledb
-0001fb60: 2e6c 6962 7469 6c65 6462 2e41 7272 6179  .libtiledb.Array
-0001fb70: 2e63 7265 6174 6528 7461 7267 6574 5f70  .create(target_p
-0001fb80: 6174 682c 2073 6368 656d 6129 0a0a 2020  ath, schema)..  
-0001fb90: 2020 2020 2020 6465 6620 7772 6974 655f        def write_
-0001fba0: 6672 6167 6d65 6e74 7328 7461 7267 6574  fragments(target
-0001fbb0: 5f70 6174 6829 3a0a 2020 2020 2020 2020  _path):.        
-0001fbc0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0001fbd0: 6765 286e 756d 5f77 7269 7465 7329 3a0a  ge(num_writes):.
-0001fbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fbf0: 7769 7468 2074 696c 6564 622e 6f70 656e  with tiledb.open
-0001fc00: 2874 6172 6765 745f 7061 7468 2c20 2277  (target_path, "w
-0001fc10: 2229 2061 7320 413a 0a20 2020 2020 2020  ") as A:.       
-0001fc20: 2020 2020 2020 2020 2020 2020 2041 5b69               A[i
-0001fc30: 203a 2064 7368 6170 655b 315d 5d20 3d20   : dshape[1]] = 
-0001fc40: 6e70 2e72 616e 646f 6d2e 7261 6e64 2864  np.random.rand(d
-0001fc50: 7368 6170 655b 315d 202d 2069 290a 0a20  shape[1] - i).. 
-0001fc60: 2020 2020 2020 2023 2065 7870 6563 7465         # expecte
-0001fc70: 6420 6e75 6d62 6572 206f 6620 6e6f 6e2d  d number of non-
-0001fc80: 6672 6167 6d65 6e74 2064 6972 6563 746f  fragment directo
-0001fc90: 7279 2065 6e74 7269 6573 0a20 2020 2020  ry entries.     
-0001fca0: 2020 2023 2020 2074 6865 7265 2069 7320     #   there is 
-0001fcb0: 6e6f 206c 7320 7265 7375 6c74 2066 6f72  no ls result for
-0001fcc0: 2065 6d70 7479 205f 5f6d 6574 6120 6469   empty __meta di
-0001fcd0: 7265 6374 6f72 7920 6f6e 2073 330a 2020  rectory on s3.  
-0001fce0: 2020 2020 2020 6578 7065 6374 6564 5f65        expected_e
-0001fcf0: 7874 7261 203d 2032 2069 6620 7079 7465  xtra = 2 if pyte
-0001fd00: 7374 2e74 696c 6564 625f 7666 7320 3d3d  st.tiledb_vfs ==
-0001fd10: 2022 7333 2220 656c 7365 2033 0a0a 2020   "s3" else 3..  
-0001fd20: 2020 2020 2020 6372 6561 7465 5f61 7272        create_arr
-0001fd30: 6179 2870 6174 6829 0a20 2020 2020 2020  ay(path).       
-0001fd40: 2077 7269 7465 5f66 7261 676d 656e 7473   write_fragments
-0001fd50: 2870 6174 6829 0a20 2020 2020 2020 2070  (path).        p
-0001fd60: 6174 6873 203d 2076 6673 2e6c 7328 7061  aths = vfs.ls(pa
-0001fd70: 7468 290a 2020 2020 2020 2020 7365 6c66  th).        self
-0001fd80: 2e61 7373 6572 7445 7175 616c 286c 656e  .assertEqual(len
-0001fd90: 2870 6174 6873 292c 2065 7870 6563 7465  (paths), expecte
-0001fda0: 645f 6578 7472 6120 2b20 2832 202a 206e  d_extra + (2 * n
-0001fdb0: 756d 5f77 7269 7465 7329 290a 0a20 2020  um_writes))..   
-0001fdc0: 2020 2020 2074 696c 6564 622e 636f 6e73       tiledb.cons
-0001fdd0: 6f6c 6964 6174 6528 7061 7468 290a 2020  olidate(path).  
-0001fde0: 2020 2020 2020 7469 6c65 6462 2e76 6163        tiledb.vac
-0001fdf0: 7575 6d28 7061 7468 290a 0a20 2020 2020  uum(path)..     
-0001fe00: 2020 2070 6174 6873 203d 2076 6673 2e6c     paths = vfs.l
-0001fe10: 7328 7061 7468 290a 2020 2020 2020 2020  s(path).        
-0001fe20: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-0001fe30: 286c 656e 2870 6174 6873 292c 2065 7870  (len(paths), exp
-0001fe40: 6563 7465 645f 6578 7472 6120 2b20 3229  ected_extra + 2)
-0001fe50: 0a0a 2020 2020 2020 2020 6465 6c20 7061  ..        del pa
-0001fe60: 7468 0a0a 2020 2020 2020 2020 7061 7468  th..        path
-0001fe70: 3220 3d20 7365 6c66 2e70 6174 6828 2274  2 = self.path("t
-0001fe80: 6573 745f 6172 7261 795f 7661 6375 756d  est_array_vacuum
-0001fe90: 5f66 7261 676d 656e 745f 6d65 7461 2229  _fragment_meta")
-0001fea0: 0a20 2020 2020 2020 2063 7265 6174 655f  .        create_
-0001feb0: 6172 7261 7928 7061 7468 3229 0a20 2020  array(path2).   
-0001fec0: 2020 2020 2077 7269 7465 5f66 7261 676d       write_fragm
-0001fed0: 656e 7473 2870 6174 6832 290a 2020 2020  ents(path2).    
-0001fee0: 2020 2020 7469 6c65 6462 2e63 6f6e 736f      tiledb.conso
-0001fef0: 6c69 6461 7465 280a 2020 2020 2020 2020  lidate(.        
-0001ff00: 2020 2020 7061 7468 322c 2063 6f6e 6669      path2, confi
-0001ff10: 673d 7469 6c65 6462 2e43 6f6e 6669 6728  g=tiledb.Config(
-0001ff20: 7b22 736d 2e63 6f6e 736f 6c69 6461 7469  {"sm.consolidati
-0001ff30: 6f6e 2e6d 6f64 6522 3a20 2266 7261 676d  on.mode": "fragm
-0001ff40: 656e 745f 6d65 7461 227d 290a 2020 2020  ent_meta"}).    
-0001ff50: 2020 2020 290a 2020 2020 2020 2020 7469      ).        ti
-0001ff60: 6c65 6462 2e76 6163 7575 6d28 7061 7468  ledb.vacuum(path
-0001ff70: 322c 2063 6f6e 6669 673d 7469 6c65 6462  2, config=tiledb
-0001ff80: 2e43 6f6e 6669 6728 7b22 736d 2e76 6163  .Config({"sm.vac
-0001ff90: 7575 6d2e 6d6f 6465 223a 2022 6672 6167  uum.mode": "frag
-0001ffa0: 6d65 6e74 5f6d 6574 6122 7d29 290a 2020  ment_meta"})).  
-0001ffb0: 2020 2020 2020 7061 7468 7320 3d20 7666        paths = vf
-0001ffc0: 732e 6c73 2870 6174 6832 290a 0a20 2020  s.ls(path2)..   
-0001ffd0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
-0001ffe0: 4571 7561 6c28 6c65 6e28 7061 7468 7329  Equal(len(paths)
-0001fff0: 2c20 6578 7065 6374 6564 5f65 7874 7261  , expected_extra
-00020000: 202b 2032 202a 206e 756d 5f77 7269 7465   + 2 * num_write
-00020010: 7320 2b20 3129 0a0a 2020 2020 2020 2020  s + 1)..        
-00020020: 7061 7468 3320 3d20 7365 6c66 2e70 6174  path3 = self.pat
-00020030: 6828 2274 6573 745f 6172 7261 795f 7661  h("test_array_va
-00020040: 6375 756d 3222 290a 2020 2020 2020 2020  cuum2").        
-00020050: 6372 6561 7465 5f61 7272 6179 2870 6174  create_array(pat
-00020060: 6833 290a 2020 2020 2020 2020 7772 6974  h3).        writ
-00020070: 655f 6672 6167 6d65 6e74 7328 7061 7468  e_fragments(path
-00020080: 3329 0a20 2020 2020 2020 2063 6f6e 6620  3).        conf 
-00020090: 3d20 7469 6c65 6462 2e43 6f6e 6669 6728  = tiledb.Config(
-000200a0: 7b22 736d 2e63 6f6e 736f 6c69 6461 7469  {"sm.consolidati
-000200b0: 6f6e 2e6d 6f64 6522 3a20 2266 7261 676d  on.mode": "fragm
-000200c0: 656e 745f 6d65 7461 227d 290a 2020 2020  ent_meta"}).    
-000200d0: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
-000200e0: 6f70 656e 2870 6174 6833 2c20 2277 2229  open(path3, "w")
-000200f0: 2061 7320 413a 0a20 2020 2020 2020 2020   as A:.         
-00020100: 2020 2041 2e63 6f6e 736f 6c69 6461 7465     A.consolidate
-00020110: 2863 6f6e 6669 673d 636f 6e66 290a 0a20  (config=conf).. 
-00020120: 2020 2020 2020 2070 6174 6873 203d 2076         paths = v
-00020130: 6673 2e6c 7328 7061 7468 3229 0a0a 2020  fs.ls(path2)..  
-00020140: 2020 6465 6620 7465 7374 5f61 7272 6179    def test_array
-00020150: 5f63 6f6e 736f 6c69 6461 7465 5f77 6974  _consolidate_wit
-00020160: 685f 7469 6d65 7374 616d 7028 7365 6c66  h_timestamp(self
-00020170: 293a 0a20 2020 2020 2020 2064 7368 6170  ):.        dshap
-00020180: 6520 3d20 2831 2c20 3329 0a20 2020 2020  e = (1, 3).     
-00020190: 2020 206e 756d 5f77 7269 7465 7320 3d20     num_writes = 
-000201a0: 3130 0a0a 2020 2020 2020 2020 6465 6620  10..        def 
-000201b0: 6372 6561 7465 5f61 7272 6179 2874 6172  create_array(tar
-000201c0: 6765 745f 7061 7468 2c20 6473 6861 7065  get_path, dshape
-000201d0: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
-000201e0: 6f6d 203d 2074 696c 6564 622e 446f 6d61  om = tiledb.Doma
-000201f0: 696e 2874 696c 6564 622e 4469 6d28 646f  in(tiledb.Dim(do
-00020200: 6d61 696e 3d64 7368 6170 652c 2074 696c  main=dshape, til
-00020210: 653d 6c65 6e28 6473 6861 7065 2929 290a  e=len(dshape))).
-00020220: 2020 2020 2020 2020 2020 2020 6174 7420              att 
-00020230: 3d20 7469 6c65 6462 2e41 7474 7228 6474  = tiledb.Attr(dt
-00020240: 7970 653d 2269 6e74 3634 2229 0a20 2020  ype="int64").   
-00020250: 2020 2020 2020 2020 2073 6368 656d 6120           schema 
-00020260: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
-00020270: 6865 6d61 2864 6f6d 6169 6e3d 646f 6d2c  hema(domain=dom,
-00020280: 2061 7474 7273 3d28 6174 742c 292c 2073   attrs=(att,), s
-00020290: 7061 7273 653d 5472 7565 290a 2020 2020  parse=True).    
-000202a0: 2020 2020 2020 2020 7469 6c65 6462 2e6c          tiledb.l
-000202b0: 6962 7469 6c65 6462 2e41 7272 6179 2e63  ibtiledb.Array.c
-000202c0: 7265 6174 6528 7461 7267 6574 5f70 6174  reate(target_pat
-000202d0: 682c 2073 6368 656d 6129 0a0a 2020 2020  h, schema)..    
-000202e0: 2020 2020 6465 6620 7772 6974 655f 6672      def write_fr
-000202f0: 6167 6d65 6e74 7328 7461 7267 6574 5f70  agments(target_p
-00020300: 6174 682c 2064 7368 6170 652c 206e 756d  ath, dshape, num
-00020310: 5f77 7269 7465 7329 3a0a 2020 2020 2020  _writes):.      
-00020320: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00020330: 616e 6765 2831 2c20 6e75 6d5f 7772 6974  ange(1, num_writ
-00020340: 6573 202b 2031 293a 0a20 2020 2020 2020  es + 1):.       
-00020350: 2020 2020 2020 2020 2077 6974 6820 7469           with ti
-00020360: 6c65 6462 2e6f 7065 6e28 7461 7267 6574  ledb.open(target
-00020370: 5f70 6174 682c 2022 7722 2c20 7469 6d65  _path, "w", time
-00020380: 7374 616d 703d 6929 2061 7320 413a 0a20  stamp=i) as A:. 
-00020390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000203a0: 2020 2041 5b5b 312c 2032 2c20 335d 5d20     A[[1, 2, 3]] 
-000203b0: 3d20 6e70 2e72 616e 646f 6d2e 7261 6e64  = np.random.rand
-000203c0: 2864 7368 6170 655b 315d 290a 0a20 2020  (dshape[1])..   
-000203d0: 2020 2020 2070 6174 6820 3d20 7365 6c66       path = self
-000203e0: 2e70 6174 6828 2274 6573 745f 6172 7261  .path("test_arra
-000203f0: 795f 636f 6e73 6f6c 6964 6174 655f 7769  y_consolidate_wi
-00020400: 7468 5f74 696d 6573 7461 6d70 2229 0a0a  th_timestamp")..
-00020410: 2020 2020 2020 2020 6372 6561 7465 5f61          create_a
-00020420: 7272 6179 2870 6174 682c 2064 7368 6170  rray(path, dshap
-00020430: 6529 0a20 2020 2020 2020 2077 7269 7465  e).        write
-00020440: 5f66 7261 676d 656e 7473 2870 6174 682c  _fragments(path,
-00020450: 2064 7368 6170 652c 206e 756d 5f77 7269   dshape, num_wri
-00020460: 7465 7329 0a20 2020 2020 2020 2066 7261  tes).        fra
-00020470: 6773 203d 2074 696c 6564 622e 4672 6167  gs = tiledb.Frag
-00020480: 6d65 6e74 496e 666f 4c69 7374 2870 6174  mentInfoList(pat
-00020490: 6829 0a20 2020 2020 2020 2061 7373 6572  h).        asser
-000204a0: 7420 6c65 6e28 6672 6167 7329 203d 3d20  t len(frags) == 
-000204b0: 3130 0a0a 2020 2020 2020 2020 7469 6c65  10..        tile
-000204c0: 6462 2e63 6f6e 736f 6c69 6461 7465 2870  db.consolidate(p
-000204d0: 6174 682c 2074 696d 6573 7461 6d70 3d28  ath, timestamp=(
-000204e0: 312c 2034 2929 0a20 2020 2020 2020 2066  1, 4)).        f
-000204f0: 7261 6773 203d 2074 696c 6564 622e 4672  rags = tiledb.Fr
-00020500: 6167 6d65 6e74 496e 666f 4c69 7374 2870  agmentInfoList(p
-00020510: 6174 6829 0a20 2020 2020 2020 2061 7373  ath).        ass
-00020520: 6572 7420 6c65 6e28 6672 6167 7329 203d  ert len(frags) =
-00020530: 3d20 370a 2020 2020 2020 2020 6173 7365  = 7.        asse
-00020540: 7274 2066 7261 6773 2e74 6f5f 7661 6375  rt frags.to_vacu
-00020550: 756d 5f6e 756d 203d 3d20 340a 0a20 2020  um_num == 4..   
-00020560: 2020 2020 2074 696c 6564 622e 7661 6375       tiledb.vacu
-00020570: 756d 2870 6174 682c 2074 696d 6573 7461  um(path, timesta
-00020580: 6d70 3d28 312c 2032 2929 0a20 2020 2020  mp=(1, 2)).     
-00020590: 2020 2066 7261 6773 203d 2074 696c 6564     frags = tiled
-000205a0: 622e 4672 6167 6d65 6e74 496e 666f 4c69  b.FragmentInfoLi
-000205b0: 7374 2870 6174 6829 0a20 2020 2020 2020  st(path).       
-000205c0: 2061 7373 6572 7420 6672 6167 732e 746f   assert frags.to
-000205d0: 5f76 6163 7575 6d5f 6e75 6d20 3d3d 2032  _vacuum_num == 2
-000205e0: 0a0a 2020 2020 2020 2020 7469 6c65 6462  ..        tiledb
-000205f0: 2e76 6163 7575 6d28 7061 7468 290a 2020  .vacuum(path).  
-00020600: 2020 2020 2020 6672 6167 7320 3d20 7469        frags = ti
-00020610: 6c65 6462 2e46 7261 676d 656e 7449 6e66  ledb.FragmentInf
-00020620: 6f4c 6973 7428 7061 7468 290a 2020 2020  oList(path).    
-00020630: 2020 2020 6173 7365 7274 2066 7261 6773      assert frags
-00020640: 2e74 6f5f 7661 6375 756d 5f6e 756d 203d  .to_vacuum_num =
-00020650: 3d20 300a 0a20 2020 2020 2020 2063 6f6e  = 0..        con
-00020660: 6620 3d20 7469 6c65 6462 2e43 6f6e 6669  f = tiledb.Confi
-00020670: 6728 0a20 2020 2020 2020 2020 2020 207b  g(.            {
-00020680: 2273 6d2e 636f 6e73 6f6c 6964 6174 696f  "sm.consolidatio
-00020690: 6e2e 7469 6d65 7374 616d 705f 7374 6172  n.timestamp_star
-000206a0: 7422 3a20 352c 2022 736d 2e63 6f6e 736f  t": 5, "sm.conso
-000206b0: 6c69 6461 7469 6f6e 2e74 696d 6573 7461  lidation.timesta
-000206c0: 6d70 5f65 6e64 223a 2039 7d0a 2020 2020  mp_end": 9}.    
-000206d0: 2020 2020 290a 2020 2020 2020 2020 7469      ).        ti
-000206e0: 6c65 6462 2e63 6f6e 736f 6c69 6461 7465  ledb.consolidate
-000206f0: 2870 6174 682c 2063 6f6e 6669 673d 636f  (path, config=co
-00020700: 6e66 290a 2020 2020 2020 2020 7469 6c65  nf).        tile
-00020710: 6462 2e76 6163 7575 6d28 7061 7468 290a  db.vacuum(path).
-00020720: 2020 2020 2020 2020 6672 6167 7320 3d20          frags = 
-00020730: 7469 6c65 6462 2e46 7261 676d 656e 7449  tiledb.FragmentI
-00020740: 6e66 6f4c 6973 7428 7061 7468 290a 2020  nfoList(path).  
-00020750: 2020 2020 2020 6173 7365 7274 206c 656e        assert len
-00020760: 2866 7261 6773 2e74 696d 6573 7461 6d70  (frags.timestamp
-00020770: 5f72 616e 6765 2920 3d3d 2033 0a0a 0a40  _range) == 3...@
-00020780: 7079 7465 7374 2e6d 6172 6b2e 736b 6970  pytest.mark.skip
-00020790: 6966 2873 7973 2e70 6c61 7466 6f72 6d20  if(sys.platform 
-000207a0: 3d3d 2022 7769 6e33 3222 2c20 7265 6173  == "win32", reas
-000207b0: 6f6e 3d22 4f6e 6c79 2072 756e 204d 656d  on="Only run Mem
-000207c0: 6f72 7954 6573 7420 6f6e 206c 696e 7578  oryTest on linux
-000207d0: 2229 0a63 6c61 7373 204d 656d 6f72 7954  ").class MemoryT
-000207e0: 6573 7428 4469 736b 5465 7374 4361 7365  est(DiskTestCase
-000207f0: 293a 0a20 2020 2023 2073 616e 6974 7920  ):.    # sanity 
-00020800: 6368 6563 6b20 7468 6174 206d 656d 6f72  check that memor
-00020810: 7920 7573 6167 6520 646f 6573 6e27 7420  y usage doesn't 
-00020820: 696e 6372 6561 7365 206d 6f72 6520 7468  increase more th
-00020830: 616e 2032 7820 7768 656e 2072 6561 6469  an 2x when readi
-00020840: 6e67 2034 304d 4220 3130 3078 0a20 2020  ng 40MB 100x.   
-00020850: 2023 2068 7474 7073 3a2f 2f67 6974 6875   # https://githu
-00020860: 622e 636f 6d2f 5469 6c65 4442 2d49 6e63  b.com/TileDB-Inc
-00020870: 2f54 696c 6544 422d 5079 2f69 7373 7565  /TileDB-Py/issue
-00020880: 732f 3135 300a 2020 2020 4073 7461 7469  s/150.    @stati
-00020890: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-000208a0: 7573 655f 6d61 6e79 5f62 7566 6665 7273  use_many_buffers
-000208b0: 2870 6174 6829 3a0a 2020 2020 2020 2020  (path):.        
-000208c0: 2320 6874 7470 733a 2f2f 7374 6163 6b6f  # https://stacko
-000208d0: 7665 7266 6c6f 772e 636f 6d2f 7175 6573  verflow.com/ques
-000208e0: 7469 6f6e 732f 3933 3837 3333 2f74 6f74  tions/938733/tot
-000208f0: 616c 2d6d 656d 6f72 792d 7573 6564 2d62  al-memory-used-b
-00020900: 792d 7079 7468 6f6e 2d70 726f 6365 7373  y-python-process
-00020910: 0a20 2020 2020 2020 2070 726f 6365 7373  .        process
-00020920: 203d 2070 7375 7469 6c2e 5072 6f63 6573   = psutil.Proces
-00020930: 7328 6f73 2e67 6574 7069 6428 2929 0a0a  s(os.getpid())..
-00020940: 2020 2020 2020 2020 7820 3d20 6e70 2e6f          x = np.o
-00020950: 6e65 7328 3130 3030 3030 3030 2c20 6474  nes(10000000, dt
-00020960: 7970 653d 6e70 2e66 6c6f 6174 3332 290a  ype=np.float32).
-00020970: 2020 2020 2020 2020 6431 203d 2074 696c          d1 = til
-00020980: 6564 622e 4469 6d28 0a20 2020 2020 2020  edb.Dim(.       
-00020990: 2020 2020 2022 7465 7374 5f64 6f6d 6169       "test_domai
-000209a0: 6e22 2c20 646f 6d61 696e 3d28 302c 2078  n", domain=(0, x
-000209b0: 2e73 6861 7065 5b30 5d20 2d20 3129 2c20  .shape[0] - 1), 
-000209c0: 7469 6c65 3d31 3030 3030 2c20 6474 7970  tile=10000, dtyp
-000209d0: 653d 2275 696e 7433 3222 0a20 2020 2020  e="uint32".     
-000209e0: 2020 2029 0a20 2020 2020 2020 2064 6f6d     ).        dom
-000209f0: 6169 6e20 3d20 7469 6c65 6462 2e44 6f6d  ain = tiledb.Dom
-00020a00: 6169 6e28 6431 290a 2020 2020 2020 2020  ain(d1).        
-00020a10: 7620 3d20 7469 6c65 6462 2e41 7474 7228  v = tiledb.Attr(
-00020a20: 2274 6573 745f 7661 6c75 6522 2c20 6474  "test_value", dt
-00020a30: 7970 653d 2266 6c6f 6174 3332 2229 0a0a  ype="float32")..
-00020a40: 2020 2020 2020 2020 7363 6865 6d61 203d          schema =
-00020a50: 2074 696c 6564 622e 4172 7261 7953 6368   tiledb.ArraySch
-00020a60: 656d 6128 0a20 2020 2020 2020 2020 2020  ema(.           
-00020a70: 2064 6f6d 6169 6e3d 646f 6d61 696e 2c20   domain=domain, 
-00020a80: 6174 7472 733d 2876 2c29 2c20 6365 6c6c  attrs=(v,), cell
-00020a90: 5f6f 7264 6572 3d22 726f 772d 6d61 6a6f  _order="row-majo
-00020aa0: 7222 2c20 7469 6c65 5f6f 7264 6572 3d22  r", tile_order="
-00020ab0: 726f 772d 6d61 6a6f 7222 0a20 2020 2020  row-major".     
-00020ac0: 2020 2029 0a0a 2020 2020 2020 2020 4120     )..        A 
-00020ad0: 3d20 7469 6c65 6462 2e44 656e 7365 4172  = tiledb.DenseAr
-00020ae0: 7261 792e 6372 6561 7465 2870 6174 682c  ray.create(path,
-00020af0: 2073 6368 656d 6129 0a0a 2020 2020 2020   schema)..      
-00020b00: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
-00020b10: 6e73 6541 7272 6179 2870 6174 682c 206d  nseArray(path, m
-00020b20: 6f64 653d 2277 2229 2061 7320 413a 0a20  ode="w") as A:. 
-00020b30: 2020 2020 2020 2020 2020 2041 5b3a 5d20             A[:] 
-00020b40: 3d20 7b22 7465 7374 5f76 616c 7565 223a  = {"test_value":
-00020b50: 2078 7d0a 0a20 2020 2020 2020 2077 6974   x}..        wit
-00020b60: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
-00020b70: 7261 7928 7061 7468 2c20 6d6f 6465 3d22  ray(path, mode="
-00020b80: 7222 2920 6173 2064 6174 613a 0a20 2020  r") as data:.   
-00020b90: 2020 2020 2020 2020 2064 6174 615b 3a5d           data[:]
-00020ba0: 0a20 2020 2020 2020 2020 2020 2069 6e69  .            ini
-00020bb0: 7469 616c 203d 2070 726f 6365 7373 2e6d  tial = process.m
-00020bc0: 656d 6f72 795f 696e 666f 2829 2e72 7373  emory_info().rss
-00020bd0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00020be0: 6e74 2822 2020 696e 6974 6961 6c20 5253  nt("  initial RS
-00020bf0: 533a 207b 7d22 2e66 6f72 6d61 7428 726f  S: {}".format(ro
-00020c00: 756e 6428 696e 6974 6961 6c20 2f20 2831  und(initial / (1
-00020c10: 3020 2a2a 2036 2929 2c20 3229 290a 2020  0 ** 6)), 2)).  
-00020c20: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
-00020c30: 696e 2072 616e 6765 2831 3030 293a 0a20  in range(100):. 
-00020c40: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00020c50: 2072 6561 6420 6275 7420 646f 6e27 7420   read but don't 
-00020c60: 7374 6f72 653a 2074 6869 7320 6d65 6d6f  store: this memo
-00020c70: 7279 2073 686f 756c 6420 6265 2066 7265  ry should be fre
-00020c80: 6564 0a20 2020 2020 2020 2020 2020 2020  ed.             
-00020c90: 2020 2064 6174 615b 3a5d 0a0a 2020 2020     data[:]..    
-00020ca0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00020cb0: 2025 2031 3020 3d3d 2030 3a0a 2020 2020   % 10 == 0:.    
-00020cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020cd0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
-00020ce0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00020cf0: 2020 2020 7265 6164 2069 7465 7220 7b7d      read iter {}
-00020d00: 2c20 5253 5320 284d 4229 3a20 7b7d 222e  , RSS (MB): {}".
-00020d10: 666f 726d 6174 280a 2020 2020 2020 2020  format(.        
-00020d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d30: 2020 2020 692c 2072 6f75 6e64 2870 726f      i, round(pro
-00020d40: 6365 7373 2e6d 656d 6f72 795f 696e 666f  cess.memory_info
-00020d50: 2829 2e72 7373 202f 2028 3130 202a 2a20  ().rss / (10 ** 
-00020d60: 3629 2c20 3229 0a20 2020 2020 2020 2020  6), 2).         
-00020d70: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00020d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020d90: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00020da0: 7265 7475 726e 2069 6e69 7469 616c 0a0a  return initial..
-00020db0: 2020 2020 6465 6620 7465 7374 5f6d 656d      def test_mem
-00020dc0: 6f72 795f 636c 6561 6e75 7028 7365 6c66  ory_cleanup(self
-00020dd0: 2c20 6361 7066 6429 3a0a 2020 2020 2020  , capfd):.      
-00020de0: 2020 2320 7275 6e20 6675 6e63 7469 6f6e    # run function
-00020df0: 2077 6869 6368 2072 6561 6473 2031 3030   which reads 100
-00020e00: 7820 6672 6f6d 2061 2034 304d 4220 7465  x from a 40MB te
-00020e10: 7374 2061 7272 6179 0a20 2020 2020 2020  st array.       
-00020e20: 2023 2054 4f44 4f3a 2052 5353 2069 7320   # TODO: RSS is 
-00020e30: 746f 6f20 6c6f 6f73 6520 746f 2064 6f20  too loose to do 
-00020e40: 7468 6973 2065 6e64 2d74 6f2d 656e 642c  this end-to-end,
-00020e50: 2073 6f20 7368 6f75 6c64 2075 7365 2069   so should use i
-00020e60: 6e73 7472 756d 656e 7461 7469 6f6e 2e0a  nstrumentation..
-00020e70: 2020 2020 2020 2020 7072 696e 7428 2253          print("S
-00020e80: 7461 7274 696e 6720 5469 6c65 4442 2d50  tarting TileDB-P
-00020e90: 7920 6d65 6d6f 7279 2074 6573 743a 2229  y memory test:")
-00020ea0: 0a20 2020 2020 2020 2069 6e69 7469 616c  .        initial
-00020eb0: 203d 2073 656c 662e 7573 655f 6d61 6e79   = self.use_many
-00020ec0: 5f62 7566 6665 7273 2873 656c 662e 7061  _buffers(self.pa
-00020ed0: 7468 2822 7465 7374 5f6d 656d 6f72 795f  th("test_memory_
-00020ee0: 636c 6561 6e75 7022 2929 0a0a 2020 2020  cleanup"))..    
-00020ef0: 2020 2020 7072 6f63 6573 7320 3d20 7073      process = ps
-00020f00: 7574 696c 2e50 726f 6365 7373 286f 732e  util.Process(os.
-00020f10: 6765 7470 6964 2829 290a 2020 2020 2020  getpid()).      
-00020f20: 2020 6669 6e61 6c20 3d20 7072 6f63 6573    final = proces
-00020f30: 732e 6d65 6d6f 7279 5f69 6e66 6f28 292e  s.memory_info().
-00020f40: 7273 730a 2020 2020 2020 2020 7072 696e  rss.        prin
-00020f50: 7428 2220 2066 696e 616c 2052 5353 3a20  t("  final RSS: 
-00020f60: 7b7d 222e 666f 726d 6174 2872 6f75 6e64  {}".format(round
-00020f70: 2866 696e 616c 202f 2028 3130 202a 2a20  (final / (10 ** 
-00020f80: 3629 292c 2032 2929 0a0a 2020 2020 2020  6)), 2))..      
-00020f90: 2020 6763 2e63 6f6c 6c65 6374 2829 0a0a    gc.collect()..
-00020fa0: 2020 2020 2020 2020 6669 6e61 6c5f 6763          final_gc
-00020fb0: 203d 2070 726f 6365 7373 2e6d 656d 6f72   = process.memor
-00020fc0: 795f 696e 666f 2829 2e72 7373 0a20 2020  y_info().rss.   
-00020fd0: 2020 2020 2070 7269 6e74 2822 2020 6669       print("  fi
-00020fe0: 6e61 6c20 5253 5320 6166 7465 7220 666f  nal RSS after fo
-00020ff0: 7263 6564 2047 433a 207b 7d22 2e66 6f72  rced GC: {}".for
-00021000: 6d61 7428 726f 756e 6428 6669 6e61 6c5f  mat(round(final_
-00021010: 6763 202f 2028 3130 202a 2a20 3629 292c  gc / (10 ** 6)),
-00021020: 2032 2929 0a0a 2020 2020 2020 2020 6173   2))..        as
-00021030: 7365 7274 5f63 6170 7475 7265 6428 6361  sert_captured(ca
-00021040: 7066 642c 2022 6669 6e61 6c20 5253 5322  pfd, "final RSS"
-00021050: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00021060: 7373 6572 7454 7275 6528 6669 6e61 6c20  ssertTrue(final 
-00021070: 3c20 2832 202a 2069 6e69 7469 616c 2929  < (2 * initial))
-00021080: 0a0a 0a63 6c61 7373 2054 6573 7448 6967  ...class TestHig
-00021090: 686c 6576 656c 2844 6973 6b54 6573 7443  hlevel(DiskTestC
-000210a0: 6173 6529 3a0a 2020 2020 6465 6620 7465  ase):.    def te
-000210b0: 7374 5f6f 7065 6e28 7365 6c66 293a 0a20  st_open(self):. 
-000210c0: 2020 2020 2020 2075 7269 203d 2073 656c         uri = sel
-000210d0: 662e 7061 7468 2822 7465 7374 5f6f 7065  f.path("test_ope
-000210e0: 6e22 290a 2020 2020 2020 2020 6172 7261  n").        arra
-000210f0: 7920 3d20 6e70 2e72 616e 646f 6d2e 7261  y = np.random.ra
-00021100: 6e64 2831 3029 0a20 2020 2020 2020 2073  nd(10).        s
-00021110: 6368 656d 6120 3d20 7469 6c65 6462 2e73  chema = tiledb.s
-00021120: 6368 656d 615f 6c69 6b65 2861 7272 6179  chema_like(array
-00021130: 290a 2020 2020 2020 2020 7469 6c65 6462  ).        tiledb
-00021140: 2e41 7272 6179 2e63 7265 6174 6528 7572  .Array.create(ur
-00021150: 692c 2073 6368 656d 6129 0a20 2020 2020  i, schema).     
-00021160: 2020 2077 6974 6820 7469 6c65 6462 2e6f     with tiledb.o
-00021170: 7065 6e28 7572 692c 2022 7722 2920 6173  pen(uri, "w") as
-00021180: 2041 3a0a 2020 2020 2020 2020 2020 2020   A:.            
-00021190: 415b 3a5d 203d 2061 7272 6179 202a 2031  A[:] = array * 1
-000211a0: 300a 2020 2020 2020 2020 2020 2020 415b  0.            A[
-000211b0: 3a5d 203d 2061 7272 6179 0a20 2020 2020  :] = array.     
-000211c0: 2020 2020 2020 206c 6173 745f 6672 6167         last_frag
-000211d0: 6d65 6e74 5f74 7320 3d20 6c69 7374 2841  ment_ts = list(A
-000211e0: 2e6c 6173 745f 7772 6974 655f 696e 666f  .last_write_info
-000211f0: 2e69 7465 6d73 2829 295b 305d 5b31 5d5b  .items())[0][1][
-00021200: 305d 0a0a 2020 2020 2020 2020 6374 7820  0]..        ctx 
-00021210: 3d20 7469 6c65 6462 2e43 7478 2829 0a20  = tiledb.Ctx(). 
-00021220: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
-00021230: 6462 2e44 656e 7365 4172 7261 7928 7572  db.DenseArray(ur
-00021240: 692c 2063 7478 3d63 7478 2920 6173 2041  i, ctx=ctx) as A
-00021250: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00021260: 6c66 2e61 7373 6572 7445 7175 616c 2841  lf.assertEqual(A
-00021270: 2e5f 6374 785f 2829 2c20 6374 7829 0a0a  ._ctx_(), ctx)..
-00021280: 2020 2020 2020 2020 2320 7465 7374 2060          # test `
-00021290: 6f70 656e 6020 7769 7468 2074 696d 6573  open` with times
-000212a0: 7461 6d70 0a20 2020 2020 2020 2077 6974  tamp.        wit
-000212b0: 6820 7469 6c65 6462 2e6f 7065 6e28 7572  h tiledb.open(ur
-000212c0: 692c 2074 696d 6573 7461 6d70 3d6c 6173  i, timestamp=las
-000212d0: 745f 6672 6167 6d65 6e74 5f74 7329 2061  t_fragment_ts) a
-000212e0: 7320 413a 0a20 2020 2020 2020 2020 2020  s A:.           
-000212f0: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-00021300: 7561 6c28 415b 3a5d 2c20 6172 7261 7929  ual(A[:], array)
-00021310: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
-00021320: 696c 6564 622e 6f70 656e 2875 7269 2c20  iledb.open(uri, 
-00021330: 6374 783d 6374 7829 2061 7320 413a 0a20  ctx=ctx) as A:. 
-00021340: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00021350: 6173 7365 7274 4571 7561 6c28 412e 5f63  assertEqual(A._c
-00021360: 7478 5f28 292c 2063 7478 290a 0a20 2020  tx_(), ctx)..   
-00021370: 2020 2020 2063 6f6e 6669 6720 3d20 7469       config = ti
-00021380: 6c65 6462 2e43 6f6e 6669 6728 290a 2020  ledb.Config().  
-00021390: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-000213a0: 622e 6f70 656e 2875 7269 2c20 636f 6e66  b.open(uri, conf
-000213b0: 6967 3d63 6f6e 6669 6729 2061 7320 413a  ig=config) as A:
-000213c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000213d0: 662e 6173 7365 7274 4571 7561 6c28 412e  f.assertEqual(A.
-000213e0: 5f63 7478 5f28 292e 636f 6e66 6967 2829  _ctx_().config()
-000213f0: 2c20 636f 6e66 6967 290a 0a20 2020 2020  , config)..     
-00021400: 2020 2077 6974 6820 7365 6c66 2e61 7373     with self.ass
-00021410: 6572 7452 6169 7365 7328 4b65 7945 7272  ertRaises(KeyErr
-00021420: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
-00021430: 2023 2054 6869 7320 7061 7468 206d 7573   # This path mus
-00021440: 7420 7465 7374 2060 7469 6c65 6462 2e6f  t test `tiledb.o
-00021450: 7065 6e60 2073 7065 6369 6669 6361 6c6c  pen` specificall
-00021460: 790a 2020 2020 2020 2020 2020 2020 2320  y.            # 
-00021470: 6874 7470 733a 2f2f 6769 7468 7562 2e63  https://github.c
-00021480: 6f6d 2f54 696c 6544 422d 496e 632f 5469  om/TileDB-Inc/Ti
-00021490: 6c65 4442 2d50 792f 6973 7375 6573 2f32  leDB-Py/issues/2
-000214a0: 3737 0a20 2020 2020 2020 2020 2020 2074  77.            t
-000214b0: 696c 6564 622e 6f70 656e 2875 7269 2c20  iledb.open(uri, 
-000214c0: 2272 222c 2061 7474 723d 2274 6865 2d6d  "r", attr="the-m
-000214d0: 6973 7369 6e67 2d61 7474 7222 290a 0a20  issing-attr").. 
-000214e0: 2020 2064 6566 2074 6573 745f 6374 785f     def test_ctx_
-000214f0: 7468 7265 6164 5f63 6c65 616e 7570 2873  thread_cleanup(s
-00021500: 656c 6629 3a0a 2020 2020 2020 2020 2320  elf):.        # 
-00021510: 5468 6973 2074 6573 7420 6368 6563 6b73  This test checks
-00021520: 2074 6861 7420 636f 6e74 6578 7473 2061   that contexts a
-00021530: 7265 2064 6573 7472 6f79 6564 2063 6f72  re destroyed cor
-00021540: 7265 6374 6c79 2e0a 2020 2020 2020 2020  rectly..        
-00021550: 2320 4974 2063 7265 6174 6573 206e 6577  # It creates new
-00021560: 2063 6f6e 7465 7874 7320 7265 7065 6174   contexts repeat
-00021570: 6564 6c79 2c20 696e 2d70 726f 6365 7373  edly, in-process
-00021580: 2c20 616e 640a 2020 2020 2020 2020 2320  , and.        # 
-00021590: 6368 6563 6b73 2074 6861 7420 7468 6520  checks that the 
-000215a0: 746f 7461 6c20 6e75 6d62 6572 206f 6620  total number of 
-000215b0: 7468 7265 6164 7320 7374 6179 7320 7374  threads stays st
-000215c0: 6162 6c65 2e0a 2020 2020 2020 2020 636f  able..        co
-000215d0: 6e66 6967 203d 207b 2273 6d2e 6e75 6d5f  nfig = {"sm.num_
-000215e0: 7265 6164 6572 5f74 6872 6561 6473 223a  reader_threads":
-000215f0: 2031 3238 7d0a 2020 2020 2020 2020 6c6c   128}.        ll
-00021600: 203d 206c 6973 7428 290a 2020 2020 2020   = list().      
-00021610: 2020 7572 6920 3d20 7365 6c66 2e70 6174    uri = self.pat
-00021620: 6828 2274 6573 745f 6374 785f 7468 7265  h("test_ctx_thre
-00021630: 6164 5f63 6c65 616e 7570 2229 0a20 2020  ad_cleanup").   
-00021640: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-00021650: 2e66 726f 6d5f 6e75 6d70 7928 7572 692c  .from_numpy(uri,
-00021660: 206e 702e 7261 6e64 6f6d 2e72 616e 6428   np.random.rand(
-00021670: 3130 3029 2920 6173 2041 3a0a 2020 2020  100)) as A:.    
-00021680: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
-00021690: 2020 2020 2020 7468 6973 7072 6f63 203d        thisproc =
-000216a0: 2070 7375 7469 6c2e 5072 6f63 6573 7328   psutil.Process(
-000216b0: 6f73 2e67 6574 7069 6428 2929 0a0a 2020  os.getpid())..  
-000216c0: 2020 2020 2020 666f 7220 6e20 696e 2072        for n in r
-000216d0: 616e 6765 2830 2c20 3130 293a 0a20 2020  ange(0, 10):.   
-000216e0: 2020 2020 2020 2020 2069 6620 6e20 3e20           if n > 
-000216f0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00021700: 2020 2072 6574 7279 203d 2030 0a20 2020     retry = 0.   
-00021710: 2020 2020 2020 2020 2020 2020 2077 6869               whi
-00021720: 6c65 2072 6574 7279 203c 2033 3a0a 2020  le retry < 3:.  
-00021730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021740: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00021750: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00021760: 2063 6865 636b 696e 6720 6578 6163 7420   checking exact 
-00021770: 7468 7265 6164 2063 6f75 6e74 2069 7320  thread count is 
-00021780: 756e 7265 6c69 6162 6c65 2c20 736f 0a20  unreliable, so. 
-00021790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000217a0: 2020 2020 2020 2023 206d 616b 6520 7375         # make su
-000217b0: 7265 2077 6520 6172 6520 686f 6c64 696e  re we are holdin
-000217c0: 6720 3c20 3278 2070 6572 2072 756e 2e0a  g < 2x per run..
-000217d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000217e0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
-000217f0: 6572 7454 7275 6528 6c65 6e28 7468 6973  ertTrue(len(this
-00021800: 7072 6f63 2e74 6872 6561 6473 2829 2920  proc.threads()) 
-00021810: 3c20 3220 2a20 7374 6172 745f 7468 7265  < 2 * start_thre
-00021820: 6164 7329 0a20 2020 2020 2020 2020 2020  ads).           
-00021830: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00021840: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-00021850: 2020 2020 2020 2065 7863 6570 7420 4173         except As
-00021860: 7365 7274 696f 6e45 7272 6f72 2061 7320  sertionError as 
-00021870: 6578 633a 0a20 2020 2020 2020 2020 2020  exc:.           
-00021880: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00021890: 7365 2065 7863 0a20 2020 2020 2020 2020  se exc.         
-000218a0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000218b0: 7420 5275 6e74 696d 6545 7272 6f72 2061  t RuntimeError a
-000218c0: 7320 7274 6572 723a 0a20 2020 2020 2020  s rterr:.       
-000218d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000218e0: 2072 6574 7279 202b 3d20 310a 2020 2020   retry += 1.    
-000218f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021900: 2020 2020 6966 2072 6574 7279 203e 2032      if retry > 2
-00021910: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00021920: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00021930: 6973 6520 7274 6572 720a 2020 2020 2020  ise rterr.      
-00021940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021950: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
-00021960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021970: 2020 2020 2020 2020 2020 2020 2022 5468               "Th
-00021980: 7265 6164 2063 6c65 616e 7570 2074 6573  read cleanup tes
-00021990: 7420 5275 6e74 696d 6545 7272 6f72 3a20  t RuntimeError: 
-000219a0: 7b7d 205c 6e20 2020 206f 6e20 6974 6572  {} \n    on iter
-000219b0: 6174 696f 6e3a 207b 7d22 2e66 6f72 6d61  ation: {}".forma
-000219c0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-000219d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000219e0: 2020 2073 7472 2872 7465 7272 292c 206e     str(rterr), n
-000219f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021a00: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00021a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a20: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00021a30: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-00021a40: 622e 4465 6e73 6541 7272 6179 2875 7269  b.DenseArray(uri
-00021a50: 2c20 6374 783d 7469 6c65 6462 2e43 7478  , ctx=tiledb.Ctx
-00021a60: 2863 6f6e 6669 6729 2920 6173 2041 3a0a  (config)) as A:.
-00021a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a80: 7265 7320 3d20 415b 3a5d 0a0a 2020 2020  res = A[:]..    
-00021a90: 2020 2020 2020 2020 6966 206e 203d 3d20          if n == 
-00021aa0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00021ab0: 2020 2073 7461 7274 5f74 6872 6561 6473     start_threads
-00021ac0: 203d 206c 656e 2874 6869 7370 726f 632e   = len(thisproc.
-00021ad0: 7468 7265 6164 7328 2929 0a0a 0a23 2057  threads())...# W
-00021ae0: 7261 7070 6572 2074 6f20 6578 6563 7574  rapper to execut
-00021af0: 6520 7370 6563 6966 6963 2063 6f64 6520  e specific code 
-00021b00: 696e 2073 7562 7072 6f63 6573 7320 736f  in subprocess so
-00021b10: 2074 6861 7420 7765 2063 616e 2065 6e73   that we can ens
-00021b20: 7572 6520 7468 6520 7468 7265 6164 2063  ure the thread c
-00021b30: 6f75 6e74 0a23 2069 6e69 7420 6973 2063  ount.# init is c
-00021b40: 6f72 7265 6374 2e20 4e65 6365 7373 6172  orrect. Necessar
-00021b50: 7920 6265 6361 7573 6520 6d75 6c74 6970  y because multip
-00021b60: 726f 6365 7373 2e67 6574 5f63 6f6e 7465  rocess.get_conte
-00021b70: 7874 2069 7320 6f6e 6c79 2061 7661 696c  xt is only avail
-00021b80: 6162 6c65 2069 6e20 5079 7468 6f6e 2033  able in Python 3
-00021b90: 2e34 2b2c 0a23 2061 6e64 2074 6865 206d  .4+,.# and the m
-00021ba0: 756c 7469 7072 6f63 6573 7369 6e67 206d  ultiprocessing m
-00021bb0: 6574 686f 6420 6d61 7920 6265 2073 6574  ethod may be set
-00021bc0: 2074 6f20 666f 726b 2062 7920 6f74 6865   to fork by othe
-00021bd0: 7220 7465 7374 7320 2865 2e67 2e20 6461  r tests (e.g. da
-00021be0: 736b 292e 0a64 6566 2069 6e69 745f 7465  sk)..def init_te
-00021bf0: 7374 5f77 7261 7070 6572 2863 6667 3d4e  st_wrapper(cfg=N
-00021c00: 6f6e 6529 3a0a 2020 2020 7079 7468 6f6e  one):.    python
-00021c10: 5f65 7865 203d 2073 7973 2e65 7865 6375  _exe = sys.execu
-00021c20: 7461 626c 650a 2020 2020 636d 6420 3d20  table.    cmd = 
-00021c30: 2266 726f 6d20 7465 7374 5f6c 6962 7469  "from test_libti
-00021c40: 6c65 6462 2069 6d70 6f72 7420 2a3b 2069  ledb import *; i
-00021c50: 6e69 745f 7465 7374 5f68 656c 7065 7228  nit_test_helper(
-00021c60: 7b7d 2922 2e66 6f72 6d61 7428 6366 6729  {})".format(cfg)
-00021c70: 0a20 2020 2074 6573 745f 7061 7468 203d  .    test_path =
-00021c80: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
-00021c90: 286f 732e 7061 7468 2e61 6273 7061 7468  (os.path.abspath
-00021ca0: 285f 5f66 696c 655f 5f29 290a 0a20 2020  (__file__))..   
-00021cb0: 2073 705f 6f75 7470 7574 203d 2073 7562   sp_output = sub
-00021cc0: 7072 6f63 6573 732e 6368 6563 6b5f 6f75  process.check_ou
-00021cd0: 7470 7574 285b 7079 7468 6f6e 5f65 7865  tput([python_exe
-00021ce0: 2c20 222d 6322 2c20 636d 645d 2c20 6377  , "-c", cmd], cw
-00021cf0: 643d 7465 7374 5f70 6174 6829 0a20 2020  d=test_path).   
-00021d00: 2072 6574 7572 6e20 696e 7428 7370 5f6f   return int(sp_o
-00021d10: 7574 7075 742e 6465 636f 6465 2822 5554  utput.decode("UT
-00021d20: 462d 3822 292e 7374 7269 7028 2929 0a0a  F-8").strip())..
-00021d30: 0a64 6566 2069 6e69 745f 7465 7374 5f68  .def init_test_h
-00021d40: 656c 7065 7228 6366 673d 4e6f 6e65 293a  elper(cfg=None):
-00021d50: 0a20 2020 2074 696c 6564 622e 6c69 6274  .    tiledb.libt
-00021d60: 696c 6564 622e 6465 6661 756c 745f 6374  iledb.default_ct
-00021d70: 7828 6366 6729 0a20 2020 2063 6f6e 6375  x(cfg).    concu
-00021d80: 7272 656e 6379 5f6c 6576 656c 203d 2074  rrency_level = t
-00021d90: 696c 6564 622e 6465 6661 756c 745f 6374  iledb.default_ct
-00021da0: 7828 292e 636f 6e66 6967 2829 5b22 736d  x().config()["sm
-00021db0: 2e69 6f5f 636f 6e63 7572 7265 6e63 795f  .io_concurrency_
-00021dc0: 6c65 7665 6c22 5d0a 2020 2020 7072 696e  level"].    prin
-00021dd0: 7428 696e 7428 636f 6e63 7572 7265 6e63  t(int(concurrenc
-00021de0: 795f 6c65 7665 6c29 290a 0a0a 636c 6173  y_level))...clas
-00021df0: 7320 436f 6e74 6578 7454 6573 7428 756e  s ContextTest(un
-00021e00: 6974 7465 7374 2e54 6573 7443 6173 6529  ittest.TestCase)
-00021e10: 3a0a 2020 2020 6465 6620 7465 7374 5f64  :.    def test_d
-00021e20: 6566 6175 6c74 5f63 7478 2873 656c 6629  efault_ctx(self)
-00021e30: 3a0a 2020 2020 2020 2020 6374 7820 3d20  :.        ctx = 
-00021e40: 7469 6c65 6462 2e64 6566 6175 6c74 5f63  tiledb.default_c
-00021e50: 7478 2829 0a20 2020 2020 2020 2073 656c  tx().        sel
-00021e60: 662e 6173 7365 7274 4973 496e 7374 616e  f.assertIsInstan
-00021e70: 6365 2863 7478 2c20 7469 6c65 6462 2e43  ce(ctx, tiledb.C
-00021e80: 7478 290a 2020 2020 2020 2020 6173 7365  tx).        asse
-00021e90: 7274 2069 7369 6e73 7461 6e63 6528 6374  rt isinstance(ct
-00021ea0: 782e 636f 6e66 6967 2829 2c20 7469 6c65  x.config(), tile
-00021eb0: 6462 2e6c 6962 7469 6c65 6462 2e43 6f6e  db.libtiledb.Con
-00021ec0: 6669 6729 0a0a 2020 2020 6465 6620 7465  fig)..    def te
-00021ed0: 7374 5f73 636f 7065 5f63 7478 2873 656c  st_scope_ctx(sel
-00021ee0: 6629 3a0a 2020 2020 2020 2020 6b65 7920  f):.        key 
-00021ef0: 3d20 2273 6d2e 7469 6c65 5f63 6163 6865  = "sm.tile_cache
-00021f00: 5f73 697a 6522 0a20 2020 2020 2020 2063  _size".        c
-00021f10: 7478 3020 3d20 7469 6c65 6462 2e64 6566  tx0 = tiledb.def
-00021f20: 6175 6c74 5f63 7478 2829 0a20 2020 2020  ault_ctx().     
-00021f30: 2020 206e 6577 5f63 6f6e 6669 675f 6469     new_config_di
-00021f40: 6374 203d 207b 6b65 793a 2034 327d 0a20  ct = {key: 42}. 
-00021f50: 2020 2020 2020 206e 6577 5f63 6f6e 6669         new_confi
-00021f60: 6720 3d20 7469 6c65 6462 2e43 6f6e 6669  g = tiledb.Confi
-00021f70: 6728 7b6b 6579 3a20 3738 7d29 0a20 2020  g({key: 78}).   
-00021f80: 2020 2020 206e 6577 5f63 7478 203d 2074       new_ctx = t
-00021f90: 696c 6564 622e 4374 7828 7b6b 6579 3a20  iledb.Ctx({key: 
-00021fa0: 3631 7d29 0a0a 2020 2020 2020 2020 6173  61})..        as
-00021fb0: 7365 7274 2074 696c 6564 622e 6465 6661  sert tiledb.defa
-00021fc0: 756c 745f 6374 7828 2920 6973 2063 7478  ult_ctx() is ctx
-00021fd0: 300a 2020 2020 2020 2020 6173 7365 7274  0.        assert
-00021fe0: 2074 696c 6564 622e 6465 6661 756c 745f   tiledb.default_
-00021ff0: 6374 7828 292e 636f 6e66 6967 2829 5b6b  ctx().config()[k
-00022000: 6579 5d20 3d3d 2022 3130 3030 3030 3030  ey] == "10000000
-00022010: 220a 0a20 2020 2020 2020 2077 6974 6820  "..        with 
-00022020: 7469 6c65 6462 2e73 636f 7065 5f63 7478  tiledb.scope_ctx
-00022030: 286e 6577 5f63 6f6e 6669 675f 6469 6374  (new_config_dict
-00022040: 2920 6173 2063 7478 313a 0a20 2020 2020  ) as ctx1:.     
-00022050: 2020 2020 2020 2061 7373 6572 7420 7469         assert ti
-00022060: 6c65 6462 2e64 6566 6175 6c74 5f63 7478  ledb.default_ctx
-00022070: 2829 2069 7320 6374 7831 0a20 2020 2020  () is ctx1.     
-00022080: 2020 2020 2020 2061 7373 6572 7420 7469         assert ti
-00022090: 6c65 6462 2e64 6566 6175 6c74 5f63 7478  ledb.default_ctx
-000220a0: 2829 2e63 6f6e 6669 6728 295b 6b65 795d  ().config()[key]
-000220b0: 203d 3d20 2234 3222 0a20 2020 2020 2020   == "42".       
-000220c0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
-000220d0: 2e73 636f 7065 5f63 7478 286e 6577 5f63  .scope_ctx(new_c
-000220e0: 6f6e 6669 6729 2061 7320 6374 7832 3a0a  onfig) as ctx2:.
-000220f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022100: 6173 7365 7274 2074 696c 6564 622e 6465  assert tiledb.de
-00022110: 6661 756c 745f 6374 7828 2920 6973 2063  fault_ctx() is c
-00022120: 7478 320a 2020 2020 2020 2020 2020 2020  tx2.            
-00022130: 2020 2020 6173 7365 7274 2074 696c 6564      assert tiled
-00022140: 622e 6465 6661 756c 745f 6374 7828 292e  b.default_ctx().
-00022150: 636f 6e66 6967 2829 5b6b 6579 5d20 3d3d  config()[key] ==
-00022160: 2022 3738 220a 2020 2020 2020 2020 2020   "78".          
-00022170: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-00022180: 622e 7363 6f70 655f 6374 7828 6e65 775f  b.scope_ctx(new_
-00022190: 6374 7829 2061 7320 6374 7833 3a0a 2020  ctx) as ctx3:.  
-000221a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000221b0: 2020 6173 7365 7274 2074 696c 6564 622e    assert tiledb.
-000221c0: 6465 6661 756c 745f 6374 7828 2920 6973  default_ctx() is
-000221d0: 2063 7478 3320 6973 206e 6577 5f63 7478   ctx3 is new_ctx
-000221e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000221f0: 2020 2020 2061 7373 6572 7420 7469 6c65       assert tile
-00022200: 6462 2e64 6566 6175 6c74 5f63 7478 2829  db.default_ctx()
-00022210: 2e63 6f6e 6669 6728 295b 6b65 795d 203d  .config()[key] =
-00022220: 3d20 2236 3122 0a20 2020 2020 2020 2020  = "61".         
-00022230: 2020 2020 2020 2061 7373 6572 7420 7469         assert ti
-00022240: 6c65 6462 2e64 6566 6175 6c74 5f63 7478  ledb.default_ctx
-00022250: 2829 2069 7320 6374 7832 0a20 2020 2020  () is ctx2.     
-00022260: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00022270: 7420 7469 6c65 6462 2e64 6566 6175 6c74  t tiledb.default
-00022280: 5f63 7478 2829 2e63 6f6e 6669 6728 295b  _ctx().config()[
-00022290: 6b65 795d 203d 3d20 2237 3822 0a20 2020  key] == "78".   
-000222a0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-000222b0: 7469 6c65 6462 2e64 6566 6175 6c74 5f63  tiledb.default_c
-000222c0: 7478 2829 2069 7320 6374 7831 0a20 2020  tx() is ctx1.   
-000222d0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-000222e0: 7469 6c65 6462 2e64 6566 6175 6c74 5f63  tiledb.default_c
-000222f0: 7478 2829 2e63 6f6e 6669 6728 295b 6b65  tx().config()[ke
-00022300: 795d 203d 3d20 2234 3222 0a0a 2020 2020  y] == "42"..    
-00022310: 2020 2020 6173 7365 7274 2074 696c 6564      assert tiled
-00022320: 622e 6465 6661 756c 745f 6374 7828 2920  b.default_ctx() 
-00022330: 6973 2063 7478 300a 2020 2020 2020 2020  is ctx0.        
-00022340: 6173 7365 7274 2074 696c 6564 622e 6465  assert tiledb.de
-00022350: 6661 756c 745f 6374 7828 292e 636f 6e66  fault_ctx().conf
-00022360: 6967 2829 5b6b 6579 5d20 3d3d 2022 3130  ig()[key] == "10
-00022370: 3030 3030 3030 220a 0a20 2020 2040 7079  000000"..    @py
-00022380: 7465 7374 2e6d 6172 6b2e 736b 6970 6966  test.mark.skipif
-00022390: 280a 2020 2020 2020 2020 2270 7974 6573  (.        "pytes
-000223a0: 742e 7469 6c65 6462 5f76 6673 203d 3d20  t.tiledb_vfs == 
-000223b0: 2773 3327 222c 2072 6561 736f 6e3d 2254  's3'", reason="T
-000223c0: 6573 7420 6e6f 7420 7965 7420 7375 7070  est not yet supp
-000223d0: 6f72 7465 6420 7769 7468 2053 3322 0a20  orted with S3". 
-000223e0: 2020 2029 0a20 2020 2064 6566 2074 6573     ).    def tes
-000223f0: 745f 696e 6974 5f63 6f6e 6669 6728 7365  t_init_config(se
-00022400: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
-00022410: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
-00022420: 2020 2020 2020 2020 2020 2069 6e74 2874             int(t
-00022430: 696c 6564 622e 6465 6661 756c 745f 6374  iledb.default_ct
-00022440: 7828 292e 636f 6e66 6967 2829 5b22 736d  x().config()["sm
-00022450: 2e69 6f5f 636f 6e63 7572 7265 6e63 795f  .io_concurrency_
-00022460: 6c65 7665 6c22 5d29 2c0a 2020 2020 2020  level"]),.      
-00022470: 2020 2020 2020 696e 6974 5f74 6573 745f        init_test_
-00022480: 7772 6170 7065 7228 292c 0a20 2020 2020  wrapper(),.     
-00022490: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
-000224a0: 6c66 2e61 7373 6572 7445 7175 616c 2833  lf.assertEqual(3
-000224b0: 2c20 696e 6974 5f74 6573 745f 7772 6170  , init_test_wrap
-000224c0: 7065 7228 7b22 736d 2e69 6f5f 636f 6e63  per({"sm.io_conc
-000224d0: 7572 7265 6e63 795f 6c65 7665 6c22 3a20  urrency_level": 
-000224e0: 337d 2929 0a0a 0a63 6c61 7373 2052 6570  3}))...class Rep
-000224f0: 7254 6573 7428 4469 736b 5465 7374 4361  rTest(DiskTestCa
-00022500: 7365 293a 0a20 2020 2064 6566 2074 6573  se):.    def tes
-00022510: 745f 6174 7472 5f72 6570 7228 7365 6c66  t_attr_repr(self
-00022520: 293a 0a20 2020 2020 2020 2061 7474 7220  ):.        attr 
-00022530: 3d20 7469 6c65 6462 2e41 7474 7228 6e61  = tiledb.Attr(na
-00022540: 6d65 3d22 6974 7361 6e61 7474 7222 2c20  me="itsanattr", 
-00022550: 6474 7970 653d 6e70 2e66 6c6f 6174 3634  dtype=np.float64
-00022560: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00022570: 7373 6572 7454 7275 6528 0a20 2020 2020  ssertTrue(.     
-00022580: 2020 2020 2020 2072 652e 6d61 7463 6828         re.match(
-00022590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000225a0: 2072 2241 7474 725c 286e 616d 653d 5b75   r"Attr\(name=[u
-000225b0: 5d3f 2769 7473 616e 6174 7472 272c 2064  ]?'itsanattr', d
-000225c0: 7479 7065 3d27 666c 6f61 7436 3427 2c20  type='float64', 
-000225d0: 7661 723d 4661 6c73 652c 206e 756c 6c61  var=False, nulla
-000225e0: 626c 653d 4661 6c73 655c 2922 2c0a 2020  ble=False\)",.  
-000225f0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00022600: 7072 2861 7474 7229 2c0a 2020 2020 2020  pr(attr),.      
-00022610: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00022620: 290a 0a20 2020 2020 2020 2067 203d 2064  )..        g = d
-00022630: 6963 7428 290a 2020 2020 2020 2020 6578  ict().        ex
-00022640: 6563 2822 6672 6f6d 2074 696c 6564 6220  ec("from tiledb 
-00022650: 696d 706f 7274 2041 7474 723b 2066 726f  import Attr; fro
-00022660: 6d20 6e75 6d70 7920 696d 706f 7274 2066  m numpy import f
-00022670: 6c6f 6174 3634 222c 2067 290a 2020 2020  loat64", g).    
-00022680: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
-00022690: 7175 616c 2865 7661 6c28 7265 7072 2861  qual(eval(repr(a
-000226a0: 7474 7229 2c20 6729 2c20 6174 7472 290a  ttr), g), attr).
-000226b0: 0a20 2020 2064 6566 2074 6573 745f 6172  .    def test_ar
-000226c0: 7261 7973 6368 656d 615f 7265 7072 2873  rayschema_repr(s
-000226d0: 656c 662c 2073 7061 7273 655f 6365 6c6c  elf, sparse_cell
-000226e0: 5f6f 7264 6572 293a 0a20 2020 2020 2020  _order):.       
-000226f0: 2066 696c 7465 7273 203d 2074 696c 6564   filters = tiled
-00022700: 622e 4669 6c74 6572 4c69 7374 285b 7469  b.FilterList([ti
-00022710: 6c65 6462 2e5a 7374 6446 696c 7465 7228  ledb.ZstdFilter(
-00022720: 2d31 295d 290a 2020 2020 2020 2020 666f  -1)]).        fo
-00022730: 7220 7370 6172 7365 2069 6e20 5b46 616c  r sparse in [Fal
-00022740: 7365 2c20 5472 7565 5d3a 0a20 2020 2020  se, True]:.     
-00022750: 2020 2020 2020 2063 656c 6c5f 6f72 6465         cell_orde
-00022760: 7220 3d20 7370 6172 7365 5f63 656c 6c5f  r = sparse_cell_
-00022770: 6f72 6465 7220 6966 2073 7061 7273 6520  order if sparse 
-00022780: 656c 7365 204e 6f6e 650a 2020 2020 2020  else None.      
-00022790: 2020 2020 2020 646f 6d61 696e 203d 2074        domain = t
-000227a0: 696c 6564 622e 446f 6d61 696e 280a 2020  iledb.Domain(.  
-000227b0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-000227c0: 6c65 6462 2e44 696d 2864 6f6d 6169 6e3d  ledb.Dim(domain=
-000227d0: 2831 2c20 3829 2c20 7469 6c65 3d32 292c  (1, 8), tile=2),
-000227e0: 2074 696c 6564 622e 4469 6d28 646f 6d61   tiledb.Dim(doma
-000227f0: 696e 3d28 312c 2038 292c 2074 696c 653d  in=(1, 8), tile=
-00022800: 3229 0a20 2020 2020 2020 2020 2020 2029  2).            )
-00022810: 0a20 2020 2020 2020 2020 2020 2061 3120  .            a1 
-00022820: 3d20 7469 6c65 6462 2e41 7474 7228 2276  = tiledb.Attr("v
-00022830: 616c 222c 2064 7479 7065 3d22 6638 222c  al", dtype="f8",
-00022840: 2066 696c 7465 7273 3d66 696c 7465 7273   filters=filters
-00022850: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
-00022860: 6967 5f73 6368 656d 6120 3d20 7469 6c65  ig_schema = tile
-00022870: 6462 2e41 7272 6179 5363 6865 6d61 280a  db.ArraySchema(.
-00022880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022890: 646f 6d61 696e 3d64 6f6d 6169 6e2c 2061  domain=domain, a
-000228a0: 7474 7273 3d28 6131 2c29 2c20 7370 6172  ttrs=(a1,), spar
-000228b0: 7365 3d73 7061 7273 652c 2063 656c 6c5f  se=sparse, cell_
-000228c0: 6f72 6465 723d 6365 6c6c 5f6f 7264 6572  order=cell_order
-000228d0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-000228e0: 2020 2020 2020 2020 2020 2020 7363 6865              sche
-000228f0: 6d61 5f72 6570 7220 3d20 7265 7072 286f  ma_repr = repr(o
-00022900: 7269 675f 7363 6865 6d61 290a 2020 2020  rig_schema).    
-00022910: 2020 2020 2020 2020 6720 3d20 6469 6374          g = dict
-00022920: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
-00022930: 6574 7570 203d 2022 6672 6f6d 2074 696c  etup = "from til
-00022940: 6564 6220 696d 706f 7274 202a 5c6e 2220  edb import *\n" 
-00022950: 2269 6d70 6f72 7420 6e75 6d70 7920 6173  "import numpy as
-00022960: 206e 705c 6e22 0a0a 2020 2020 2020 2020   np\n"..        
-00022970: 2020 2020 6578 6563 2873 6574 7570 2c20      exec(setup, 
-00022980: 6729 0a20 2020 2020 2020 2020 2020 206e  g).            n
-00022990: 6577 5f73 6368 656d 6120 3d20 4e6f 6e65  ew_schema = None
-000229a0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-000229b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000229c0: 2020 6e65 775f 7363 6865 6d61 203d 2065    new_schema = e
-000229d0: 7661 6c28 7363 6865 6d61 5f72 6570 722c  val(schema_repr,
-000229e0: 2067 290a 2020 2020 2020 2020 2020 2020   g).            
-000229f0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00022a00: 2061 7320 6578 633a 0a20 2020 2020 2020   as exc:.       
-00022a10: 2020 2020 2020 2020 2077 6172 6e5f 7374           warn_st
-00022a20: 7220 3d20 280a 2020 2020 2020 2020 2020  r = (.          
-00022a30: 2020 2020 2020 2020 2020 2222 2245 7863            """Exc
-00022a40: 6570 7469 6f6e 2064 7572 696e 6720 5265  eption during Re
-00022a50: 7072 5465 7374 2073 6368 656d 6120 6576  prTest schema ev
-00022a60: 616c 2222 220a 2020 2020 2020 2020 2020  al""".          
-00022a70: 2020 2020 2020 2020 2020 2b20 2222 222c            + """,
-00022a80: 2073 6368 656d 6120 7374 7269 6e67 2077   schema string w
-00022a90: 6173 3a5c 6e22 2222 0a20 2020 2020 2020  as:\n""".       
-00022aa0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-00022ab0: 2222 2727 2722 2222 0a20 2020 2020 2020  ""'''""".       
-00022ac0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-00022ad0: 2222 5c6e 7b7d 5c6e 2727 2722 2222 2e66  ""\n{}\n'''""".f
-00022ae0: 6f72 6d61 7428 7363 6865 6d61 5f72 6570  ormat(schema_rep
-00022af0: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-00022b00: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00022b10: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
-00022b20: 726e 2877 6172 6e5f 7374 7229 0a20 2020  rn(warn_str).   
-00022b30: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00022b40: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
-00022b50: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00022b60: 286e 6577 5f73 6368 656d 612c 206f 7269  (new_schema, ori
-00022b70: 675f 7363 6865 6d61 290a 0a20 2020 2064  g_schema)..    d
-00022b80: 6566 2074 6573 745f 6172 7261 7973 6368  ef test_arraysch
-00022b90: 656d 615f 7265 7072 5f68 696c 6265 7274  ema_repr_hilbert
-00022ba0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00022bb0: 646f 6d61 696e 203d 2074 696c 6564 622e  domain = tiledb.
-00022bc0: 446f 6d61 696e 2874 696c 6564 622e 4469  Domain(tiledb.Di
-00022bd0: 6d28 646f 6d61 696e 3d28 312c 2038 292c  m(domain=(1, 8),
-00022be0: 2074 696c 653d 3229 290a 2020 2020 2020   tile=2)).      
-00022bf0: 2020 6120 3d20 7469 6c65 6462 2e41 7474    a = tiledb.Att
-00022c00: 7228 2261 222c 2064 7479 7065 3d22 6638  r("a", dtype="f8
-00022c10: 2229 0a20 2020 2020 2020 2073 6368 656d  ").        schem
-00022c20: 6120 3d20 7469 6c65 6462 2e41 7272 6179  a = tiledb.Array
-00022c30: 5363 6865 6d61 280a 2020 2020 2020 2020  Schema(.        
-00022c40: 2020 2020 646f 6d61 696e 3d64 6f6d 6169      domain=domai
-00022c50: 6e2c 2061 7474 7273 3d28 612c 292c 2063  n, attrs=(a,), c
-00022c60: 656c 6c5f 6f72 6465 723d 2268 696c 6265  ell_order="hilbe
-00022c70: 7274 222c 2073 7061 7273 653d 5472 7565  rt", sparse=True
-00022c80: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00022c90: 2020 2020 6173 7365 7274 2073 6368 656d      assert schem
-00022ca0: 612e 6365 6c6c 5f6f 7264 6572 203d 3d20  a.cell_order == 
-00022cb0: 2268 696c 6265 7274 220a 2020 2020 2020  "hilbert".      
-00022cc0: 2020 6173 7365 7274 2073 6368 656d 612e    assert schema.
-00022cd0: 7469 6c65 5f6f 7264 6572 203d 3d20 4e6f  tile_order == No
-00022ce0: 6e65 0a0a 0a63 6c61 7373 204e 756c 6c61  ne...class Nulla
-00022cf0: 626c 6549 4f54 6573 7428 4469 736b 5465  bleIOTest(DiskTe
-00022d00: 7374 4361 7365 293a 0a20 2020 2064 6566  stCase):.    def
-00022d10: 2074 6573 745f 6e75 6c6c 6162 6c65 5f77   test_nullable_w
-00022d20: 7269 7465 2873 656c 6629 3a0a 2020 2020  rite(self):.    
-00022d30: 2020 2020 7572 6920 3d20 7365 6c66 2e70      uri = self.p
-00022d40: 6174 6828 226e 756c 6c61 626c 655f 7772  ath("nullable_wr
-00022d50: 6974 655f 7465 7374 2229 0a0a 2020 2020  ite_test")..    
-00022d60: 2020 2020 7363 6865 6d61 203d 2074 696c      schema = til
-00022d70: 6564 622e 4172 7261 7953 6368 656d 6128  edb.ArraySchema(
-00022d80: 0a20 2020 2020 2020 2020 2020 2064 6f6d  .            dom
-00022d90: 6169 6e3d 7469 6c65 6462 2e44 6f6d 6169  ain=tiledb.Domai
-00022da0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-00022db0: 2020 202a 5b74 696c 6564 622e 4469 6d28     *[tiledb.Dim(
-00022dc0: 6e61 6d65 3d22 5f5f 6469 6d5f 3022 2c20  name="__dim_0", 
-00022dd0: 646f 6d61 696e 3d28 302c 2033 292c 2074  domain=(0, 3), t
-00022de0: 696c 653d 342c 2064 7479 7065 3d22 7569  ile=4, dtype="ui
-00022df0: 6e74 3634 2229 5d0a 2020 2020 2020 2020  nt64")].        
-00022e00: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
-00022e10: 2020 2061 7474 7273 3d5b 7469 6c65 6462     attrs=[tiledb
-00022e20: 2e41 7474 7228 6e61 6d65 3d22 222c 2064  .Attr(name="", d
-00022e30: 7479 7065 3d22 696e 7436 3422 2c20 7661  type="int64", va
-00022e40: 723d 4661 6c73 652c 206e 756c 6c61 626c  r=False, nullabl
-00022e50: 653d 5472 7565 295d 2c0a 2020 2020 2020  e=True)],.      
-00022e60: 2020 290a 2020 2020 2020 2020 7469 6c65    ).        tile
-00022e70: 6462 2e41 7272 6179 2e63 7265 6174 6528  db.Array.create(
-00022e80: 7572 692c 2073 6368 656d 6129 0a0a 2020  uri, schema)..  
-00022e90: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
-00022ea0: 622e 6f70 656e 2875 7269 2c20 2277 2229  b.open(uri, "w")
-00022eb0: 2061 7320 413a 0a20 2020 2020 2020 2020   as A:.         
-00022ec0: 2020 2041 2e5f 7365 7469 7465 6d5f 696d     A._setitem_im
-00022ed0: 706c 280a 2020 2020 2020 2020 2020 2020  pl(.            
-00022ee0: 2020 2020 736c 6963 6528 302c 2034 292c      slice(0, 4),
-00022ef0: 206e 702e 6f6e 6573 2834 292c 207b 2222   np.ones(4), {""
-00022f00: 3a20 6e70 2e61 7272 6179 285b 302c 2031  : np.array([0, 1
-00022f10: 2c20 302c 2031 5d2c 2064 7479 7065 3d6e  , 0, 1], dtype=n
-00022f20: 702e 7569 6e74 3829 7d0a 2020 2020 2020  p.uint8)}.      
-00022f30: 2020 2020 2020 290a 0a0a 636c 6173 7320        )...class 
-00022f40: 496e 636f 6d70 6c65 7465 5465 7374 2844  IncompleteTest(D
-00022f50: 6973 6b54 6573 7443 6173 6529 3a0a 2020  iskTestCase):.  
-00022f60: 2020 6465 6620 7465 7374 5f69 6e63 6f6d    def test_incom
-00022f70: 706c 6574 655f 6465 6e73 655f 7661 726c  plete_dense_varl
-00022f80: 656e 2873 656c 6629 3a0a 2020 2020 2020  en(self):.      
-00022f90: 2020 6e63 656c 6c73 203d 2031 300a 2020    ncells = 10.  
-00022fa0: 2020 2020 2020 7061 7468 203d 2073 656c        path = sel
-00022fb0: 662e 7061 7468 2822 696e 636f 6d70 6c65  f.path("incomple
-00022fc0: 7465 5f64 656e 7365 5f76 6172 6c65 6e22  te_dense_varlen"
-00022fd0: 290a 2020 2020 2020 2020 7374 725f 6461  ).        str_da
-00022fe0: 7461 203d 205b 7261 6e64 5f75 7466 3828  ta = [rand_utf8(
-00022ff0: 7261 6e64 6f6d 2e72 616e 6469 6e74 2830  random.randint(0
-00023000: 2c20 6e29 2920 666f 7220 6e20 696e 2072  , n)) for n in r
-00023010: 616e 6765 286e 6365 6c6c 7329 5d0a 2020  ange(ncells)].  
-00023020: 2020 2020 2020 6461 7461 203d 206e 702e        data = np.
-00023030: 6172 7261 7928 7374 725f 6461 7461 2c20  array(str_data, 
-00023040: 6474 7970 653d 6e70 2e75 6e69 636f 6465  dtype=np.unicode
-00023050: 5f29 0a0a 2020 2020 2020 2020 2320 6261  _)..        # ba
-00023060: 7369 6320 7772 6974 650a 2020 2020 2020  sic write.      
-00023070: 2020 646f 6d20 3d20 7469 6c65 6462 2e44    dom = tiledb.D
-00023080: 6f6d 6169 6e28 7469 6c65 6462 2e44 696d  omain(tiledb.Dim
-00023090: 2864 6f6d 6169 6e3d 2831 2c20 6c65 6e28  (domain=(1, len(
-000230a0: 6461 7461 2929 2c20 7469 6c65 3d6c 656e  data)), tile=len
-000230b0: 2864 6174 6129 2929 0a20 2020 2020 2020  (data))).       
-000230c0: 2061 7474 203d 2074 696c 6564 622e 4174   att = tiledb.At
-000230d0: 7472 2864 7479 7065 3d6e 702e 756e 6963  tr(dtype=np.unic
-000230e0: 6f64 655f 2c20 7661 723d 5472 7565 290a  ode_, var=True).
-000230f0: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
-00023100: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
-00023110: 6865 6d61 2864 6f6d 2c20 2861 7474 2c29  hema(dom, (att,)
-00023120: 290a 0a20 2020 2020 2020 2074 696c 6564  )..        tiled
-00023130: 622e 4465 6e73 6541 7272 6179 2e63 7265  b.DenseArray.cre
-00023140: 6174 6528 7061 7468 2c20 7363 6865 6d61  ate(path, schema
-00023150: 290a 2020 2020 2020 2020 7769 7468 2074  ).        with t
-00023160: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
-00023170: 2870 6174 682c 206d 6f64 653d 2277 2229  (path, mode="w")
-00023180: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
-00023190: 2020 2054 5b3a 5d20 3d20 6461 7461 0a0a     T[:] = data..
-000231a0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
-000231b0: 6564 622e 4465 6e73 6541 7272 6179 2870  edb.DenseArray(p
-000231c0: 6174 682c 206d 6f64 653d 2272 2229 2061  ath, mode="r") a
-000231d0: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
-000231e0: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
-000231f0: 7561 6c28 6461 7461 2c20 545b 3a5d 290a  ual(data, T[:]).
-00023200: 0a20 2020 2020 2020 2023 2073 6574 2074  .        # set t
-00023210: 6865 206d 656d 6f72 7920 746f 2074 6865  he memory to the
-00023220: 206d 6178 206c 656e 6774 6820 6f66 2061   max length of a
-00023230: 2063 656c 6c0a 2020 2020 2020 2020 2320   cell.        # 
-00023240: 7468 6573 6520 7365 7474 696e 6773 2066  these settings f
-00023250: 6f72 6365 207e 3130 3020 7265 7472 6965  orce ~100 retrie
-00023260: 730a 2020 2020 2020 2020 2320 544f 444f  s.        # TODO
-00023270: 2077 6f75 6c64 2062 6520 676f 6f64 2074   would be good t
-00023280: 6f20 6368 6563 6b20 7265 7065 6174 2063  o check repeat c
-00023290: 6f75 6e74 2068 6572 653b 206e 6f74 2079  ount here; not y
-000232a0: 6574 2065 7870 6f73 6564 0a20 2020 2020  et exposed.     
-000232b0: 2020 2023 2020 2020 2020 416c 736f 2077     #      Also w
-000232c0: 6f75 6c64 2062 6520 7573 6566 756c 2074  ould be useful t
-000232d0: 6f20 6861 7665 206d 6178 2063 656c 6c20  o have max cell 
-000232e0: 636f 6e66 6967 2069 6e20 6c69 6274 696c  config in libtil
-000232f0: 6564 622e 0a20 2020 2020 2020 2069 6e69  edb..        ini
-00023300: 745f 6275 6666 6572 5f62 7974 6573 203d  t_buffer_bytes =
-00023310: 2031 3032 3420 2a2a 2032 0a20 2020 2020   1024 ** 2.     
-00023320: 2020 2063 6f6e 6669 6720 3d20 7469 6c65     config = tile
-00023330: 6462 2e43 6f6e 6669 6728 0a20 2020 2020  db.Config(.     
-00023340: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-00023350: 2020 2020 2020 2020 2022 736d 2e6d 656d           "sm.mem
-00023360: 6f72 795f 6275 6467 6574 223a 206e 6365  ory_budget": nce
-00023370: 6c6c 732c 0a20 2020 2020 2020 2020 2020  lls,.           
-00023380: 2020 2020 2022 736d 2e6d 656d 6f72 795f       "sm.memory_
-00023390: 6275 6467 6574 5f76 6172 223a 206e 6365  budget_var": nce
-000233a0: 6c6c 732c 0a20 2020 2020 2020 2020 2020  lls,.           
-000233b0: 2020 2020 2022 7079 2e69 6e69 745f 6275       "py.init_bu
-000233c0: 6666 6572 5f62 7974 6573 223a 2069 6e69  ffer_bytes": ini
-000233d0: 745f 6275 6666 6572 5f62 7974 6573 2c0a  t_buffer_bytes,.
-000233e0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-000233f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00023400: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
-00023410: 2863 6f6e 6669 675b 2270 792e 696e 6974  (config["py.init
-00023420: 5f62 7566 6665 725f 6279 7465 7322 5d2c  _buffer_bytes"],
-00023430: 2073 7472 2869 6e69 745f 6275 6666 6572   str(init_buffer
-00023440: 5f62 7974 6573 2929 0a0a 2020 2020 2020  _bytes))..      
-00023450: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
-00023460: 6e73 6541 7272 6179 2870 6174 682c 206d  nseArray(path, m
-00023470: 6f64 653d 2272 222c 2063 7478 3d74 696c  ode="r", ctx=til
-00023480: 6564 622e 4374 7828 636f 6e66 6967 2929  edb.Ctx(config))
-00023490: 2061 7320 5432 3a0a 2020 2020 2020 2020   as T2:.        
-000234a0: 2020 2020 6466 203d 2054 322e 7175 6572      df = T2.quer
-000234b0: 7928 6174 7472 733d 5b22 225d 292e 6466  y(attrs=[""]).df
-000234c0: 5b3a 5d0a 2020 2020 2020 2020 2020 2020  [:].            
-000234d0: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-000234e0: 616c 2864 665b 2222 5d2c 2064 6174 6129  al(df[""], data)
-000234f0: 0a0a 2020 2020 6465 6620 7465 7374 5f69  ..    def test_i
-00023500: 6e63 6f6d 706c 6574 655f 7370 6172 7365  ncomplete_sparse
-00023510: 5f76 6172 6c65 6e28 7365 6c66 293a 0a20  _varlen(self):. 
-00023520: 2020 2020 2020 206e 6365 6c6c 7320 3d20         ncells = 
-00023530: 3130 300a 0a20 2020 2020 2020 2070 6174  100..        pat
-00023540: 6820 3d20 7365 6c66 2e70 6174 6828 2269  h = self.path("i
-00023550: 6e63 6f6d 706c 6574 655f 7370 6172 7365  ncomplete_sparse
-00023560: 5f76 6172 6c65 6e22 290a 2020 2020 2020  _varlen").      
-00023570: 2020 7374 725f 6461 7461 203d 205b 7261    str_data = [ra
-00023580: 6e64 5f75 7466 3828 7261 6e64 6f6d 2e72  nd_utf8(random.r
-00023590: 616e 6469 6e74 2830 2c20 6e29 2920 666f  andint(0, n)) fo
-000235a0: 7220 6e20 696e 2072 616e 6765 286e 6365  r n in range(nce
-000235b0: 6c6c 7329 5d0a 2020 2020 2020 2020 6461  lls)].        da
-000235c0: 7461 203d 206e 702e 6172 7261 7928 7374  ta = np.array(st
-000235d0: 725f 6461 7461 2c20 6474 7970 653d 6e70  r_data, dtype=np
-000235e0: 2e75 6e69 636f 6465 5f29 0a20 2020 2020  .unicode_).     
-000235f0: 2020 2063 6f6f 7264 7320 3d20 6e70 2e61     coords = np.a
-00023600: 7261 6e67 6528 6e63 656c 6c73 290a 0a20  range(ncells).. 
-00023610: 2020 2020 2020 2023 2062 6173 6963 2077         # basic w
-00023620: 7269 7465 0a20 2020 2020 2020 2064 6f6d  rite.        dom
-00023630: 203d 2074 696c 6564 622e 446f 6d61 696e   = tiledb.Domain
-00023640: 2874 696c 6564 622e 4469 6d28 646f 6d61  (tiledb.Dim(doma
-00023650: 696e 3d28 302c 206c 656e 2864 6174 6129  in=(0, len(data)
-00023660: 202b 2031 3030 292c 2074 696c 653d 6c65   + 100), tile=le
-00023670: 6e28 6461 7461 2929 290a 2020 2020 2020  n(data))).      
-00023680: 2020 6174 7420 3d20 7469 6c65 6462 2e41    att = tiledb.A
-00023690: 7474 7228 6474 7970 653d 6e70 2e75 6e69  ttr(dtype=np.uni
-000236a0: 636f 6465 5f2c 2076 6172 3d54 7275 6529  code_, var=True)
-000236b0: 0a0a 2020 2020 2020 2020 7363 6865 6d61  ..        schema
-000236c0: 203d 2074 696c 6564 622e 4172 7261 7953   = tiledb.ArrayS
-000236d0: 6368 656d 6128 646f 6d2c 2028 6174 742c  chema(dom, (att,
-000236e0: 292c 2073 7061 7273 653d 5472 7565 290a  ), sparse=True).
-000236f0: 0a20 2020 2020 2020 2074 696c 6564 622e  .        tiledb.
-00023700: 5370 6172 7365 4172 7261 792e 6372 6561  SparseArray.crea
-00023710: 7465 2870 6174 682c 2073 6368 656d 6129  te(path, schema)
-00023720: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
-00023730: 6c65 6462 2e53 7061 7273 6541 7272 6179  ledb.SparseArray
-00023740: 2870 6174 682c 206d 6f64 653d 2277 2229  (path, mode="w")
-00023750: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
-00023760: 2020 2054 5b63 6f6f 7264 735d 203d 2064     T[coords] = d
-00023770: 6174 610a 0a20 2020 2020 2020 2077 6974  ata..        wit
-00023780: 6820 7469 6c65 6462 2e53 7061 7273 6541  h tiledb.SparseA
-00023790: 7272 6179 2870 6174 682c 206d 6f64 653d  rray(path, mode=
-000237a0: 2272 2229 2061 7320 543a 0a20 2020 2020  "r") as T:.     
-000237b0: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
-000237c0: 7261 795f 6571 7561 6c28 6461 7461 2c20  ray_equal(data, 
-000237d0: 545b 3a5d 5b22 225d 290a 0a20 2020 2020  T[:][""])..     
-000237e0: 2020 2023 2073 6574 2074 6865 206d 656d     # set the mem
-000237f0: 6f72 7920 746f 2074 6865 206d 6178 206c  ory to the max l
-00023800: 656e 6774 6820 6f66 2061 2063 656c 6c0a  ength of a cell.
-00023810: 2020 2020 2020 2020 2320 7468 6573 6520          # these 
-00023820: 7365 7474 696e 6773 2066 6f72 6365 207e  settings force ~
-00023830: 3130 3020 7265 7472 6965 730a 2020 2020  100 retries.    
-00023840: 2020 2020 2320 544f 444f 2077 6f75 6c64      # TODO would
-00023850: 2062 6520 676f 6f64 2074 6f20 6368 6563   be good to chec
-00023860: 6b20 7265 7065 6174 2063 6f75 6e74 2068  k repeat count h
-00023870: 6572 653b 206e 6f74 2079 6574 2065 7870  ere; not yet exp
-00023880: 6f73 6564 0a20 2020 2020 2020 2023 2020  osed.        #  
-00023890: 2020 2020 416c 736f 2077 6f75 6c64 2062      Also would b
-000238a0: 6520 7573 6566 756c 2074 6f20 6861 7665  e useful to have
-000238b0: 206d 6178 2063 656c 6c20 636f 6e66 6967   max cell config
-000238c0: 2069 6e20 6c69 6274 696c 6564 622e 0a20   in libtiledb.. 
-000238d0: 2020 2020 2020 2069 6e69 745f 6275 6666         init_buff
-000238e0: 6572 5f62 7974 6573 203d 2031 3032 3420  er_bytes = 1024 
-000238f0: 2a2a 2032 0a20 2020 2020 2020 2063 6f6e  ** 2.        con
-00023900: 6669 6720 3d20 7469 6c65 6462 2e43 6f6e  fig = tiledb.Con
-00023910: 6669 6728 0a20 2020 2020 2020 2020 2020  fig(.           
-00023920: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-00023930: 2020 2022 736d 2e6d 656d 6f72 795f 6275     "sm.memory_bu
-00023940: 6467 6574 223a 206e 6365 6c6c 732c 0a20  dget": ncells,. 
-00023950: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00023960: 736d 2e6d 656d 6f72 795f 6275 6467 6574  sm.memory_budget
-00023970: 5f76 6172 223a 206e 6365 6c6c 732c 0a20  _var": ncells,. 
-00023980: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00023990: 7079 2e69 6e69 745f 6275 6666 6572 5f62  py.init_buffer_b
-000239a0: 7974 6573 223a 2069 6e69 745f 6275 6666  ytes": init_buff
-000239b0: 6572 5f62 7974 6573 2c0a 2020 2020 2020  er_bytes,.      
-000239c0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-000239d0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-000239e0: 7373 6572 7445 7175 616c 2863 6f6e 6669  ssertEqual(confi
-000239f0: 675b 2270 792e 696e 6974 5f62 7566 6665  g["py.init_buffe
-00023a00: 725f 6279 7465 7322 5d2c 2073 7472 2869  r_bytes"], str(i
-00023a10: 6e69 745f 6275 6666 6572 5f62 7974 6573  nit_buffer_bytes
-00023a20: 2929 0a0a 2020 2020 2020 2020 7769 7468  ))..        with
-00023a30: 2074 696c 6564 622e 5370 6172 7365 4172   tiledb.SparseAr
-00023a40: 7261 7928 7061 7468 2c20 6d6f 6465 3d22  ray(path, mode="
-00023a50: 7222 2c20 6374 783d 7469 6c65 6462 2e43  r", ctx=tiledb.C
-00023a60: 7478 2863 6f6e 6669 6729 2920 6173 2054  tx(config)) as T
-00023a70: 323a 0a20 2020 2020 2020 2020 2020 2061  2:.            a
-00023a80: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
-00023a90: 6c28 6461 7461 2c20 5432 5b3a 5d5b 2222  l(data, T2[:][""
-00023aa0: 5d29 0a0a 2020 2020 2020 2020 2020 2020  ])..            
-00023ab0: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
-00023ac0: 616c 2864 6174 612c 2054 322e 6d75 6c74  al(data, T2.mult
-00023ad0: 695f 696e 6465 785b 303a 6e63 656c 6c73  i_index[0:ncells
-00023ae0: 5d5b 2222 5d29 0a0a 2020 2020 2020 2020  ][""])..        
-00023af0: 2020 2020 2320 656e 7375 7265 2074 6861      # ensure tha
-00023b00: 7420 656d 7074 7920 7265 7375 6c74 7320  t empty results 
-00023b10: 6172 6520 6861 6e64 6c65 6420 636f 7272  are handled corr
-00023b20: 6563 746c 790a 2020 2020 2020 2020 2020  ectly.          
-00023b30: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
-00023b40: 7175 616c 280a 2020 2020 2020 2020 2020  qual(.          
-00023b50: 2020 2020 2020 5432 2e6d 756c 7469 5f69        T2.multi_i
-00023b60: 6e64 6578 5b31 3031 3a31 3035 5d5b 2222  ndex[101:105][""
-00023b70: 5d2c 206e 702e 6172 7261 7928 5b5d 2c20  ], np.array([], 
-00023b80: 6474 7970 653d 6e70 2e64 7479 7065 2822  dtype=np.dtype("
-00023b90: 3c55 2229 290a 2020 2020 2020 2020 2020  <U")).          
-00023ba0: 2020 290a 0a20 2020 2040 7079 7465 7374    )..    @pytest
-00023bb0: 2e6d 6172 6b2e 7061 7261 6d65 7472 697a  .mark.parametriz
-00023bc0: 6528 0a20 2020 2020 2020 2022 7265 7475  e(.        "retu
-00023bd0: 726e 5f61 7272 6f77 2c20 696e 6465 7865  rn_arrow, indexe
-00023be0: 7222 2c20 5b28 5472 7565 2c20 2264 6622  r", [(True, "df"
-00023bf0: 292c 2028 4661 6c73 652c 2022 6466 2229  ), (False, "df")
-00023c00: 2c20 2846 616c 7365 2c20 226d 756c 7469  , (False, "multi
-00023c10: 5f69 6e64 6578 2229 5d0a 2020 2020 290a  _index")].    ).
-00023c20: 2020 2020 6465 6620 7465 7374 5f69 6e63      def test_inc
-00023c30: 6f6d 706c 6574 655f 7265 7475 726e 280a  omplete_return(.
-00023c40: 2020 2020 2020 2020 7365 6c66 2c20 7465          self, te
-00023c50: 7374 5f69 6e63 6f6d 706c 6574 655f 7265  st_incomplete_re
-00023c60: 7475 726e 5f61 7272 6179 2c20 7265 7475  turn_array, retu
-00023c70: 726e 5f61 7272 6f77 2c20 696e 6465 7865  rn_arrow, indexe
-00023c80: 720a 2020 2020 293a 0a20 2020 2020 2020  r.    ):.       
-00023c90: 2069 6d70 6f72 7420 7079 6172 726f 7720   import pyarrow 
-00023ca0: 6173 2070 610a 2020 2020 2020 2020 696d  as pa.        im
-00023cb0: 706f 7274 2070 616e 6461 7320 6173 2070  port pandas as p
-00023cc0: 640a 2020 2020 2020 2020 6672 6f6d 2074  d.        from t
-00023cd0: 696c 6564 622e 6d75 6c74 6972 616e 6765  iledb.multirange
-00023ce0: 5f69 6e64 6578 696e 6720 696d 706f 7274  _indexing import
-00023cf0: 2045 7374 696d 6174 6564 5265 7375 6c74   EstimatedResult
-00023d00: 5369 7a65 0a0a 2020 2020 2020 2020 7061  Size..        pa
-00023d10: 7468 203d 2074 6573 745f 696e 636f 6d70  th = test_incomp
-00023d20: 6c65 7465 5f72 6574 7572 6e5f 6172 7261  lete_return_arra
-00023d30: 790a 0a20 2020 2020 2020 2069 6e69 745f  y..        init_
-00023d40: 6275 6666 6572 5f62 7974 6573 203d 2032  buffer_bytes = 2
-00023d50: 3030 0a20 2020 2020 2020 2063 6667 203d  00.        cfg =
-00023d60: 2074 696c 6564 622e 436f 6e66 6967 280a   tiledb.Config(.
-00023d70: 2020 2020 2020 2020 2020 2020 7b0a 2020              {.  
-00023d80: 2020 2020 2020 2020 2020 2020 2020 2270                "p
-00023d90: 792e 696e 6974 5f62 7566 6665 725f 6279  y.init_buffer_by
-00023da0: 7465 7322 3a20 696e 6974 5f62 7566 6665  tes": init_buffe
-00023db0: 725f 6279 7465 732c 0a20 2020 2020 2020  r_bytes,.       
-00023dc0: 2020 2020 2020 2020 2022 7079 2e65 7861           "py.exa
-00023dd0: 6374 5f69 6e69 745f 6275 6666 6572 5f62  ct_init_buffer_b
-00023de0: 7974 6573 223a 2022 7472 7565 222c 0a20  ytes": "true",. 
-00023df0: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-00023e00: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00023e10: 7769 7468 2074 696c 6564 622e 6f70 656e  with tiledb.open
-00023e20: 2870 6174 6829 2061 7320 413a 0a20 2020  (path) as A:.   
-00023e30: 2020 2020 2020 2020 2066 756c 6c5f 6461           full_da
-00023e40: 7461 203d 2041 5b3a 5d5b 2222 5d0a 0a20  ta = A[:][""].. 
-00023e50: 2020 2020 2020 2023 2063 6f75 6e74 206e         # count n
-00023e60: 756d 6265 7220 6f66 2065 6c65 6d65 6e74  umber of element
-00023e70: 7320 7265 7472 6965 7665 6420 736f 2074  s retrieved so t
-00023e80: 6861 7420 7765 2063 616e 2073 6c69 6365  hat we can slice
-00023e90: 2074 6865 2063 6f6d 7061 7269 736f 6e20   the comparison 
-00023ea0: 6172 7261 790a 2020 2020 2020 2020 6964  array.        id
-00023eb0: 7820 3d20 300a 2020 2020 2020 2020 7769  x = 0.        wi
-00023ec0: 7468 2074 696c 6564 622e 6f70 656e 2870  th tiledb.open(p
-00023ed0: 6174 682c 2063 7478 3d74 696c 6564 622e  ath, ctx=tiledb.
-00023ee0: 4374 7828 6366 6729 2920 6173 2041 3a0a  Ctx(cfg)) as A:.
-00023ef0: 2020 2020 2020 2020 2020 2020 7175 6572              quer
-00023f00: 7920 3d20 412e 7175 6572 7928 7265 7475  y = A.query(retu
-00023f10: 726e 5f69 6e63 6f6d 706c 6574 653d 5472  rn_incomplete=Tr
-00023f20: 7565 2c20 7265 7475 726e 5f61 7272 6f77  ue, return_arrow
-00023f30: 3d72 6574 7572 6e5f 6172 726f 7729 0a20  =return_arrow). 
-00023f40: 2020 2020 2020 2020 2020 2069 7465 7261             itera
-00023f50: 626c 6520 3d20 6765 7461 7474 7228 7175  ble = getattr(qu
-00023f60: 6572 792c 2069 6e64 6578 6572 290a 0a20  ery, indexer).. 
-00023f70: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
-00023f80: 6573 756c 7420 696e 2069 7465 7261 626c  esult in iterabl
-00023f90: 655b 3a5d 3a0a 0a20 2020 2020 2020 2020  e[:]:..         
-00023fa0: 2020 2020 2020 2065 7374 5f72 6573 756c         est_resul
-00023fb0: 7473 203d 2069 7465 7261 626c 652e 6573  ts = iterable.es
-00023fc0: 7469 6d61 7465 645f 7265 7375 6c74 5f73  timated_result_s
-00023fd0: 697a 6573 2829 0a20 2020 2020 2020 2020  izes().         
-00023fe0: 2020 2020 2020 2061 7373 6572 7420 6973         assert is
-00023ff0: 696e 7374 616e 6365 2865 7374 5f72 6573  instance(est_res
-00024000: 756c 7473 5b22 225d 2c20 4573 7469 6d61  ults[""], Estima
-00024010: 7465 6452 6573 756c 7453 697a 6529 0a20  tedResultSize). 
-00024020: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00024030: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
-00024040: 2865 7374 5f72 6573 756c 7473 5b22 5f5f  (est_results["__
-00024050: 6469 6d5f 3022 5d2c 2045 7374 696d 6174  dim_0"], Estimat
-00024060: 6564 5265 7375 6c74 5369 7a65 290a 2020  edResultSize).  
-00024070: 2020 2020 2020 2020 2020 2020 2020 6173                as
-00024080: 7365 7274 2065 7374 5f72 6573 756c 7473  sert est_results
-00024090: 5b22 5f5f 6469 6d5f 3022 5d2e 6f66 6673  ["__dim_0"].offs
-000240a0: 6574 735f 6279 7465 7320 3d3d 2030 0a20  ets_bytes == 0. 
-000240b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000240c0: 7373 6572 7420 6573 745f 7265 7375 6c74  ssert est_result
-000240d0: 735b 225f 5f64 696d 5f30 225d 2e64 6174  s["__dim_0"].dat
-000240e0: 615f 6279 7465 7320 3e20 300a 2020 2020  a_bytes > 0.    
-000240f0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00024100: 7274 2065 7374 5f72 6573 756c 7473 5b22  rt est_results["
-00024110: 225d 2e6f 6666 7365 7473 5f62 7974 6573  "].offsets_bytes
-00024120: 203e 2030 0a20 2020 2020 2020 2020 2020   > 0.           
-00024130: 2020 2020 2061 7373 6572 7420 6573 745f       assert est_
-00024140: 7265 7375 6c74 735b 2222 5d2e 6461 7461  results[""].data
-00024150: 5f62 7974 6573 203e 2030 0a0a 2020 2020  _bytes > 0..    
-00024160: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00024170: 6574 7572 6e5f 6172 726f 773a 0a20 2020  eturn_arrow:.   
-00024180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024190: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
-000241a0: 6365 2872 6573 756c 742c 2070 612e 5461  ce(result, pa.Ta
-000241b0: 626c 6529 0a20 2020 2020 2020 2020 2020  ble).           
-000241c0: 2020 2020 2020 2020 2064 6620 3d20 7265           df = re
-000241d0: 7375 6c74 2e74 6f5f 7061 6e64 6173 2829  sult.to_pandas()
-000241e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000241f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00024200: 2020 2020 2020 2020 2020 2069 6620 696e             if in
-00024210: 6465 7865 7220 3d3d 2022 6466 223a 0a20  dexer == "df":. 
-00024220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024230: 2020 2020 2020 2061 7373 6572 7420 6973         assert is
-00024240: 696e 7374 616e 6365 2872 6573 756c 742c  instance(result,
-00024250: 2070 642e 4461 7461 4672 616d 6529 0a20   pd.DataFrame). 
-00024260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024270: 2020 2020 2020 2064 6620 3d20 7265 7375         df = resu
-00024280: 6c74 0a20 2020 2020 2020 2020 2020 2020  lt.             
-00024290: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000242a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000242b0: 2020 2020 2061 7373 6572 7420 6973 696e       assert isin
-000242c0: 7374 616e 6365 2872 6573 756c 742c 204f  stance(result, O
-000242d0: 7264 6572 6564 4469 6374 290a 2020 2020  rderedDict).    
-000242e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000242f0: 2020 2020 6466 203d 2070 642e 4461 7461      df = pd.Data
-00024300: 4672 616d 6528 7265 7375 6c74 290a 0a20  Frame(result).. 
-00024310: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00024320: 6f5f 736c 6963 6520 3d20 736c 6963 6528  o_slice = slice(
-00024330: 6964 782c 2069 6478 202b 206c 656e 2864  idx, idx + len(d
-00024340: 6629 290a 2020 2020 2020 2020 2020 2020  f)).            
-00024350: 2020 2020 6368 756e 6b20 3d20 6675 6c6c      chunk = full
-00024360: 5f64 6174 615b 746f 5f73 6c69 6365 5d0a  _data[to_slice].
-00024370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024380: 2061 7373 6572 7420 6e70 2e61 6c6c 2863   assert np.all(c
-00024390: 6875 6e6b 203d 3d20 6466 5b22 225d 2e76  hunk == df[""].v
-000243a0: 616c 7565 7329 0a20 2020 2020 2020 2020  alues).         
-000243b0: 2020 2020 2020 2061 7373 6572 7420 6e70         assert np
-000243c0: 2e61 6c6c 2864 665b 225f 5f64 696d 5f30  .all(df["__dim_0
-000243d0: 225d 203d 3d20 6e70 2e61 7261 6e67 6528  "] == np.arange(
-000243e0: 6964 782c 2069 6478 202b 206c 656e 2864  idx, idx + len(d
-000243f0: 6629 2929 0a20 2020 2020 2020 2020 2020  f))).           
-00024400: 2020 2020 2023 2075 7064 6174 6520 7468       # update th
-00024410: 6520 6375 7272 656e 7420 7265 6164 2063  e current read c
-00024420: 6f75 6e74 0a20 2020 2020 2020 2020 2020  ount.           
-00024430: 2020 2020 2069 6478 202b 3d20 6c65 6e28       idx += len(
-00024440: 6466 290a 0a20 2020 2020 2020 2061 7373  df)..        ass
-00024450: 6572 7420 6964 7820 3d3d 206c 656e 2866  ert idx == len(f
-00024460: 756c 6c5f 6461 7461 290a 0a0a 636c 6173  ull_data)...clas
-00024470: 7320 5465 7374 5465 7374 2844 6973 6b54  s TestTest(DiskT
-00024480: 6573 7443 6173 6529 3a0a 2020 2020 6465  estCase):.    de
-00024490: 6620 7465 7374 5f70 6174 6828 7365 6c66  f test_path(self
-000244a0: 2c20 7079 7465 7374 636f 6e66 6967 293a  , pytestconfig):
-000244b0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-000244c0: 7365 6c66 2e70 6174 6828 2266 6f6f 2229  self.path("foo")
-000244d0: 0a20 2020 2020 2020 2069 6620 7079 7465  .        if pyte
-000244e0: 7374 636f 6e66 6967 2e67 6574 6f70 7469  stconfig.getopti
-000244f0: 6f6e 2822 7666 7322 2920 3d3d 2022 7333  on("vfs") == "s3
-00024500: 223a 0a20 2020 2020 2020 2020 2020 2061  ":.            a
-00024510: 7373 6572 7420 7061 7468 2e73 7461 7274  ssert path.start
-00024520: 7377 6974 6828 2273 333a 2f2f 2229 0a0a  swith("s3://")..
-00024530: 2020 2020 4070 7974 6573 742e 6d61 726b      @pytest.mark
-00024540: 2e73 6b69 7069 6628 0a20 2020 2020 2020  .skipif(.       
-00024550: 2073 7973 2e70 6c61 7466 6f72 6d20 3d3d   sys.platform ==
-00024560: 2022 7769 6e33 3222 2c20 7265 6173 6f6e   "win32", reason
-00024570: 3d22 6e6f 5f6f 7574 7075 7420 6669 7874  ="no_output fixt
-00024580: 7572 6520 6469 7361 626c 6564 206f 6e20  ure disabled on 
-00024590: 5769 6e64 6f77 7322 0a20 2020 2029 0a20  Windows".    ). 
-000245a0: 2020 2040 7079 7465 7374 2e6d 6172 6b2e     @pytest.mark.
-000245b0: 7866 6169 6c28 0a20 2020 2020 2020 2054  xfail(.        T
-000245c0: 7275 652c 2072 6561 736f 6e3d 2254 6869  rue, reason="Thi
-000245d0: 7320 7465 7374 2070 7269 6e74 732c 2061  s test prints, a
-000245e0: 6e64 2073 686f 756c 6420 6661 696c 2062  nd should fail b
-000245f0: 6563 6175 7365 206f 6620 6e6f 5f6f 7574  ecause of no_out
-00024600: 7075 7420 6669 7874 7572 6521 220a 2020  put fixture!".  
-00024610: 2020 290a 2020 2020 6465 6620 7465 7374    ).    def test
-00024620: 5f6e 6f5f 6f75 7470 7574 2873 656c 6629  _no_output(self)
-00024630: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-00024640: 2274 6869 7320 7465 7374 2073 686f 756c  "this test shoul
-00024650: 6420 6661 696c 2229 0a0a 0a23 2069 6620  d fail")...# if 
-00024660: 5f5f 6e61 6d65 5f5f 203d 3d20 275f 5f6d  __name__ == '__m
-00024670: 6169 6e5f 5f27 3a0a 2320 2020 2023 2072  ain__':.#    # r
-00024680: 756e 2061 2073 696e 676c 6520 6578 616d  un a single exam
-00024690: 706c 6520 666f 7220 696e 2d70 726f 6365  ple for in-proce
-000246a0: 7373 2064 6562 7567 6769 6e67 0a23 2020  ss debugging.#  
-000246b0: 2020 2320 6265 7474 6572 2074 6f20 7573    # better to us
-000246c0: 6520 6070 7974 6573 7420 2d2d 6764 6260  e `pytest --gdb`
-000246d0: 2069 6620 6176 6169 6c61 626c 650a 2320   if available.# 
-000246e0: 2020 2074 203d 2044 656e 7365 4172 7261     t = DenseArra
-000246f0: 7954 6573 7428 290a 2320 2020 2074 2e73  yTest().#    t.s
-00024700: 6574 5570 2829 0a23 2020 2020 742e 7465  etUp().#    t.te
-00024710: 7374 5f61 7272 6179 5f31 6428 290a       st_array_1d().
+00016290: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+000162a0: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+000162b0: 2020 2020 2020 2020 2028 2261 3222 2c20           ("a2", 
+000162c0: 5b62 2242 7573 222c 2062 2254 6865 2052  [b"Bus", b"The R
+000162d0: 4944 4522 2c20 6222 5468 6520 5249 4445  IDE", b"The RIDE
+000162e0: 222c 2062 2254 6865 2052 4944 4522 5d29  ", b"The RIDE"])
+000162f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00016300: 2020 2822 6133 222c 205b 6222 4275 7322    ("a3", [b"Bus"
+00016310: 2c20 6222 5468 6520 5249 4445 222c 2062  , b"The RIDE", b
+00016320: 2254 6865 2052 4944 4522 2c20 6222 5468  "The RIDE", b"Th
+00016330: 6520 5249 4445 225d 292c 0a20 2020 2020  e RIDE"]),.     
+00016340: 2020 2020 2020 2020 2020 2028 2261 3422             ("a4"
+00016350: 2c20 6e70 2e61 7272 6179 285b 3639 3131  , np.array([6911
+00016360: 3732 312c 2031 3338 3034 382c 2031 3338  721, 138048, 138
+00016370: 3034 382c 2031 3338 3034 385d 2c20 6474  048, 138048], dt
+00016380: 7970 653d 2269 6e74 3332 2229 292c 0a20  ype="int32")),. 
+00016390: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+000163a0: 2261 3522 2c20 6e70 2e61 7272 6179 285b  "a5", np.array([
+000163b0: 3230 2c20 3233 2c20 3233 2c20 3233 5d2c  20, 23, 23, 23],
+000163c0: 2064 7479 7065 3d22 696e 7438 2229 292c   dtype="int8")),
+000163d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000163e0: 2028 2261 3622 2c20 6e70 2e61 7272 6179   ("a6", np.array
+000163f0: 285b 3334 3535 3836 2c20 3630 3032 2c20  ([345586, 6002, 
+00016400: 3630 3032 2c20 3630 3032 5d2c 2064 7479  6002, 6002], dty
+00016410: 7065 3d22 696e 7433 3222 2929 2c0a 2020  pe="int32")),.  
+00016420: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
+00016430: 2020 2020 290a 0a20 2020 2020 2020 2077      )..        w
+00016440: 6974 6820 7469 6c65 6462 2e6f 7065 6e28  ith tiledb.open(
+00016450: 7572 692c 2022 7722 2920 6173 2041 3a0a  uri, "w") as A:.
+00016460: 2020 2020 2020 2020 2020 2020 415b 5b31              A[[1
+00016470: 2c20 3436 322c 2034 3632 2c20 3436 325d  , 462, 462, 462]
+00016480: 5d20 3d20 6461 7461 0a0a 2020 2020 2020  ] = data..      
+00016490: 2020 7769 7468 2074 696c 6564 622e 6f70    with tiledb.op
+000164a0: 656e 2875 7269 2920 6173 2041 3a0a 2020  en(uri) as A:.  
+000164b0: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
+000164c0: 415b 3a5d 0a20 2020 2020 2020 2020 2020  A[:].           
+000164d0: 2072 6573 2e70 6f70 2822 6964 2229 0a20   res.pop("id"). 
+000164e0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+000164f0: 2c20 7620 696e 2072 6573 2e69 7465 6d73  , v in res.items
+00016500: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00016510: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00016520: 6528 6461 7461 5b6b 5d2c 2028 6e70 2e6e  e(data[k], (np.n
+00016530: 6461 7272 6179 2c20 6c69 7374 2929 3a0a  darray, list)):.
+00016540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016550: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
+00016560: 5f65 7175 616c 2872 6573 5b6b 5d2c 2064  _equal(res[k], d
+00016570: 6174 615b 6b5d 290a 2020 2020 2020 2020  ata[k]).        
+00016580: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00016590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000165a0: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+000165b0: 616c 2872 6573 5b6b 5d2c 2064 6174 615b  al(res[k], data[
+000165c0: 6b5d 290a 0a20 2020 2064 6566 2074 6573  k])..    def tes
+000165d0: 745f 7370 6172 7365 5f32 645f 7661 726c  t_sparse_2d_varl
+000165e0: 656e 5f69 6e74 2873 656c 662c 2073 7061  en_int(self, spa
+000165f0: 7273 655f 6365 6c6c 5f6f 7264 6572 293a  rse_cell_order):
+00016600: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+00016610: 7365 6c66 2e70 6174 6828 2274 6573 745f  self.path("test_
+00016620: 7370 6172 7365 5f32 645f 7661 726c 656e  sparse_2d_varlen
+00016630: 5f69 6e74 2229 0a20 2020 2020 2020 2064  _int").        d
+00016640: 7479 7065 203d 206e 702e 696e 7433 320a  type = np.int32.
+00016650: 2020 2020 2020 2020 646f 6d20 3d20 7469          dom = ti
+00016660: 6c65 6462 2e44 6f6d 6169 6e28 0a20 2020  ledb.Domain(.   
+00016670: 2020 2020 2020 2020 2074 696c 6564 622e           tiledb.
+00016680: 4469 6d28 646f 6d61 696e 3d28 312c 2034  Dim(domain=(1, 4
+00016690: 292c 2074 696c 653d 3229 2c20 7469 6c65  ), tile=2), tile
+000166a0: 6462 2e44 696d 2864 6f6d 6169 6e3d 2831  db.Dim(domain=(1
+000166b0: 2c20 3429 2c20 7469 6c65 3d32 290a 2020  , 4), tile=2).  
+000166c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000166d0: 6174 7420 3d20 7469 6c65 6462 2e41 7474  att = tiledb.Att
+000166e0: 7228 6474 7970 653d 6474 7970 652c 2076  r(dtype=dtype, v
+000166f0: 6172 3d54 7275 6529 0a20 2020 2020 2020  ar=True).       
+00016700: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
+00016710: 2e41 7272 6179 5363 6865 6d61 280a 2020  .ArraySchema(.  
+00016720: 2020 2020 2020 2020 2020 646f 6d2c 2028            dom, (
+00016730: 6174 742c 292c 2073 7061 7273 653d 5472  att,), sparse=Tr
+00016740: 7565 2c20 6365 6c6c 5f6f 7264 6572 3d73  ue, cell_order=s
+00016750: 7061 7273 655f 6365 6c6c 5f6f 7264 6572  parse_cell_order
+00016760: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00016770: 2020 2020 7469 6c65 6462 2e53 7061 7273      tiledb.Spars
+00016780: 6541 7272 6179 2e63 7265 6174 6528 7061  eArray.create(pa
+00016790: 7468 2c20 7363 6865 6d61 290a 0a20 2020  th, schema)..   
+000167a0: 2020 2020 2069 6620 7469 6c65 6462 2e6c       if tiledb.l
+000167b0: 6962 7469 6c65 6462 2e76 6572 7369 6f6e  ibtiledb.version
+000167c0: 2829 203e 3d20 2832 2c20 3329 2061 6e64  () >= (2, 3) and
+000167d0: 2073 7061 7273 655f 6365 6c6c 5f6f 7264   sparse_cell_ord
+000167e0: 6572 203d 3d20 2268 696c 6265 7274 223a  er == "hilbert":
+000167f0: 0a20 2020 2020 2020 2020 2020 2063 3120  .            c1 
+00016800: 3d20 6e70 2e61 7272 6179 285b 322c 2031  = np.array([2, 1
+00016810: 2c20 332c 2034 5d29 0a20 2020 2020 2020  , 3, 4]).       
+00016820: 2020 2020 2063 3220 3d20 6e70 2e61 7272       c2 = np.arr
+00016830: 6179 285b 312c 2032 2c20 332c 2034 5d29  ay([1, 2, 3, 4])
+00016840: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00016850: 2020 2020 2020 2020 2020 2063 3120 3d20             c1 = 
+00016860: 6e70 2e61 7272 6179 285b 312c 2032 2c20  np.array([1, 2, 
+00016870: 332c 2034 5d29 0a20 2020 2020 2020 2020  3, 4]).         
+00016880: 2020 2063 3220 3d20 6e70 2e61 7272 6179     c2 = np.array
+00016890: 285b 322c 2031 2c20 332c 2034 5d29 0a0a  ([2, 1, 3, 4])..
+000168a0: 2020 2020 2020 2020 6461 7461 203d 206e          data = n
+000168b0: 702e 6172 7261 7928 0a20 2020 2020 2020  p.array(.       
+000168c0: 2020 2020 205b 0a20 2020 2020 2020 2020       [.         
+000168d0: 2020 2020 2020 206e 702e 6172 7261 7928         np.array(
+000168e0: 5b31 2c20 315d 2c20 6474 7970 653d 6e70  [1, 1], dtype=np
+000168f0: 2e69 6e74 3332 292c 0a20 2020 2020 2020  .int32),.       
+00016900: 2020 2020 2020 2020 206e 702e 6172 7261           np.arra
+00016910: 7928 5b32 5d2c 2064 7479 7065 3d6e 702e  y([2], dtype=np.
+00016920: 696e 7433 3229 2c0a 2020 2020 2020 2020  int32),.        
+00016930: 2020 2020 2020 2020 6e70 2e61 7272 6179          np.array
+00016940: 285b 332c 2033 2c20 335d 2c20 6474 7970  ([3, 3, 3], dtyp
+00016950: 653d 6e70 2e69 6e74 3332 292c 0a20 2020  e=np.int32),.   
+00016960: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+00016970: 6172 7261 7928 5b34 5d2c 2064 7479 7065  array([4], dtype
+00016980: 3d6e 702e 696e 7433 3229 2c0a 2020 2020  =np.int32),.    
+00016990: 2020 2020 2020 2020 5d2c 0a20 2020 2020          ],.     
+000169a0: 2020 2020 2020 2064 7479 7065 3d22 4f22         dtype="O"
+000169b0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+000169c0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+000169d0: 2e53 7061 7273 6541 7272 6179 2870 6174  .SparseArray(pat
+000169e0: 682c 2022 7722 2920 6173 2041 3a0a 2020  h, "w") as A:.  
+000169f0: 2020 2020 2020 2020 2020 415b 6331 2c20            A[c1, 
+00016a00: 6332 5d20 3d20 6461 7461 0a0a 2020 2020  c2] = data..    
+00016a10: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+00016a20: 5370 6172 7365 4172 7261 7928 7061 7468  SparseArray(path
+00016a30: 2920 6173 2041 3a0a 2020 2020 2020 2020  ) as A:.        
+00016a40: 2020 2020 7265 7320 3d20 415b 3a5d 0a20      res = A[:]. 
+00016a50: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+00016a60: 745f 7375 6261 7272 6179 735f 6571 7561  t_subarrays_equa
+00016a70: 6c28 7265 735b 2222 5d2c 2064 6174 6129  l(res[""], data)
+00016a80: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+00016a90: 6572 745f 756e 6f72 6465 7265 645f 6571  ert_unordered_eq
+00016aa0: 7561 6c28 7265 735b 225f 5f64 696d 5f30  ual(res["__dim_0
+00016ab0: 225d 2c20 6331 290a 2020 2020 2020 2020  "], c1).        
+00016ac0: 2020 2020 6173 7365 7274 5f75 6e6f 7264      assert_unord
+00016ad0: 6572 6564 5f65 7175 616c 2872 6573 5b22  ered_equal(res["
+00016ae0: 5f5f 6469 6d5f 3122 5d2c 2063 3229 0a0a  __dim_1"], c2)..
+00016af0: 2020 2020 6465 6620 7465 7374 5f73 7061      def test_spa
+00016b00: 7273 655f 6d69 7865 645f 646f 6d61 696e  rse_mixed_domain
+00016b10: 5f75 696e 745f 666c 6f61 7436 3428 7365  _uint_float64(se
+00016b20: 6c66 2c20 7370 6172 7365 5f63 656c 6c5f  lf, sparse_cell_
+00016b30: 6f72 6465 7229 3a0a 2020 2020 2020 2020  order):.        
+00016b40: 7061 7468 203d 2073 656c 662e 7061 7468  path = self.path
+00016b50: 2822 6d69 7865 645f 646f 6d61 696e 5f75  ("mixed_domain_u
+00016b60: 696e 745f 666c 6f61 7436 3422 290a 2020  int_float64").  
+00016b70: 2020 2020 2020 6469 6d73 203d 205b 0a20        dims = [. 
+00016b80: 2020 2020 2020 2020 2020 2074 696c 6564             tiled
+00016b90: 622e 4469 6d28 6e61 6d65 3d22 696e 6465  b.Dim(name="inde
+00016ba0: 7822 2c20 646f 6d61 696e 3d28 302c 2035  x", domain=(0, 5
+00016bb0: 3129 2c20 7469 6c65 3d31 312c 2064 7479  1), tile=11, dty
+00016bc0: 7065 3d6e 702e 7569 6e74 3634 292c 0a20  pe=np.uint64),. 
+00016bd0: 2020 2020 2020 2020 2020 2074 696c 6564             tiled
+00016be0: 622e 4469 6d28 6e61 6d65 3d22 6470 6f73  b.Dim(name="dpos
+00016bf0: 222c 2064 6f6d 6169 6e3d 282d 3130 302e  ", domain=(-100.
+00016c00: 302c 2031 3030 2e30 292c 2074 696c 653d  0, 100.0), tile=
+00016c10: 3130 2c20 6474 7970 653d 6e70 2e66 6c6f  10, dtype=np.flo
+00016c20: 6174 3634 292c 0a20 2020 2020 2020 205d  at64),.        ]
+00016c30: 0a20 2020 2020 2020 2064 6f6d 203d 2074  .        dom = t
+00016c40: 696c 6564 622e 446f 6d61 696e 282a 6469  iledb.Domain(*di
+00016c50: 6d73 290a 2020 2020 2020 2020 6174 7472  ms).        attr
+00016c60: 7320 3d20 5b74 696c 6564 622e 4174 7472  s = [tiledb.Attr
+00016c70: 286e 616d 653d 2276 616c 222c 2064 7479  (name="val", dty
+00016c80: 7065 3d6e 702e 666c 6f61 7436 3429 5d0a  pe=np.float64)].
+00016c90: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
+00016ca0: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
+00016cb0: 6865 6d61 280a 2020 2020 2020 2020 2020  hema(.          
+00016cc0: 2020 646f 6d61 696e 3d64 6f6d 2c20 6174    domain=dom, at
+00016cd0: 7472 733d 6174 7472 732c 2073 7061 7273  trs=attrs, spars
+00016ce0: 653d 5472 7565 2c20 6365 6c6c 5f6f 7264  e=True, cell_ord
+00016cf0: 6572 3d73 7061 7273 655f 6365 6c6c 5f6f  er=sparse_cell_o
+00016d00: 7264 6572 0a20 2020 2020 2020 2029 0a20  rder.        ). 
+00016d10: 2020 2020 2020 2074 696c 6564 622e 5370         tiledb.Sp
+00016d20: 6172 7365 4172 7261 792e 6372 6561 7465  arseArray.create
+00016d30: 2870 6174 682c 2073 6368 656d 6129 0a0a  (path, schema)..
+00016d40: 2020 2020 2020 2020 6461 7461 203d 206e          data = n
+00016d50: 702e 7261 6e64 6f6d 2e72 616e 6428 3530  p.random.rand(50
+00016d60: 2c20 3633 290a 2020 2020 2020 2020 636f  , 63).        co
+00016d70: 6f72 6473 3120 3d20 6e70 2e72 6570 6561  ords1 = np.repea
+00016d80: 7428 6e70 2e61 7261 6e67 6528 302c 2035  t(np.arange(0, 5
+00016d90: 3029 2c20 3633 290a 2020 2020 2020 2020  0), 63).        
+00016da0: 636f 6f72 6473 3220 3d20 6e70 2e6c 696e  coords2 = np.lin
+00016db0: 7370 6163 6528 2d31 3030 2e30 2c20 3130  space(-100.0, 10
+00016dc0: 302e 302c 206e 756d 3d33 3135 3029 0a0a  0.0, num=3150)..
+00016dd0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
+00016de0: 6564 622e 6f70 656e 2870 6174 682c 2022  edb.open(path, "
+00016df0: 7722 2920 6173 2041 3a0a 2020 2020 2020  w") as A:.      
+00016e00: 2020 2020 2020 415b 636f 6f72 6473 312c        A[coords1,
+00016e10: 2063 6f6f 7264 7332 5d20 3d20 6461 7461   coords2] = data
+00016e20: 0a0a 2020 2020 2020 2020 2320 7469 6c65  ..        # tile
+00016e30: 6462 2072 6574 7572 6e73 2063 6f6f 7264  db returns coord
+00016e40: 696e 6174 6573 2069 6e20 736f 7274 6564  inates in sorted
+00016e50: 206f 7264 6572 2c20 736f 2077 6520 6e65   order, so we ne
+00016e60: 6564 2074 6f20 6368 6563 6b20 7468 6520  ed to check the 
+00016e70: 6f75 7470 7574 0a20 2020 2020 2020 2023  output.        #
+00016e80: 2073 6f72 7465 6420 6279 2074 6865 2066   sorted by the f
+00016e90: 6972 7374 2064 696d 2063 6f6f 7264 696e  irst dim coordin
+00016ea0: 6174 6573 0a20 2020 2020 2020 2073 6964  ates.        sid
+00016eb0: 7820 3d20 6e70 2e61 7267 736f 7274 2863  x = np.argsort(c
+00016ec0: 6f6f 7264 7331 2c20 6b69 6e64 3d22 7374  oords1, kind="st
+00016ed0: 6162 6c65 2229 0a20 2020 2020 2020 2063  able").        c
+00016ee0: 6f6f 7264 7332 5f69 6478 203d 206e 702e  oords2_idx = np.
+00016ef0: 7469 6c65 286e 702e 6172 616e 6765 2830  tile(np.arange(0
+00016f00: 2c20 3633 292c 2035 3029 5b73 6964 785d  , 63), 50)[sidx]
+00016f10: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
+00016f20: 696c 6564 622e 6f70 656e 2870 6174 6829  iledb.open(path)
+00016f30: 2061 7320 413a 0a20 2020 2020 2020 2020   as A:.         
+00016f40: 2020 2072 6573 203d 2041 5b3a 5d0a 2020     res = A[:].  
+00016f50: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00016f60: 5f73 7562 6172 7261 7973 5f65 7175 616c  _subarrays_equal
+00016f70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00016f80: 2020 6461 7461 5b63 6f6f 7264 7331 5b73    data[coords1[s
+00016f90: 6964 785d 2c20 636f 6f72 6473 325f 6964  idx], coords2_id
+00016fa0: 785b 7369 6478 5d5d 2c0a 2020 2020 2020  x[sidx]],.      
+00016fb0: 2020 2020 2020 2020 2020 7265 735b 2276            res["v
+00016fc0: 616c 225d 2c0a 2020 2020 2020 2020 2020  al"],.          
+00016fd0: 2020 2020 2020 7370 6172 7365 5f63 656c        sparse_cel
+00016fe0: 6c5f 6f72 6465 7220 213d 2022 6869 6c62  l_order != "hilb
+00016ff0: 6572 7422 2c0a 2020 2020 2020 2020 2020  ert",.          
+00017000: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00017010: 615f 6e6f 6e65 6d70 7479 203d 2041 2e6e  a_nonempty = A.n
+00017020: 6f6e 656d 7074 795f 646f 6d61 696e 2829  onempty_domain()
+00017030: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00017040: 662e 6173 7365 7274 4571 7561 6c28 615f  f.assertEqual(a_
+00017050: 6e6f 6e65 6d70 7479 5b30 5d2c 2028 302c  nonempty[0], (0,
+00017060: 2034 3929 290a 2020 2020 2020 2020 2020   49)).          
+00017070: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00017080: 616c 2861 5f6e 6f6e 656d 7074 795b 315d  al(a_nonempty[1]
+00017090: 2c20 282d 3130 302e 302c 2031 3030 2e30  , (-100.0, 100.0
+000170a0: 2929 0a0a 2020 2020 6465 6620 7465 7374  ))..    def test
+000170b0: 5f73 7061 7273 655f 7374 7269 6e67 5f64  _sparse_string_d
+000170c0: 6f6d 6169 6e28 7365 6c66 2c20 7370 6172  omain(self, spar
+000170d0: 7365 5f63 656c 6c5f 6f72 6465 7229 3a0a  se_cell_order):.
+000170e0: 2020 2020 2020 2020 7061 7468 203d 2073          path = s
+000170f0: 656c 662e 7061 7468 2822 7370 6172 7365  elf.path("sparse
+00017100: 5f73 7472 696e 675f 646f 6d61 696e 2229  _string_domain")
+00017110: 0a20 2020 2020 2020 2064 6f6d 203d 2074  .        dom = t
+00017120: 696c 6564 622e 446f 6d61 696e 2874 696c  iledb.Domain(til
+00017130: 6564 622e 4469 6d28 6e61 6d65 3d22 6422  edb.Dim(name="d"
+00017140: 2c20 646f 6d61 696e 3d28 4e6f 6e65 2c20  , domain=(None, 
+00017150: 4e6f 6e65 292c 2064 7479 7065 3d6e 702e  None), dtype=np.
+00017160: 6279 7465 735f 2929 0a20 2020 2020 2020  bytes_)).       
+00017170: 2061 7474 203d 2074 696c 6564 622e 4174   att = tiledb.At
+00017180: 7472 286e 616d 653d 2261 222c 2064 7479  tr(name="a", dty
+00017190: 7065 3d6e 702e 696e 7436 3429 0a20 2020  pe=np.int64).   
+000171a0: 2020 2020 2073 6368 656d 6120 3d20 7469       schema = ti
+000171b0: 6c65 6462 2e41 7272 6179 5363 6865 6d61  ledb.ArraySchema
+000171c0: 280a 2020 2020 2020 2020 2020 2020 646f  (.            do
+000171d0: 6d61 696e 3d64 6f6d 2c0a 2020 2020 2020  main=dom,.      
+000171e0: 2020 2020 2020 6174 7472 733d 2861 7474        attrs=(att
+000171f0: 2c29 2c0a 2020 2020 2020 2020 2020 2020  ,),.            
+00017200: 7370 6172 7365 3d54 7275 652c 0a20 2020  sparse=True,.   
+00017210: 2020 2020 2020 2020 2063 656c 6c5f 6f72           cell_or
+00017220: 6465 723d 7370 6172 7365 5f63 656c 6c5f  der=sparse_cell_
+00017230: 6f72 6465 722c 0a20 2020 2020 2020 2020  order,.         
+00017240: 2020 2063 6170 6163 6974 793d 3130 3030     capacity=1000
+00017250: 302c 0a20 2020 2020 2020 2029 0a20 2020  0,.        ).   
+00017260: 2020 2020 2074 696c 6564 622e 5370 6172       tiledb.Spar
+00017270: 7365 4172 7261 792e 6372 6561 7465 2870  seArray.create(p
+00017280: 6174 682c 2073 6368 656d 6129 0a0a 2020  ath, schema)..  
+00017290: 2020 2020 2020 6461 7461 203d 205b 312c        data = [1,
+000172a0: 2032 2c20 332c 2034 5d0a 2020 2020 2020   2, 3, 4].      
+000172b0: 2020 636f 6f72 6473 203d 205b 6222 6161    coords = [b"aa
+000172c0: 222c 2062 2262 6262 222c 2062 2263 222c  ", b"bbb", b"c",
+000172d0: 2062 2264 6464 6422 5d0a 0a20 2020 2020   b"dddd"]..     
+000172e0: 2020 2077 6974 6820 7469 6c65 6462 2e6f     with tiledb.o
+000172f0: 7065 6e28 7061 7468 2c20 2277 2229 2061  pen(path, "w") a
+00017300: 7320 413a 0a20 2020 2020 2020 2020 2020  s A:.           
+00017310: 2041 5b63 6f6f 7264 735d 203d 2064 6174   A[coords] = dat
+00017320: 610a 0a20 2020 2020 2020 2077 6974 6820  a..        with 
+00017330: 7469 6c65 6462 2e6f 7065 6e28 7061 7468  tiledb.open(path
+00017340: 2920 6173 2041 3a0a 2020 2020 2020 2020  ) as A:.        
+00017350: 2020 2020 6e65 6420 3d20 412e 6e6f 6e65      ned = A.none
+00017360: 6d70 7479 5f64 6f6d 6169 6e28 295b 305d  mpty_domain()[0]
+00017370: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00017380: 203d 2041 5b6e 6564 5b30 5d20 3a20 6e65   = A[ned[0] : ne
+00017390: 645b 315d 5d0a 2020 2020 2020 2020 2020  d[1]].          
+000173a0: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
+000173b0: 7175 616c 2872 6573 5b22 6122 5d2c 2064  qual(res["a"], d
+000173c0: 6174 6129 0a20 2020 2020 2020 2020 2020  ata).           
+000173d0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+000173e0: 6c28 7365 7428 7265 735b 2264 225d 292c  l(set(res["d"]),
+000173f0: 2073 6574 2863 6f6f 7264 7329 290a 2020   set(coords)).  
+00017400: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00017410: 7373 6572 7445 7175 616c 2841 2e6e 6f6e  ssertEqual(A.non
+00017420: 656d 7074 795f 646f 6d61 696e 2829 2c20  empty_domain(), 
+00017430: 2828 6222 6161 222c 2062 2264 6464 6422  ((b"aa", b"dddd"
+00017440: 292c 2929 0a0a 2020 2020 6465 6620 7465  ),))..    def te
+00017450: 7374 5f73 7061 7273 655f 7374 7269 6e67  st_sparse_string
+00017460: 5f64 6f6d 6169 6e32 2873 656c 662c 2073  _domain2(self, s
+00017470: 7061 7273 655f 6365 6c6c 5f6f 7264 6572  parse_cell_order
+00017480: 293a 0a20 2020 2020 2020 2070 6174 6820  ):.        path 
+00017490: 3d20 7365 6c66 2e70 6174 6828 2273 7061  = self.path("spa
+000174a0: 7273 655f 7374 7269 6e67 5f64 6f6d 6169  rse_string_domai
+000174b0: 6e32 2229 0a20 2020 2020 2020 2064 696d  n2").        dim
+000174c0: 7320 3d20 5b74 696c 6564 622e 4469 6d28  s = [tiledb.Dim(
+000174d0: 6e61 6d65 3d22 7374 7222 2c20 646f 6d61  name="str", doma
+000174e0: 696e 3d28 4e6f 6e65 2c20 4e6f 6e65 292c  in=(None, None),
+000174f0: 2074 696c 653d 4e6f 6e65 2c20 6474 7970   tile=None, dtyp
+00017500: 653d 6e70 2e62 7974 6573 5f29 5d0a 2020  e=np.bytes_)].  
+00017510: 2020 2020 2020 646f 6d20 3d20 7469 6c65        dom = tile
+00017520: 6462 2e44 6f6d 6169 6e28 2a64 696d 7329  db.Domain(*dims)
+00017530: 0a20 2020 2020 2020 2061 7474 7273 203d  .        attrs =
+00017540: 205b 7469 6c65 6462 2e41 7474 7228 6e61   [tiledb.Attr(na
+00017550: 6d65 3d22 7661 6c22 2c20 6474 7970 653d  me="val", dtype=
+00017560: 6e70 2e66 6c6f 6174 3634 295d 0a0a 2020  np.float64)]..  
+00017570: 2020 2020 2020 7363 6865 6d61 203d 2074        schema = t
+00017580: 696c 6564 622e 4172 7261 7953 6368 656d  iledb.ArraySchem
+00017590: 6128 0a20 2020 2020 2020 2020 2020 2064  a(.            d
+000175a0: 6f6d 6169 6e3d 646f 6d2c 2061 7474 7273  omain=dom, attrs
+000175b0: 3d61 7474 7273 2c20 7370 6172 7365 3d54  =attrs, sparse=T
+000175c0: 7275 652c 2063 656c 6c5f 6f72 6465 723d  rue, cell_order=
+000175d0: 7370 6172 7365 5f63 656c 6c5f 6f72 6465  sparse_cell_orde
+000175e0: 720a 2020 2020 2020 2020 290a 2020 2020  r.        ).    
+000175f0: 2020 2020 7469 6c65 6462 2e53 7061 7273      tiledb.Spars
+00017600: 6541 7272 6179 2e63 7265 6174 6528 7061  eArray.create(pa
+00017610: 7468 2c20 7363 6865 6d61 290a 0a20 2020  th, schema)..   
+00017620: 2020 2020 2064 6174 6120 3d20 6e70 2e72       data = np.r
+00017630: 616e 646f 6d2e 7261 6e64 2831 3029 0a20  andom.rand(10). 
+00017640: 2020 2020 2020 2063 6f6f 7264 7320 3d20         coords = 
+00017650: 5b72 616e 645f 6173 6369 695f 6279 7465  [rand_ascii_byte
+00017660: 7328 7261 6e64 6f6d 2e72 616e 6469 6e74  s(random.randint
+00017670: 2835 2c20 3530 2929 2066 6f72 205f 2069  (5, 50)) for _ i
+00017680: 6e20 7261 6e67 6528 3130 295d 0a0a 2020  n range(10)]..  
+00017690: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+000176a0: 622e 6f70 656e 2870 6174 682c 2022 7722  b.open(path, "w"
+000176b0: 2920 6173 2041 3a0a 2020 2020 2020 2020  ) as A:.        
+000176c0: 2020 2020 415b 636f 6f72 6473 5d20 3d20      A[coords] = 
+000176d0: 6461 7461 0a0a 2020 2020 2020 2020 7769  data..        wi
+000176e0: 7468 2074 696c 6564 622e 6f70 656e 2870  th tiledb.open(p
+000176f0: 6174 6829 2061 7320 413a 0a20 2020 2020  ath) as A:.     
+00017700: 2020 2020 2020 206e 6564 203d 2041 2e6e         ned = A.n
+00017710: 6f6e 656d 7074 795f 646f 6d61 696e 2829  onempty_domain()
+00017720: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00017730: 7265 7320 3d20 415b 6e65 645b 305d 203a  res = A[ned[0] :
+00017740: 206e 6564 5b31 5d5d 0a20 2020 2020 2020   ned[1]].       
+00017750: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00017760: 5472 7565 2873 6574 2872 6573 5b22 7374  True(set(res["st
+00017770: 7222 5d29 203d 3d20 7365 7428 636f 6f72  r"]) == set(coor
+00017780: 6473 2929 0a20 2020 2020 2020 2020 2020  ds)).           
+00017790: 2023 206d 7573 7420 6368 6563 6b20 6461   # must check da
+000177a0: 7461 206f 7264 6572 6564 2062 7920 636f  ta ordered by co
+000177b0: 6f72 6473 0a20 2020 2020 2020 2020 2020  ords.           
+000177c0: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+000177d0: 7561 6c28 7265 735b 2276 616c 225d 2c20  ual(res["val"], 
+000177e0: 6461 7461 5b6e 702e 6172 6773 6f72 7428  data[np.argsort(
+000177f0: 636f 6f72 6473 2c20 6b69 6e64 3d22 7374  coords, kind="st
+00017800: 6162 6c65 2229 5d29 0a0a 2020 2020 6465  able")])..    de
+00017810: 6620 7465 7374 5f73 7061 7273 655f 6d69  f test_sparse_mi
+00017820: 7865 645f 646f 6d61 696e 2873 656c 662c  xed_domain(self,
+00017830: 2073 7061 7273 655f 6365 6c6c 5f6f 7264   sparse_cell_ord
+00017840: 6572 293a 0a20 2020 2020 2020 2075 7269  er):.        uri
+00017850: 203d 2073 656c 662e 7061 7468 2822 7370   = self.path("sp
+00017860: 6172 7365 5f6d 6978 6564 5f64 6f6d 6169  arse_mixed_domai
+00017870: 6e22 290a 2020 2020 2020 2020 6469 6d73  n").        dims
+00017880: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+00017890: 2074 696c 6564 622e 4469 6d28 6e61 6d65   tiledb.Dim(name
+000178a0: 3d22 7022 2c20 646f 6d61 696e 3d28 2d31  ="p", domain=(-1
+000178b0: 3030 2e30 2c20 3130 302e 3029 2c20 7469  00.0, 100.0), ti
+000178c0: 6c65 3d31 302c 2064 7479 7065 3d6e 702e  le=10, dtype=np.
+000178d0: 666c 6f61 7436 3429 2c0a 2020 2020 2020  float64),.      
+000178e0: 2020 2020 2020 7469 6c65 6462 2e44 696d        tiledb.Dim
+000178f0: 286e 616d 653d 2273 7472 222c 2064 6f6d  (name="str", dom
+00017900: 6169 6e3d 284e 6f6e 652c 204e 6f6e 6529  ain=(None, None)
+00017910: 2c20 7469 6c65 3d4e 6f6e 652c 2064 7479  , tile=None, dty
+00017920: 7065 3d6e 702e 6279 7465 735f 292c 0a20  pe=np.bytes_),. 
+00017930: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00017940: 2064 6f6d 203d 2074 696c 6564 622e 446f   dom = tiledb.Do
+00017950: 6d61 696e 282a 6469 6d73 290a 2020 2020  main(*dims).    
+00017960: 2020 2020 6174 7472 7320 3d20 5b74 696c      attrs = [til
+00017970: 6564 622e 4174 7472 286e 616d 653d 2276  edb.Attr(name="v
+00017980: 616c 222c 2064 7479 7065 3d6e 702e 666c  al", dtype=np.fl
+00017990: 6f61 7436 3429 5d0a 0a20 2020 2020 2020  oat64)]..       
+000179a0: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
+000179b0: 2e41 7272 6179 5363 6865 6d61 280a 2020  .ArraySchema(.  
+000179c0: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
+000179d0: 3d64 6f6d 2c20 6174 7472 733d 6174 7472  =dom, attrs=attr
+000179e0: 732c 2073 7061 7273 653d 5472 7565 2c20  s, sparse=True, 
+000179f0: 6365 6c6c 5f6f 7264 6572 3d73 7061 7273  cell_order=spars
+00017a00: 655f 6365 6c6c 5f6f 7264 6572 0a20 2020  e_cell_order.   
+00017a10: 2020 2020 2029 0a20 2020 2020 2020 2074       ).        t
+00017a20: 696c 6564 622e 5370 6172 7365 4172 7261  iledb.SparseArra
+00017a30: 792e 6372 6561 7465 2875 7269 2c20 7363  y.create(uri, sc
+00017a40: 6865 6d61 290a 0a20 2020 2020 2020 206e  hema)..        n
+00017a50: 726f 7773 203d 2035 0a20 2020 2020 2020  rows = 5.       
+00017a60: 2069 6478 5f66 3634 203d 206e 702e 7261   idx_f64 = np.ra
+00017a70: 6e64 6f6d 2e72 616e 6428 6e72 6f77 7329  ndom.rand(nrows)
+00017a80: 0a20 2020 2020 2020 2069 6478 5f73 7472  .        idx_str
+00017a90: 203d 205b 7261 6e64 5f61 7363 6969 2835   = [rand_ascii(5
+00017aa0: 292e 656e 636f 6465 2822 7574 662d 3822  ).encode("utf-8"
+00017ab0: 2920 666f 7220 5f20 696e 2072 616e 6765  ) for _ in range
+00017ac0: 286e 726f 7773 295d 0a20 2020 2020 2020  (nrows)].       
+00017ad0: 2064 6174 6120 3d20 6e70 2e72 616e 646f   data = np.rando
+00017ae0: 6d2e 7261 6e64 286e 726f 7773 290a 0a20  m.rand(nrows).. 
+00017af0: 2020 2020 2020 2077 6974 6820 7469 6c65         with tile
+00017b00: 6462 2e53 7061 7273 6541 7272 6179 2875  db.SparseArray(u
+00017b10: 7269 2c20 2277 2229 2061 7320 413a 0a20  ri, "w") as A:. 
+00017b20: 2020 2020 2020 2020 2020 2041 5b69 6478             A[idx
+00017b30: 5f66 3634 2c20 6964 785f 7374 725d 203d  _f64, idx_str] =
+00017b40: 207b 2276 616c 223a 2064 6174 617d 0a0a   {"val": data}..
+00017b50: 2020 2020 2020 2020 2320 7465 7374 2068          # test h
+00017b60: 6574 6572 6f67 656e 656f 7573 2064 696d  eterogeneous dim
+00017b70: 206e 6f6e 656d 7074 795f 646f 6d61 696e   nonempty_domain
+00017b80: 0a20 2020 2020 2020 206e 6564 5f66 3634  .        ned_f64
+00017b90: 203d 2028 6e70 2e61 7272 6179 286e 702e   = (np.array(np.
+00017ba0: 6d69 6e28 6964 785f 6636 3429 292c 206e  min(idx_f64)), n
+00017bb0: 702e 6172 7261 7928 6e70 2e6d 6178 2869  p.array(np.max(i
+00017bc0: 6478 5f66 3634 2929 290a 2020 2020 2020  dx_f64))).      
+00017bd0: 2020 6964 785f 7374 722e 736f 7274 2829    idx_str.sort()
+00017be0: 0a20 2020 2020 2020 206e 6564 5f73 7472  .        ned_str
+00017bf0: 203d 2069 6478 5f73 7472 5b30 5d2c 2069   = idx_str[0], i
+00017c00: 6478 5f73 7472 5b2d 315d 0a0a 2020 2020  dx_str[-1]..    
+00017c10: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+00017c20: 5370 6172 7365 4172 7261 7928 7572 692c  SparseArray(uri,
+00017c30: 2022 7222 2920 6173 2041 3a0a 2020 2020   "r") as A:.    
+00017c40: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00017c50: 6572 7445 7175 616c 2841 2e6e 6f6e 656d  ertEqual(A.nonem
+00017c60: 7074 795f 646f 6d61 696e 2829 2c20 286e  pty_domain(), (n
+00017c70: 6564 5f66 3634 2c20 6e65 645f 7374 7229  ed_f64, ned_str)
+00017c80: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00017c90: 7370 6172 7365 5f67 6574 5f75 6e69 7175  sparse_get_uniqu
+00017ca0: 655f 6469 6d5f 7661 6c75 6573 2873 656c  e_dim_values(sel
+00017cb0: 662c 2073 7061 7273 655f 6365 6c6c 5f6f  f, sparse_cell_o
+00017cc0: 7264 6572 293a 0a20 2020 2020 2020 2075  rder):.        u
+00017cd0: 7269 203d 2073 656c 662e 7061 7468 2822  ri = self.path("
+00017ce0: 6765 745f 6e6f 6e5f 656d 7074 795f 636f  get_non_empty_co
+00017cf0: 6f72 6473 2229 0a20 2020 2020 2020 2064  ords").        d
+00017d00: 696d 3120 3d20 7469 6c65 6462 2e44 696d  im1 = tiledb.Dim
+00017d10: 286e 616d 653d 2264 696d 3122 2c20 646f  (name="dim1", do
+00017d20: 6d61 696e 3d28 4e6f 6e65 2c20 4e6f 6e65  main=(None, None
+00017d30: 292c 2074 696c 653d 4e6f 6e65 2c20 6474  ), tile=None, dt
+00017d40: 7970 653d 6e70 2e62 7974 6573 5f29 0a20  ype=np.bytes_). 
+00017d50: 2020 2020 2020 2064 696d 3220 3d20 7469         dim2 = ti
+00017d60: 6c65 6462 2e44 696d 286e 616d 653d 2264  ledb.Dim(name="d
+00017d70: 696d 3222 2c20 646f 6d61 696e 3d28 302c  im2", domain=(0,
+00017d80: 2031 292c 2074 696c 653d 312c 2064 7479   1), tile=1, dty
+00017d90: 7065 3d6e 702e 666c 6f61 7436 3429 0a20  pe=np.float64). 
+00017da0: 2020 2020 2020 2061 7474 7220 3d20 7469         attr = ti
+00017db0: 6c65 6462 2e41 7474 7228 6e61 6d65 3d22  ledb.Attr(name="
+00017dc0: 6174 7472 222c 2064 7479 7065 3d6e 702e  attr", dtype=np.
+00017dd0: 666c 6f61 7433 3229 0a20 2020 2020 2020  float32).       
+00017de0: 2064 6f6d 203d 2074 696c 6564 622e 446f   dom = tiledb.Do
+00017df0: 6d61 696e 2864 696d 312c 2064 696d 3229  main(dim1, dim2)
+00017e00: 0a20 2020 2020 2020 2073 6368 656d 6120  .        schema 
+00017e10: 3d20 7469 6c65 6462 2e41 7272 6179 5363  = tiledb.ArraySc
+00017e20: 6865 6d61 280a 2020 2020 2020 2020 2020  hema(.          
+00017e30: 2020 646f 6d61 696e 3d64 6f6d 2c20 7370    domain=dom, sp
+00017e40: 6172 7365 3d54 7275 652c 2063 656c 6c5f  arse=True, cell_
+00017e50: 6f72 6465 723d 7370 6172 7365 5f63 656c  order=sparse_cel
+00017e60: 6c5f 6f72 6465 722c 2061 7474 7273 3d5b  l_order, attrs=[
+00017e70: 6174 7472 5d0a 2020 2020 2020 2020 290a  attr].        ).
+00017e80: 2020 2020 2020 2020 7469 6c65 6462 2e41          tiledb.A
+00017e90: 7272 6179 2e63 7265 6174 6528 7572 692c  rray.create(uri,
+00017ea0: 2073 6368 656d 6129 0a0a 2020 2020 2020   schema)..      
+00017eb0: 2020 7769 7468 2074 696c 6564 622e 6f70    with tiledb.op
+00017ec0: 656e 2875 7269 2c20 2277 2229 2061 7320  en(uri, "w") as 
+00017ed0: 413a 0a20 2020 2020 2020 2020 2020 2041  A:.            A
+00017ee0: 5b22 6131 222c 2030 5d20 3d20 310a 2020  ["a1", 0] = 1.  
+00017ef0: 2020 2020 2020 2020 2020 415b 2261 3122            A["a1"
+00017f00: 2c20 302e 3235 5d20 3d20 320a 2020 2020  , 0.25] = 2.    
+00017f10: 2020 2020 2020 2020 415b 2261 3222 2c20          A["a2", 
+00017f20: 302e 355d 203d 2033 0a20 2020 2020 2020  0.5] = 3.       
+00017f30: 2020 2020 2041 5b22 6133 222c 2030 2e32       A["a3", 0.2
+00017f40: 355d 203d 2034 0a0a 2020 2020 2020 2020  5] = 4..        
+00017f50: 7769 7468 2074 696c 6564 622e 6f70 656e  with tiledb.open
+00017f60: 2875 7269 2c20 2272 2229 2061 7320 413a  (uri, "r") as A:
+00017f70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00017f80: 662e 6173 7365 7274 4571 7561 6c28 0a20  f.assertEqual(. 
+00017f90: 2020 2020 2020 2020 2020 2020 2020 2041                 A
+00017fa0: 2e75 6e69 7175 655f 6469 6d5f 7661 6c75  .unique_dim_valu
+00017fb0: 6573 2829 2c0a 2020 2020 2020 2020 2020  es(),.          
+00017fc0: 2020 2020 2020 4f72 6465 7265 6444 6963        OrderedDic
+00017fd0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00017fe0: 2020 2020 2020 205b 2822 6469 6d31 222c         [("dim1",
+00017ff0: 2028 6222 6131 222c 2062 2261 3222 2c20   (b"a1", b"a2", 
+00018000: 6222 6133 2229 292c 2028 2264 696d 3222  b"a3")), ("dim2"
+00018010: 2c20 2830 2e30 2c20 302e 3235 2c20 302e  , (0.0, 0.25, 0.
+00018020: 3529 295d 0a20 2020 2020 2020 2020 2020  5))].           
+00018030: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+00018040: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+00018050: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00018060: 7561 6c28 412e 756e 6971 7565 5f64 696d  ual(A.unique_dim
+00018070: 5f76 616c 7565 7328 2264 696d 3122 292c  _values("dim1"),
+00018080: 2028 6222 6131 222c 2062 2261 3222 2c20   (b"a1", b"a2", 
+00018090: 6222 6133 2229 290a 2020 2020 2020 2020  b"a3")).        
+000180a0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+000180b0: 7175 616c 2841 2e75 6e69 7175 655f 6469  qual(A.unique_di
+000180c0: 6d5f 7661 6c75 6573 2822 6469 6d32 2229  m_values("dim2")
+000180d0: 2c20 2830 2c20 302e 3235 2c20 302e 3529  , (0, 0.25, 0.5)
+000180e0: 290a 0a20 2020 2020 2020 2020 2020 2077  )..            w
+000180f0: 6974 6820 7365 6c66 2e61 7373 6572 7452  ith self.assertR
+00018100: 6169 7365 7328 5661 6c75 6545 7272 6f72  aises(ValueError
+00018110: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00018120: 2020 2041 2e75 6e69 7175 655f 6469 6d5f     A.unique_dim_
+00018130: 7661 6c75 6573 2830 290a 0a20 2020 2020  values(0)..     
+00018140: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+00018150: 2e61 7373 6572 7452 6169 7365 7328 5661  .assertRaises(Va
+00018160: 6c75 6545 7272 6f72 293a 0a20 2020 2020  lueError):.     
+00018170: 2020 2020 2020 2020 2020 2041 2e75 6e69             A.uni
+00018180: 7175 655f 6469 6d5f 7661 6c75 6573 2822  que_dim_values("
+00018190: 6469 6d33 2229 0a0a 0a63 6c61 7373 2054  dim3")...class T
+000181a0: 6573 7444 656e 7365 496e 6465 7869 6e67  estDenseIndexing
+000181b0: 2844 6973 6b54 6573 7443 6173 6529 3a0a  (DiskTestCase):.
+000181c0: 2020 2020 6465 6620 5f74 6573 745f 696e      def _test_in
+000181d0: 6465 7828 7365 6c66 2c20 412c 2054 2c20  dex(self, A, T, 
+000181e0: 6964 7829 3a0a 2020 2020 2020 2020 6578  idx):.        ex
+000181f0: 7065 6374 6564 203d 2041 5b69 6478 5d0a  pected = A[idx].
+00018200: 2020 2020 2020 2020 6163 7475 616c 203d          actual =
+00018210: 2054 5b69 6478 5d0a 2020 2020 2020 2020   T[idx].        
+00018220: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
+00018230: 616c 2865 7870 6563 7465 642c 2061 6374  al(expected, act
+00018240: 7561 6c29 0a0a 2020 2020 676f 6f64 5f69  ual)..    good_i
+00018250: 6e64 6578 5f31 6420 3d20 5b0a 2020 2020  ndex_1d = [.    
+00018260: 2020 2020 2320 7369 6e67 6c65 2076 616c      # single val
+00018270: 7565 0a20 2020 2020 2020 2034 322c 0a20  ue.        42,. 
+00018280: 2020 2020 2020 202d 312c 0a20 2020 2020         -1,.     
+00018290: 2020 2023 2073 6c69 6365 730a 2020 2020     # slices.    
+000182a0: 2020 2020 736c 6963 6528 302c 2031 3035      slice(0, 105
+000182b0: 3029 2c0a 2020 2020 2020 2020 736c 6963  0),.        slic
+000182c0: 6528 3530 2c20 3135 3029 2c0a 2020 2020  e(50, 150),.    
+000182d0: 2020 2020 736c 6963 6528 302c 2032 3030      slice(0, 200
+000182e0: 3029 2c0a 2020 2020 2020 2020 736c 6963  0),.        slic
+000182f0: 6528 2d31 3530 2c20 2d35 3029 2c0a 2020  e(-150, -50),.  
+00018300: 2020 2020 2020 2320 544f 444f 3a20 696e        # TODO: in
+00018310: 6465 7869 6e67 2066 6169 6c75 7265 730a  dexing failures.
+00018320: 2020 2020 2020 2020 2320 736c 6963 6528          # slice(
+00018330: 2d32 3030 302c 2032 3030 3029 2c0a 2020  -2000, 2000),.  
+00018340: 2020 2020 2020 2320 736c 6963 6528 302c        # slice(0,
+00018350: 2030 292c 2020 2320 656d 7074 7920 7265   0),  # empty re
+00018360: 7375 6c74 0a20 2020 2020 2020 2023 2073  sult.        # s
+00018370: 6c69 6365 282d 312c 2030 292c 2020 2320  lice(-1, 0),  # 
+00018380: 656d 7074 7920 7265 7375 6c74 0a20 2020  empty result.   
+00018390: 2020 2020 2023 2074 6f74 616c 2073 656c       # total sel
+000183a0: 6563 7469 6f6e 730a 2020 2020 2020 2020  ections.        
+000183b0: 736c 6963 6528 4e6f 6e65 292c 0a20 2020  slice(None),.   
+000183c0: 2020 2020 2045 6c6c 6970 7369 732c 0a20       Ellipsis,. 
+000183d0: 2020 2020 2020 2028 292c 0a20 2020 2020         (),.     
+000183e0: 2020 2028 456c 6c69 7073 6973 2c20 736c     (Ellipsis, sl
+000183f0: 6963 6528 4e6f 6e65 2929 2c0a 2020 2020  ice(None)),.    
+00018400: 2020 2020 2320 736c 6963 6520 7769 7468      # slice with
+00018410: 2073 7465 700a 2020 2020 2020 2020 736c   step.        sl
+00018420: 6963 6528 4e6f 6e65 292c 0a20 2020 2020  ice(None),.     
+00018430: 2020 2073 6c69 6365 284e 6f6e 652c 204e     slice(None, N
+00018440: 6f6e 6529 2c0a 2020 2020 2020 2020 736c  one),.        sl
+00018450: 6963 6528 4e6f 6e65 2c20 4e6f 6e65 2c20  ice(None, None, 
+00018460: 3129 2c0a 2020 2020 2020 2020 736c 6963  1),.        slic
+00018470: 6528 4e6f 6e65 2c20 4e6f 6e65 2c20 3130  e(None, None, 10
+00018480: 292c 0a20 2020 2020 2020 2073 6c69 6365  ),.        slice
+00018490: 284e 6f6e 652c 204e 6f6e 652c 2031 3030  (None, None, 100
+000184a0: 292c 0a20 2020 2020 2020 2073 6c69 6365  ),.        slice
+000184b0: 284e 6f6e 652c 204e 6f6e 652c 2031 3030  (None, None, 100
+000184c0: 3029 2c0a 2020 2020 2020 2020 736c 6963  0),.        slic
+000184d0: 6528 4e6f 6e65 2c20 4e6f 6e65 2c20 3130  e(None, None, 10
+000184e0: 3030 3029 2c0a 2020 2020 2020 2020 736c  000),.        sl
+000184f0: 6963 6528 302c 2031 3035 3029 2c0a 2020  ice(0, 1050),.  
+00018500: 2020 2020 2020 736c 6963 6528 302c 2031        slice(0, 1
+00018510: 3035 302c 2031 292c 0a20 2020 2020 2020  050, 1),.       
+00018520: 2073 6c69 6365 2830 2c20 3130 3530 2c20   slice(0, 1050, 
+00018530: 3130 292c 0a20 2020 2020 2020 2073 6c69  10),.        sli
+00018540: 6365 2830 2c20 3130 3530 2c20 3130 3029  ce(0, 1050, 100)
+00018550: 2c0a 2020 2020 2020 2020 736c 6963 6528  ,.        slice(
+00018560: 302c 2031 3035 302c 2031 3030 3029 2c0a  0, 1050, 1000),.
+00018570: 2020 2020 2020 2020 736c 6963 6528 302c          slice(0,
+00018580: 2031 3035 302c 2031 3030 3030 292c 0a20   1050, 10000),. 
+00018590: 2020 2020 2020 2073 6c69 6365 2831 2c20         slice(1, 
+000185a0: 3331 2c20 3329 2c0a 2020 2020 2020 2020  31, 3),.        
+000185b0: 736c 6963 6528 312c 2033 312c 2033 3029  slice(1, 31, 30)
+000185c0: 2c0a 2020 2020 2020 2020 736c 6963 6528  ,.        slice(
+000185d0: 312c 2033 312c 2033 3030 292c 0a20 2020  1, 31, 300),.   
+000185e0: 2020 2020 2073 6c69 6365 2838 312c 2031       slice(81, 1
+000185f0: 3231 2c20 3329 2c0a 2020 2020 2020 2020  21, 3),.        
+00018600: 736c 6963 6528 3831 2c20 3132 312c 2033  slice(81, 121, 3
+00018610: 3029 2c0a 2020 2020 2020 2020 736c 6963  0),.        slic
+00018620: 6528 3831 2c20 3132 312c 2033 3030 292c  e(81, 121, 300),
+00018630: 0a20 2020 2020 2020 2073 6c69 6365 2835  .        slice(5
+00018640: 302c 2031 3530 292c 0a20 2020 2020 2020  0, 150),.       
+00018650: 2073 6c69 6365 2835 302c 2031 3530 2c20   slice(50, 150, 
+00018660: 3129 2c0a 2020 2020 2020 2020 736c 6963  1),.        slic
+00018670: 6528 3530 2c20 3135 302c 2031 3029 2c0a  e(50, 150, 10),.
+00018680: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
+00018690: 6e65 6761 7469 7665 2073 7465 7073 0a20  negative steps. 
+000186a0: 2020 2020 2020 2073 6c69 6365 284e 6f6e         slice(Non
+000186b0: 652c 204e 6f6e 652c 202d 3129 2c0a 2020  e, None, -1),.  
+000186c0: 2020 2020 2020 736c 6963 6528 4e6f 6e65        slice(None
+000186d0: 2c20 4e6f 6e65 2c20 2d31 3029 2c0a 2020  , None, -10),.  
+000186e0: 2020 2020 2020 736c 6963 6528 4e6f 6e65        slice(None
+000186f0: 2c20 4e6f 6e65 2c20 2d31 3030 292c 0a20  , None, -100),. 
+00018700: 2020 2020 2020 2073 6c69 6365 284e 6f6e         slice(Non
+00018710: 652c 204e 6f6e 652c 202d 3130 3030 292c  e, None, -1000),
+00018720: 0a20 2020 2020 2020 2073 6c69 6365 284e  .        slice(N
+00018730: 6f6e 652c 204e 6f6e 652c 202d 3130 3030  one, None, -1000
+00018740: 3029 2c0a 2020 2020 2020 2020 2320 736c  0),.        # sl
+00018750: 6963 6528 3130 3530 2c20 2d31 2c20 2d31  ice(1050, -1, -1
+00018760: 292c 0a20 2020 2020 2020 2023 2073 6c69  ),.        # sli
+00018770: 6365 2831 3035 302c 202d 312c 202d 3130  ce(1050, -1, -10
+00018780: 292c 0a20 2020 2020 2020 2023 2073 6c69  ),.        # sli
+00018790: 6365 2831 3035 302c 202d 312c 202d 3130  ce(1050, -1, -10
+000187a0: 3029 2c0a 2020 2020 2020 2020 2320 736c  0),.        # sl
+000187b0: 6963 6528 3130 3530 2c20 2d31 2c20 2d31  ice(1050, -1, -1
+000187c0: 3030 3029 2c0a 2020 2020 2020 2020 2320  000),.        # 
+000187d0: 736c 6963 6528 3130 3530 2c20 2d31 2c20  slice(1050, -1, 
+000187e0: 2d31 3030 3030 292c 0a20 2020 2020 2020  -10000),.       
+000187f0: 2023 2073 6c69 6365 2831 3035 302c 2030   # slice(1050, 0
+00018800: 2c20 2d31 292c 0a20 2020 2020 2020 2023  , -1),.        #
+00018810: 2073 6c69 6365 2831 3035 302c 2030 2c20   slice(1050, 0, 
+00018820: 2d31 3029 2c0a 2020 2020 2020 2020 2320  -10),.        # 
+00018830: 736c 6963 6528 3130 3530 2c20 302c 202d  slice(1050, 0, -
+00018840: 3130 3029 2c0a 2020 2020 2020 2020 2320  100),.        # 
+00018850: 736c 6963 6528 3130 3530 2c20 302c 202d  slice(1050, 0, -
+00018860: 3130 3030 292c 0a20 2020 2020 2020 2023  1000),.        #
+00018870: 2073 6c69 6365 2831 3035 302c 2030 2c20   slice(1050, 0, 
+00018880: 2d31 3030 3030 292c 0a20 2020 2020 2020  -10000),.       
+00018890: 2023 2073 6c69 6365 2831 3530 2c20 3530   # slice(150, 50
+000188a0: 2c20 2d31 292c 0a20 2020 2020 2020 2023  , -1),.        #
+000188b0: 2073 6c69 6365 2831 3530 2c20 3530 2c20   slice(150, 50, 
+000188c0: 2d31 3029 2c0a 2020 2020 2020 2020 2320  -10),.        # 
+000188d0: 736c 6963 6528 3331 2c20 312c 202d 3329  slice(31, 1, -3)
+000188e0: 2c0a 2020 2020 2020 2020 2320 736c 6963  ,.        # slic
+000188f0: 6528 3132 312c 2038 312c 202d 3329 2c0a  e(121, 81, -3),.
+00018900: 2020 2020 2020 2020 2320 736c 6963 6528          # slice(
+00018910: 2d31 2c20 302c 202d 3129 2c0a 2020 2020  -1, 0, -1),.    
+00018920: 5d0a 0a20 2020 2062 6164 5f69 6e64 6578  ]..    bad_index
+00018930: 5f31 6420 3d20 5b32 2e33 2c20 2266 6f6f  _1d = [2.3, "foo
+00018940: 222c 2062 2278 7878 222c 204e 6f6e 652c  ", b"xxx", None,
+00018950: 2028 302c 2030 292c 2028 736c 6963 6528   (0, 0), (slice(
+00018960: 4e6f 6e65 292c 2073 6c69 6365 284e 6f6e  None), slice(Non
+00018970: 6529 295d 0a0a 2020 2020 6465 6620 7465  e))]..    def te
+00018980: 7374 5f69 6e64 6578 5f31 6428 7365 6c66  st_index_1d(self
+00018990: 293a 0a20 2020 2020 2020 2041 203d 206e  ):.        A = n
+000189a0: 702e 6172 616e 6765 2831 3035 302c 2064  p.arange(1050, d
+000189b0: 7479 7065 3d69 6e74 290a 0a20 2020 2020  type=int)..     
+000189c0: 2020 2064 6f6d 203d 2074 696c 6564 622e     dom = tiledb.
+000189d0: 446f 6d61 696e 2874 696c 6564 622e 4469  Domain(tiledb.Di
+000189e0: 6d28 646f 6d61 696e 3d28 302c 2031 3034  m(domain=(0, 104
+000189f0: 3929 2c20 7469 6c65 3d31 3030 2929 0a20  9), tile=100)). 
+00018a00: 2020 2020 2020 2061 7474 203d 2074 696c         att = til
+00018a10: 6564 622e 4174 7472 2864 7479 7065 3d69  edb.Attr(dtype=i
+00018a20: 6e74 290a 2020 2020 2020 2020 7363 6865  nt).        sche
+00018a30: 6d61 203d 2074 696c 6564 622e 4172 7261  ma = tiledb.Arra
+00018a40: 7953 6368 656d 6128 646f 6d61 696e 3d64  ySchema(domain=d
+00018a50: 6f6d 2c20 6174 7472 733d 2861 7474 2c29  om, attrs=(att,)
+00018a60: 290a 2020 2020 2020 2020 7469 6c65 6462  ).        tiledb
+00018a70: 2e44 656e 7365 4172 7261 792e 6372 6561  .DenseArray.crea
+00018a80: 7465 2873 656c 662e 7061 7468 2822 666f  te(self.path("fo
+00018a90: 6f22 292c 2073 6368 656d 6129 0a0a 2020  o"), schema)..  
+00018aa0: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+00018ab0: 622e 4465 6e73 6541 7272 6179 2873 656c  b.DenseArray(sel
+00018ac0: 662e 7061 7468 2822 666f 6f22 292c 206d  f.path("foo"), m
+00018ad0: 6f64 653d 2277 2229 2061 7320 543a 0a20  ode="w") as T:. 
+00018ae0: 2020 2020 2020 2020 2020 2054 5b3a 5d20             T[:] 
+00018af0: 3d20 410a 0a20 2020 2020 2020 2077 6974  = A..        wit
+00018b00: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
+00018b10: 7261 7928 7365 6c66 2e70 6174 6828 2266  ray(self.path("f
+00018b20: 6f6f 2229 2c20 6d6f 6465 3d22 7222 2920  oo"), mode="r") 
+00018b30: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
+00018b40: 2020 666f 7220 6964 7820 696e 2073 656c    for idx in sel
+00018b50: 662e 676f 6f64 5f69 6e64 6578 5f31 643a  f.good_index_1d:
+00018b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018b70: 2073 656c 662e 5f74 6573 745f 696e 6465   self._test_inde
+00018b80: 7828 412c 2054 2c20 6964 7829 0a0a 2020  x(A, T, idx)..  
+00018b90: 2020 2020 2020 2020 2020 666f 7220 6964            for id
+00018ba0: 7820 696e 2073 656c 662e 6261 645f 696e  x in self.bad_in
+00018bb0: 6465 785f 3164 3a0a 2020 2020 2020 2020  dex_1d:.        
+00018bc0: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+00018bd0: 662e 6173 7365 7274 5261 6973 6573 2849  f.assertRaises(I
+00018be0: 6e64 6578 4572 726f 7229 3a0a 2020 2020  ndexError):.    
+00018bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c00: 545b 6964 785d 0a0a 2020 2020 676f 6f64  T[idx]..    good
+00018c10: 5f69 6e64 6578 5f32 6420 3d20 5b0a 2020  _index_2d = [.  
+00018c20: 2020 2020 2020 2320 7369 6e67 6c65 2072        # single r
+00018c30: 6f77 0a20 2020 2020 2020 2034 322c 0a20  ow.        42,. 
+00018c40: 2020 2020 2020 202d 312c 0a20 2020 2020         -1,.     
+00018c50: 2020 2028 3432 2c20 736c 6963 6528 4e6f     (42, slice(No
+00018c60: 6e65 2929 2c0a 2020 2020 2020 2020 282d  ne)),.        (-
+00018c70: 312c 2073 6c69 6365 284e 6f6e 6529 292c  1, slice(None)),
+00018c80: 0a20 2020 2020 2020 2023 2073 696e 676c  .        # singl
+00018c90: 6520 636f 6c0a 2020 2020 2020 2020 2873  e col.        (s
+00018ca0: 6c69 6365 284e 6f6e 6529 2c20 3429 2c0a  lice(None), 4),.
+00018cb0: 2020 2020 2020 2020 2873 6c69 6365 284e          (slice(N
+00018cc0: 6f6e 6529 2c20 2d31 292c 0a20 2020 2020  one), -1),.     
+00018cd0: 2020 2023 2072 6f77 2073 6c69 6365 730a     # row slices.
+00018ce0: 2020 2020 2020 2020 736c 6963 6528 4e6f          slice(No
+00018cf0: 6e65 292c 0a20 2020 2020 2020 2073 6c69  ne),.        sli
+00018d00: 6365 2830 2c20 3130 3030 292c 0a20 2020  ce(0, 1000),.   
+00018d10: 2020 2020 2073 6c69 6365 2832 3530 2c20       slice(250, 
+00018d20: 3335 3029 2c0a 2020 2020 2020 2020 736c  350),.        sl
+00018d30: 6963 6528 302c 2032 3030 3029 2c0a 2020  ice(0, 2000),.  
+00018d40: 2020 2020 2020 736c 6963 6528 2d33 3530        slice(-350
+00018d50: 2c20 2d32 3530 292c 0a20 2020 2020 2020  , -250),.       
+00018d60: 2073 6c69 6365 2830 2c20 3029 2c20 2023   slice(0, 0),  #
+00018d70: 2065 6d70 7479 2072 6573 756c 740a 2020   empty result.  
+00018d80: 2020 2020 2020 736c 6963 6528 2d31 2c20        slice(-1, 
+00018d90: 3029 2c20 2023 2065 6d70 7479 2072 6573  0),  # empty res
+00018da0: 756c 740a 2020 2020 2020 2020 736c 6963  ult.        slic
+00018db0: 6528 2d32 3030 302c 2030 292c 0a20 2020  e(-2000, 0),.   
+00018dc0: 2020 2020 2073 6c69 6365 282d 3230 3030       slice(-2000
+00018dd0: 2c20 3230 3030 292c 0a20 2020 2020 2020  , 2000),.       
+00018de0: 2023 2032 4420 736c 6963 6573 0a20 2020   # 2D slices.   
+00018df0: 2020 2020 2028 736c 6963 6528 4e6f 6e65       (slice(None
+00018e00: 292c 2073 6c69 6365 2831 2c20 3529 292c  ), slice(1, 5)),
+00018e10: 0a20 2020 2020 2020 2028 736c 6963 6528  .        (slice(
+00018e20: 3235 302c 2033 3530 292c 2073 6c69 6365  250, 350), slice
+00018e30: 284e 6f6e 6529 292c 0a20 2020 2020 2020  (None)),.       
+00018e40: 2028 736c 6963 6528 3235 302c 2033 3530   (slice(250, 350
+00018e50: 292c 2073 6c69 6365 2831 2c20 3529 292c  ), slice(1, 5)),
+00018e60: 0a20 2020 2020 2020 2028 736c 6963 6528  .        (slice(
+00018e70: 3235 302c 2033 3530 292c 2073 6c69 6365  250, 350), slice
+00018e80: 282d 352c 202d 3129 292c 0a20 2020 2020  (-5, -1)),.     
+00018e90: 2020 2028 736c 6963 6528 3235 302c 2033     (slice(250, 3
+00018ea0: 3530 292c 2073 6c69 6365 282d 3530 2c20  50), slice(-50, 
+00018eb0: 3530 2929 2c0a 2020 2020 2020 2020 2873  50)),.        (s
+00018ec0: 6c69 6365 2832 3530 2c20 3335 302c 2031  lice(250, 350, 1
+00018ed0: 3029 2c20 736c 6963 6528 312c 2035 2929  0), slice(1, 5))
+00018ee0: 2c0a 2020 2020 2020 2020 2873 6c69 6365  ,.        (slice
+00018ef0: 2832 3530 2c20 3335 3029 2c20 736c 6963  (250, 350), slic
+00018f00: 6528 312c 2035 2c20 3229 292c 0a20 2020  e(1, 5, 2)),.   
+00018f10: 2020 2020 2028 736c 6963 6528 3235 302c       (slice(250,
+00018f20: 2033 3530 2c20 3333 292c 2073 6c69 6365   350, 33), slice
+00018f30: 2831 2c20 352c 2033 2929 2c0a 2020 2020  (1, 5, 3)),.    
+00018f40: 2020 2020 2320 746f 7461 6c20 7365 6c65      # total sele
+00018f50: 6374 696f 6e73 0a20 2020 2020 2020 2028  ctions.        (
+00018f60: 736c 6963 6528 4e6f 6e65 292c 2073 6c69  slice(None), sli
+00018f70: 6365 284e 6f6e 6529 292c 0a20 2020 2020  ce(None)),.     
+00018f80: 2020 2045 6c6c 6970 7369 732c 0a20 2020     Ellipsis,.   
+00018f90: 2020 2020 2028 292c 0a20 2020 2020 2020       (),.       
+00018fa0: 2028 456c 6c69 7073 6973 2c20 736c 6963   (Ellipsis, slic
+00018fb0: 6528 4e6f 6e65 2929 2c0a 2020 2020 2020  e(None)),.      
+00018fc0: 2020 2845 6c6c 6970 7369 732c 2073 6c69    (Ellipsis, sli
+00018fd0: 6365 284e 6f6e 6529 2c20 736c 6963 6528  ce(None), slice(
+00018fe0: 4e6f 6e65 2929 2c0a 2020 2020 2020 2020  None)),.        
+00018ff0: 2320 544f 444f 3a20 6e65 6761 7469 7665  # TODO: negative
+00019000: 2073 7465 7073 0a20 2020 2020 2020 2023   steps.        #
+00019010: 2073 6c69 6365 284e 6f6e 652c 204e 6f6e   slice(None, Non
+00019020: 652c 202d 3129 2c0a 2020 2020 2020 2020  e, -1),.        
+00019030: 2320 2873 6c69 6365 284e 6f6e 652c 204e  # (slice(None, N
+00019040: 6f6e 652c 202d 3129 2c20 736c 6963 6528  one, -1), slice(
+00019050: 4e6f 6e65 2929 2c0a 2020 2020 5d0a 0a20  None)),.    ].. 
+00019060: 2020 2062 6164 5f69 6e64 6578 5f32 6420     bad_index_2d 
+00019070: 3d20 5b0a 2020 2020 2020 2020 322e 332c  = [.        2.3,
+00019080: 0a20 2020 2020 2020 2022 666f 6f22 2c0a  .        "foo",.
+00019090: 2020 2020 2020 2020 6222 7878 7822 2c0a          b"xxx",.
+000190a0: 2020 2020 2020 2020 4e6f 6e65 2c0a 2020          None,.  
+000190b0: 2020 2020 2020 2832 2e33 2c20 736c 6963        (2.3, slic
+000190c0: 6528 4e6f 6e65 2929 2c0a 2020 2020 2020  e(None)),.      
+000190d0: 2020 2830 2c20 302c 2030 292c 0a20 2020    (0, 0, 0),.   
+000190e0: 2020 2020 2028 736c 6963 6528 4e6f 6e65       (slice(None
+000190f0: 292c 2073 6c69 6365 284e 6f6e 6529 2c20  ), slice(None), 
+00019100: 736c 6963 6528 4e6f 6e65 2929 2c0a 2020  slice(None)),.  
+00019110: 2020 5d0a 0a20 2020 2064 6566 2074 6573    ]..    def tes
+00019120: 745f 696e 6465 785f 3264 2873 656c 6629  t_index_2d(self)
+00019130: 3a0a 2020 2020 2020 2020 4120 3d20 6e70  :.        A = np
+00019140: 2e61 7261 6e67 6528 3130 3030 3029 2e72  .arange(10000).r
+00019150: 6573 6861 7065 2828 3130 3030 2c20 3130  eshape((1000, 10
+00019160: 2929 0a0a 2020 2020 2020 2020 646f 6d20  ))..        dom 
+00019170: 3d20 7469 6c65 6462 2e44 6f6d 6169 6e28  = tiledb.Domain(
+00019180: 0a20 2020 2020 2020 2020 2020 2074 696c  .            til
+00019190: 6564 622e 4469 6d28 646f 6d61 696e 3d28  edb.Dim(domain=(
+000191a0: 302c 2039 3939 292c 2074 696c 653d 3130  0, 999), tile=10
+000191b0: 3029 2c20 7469 6c65 6462 2e44 696d 2864  0), tiledb.Dim(d
+000191c0: 6f6d 6169 6e3d 2830 2c20 3929 2c20 7469  omain=(0, 9), ti
+000191d0: 6c65 3d32 290a 2020 2020 2020 2020 290a  le=2).        ).
+000191e0: 2020 2020 2020 2020 6174 7420 3d20 7469          att = ti
+000191f0: 6c65 6462 2e41 7474 7228 6474 7970 653d  ledb.Attr(dtype=
+00019200: 412e 6474 7970 6529 0a20 2020 2020 2020  A.dtype).       
+00019210: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
+00019220: 2e41 7272 6179 5363 6865 6d61 2864 6f6d  .ArraySchema(dom
+00019230: 2c20 2861 7474 2c29 290a 2020 2020 2020  , (att,)).      
+00019240: 2020 7469 6c65 6462 2e44 656e 7365 4172    tiledb.DenseAr
+00019250: 7261 792e 6372 6561 7465 2873 656c 662e  ray.create(self.
+00019260: 7061 7468 2822 666f 6f22 292c 2073 6368  path("foo"), sch
+00019270: 656d 6129 0a0a 2020 2020 2020 2020 7769  ema)..        wi
+00019280: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
+00019290: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
+000192a0: 666f 6f22 292c 206d 6f64 653d 2277 2229  foo"), mode="w")
+000192b0: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
+000192c0: 2020 2054 5b3a 5d20 3d20 410a 0a20 2020     T[:] = A..   
+000192d0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+000192e0: 2e44 656e 7365 4172 7261 7928 7365 6c66  .DenseArray(self
+000192f0: 2e70 6174 6828 2266 6f6f 2229 2c20 6d6f  .path("foo"), mo
+00019300: 6465 3d22 7222 2920 6173 2054 3a0a 2020  de="r") as T:.  
+00019310: 2020 2020 2020 2020 2020 666f 7220 6964            for id
+00019320: 7820 696e 2073 656c 662e 676f 6f64 5f69  x in self.good_i
+00019330: 6e64 6578 5f31 643a 0a20 2020 2020 2020  ndex_1d:.       
+00019340: 2020 2020 2020 2020 2073 656c 662e 5f74           self._t
+00019350: 6573 745f 696e 6465 7828 412c 2054 2c20  est_index(A, T, 
+00019360: 6964 7829 0a0a 2020 2020 2020 2020 2020  idx)..          
+00019370: 2020 666f 7220 6964 7820 696e 2073 656c    for idx in sel
+00019380: 662e 6261 645f 696e 6465 785f 3264 3a0a  f.bad_index_2d:.
+00019390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193a0: 7769 7468 2073 656c 662e 6173 7365 7274  with self.assert
+000193b0: 5261 6973 6573 2849 6e64 6578 4572 726f  Raises(IndexErro
+000193c0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+000193d0: 2020 2020 2020 2020 545b 6964 785d 0a0a          T[idx]..
+000193e0: 0a63 6c61 7373 2054 6573 7446 696c 7465  .class TestFilte
+000193f0: 7254 6573 7428 756e 6974 7465 7374 2e54  rTest(unittest.T
+00019400: 6573 7443 6173 6529 3a0a 2020 2020 6465  estCase):.    de
+00019410: 6620 7465 7374 5f66 696c 7465 7228 7365  f test_filter(se
+00019420: 6c66 293a 0a20 2020 2020 2020 2067 7a69  lf):.        gzi
+00019430: 705f 6669 6c74 6572 203d 2074 696c 6564  p_filter = tiled
+00019440: 622e 6c69 6274 696c 6564 622e 477a 6970  b.libtiledb.Gzip
+00019450: 4669 6c74 6572 286c 6576 656c 3d31 3029  Filter(level=10)
+00019460: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00019470: 7365 7274 4973 496e 7374 616e 6365 2867  sertIsInstance(g
+00019480: 7a69 705f 6669 6c74 6572 2c20 7469 6c65  zip_filter, tile
+00019490: 6462 2e6c 6962 7469 6c65 6462 2e46 696c  db.libtiledb.Fil
+000194a0: 7465 7229 0a20 2020 2020 2020 2073 656c  ter).        sel
+000194b0: 662e 6173 7365 7274 4571 7561 6c28 677a  f.assertEqual(gz
+000194c0: 6970 5f66 696c 7465 722e 6c65 7665 6c2c  ip_filter.level,
+000194d0: 2031 3029 0a0a 2020 2020 2020 2020 6277   10)..        bw
+000194e0: 5f66 696c 7465 7220 3d20 7469 6c65 6462  _filter = tiledb
+000194f0: 2e6c 6962 7469 6c65 6462 2e42 6974 5769  .libtiledb.BitWi
+00019500: 6474 6852 6564 7563 7469 6f6e 4669 6c74  dthReductionFilt
+00019510: 6572 2877 696e 646f 773d 3130 290a 2020  er(window=10).  
+00019520: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00019530: 7449 7349 6e73 7461 6e63 6528 6277 5f66  tIsInstance(bw_f
+00019540: 696c 7465 722c 2074 696c 6564 622e 6c69  ilter, tiledb.li
+00019550: 6274 696c 6564 622e 4669 6c74 6572 290a  btiledb.Filter).
+00019560: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00019570: 6572 7445 7175 616c 2862 775f 6669 6c74  ertEqual(bw_filt
+00019580: 6572 2e77 696e 646f 772c 2031 3029 0a0a  er.window, 10)..
+00019590: 2020 2020 2020 2020 6669 6c74 6572 5f6c          filter_l
+000195a0: 6973 7420 3d20 7469 6c65 6462 2e6c 6962  ist = tiledb.lib
+000195b0: 7469 6c65 6462 2e46 696c 7465 724c 6973  tiledb.FilterLis
+000195c0: 7428 0a20 2020 2020 2020 2020 2020 205b  t(.            [
+000195d0: 677a 6970 5f66 696c 7465 722c 2062 775f  gzip_filter, bw_
+000195e0: 6669 6c74 6572 5d2c 2063 6875 6e6b 7369  filter], chunksi
+000195f0: 7a65 3d31 3032 340a 2020 2020 2020 2020  ze=1024.        
+00019600: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00019610: 7373 6572 7445 7175 616c 2866 696c 7465  ssertEqual(filte
+00019620: 725f 6c69 7374 2e63 6875 6e6b 7369 7a65  r_list.chunksize
+00019630: 2c20 3130 3234 290a 2020 2020 2020 2020  , 1024).        
+00019640: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+00019650: 286c 656e 2866 696c 7465 725f 6c69 7374  (len(filter_list
+00019660: 292c 2032 290a 2020 2020 2020 2020 7365  ), 2).        se
+00019670: 6c66 2e61 7373 6572 7445 7175 616c 2866  lf.assertEqual(f
+00019680: 696c 7465 725f 6c69 7374 5b30 5d2e 6c65  ilter_list[0].le
+00019690: 7665 6c2c 2067 7a69 705f 6669 6c74 6572  vel, gzip_filter
+000196a0: 2e6c 6576 656c 290a 2020 2020 2020 2020  .level).        
+000196b0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+000196c0: 2866 696c 7465 725f 6c69 7374 5b31 5d2e  (filter_list[1].
+000196d0: 7769 6e64 6f77 2c20 6277 5f66 696c 7465  window, bw_filte
+000196e0: 722e 7769 6e64 6f77 290a 0a20 2020 2020  r.window)..     
+000196f0: 2020 2023 2074 6573 7420 6669 6c74 6572     # test filter
+00019700: 206c 6973 7420 6974 6572 6174 696f 6e0a   list iteration.
+00019710: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00019720: 6572 7445 7175 616c 286c 656e 286c 6973  ertEqual(len(lis
+00019730: 7428 6669 6c74 6572 5f6c 6973 7429 292c  t(filter_list)),
+00019740: 2032 290a 0a20 2020 2020 2020 2023 2074   2)..        # t
+00019750: 6573 7420 6066 696c 7465 7273 6020 6b77  est `filters` kw
+00019760: 6172 6720 6163 6365 7074 7320 7079 7468  arg accepts pyth
+00019770: 6f6e 206c 6973 7420 6f66 2066 696c 7465  on list of filte
+00019780: 7273 0a20 2020 2020 2020 2074 696c 6564  rs.        tiled
+00019790: 622e 4174 7472 2822 666f 6f22 2c20 6474  b.Attr("foo", dt
+000197a0: 7970 653d 6e70 2e69 6e74 3634 2c20 6669  ype=np.int64, fi
+000197b0: 6c74 6572 733d 5b67 7a69 705f 6669 6c74  lters=[gzip_filt
+000197c0: 6572 5d29 0a20 2020 2020 2020 2074 696c  er]).        til
+000197d0: 6564 622e 4174 7472 2822 666f 6f22 2c20  edb.Attr("foo", 
+000197e0: 6474 7970 653d 6e70 2e69 6e74 3634 2c20  dtype=np.int64, 
+000197f0: 6669 6c74 6572 733d 2867 7a69 705f 6669  filters=(gzip_fi
+00019800: 6c74 6572 2c29 290a 0a20 2020 2020 2020  lter,))..       
+00019810: 2061 7474 7220 3d20 7469 6c65 6462 2e41   attr = tiledb.A
+00019820: 7474 7228 2266 6f6f 222c 2064 7479 7065  ttr("foo", dtype
+00019830: 3d6e 702e 696e 7436 342c 2066 696c 7465  =np.int64, filte
+00019840: 7273 3d66 696c 7465 725f 6c69 7374 290a  rs=filter_list).
+00019850: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+00019860: 7365 7274 4571 7561 6c28 6c65 6e28 6174  sertEqual(len(at
+00019870: 7472 2e66 696c 7465 7273 292c 2032 290a  tr.filters), 2).
+00019880: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00019890: 6572 7445 7175 616c 2861 7474 722e 6669  ertEqual(attr.fi
+000198a0: 6c74 6572 732e 6368 756e 6b73 697a 652c  lters.chunksize,
+000198b0: 2066 696c 7465 725f 6c69 7374 2e63 6875   filter_list.chu
+000198c0: 6e6b 7369 7a65 290a 0a20 2020 2064 6566  nksize)..    def
+000198d0: 2074 6573 745f 6669 6c74 6572 5f6c 6973   test_filter_lis
+000198e0: 7428 7365 6c66 293a 0a20 2020 2020 2020  t(self):.       
+000198f0: 2023 2073 686f 756c 6420 6265 2063 6f6e   # should be con
+00019900: 7374 7275 6374 6962 6c65 2077 6974 686f  structible witho
+00019910: 7574 2061 2060 6669 6c74 6572 7360 206b  ut a `filters` k
+00019920: 6579 776f 7264 2061 7267 2073 6574 0a20  eyword arg set. 
+00019930: 2020 2020 2020 2066 696c 7465 725f 6c69         filter_li
+00019940: 7374 3120 3d20 7469 6c65 6462 2e46 696c  st1 = tiledb.Fil
+00019950: 7465 724c 6973 7428 290a 2020 2020 2020  terList().      
+00019960: 2020 6669 6c74 6572 5f6c 6973 7431 2e61    filter_list1.a
+00019970: 7070 656e 6428 7469 6c65 6462 2e47 7a69  ppend(tiledb.Gzi
+00019980: 7046 696c 7465 7228 2929 0a20 2020 2020  pFilter()).     
+00019990: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+000199a0: 7561 6c28 6c65 6e28 6669 6c74 6572 5f6c  ual(len(filter_l
+000199b0: 6973 7431 292c 2031 290a 0a20 2020 2020  ist1), 1)..     
+000199c0: 2020 2066 696c 7465 725f 6c69 7374 3220     filter_list2 
+000199d0: 3d20 5b78 2066 6f72 2078 2069 6e20 6669  = [x for x in fi
+000199e0: 6c74 6572 5f6c 6973 7431 5d0a 2020 2020  lter_list1].    
+000199f0: 2020 2020 6174 7472 203d 2074 696c 6564      attr = tiled
+00019a00: 622e 4174 7472 2866 696c 7465 7273 3d66  b.Attr(filters=f
+00019a10: 696c 7465 725f 6c69 7374 3229 0a20 2020  ilter_list2).   
+00019a20: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00019a30: 4571 7561 6c28 6c65 6e28 6174 7472 2e66  Equal(len(attr.f
+00019a40: 696c 7465 7273 292c 2031 290a 0a20 2020  ilters), 1)..   
+00019a50: 2064 6566 2074 6573 745f 616c 6c5f 6669   def test_all_fi
+00019a60: 6c74 6572 7328 7365 6c66 293a 0a20 2020  lters(self):.   
+00019a70: 2020 2020 2023 2074 6573 7420 696e 6974       # test init
+00019a80: 6961 6c69 7a61 7469 6f6e 0a20 2020 2020  ialization.     
+00019a90: 2020 2066 696c 7465 7273 203d 205b 0a20     filters = [. 
+00019aa0: 2020 2020 2020 2020 2020 2074 696c 6564             tiled
+00019ab0: 622e 4e6f 4f70 4669 6c74 6572 2829 2c0a  b.NoOpFilter(),.
+00019ac0: 2020 2020 2020 2020 2020 2020 7469 6c65              tile
+00019ad0: 6462 2e47 7a69 7046 696c 7465 7228 292c  db.GzipFilter(),
+00019ae0: 0a20 2020 2020 2020 2020 2020 2074 696c  .            til
+00019af0: 6564 622e 5a73 7464 4669 6c74 6572 2829  edb.ZstdFilter()
+00019b00: 2c0a 2020 2020 2020 2020 2020 2020 7469  ,.            ti
+00019b10: 6c65 6462 2e4c 5a34 4669 6c74 6572 2829  ledb.LZ4Filter()
+00019b20: 2c0a 2020 2020 2020 2020 2020 2020 7469  ,.            ti
+00019b30: 6c65 6462 2e52 6c65 4669 6c74 6572 2829  ledb.RleFilter()
+00019b40: 2c0a 2020 2020 2020 2020 2020 2020 7469  ,.            ti
+00019b50: 6c65 6462 2e42 7a69 7032 4669 6c74 6572  ledb.Bzip2Filter
+00019b60: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
+00019b70: 7469 6c65 6462 2e44 6f75 626c 6544 656c  tiledb.DoubleDel
+00019b80: 7461 4669 6c74 6572 2829 2c0a 2020 2020  taFilter(),.    
+00019b90: 2020 2020 2020 2020 7469 6c65 6462 2e42          tiledb.B
+00019ba0: 6974 5769 6474 6852 6564 7563 7469 6f6e  itWidthReduction
+00019bb0: 4669 6c74 6572 2829 2c0a 2020 2020 2020  Filter(),.      
+00019bc0: 2020 2020 2020 7469 6c65 6462 2e42 6974        tiledb.Bit
+00019bd0: 5368 7566 666c 6546 696c 7465 7228 292c  ShuffleFilter(),
+00019be0: 0a20 2020 2020 2020 2020 2020 2074 696c  .            til
+00019bf0: 6564 622e 4279 7465 5368 7566 666c 6546  edb.ByteShuffleF
+00019c00: 696c 7465 7228 292c 0a20 2020 2020 2020  ilter(),.       
+00019c10: 2020 2020 2074 696c 6564 622e 506f 7369       tiledb.Posi
+00019c20: 7469 7665 4465 6c74 6146 696c 7465 7228  tiveDeltaFilter(
+00019c30: 292c 0a20 2020 2020 2020 2020 2020 2074  ),.            t
+00019c40: 696c 6564 622e 4368 6563 6b73 756d 5348  iledb.ChecksumSH
+00019c50: 4132 3536 4669 6c74 6572 2829 2c0a 2020  A256Filter(),.  
+00019c60: 2020 2020 2020 2020 2020 7469 6c65 6462            tiledb
+00019c70: 2e43 6865 636b 7375 6d4d 4435 4669 6c74  .ChecksumMD5Filt
+00019c80: 6572 2829 2c0a 2020 2020 2020 2020 5d0a  er(),.        ].
+00019c90: 2020 2020 2020 2020 2320 6d61 6b65 2073          # make s
+00019ca0: 7572 6520 7468 6174 2072 6570 7220 776f  ure that repr wo
+00019cb0: 726b 7320 616e 6420 726f 756e 642d 7472  rks and round-tr
+00019cc0: 6970 7320 636f 7272 6563 746c 790a 2020  ips correctly.  
+00019cd0: 2020 2020 2020 666f 7220 6620 696e 2066        for f in f
+00019ce0: 696c 7465 7273 3a0a 2020 2020 2020 2020  ilters:.        
+00019cf0: 2020 2020 2320 736f 6d65 206f 6620 7468      # some of th
+00019d00: 6573 6520 6861 7665 2061 7474 7269 6275  ese have attribu
+00019d10: 7465 732c 2073 6f20 7765 206a 7573 7420  tes, so we just 
+00019d20: 6368 6563 6b20 7468 6520 636c 6173 7320  check the class 
+00019d30: 6e61 6d65 2068 6572 650a 2020 2020 2020  name here.      
+00019d40: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00019d50: 7454 7275 6528 7479 7065 2866 292e 5f5f  tTrue(type(f).__
+00019d60: 6e61 6d65 5f5f 2069 6e20 7265 7072 2866  name__ in repr(f
+00019d70: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
+00019d80: 746d 705f 676c 6f62 616c 7320 3d20 6469  tmp_globals = di
+00019d90: 6374 2829 0a20 2020 2020 2020 2020 2020  ct().           
+00019da0: 2073 6574 7570 203d 2022 6672 6f6d 2074   setup = "from t
+00019db0: 696c 6564 6220 696d 706f 7274 202a 220a  iledb import *".
+00019dc0: 2020 2020 2020 2020 2020 2020 6578 6563              exec
+00019dd0: 2873 6574 7570 2c20 746d 705f 676c 6f62  (setup, tmp_glob
+00019de0: 616c 7329 0a0a 2020 2020 2020 2020 2020  als)..          
+00019df0: 2020 6669 6c74 6572 5f72 6570 7220 3d20    filter_repr = 
+00019e00: 7265 7072 2866 290a 2020 2020 2020 2020  repr(f).        
+00019e10: 2020 2020 6e65 775f 6669 6c74 6572 203d      new_filter =
+00019e20: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00019e30: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00019e40: 2020 2020 2020 206e 6577 5f66 696c 7465         new_filte
+00019e50: 7220 3d20 6576 616c 2866 696c 7465 725f  r = eval(filter_
+00019e60: 7265 7072 2c20 746d 705f 676c 6f62 616c  repr, tmp_global
+00019e70: 7329 0a20 2020 2020 2020 2020 2020 2065  s).            e
+00019e80: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00019e90: 6173 2065 7863 3a0a 2020 2020 2020 2020  as exc:.        
+00019ea0: 2020 2020 2020 2020 7761 726e 5f73 7472          warn_str
+00019eb0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00019ec0: 2020 2020 2020 2020 2022 2222 4578 6365           """Exce
+00019ed0: 7074 696f 6e20 6475 7269 6e67 2046 696c  ption during Fil
+00019ee0: 7465 7254 6573 7420 6669 6c74 6572 2072  terTest filter r
+00019ef0: 6570 7220 6576 616c 2222 220a 2020 2020  epr eval""".    
+00019f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f10: 2b20 2222 222c 2066 696c 7465 7220 7265  + """, filter re
+00019f20: 7072 2073 7472 696e 6720 7761 733a 5c6e  pr string was:\n
+00019f30: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+00019f40: 2020 2020 2020 2020 2b20 2222 2227 2727          + """'''
+00019f50: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+00019f60: 2020 2020 2020 2020 2b20 2222 225c 6e7b          + """\n{
+00019f70: 7d5c 6e27 2727 2222 222e 666f 726d 6174  }\n'''""".format
+00019f80: 2866 696c 7465 725f 7265 7072 290a 2020  (filter_repr).  
+00019f90: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00019fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fb0: 7761 726e 696e 6773 2e77 6172 6e28 7761  warnings.warn(wa
+00019fc0: 726e 5f73 7472 290a 2020 2020 2020 2020  rn_str).        
+00019fd0: 2020 2020 2020 2020 7261 6973 650a 0a20          raise.. 
+00019fe0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00019ff0: 6173 7365 7274 4571 7561 6c28 6e65 775f  assertEqual(new_
+0001a000: 6669 6c74 6572 2c20 6629 0a0a 0a63 6c61  filter, f)...cla
+0001a010: 7373 2054 6573 7444 6174 6574 696d 6553  ss TestDatetimeS
+0001a020: 6c69 6369 6e67 2844 6973 6b54 6573 7443  licing(DiskTestC
+0001a030: 6173 6529 3a0a 2020 2020 6465 6620 7465  ase):.    def te
+0001a040: 7374 5f64 656e 7365 5f64 6174 6574 696d  st_dense_datetim
+0001a050: 655f 7665 6374 6f72 2873 656c 6629 3a0a  e_vector(self):.
+0001a060: 2020 2020 2020 2020 7572 6920 3d20 7365          uri = se
+0001a070: 6c66 2e70 6174 6828 2266 6f6f 5f64 6174  lf.path("foo_dat
+0001a080: 6574 696d 655f 7665 6374 6f72 2229 0a0a  etime_vector")..
+0001a090: 2020 2020 2020 2020 2320 446f 6d61 696e          # Domain
+0001a0a0: 2069 7320 3130 2079 6561 7273 2c20 6461   is 10 years, da
+0001a0b0: 7920 7265 736f 6c75 7469 6f6e 2c20 6f6e  y resolution, on
+0001a0c0: 6520 7469 6c65 2070 6572 2033 3635 2064  e tile per 365 d
+0001a0d0: 6179 730a 2020 2020 2020 2020 6469 6d20  ays.        dim 
+0001a0e0: 3d20 7469 6c65 6462 2e44 696d 280a 2020  = tiledb.Dim(.  
+0001a0f0: 2020 2020 2020 2020 2020 6e61 6d65 3d22            name="
+0001a100: 6431 222c 0a20 2020 2020 2020 2020 2020  d1",.           
+0001a110: 2064 6f6d 6169 6e3d 286e 702e 6461 7465   domain=(np.date
+0001a120: 7469 6d65 3634 2822 3230 3130 2d30 312d  time64("2010-01-
+0001a130: 3031 2229 2c20 6e70 2e64 6174 6574 696d  01"), np.datetim
+0001a140: 6536 3428 2232 3032 302d 3031 2d30 3122  e64("2020-01-01"
+0001a150: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+0001a160: 7469 6c65 3d6e 702e 7469 6d65 6465 6c74  tile=np.timedelt
+0001a170: 6136 3428 3336 352c 2022 4422 292c 0a20  a64(365, "D"),. 
+0001a180: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
+0001a190: 3d6e 702e 6461 7465 7469 6d65 3634 2822  =np.datetime64("
+0001a1a0: 222c 2022 4422 292e 6474 7970 652c 0a20  ", "D").dtype,. 
+0001a1b0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001a1c0: 2064 6f6d 203d 2074 696c 6564 622e 446f   dom = tiledb.Do
+0001a1d0: 6d61 696e 2864 696d 290a 2020 2020 2020  main(dim).      
+0001a1e0: 2020 7363 6865 6d61 203d 2074 696c 6564    schema = tiled
+0001a1f0: 622e 4172 7261 7953 6368 656d 6128 0a20  b.ArraySchema(. 
+0001a200: 2020 2020 2020 2020 2020 2064 6f6d 6169             domai
+0001a210: 6e3d 646f 6d2c 2061 7474 7273 3d28 7469  n=dom, attrs=(ti
+0001a220: 6c65 6462 2e41 7474 7228 2261 3122 2c20  ledb.Attr("a1", 
+0001a230: 6474 7970 653d 6e70 2e66 6c6f 6174 3634  dtype=np.float64
+0001a240: 292c 290a 2020 2020 2020 2020 290a 2020  ),).        ).  
+0001a250: 2020 2020 2020 7469 6c65 6462 2e41 7272        tiledb.Arr
+0001a260: 6179 2e63 7265 6174 6528 7572 692c 2073  ay.create(uri, s
+0001a270: 6368 656d 6129 0a0a 2020 2020 2020 2020  chema)..        
+0001a280: 2320 5772 6974 6520 6120 6665 7720 7965  # Write a few ye
+0001a290: 6172 7320 6f66 2064 6174 6120 6174 2074  ars of data at t
+0001a2a0: 6865 2062 6567 696e 6e69 6e67 2075 7369  he beginning usi
+0001a2b0: 6e67 2061 2074 696d 6564 656c 7461 206f  ng a timedelta o
+0001a2c0: 626a 6563 740a 2020 2020 2020 2020 6e64  bject.        nd
+0001a2d0: 6179 7320 3d20 3336 3520 2a20 320a 2020  ays = 365 * 2.  
+0001a2e0: 2020 2020 2020 6131 5f76 616c 7320 3d20        a1_vals = 
+0001a2f0: 6e70 2e72 616e 646f 6d2e 7261 6e64 286e  np.random.rand(n
+0001a300: 6461 7973 290a 2020 2020 2020 2020 7374  days).        st
+0001a310: 6172 7420 3d20 6e70 2e64 6174 6574 696d  art = np.datetim
+0001a320: 6536 3428 2232 3031 302d 3031 2d30 3122  e64("2010-01-01"
+0001a330: 290a 2020 2020 2020 2020 2320 4461 7465  ).        # Date
+0001a340: 7469 6d65 2069 6e64 6578 696e 6720 6973  time indexing is
+0001a350: 2069 6e63 6c75 7369 7665 2c20 736f 2061   inclusive, so a
+0001a360: 2064 656c 7461 206f 6620 6f6e 6520 6c65   delta of one le
+0001a370: 7373 0a20 2020 2020 2020 2065 6e64 203d  ss.        end =
+0001a380: 2073 7461 7274 202b 206e 702e 7469 6d65   start + np.time
+0001a390: 6465 6c74 6136 3428 6e64 6179 7320 2d20  delta64(ndays - 
+0001a3a0: 312c 2022 4422 290a 2020 2020 2020 2020  1, "D").        
+0001a3b0: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
+0001a3c0: 6541 7272 6179 2875 7269 2c20 2277 2229  eArray(uri, "w")
+0001a3d0: 2061 7320 543a 0a20 2020 2020 2020 2020   as T:.         
+0001a3e0: 2020 2054 5b73 7461 7274 3a65 6e64 5d20     T[start:end] 
+0001a3f0: 3d20 7b22 6131 223a 2061 315f 7661 6c73  = {"a1": a1_vals
+0001a400: 7d0a 0a20 2020 2020 2020 2023 2052 6561  }..        # Rea
+0001a410: 6420 6261 636b 2064 6174 610a 2020 2020  d back data.    
+0001a420: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+0001a430: 4465 6e73 6541 7272 6179 2875 7269 2c20  DenseArray(uri, 
+0001a440: 2272 222c 2061 7474 723d 2261 3122 2920  "r", attr="a1") 
+0001a450: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
+0001a460: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
+0001a470: 7175 616c 2854 5b73 7461 7274 3a65 6e64  qual(T[start:end
+0001a480: 5d2c 2061 315f 7661 6c73 290a 0a20 2020  ], a1_vals)..   
+0001a490: 2020 2020 2023 2043 6865 636b 206e 6f6e       # Check non
+0001a4a0: 656d 7074 7920 646f 6d61 696e 0a20 2020  empty domain.   
+0001a4b0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+0001a4c0: 2e44 656e 7365 4172 7261 7928 7572 692c  .DenseArray(uri,
+0001a4d0: 2022 7222 2920 6173 2054 3a0a 2020 2020   "r") as T:.    
+0001a4e0: 2020 2020 2020 2020 6e6f 6e65 6d70 7479          nonempty
+0001a4f0: 203d 2054 2e6e 6f6e 656d 7074 795f 646f   = T.nonempty_do
+0001a500: 6d61 696e 2829 0a20 2020 2020 2020 2020  main().         
+0001a510: 2020 2064 315f 6e6f 6e65 6d70 7479 203d     d1_nonempty =
+0001a520: 206e 6f6e 656d 7074 795b 305d 0a20 2020   nonempty[0].   
+0001a530: 2020 2020 2020 2020 2073 656c 662e 6173           self.as
+0001a540: 7365 7274 4571 7561 6c28 6431 5f6e 6f6e  sertEqual(d1_non
+0001a550: 656d 7074 795b 305d 2e64 7479 7065 2c20  empty[0].dtype, 
+0001a560: 6e70 2e64 6174 6574 696d 6536 3428 2222  np.datetime64(""
+0001a570: 2c20 2244 2229 290a 2020 2020 2020 2020  , "D")).        
+0001a580: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001a590: 7175 616c 2864 315f 6e6f 6e65 6d70 7479  qual(d1_nonempty
+0001a5a0: 5b31 5d2e 6474 7970 652c 206e 702e 6461  [1].dtype, np.da
+0001a5b0: 7465 7469 6d65 3634 2822 222c 2022 4422  tetime64("", "D"
+0001a5c0: 2929 0a20 2020 2020 2020 2020 2020 2073  )).            s
+0001a5d0: 656c 662e 6173 7365 7274 5475 706c 6545  elf.assertTupleE
+0001a5e0: 7175 616c 2864 315f 6e6f 6e65 6d70 7479  qual(d1_nonempty
+0001a5f0: 2c20 2873 7461 7274 2c20 656e 6429 290a  , (start, end)).
+0001a600: 0a20 2020 2020 2020 2023 2053 6c69 6365  .        # Slice
+0001a610: 2061 2066 6577 2064 6179 7320 6672 6f6d   a few days from
+0001a620: 2074 6865 206d 6964 646c 6520 7573 696e   the middle usin
+0001a630: 6720 7477 6f20 6461 7465 7469 6d65 730a  g two datetimes.
+0001a640: 2020 2020 2020 2020 7769 7468 2074 696c          with til
+0001a650: 6564 622e 4465 6e73 6541 7272 6179 2875  edb.DenseArray(u
+0001a660: 7269 2c20 2272 222c 2061 7474 723d 2261  ri, "r", attr="a
+0001a670: 3122 2920 6173 2054 3a0a 2020 2020 2020  1") as T:.      
+0001a680: 2020 2020 2020 2320 536c 6963 6520 7573        # Slice us
+0001a690: 696e 6720 6461 7465 7469 6d65 730a 2020  ing datetimes.  
+0001a6a0: 2020 2020 2020 2020 2020 6163 7475 616c            actual
+0001a6b0: 203d 2054 5b6e 702e 6461 7465 7469 6d65   = T[np.datetime
+0001a6c0: 3634 2822 3230 3130 2d31 312d 3031 2229  64("2010-11-01")
+0001a6d0: 203a 206e 702e 6461 7465 7469 6d65 3634   : np.datetime64
+0001a6e0: 2822 3230 3131 2d30 312d 3331 2229 5d0a  ("2011-01-31")].
+0001a6f0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+0001a700: 6f6e 7665 7274 2064 6174 6574 696d 6520  onvert datetime 
+0001a710: 696e 7465 7276 616c 2074 6f20 696e 7465  interval to inte
+0001a720: 6765 7220 6f66 6673 6574 2f6c 656e 6774  ger offset/lengt
+0001a730: 6820 696e 746f 206f 7269 6769 6e61 6c20  h into original 
+0001a740: 6172 7261 790a 2020 2020 2020 2020 2020  array.          
+0001a750: 2020 2320 6d75 7374 2062 6520 6361 7374    # must be cast
+0001a760: 2074 6f20 696e 7420 6265 6361 7573 6520   to int because 
+0001a770: 666c 6f61 7420 736c 6963 6573 2061 7265  float slices are
+0001a780: 206e 6f74 2061 6c6c 6f77 6564 2069 6e20   not allowed in 
+0001a790: 4e75 6d50 7920 312e 3132 2b0a 2020 2020  NumPy 1.12+.    
+0001a7a0: 2020 2020 2020 2020 7265 6164 5f6f 6666          read_off
+0001a7b0: 7365 7420 3d20 696e 7428 0a20 2020 2020  set = int(.     
+0001a7c0: 2020 2020 2020 2020 2020 2028 6e70 2e64             (np.d
+0001a7d0: 6174 6574 696d 6536 3428 2232 3031 302d  atetime64("2010-
+0001a7e0: 3131 2d30 3122 2920 2d20 7374 6172 7429  11-01") - start)
+0001a7f0: 202f 206e 702e 7469 6d65 6465 6c74 6136   / np.timedelta6
+0001a800: 3428 312c 2022 4422 290a 2020 2020 2020  4(1, "D").      
+0001a810: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001a820: 2020 2020 7265 6164 5f6e 6461 7973 203d      read_ndays =
+0001a830: 2069 6e74 280a 2020 2020 2020 2020 2020   int(.          
+0001a840: 2020 2020 2020 286e 702e 6461 7465 7469        (np.dateti
+0001a850: 6d65 3634 2822 3230 3131 2d30 312d 3331  me64("2011-01-31
+0001a860: 2229 202d 206e 702e 6461 7465 7469 6d65  ") - np.datetime
+0001a870: 3634 2822 3230 3130 2d31 312d 3031 2229  64("2010-11-01")
+0001a880: 202b 2031 290a 2020 2020 2020 2020 2020   + 1).          
+0001a890: 2020 2020 2020 2f20 6e70 2e74 696d 6564        / np.timed
+0001a8a0: 656c 7461 3634 2831 2c20 2244 2229 0a20  elta64(1, "D"). 
+0001a8b0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001a8c0: 2020 2020 2020 2020 2065 7870 6563 7465           expecte
+0001a8d0: 6420 3d20 6131 5f76 616c 735b 7265 6164  d = a1_vals[read
+0001a8e0: 5f6f 6666 7365 7420 3a20 7265 6164 5f6f  _offset : read_o
+0001a8f0: 6666 7365 7420 2b20 7265 6164 5f6e 6461  ffset + read_nda
+0001a900: 7973 5d0a 2020 2020 2020 2020 2020 2020  ys].            
+0001a910: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
+0001a920: 616c 2861 6374 7561 6c2c 2065 7870 6563  al(actual, expec
+0001a930: 7465 6429 0a0a 2020 2020 2020 2020 2320  ted)..        # 
+0001a940: 536c 6963 6520 7468 6520 6669 7273 7420  Slice the first 
+0001a950: 7965 6172 0a20 2020 2020 2020 2077 6974  year.        wit
+0001a960: 6820 7469 6c65 6462 2e44 656e 7365 4172  h tiledb.DenseAr
+0001a970: 7261 7928 7572 692c 2022 7222 2c20 6174  ray(uri, "r", at
+0001a980: 7472 3d22 6131 2229 2061 7320 543a 0a20  tr="a1") as T:. 
+0001a990: 2020 2020 2020 2020 2020 2061 6374 7561             actua
+0001a9a0: 6c20 3d20 545b 6e70 2e64 6174 6574 696d  l = T[np.datetim
+0001a9b0: 6536 3428 2232 3031 3022 2920 3a20 6e70  e64("2010") : np
+0001a9c0: 2e64 6174 6574 696d 6536 3428 2232 3031  .datetime64("201
+0001a9d0: 3122 295d 0a0a 2020 2020 2020 2020 2020  1")]..          
+0001a9e0: 2020 2320 436f 6e76 6572 7420 6461 7465    # Convert date
+0001a9f0: 7469 6d65 2069 6e74 6572 7661 6c20 746f  time interval to
+0001aa00: 2069 6e74 6567 6572 206f 6666 7365 742f   integer offset/
+0001aa10: 6c65 6e67 7468 2069 6e74 6f20 6f72 6967  length into orig
+0001aa20: 696e 616c 2061 7272 6179 0a20 2020 2020  inal array.     
+0001aa30: 2020 2020 2020 2072 6561 645f 6f66 6673         read_offs
+0001aa40: 6574 203d 2069 6e74 280a 2020 2020 2020  et = int(.      
+0001aa50: 2020 2020 2020 2020 2020 286e 702e 6461            (np.da
+0001aa60: 7465 7469 6d65 3634 2822 3230 3130 2d30  tetime64("2010-0
+0001aa70: 312d 3031 2229 202d 2073 7461 7274 2920  1-01") - start) 
+0001aa80: 2f20 6e70 2e74 696d 6564 656c 7461 3634  / np.timedelta64
+0001aa90: 2831 2c20 2244 2229 0a20 2020 2020 2020  (1, "D").       
+0001aaa0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0001aab0: 2020 2072 6561 645f 6e64 6179 7320 3d20     read_ndays = 
+0001aac0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+0001aad0: 2020 2020 2028 6e70 2e64 6174 6574 696d       (np.datetim
+0001aae0: 6536 3428 2232 3031 312d 3031 2d30 3122  e64("2011-01-01"
+0001aaf0: 2920 2d20 6e70 2e64 6174 6574 696d 6536  ) - np.datetime6
+0001ab00: 3428 2232 3031 302d 3031 2d30 3122 2920  4("2010-01-01") 
+0001ab10: 2b20 3129 0a20 2020 2020 2020 2020 2020  + 1).           
+0001ab20: 2020 2020 202f 206e 702e 7469 6d65 6465       / np.timede
+0001ab30: 6c74 6136 3428 312c 2022 4422 290a 2020  lta64(1, "D").  
+0001ab40: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0001ab50: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+0001ab60: 203d 2061 315f 7661 6c73 5b72 6561 645f   = a1_vals[read_
+0001ab70: 6f66 6673 6574 203a 2072 6561 645f 6f66  offset : read_of
+0001ab80: 6673 6574 202b 2072 6561 645f 6e64 6179  fset + read_nday
+0001ab90: 735d 0a20 2020 2020 2020 2020 2020 2061  s].            a
+0001aba0: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+0001abb0: 6c28 6163 7475 616c 2c20 6578 7065 6374  l(actual, expect
+0001abc0: 6564 290a 0a20 2020 2020 2020 2023 2053  ed)..        # S
+0001abd0: 6c69 6365 206f 7065 6e20 7370 616e 730a  lice open spans.
+0001abe0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
+0001abf0: 6564 622e 4465 6e73 6541 7272 6179 2875  edb.DenseArray(u
+0001ac00: 7269 2c20 2272 222c 2061 7474 723d 2261  ri, "r", attr="a
+0001ac10: 3122 2920 6173 2054 3a0a 0a20 2020 2020  1") as T:..     
+0001ac20: 2020 2020 2020 2023 2043 6f6e 7665 7274         # Convert
+0001ac30: 2064 6174 6574 696d 6520 696e 7465 7276   datetime interv
+0001ac40: 616c 2074 6f20 696e 7465 6765 7220 6f66  al to integer of
+0001ac50: 6673 6574 2f6c 656e 6774 6820 696e 746f  fset/length into
+0001ac60: 206f 7269 6769 6e61 6c20 6172 7261 790a   original array.
+0001ac70: 2020 2020 2020 2020 2020 2020 7265 6164              read
+0001ac80: 5f6f 6666 7365 7420 3d20 696e 7428 0a20  _offset = int(. 
+0001ac90: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0001aca0: 6e70 2e64 6174 6574 696d 6536 3428 2232  np.datetime64("2
+0001acb0: 3031 302d 3031 2d30 3122 2920 2d20 7374  010-01-01") - st
+0001acc0: 6172 7429 202f 206e 702e 7469 6d65 6465  art) / np.timede
+0001acd0: 6c74 6136 3428 312c 2022 4422 290a 2020  lta64(1, "D").  
+0001ace0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0001acf0: 2020 2020 2020 2020 7265 6164 5f6e 6461          read_nda
+0001ad00: 7973 203d 2069 6e74 280a 2020 2020 2020  ys = int(.      
+0001ad10: 2020 2020 2020 2020 2020 286e 702e 6461            (np.da
+0001ad20: 7465 7469 6d65 3634 2822 3230 3131 2d30  tetime64("2011-0
+0001ad30: 312d 3331 2229 202d 206e 702e 6461 7465  1-31") - np.date
+0001ad40: 7469 6d65 3634 2822 3230 3130 2d30 312d  time64("2010-01-
+0001ad50: 3031 2229 202b 2031 290a 2020 2020 2020  01") + 1).      
+0001ad60: 2020 2020 2020 2020 2020 2f20 6e70 2e74            / np.t
+0001ad70: 696d 6564 656c 7461 3634 2831 2c20 2244  imedelta64(1, "D
+0001ad80: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
+0001ad90: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
+0001ada0: 6563 7465 6420 3d20 6131 5f76 616c 735b  ected = a1_vals[
+0001adb0: 7265 6164 5f6f 6666 7365 7420 3a20 7265  read_offset : re
+0001adc0: 6164 5f6f 6666 7365 7420 2b20 7265 6164  ad_offset + read
+0001add0: 5f6e 6461 7973 5d0a 0a20 2020 2020 2020  _ndays]..       
+0001ade0: 2020 2020 2023 206e 6f74 6520 7765 206f       # note we o
+0001adf0: 6e6c 7920 7772 6f74 6520 6669 7273 7420  nly wrote first 
+0001ae00: 7477 6f20 7965 6172 730a 2020 2020 2020  two years.      
+0001ae10: 2020 2020 2020 6163 7475 616c 203d 2054        actual = T
+0001ae20: 2e6d 756c 7469 5f69 6e64 6578 5b6e 702e  .multi_index[np.
+0001ae30: 6461 7465 7469 6d65 3634 2822 3230 3130  datetime64("2010
+0001ae40: 2d30 312d 3031 2229 203a 5d5b 2261 3122  -01-01") :]["a1"
+0001ae50: 5d5b 3a72 6561 645f 6e64 6179 735d 0a20  ][:read_ndays]. 
+0001ae60: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+0001ae70: 745f 6172 7261 795f 6571 7561 6c28 6163  t_array_equal(ac
+0001ae80: 7475 616c 2c20 6578 7065 6374 6564 290a  tual, expected).
+0001ae90: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
+0001aea0: 7561 6c32 203d 2054 5b6e 702e 6461 7465  ual2 = T[np.date
+0001aeb0: 7469 6d65 3634 2822 3230 3130 2d30 312d  time64("2010-01-
+0001aec0: 3031 2229 203a 5d5b 3a72 6561 645f 6e64  01") :][:read_nd
+0001aed0: 6179 735d 0a20 2020 2020 2020 2020 2020  ays].           
+0001aee0: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+0001aef0: 7561 6c28 6163 7475 616c 322c 2065 7870  ual(actual2, exp
+0001af00: 6563 7465 6429 0a0a 2020 2020 6465 6620  ected)..    def 
+0001af10: 7465 7374 5f73 7061 7273 655f 6461 7465  test_sparse_date
+0001af20: 7469 6d65 5f76 6563 746f 7228 7365 6c66  time_vector(self
+0001af30: 2c20 7370 6172 7365 5f63 656c 6c5f 6f72  , sparse_cell_or
+0001af40: 6465 7229 3a0a 2020 2020 2020 2020 7572  der):.        ur
+0001af50: 6920 3d20 7365 6c66 2e70 6174 6828 2266  i = self.path("f
+0001af60: 6f6f 5f64 6174 6574 696d 655f 7370 6172  oo_datetime_spar
+0001af70: 7365 5f76 6563 746f 7222 290a 0a20 2020  se_vector")..   
+0001af80: 2020 2020 2023 206e 7320 7265 736f 6c75       # ns resolu
+0001af90: 7469 6f6e 2c20 6f6e 6520 7469 6c65 2070  tion, one tile p
+0001afa0: 6572 2073 6563 6f6e 642c 206d 6178 2064  er second, max d
+0001afb0: 6f6d 6169 6e20 706f 7373 6962 6c65 0a20  omain possible. 
+0001afc0: 2020 2020 2020 2064 696d 203d 2074 696c         dim = til
+0001afd0: 6564 622e 4469 6d28 0a20 2020 2020 2020  edb.Dim(.       
+0001afe0: 2020 2020 206e 616d 653d 2264 3122 2c0a       name="d1",.
+0001aff0: 2020 2020 2020 2020 2020 2020 646f 6d61              doma
+0001b000: 696e 3d28 0a20 2020 2020 2020 2020 2020  in=(.           
+0001b010: 2020 2020 206e 702e 6461 7465 7469 6d65       np.datetime
+0001b020: 3634 2830 2c20 226e 7322 292c 0a20 2020  64(0, "ns"),.   
+0001b030: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+0001b040: 6461 7465 7469 6d65 3634 2869 6e74 286e  datetime64(int(n
+0001b050: 702e 6969 6e66 6f28 6e70 2e69 6e74 3634  p.iinfo(np.int64
+0001b060: 292e 6d61 7829 202d 2031 3030 3030 3030  ).max) - 1000000
+0001b070: 3030 302c 2022 6e73 2229 2c0a 2020 2020  000, "ns"),.    
+0001b080: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+0001b090: 2020 2020 2020 2074 696c 653d 6e70 2e74         tile=np.t
+0001b0a0: 696d 6564 656c 7461 3634 2831 2c20 2273  imedelta64(1, "s
+0001b0b0: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
+0001b0c0: 6474 7970 653d 6e70 2e64 6174 6574 696d  dtype=np.datetim
+0001b0d0: 6536 3428 2222 2c20 226e 7322 292e 6474  e64("", "ns").dt
+0001b0e0: 7970 652c 0a20 2020 2020 2020 2029 0a20  ype,.        ). 
+0001b0f0: 2020 2020 2020 2073 656c 662e 6173 7365         self.asse
+0001b100: 7274 4571 7561 6c28 6469 6d2e 7469 6c65  rtEqual(dim.tile
+0001b110: 2c20 6e70 2e74 696d 6564 656c 7461 3634  , np.timedelta64
+0001b120: 2822 3130 3030 3030 3030 3030 222c 2022  ("1000000000", "
+0001b130: 6e73 2229 290a 2020 2020 2020 2020 646f  ns")).        do
+0001b140: 6d20 3d20 7469 6c65 6462 2e44 6f6d 6169  m = tiledb.Domai
+0001b150: 6e28 6469 6d29 0a20 2020 2020 2020 2073  n(dim).        s
+0001b160: 6368 656d 6120 3d20 7469 6c65 6462 2e41  chema = tiledb.A
+0001b170: 7272 6179 5363 6865 6d61 280a 2020 2020  rraySchema(.    
+0001b180: 2020 2020 2020 2020 646f 6d61 696e 3d64          domain=d
+0001b190: 6f6d 2c0a 2020 2020 2020 2020 2020 2020  om,.            
+0001b1a0: 7370 6172 7365 3d54 7275 652c 0a20 2020  sparse=True,.   
+0001b1b0: 2020 2020 2020 2020 2063 656c 6c5f 6f72           cell_or
+0001b1c0: 6465 723d 7370 6172 7365 5f63 656c 6c5f  der=sparse_cell_
+0001b1d0: 6f72 6465 722c 0a20 2020 2020 2020 2020  order,.         
+0001b1e0: 2020 2061 7474 7273 3d28 7469 6c65 6462     attrs=(tiledb
+0001b1f0: 2e41 7474 7228 2261 3122 2c20 6474 7970  .Attr("a1", dtyp
+0001b200: 653d 6e70 2e66 6c6f 6174 3634 292c 292c  e=np.float64),),
+0001b210: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0001b220: 2020 2074 696c 6564 622e 4172 7261 792e     tiledb.Array.
+0001b230: 6372 6561 7465 2875 7269 2c20 7363 6865  create(uri, sche
+0001b240: 6d61 290a 0a20 2020 2020 2020 2023 2057  ma)..        # W
+0001b250: 7269 7465 2031 306b 2063 656c 6c73 2065  rite 10k cells e
+0001b260: 7665 7279 2031 3030 3020 6e73 2073 7461  very 1000 ns sta
+0001b270: 7274 696e 6720 6174 2074 696d 6520 300a  rting at time 0.
+0001b280: 2020 2020 2020 2020 636f 6f72 6473 203d          coords =
+0001b290: 206e 702e 6461 7465 7469 6d65 3634 2830   np.datetime64(0
+0001b2a0: 2c20 226e 7322 2920 2b20 6e70 2e61 7261  , "ns") + np.ara
+0001b2b0: 6e67 6528 302c 2031 3030 3030 202a 2031  nge(0, 10000 * 1
+0001b2c0: 3030 302c 2031 3030 3029 0a20 2020 2020  000, 1000).     
+0001b2d0: 2020 2061 315f 7661 6c73 203d 206e 702e     a1_vals = np.
+0001b2e0: 7261 6e64 6f6d 2e72 616e 6428 6c65 6e28  random.rand(len(
+0001b2f0: 636f 6f72 6473 2929 0a20 2020 2020 2020  coords)).       
+0001b300: 2077 6974 6820 7469 6c65 6462 2e53 7061   with tiledb.Spa
+0001b310: 7273 6541 7272 6179 2875 7269 2c20 2277  rseArray(uri, "w
+0001b320: 2229 2061 7320 543a 0a20 2020 2020 2020  ") as T:.       
+0001b330: 2020 2020 2054 5b63 6f6f 7264 735d 203d       T[coords] =
+0001b340: 207b 2261 3122 3a20 6131 5f76 616c 737d   {"a1": a1_vals}
+0001b350: 0a0a 2020 2020 2020 2020 2320 5265 6164  ..        # Read
+0001b360: 2061 6c6c 0a20 2020 2020 2020 2077 6974   all.        wit
+0001b370: 6820 7469 6c65 6462 2e53 7061 7273 6541  h tiledb.SparseA
+0001b380: 7272 6179 2875 7269 2c20 2272 2229 2061  rray(uri, "r") a
+0001b390: 7320 543a 0a20 2020 2020 2020 2020 2020  s T:.           
+0001b3a0: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+0001b3b0: 7561 6c28 545b 3a5d 5b22 6131 225d 2c20  ual(T[:]["a1"], 
+0001b3c0: 6131 5f76 616c 7329 0a0a 2020 2020 2020  a1_vals)..      
+0001b3d0: 2020 2320 5265 6164 2062 6163 6b20 6669    # Read back fi
+0001b3e0: 7273 7420 3130 2063 656c 6c73 0a20 2020  rst 10 cells.   
+0001b3f0: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+0001b400: 2e53 7061 7273 6541 7272 6179 2875 7269  .SparseArray(uri
+0001b410: 2c20 2272 2229 2061 7320 543a 0a20 2020  , "r") as T:.   
+0001b420: 2020 2020 2020 2020 2073 7461 7274 203d           start =
+0001b430: 206e 702e 6461 7465 7469 6d65 3634 2830   np.datetime64(0
+0001b440: 2c20 226e 7322 290a 2020 2020 2020 2020  , "ns").        
+0001b450: 2020 2020 7661 6c73 203d 2054 5b73 7461      vals = T[sta
+0001b460: 7274 203a 2073 7461 7274 202b 206e 702e  rt : start + np.
+0001b470: 7469 6d65 6465 6c74 6136 3428 3130 3030  timedelta64(1000
+0001b480: 302c 2022 6e73 2229 5d5b 2261 3122 5d0a  0, "ns")]["a1"].
+0001b490: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+0001b4a0: 7274 5f61 7272 6179 5f65 7175 616c 2876  rt_array_equal(v
+0001b4b0: 616c 732c 2061 315f 7661 6c73 5b30 3a31  als, a1_vals[0:1
+0001b4c0: 315d 290a 0a20 2020 2020 2020 2020 2020  1])..           
+0001b4d0: 2023 2054 6573 7420 6f70 656e 2065 6e64   # Test open end
+0001b4e0: 6564 2072 616e 6765 7320 6d75 6c74 695f  ed ranges multi_
+0001b4f0: 696e 6465 780a 2020 2020 2020 2020 2020  index.          
+0001b500: 2020 7661 6c73 3220 3d20 542e 6d75 6c74    vals2 = T.mult
+0001b510: 695f 696e 6465 785b 7374 6172 743a 5d5b  i_index[start:][
+0001b520: 2261 3122 5d0a 2020 2020 2020 2020 2020  "a1"].          
+0001b530: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
+0001b540: 7175 616c 2876 616c 7332 2c20 6131 5f76  qual(vals2, a1_v
+0001b550: 616c 7329 0a0a 2020 2020 2020 2020 2020  als)..          
+0001b560: 2020 7374 6f70 203d 206e 702e 6461 7465    stop = np.date
+0001b570: 7469 6d65 3634 2869 6e74 286e 702e 6969  time64(int(np.ii
+0001b580: 6e66 6f28 6e70 2e69 6e74 3634 292e 6d61  nfo(np.int64).ma
+0001b590: 7829 202d 2031 3030 3030 3030 3030 302c  x) - 1000000000,
+0001b5a0: 2022 6e73 2229 0a20 2020 2020 2020 2020   "ns").         
+0001b5b0: 2020 2076 616c 7333 203d 2054 2e6d 756c     vals3 = T.mul
+0001b5c0: 7469 5f69 6e64 6578 5b3a 7374 6f70 5d5b  ti_index[:stop][
+0001b5d0: 2261 3122 5d0a 2020 2020 2020 2020 2020  "a1"].          
+0001b5e0: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
+0001b5f0: 7175 616c 2876 616c 7333 2c20 6131 5f76  qual(vals3, a1_v
+0001b600: 616c 7329 0a0a 2020 2020 6465 6620 7465  als)..    def te
+0001b610: 7374 5f64 6174 6574 696d 655f 7479 7065  st_datetime_type
+0001b620: 7328 7365 6c66 2c20 7370 6172 7365 5f63  s(self, sparse_c
+0001b630: 656c 6c5f 6f72 6465 7229 3a0a 2020 2020  ell_order):.    
+0001b640: 2020 2020 756e 6974 7320 3d20 5b22 6822      units = ["h"
+0001b650: 2c20 226d 222c 2022 7322 2c20 226d 7322  , "m", "s", "ms"
+0001b660: 2c20 2275 7322 2c20 226e 7322 2c20 2270  , "us", "ns", "p
+0001b670: 7322 2c20 2266 7322 5d0a 0a20 2020 2020  s", "fs"]..     
+0001b680: 2020 2066 6f72 2072 6573 2069 6e20 756e     for res in un
+0001b690: 6974 733a 0a20 2020 2020 2020 2020 2020  its:.           
+0001b6a0: 2075 7269 203d 2073 656c 662e 7061 7468   uri = self.path
+0001b6b0: 2822 7465 7374 5f64 6174 6574 696d 655f  ("test_datetime_
+0001b6c0: 7479 7065 5f22 202b 2072 6573 290a 0a20  type_" + res).. 
+0001b6d0: 2020 2020 2020 2020 2020 2074 6d61 7820             tmax 
+0001b6e0: 3d20 3130 3030 0a20 2020 2020 2020 2020  = 1000.         
+0001b6f0: 2020 2074 696c 6520 3d20 6e70 2e74 696d     tile = np.tim
+0001b700: 6564 656c 7461 3634 2831 2c20 7265 7329  edelta64(1, res)
+0001b710: 0a0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+0001b720: 6d20 3d20 7469 6c65 6462 2e44 696d 280a  m = tiledb.Dim(.
+0001b730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b740: 6e61 6d65 3d22 6431 222c 0a20 2020 2020  name="d1",.     
+0001b750: 2020 2020 2020 2020 2020 2064 6f6d 6169             domai
+0001b760: 6e3d 284e 6f6e 652c 204e 6f6e 6529 2c0a  n=(None, None),.
+0001b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b780: 7469 6c65 3d74 696c 652c 0a20 2020 2020  tile=tile,.     
+0001b790: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
+0001b7a0: 3d6e 702e 6461 7465 7469 6d65 3634 2822  =np.datetime64("
+0001b7b0: 222c 2072 6573 292e 6474 7970 652c 0a20  ", res).dtype,. 
+0001b7c0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001b7d0: 2020 2020 2020 2020 2064 6f6d 203d 2074           dom = t
+0001b7e0: 696c 6564 622e 446f 6d61 696e 2864 696d  iledb.Domain(dim
+0001b7f0: 290a 2020 2020 2020 2020 2020 2020 7363  ).            sc
+0001b800: 6865 6d61 203d 2074 696c 6564 622e 4172  hema = tiledb.Ar
+0001b810: 7261 7953 6368 656d 6128 0a20 2020 2020  raySchema(.     
+0001b820: 2020 2020 2020 2020 2020 2064 6f6d 6169             domai
+0001b830: 6e3d 646f 6d2c 0a20 2020 2020 2020 2020  n=dom,.         
+0001b840: 2020 2020 2020 2073 7061 7273 653d 5472         sparse=Tr
+0001b850: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0001b860: 2020 2020 6365 6c6c 5f6f 7264 6572 3d73      cell_order=s
+0001b870: 7061 7273 655f 6365 6c6c 5f6f 7264 6572  parse_cell_order
+0001b880: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001b890: 2020 6174 7472 733d 2874 696c 6564 622e    attrs=(tiledb.
+0001b8a0: 4174 7472 2822 6131 222c 2064 7479 7065  Attr("a1", dtype
+0001b8b0: 3d6e 702e 666c 6f61 7436 3429 2c29 2c0a  =np.float64),),.
+0001b8c0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0001b8d0: 2020 2020 2020 2020 2020 2074 696c 6564             tiled
+0001b8e0: 622e 4172 7261 792e 6372 6561 7465 2875  b.Array.create(u
+0001b8f0: 7269 2c20 7363 6865 6d61 290a 0a20 2020  ri, schema)..   
+0001b900: 2020 2020 2020 2020 2023 2057 7269 7465           # Write
+0001b910: 2074 6d61 7820 6365 6c6c 7320 6576 6572   tmax cells ever
+0001b920: 7920 3130 2075 6e69 7473 2073 7461 7274  y 10 units start
+0001b930: 696e 6720 6174 2074 696d 6520 300a 2020  ing at time 0.  
+0001b940: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
+0001b950: 203d 206e 702e 6461 7465 7469 6d65 3634   = np.datetime64
+0001b960: 2830 2c20 7265 7329 202b 206e 702e 6172  (0, res) + np.ar
+0001b970: 616e 6765 280a 2020 2020 2020 2020 2020  ange(.          
+0001b980: 2020 2020 2020 302c 2074 6d61 782c 2031        0, tmax, 1
+0001b990: 300a 2020 2020 2020 2020 2020 2020 2920  0.            ) 
+0001b9a0: 2023 206e 702e 6172 616e 6765 2830 2c20   # np.arange(0, 
+0001b9b0: 3130 3030 3020 2a20 3130 3030 2c20 3130  10000 * 1000, 10
+0001b9c0: 3030 290a 2020 2020 2020 2020 2020 2020  00).            
+0001b9d0: 6131 5f76 616c 7320 3d20 6e70 2e72 616e  a1_vals = np.ran
+0001b9e0: 646f 6d2e 7261 6e64 286c 656e 2863 6f6f  dom.rand(len(coo
+0001b9f0: 7264 7329 290a 2020 2020 2020 2020 2020  rds)).          
+0001ba00: 2020 7769 7468 2074 696c 6564 622e 5370    with tiledb.Sp
+0001ba10: 6172 7365 4172 7261 7928 7572 692c 2022  arseArray(uri, "
+0001ba20: 7722 2920 6173 2054 3a0a 2020 2020 2020  w") as T:.      
+0001ba30: 2020 2020 2020 2020 2020 545b 636f 6f72            T[coor
+0001ba40: 6473 5d20 3d20 7b22 6131 223a 2061 315f  ds] = {"a1": a1_
+0001ba50: 7661 6c73 7d0a 0a20 2020 2020 2020 2020  vals}..         
+0001ba60: 2020 2023 2052 6561 6420 616c 6c0a 2020     # Read all.  
+0001ba70: 2020 2020 2020 2020 2020 7769 7468 2074            with t
+0001ba80: 696c 6564 622e 5370 6172 7365 4172 7261  iledb.SparseArra
+0001ba90: 7928 7572 692c 2022 7222 2920 6173 2054  y(uri, "r") as T
+0001baa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001bab0: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
+0001bac0: 7175 616c 2854 5b3a 5d5b 2261 3122 5d2c  qual(T[:]["a1"],
+0001bad0: 2061 315f 7661 6c73 290a 0a20 2020 2020   a1_vals)..     
+0001bae0: 2020 2020 2020 2023 2052 6561 6420 6261         # Read ba
+0001baf0: 636b 2066 6972 7374 2031 3020 6365 6c6c  ck first 10 cell
+0001bb00: 730a 2020 2020 2020 2020 2020 2020 7769  s.            wi
+0001bb10: 7468 2074 696c 6564 622e 5370 6172 7365  th tiledb.Sparse
+0001bb20: 4172 7261 7928 7572 692c 2022 7222 2920  Array(uri, "r") 
+0001bb30: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
+0001bb40: 2020 2020 2020 7374 6172 7420 3d20 6e70        start = np
+0001bb50: 2e64 6174 6574 696d 6536 3428 302c 2072  .datetime64(0, r
+0001bb60: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+0001bb70: 2020 2020 7661 6c73 203d 2054 5b73 7461      vals = T[sta
+0001bb80: 7274 203a 2073 7461 7274 202b 206e 702e  rt : start + np.
+0001bb90: 7469 6d65 6465 6c74 6136 3428 696e 7428  timedelta64(int(
+0001bba0: 746d 6178 202f 2031 3029 2c20 7265 7329  tmax / 10), res)
+0001bbb0: 5d5b 2261 3122 5d0a 2020 2020 2020 2020  ]["a1"].        
+0001bbc0: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+0001bbd0: 7272 6179 5f65 7175 616c 2876 616c 732c  rray_equal(vals,
+0001bbe0: 2061 315f 7661 6c73 5b30 3a31 315d 290a   a1_vals[0:11]).
+0001bbf0: 0a0a 636c 6173 7320 5069 636b 6c65 5465  ..class PickleTe
+0001bc00: 7374 2844 6973 6b54 6573 7443 6173 6529  st(DiskTestCase)
+0001bc10: 3a0a 2020 2020 2320 7465 7374 2074 6861  :.    # test tha
+0001bc20: 7420 4465 6e73 6541 7272 6179 2061 6e64  t DenseArray and
+0001bc30: 2056 6965 7720 6361 6e20 6265 2070 6963   View can be pic
+0001bc40: 6b6c 6564 2066 6f72 206d 756c 7469 7072  kled for multipr
+0001bc50: 6f63 6573 7320 7573 650a 2020 2020 2320  ocess use.    # 
+0001bc60: 6e6f 7465 2074 6861 7420 7468 6520 6375  note that the cu
+0001bc70: 7272 656e 7420 7069 636b 6c69 6e67 2069  rrent pickling i
+0001bc80: 7320 6279 2055 5249 2061 6e64 2061 7474  s by URI and att
+0001bc90: 7269 6275 7465 7320 2869 7420 6973 0a20  ributes (it is. 
+0001bca0: 2020 2023 2020 2020 206e 6f74 2c20 616e     #     not, an
+0001bcb0: 6420 6c69 6b65 6c79 2073 686f 756c 6420  d likely should 
+0001bcc0: 6e6f 7420 6265 2c20 6120 7761 7920 746f  not be, a way to
+0001bcd0: 2073 6572 6961 6c69 7a65 2061 7272 6179   serialize array
+0001bce0: 2064 6174 6129 0a0a 2020 2020 4070 7974   data)..    @pyt
+0001bcf0: 6573 742e 6d61 726b 2e70 6172 616d 6574  est.mark.paramet
+0001bd00: 7269 7a65 2822 7370 6172 7365 222c 205b  rize("sparse", [
+0001bd10: 5472 7565 2c20 4661 6c73 655d 290a 2020  True, False]).  
+0001bd20: 2020 6465 6620 7465 7374 5f70 6963 6b6c    def test_pickl
+0001bd30: 655f 726f 756e 6474 7269 7028 7365 6c66  e_roundtrip(self
+0001bd40: 2c20 7370 6172 7365 293a 0a20 2020 2020  , sparse):.     
+0001bd50: 2020 2075 7269 203d 2073 656c 662e 7061     uri = self.pa
+0001bd60: 7468 2822 7465 7374 5f70 6963 6b6c 655f  th("test_pickle_
+0001bd70: 726f 756e 6474 7269 7022 290a 2020 2020  roundtrip").    
+0001bd80: 2020 2020 646f 6d20 3d20 7469 6c65 6462      dom = tiledb
+0001bd90: 2e44 6f6d 6169 6e28 7469 6c65 6462 2e44  .Domain(tiledb.D
+0001bda0: 696d 2864 6f6d 6169 6e3d 2830 2c20 3229  im(domain=(0, 2)
+0001bdb0: 2c20 7469 6c65 3d33 2929 0a20 2020 2020  , tile=3)).     
+0001bdc0: 2020 2073 6368 656d 6120 3d20 7469 6c65     schema = tile
+0001bdd0: 6462 2e41 7272 6179 5363 6865 6d61 2864  db.ArraySchema(d
+0001bde0: 6f6d 6169 6e3d 646f 6d2c 2061 7474 7273  omain=dom, attrs
+0001bdf0: 3d28 7469 6c65 6462 2e41 7474 7228 2222  =(tiledb.Attr(""
+0001be00: 292c 292c 2073 7061 7273 653d 7370 6172  ),), sparse=spar
+0001be10: 7365 290a 2020 2020 2020 2020 7469 6c65  se).        tile
+0001be20: 6462 2e6c 6962 7469 6c65 6462 2e41 7272  db.libtiledb.Arr
+0001be30: 6179 2e63 7265 6174 6528 7572 692c 2073  ay.create(uri, s
+0001be40: 6368 656d 6129 0a0a 2020 2020 2020 2020  chema)..        
+0001be50: 7769 7468 2074 696c 6564 622e 6f70 656e  with tiledb.open
+0001be60: 2875 7269 2c20 2277 2229 2061 7320 543a  (uri, "w") as T:
+0001be70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001be80: 7370 6172 7365 3a0a 2020 2020 2020 2020  sparse:.        
+0001be90: 2020 2020 2020 2020 545b 5b30 2c20 312c          T[[0, 1,
+0001bea0: 2032 5d5d 203d 206e 702e 7261 6e64 6f6d   2]] = np.random
+0001beb0: 2e72 616e 6469 6e74 2831 302c 2073 697a  .randint(10, siz
+0001bec0: 653d 3329 0a20 2020 2020 2020 2020 2020  e=3).           
+0001bed0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001bee0: 2020 2020 2020 2054 5b3a 5d20 3d20 6e70         T[:] = np
+0001bef0: 2e72 616e 646f 6d2e 7261 6e64 696e 7428  .random.randint(
+0001bf00: 3130 2c20 7369 7a65 3d33 290a 0a20 2020  10, size=3)..   
+0001bf10: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+0001bf20: 2e6f 7065 6e28 7572 692c 2022 7222 2920  .open(uri, "r") 
+0001bf30: 6173 2054 3a0a 2020 2020 2020 2020 2020  as T:.          
+0001bf40: 2020 7769 7468 2069 6f2e 4279 7465 7349    with io.BytesI
+0001bf50: 4f28 2920 6173 2062 7566 3a0a 2020 2020  O() as buf:.    
+0001bf60: 2020 2020 2020 2020 2020 2020 7069 636b              pick
+0001bf70: 6c65 2e64 756d 7028 542c 2062 7566 290a  le.dump(T, buf).
+0001bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf90: 6275 662e 7365 656b 2830 290a 2020 2020  buf.seek(0).    
+0001bfa0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0001bfb0: 2070 6963 6b6c 652e 6c6f 6164 2862 7566   pickle.load(buf
+0001bfc0: 2920 6173 2054 323a 0a20 2020 2020 2020  ) as T2:.       
+0001bfd0: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+0001bfe0: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+0001bff0: 542e 6466 5b3a 5d2c 2054 322e 6466 5b3a  T.df[:], T2.df[:
+0001c000: 5d29 0a0a 2020 2020 2020 2020 2020 2020  ])..            
+0001c010: 7769 7468 2069 6f2e 4279 7465 7349 4f28  with io.BytesIO(
+0001c020: 2920 6173 2062 7566 2c20 7469 6c65 6462  ) as buf, tiledb
+0001c030: 2e6f 7065 6e28 7572 6929 2061 7320 563a  .open(uri) as V:
+0001c040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c050: 2070 6963 6b6c 652e 6475 6d70 2856 2c20   pickle.dump(V, 
+0001c060: 6275 6629 0a20 2020 2020 2020 2020 2020  buf).           
+0001c070: 2020 2020 2062 7566 2e73 6565 6b28 3029       buf.seek(0)
+0001c080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c090: 2077 6974 6820 7069 636b 6c65 2e6c 6f61   with pickle.loa
+0001c0a0: 6428 6275 6629 2061 7320 5632 3a0a 2020  d(buf) as V2:.  
+0001c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c0c0: 2020 2320 6d61 6b65 2073 7572 6520 616e    # make sure an
+0001c0d0: 6f6e 796d 6f75 7320 7669 6577 2070 6963  onymous view pic
+0001c0e0: 6b6c 6573 2061 6e64 2072 6f75 6e64 2d74  kles and round-t
+0001c0f0: 7269 7073 0a20 2020 2020 2020 2020 2020  rips.           
+0001c100: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+0001c110: 6172 7261 795f 6571 7561 6c28 562e 6466  array_equal(V.df
+0001c120: 5b3a 5d2c 2056 322e 6466 5b3a 5d29 0a0a  [:], V2.df[:])..
+0001c130: 2020 2020 4074 696c 6564 622e 7363 6f70      @tiledb.scop
+0001c140: 655f 6374 7828 7b22 7666 732e 7333 2e72  e_ctx({"vfs.s3.r
+0001c150: 6567 696f 6e22 3a20 226b 7579 7065 722d  egion": "kuyper-
+0001c160: 6265 6c74 2d31 222c 2022 7666 732e 6d61  belt-1", "vfs.ma
+0001c170: 785f 7061 7261 6c6c 656c 5f6f 7073 223a  x_parallel_ops":
+0001c180: 2022 3122 7d29 0a20 2020 2064 6566 2074   "1"}).    def t
+0001c190: 6573 745f 7069 636b 6c65 5f77 6974 685f  est_pickle_with_
+0001c1a0: 636f 6e66 6967 2873 656c 6629 3a0a 2020  config(self):.  
+0001c1b0: 2020 2020 2020 7572 6920 3d20 7365 6c66        uri = self
+0001c1c0: 2e70 6174 6828 2270 6963 6b6c 655f 636f  .path("pickle_co
+0001c1d0: 6e66 6967 2229 0a20 2020 2020 2020 2054  nfig").        T
+0001c1e0: 203d 2074 696c 6564 622e 4465 6e73 6541   = tiledb.DenseA
+0001c1f0: 7272 6179 2e66 726f 6d5f 6e75 6d70 7928  rray.from_numpy(
+0001c200: 7572 692c 206e 702e 7261 6e64 6f6d 2e72  uri, np.random.r
+0001c210: 616e 6428 332c 2033 2929 0a0a 2020 2020  and(3, 3))..    
+0001c220: 2020 2020 7769 7468 2069 6f2e 4279 7465      with io.Byte
+0001c230: 7349 4f28 2920 6173 2062 7566 3a0a 2020  sIO() as buf:.  
+0001c240: 2020 2020 2020 2020 2020 7069 636b 6c65            pickle
+0001c250: 2e64 756d 7028 542c 2062 7566 290a 2020  .dump(T, buf).  
+0001c260: 2020 2020 2020 2020 2020 6275 662e 7365            buf.se
+0001c270: 656b 2830 290a 2020 2020 2020 2020 2020  ek(0).          
+0001c280: 2020 5432 203d 2070 6963 6b6c 652e 6c6f    T2 = pickle.lo
+0001c290: 6164 2862 7566 290a 2020 2020 2020 2020  ad(buf).        
+0001c2a0: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
+0001c2b0: 5f65 7175 616c 2854 2c20 5432 290a 2020  _equal(T, T2).  
+0001c2c0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+0001c2d0: 6178 4469 6666 203d 204e 6f6e 650a 2020  axDiff = None.  
+0001c2e0: 2020 2020 2020 2020 2020 6431 203d 2074            d1 = t
+0001c2f0: 696c 6564 622e 6465 6661 756c 745f 6374  iledb.default_ct
+0001c300: 7828 292e 636f 6e66 6967 2829 2e64 6963  x().config().dic
+0001c310: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+0001c320: 6432 203d 2054 322e 5f63 7478 5f28 292e  d2 = T2._ctx_().
+0001c330: 636f 6e66 6967 2829 2e64 6963 7428 290a  config().dict().
+0001c340: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001c350: 2e61 7373 6572 7445 7175 616c 2864 315b  .assertEqual(d1[
+0001c360: 2276 6673 2e73 332e 7265 6769 6f6e 225d  "vfs.s3.region"]
+0001c370: 2c20 6432 5b22 7666 732e 7333 2e72 6567  , d2["vfs.s3.reg
+0001c380: 696f 6e22 5d29 0a20 2020 2020 2020 2020  ion"]).         
+0001c390: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0001c3a0: 7561 6c28 6431 5b22 7666 732e 6d61 785f  ual(d1["vfs.max_
+0001c3b0: 7061 7261 6c6c 656c 5f6f 7073 225d 2c20  parallel_ops"], 
+0001c3c0: 6432 5b22 7666 732e 6d61 785f 7061 7261  d2["vfs.max_para
+0001c3d0: 6c6c 656c 5f6f 7073 225d 290a 2020 2020  llel_ops"]).    
+0001c3e0: 2020 2020 542e 636c 6f73 6528 290a 2020      T.close().  
+0001c3f0: 2020 2020 2020 5432 2e63 6c6f 7365 2829        T2.close()
+0001c400: 0a0a 2020 2020 4070 7974 6573 742e 6d61  ..    @pytest.ma
+0001c410: 726b 2e70 6172 616d 6574 7269 7a65 2822  rk.parametrize("
+0001c420: 7370 6172 7365 222c 205b 5472 7565 2c20  sparse", [True, 
+0001c430: 4661 6c73 655d 290a 2020 2020 6465 6620  False]).    def 
+0001c440: 7465 7374 5f70 6963 6b6c 655f 7769 7468  test_pickle_with
+0001c450: 5f74 7570 6c65 5f74 696d 6573 7461 6d70  _tuple_timestamp
+0001c460: 7328 7365 6c66 2c20 7370 6172 7365 293a  s(self, sparse):
+0001c470: 0a20 2020 2020 2020 2041 203d 206e 702e  .        A = np.
+0001c480: 7261 6e64 6f6d 2e72 616e 6469 6e74 2831  random.randint(1
+0001c490: 302c 2073 697a 653d 3329 0a20 2020 2020  0, size=3).     
+0001c4a0: 2020 2070 6174 6820 3d20 7365 6c66 2e70     path = self.p
+0001c4b0: 6174 6828 2274 6573 745f 7069 636b 6c65  ath("test_pickle
+0001c4c0: 5f77 6974 685f 7475 706c 655f 7469 6d65  _with_tuple_time
+0001c4d0: 7374 616d 7073 2229 0a0a 2020 2020 2020  stamps")..      
+0001c4e0: 2020 646f 6d20 3d20 7469 6c65 6462 2e44    dom = tiledb.D
+0001c4f0: 6f6d 6169 6e28 7469 6c65 6462 2e44 696d  omain(tiledb.Dim
+0001c500: 2864 6f6d 6169 6e3d 2830 2c20 3229 2c20  (domain=(0, 2), 
+0001c510: 7469 6c65 3d33 2c20 6474 7970 653d 6e70  tile=3, dtype=np
+0001c520: 2e69 6e74 3634 2929 0a20 2020 2020 2020  .int64)).       
+0001c530: 2061 7474 203d 2074 696c 6564 622e 4174   att = tiledb.At
+0001c540: 7472 2864 7479 7065 3d41 2e64 7479 7065  tr(dtype=A.dtype
+0001c550: 290a 2020 2020 2020 2020 7363 6865 6d61  ).        schema
+0001c560: 203d 2074 696c 6564 622e 4172 7261 7953   = tiledb.ArrayS
+0001c570: 6368 656d 6128 646f 6d61 696e 3d64 6f6d  chema(domain=dom
+0001c580: 2c20 6174 7472 733d 2861 7474 2c29 2c20  , attrs=(att,), 
+0001c590: 7370 6172 7365 3d73 7061 7273 6529 0a20  sparse=sparse). 
+0001c5a0: 2020 2020 2020 2074 696c 6564 622e 6c69         tiledb.li
+0001c5b0: 6274 696c 6564 622e 4172 7261 792e 6372  btiledb.Array.cr
+0001c5c0: 6561 7465 2870 6174 682c 2073 6368 656d  eate(path, schem
+0001c5d0: 6129 0a0a 2020 2020 2020 2020 666f 7220  a)..        for 
+0001c5e0: 7473 2069 6e20 7261 6e67 6528 312c 2035  ts in range(1, 5
+0001c5f0: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
+0001c600: 6974 6820 7469 6c65 6462 2e6f 7065 6e28  ith tiledb.open(
+0001c610: 7061 7468 2c20 7469 6d65 7374 616d 703d  path, timestamp=
+0001c620: 7473 2c20 6d6f 6465 3d22 7722 2920 6173  ts, mode="w") as
+0001c630: 2054 3a0a 2020 2020 2020 2020 2020 2020   T:.            
+0001c640: 2020 2020 6966 2073 7061 7273 653a 0a20      if sparse:. 
+0001c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c660: 2020 2054 5b5b 302c 2031 2c20 325d 5d20     T[[0, 1, 2]] 
+0001c670: 3d20 4120 2a20 7473 0a20 2020 2020 2020  = A * ts.       
+0001c680: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6a0: 2020 2054 5b3a 5d20 3d20 4120 2a20 7473     T[:] = A * ts
+0001c6b0: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
+0001c6c0: 696c 6564 622e 6f70 656e 2870 6174 682c  iledb.open(path,
+0001c6d0: 2074 696d 6573 7461 6d70 3d28 322c 2033   timestamp=(2, 3
+0001c6e0: 292c 206d 6f64 653d 2272 2229 2061 7320  ), mode="r") as 
+0001c6f0: 543a 0a20 2020 2020 2020 2020 2020 2077  T:.            w
+0001c700: 6974 6820 696f 2e42 7974 6573 494f 2829  ith io.BytesIO()
+0001c710: 2061 7320 6275 663a 0a20 2020 2020 2020   as buf:.       
+0001c720: 2020 2020 2020 2020 2070 6963 6b6c 652e           pickle.
+0001c730: 6475 6d70 2854 2c20 6275 6629 0a20 2020  dump(T, buf).   
+0001c740: 2020 2020 2020 2020 2020 2020 2062 7566               buf
+0001c750: 2e73 6565 6b28 3029 0a20 2020 2020 2020  .seek(0).       
+0001c760: 2020 2020 2020 2020 2077 6974 6820 7069           with pi
+0001c770: 636b 6c65 2e6c 6f61 6428 6275 6629 2061  ckle.load(buf) a
+0001c780: 7320 5432 3a0a 2020 2020 2020 2020 2020  s T2:.          
+0001c790: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0001c7a0: 5f61 7272 6179 5f65 7175 616c 2854 2e64  _array_equal(T.d
+0001c7b0: 665b 3a5d 2c20 5432 2e64 665b 3a5d 290a  f[:], T2.df[:]).
+0001c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7d0: 2020 2020 6173 7365 7274 2054 322e 7469      assert T2.ti
+0001c7e0: 6d65 7374 616d 705f 7261 6e67 6520 3d3d  mestamp_range ==
+0001c7f0: 2028 322c 2033 290a 0a20 2020 2020 2020   (2, 3)..       
+0001c800: 2020 2020 2077 6974 6820 696f 2e42 7974       with io.Byt
+0001c810: 6573 494f 2829 2061 7320 6275 662c 2074  esIO() as buf, t
+0001c820: 696c 6564 622e 6f70 656e 2870 6174 682c  iledb.open(path,
+0001c830: 2074 696d 6573 7461 6d70 3d28 322c 2033   timestamp=(2, 3
+0001c840: 2929 2061 7320 563a 0a20 2020 2020 2020  )) as V:.       
+0001c850: 2020 2020 2020 2020 2070 6963 6b6c 652e           pickle.
+0001c860: 6475 6d70 2856 2c20 6275 6629 0a20 2020  dump(V, buf).   
+0001c870: 2020 2020 2020 2020 2020 2020 2062 7566               buf
+0001c880: 2e73 6565 6b28 3029 0a20 2020 2020 2020  .seek(0).       
+0001c890: 2020 2020 2020 2020 2077 6974 6820 7069           with pi
+0001c8a0: 636b 6c65 2e6c 6f61 6428 6275 6629 2061  ckle.load(buf) a
+0001c8b0: 7320 5632 3a0a 2020 2020 2020 2020 2020  s V2:.          
+0001c8c0: 2020 2020 2020 2020 2020 2320 6d61 6b65            # make
+0001c8d0: 2073 7572 6520 616e 6f6e 796d 6f75 7320   sure anonymous 
+0001c8e0: 7669 6577 2070 6963 6b6c 6573 2061 6e64  view pickles and
+0001c8f0: 2072 6f75 6e64 2d74 7269 7073 0a20 2020   round-trips.   
+0001c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c910: 2061 7373 6572 745f 6172 7261 795f 6571   assert_array_eq
+0001c920: 7561 6c28 562e 6466 5b3a 5d2c 2056 322e  ual(V.df[:], V2.
+0001c930: 6466 5b3a 5d29 0a20 2020 2020 2020 2020  df[:]).         
+0001c940: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+0001c950: 7420 5632 2e74 696d 6573 7461 6d70 5f72  t V2.timestamp_r
+0001c960: 616e 6765 203d 3d20 2832 2c20 3329 0a0a  ange == (2, 3)..
+0001c970: 0a63 6c61 7373 2041 7272 6179 5669 6577  .class ArrayView
+0001c980: 5465 7374 2844 6973 6b54 6573 7443 6173  Test(DiskTestCas
+0001c990: 6529 3a0a 2020 2020 6465 6620 7465 7374  e):.    def test
+0001c9a0: 5f76 6965 775f 6d75 6c74 6961 7474 7228  _view_multiattr(
+0001c9b0: 7365 6c66 293a 0a20 2020 2020 2020 2075  self):.        u
+0001c9c0: 7269 203d 2073 656c 662e 7061 7468 2822  ri = self.path("
+0001c9d0: 666f 6f5f 6d75 6c74 6961 7474 7222 290a  foo_multiattr").
+0001c9e0: 2020 2020 2020 2020 646f 6d20 3d20 7469          dom = ti
+0001c9f0: 6c65 6462 2e44 6f6d 6169 6e28 0a20 2020  ledb.Domain(.   
+0001ca00: 2020 2020 2020 2020 2074 696c 6564 622e           tiledb.
+0001ca10: 4469 6d28 646f 6d61 696e 3d28 302c 2032  Dim(domain=(0, 2
+0001ca20: 292c 2074 696c 653d 3329 2c20 7469 6c65  ), tile=3), tile
+0001ca30: 6462 2e44 696d 2864 6f6d 6169 6e3d 2830  db.Dim(domain=(0
+0001ca40: 2c20 3229 2c20 7469 6c65 3d33 290a 2020  , 2), tile=3).  
+0001ca50: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001ca60: 7363 6865 6d61 203d 2074 696c 6564 622e  schema = tiledb.
+0001ca70: 4172 7261 7953 6368 656d 6128 0a20 2020  ArraySchema(.   
+0001ca80: 2020 2020 2020 2020 2064 6f6d 6169 6e3d           domain=
+0001ca90: 646f 6d2c 2061 7474 7273 3d28 7469 6c65  dom, attrs=(tile
+0001caa0: 6462 2e41 7474 7228 2222 292c 2074 696c  db.Attr(""), til
+0001cab0: 6564 622e 4174 7472 2822 6e61 6d65 6422  edb.Attr("named"
+0001cac0: 2929 0a20 2020 2020 2020 2029 0a20 2020  )).        ).   
+0001cad0: 2020 2020 2074 696c 6564 622e 6c69 6274       tiledb.libt
+0001cae0: 696c 6564 622e 4172 7261 792e 6372 6561  iledb.Array.crea
+0001caf0: 7465 2875 7269 2c20 7363 6865 6d61 290a  te(uri, schema).
+0001cb00: 0a20 2020 2020 2020 2061 6e6f 6e5f 6172  .        anon_ar
+0001cb10: 203d 206e 702e 7261 6e64 6f6d 2e72 616e   = np.random.ran
+0001cb20: 6428 332c 2033 290a 2020 2020 2020 2020  d(3, 3).        
+0001cb30: 6e61 6d65 645f 6172 203d 206e 702e 7261  named_ar = np.ra
+0001cb40: 6e64 6f6d 2e72 616e 6428 332c 2033 290a  ndom.rand(3, 3).
+0001cb50: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
+0001cb60: 6c65 6462 2e44 656e 7365 4172 7261 7928  ledb.DenseArray(
+0001cb70: 7572 692c 2022 7722 2920 6173 2054 3a0a  uri, "w") as T:.
+0001cb80: 2020 2020 2020 2020 2020 2020 545b 3a5d              T[:]
+0001cb90: 203d 207b 2222 3a20 616e 6f6e 5f61 722c   = {"": anon_ar,
+0001cba0: 2022 6e61 6d65 6422 3a20 6e61 6d65 645f   "named": named_
+0001cbb0: 6172 7d0a 0a20 2020 2020 2020 2077 6974  ar}..        wit
+0001cbc0: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
+0001cbd0: 7365 7328 4b65 7945 7272 6f72 293a 0a20  ses(KeyError):. 
+0001cbe0: 2020 2020 2020 2020 2020 2054 203d 2074             T = t
+0001cbf0: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
+0001cc00: 2875 7269 2c20 2272 222c 2061 7474 723d  (uri, "r", attr=
+0001cc10: 2266 6f6f 3131 3122 290a 0a20 2020 2020  "foo111")..     
+0001cc20: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
+0001cc30: 656e 7365 4172 7261 7928 7572 692c 2022  enseArray(uri, "
+0001cc40: 7222 2c20 6174 7472 3d22 6e61 6d65 6422  r", attr="named"
+0001cc50: 2920 6173 2054 3a0a 2020 2020 2020 2020  ) as T:.        
+0001cc60: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
+0001cc70: 5f65 7175 616c 2854 2c20 6e61 6d65 645f  _equal(T, named_
+0001cc80: 6172 290a 2020 2020 2020 2020 2020 2020  ar).            
+0001cc90: 2320 6d61 6b65 2073 7572 6520 6561 6368  # make sure each
+0001cca0: 2061 7474 7220 7669 6577 2063 616e 2070   attr view can p
+0001ccb0: 6963 6b6c 6520 616e 6420 726f 756e 642d  ickle and round-
+0001ccc0: 7472 6970 0a20 2020 2020 2020 2020 2020  trip.           
+0001ccd0: 2077 6974 6820 696f 2e42 7974 6573 494f   with io.BytesIO
+0001cce0: 2829 2061 7320 6275 663a 0a20 2020 2020  () as buf:.     
+0001ccf0: 2020 2020 2020 2020 2020 2070 6963 6b6c             pickl
+0001cd00: 652e 6475 6d70 2854 2c20 6275 6629 0a20  e.dump(T, buf). 
+0001cd10: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001cd20: 7566 2e73 6565 6b28 3029 0a20 2020 2020  uf.seek(0).     
+0001cd30: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0001cd40: 7069 636b 6c65 2e6c 6f61 6428 6275 6629  pickle.load(buf)
+0001cd50: 2061 7320 545f 7274 3a0a 2020 2020 2020   as T_rt:.      
+0001cd60: 2020 2020 2020 2020 2020 2020 2020 6173                as
+0001cd70: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
+0001cd80: 2854 2c20 545f 7274 290a 0a20 2020 2020  (T, T_rt)..     
+0001cd90: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
+0001cda0: 656e 7365 4172 7261 7928 7572 692c 2022  enseArray(uri, "
+0001cdb0: 7222 2c20 6174 7472 3d22 2229 2061 7320  r", attr="") as 
+0001cdc0: 543a 0a20 2020 2020 2020 2020 2020 2061  T:.            a
+0001cdd0: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+0001cde0: 6c28 542c 2061 6e6f 6e5f 6172 290a 0a20  l(T, anon_ar).. 
+0001cdf0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0001ce00: 696f 2e42 7974 6573 494f 2829 2061 7320  io.BytesIO() as 
+0001ce10: 6275 663a 0a20 2020 2020 2020 2020 2020  buf:.           
+0001ce20: 2020 2020 2070 6963 6b6c 652e 6475 6d70       pickle.dump
+0001ce30: 2854 2c20 6275 6629 0a20 2020 2020 2020  (T, buf).       
+0001ce40: 2020 2020 2020 2020 2062 7566 2e73 6565           buf.see
+0001ce50: 6b28 3029 0a20 2020 2020 2020 2020 2020  k(0).           
+0001ce60: 2020 2020 2077 6974 6820 7069 636b 6c65       with pickle
+0001ce70: 2e6c 6f61 6428 6275 6629 2061 7320 746d  .load(buf) as tm
+0001ce80: 703a 0a20 2020 2020 2020 2020 2020 2020  p:.             
+0001ce90: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+0001cea0: 7261 795f 6571 7561 6c28 746d 702c 2061  ray_equal(tmp, a
+0001ceb0: 6e6f 6e5f 6172 290a 0a20 2020 2020 2020  non_ar)..       
+0001cec0: 2023 2073 6574 2073 7562 6172 7261 7920   # set subarray 
+0001ced0: 6f6e 206d 756c 7469 2d61 7474 7269 6275  on multi-attribu
+0001cee0: 7465 0a20 2020 2020 2020 2072 616e 6765  te.        range
+0001cef0: 5f61 7220 3d20 6e70 2e61 7261 6e67 6528  _ar = np.arange(
+0001cf00: 302c 2039 292e 7265 7368 6170 6528 332c  0, 9).reshape(3,
+0001cf10: 2033 290a 2020 2020 2020 2020 7769 7468   3).        with
+0001cf20: 2074 696c 6564 622e 4465 6e73 6541 7272   tiledb.DenseArr
+0001cf30: 6179 2875 7269 2c20 2277 222c 2061 7474  ay(uri, "w", att
+0001cf40: 723d 226e 616d 6564 2229 2061 7320 565f  r="named") as V_
+0001cf50: 6e61 6d65 643a 0a20 2020 2020 2020 2020  named:.         
+0001cf60: 2020 2056 5f6e 616d 6564 5b31 3a33 2c20     V_named[1:3, 
+0001cf70: 313a 335d 203d 2072 616e 6765 5f61 725b  1:3] = range_ar[
+0001cf80: 313a 332c 2031 3a33 5d0a 0a20 2020 2020  1:3, 1:3]..     
+0001cf90: 2020 2077 6974 6820 7469 6c65 6462 2e44     with tiledb.D
+0001cfa0: 656e 7365 4172 7261 7928 7572 692c 2022  enseArray(uri, "
+0001cfb0: 7222 2c20 6174 7472 3d22 6e61 6d65 6422  r", attr="named"
+0001cfc0: 2920 6173 2056 5f6e 616d 6564 3a0a 2020  ) as V_named:.  
+0001cfd0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0001cfe0: 5f61 7272 6179 5f65 7175 616c 2856 5f6e  _array_equal(V_n
+0001cff0: 616d 6564 5b31 3a33 2c20 313a 335d 2c20  amed[1:3, 1:3], 
+0001d000: 7261 6e67 655f 6172 5b31 3a33 2c20 313a  range_ar[1:3, 1:
+0001d010: 335d 290a 0a0a 636c 6173 7320 5257 5465  3])...class RWTe
+0001d020: 7374 2844 6973 6b54 6573 7443 6173 6529  st(DiskTestCase)
+0001d030: 3a0a 2020 2020 6465 6620 7465 7374 5f72  :.    def test_r
+0001d040: 6561 645f 7772 6974 6528 7365 6c66 2c20  ead_write(self, 
+0001d050: 6361 7066 6429 3a0a 2020 2020 2020 2020  capfd):.        
+0001d060: 646f 6d20 3d20 7469 6c65 6462 2e44 6f6d  dom = tiledb.Dom
+0001d070: 6169 6e28 7469 6c65 6462 2e44 696d 2864  ain(tiledb.Dim(d
+0001d080: 6f6d 6169 6e3d 2830 2c20 3229 2c20 7469  omain=(0, 2), ti
+0001d090: 6c65 3d33 2929 0a20 2020 2020 2020 2061  le=3)).        a
+0001d0a0: 7474 203d 2074 696c 6564 622e 4174 7472  tt = tiledb.Attr
+0001d0b0: 2864 7479 7065 3d22 696e 7436 3422 290a  (dtype="int64").
+0001d0c0: 2020 2020 2020 2020 7363 6865 6d61 203d          schema =
+0001d0d0: 2074 696c 6564 622e 4172 7261 7953 6368   tiledb.ArraySch
+0001d0e0: 656d 6128 646f 6d61 696e 3d64 6f6d 2c20  ema(domain=dom, 
+0001d0f0: 6174 7472 733d 2861 7474 2c29 290a 2020  attrs=(att,)).  
+0001d100: 2020 2020 2020 7469 6c65 6462 2e6c 6962        tiledb.lib
+0001d110: 7469 6c65 6462 2e41 7272 6179 2e63 7265  tiledb.Array.cre
+0001d120: 6174 6528 7365 6c66 2e70 6174 6828 2266  ate(self.path("f
+0001d130: 6f6f 2229 2c20 7363 6865 6d61 290a 0a20  oo"), schema).. 
+0001d140: 2020 2020 2020 206e 705f 6172 7261 7920         np_array 
+0001d150: 3d20 6e70 2e61 7272 6179 285b 312c 2032  = np.array([1, 2
+0001d160: 2c20 335d 2c20 6474 7970 653d 2269 6e74  , 3], dtype="int
+0001d170: 3634 2229 0a0a 2020 2020 2020 2020 7769  64")..        wi
+0001d180: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
+0001d190: 7272 6179 2873 656c 662e 7061 7468 2822  rray(self.path("
+0001d1a0: 666f 6f22 292c 206d 6f64 653d 2277 2229  foo"), mode="w")
+0001d1b0: 2061 7320 6172 723a 0a20 2020 2020 2020   as arr:.       
+0001d1c0: 2020 2020 2061 7272 2e77 7269 7465 5f64       arr.write_d
+0001d1d0: 6972 6563 7428 6e70 5f61 7272 6179 290a  irect(np_array).
+0001d1e0: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
+0001d1f0: 6c65 6462 2e44 656e 7365 4172 7261 7928  ledb.DenseArray(
+0001d200: 7365 6c66 2e70 6174 6828 2266 6f6f 2229  self.path("foo")
+0001d210: 2c20 6d6f 6465 3d22 7222 2920 6173 2061  , mode="r") as a
+0001d220: 7272 3a0a 2020 2020 2020 2020 2020 2020  rr:.            
+0001d230: 6172 722e 6475 6d70 2829 0a0a 2020 2020  arr.dump()..    
+0001d240: 2020 2020 2020 2020 6173 7365 7274 5f63          assert_c
+0001d250: 6170 7475 7265 6428 6361 7066 642c 2022  aptured(capfd, "
+0001d260: 4172 7261 7920 7479 7065 3a20 6465 6e73  Array type: dens
+0001d270: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
+0001d280: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0001d290: 2861 7272 2e6e 6f6e 656d 7074 795f 646f  (arr.nonempty_do
+0001d2a0: 6d61 696e 2829 2c20 2828 302c 2032 292c  main(), ((0, 2),
+0001d2b0: 2929 0a20 2020 2020 2020 2020 2020 2073  )).            s
+0001d2c0: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0001d2d0: 6172 722e 6e64 696d 2c20 6e70 5f61 7272  arr.ndim, np_arr
+0001d2e0: 6179 2e6e 6469 6d29 0a20 2020 2020 2020  ay.ndim).       
+0001d2f0: 2020 2020 2061 7373 6572 745f 6172 7261       assert_arra
+0001d300: 795f 6571 7561 6c28 6172 722e 7265 6164  y_equal(arr.read
+0001d310: 5f64 6972 6563 7428 292c 206e 705f 6172  _direct(), np_ar
+0001d320: 7261 7929 0a0a 0a63 6c61 7373 2054 6573  ray)...class Tes
+0001d330: 744e 756d 7079 546f 4172 7261 7928 4469  tNumpyToArray(Di
+0001d340: 736b 5465 7374 4361 7365 293a 0a20 2020  skTestCase):.   
+0001d350: 2064 6566 2074 6573 745f 746f 5f61 7272   def test_to_arr
+0001d360: 6179 3064 2873 656c 6629 3a0a 2020 2020  ay0d(self):.    
+0001d370: 2020 2020 2320 4361 6e6e 6f74 2063 7265      # Cannot cre
+0001d380: 6174 6520 302d 6469 6d20 6172 7261 7973  ate 0-dim arrays
+0001d390: 2069 6e20 5469 6c65 4442 0a20 2020 2020   in TileDB.     
+0001d3a0: 2020 206e 705f 6172 7261 7920 3d20 6e70     np_array = np
+0001d3b0: 2e61 7272 6179 2831 290a 2020 2020 2020  .array(1).      
+0001d3c0: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
+0001d3d0: 7274 5261 6973 6573 2874 696c 6564 622e  rtRaises(tiledb.
+0001d3e0: 5469 6c65 4442 4572 726f 7229 3a0a 2020  TileDBError):.  
+0001d3f0: 2020 2020 2020 2020 2020 7769 7468 2074            with t
+0001d400: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
+0001d410: 2e66 726f 6d5f 6e75 6d70 7928 7365 6c66  .from_numpy(self
+0001d420: 2e70 6174 6828 2266 6f6f 2229 2c20 6e70  .path("foo"), np
+0001d430: 5f61 7272 6179 2920 6173 2041 3a0a 2020  _array) as A:.  
+0001d440: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0001d450: 7373 0a0a 2020 2020 6465 6620 7465 7374  ss..    def test
+0001d460: 5f74 6f5f 6172 7261 7931 6428 7365 6c66  _to_array1d(self
+0001d470: 293a 0a20 2020 2020 2020 206e 705f 6172  ):.        np_ar
+0001d480: 7261 7920 3d20 6e70 2e61 7272 6179 285b  ray = np.array([
+0001d490: 312e 302c 2032 2e30 2c20 332e 305d 290a  1.0, 2.0, 3.0]).
+0001d4a0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
+0001d4b0: 6564 622e 4465 6e73 6541 7272 6179 2e66  edb.DenseArray.f
+0001d4c0: 726f 6d5f 6e75 6d70 7928 7365 6c66 2e70  rom_numpy(self.p
+0001d4d0: 6174 6828 2266 6f6f 2229 2c20 6e70 5f61  ath("foo"), np_a
+0001d4e0: 7272 6179 2920 6173 2061 7272 3a0a 2020  rray) as arr:.  
+0001d4f0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0001d500: 5f61 7272 6179 5f65 7175 616c 2861 7272  _array_equal(arr
+0001d510: 5b3a 5d2c 206e 705f 6172 7261 7929 0a0a  [:], np_array)..
+0001d520: 2020 2020 6465 6620 7465 7374 5f74 6f5f      def test_to_
+0001d530: 6172 7261 7932 6428 7365 6c66 293a 0a20  array2d(self):. 
+0001d540: 2020 2020 2020 206e 705f 6172 7261 7920         np_array 
+0001d550: 3d20 6e70 2e6f 6e65 7328 2831 3030 2c20  = np.ones((100, 
+0001d560: 3130 3029 2c20 6474 7970 653d 2269 3822  100), dtype="i8"
+0001d570: 290a 2020 2020 2020 2020 7769 7468 2074  ).        with t
+0001d580: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
+0001d590: 2e66 726f 6d5f 6e75 6d70 7928 7365 6c66  .from_numpy(self
+0001d5a0: 2e70 6174 6828 2266 6f6f 2229 2c20 6e70  .path("foo"), np
+0001d5b0: 5f61 7272 6179 2920 6173 2061 7272 3a0a  _array) as arr:.
+0001d5c0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+0001d5d0: 7274 5f61 7272 6179 5f65 7175 616c 2861  rt_array_equal(a
+0001d5e0: 7272 5b3a 5d2c 206e 705f 6172 7261 7929  rr[:], np_array)
+0001d5f0: 0a0a 2020 2020 6465 6620 7465 7374 5f74  ..    def test_t
+0001d600: 6f5f 6172 7261 7933 6428 7365 6c66 293a  o_array3d(self):
+0001d610: 0a20 2020 2020 2020 206e 705f 6172 7261  .        np_arra
+0001d620: 7920 3d20 6e70 2e6f 6e65 7328 2831 2c20  y = np.ones((1, 
+0001d630: 312c 2031 292c 2064 7479 7065 3d22 6931  1, 1), dtype="i1
+0001d640: 2229 0a20 2020 2020 2020 2077 6974 6820  ").        with 
+0001d650: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
+0001d660: 792e 6672 6f6d 5f6e 756d 7079 2873 656c  y.from_numpy(sel
+0001d670: 662e 7061 7468 2822 666f 6f22 292c 206e  f.path("foo"), n
+0001d680: 705f 6172 7261 7929 2061 7320 6172 723a  p_array) as arr:
+0001d690: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+0001d6a0: 6572 745f 6172 7261 795f 6571 7561 6c28  ert_array_equal(
+0001d6b0: 6172 725b 3a5d 2c20 6e70 5f61 7272 6179  arr[:], np_array
+0001d6c0: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0001d6d0: 6279 7465 735f 746f 5f61 7272 6179 3164  bytes_to_array1d
+0001d6e0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001d6f0: 6e70 5f61 7272 6179 203d 206e 702e 6172  np_array = np.ar
+0001d700: 7261 7928 0a20 2020 2020 2020 2020 2020  ray(.           
+0001d710: 205b 6222 6162 6364 6566 222c 2062 2267   [b"abcdef", b"g
+0001d720: 6822 2c20 6222 696a 6b6c 222c 2062 226d  h", b"ijkl", b"m
+0001d730: 6e6f 7071 7273 222c 2062 2222 2c20 6222  nopqrs", b"", b"
+0001d740: 3132 3334 3534 356c 6b6a 616c 7364 666a  1234545lkjalsdfj
+0001d750: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+0001d760: 6474 7970 653d 6f62 6a65 6374 2c0a 2020  dtype=object,.  
+0001d770: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001d780: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
+0001d790: 6541 7272 6179 2e66 726f 6d5f 6e75 6d70  eArray.from_nump
+0001d7a0: 7928 7365 6c66 2e70 6174 6828 2266 6f6f  y(self.path("foo
+0001d7b0: 2229 2c20 6e70 5f61 7272 6179 2920 6173  "), np_array) as
+0001d7c0: 2061 7272 3a0a 2020 2020 2020 2020 2020   arr:.          
+0001d7d0: 2020 6173 7365 7274 5f61 7272 6179 5f65    assert_array_e
+0001d7e0: 7175 616c 2861 7272 5b3a 5d2c 206e 705f  qual(arr[:], np_
+0001d7f0: 6172 7261 7929 0a0a 2020 2020 2020 2020  array)..        
+0001d800: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
+0001d810: 6541 7272 6179 2873 656c 662e 7061 7468  eArray(self.path
+0001d820: 2822 666f 6f22 2929 2061 7320 6172 725f  ("foo")) as arr_
+0001d830: 7265 6c6f 6164 3a0a 2020 2020 2020 2020  reload:.        
+0001d840: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
+0001d850: 5f65 7175 616c 2861 7272 5f72 656c 6f61  _equal(arr_reloa
+0001d860: 645b 3a5d 2c20 6e70 5f61 7272 6179 290a  d[:], np_array).
+0001d870: 0a20 2020 2064 6566 2074 6573 745f 756e  .    def test_un
+0001d880: 6963 6f64 655f 746f 5f61 7272 6179 3164  icode_to_array1d
+0001d890: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001d8a0: 6e70 5f61 7272 6179 203d 206e 702e 6172  np_array = np.ar
+0001d8b0: 7261 7928 0a20 2020 2020 2020 2020 2020  ray(.           
+0001d8c0: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+0001d8d0: 2020 2022 3132 3334 3534 356c 6b6a 616c     "1234545lkjal
+0001d8e0: 7364 666a 222c 0a20 2020 2020 2020 2020  sdfj",.         
+0001d8f0: 2020 2020 2020 2022 6d6e 6f70 7172 7322         "mnopqrs"
+0001d900: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001d910: 2020 2269 6a6b 6c22 2c0a 2020 2020 2020    "ijkl",.      
+0001d920: 2020 2020 2020 2020 2020 2267 6822 2c0a            "gh",.
+0001d930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d940: 2261 6263 6465 6622 2c0a 2020 2020 2020  "abcdef",.      
+0001d950: 2020 2020 2020 2020 2020 2261 ceb1 62ce            "a..b.
+0001d960: b2ce b263 ceb3 ceb3 ceb3 64ce b4ce b4ce  ...c......d.....
+0001d970: b4ce b422 2c0a 2020 2020 2020 2020 2020  ...",.          
+0001d980: 2020 2020 2020 2222 2c0a 2020 2020 2020        "",.      
+0001d990: 2020 2020 2020 2020 2020 2722 61ce b162            '"a..b
+0001d9a0: ceb2 ceb2 6327 2c0a 2020 2020 2020 2020  ....c',.        
+0001d9b0: 2020 2020 2020 2020 2222 2c0a 2020 2020          "",.    
+0001d9c0: 2020 2020 2020 2020 2020 2020 22ce b3ce              "...
+0001d9d0: b3ce b364 ceb4 ceb4 ceb4 ceb4 222c 0a20  ...d........",. 
+0001d9e0: 2020 2020 2020 2020 2020 205d 2c0a 2020             ],.  
+0001d9f0: 2020 2020 2020 2020 2020 6474 7970 653d            dtype=
+0001da00: 6f62 6a65 6374 2c0a 2020 2020 2020 2020  object,.        
+0001da10: 290a 2020 2020 2020 2020 7769 7468 2074  ).        with t
+0001da20: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
+0001da30: 2e66 726f 6d5f 6e75 6d70 7928 7365 6c66  .from_numpy(self
+0001da40: 2e70 6174 6828 2266 6f6f 2229 2c20 6e70  .path("foo"), np
+0001da50: 5f61 7272 6179 2920 6173 2061 7272 3a0a  _array) as arr:.
+0001da60: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+0001da70: 7274 5f61 7272 6179 5f65 7175 616c 2861  rt_array_equal(a
+0001da80: 7272 5b3a 5d2c 206e 705f 6172 7261 7929  rr[:], np_array)
+0001da90: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
+0001daa0: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
+0001dab0: 2873 656c 662e 7061 7468 2822 666f 6f22  (self.path("foo"
+0001dac0: 2929 2061 7320 6172 725f 7265 6c6f 6164  )) as arr_reload
+0001dad0: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
+0001dae0: 7365 7274 5f61 7272 6179 5f65 7175 616c  sert_array_equal
+0001daf0: 2861 7272 5f72 656c 6f61 645b 3a5d 2c20  (arr_reload[:], 
+0001db00: 6e70 5f61 7272 6179 290a 0a20 2020 2064  np_array)..    d
+0001db10: 6566 2074 6573 745f 6172 7261 795f 696e  ef test_array_in
+0001db20: 7465 7266 6163 6528 7365 6c66 293a 0a20  terface(self):. 
+0001db30: 2020 2020 2020 2023 2054 6573 7473 2074         # Tests t
+0001db40: 6861 7420 5f5f 6172 7261 795f 5f20 696e  hat __array__ in
+0001db50: 7465 7266 6163 6520 776f 726b 730a 2020  terface works.  
+0001db60: 2020 2020 2020 6e70 5f61 7272 6179 3120        np_array1 
+0001db70: 3d20 6e70 2e61 7261 6e67 6528 312c 2031  = np.arange(1, 1
+0001db80: 3029 0a20 2020 2020 2020 2077 6974 6820  0).        with 
+0001db90: 7469 6c65 6462 2e44 656e 7365 4172 7261  tiledb.DenseArra
+0001dba0: 792e 6672 6f6d 5f6e 756d 7079 2873 656c  y.from_numpy(sel
+0001dbb0: 662e 7061 7468 2822 6172 7231 2229 2c20  f.path("arr1"), 
+0001dbc0: 6e70 5f61 7272 6179 3129 2061 7320 6172  np_array1) as ar
+0001dbd0: 7231 3a0a 2020 2020 2020 2020 2020 2020  r1:.            
+0001dbe0: 6173 7365 7274 5f61 7272 6179 5f65 7175  assert_array_equ
+0001dbf0: 616c 286e 702e 6172 7261 7928 6172 7231  al(np.array(arr1
+0001dc00: 292c 206e 705f 6172 7261 7931 290a 0a20  ), np_array1).. 
+0001dc10: 2020 2020 2020 2023 2054 6573 7420 7468         # Test th
+0001dc20: 6174 205f 5f61 7272 6179 5f5f 2069 6e74  at __array__ int
+0001dc30: 6572 6661 6365 2074 6872 6f77 7320 616e  erface throws an
+0001dc40: 2065 7272 6f72 2077 6865 6e20 6e75 6d62   error when numb
+0001dc50: 6572 206f 6620 6174 7472 6962 7574 6573  er of attributes
+0001dc60: 203e 2031 0a20 2020 2020 2020 2064 6f6d   > 1.        dom
+0001dc70: 203d 2074 696c 6564 622e 446f 6d61 696e   = tiledb.Domain
+0001dc80: 2874 696c 6564 622e 4469 6d28 646f 6d61  (tiledb.Dim(doma
+0001dc90: 696e 3d28 302c 2032 292c 2074 696c 653d  in=(0, 2), tile=
+0001dca0: 3329 290a 2020 2020 2020 2020 666f 6f20  3)).        foo 
+0001dcb0: 3d20 7469 6c65 6462 2e41 7474 7228 2266  = tiledb.Attr("f
+0001dcc0: 6f6f 222c 2064 7479 7065 3d22 6938 2229  oo", dtype="i8")
+0001dcd0: 0a20 2020 2020 2020 2062 6172 203d 2074  .        bar = t
+0001dce0: 696c 6564 622e 4174 7472 2822 6261 7222  iledb.Attr("bar"
+0001dcf0: 2c20 6474 7970 653d 2269 3822 290a 2020  , dtype="i8").  
+0001dd00: 2020 2020 2020 7363 6865 6d61 203d 2074        schema = t
+0001dd10: 696c 6564 622e 4172 7261 7953 6368 656d  iledb.ArraySchem
+0001dd20: 6128 646f 6d61 696e 3d64 6f6d 2c20 6174  a(domain=dom, at
+0001dd30: 7472 733d 2866 6f6f 2c20 6261 7229 290a  trs=(foo, bar)).
+0001dd40: 2020 2020 2020 2020 7469 6c65 6462 2e44          tiledb.D
+0001dd50: 656e 7365 4172 7261 792e 6372 6561 7465  enseArray.create
+0001dd60: 2873 656c 662e 7061 7468 2822 6172 7232  (self.path("arr2
+0001dd70: 2229 2c20 7363 6865 6d61 290a 2020 2020  "), schema).    
+0001dd80: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
+0001dd90: 7365 7274 5261 6973 6573 2856 616c 7565  sertRaises(Value
+0001dda0: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+0001ddb0: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+0001ddc0: 4465 6e73 6541 7272 6179 2873 656c 662e  DenseArray(self.
+0001ddd0: 7061 7468 2822 6172 7232 2229 2c20 6d6f  path("arr2"), mo
+0001dde0: 6465 3d22 7222 2920 6173 2061 7272 323a  de="r") as arr2:
+0001ddf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001de00: 206e 702e 6172 7261 7928 6172 7232 290a   np.array(arr2).
+0001de10: 0a20 2020 2064 6566 2074 6573 745f 6172  .    def test_ar
+0001de20: 7261 795f 6765 7469 6e64 6578 2873 656c  ray_getindex(sel
+0001de30: 6629 3a0a 2020 2020 2020 2020 2320 5465  f):.        # Te
+0001de40: 7374 7320 7468 6174 205f 5f67 6574 696e  sts that __getin
+0001de50: 6465 785f 5f20 696e 7465 7266 6163 6520  dex__ interface 
+0001de60: 776f 726b 730a 2020 2020 2020 2020 6e70  works.        np
+0001de70: 5f61 7272 6179 203d 206e 702e 6172 616e  _array = np.aran
+0001de80: 6765 2831 2c20 3130 290a 2020 2020 2020  ge(1, 10).      
+0001de90: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
+0001dea0: 6e73 6541 7272 6179 2e66 726f 6d5f 6e75  nseArray.from_nu
+0001deb0: 6d70 7928 7365 6c66 2e70 6174 6828 2266  mpy(self.path("f
+0001dec0: 6f6f 2229 2c20 6e70 5f61 7272 6179 2920  oo"), np_array) 
+0001ded0: 6173 2061 7272 3a0a 2020 2020 2020 2020  as arr:.        
+0001dee0: 2020 2020 6173 7365 7274 5f61 7272 6179      assert_array
+0001def0: 5f65 7175 616c 2861 7272 5b35 3a31 305d  _equal(arr[5:10]
+0001df00: 2c20 6e70 5f61 7272 6179 5b35 3a31 305d  , np_array[5:10]
+0001df10: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0001df20: 746f 5f61 7272 6179 3164 5f61 7474 725f  to_array1d_attr_
+0001df30: 6e61 6d65 2873 656c 6629 3a0a 2020 2020  name(self):.    
+0001df40: 2020 2020 6e70 5f61 7272 6179 203d 206e      np_array = n
+0001df50: 702e 6172 7261 7928 5b31 2e30 2c20 322e  p.array([1.0, 2.
+0001df60: 302c 2033 2e30 5d29 0a20 2020 2020 2020  0, 3.0]).       
+0001df70: 2077 6974 6820 7469 6c65 6462 2e44 656e   with tiledb.Den
+0001df80: 7365 4172 7261 792e 6672 6f6d 5f6e 756d  seArray.from_num
+0001df90: 7079 280a 2020 2020 2020 2020 2020 2020  py(.            
+0001dfa0: 7365 6c66 2e70 6174 6828 2266 6f6f 2229  self.path("foo")
+0001dfb0: 2c20 6e70 5f61 7272 6179 2c20 6174 7472  , np_array, attr
+0001dfc0: 5f6e 616d 653d 2261 220a 2020 2020 2020  _name="a".      
+0001dfd0: 2020 2920 6173 2061 7272 3a0a 2020 2020    ) as arr:.    
+0001dfe0: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+0001dff0: 7272 6179 5f65 7175 616c 2861 7272 5b3a  rray_equal(arr[:
+0001e000: 5d5b 2261 225d 2c20 6e70 5f61 7272 6179  ]["a"], np_array
+0001e010: 290a 0a0a 636c 6173 7320 5465 7374 5646  )...class TestVF
+0001e020: 5328 4469 736b 5465 7374 4361 7365 293a  S(DiskTestCase):
+0001e030: 0a20 2020 2064 6566 2074 6573 745f 7375  .    def test_su
+0001e040: 7070 6f72 7473 2873 656c 6629 3a0a 2020  pports(self):.  
+0001e050: 2020 2020 2020 7666 7320 3d20 7469 6c65        vfs = tile
+0001e060: 6462 2e56 4653 2829 0a0a 2020 2020 2020  db.VFS()..      
+0001e070: 2020 7365 6c66 2e61 7373 6572 7454 7275    self.assertTru
+0001e080: 6528 7666 732e 7375 7070 6f72 7473 2822  e(vfs.supports("
+0001e090: 6669 6c65 2229 290a 2020 2020 2020 2020  file")).        
+0001e0a0: 7365 6c66 2e61 7373 6572 7449 7349 6e73  self.assertIsIns
+0001e0b0: 7461 6e63 6528 7666 732e 7375 7070 6f72  tance(vfs.suppor
+0001e0c0: 7473 2822 7333 2229 2c20 626f 6f6c 290a  ts("s3"), bool).
+0001e0d0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0001e0e0: 6572 7449 7349 6e73 7461 6e63 6528 7666  ertIsInstance(vf
+0001e0f0: 732e 7375 7070 6f72 7473 2822 6864 6673  s.supports("hdfs
+0001e100: 2229 2c20 626f 6f6c 290a 2020 2020 2020  "), bool).      
+0001e110: 2020 7365 6c66 2e61 7373 6572 7449 7349    self.assertIsI
+0001e120: 6e73 7461 6e63 6528 7666 732e 7375 7070  nstance(vfs.supp
+0001e130: 6f72 7473 2822 6763 7322 292c 2062 6f6f  orts("gcs"), boo
+0001e140: 6c29 0a20 2020 2020 2020 2073 656c 662e  l).        self.
+0001e150: 6173 7365 7274 4973 496e 7374 616e 6365  assertIsInstance
+0001e160: 2876 6673 2e73 7570 706f 7274 7328 2261  (vfs.supports("a
+0001e170: 7a75 7265 2229 2c20 626f 6f6c 290a 0a20  zure"), bool).. 
+0001e180: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+0001e190: 2e61 7373 6572 7452 6169 7365 7328 5661  .assertRaises(Va
+0001e1a0: 6c75 6545 7272 6f72 293a 0a20 2020 2020  lueError):.     
+0001e1b0: 2020 2020 2020 2076 6673 2e73 7570 706f         vfs.suppo
+0001e1c0: 7274 7328 2269 6e76 616c 6964 2229 0a0a  rts("invalid")..
+0001e1d0: 2020 2020 6465 6620 7465 7374 5f64 6972      def test_dir
+0001e1e0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001e1f0: 7666 7320 3d20 7469 6c65 6462 2e56 4653  vfs = tiledb.VFS
+0001e200: 2829 0a0a 2020 2020 2020 2020 6469 7220  ()..        dir 
+0001e210: 3d20 7365 6c66 2e70 6174 6828 2266 6f6f  = self.path("foo
+0001e220: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+0001e230: 6173 7365 7274 4661 6c73 6528 7666 732e  assertFalse(vfs.
+0001e240: 6973 5f64 6972 2864 6972 2929 0a0a 2020  is_dir(dir))..  
+0001e250: 2020 2020 2020 2320 6372 6561 7465 0a20        # create. 
+0001e260: 2020 2020 2020 2076 6673 2e63 7265 6174         vfs.creat
+0001e270: 655f 6469 7228 6469 7229 0a20 2020 2020  e_dir(dir).     
+0001e280: 2020 2069 6620 7079 7465 7374 2e74 696c     if pytest.til
+0001e290: 6564 625f 7666 7320 213d 2022 7333 223a  edb_vfs != "s3":
+0001e2a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001e2b0: 662e 6173 7365 7274 5472 7565 2876 6673  f.assertTrue(vfs
+0001e2c0: 2e69 735f 6469 7228 6469 7229 290a 0a20  .is_dir(dir)).. 
+0001e2d0: 2020 2020 2020 2023 2072 656d 6f76 650a         # remove.
+0001e2e0: 2020 2020 2020 2020 7666 732e 7265 6d6f          vfs.remo
+0001e2f0: 7665 5f64 6972 2864 6972 290a 2020 2020  ve_dir(dir).    
+0001e300: 2020 2020 7365 6c66 2e61 7373 6572 7446      self.assertF
+0001e310: 616c 7365 2876 6673 2e69 735f 6469 7228  alse(vfs.is_dir(
+0001e320: 6469 7229 290a 0a20 2020 2020 2020 2023  dir))..        #
+0001e330: 2063 7265 6174 6520 6e65 7374 6564 2070   create nested p
+0001e340: 6174 680a 2020 2020 2020 2020 6469 7220  ath.        dir 
+0001e350: 3d20 7365 6c66 2e70 6174 6828 2266 6f6f  = self.path("foo
+0001e360: 2f62 6172 2229 0a20 2020 2020 2020 2069  /bar").        i
+0001e370: 6620 7079 7465 7374 2e74 696c 6564 625f  f pytest.tiledb_
+0001e380: 7666 7320 213d 2022 7333 223a 0a20 2020  vfs != "s3":.   
+0001e390: 2020 2020 2020 2020 2023 2074 6869 7320           # this 
+0001e3a0: 6661 696c 7320 6c6f 6361 6c6c 7920 6265  fails locally be
+0001e3b0: 6361 7573 6520 2266 6f6f 2220 6261 7365  cause "foo" base
+0001e3c0: 2070 6174 6820 646f 6573 206e 6f74 2065   path does not e
+0001e3d0: 7869 7374 0a20 2020 2020 2020 2020 2020  xist.           
+0001e3e0: 2023 2074 6869 7320 7769 6c6c 206e 6f74   # this will not
+0001e3f0: 2066 6169 6c20 6f6e 2073 3320 6265 6361   fail on s3 beca
+0001e400: 7573 6520 7468 6572 6520 6973 206e 6f20  use there is no 
+0001e410: 636f 6e63 6570 7420 6f66 2064 6972 6563  concept of direc
+0001e420: 746f 7279 0a20 2020 2020 2020 2020 2020  tory.           
+0001e430: 2077 6974 6820 7365 6c66 2e61 7373 6572   with self.asser
+0001e440: 7452 6169 7365 7328 7469 6c65 6462 2e54  tRaises(tiledb.T
+0001e450: 696c 6544 4245 7272 6f72 293a 0a20 2020  ileDBError):.   
+0001e460: 2020 2020 2020 2020 2020 2020 2076 6673               vfs
+0001e470: 2e63 7265 6174 655f 6469 7228 6469 7229  .create_dir(dir)
+0001e480: 0a0a 2020 2020 2020 2020 7666 732e 6372  ..        vfs.cr
+0001e490: 6561 7465 5f64 6972 2873 656c 662e 7061  eate_dir(self.pa
+0001e4a0: 7468 2822 666f 6f22 2929 0a20 2020 2020  th("foo")).     
+0001e4b0: 2020 2076 6673 2e63 7265 6174 655f 6469     vfs.create_di
+0001e4c0: 7228 7365 6c66 2e70 6174 6828 2266 6f6f  r(self.path("foo
+0001e4d0: 2f62 6172 2229 290a 2020 2020 2020 2020  /bar")).        
+0001e4e0: 6966 2070 7974 6573 742e 7469 6c65 6462  if pytest.tiledb
+0001e4f0: 5f76 6673 2021 3d20 2273 3322 3a0a 2020  _vfs != "s3":.  
+0001e500: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0001e510: 7373 6572 7454 7275 6528 7666 732e 6973  ssertTrue(vfs.is
+0001e520: 5f64 6972 2864 6972 2929 0a0a 2020 2020  _dir(dir))..    
+0001e530: 6465 6620 7465 7374 5f66 696c 6528 7365  def test_file(se
+0001e540: 6c66 293a 0a20 2020 2020 2020 2076 6673  lf):.        vfs
+0001e550: 203d 2074 696c 6564 622e 5646 5328 290a   = tiledb.VFS().
+0001e560: 0a20 2020 2020 2020 2066 696c 6520 3d20  .        file = 
+0001e570: 7365 6c66 2e70 6174 6828 2266 6f6f 2229  self.path("foo")
+0001e580: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001e590: 7365 7274 4661 6c73 6528 7666 732e 6973  sertFalse(vfs.is
+0001e5a0: 5f66 696c 6528 6669 6c65 2929 0a0a 2020  _file(file))..  
+0001e5b0: 2020 2020 2020 2320 6372 6561 7465 0a20        # create. 
+0001e5c0: 2020 2020 2020 2076 6673 2e74 6f75 6368         vfs.touch
+0001e5d0: 2866 696c 6529 0a20 2020 2020 2020 2073  (file).        s
+0001e5e0: 656c 662e 6173 7365 7274 5472 7565 2876  elf.assertTrue(v
+0001e5f0: 6673 2e69 735f 6669 6c65 2866 696c 6529  fs.is_file(file)
+0001e600: 290a 0a20 2020 2020 2020 2023 2072 656d  )..        # rem
+0001e610: 6f76 650a 2020 2020 2020 2020 7666 732e  ove.        vfs.
+0001e620: 7265 6d6f 7665 5f66 696c 6528 6669 6c65  remove_file(file
+0001e630: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0001e640: 7373 6572 7446 616c 7365 2876 6673 2e69  ssertFalse(vfs.i
+0001e650: 735f 6669 6c65 2866 696c 6529 290a 0a20  s_file(file)).. 
+0001e660: 2020 2020 2020 2023 2063 6865 636b 206e         # check n
+0001e670: 6573 7465 6420 7061 7468 0a20 2020 2020  ested path.     
+0001e680: 2020 2066 696c 6520 3d20 7365 6c66 2e70     file = self.p
+0001e690: 6174 6828 2266 6f6f 2f62 6172 2229 0a20  ath("foo/bar"). 
+0001e6a0: 2020 2020 2020 2069 6620 7079 7465 7374         if pytest
+0001e6b0: 2e74 696c 6564 625f 7666 7320 213d 2022  .tiledb_vfs != "
+0001e6c0: 7333 223a 0a20 2020 2020 2020 2020 2020  s3":.           
+0001e6d0: 2023 2074 6869 7320 6661 696c 7320 6c6f   # this fails lo
+0001e6e0: 6361 6c6c 7920 6265 6361 7573 6520 2266  cally because "f
+0001e6f0: 6f6f 2220 6261 7365 2070 6174 6820 646f  oo" base path do
+0001e700: 6573 206e 6f74 2065 7869 7374 0a20 2020  es not exist.   
+0001e710: 2020 2020 2020 2020 2023 2074 6869 7320           # this 
+0001e720: 7769 6c6c 206e 6f74 2066 6169 6c20 6f6e  will not fail on
+0001e730: 2073 3320 6265 6361 7573 6520 7468 6572   s3 because ther
+0001e740: 6520 6973 206e 6f20 636f 6e63 6570 7420  e is no concept 
+0001e750: 6f66 2064 6972 6563 746f 7279 0a20 2020  of directory.   
+0001e760: 2020 2020 2020 2020 2077 6974 6820 7365           with se
+0001e770: 6c66 2e61 7373 6572 7452 6169 7365 7328  lf.assertRaises(
+0001e780: 7469 6c65 6462 2e54 696c 6544 4245 7272  tiledb.TileDBErr
+0001e790: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+0001e7a0: 2020 2020 2076 6673 2e74 6f75 6368 2866       vfs.touch(f
+0001e7b0: 696c 6529 0a0a 2020 2020 6465 6620 7465  ile)..    def te
+0001e7c0: 7374 5f6d 6f76 6528 7365 6c66 293a 0a20  st_move(self):. 
+0001e7d0: 2020 2020 2020 2076 6673 203d 2074 696c         vfs = til
+0001e7e0: 6564 622e 5646 5328 290a 0a20 2020 2020  edb.VFS()..     
+0001e7f0: 2020 2076 6673 2e63 7265 6174 655f 6469     vfs.create_di
+0001e800: 7228 7365 6c66 2e70 6174 6828 2266 6f6f  r(self.path("foo
+0001e810: 2229 290a 2020 2020 2020 2020 7666 732e  ")).        vfs.
+0001e820: 6372 6561 7465 5f64 6972 2873 656c 662e  create_dir(self.
+0001e830: 7061 7468 2822 6261 7222 2929 0a20 2020  path("bar")).   
+0001e840: 2020 2020 2076 6673 2e74 6f75 6368 2873       vfs.touch(s
+0001e850: 656c 662e 7061 7468 2822 6261 722f 6261  elf.path("bar/ba
+0001e860: 7a22 2929 0a0a 2020 2020 2020 2020 7365  z"))..        se
+0001e870: 6c66 2e61 7373 6572 7454 7275 6528 7666  lf.assertTrue(vf
+0001e880: 732e 6973 5f66 696c 6528 7365 6c66 2e70  s.is_file(self.p
+0001e890: 6174 6828 2262 6172 2f62 617a 2229 2929  ath("bar/baz")))
+0001e8a0: 0a0a 2020 2020 2020 2020 7666 732e 6d6f  ..        vfs.mo
+0001e8b0: 7665 5f66 696c 6528 7365 6c66 2e70 6174  ve_file(self.pat
+0001e8c0: 6828 2262 6172 2f62 617a 2229 2c20 7365  h("bar/baz"), se
+0001e8d0: 6c66 2e70 6174 6828 2266 6f6f 2f62 617a  lf.path("foo/baz
+0001e8e0: 2229 290a 0a20 2020 2020 2020 2073 656c  "))..        sel
+0001e8f0: 662e 6173 7365 7274 4661 6c73 6528 7666  f.assertFalse(vf
+0001e900: 732e 6973 5f66 696c 6528 7365 6c66 2e70  s.is_file(self.p
+0001e910: 6174 6828 2262 6172 2f62 617a 2229 2929  ath("bar/baz")))
+0001e920: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001e930: 7365 7274 5472 7565 2876 6673 2e69 735f  sertTrue(vfs.is_
+0001e940: 6669 6c65 2873 656c 662e 7061 7468 2822  file(self.path("
+0001e950: 666f 6f2f 6261 7a22 2929 290a 0a20 2020  foo/baz")))..   
+0001e960: 2020 2020 2023 206d 6f76 696e 6720 746f       # moving to
+0001e970: 2069 6e76 616c 6964 2064 6972 2073 686f   invalid dir sho
+0001e980: 756c 6420 7261 6973 6520 616e 2065 7272  uld raise an err
+0001e990: 6f72 0a20 2020 2020 2020 2069 6620 7079  or.        if py
+0001e9a0: 7465 7374 2e74 696c 6564 625f 7666 7320  test.tiledb_vfs 
+0001e9b0: 213d 2022 7333 223a 0a20 2020 2020 2020  != "s3":.       
+0001e9c0: 2020 2020 2023 2074 6869 7320 6661 696c       # this fail
+0001e9d0: 7320 6c6f 6361 6c6c 7920 6265 6361 7573  s locally becaus
+0001e9e0: 6520 2266 6f6f 2220 6261 7365 2070 6174  e "foo" base pat
+0001e9f0: 6820 646f 6573 206e 6f74 2065 7869 7374  h does not exist
+0001ea00: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
+0001ea10: 6869 7320 7769 6c6c 206e 6f74 2066 6169  his will not fai
+0001ea20: 6c20 6f6e 2073 3320 6265 6361 7573 6520  l on s3 because 
+0001ea30: 7468 6572 6520 6973 206e 6f20 636f 6e63  there is no conc
+0001ea40: 6570 7420 6f66 2064 6972 6563 746f 7279  ept of directory
+0001ea50: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0001ea60: 6820 7365 6c66 2e61 7373 6572 7452 6169  h self.assertRai
+0001ea70: 7365 7328 7469 6c65 6462 2e54 696c 6544  ses(tiledb.TileD
+0001ea80: 4245 7272 6f72 293a 0a20 2020 2020 2020  BError):.       
+0001ea90: 2020 2020 2020 2020 2076 6673 2e6d 6f76           vfs.mov
+0001eaa0: 655f 6469 7228 7365 6c66 2e70 6174 6828  e_dir(self.path(
+0001eab0: 2266 6f6f 2f62 617a 2229 2c20 7365 6c66  "foo/baz"), self
+0001eac0: 2e70 6174 6828 2264 6f5f 6e6f 745f 6578  .path("do_not_ex
+0001ead0: 6973 742f 6261 7a22 2929 0a0a 2020 2020  ist/baz"))..    
+0001eae0: 4070 7974 6573 742e 6d61 726b 2e73 6b69  @pytest.mark.ski
+0001eaf0: 7069 6628 0a20 2020 2020 2020 2073 7973  pif(.        sys
+0001eb00: 2e70 6c61 7466 6f72 6d20 3d3d 2022 7769  .platform == "wi
+0001eb10: 6e33 3222 2c0a 2020 2020 2020 2020 7265  n32",.        re
+0001eb20: 6173 6f6e 3d22 5646 5320 636f 7079 2063  ason="VFS copy c
+0001eb30: 6f6d 6d61 6e64 7320 6672 6f6d 2063 6f72  ommands from cor
+0001eb40: 6520 6172 6520 6e6f 7420 7375 7070 6f72  e are not suppor
+0001eb50: 7465 6420 6f6e 2057 696e 646f 7773 222c  ted on Windows",
+0001eb60: 0a20 2020 2029 0a20 2020 2064 6566 2074  .    ).    def t
+0001eb70: 6573 745f 636f 7079 2873 656c 6629 3a0a  est_copy(self):.
+0001eb80: 2020 2020 2020 2020 7666 7320 3d20 7469          vfs = ti
+0001eb90: 6c65 6462 2e56 4653 2829 0a0a 2020 2020  ledb.VFS()..    
+0001eba0: 2020 2020 7666 732e 6372 6561 7465 5f64      vfs.create_d
+0001ebb0: 6972 2873 656c 662e 7061 7468 2822 666f  ir(self.path("fo
+0001ebc0: 6f22 2929 0a20 2020 2020 2020 2076 6673  o")).        vfs
+0001ebd0: 2e63 7265 6174 655f 6469 7228 7365 6c66  .create_dir(self
+0001ebe0: 2e70 6174 6828 2262 6172 2229 290a 2020  .path("bar")).  
+0001ebf0: 2020 2020 2020 7666 732e 746f 7563 6828        vfs.touch(
+0001ec00: 7365 6c66 2e70 6174 6828 2266 6f6f 2f62  self.path("foo/b
+0001ec10: 617a 2229 290a 0a20 2020 2020 2020 2073  az"))..        s
+0001ec20: 656c 662e 6173 7365 7274 5472 7565 2876  elf.assertTrue(v
+0001ec30: 6673 2e69 735f 6669 6c65 2873 656c 662e  fs.is_file(self.
+0001ec40: 7061 7468 2822 666f 6f2f 6261 7a22 2929  path("foo/baz"))
+0001ec50: 290a 0a20 2020 2020 2020 2076 6673 2e63  )..        vfs.c
+0001ec60: 6f70 795f 6669 6c65 2873 656c 662e 7061  opy_file(self.pa
+0001ec70: 7468 2822 666f 6f2f 6261 7a22 292c 2073  th("foo/baz"), s
+0001ec80: 656c 662e 7061 7468 2822 6261 722f 6261  elf.path("bar/ba
+0001ec90: 7a22 2929 0a0a 2020 2020 2020 2020 7365  z"))..        se
+0001eca0: 6c66 2e61 7373 6572 7454 7275 6528 7666  lf.assertTrue(vf
+0001ecb0: 732e 6973 5f66 696c 6528 7365 6c66 2e70  s.is_file(self.p
+0001ecc0: 6174 6828 2266 6f6f 2f62 617a 2229 2929  ath("foo/baz")))
+0001ecd0: 0a20 2020 2020 2020 2073 656c 662e 6173  .        self.as
+0001ece0: 7365 7274 5472 7565 2876 6673 2e69 735f  sertTrue(vfs.is_
+0001ecf0: 6669 6c65 2873 656c 662e 7061 7468 2822  file(self.path("
+0001ed00: 6261 722f 6261 7a22 2929 290a 0a20 2020  bar/baz")))..   
+0001ed10: 2020 2020 2076 6673 2e63 6f70 795f 6469       vfs.copy_di
+0001ed20: 7228 7365 6c66 2e70 6174 6828 2266 6f6f  r(self.path("foo
+0001ed30: 2229 2c20 7365 6c66 2e70 6174 6828 2262  "), self.path("b
+0001ed40: 617a 2229 290a 0a20 2020 2020 2020 2073  az"))..        s
+0001ed50: 656c 662e 6173 7365 7274 5472 7565 2876  elf.assertTrue(v
+0001ed60: 6673 2e69 735f 6669 6c65 2873 656c 662e  fs.is_file(self.
+0001ed70: 7061 7468 2822 6261 7a2f 6261 7a22 2929  path("baz/baz"))
+0001ed80: 290a 0a20 2020 2020 2020 2023 2063 6f70  )..        # cop
+0001ed90: 7969 6e67 2074 6f20 696e 7661 6c69 6420  ying to invalid 
+0001eda0: 6469 7220 7368 6f75 6c64 2072 6169 7365  dir should raise
+0001edb0: 2061 6e20 6572 726f 720a 2020 2020 2020   an error.      
+0001edc0: 2020 6966 2070 7974 6573 742e 7469 6c65    if pytest.tile
+0001edd0: 6462 5f76 6673 2021 3d20 2273 3322 3a0a  db_vfs != "s3":.
+0001ede0: 2020 2020 2020 2020 2020 2020 2320 7468              # th
+0001edf0: 6973 2066 6169 6c73 206c 6f63 616c 6c79  is fails locally
+0001ee00: 2062 6563 6175 7365 2022 666f 6f22 2062   because "foo" b
+0001ee10: 6173 6520 7061 7468 2064 6f65 7320 6e6f  ase path does no
+0001ee20: 7420 6578 6973 740a 2020 2020 2020 2020  t exist.        
+0001ee30: 2020 2020 2320 7468 6973 2077 696c 6c20      # this will 
+0001ee40: 6e6f 7420 6661 696c 206f 6e20 7333 2062  not fail on s3 b
+0001ee50: 6563 6175 7365 2074 6865 7265 2069 7320  ecause there is 
+0001ee60: 6e6f 2063 6f6e 6365 7074 206f 6620 6469  no concept of di
+0001ee70: 7265 6374 6f72 790a 2020 2020 2020 2020  rectory.        
+0001ee80: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
+0001ee90: 7365 7274 5261 6973 6573 2874 696c 6564  sertRaises(tiled
+0001eea0: 622e 5469 6c65 4442 4572 726f 7229 3a0a  b.TileDBError):.
+0001eeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eec0: 7666 732e 636f 7079 5f64 6972 2873 656c  vfs.copy_dir(sel
+0001eed0: 662e 7061 7468 2822 666f 6f2f 6261 7a22  f.path("foo/baz"
+0001eee0: 292c 2073 656c 662e 7061 7468 2822 646f  ), self.path("do
+0001eef0: 5f6e 6f74 5f65 7869 7374 2f62 617a 2229  _not_exist/baz")
+0001ef00: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+0001ef10: 7772 6974 655f 7265 6164 2873 656c 6629  write_read(self)
+0001ef20: 3a0a 2020 2020 2020 2020 7666 7320 3d20  :.        vfs = 
+0001ef30: 7469 6c65 6462 2e56 4653 2829 0a0a 2020  tiledb.VFS()..  
+0001ef40: 2020 2020 2020 6275 6666 6572 203d 2062        buffer = b
+0001ef50: 2262 6172 220a 2020 2020 2020 2020 6668  "bar".        fh
+0001ef60: 203d 2076 6673 2e6f 7065 6e28 7365 6c66   = vfs.open(self
+0001ef70: 2e70 6174 6828 2266 6f6f 2229 2c20 2277  .path("foo"), "w
+0001ef80: 6222 290a 2020 2020 2020 2020 7666 732e  b").        vfs.
+0001ef90: 7772 6974 6528 6668 2c20 6275 6666 6572  write(fh, buffer
+0001efa0: 290a 2020 2020 2020 2020 7666 732e 636c  ).        vfs.cl
+0001efb0: 6f73 6528 6668 290a 2020 2020 2020 2020  ose(fh).        
+0001efc0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0001efd0: 2876 6673 2e66 696c 655f 7369 7a65 2873  (vfs.file_size(s
+0001efe0: 656c 662e 7061 7468 2822 666f 6f22 2929  elf.path("foo"))
+0001eff0: 2c20 3329 0a0a 2020 2020 2020 2020 6668  , 3)..        fh
+0001f000: 203d 2076 6673 2e6f 7065 6e28 7365 6c66   = vfs.open(self
+0001f010: 2e70 6174 6828 2266 6f6f 2229 2c20 2272  .path("foo"), "r
+0001f020: 6222 290a 2020 2020 2020 2020 7365 6c66  b").        self
+0001f030: 2e61 7373 6572 7445 7175 616c 2876 6673  .assertEqual(vfs
+0001f040: 2e72 6561 6428 6668 2c20 302c 2033 292c  .read(fh, 0, 3),
+0001f050: 2062 7566 6665 7229 0a20 2020 2020 2020   buffer).       
+0001f060: 2076 6673 2e63 6c6f 7365 2866 6829 0a0a   vfs.close(fh)..
+0001f070: 2020 2020 2020 2020 2320 7772 6974 6520          # write 
+0001f080: 2f20 7265 6164 2065 6d70 7479 2069 6e70  / read empty inp
+0001f090: 7574 0a20 2020 2020 2020 2066 6820 3d20  ut.        fh = 
+0001f0a0: 7666 732e 6f70 656e 2873 656c 662e 7061  vfs.open(self.pa
+0001f0b0: 7468 2822 6261 7a22 292c 2022 7762 2229  th("baz"), "wb")
+0001f0c0: 0a20 2020 2020 2020 2076 6673 2e77 7269  .        vfs.wri
+0001f0d0: 7465 2866 682c 2062 2222 290a 2020 2020  te(fh, b"").    
+0001f0e0: 2020 2020 7666 732e 636c 6f73 6528 6668      vfs.close(fh
+0001f0f0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0001f100: 7373 6572 7445 7175 616c 2876 6673 2e66  ssertEqual(vfs.f
+0001f110: 696c 655f 7369 7a65 2873 656c 662e 7061  ile_size(self.pa
+0001f120: 7468 2822 6261 7a22 2929 2c20 3029 0a0a  th("baz")), 0)..
+0001f130: 2020 2020 2020 2020 6668 203d 2076 6673          fh = vfs
+0001f140: 2e6f 7065 6e28 7365 6c66 2e70 6174 6828  .open(self.path(
+0001f150: 2262 617a 2229 2c20 2272 6222 290a 2020  "baz"), "rb").  
+0001f160: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001f170: 7445 7175 616c 2876 6673 2e72 6561 6428  tEqual(vfs.read(
+0001f180: 6668 2c20 302c 2030 292c 2062 2222 290a  fh, 0, 0), b"").
+0001f190: 2020 2020 2020 2020 7666 732e 636c 6f73          vfs.clos
+0001f1a0: 6528 6668 290a 0a20 2020 2020 2020 2023  e(fh)..        #
+0001f1b0: 2072 6561 6420 6672 6f6d 2066 696c 6520   read from file 
+0001f1c0: 7468 6174 2064 6f65 7320 6e6f 7420 6578  that does not ex
+0001f1d0: 6973 740a 2020 2020 2020 2020 7769 7468  ist.        with
+0001f1e0: 2073 656c 662e 6173 7365 7274 5261 6973   self.assertRais
+0001f1f0: 6573 2874 696c 6564 622e 5469 6c65 4442  es(tiledb.TileDB
+0001f200: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+0001f210: 2020 2020 7666 732e 6f70 656e 2873 656c      vfs.open(sel
+0001f220: 662e 7061 7468 2822 646f 5f6e 6f74 5f65  f.path("do_not_e
+0001f230: 7869 7374 2229 2c20 2272 6222 290a 0a20  xist"), "rb").. 
+0001f240: 2020 2064 6566 2074 6573 745f 696f 2873     def test_io(s
+0001f250: 656c 6629 3a0a 2020 2020 2020 2020 7666  elf):.        vf
+0001f260: 7320 3d20 7469 6c65 6462 2e56 4653 2829  s = tiledb.VFS()
+0001f270: 0a0a 2020 2020 2020 2020 6275 6666 6572  ..        buffer
+0001f280: 203d 2062 2230 3132 3334 3536 3738 3922   = b"0123456789"
+0001f290: 0a20 2020 2020 2020 2077 6974 6820 7469  .        with ti
+0001f2a0: 6c65 6462 2e46 696c 6549 4f28 7666 732c  ledb.FileIO(vfs,
+0001f2b0: 2073 656c 662e 7061 7468 2822 666f 6f22   self.path("foo"
+0001f2c0: 292c 206d 6f64 653d 2277 6222 2920 6173  ), mode="wb") as
+0001f2d0: 2066 696f 3a0a 2020 2020 2020 2020 2020   fio:.          
+0001f2e0: 2020 6669 6f2e 7772 6974 6528 6275 6666    fio.write(buff
+0001f2f0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+0001f300: 6669 6f2e 666c 7573 6828 290a 2020 2020  fio.flush().    
+0001f310: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+0001f320: 6572 7445 7175 616c 2866 696f 2e74 656c  ertEqual(fio.tel
+0001f330: 6c28 292c 206c 656e 2862 7566 6665 7229  l(), len(buffer)
+0001f340: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
+0001f350: 7469 6c65 6462 2e46 696c 6549 4f28 7666  tiledb.FileIO(vf
+0001f360: 732c 2073 656c 662e 7061 7468 2822 666f  s, self.path("fo
+0001f370: 6f22 292c 206d 6f64 653d 2272 6222 2920  o"), mode="rb") 
+0001f380: 6173 2066 696f 3a0a 2020 2020 2020 2020  as fio:.        
+0001f390: 2020 2020 7769 7468 2073 656c 662e 6173      with self.as
+0001f3a0: 7365 7274 5261 6973 6573 2849 4f45 7272  sertRaises(IOErr
+0001f3b0: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+0001f3c0: 2020 2020 2066 696f 2e77 7269 7465 2862       fio.write(b
+0001f3d0: 2266 6f6f 2229 0a0a 2020 2020 2020 2020  "foo")..        
+0001f3e0: 7365 6c66 2e61 7373 6572 7445 7175 616c  self.assertEqual
+0001f3f0: 2876 6673 2e66 696c 655f 7369 7a65 2873  (vfs.file_size(s
+0001f400: 656c 662e 7061 7468 2822 666f 6f22 2929  elf.path("foo"))
+0001f410: 2c20 6c65 6e28 6275 6666 6572 2929 0a0a  , len(buffer))..
+0001f420: 2020 2020 2020 2020 6669 6f20 3d20 7469          fio = ti
+0001f430: 6c65 6462 2e46 696c 6549 4f28 7666 732c  ledb.FileIO(vfs,
+0001f440: 2073 656c 662e 7061 7468 2822 666f 6f22   self.path("foo"
+0001f450: 292c 206d 6f64 653d 2272 6222 290a 2020  ), mode="rb").  
+0001f460: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001f470: 7445 7175 616c 2866 696f 2e72 6561 6428  tEqual(fio.read(
+0001f480: 3329 2c20 6222 3031 3222 290a 2020 2020  3), b"012").    
+0001f490: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001f4a0: 7175 616c 2866 696f 2e74 656c 6c28 292c  qual(fio.tell(),
+0001f4b0: 2033 290a 2020 2020 2020 2020 7365 6c66   3).        self
+0001f4c0: 2e61 7373 6572 7445 7175 616c 2866 696f  .assertEqual(fio
+0001f4d0: 2e72 6561 6428 3329 2c20 6222 3334 3522  .read(3), b"345"
+0001f4e0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+0001f4f0: 7373 6572 7445 7175 616c 2866 696f 2e74  ssertEqual(fio.t
+0001f500: 656c 6c28 292c 2036 290a 2020 2020 2020  ell(), 6).      
+0001f510: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0001f520: 616c 2866 696f 2e72 6561 6428 3130 292c  al(fio.read(10),
+0001f530: 2062 2236 3738 3922 290a 2020 2020 2020   b"6789").      
+0001f540: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0001f550: 616c 2866 696f 2e74 656c 6c28 292c 2031  al(fio.tell(), 1
+0001f560: 3029 0a0a 2020 2020 2020 2020 2320 7365  0)..        # se
+0001f570: 656b 2066 726f 6d20 6265 6769 6e6e 696e  ek from beginnin
+0001f580: 670a 2020 2020 2020 2020 6669 6f2e 7365  g.        fio.se
+0001f590: 656b 2830 290a 2020 2020 2020 2020 7365  ek(0).        se
+0001f5a0: 6c66 2e61 7373 6572 7445 7175 616c 2866  lf.assertEqual(f
+0001f5b0: 696f 2e74 656c 6c28 292c 2030 290a 2020  io.tell(), 0).  
+0001f5c0: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+0001f5d0: 7445 7175 616c 2866 696f 2e72 6561 6428  tEqual(fio.read(
+0001f5e0: 292c 2062 7566 6665 7229 0a0a 2020 2020  ), buffer)..    
+0001f5f0: 2020 2020 2320 7365 656b 206d 7573 7420      # seek must 
+0001f600: 6265 2070 6f73 6974 6976 6520 7768 656e  be positive when
+0001f610: 2053 4545 4b5f 5345 540a 2020 2020 2020   SEEK_SET.      
+0001f620: 2020 7769 7468 2073 656c 662e 6173 7365    with self.asse
+0001f630: 7274 5261 6973 6573 2856 616c 7565 4572  rtRaises(ValueEr
+0001f640: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
+0001f650: 2020 6669 6f2e 7365 656b 282d 312c 2030    fio.seek(-1, 0
+0001f660: 290a 0a20 2020 2020 2020 2023 2073 6565  )..        # see
+0001f670: 6b20 6672 6f6d 2063 7572 7265 6e74 2070  k from current p
+0001f680: 6f73 6974 6669 6f6e 0a20 2020 2020 2020  ositfion.       
+0001f690: 2066 696f 2e73 6565 6b28 3529 0a20 2020   fio.seek(5).   
+0001f6a0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+0001f6b0: 4571 7561 6c28 6669 6f2e 7465 6c6c 2829  Equal(fio.tell()
+0001f6c0: 2c20 3529 0a20 2020 2020 2020 2066 696f  , 5).        fio
+0001f6d0: 2e73 6565 6b28 332c 2031 290a 2020 2020  .seek(3, 1).    
+0001f6e0: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001f6f0: 7175 616c 2866 696f 2e74 656c 6c28 292c  qual(fio.tell(),
+0001f700: 2038 290a 2020 2020 2020 2020 6669 6f2e   8).        fio.
+0001f710: 7365 656b 282d 332c 2031 290a 2020 2020  seek(-3, 1).    
+0001f720: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+0001f730: 7175 616c 2866 696f 2e74 656c 6c28 292c  qual(fio.tell(),
+0001f740: 2035 290a 0a20 2020 2020 2020 2023 2073   5)..        # s
+0001f750: 6565 6b20 6672 6f6d 2065 6e64 0a20 2020  eek from end.   
+0001f760: 2020 2020 2066 696f 2e73 6565 6b28 2d34       fio.seek(-4
+0001f770: 2c20 3229 0a20 2020 2020 2020 2073 656c  , 2).        sel
+0001f780: 662e 6173 7365 7274 4571 7561 6c28 6669  f.assertEqual(fi
+0001f790: 6f2e 7465 6c6c 2829 2c20 3629 0a0a 2020  o.tell(), 6)..  
+0001f7a0: 2020 2020 2020 2320 5465 7374 2072 6561        # Test rea
+0001f7b0: 6461 6c6c 0a20 2020 2020 2020 2066 696f  dall.        fio
+0001f7c0: 2e73 6565 6b28 3029 0a20 2020 2020 2020  .seek(0).       
+0001f7d0: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0001f7e0: 6c28 6669 6f2e 7265 6164 616c 6c28 292c  l(fio.readall(),
+0001f7f0: 2062 7566 6665 7229 0a20 2020 2020 2020   buffer).       
+0001f800: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+0001f810: 6c28 6669 6f2e 7465 6c6c 2829 2c20 3130  l(fio.tell(), 10
+0001f820: 290a 0a20 2020 2020 2020 2066 696f 2e73  )..        fio.s
+0001f830: 6565 6b28 3529 0a20 2020 2020 2020 2073  eek(5).        s
+0001f840: 656c 662e 6173 7365 7274 4571 7561 6c28  elf.assertEqual(
+0001f850: 6669 6f2e 7265 6164 616c 6c28 292c 2062  fio.readall(), b
+0001f860: 7566 6665 725b 353a 5d29 0a20 2020 2020  uffer[5:]).     
+0001f870: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+0001f880: 7561 6c28 6669 6f2e 7265 6164 616c 6c28  ual(fio.readall(
+0001f890: 292c 2062 2222 290a 0a20 2020 2020 2020  ), b"")..       
+0001f8a0: 2023 2052 6561 6469 6e67 2066 726f 6d20   # Reading from 
+0001f8b0: 7468 6520 656e 6420 7368 6f75 6c64 2072  the end should r
+0001f8c0: 6574 7572 6e20 656d 7074 790a 2020 2020  eturn empty.    
+0001f8d0: 2020 2020 6669 6f2e 7365 656b 2830 290a      fio.seek(0).
+0001f8e0: 2020 2020 2020 2020 6669 6f2e 7265 6164          fio.read
+0001f8f0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+0001f900: 6173 7365 7274 4571 7561 6c28 6669 6f2e  assertEqual(fio.
+0001f910: 7265 6164 2829 2c20 6222 2229 0a0a 2020  read(), b"")..  
+0001f920: 2020 2020 2020 2320 5465 7374 2077 7269        # Test wri
+0001f930: 7469 6e67 2061 6e64 2072 6561 6469 6e67  ting and reading
+0001f940: 206c 696e 6573 2077 6974 6820 5465 7874   lines with Text
+0001f950: 494f 5772 6170 7065 720a 2020 2020 2020  IOWrapper.      
+0001f960: 2020 6c69 6e65 7320 3d20 5b72 616e 645f    lines = [rand_
+0001f970: 7574 6638 2872 616e 646f 6d2e 7261 6e64  utf8(random.rand
+0001f980: 696e 7428 302c 2035 3029 2920 2b20 225c  int(0, 50)) + "\
+0001f990: 6e22 2066 6f72 205f 2069 6e20 7261 6e67  n" for _ in rang
+0001f9a0: 6528 3130 295d 0a20 2020 2020 2020 2072  e(10)].        r
+0001f9b0: 616e 645f 7572 6920 3d20 7365 6c66 2e70  and_uri = self.p
+0001f9c0: 6174 6828 2274 6573 745f 6669 6f2e 7261  ath("test_fio.ra
+0001f9d0: 6e64 2229 0a20 2020 2020 2020 2077 6974  nd").        wit
+0001f9e0: 6820 7469 6c65 6462 2e46 696c 6549 4f28  h tiledb.FileIO(
+0001f9f0: 7666 732c 2072 616e 645f 7572 692c 2022  vfs, rand_uri, "
+0001fa00: 7762 2229 2061 7320 663a 0a20 2020 2020  wb") as f:.     
+0001fa10: 2020 2020 2020 2074 7874 696f 203d 2069         txtio = i
+0001fa20: 6f2e 5465 7874 494f 5772 6170 7065 7228  o.TextIOWrapper(
+0001fa30: 662c 2065 6e63 6f64 696e 673d 2275 7466  f, encoding="utf
+0001fa40: 2d38 2229 0a20 2020 2020 2020 2020 2020  -8").           
+0001fa50: 2074 7874 696f 2e77 7269 7465 6c69 6e65   txtio.writeline
+0001fa60: 7328 6c69 6e65 7329 0a20 2020 2020 2020  s(lines).       
+0001fa70: 2020 2020 2074 7874 696f 2e66 6c75 7368       txtio.flush
+0001fa80: 2829 0a0a 2020 2020 2020 2020 7769 7468  ()..        with
+0001fa90: 2074 696c 6564 622e 4669 6c65 494f 2876   tiledb.FileIO(v
+0001faa0: 6673 2c20 7261 6e64 5f75 7269 2c20 2272  fs, rand_uri, "r
+0001fab0: 6222 2920 6173 2066 323a 0a20 2020 2020  b") as f2:.     
+0001fac0: 2020 2020 2020 2074 7874 696f 203d 2069         txtio = i
+0001fad0: 6f2e 5465 7874 494f 5772 6170 7065 7228  o.TextIOWrapper(
+0001fae0: 6632 2c20 656e 636f 6469 6e67 3d22 7574  f2, encoding="ut
+0001faf0: 662d 3822 290a 2020 2020 2020 2020 2020  f-8").          
+0001fb00: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+0001fb10: 616c 2874 7874 696f 2e72 6561 646c 696e  al(txtio.readlin
+0001fb20: 6573 2829 2c20 6c69 6e65 7329 0a0a 2020  es(), lines)..  
+0001fb30: 2020 6465 6620 7465 7374 5f6c 7328 7365    def test_ls(se
+0001fb40: 6c66 293a 0a20 2020 2020 2020 2062 6173  lf):.        bas
+0001fb50: 6570 6174 6820 3d20 7365 6c66 2e70 6174  epath = self.pat
+0001fb60: 6828 2274 6573 745f 7666 735f 6c73 2229  h("test_vfs_ls")
+0001fb70: 0a20 2020 2020 2020 2073 656c 662e 7666  .        self.vf
+0001fb80: 732e 6372 6561 7465 5f64 6972 2862 6173  s.create_dir(bas
+0001fb90: 6570 6174 6829 0a20 2020 2020 2020 2066  epath).        f
+0001fba0: 6f72 2069 6420 696e 2028 312c 2032 2c20  or id in (1, 2, 
+0001fbb0: 3329 3a0a 2020 2020 2020 2020 2020 2020  3):.            
+0001fbc0: 6469 7220 3d20 6f73 2e70 6174 682e 6a6f  dir = os.path.jo
+0001fbd0: 696e 2862 6173 6570 6174 682c 2022 6469  in(basepath, "di
+0001fbe0: 7222 202b 2073 7472 2869 6429 290a 2020  r" + str(id)).  
+0001fbf0: 2020 2020 2020 2020 2020 7365 6c66 2e76            self.v
+0001fc00: 6673 2e63 7265 6174 655f 6469 7228 6469  fs.create_dir(di
+0001fc10: 7229 0a20 2020 2020 2020 2020 2020 2066  r).            f
+0001fc20: 6e61 6d65 203d 206f 732e 7061 7468 2e6a  name = os.path.j
+0001fc30: 6f69 6e28 6261 7365 7061 7468 2c20 2266  oin(basepath, "f
+0001fc40: 696c 655f 2220 2b20 7374 7228 6964 2929  ile_" + str(id))
+0001fc50: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+0001fc60: 6820 7469 6c65 6462 2e46 696c 6549 4f28  h tiledb.FileIO(
+0001fc70: 7365 6c66 2e76 6673 2c20 666e 616d 652c  self.vfs, fname,
+0001fc80: 2022 7762 2229 2061 7320 6669 6f3a 0a20   "wb") as fio:. 
+0001fc90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001fca0: 696f 2e77 7269 7465 2862 2222 290a 0a20  io.write(b"").. 
+0001fcb0: 2020 2020 2020 2065 7870 6563 7465 6420         expected 
+0001fcc0: 3d20 2822 6669 6c65 5f31 222c 2022 6669  = ("file_1", "fi
+0001fcd0: 6c65 5f32 222c 2022 6669 6c65 5f33 2229  le_2", "file_3")
+0001fce0: 0a20 2020 2020 2020 2023 2065 6d70 7479  .        # empty
+0001fcf0: 2064 6972 6563 746f 7269 6573 2064 6f20   directories do 
+0001fd00: 6e6f 7420 2265 7869 7374 2220 6f6e 2073  not "exist" on s
+0001fd10: 330a 2020 2020 2020 2020 6966 2070 7974  3.        if pyt
+0001fd20: 6573 742e 7469 6c65 6462 5f76 6673 2021  est.tiledb_vfs !
+0001fd30: 3d20 2273 3322 3a0a 2020 2020 2020 2020  = "s3":.        
+0001fd40: 2020 2020 6578 7065 6374 6564 203d 2065      expected = e
+0001fd50: 7870 6563 7465 6420 2b20 2822 6469 7231  xpected + ("dir1
+0001fd60: 222c 2022 6469 7232 222c 2022 6469 7233  ", "dir2", "dir3
+0001fd70: 2229 0a0a 2020 2020 2020 2020 7365 6c66  ")..        self
+0001fd80: 2e61 7373 6572 7453 6574 4571 7561 6c28  .assertSetEqual(
+0001fd90: 0a20 2020 2020 2020 2020 2020 2073 6574  .            set
+0001fda0: 2865 7870 6563 7465 6429 2c0a 2020 2020  (expected),.    
+0001fdb0: 2020 2020 2020 2020 7365 7428 0a20 2020          set(.   
+0001fdc0: 2020 2020 2020 2020 2020 2020 206d 6170               map
+0001fdd0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001fde0: 2020 2020 2020 6c61 6d62 6461 2078 3a20        lambda x: 
+0001fdf0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+0001fe00: 2878 2e73 706c 6974 2822 7465 7374 5f76  (x.split("test_v
+0001fe10: 6673 5f6c 7322 295b 315d 292c 0a20 2020  fs_ls")[1]),.   
+0001fe20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fe30: 2073 656c 662e 7666 732e 6c73 2862 6173   self.vfs.ls(bas
+0001fe40: 6570 6174 6829 2c0a 2020 2020 2020 2020  epath),.        
+0001fe50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0001fe60: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+0001fe70: 2029 0a0a 2020 2020 6465 6620 7465 7374   )..    def test
+0001fe80: 5f64 6972 5f73 697a 6528 7365 6c66 293a  _dir_size(self):
+0001fe90: 0a20 2020 2020 2020 2076 6673 203d 2074  .        vfs = t
+0001fea0: 696c 6564 622e 5646 5328 290a 0a20 2020  iledb.VFS()..   
+0001feb0: 2020 2020 2070 6174 6820 3d20 7365 6c66       path = self
+0001fec0: 2e70 6174 6828 2274 6573 745f 7666 735f  .path("test_vfs_
+0001fed0: 6469 725f 7369 7a65 2229 0a20 2020 2020  dir_size").     
+0001fee0: 2020 2076 6673 2e63 7265 6174 655f 6469     vfs.create_di
+0001fef0: 7228 7061 7468 290a 2020 2020 2020 2020  r(path).        
+0001ff00: 7261 6e64 5f73 697a 6573 203d 206e 702e  rand_sizes = np.
+0001ff10: 7261 6e64 6f6d 2e63 686f 6963 6528 3130  random.choice(10
+0001ff20: 302c 2073 697a 653d 342c 2072 6570 6c61  0, size=4, repla
+0001ff30: 6365 3d46 616c 7365 290a 2020 2020 2020  ce=False).      
+0001ff40: 2020 666f 7220 7369 7a65 2069 6e20 7261    for size in ra
+0001ff50: 6e64 5f73 697a 6573 3a0a 2020 2020 2020  nd_sizes:.      
+0001ff60: 2020 2020 2020 6669 6c65 5f70 6174 6820        file_path 
+0001ff70: 3d20 6f73 2e70 6174 682e 6a6f 696e 2870  = os.path.join(p
+0001ff80: 6174 682c 2022 665f 2220 2b20 7374 7228  ath, "f_" + str(
+0001ff90: 7369 7a65 2929 0a20 2020 2020 2020 2020  size)).         
+0001ffa0: 2020 2077 6974 6820 7469 6c65 6462 2e46     with tiledb.F
+0001ffb0: 696c 6549 4f28 7666 732c 2066 696c 655f  ileIO(vfs, file_
+0001ffc0: 7061 7468 2c20 2277 6222 2920 6173 2066  path, "wb") as f
+0001ffd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ffe0: 2020 6461 7461 203d 206f 732e 7572 616e    data = os.uran
+0001fff0: 646f 6d28 7369 7a65 290a 2020 2020 2020  dom(size).      
+00020000: 2020 2020 2020 2020 2020 662e 7772 6974            f.writ
+00020010: 6528 6461 7461 290a 0a20 2020 2020 2020  e(data)..       
+00020020: 2073 656c 662e 6173 7365 7274 4571 7561   self.assertEqua
+00020030: 6c28 7666 732e 6469 725f 7369 7a65 2870  l(vfs.dir_size(p
+00020040: 6174 6829 2c20 7375 6d28 7261 6e64 5f73  ath), sum(rand_s
+00020050: 697a 6573 2929 0a0a 0a63 6c61 7373 2043  izes))...class C
+00020060: 6f6e 736f 6c69 6461 7469 6f6e 5465 7374  onsolidationTest
+00020070: 2844 6973 6b54 6573 7443 6173 6529 3a0a  (DiskTestCase):.
+00020080: 2020 2020 6465 6620 7465 7374 5f61 7272      def test_arr
+00020090: 6179 5f76 6163 7575 6d28 7365 6c66 293a  ay_vacuum(self):
+000200a0: 0a20 2020 2020 2020 2076 6673 203d 2074  .        vfs = t
+000200b0: 696c 6564 622e 5646 5328 290a 2020 2020  iledb.VFS().    
+000200c0: 2020 2020 7061 7468 203d 2073 656c 662e      path = self.
+000200d0: 7061 7468 2822 7465 7374 5f61 7272 6179  path("test_array
+000200e0: 5f76 6163 7575 6d22 290a 0a20 2020 2020  _vacuum")..     
+000200f0: 2020 2064 7368 6170 6520 3d20 2830 2c20     dshape = (0, 
+00020100: 3139 290a 2020 2020 2020 2020 6e75 6d5f  19).        num_
+00020110: 7772 6974 6573 203d 2031 300a 0a20 2020  writes = 10..   
+00020120: 2020 2020 2064 6566 2063 7265 6174 655f       def create_
+00020130: 6172 7261 7928 7461 7267 6574 5f70 6174  array(target_pat
+00020140: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+00020150: 646f 6d20 3d20 7469 6c65 6462 2e44 6f6d  dom = tiledb.Dom
+00020160: 6169 6e28 7469 6c65 6462 2e44 696d 2864  ain(tiledb.Dim(d
+00020170: 6f6d 6169 6e3d 6473 6861 7065 2c20 7469  omain=dshape, ti
+00020180: 6c65 3d33 2929 0a20 2020 2020 2020 2020  le=3)).         
+00020190: 2020 2061 7474 203d 2074 696c 6564 622e     att = tiledb.
+000201a0: 4174 7472 2864 7479 7065 3d22 696e 7436  Attr(dtype="int6
+000201b0: 3422 290a 2020 2020 2020 2020 2020 2020  4").            
+000201c0: 7363 6865 6d61 203d 2074 696c 6564 622e  schema = tiledb.
+000201d0: 4172 7261 7953 6368 656d 6128 646f 6d61  ArraySchema(doma
+000201e0: 696e 3d64 6f6d 2c20 6174 7472 733d 2861  in=dom, attrs=(a
+000201f0: 7474 2c29 290a 2020 2020 2020 2020 2020  tt,)).          
+00020200: 2020 7469 6c65 6462 2e6c 6962 7469 6c65    tiledb.libtile
+00020210: 6462 2e41 7272 6179 2e63 7265 6174 6528  db.Array.create(
+00020220: 7461 7267 6574 5f70 6174 682c 2073 6368  target_path, sch
+00020230: 656d 6129 0a0a 2020 2020 2020 2020 6465  ema)..        de
+00020240: 6620 7772 6974 655f 6672 6167 6d65 6e74  f write_fragment
+00020250: 7328 7461 7267 6574 5f70 6174 6829 3a0a  s(target_path):.
+00020260: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00020270: 6920 696e 2072 616e 6765 286e 756d 5f77  i in range(num_w
+00020280: 7269 7465 7329 3a0a 2020 2020 2020 2020  rites):.        
+00020290: 2020 2020 2020 2020 7769 7468 2074 696c          with til
+000202a0: 6564 622e 6f70 656e 2874 6172 6765 745f  edb.open(target_
+000202b0: 7061 7468 2c20 2277 2229 2061 7320 413a  path, "w") as A:
+000202c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000202d0: 2020 2020 2041 5b69 203a 2064 7368 6170       A[i : dshap
+000202e0: 655b 315d 5d20 3d20 6e70 2e72 616e 646f  e[1]] = np.rando
+000202f0: 6d2e 7261 6e64 2864 7368 6170 655b 315d  m.rand(dshape[1]
+00020300: 202d 2069 290a 0a20 2020 2020 2020 2023   - i)..        #
+00020310: 2065 7870 6563 7465 6420 6e75 6d62 6572   expected number
+00020320: 206f 6620 6e6f 6e2d 6672 6167 6d65 6e74   of non-fragment
+00020330: 2064 6972 6563 746f 7279 2065 6e74 7269   directory entri
+00020340: 6573 0a20 2020 2020 2020 2023 2020 2074  es.        #   t
+00020350: 6865 7265 2069 7320 6e6f 206c 7320 7265  here is no ls re
+00020360: 7375 6c74 2066 6f72 2065 6d70 7479 205f  sult for empty _
+00020370: 5f6d 6574 6120 6469 7265 6374 6f72 7920  _meta directory 
+00020380: 6f6e 2073 330a 2020 2020 2020 2020 6578  on s3.        ex
+00020390: 7065 6374 6564 5f65 7874 7261 203d 2032  pected_extra = 2
+000203a0: 2069 6620 7079 7465 7374 2e74 696c 6564   if pytest.tiled
+000203b0: 625f 7666 7320 3d3d 2022 7333 2220 656c  b_vfs == "s3" el
+000203c0: 7365 2033 0a0a 2020 2020 2020 2020 6372  se 3..        cr
+000203d0: 6561 7465 5f61 7272 6179 2870 6174 6829  eate_array(path)
+000203e0: 0a20 2020 2020 2020 2077 7269 7465 5f66  .        write_f
+000203f0: 7261 676d 656e 7473 2870 6174 6829 0a20  ragments(path). 
+00020400: 2020 2020 2020 2070 6174 6873 203d 2076         paths = v
+00020410: 6673 2e6c 7328 7061 7468 290a 2020 2020  fs.ls(path).    
+00020420: 2020 2020 7365 6c66 2e61 7373 6572 7445      self.assertE
+00020430: 7175 616c 286c 656e 2870 6174 6873 292c  qual(len(paths),
+00020440: 2065 7870 6563 7465 645f 6578 7472 6120   expected_extra 
+00020450: 2b20 2832 202a 206e 756d 5f77 7269 7465  + (2 * num_write
+00020460: 7329 290a 0a20 2020 2020 2020 2074 696c  s))..        til
+00020470: 6564 622e 636f 6e73 6f6c 6964 6174 6528  edb.consolidate(
+00020480: 7061 7468 290a 2020 2020 2020 2020 7469  path).        ti
+00020490: 6c65 6462 2e76 6163 7575 6d28 7061 7468  ledb.vacuum(path
+000204a0: 290a 0a20 2020 2020 2020 2070 6174 6873  )..        paths
+000204b0: 203d 2076 6673 2e6c 7328 7061 7468 290a   = vfs.ls(path).
+000204c0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+000204d0: 6572 7445 7175 616c 286c 656e 2870 6174  ertEqual(len(pat
+000204e0: 6873 292c 2065 7870 6563 7465 645f 6578  hs), expected_ex
+000204f0: 7472 6120 2b20 3229 0a0a 2020 2020 2020  tra + 2)..      
+00020500: 2020 6465 6c20 7061 7468 0a0a 2020 2020    del path..    
+00020510: 2020 2020 7061 7468 3220 3d20 7365 6c66      path2 = self
+00020520: 2e70 6174 6828 2274 6573 745f 6172 7261  .path("test_arra
+00020530: 795f 7661 6375 756d 5f66 7261 676d 656e  y_vacuum_fragmen
+00020540: 745f 6d65 7461 2229 0a20 2020 2020 2020  t_meta").       
+00020550: 2063 7265 6174 655f 6172 7261 7928 7061   create_array(pa
+00020560: 7468 3229 0a20 2020 2020 2020 2077 7269  th2).        wri
+00020570: 7465 5f66 7261 676d 656e 7473 2870 6174  te_fragments(pat
+00020580: 6832 290a 2020 2020 2020 2020 7469 6c65  h2).        tile
+00020590: 6462 2e63 6f6e 736f 6c69 6461 7465 280a  db.consolidate(.
+000205a0: 2020 2020 2020 2020 2020 2020 7061 7468              path
+000205b0: 322c 2063 6f6e 6669 673d 7469 6c65 6462  2, config=tiledb
+000205c0: 2e43 6f6e 6669 6728 7b22 736d 2e63 6f6e  .Config({"sm.con
+000205d0: 736f 6c69 6461 7469 6f6e 2e6d 6f64 6522  solidation.mode"
+000205e0: 3a20 2266 7261 676d 656e 745f 6d65 7461  : "fragment_meta
+000205f0: 227d 290a 2020 2020 2020 2020 290a 2020  "}).        ).  
+00020600: 2020 2020 2020 7469 6c65 6462 2e76 6163        tiledb.vac
+00020610: 7575 6d28 7061 7468 322c 2063 6f6e 6669  uum(path2, confi
+00020620: 673d 7469 6c65 6462 2e43 6f6e 6669 6728  g=tiledb.Config(
+00020630: 7b22 736d 2e76 6163 7575 6d2e 6d6f 6465  {"sm.vacuum.mode
+00020640: 223a 2022 6672 6167 6d65 6e74 5f6d 6574  ": "fragment_met
+00020650: 6122 7d29 290a 2020 2020 2020 2020 7061  a"})).        pa
+00020660: 7468 7320 3d20 7666 732e 6c73 2870 6174  ths = vfs.ls(pat
+00020670: 6832 290a 0a20 2020 2020 2020 2073 656c  h2)..        sel
+00020680: 662e 6173 7365 7274 4571 7561 6c28 6c65  f.assertEqual(le
+00020690: 6e28 7061 7468 7329 2c20 6578 7065 6374  n(paths), expect
+000206a0: 6564 5f65 7874 7261 202b 2032 202a 206e  ed_extra + 2 * n
+000206b0: 756d 5f77 7269 7465 7320 2b20 3129 0a0a  um_writes + 1)..
+000206c0: 2020 2020 2020 2020 7061 7468 3320 3d20          path3 = 
+000206d0: 7365 6c66 2e70 6174 6828 2274 6573 745f  self.path("test_
+000206e0: 6172 7261 795f 7661 6375 756d 3222 290a  array_vacuum2").
+000206f0: 2020 2020 2020 2020 6372 6561 7465 5f61          create_a
+00020700: 7272 6179 2870 6174 6833 290a 2020 2020  rray(path3).    
+00020710: 2020 2020 7772 6974 655f 6672 6167 6d65      write_fragme
+00020720: 6e74 7328 7061 7468 3329 0a20 2020 2020  nts(path3).     
+00020730: 2020 2063 6f6e 6620 3d20 7469 6c65 6462     conf = tiledb
+00020740: 2e43 6f6e 6669 6728 7b22 736d 2e63 6f6e  .Config({"sm.con
+00020750: 736f 6c69 6461 7469 6f6e 2e6d 6f64 6522  solidation.mode"
+00020760: 3a20 2266 7261 676d 656e 745f 6d65 7461  : "fragment_meta
+00020770: 227d 290a 2020 2020 2020 2020 7769 7468  "}).        with
+00020780: 2074 696c 6564 622e 6f70 656e 2870 6174   tiledb.open(pat
+00020790: 6833 2c20 2277 2229 2061 7320 413a 0a20  h3, "w") as A:. 
+000207a0: 2020 2020 2020 2020 2020 2041 2e63 6f6e             A.con
+000207b0: 736f 6c69 6461 7465 2863 6f6e 6669 673d  solidate(config=
+000207c0: 636f 6e66 290a 0a20 2020 2020 2020 2070  conf)..        p
+000207d0: 6174 6873 203d 2076 6673 2e6c 7328 7061  aths = vfs.ls(pa
+000207e0: 7468 3229 0a0a 2020 2020 6465 6620 7465  th2)..    def te
+000207f0: 7374 5f61 7272 6179 5f63 6f6e 736f 6c69  st_array_consoli
+00020800: 6461 7465 5f77 6974 685f 7469 6d65 7374  date_with_timest
+00020810: 616d 7028 7365 6c66 293a 0a20 2020 2020  amp(self):.     
+00020820: 2020 2064 7368 6170 6520 3d20 2831 2c20     dshape = (1, 
+00020830: 3329 0a20 2020 2020 2020 206e 756d 5f77  3).        num_w
+00020840: 7269 7465 7320 3d20 3130 0a0a 2020 2020  rites = 10..    
+00020850: 2020 2020 6465 6620 6372 6561 7465 5f61      def create_a
+00020860: 7272 6179 2874 6172 6765 745f 7061 7468  rray(target_path
+00020870: 2c20 6473 6861 7065 293a 0a20 2020 2020  , dshape):.     
+00020880: 2020 2020 2020 2064 6f6d 203d 2074 696c         dom = til
+00020890: 6564 622e 446f 6d61 696e 2874 696c 6564  edb.Domain(tiled
+000208a0: 622e 4469 6d28 646f 6d61 696e 3d64 7368  b.Dim(domain=dsh
+000208b0: 6170 652c 2074 696c 653d 6c65 6e28 6473  ape, tile=len(ds
+000208c0: 6861 7065 2929 290a 2020 2020 2020 2020  hape))).        
+000208d0: 2020 2020 6174 7420 3d20 7469 6c65 6462      att = tiledb
+000208e0: 2e41 7474 7228 6474 7970 653d 2269 6e74  .Attr(dtype="int
+000208f0: 3634 2229 0a20 2020 2020 2020 2020 2020  64").           
+00020900: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
+00020910: 2e41 7272 6179 5363 6865 6d61 2864 6f6d  .ArraySchema(dom
+00020920: 6169 6e3d 646f 6d2c 2061 7474 7273 3d28  ain=dom, attrs=(
+00020930: 6174 742c 292c 2073 7061 7273 653d 5472  att,), sparse=Tr
+00020940: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00020950: 7469 6c65 6462 2e6c 6962 7469 6c65 6462  tiledb.libtiledb
+00020960: 2e41 7272 6179 2e63 7265 6174 6528 7461  .Array.create(ta
+00020970: 7267 6574 5f70 6174 682c 2073 6368 656d  rget_path, schem
+00020980: 6129 0a0a 2020 2020 2020 2020 6465 6620  a)..        def 
+00020990: 7772 6974 655f 6672 6167 6d65 6e74 7328  write_fragments(
+000209a0: 7461 7267 6574 5f70 6174 682c 2064 7368  target_path, dsh
+000209b0: 6170 652c 206e 756d 5f77 7269 7465 7329  ape, num_writes)
+000209c0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+000209d0: 7220 6920 696e 2072 616e 6765 2831 2c20  r i in range(1, 
+000209e0: 6e75 6d5f 7772 6974 6573 202b 2031 293a  num_writes + 1):
+000209f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020a00: 2077 6974 6820 7469 6c65 6462 2e6f 7065   with tiledb.ope
+00020a10: 6e28 7461 7267 6574 5f70 6174 682c 2022  n(target_path, "
+00020a20: 7722 2c20 7469 6d65 7374 616d 703d 6929  w", timestamp=i)
+00020a30: 2061 7320 413a 0a20 2020 2020 2020 2020   as A:.         
+00020a40: 2020 2020 2020 2020 2020 2041 5b5b 312c             A[[1,
+00020a50: 2032 2c20 335d 5d20 3d20 6e70 2e72 616e   2, 3]] = np.ran
+00020a60: 646f 6d2e 7261 6e64 2864 7368 6170 655b  dom.rand(dshape[
+00020a70: 315d 290a 0a20 2020 2020 2020 2070 6174  1])..        pat
+00020a80: 6820 3d20 7365 6c66 2e70 6174 6828 2274  h = self.path("t
+00020a90: 6573 745f 6172 7261 795f 636f 6e73 6f6c  est_array_consol
+00020aa0: 6964 6174 655f 7769 7468 5f74 696d 6573  idate_with_times
+00020ab0: 7461 6d70 2229 0a0a 2020 2020 2020 2020  tamp")..        
+00020ac0: 6372 6561 7465 5f61 7272 6179 2870 6174  create_array(pat
+00020ad0: 682c 2064 7368 6170 6529 0a20 2020 2020  h, dshape).     
+00020ae0: 2020 2077 7269 7465 5f66 7261 676d 656e     write_fragmen
+00020af0: 7473 2870 6174 682c 2064 7368 6170 652c  ts(path, dshape,
+00020b00: 206e 756d 5f77 7269 7465 7329 0a20 2020   num_writes).   
+00020b10: 2020 2020 2066 7261 6773 203d 2074 696c       frags = til
+00020b20: 6564 622e 4672 6167 6d65 6e74 496e 666f  edb.FragmentInfo
+00020b30: 4c69 7374 2870 6174 6829 0a20 2020 2020  List(path).     
+00020b40: 2020 2061 7373 6572 7420 6c65 6e28 6672     assert len(fr
+00020b50: 6167 7329 203d 3d20 3130 0a0a 2020 2020  ags) == 10..    
+00020b60: 2020 2020 7469 6c65 6462 2e63 6f6e 736f      tiledb.conso
+00020b70: 6c69 6461 7465 2870 6174 682c 2074 696d  lidate(path, tim
+00020b80: 6573 7461 6d70 3d28 312c 2034 2929 0a20  estamp=(1, 4)). 
+00020b90: 2020 2020 2020 2066 7261 6773 203d 2074         frags = t
+00020ba0: 696c 6564 622e 4672 6167 6d65 6e74 496e  iledb.FragmentIn
+00020bb0: 666f 4c69 7374 2870 6174 6829 0a20 2020  foList(path).   
+00020bc0: 2020 2020 2061 7373 6572 7420 6c65 6e28       assert len(
+00020bd0: 6672 6167 7329 203d 3d20 370a 2020 2020  frags) == 7.    
+00020be0: 2020 2020 6173 7365 7274 2066 7261 6773      assert frags
+00020bf0: 2e74 6f5f 7661 6375 756d 5f6e 756d 203d  .to_vacuum_num =
+00020c00: 3d20 340a 0a20 2020 2020 2020 2074 696c  = 4..        til
+00020c10: 6564 622e 7661 6375 756d 2870 6174 682c  edb.vacuum(path,
+00020c20: 2074 696d 6573 7461 6d70 3d28 312c 2032   timestamp=(1, 2
+00020c30: 2929 0a20 2020 2020 2020 2066 7261 6773  )).        frags
+00020c40: 203d 2074 696c 6564 622e 4672 6167 6d65   = tiledb.Fragme
+00020c50: 6e74 496e 666f 4c69 7374 2870 6174 6829  ntInfoList(path)
+00020c60: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00020c70: 6672 6167 732e 746f 5f76 6163 7575 6d5f  frags.to_vacuum_
+00020c80: 6e75 6d20 3d3d 2032 0a0a 2020 2020 2020  num == 2..      
+00020c90: 2020 7469 6c65 6462 2e76 6163 7575 6d28    tiledb.vacuum(
+00020ca0: 7061 7468 290a 2020 2020 2020 2020 6672  path).        fr
+00020cb0: 6167 7320 3d20 7469 6c65 6462 2e46 7261  ags = tiledb.Fra
+00020cc0: 676d 656e 7449 6e66 6f4c 6973 7428 7061  gmentInfoList(pa
+00020cd0: 7468 290a 2020 2020 2020 2020 6173 7365  th).        asse
+00020ce0: 7274 2066 7261 6773 2e74 6f5f 7661 6375  rt frags.to_vacu
+00020cf0: 756d 5f6e 756d 203d 3d20 300a 0a20 2020  um_num == 0..   
+00020d00: 2020 2020 2063 6f6e 6620 3d20 7469 6c65       conf = tile
+00020d10: 6462 2e43 6f6e 6669 6728 0a20 2020 2020  db.Config(.     
+00020d20: 2020 2020 2020 207b 2273 6d2e 636f 6e73         {"sm.cons
+00020d30: 6f6c 6964 6174 696f 6e2e 7469 6d65 7374  olidation.timest
+00020d40: 616d 705f 7374 6172 7422 3a20 352c 2022  amp_start": 5, "
+00020d50: 736d 2e63 6f6e 736f 6c69 6461 7469 6f6e  sm.consolidation
+00020d60: 2e74 696d 6573 7461 6d70 5f65 6e64 223a  .timestamp_end":
+00020d70: 2039 7d0a 2020 2020 2020 2020 290a 2020   9}.        ).  
+00020d80: 2020 2020 2020 7469 6c65 6462 2e63 6f6e        tiledb.con
+00020d90: 736f 6c69 6461 7465 2870 6174 682c 2063  solidate(path, c
+00020da0: 6f6e 6669 673d 636f 6e66 290a 2020 2020  onfig=conf).    
+00020db0: 2020 2020 7469 6c65 6462 2e76 6163 7575      tiledb.vacuu
+00020dc0: 6d28 7061 7468 290a 2020 2020 2020 2020  m(path).        
+00020dd0: 6672 6167 7320 3d20 7469 6c65 6462 2e46  frags = tiledb.F
+00020de0: 7261 676d 656e 7449 6e66 6f4c 6973 7428  ragmentInfoList(
+00020df0: 7061 7468 290a 2020 2020 2020 2020 6173  path).        as
+00020e00: 7365 7274 206c 656e 2866 7261 6773 2e74  sert len(frags.t
+00020e10: 696d 6573 7461 6d70 5f72 616e 6765 2920  imestamp_range) 
+00020e20: 3d3d 2033 0a0a 0a40 7079 7465 7374 2e6d  == 3...@pytest.m
+00020e30: 6172 6b2e 736b 6970 6966 2873 7973 2e70  ark.skipif(sys.p
+00020e40: 6c61 7466 6f72 6d20 3d3d 2022 7769 6e33  latform == "win3
+00020e50: 3222 2c20 7265 6173 6f6e 3d22 4f6e 6c79  2", reason="Only
+00020e60: 2072 756e 204d 656d 6f72 7954 6573 7420   run MemoryTest 
+00020e70: 6f6e 206c 696e 7578 2229 0a63 6c61 7373  on linux").class
+00020e80: 204d 656d 6f72 7954 6573 7428 4469 736b   MemoryTest(Disk
+00020e90: 5465 7374 4361 7365 293a 0a20 2020 2023  TestCase):.    #
+00020ea0: 2073 616e 6974 7920 6368 6563 6b20 7468   sanity check th
+00020eb0: 6174 206d 656d 6f72 7920 7573 6167 6520  at memory usage 
+00020ec0: 646f 6573 6e27 7420 696e 6372 6561 7365  doesn't increase
+00020ed0: 206d 6f72 6520 7468 616e 2032 7820 7768   more than 2x wh
+00020ee0: 656e 2072 6561 6469 6e67 2034 304d 4220  en reading 40MB 
+00020ef0: 3130 3078 0a20 2020 2023 2068 7474 7073  100x.    # https
+00020f00: 3a2f 2f67 6974 6875 622e 636f 6d2f 5469  ://github.com/Ti
+00020f10: 6c65 4442 2d49 6e63 2f54 696c 6544 422d  leDB-Inc/TileDB-
+00020f20: 5079 2f69 7373 7565 732f 3135 300a 2020  Py/issues/150.  
+00020f30: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
+00020f40: 2020 2020 6465 6620 7573 655f 6d61 6e79      def use_many
+00020f50: 5f62 7566 6665 7273 2870 6174 6829 3a0a  _buffers(path):.
+00020f60: 2020 2020 2020 2020 2320 6874 7470 733a          # https:
+00020f70: 2f2f 7374 6163 6b6f 7665 7266 6c6f 772e  //stackoverflow.
+00020f80: 636f 6d2f 7175 6573 7469 6f6e 732f 3933  com/questions/93
+00020f90: 3837 3333 2f74 6f74 616c 2d6d 656d 6f72  8733/total-memor
+00020fa0: 792d 7573 6564 2d62 792d 7079 7468 6f6e  y-used-by-python
+00020fb0: 2d70 726f 6365 7373 0a20 2020 2020 2020  -process.       
+00020fc0: 2070 726f 6365 7373 203d 2070 7375 7469   process = psuti
+00020fd0: 6c2e 5072 6f63 6573 7328 6f73 2e67 6574  l.Process(os.get
+00020fe0: 7069 6428 2929 0a0a 2020 2020 2020 2020  pid())..        
+00020ff0: 7820 3d20 6e70 2e6f 6e65 7328 3130 3030  x = np.ones(1000
+00021000: 3030 3030 2c20 6474 7970 653d 6e70 2e66  0000, dtype=np.f
+00021010: 6c6f 6174 3332 290a 2020 2020 2020 2020  loat32).        
+00021020: 6431 203d 2074 696c 6564 622e 4469 6d28  d1 = tiledb.Dim(
+00021030: 0a20 2020 2020 2020 2020 2020 2022 7465  .            "te
+00021040: 7374 5f64 6f6d 6169 6e22 2c20 646f 6d61  st_domain", doma
+00021050: 696e 3d28 302c 2078 2e73 6861 7065 5b30  in=(0, x.shape[0
+00021060: 5d20 2d20 3129 2c20 7469 6c65 3d31 3030  ] - 1), tile=100
+00021070: 3030 2c20 6474 7970 653d 2275 696e 7433  00, dtype="uint3
+00021080: 3222 0a20 2020 2020 2020 2029 0a20 2020  2".        ).   
+00021090: 2020 2020 2064 6f6d 6169 6e20 3d20 7469       domain = ti
+000210a0: 6c65 6462 2e44 6f6d 6169 6e28 6431 290a  ledb.Domain(d1).
+000210b0: 2020 2020 2020 2020 7620 3d20 7469 6c65          v = tile
+000210c0: 6462 2e41 7474 7228 2274 6573 745f 7661  db.Attr("test_va
+000210d0: 6c75 6522 2c20 6474 7970 653d 2266 6c6f  lue", dtype="flo
+000210e0: 6174 3332 2229 0a0a 2020 2020 2020 2020  at32")..        
+000210f0: 7363 6865 6d61 203d 2074 696c 6564 622e  schema = tiledb.
+00021100: 4172 7261 7953 6368 656d 6128 0a20 2020  ArraySchema(.   
+00021110: 2020 2020 2020 2020 2064 6f6d 6169 6e3d           domain=
+00021120: 646f 6d61 696e 2c20 6174 7472 733d 2876  domain, attrs=(v
+00021130: 2c29 2c20 6365 6c6c 5f6f 7264 6572 3d22  ,), cell_order="
+00021140: 726f 772d 6d61 6a6f 7222 2c20 7469 6c65  row-major", tile
+00021150: 5f6f 7264 6572 3d22 726f 772d 6d61 6a6f  _order="row-majo
+00021160: 7222 0a20 2020 2020 2020 2029 0a0a 2020  r".        )..  
+00021170: 2020 2020 2020 4120 3d20 7469 6c65 6462        A = tiledb
+00021180: 2e44 656e 7365 4172 7261 792e 6372 6561  .DenseArray.crea
+00021190: 7465 2870 6174 682c 2073 6368 656d 6129  te(path, schema)
+000211a0: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
+000211b0: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
+000211c0: 2870 6174 682c 206d 6f64 653d 2277 2229  (path, mode="w")
+000211d0: 2061 7320 413a 0a20 2020 2020 2020 2020   as A:.         
+000211e0: 2020 2041 5b3a 5d20 3d20 7b22 7465 7374     A[:] = {"test
+000211f0: 5f76 616c 7565 223a 2078 7d0a 0a20 2020  _value": x}..   
+00021200: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+00021210: 2e44 656e 7365 4172 7261 7928 7061 7468  .DenseArray(path
+00021220: 2c20 6d6f 6465 3d22 7222 2920 6173 2064  , mode="r") as d
+00021230: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
+00021240: 2064 6174 615b 3a5d 0a20 2020 2020 2020   data[:].       
+00021250: 2020 2020 2069 6e69 7469 616c 203d 2070       initial = p
+00021260: 726f 6365 7373 2e6d 656d 6f72 795f 696e  rocess.memory_in
+00021270: 666f 2829 2e72 7373 0a20 2020 2020 2020  fo().rss.       
+00021280: 2020 2020 2070 7269 6e74 2822 2020 696e       print("  in
+00021290: 6974 6961 6c20 5253 533a 207b 7d22 2e66  itial RSS: {}".f
+000212a0: 6f72 6d61 7428 726f 756e 6428 696e 6974  ormat(round(init
+000212b0: 6961 6c20 2f20 2831 3020 2a2a 2036 2929  ial / (10 ** 6))
+000212c0: 2c20 3229 290a 2020 2020 2020 2020 2020  , 2)).          
+000212d0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+000212e0: 2831 3030 293a 0a20 2020 2020 2020 2020  (100):.         
+000212f0: 2020 2020 2020 2023 2072 6561 6420 6275         # read bu
+00021300: 7420 646f 6e27 7420 7374 6f72 653a 2074  t don't store: t
+00021310: 6869 7320 6d65 6d6f 7279 2073 686f 756c  his memory shoul
+00021320: 6420 6265 2066 7265 6564 0a20 2020 2020  d be freed.     
+00021330: 2020 2020 2020 2020 2020 2064 6174 615b             data[
+00021340: 3a5d 0a0a 2020 2020 2020 2020 2020 2020  :]..            
+00021350: 2020 2020 6966 2069 2025 2031 3020 3d3d      if i % 10 ==
+00021360: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00021370: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+00021380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021390: 2020 2020 2020 2022 2020 2020 7265 6164         "    read
+000213a0: 2069 7465 7220 7b7d 2c20 5253 5320 284d   iter {}, RSS (M
+000213b0: 4229 3a20 7b7d 222e 666f 726d 6174 280a  B): {}".format(.
+000213c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000213d0: 2020 2020 2020 2020 2020 2020 692c 2072              i, r
+000213e0: 6f75 6e64 2870 726f 6365 7373 2e6d 656d  ound(process.mem
+000213f0: 6f72 795f 696e 666f 2829 2e72 7373 202f  ory_info().rss /
+00021400: 2028 3130 202a 2a20 3629 2c20 3229 0a20   (10 ** 6), 2). 
+00021410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021420: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00021430: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+00021440: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+00021450: 6e69 7469 616c 0a0a 2020 2020 6465 6620  nitial..    def 
+00021460: 7465 7374 5f6d 656d 6f72 795f 636c 6561  test_memory_clea
+00021470: 6e75 7028 7365 6c66 2c20 6361 7066 6429  nup(self, capfd)
+00021480: 3a0a 2020 2020 2020 2020 2320 7275 6e20  :.        # run 
+00021490: 6675 6e63 7469 6f6e 2077 6869 6368 2072  function which r
+000214a0: 6561 6473 2031 3030 7820 6672 6f6d 2061  eads 100x from a
+000214b0: 2034 304d 4220 7465 7374 2061 7272 6179   40MB test array
+000214c0: 0a20 2020 2020 2020 2023 2054 4f44 4f3a  .        # TODO:
+000214d0: 2052 5353 2069 7320 746f 6f20 6c6f 6f73   RSS is too loos
+000214e0: 6520 746f 2064 6f20 7468 6973 2065 6e64  e to do this end
+000214f0: 2d74 6f2d 656e 642c 2073 6f20 7368 6f75  -to-end, so shou
+00021500: 6c64 2075 7365 2069 6e73 7472 756d 656e  ld use instrumen
+00021510: 7461 7469 6f6e 2e0a 2020 2020 2020 2020  tation..        
+00021520: 7072 696e 7428 2253 7461 7274 696e 6720  print("Starting 
+00021530: 5469 6c65 4442 2d50 7920 6d65 6d6f 7279  TileDB-Py memory
+00021540: 2074 6573 743a 2229 0a20 2020 2020 2020   test:").       
+00021550: 2069 6e69 7469 616c 203d 2073 656c 662e   initial = self.
+00021560: 7573 655f 6d61 6e79 5f62 7566 6665 7273  use_many_buffers
+00021570: 2873 656c 662e 7061 7468 2822 7465 7374  (self.path("test
+00021580: 5f6d 656d 6f72 795f 636c 6561 6e75 7022  _memory_cleanup"
+00021590: 2929 0a0a 2020 2020 2020 2020 7072 6f63  ))..        proc
+000215a0: 6573 7320 3d20 7073 7574 696c 2e50 726f  ess = psutil.Pro
+000215b0: 6365 7373 286f 732e 6765 7470 6964 2829  cess(os.getpid()
+000215c0: 290a 2020 2020 2020 2020 6669 6e61 6c20  ).        final 
+000215d0: 3d20 7072 6f63 6573 732e 6d65 6d6f 7279  = process.memory
+000215e0: 5f69 6e66 6f28 292e 7273 730a 2020 2020  _info().rss.    
+000215f0: 2020 2020 7072 696e 7428 2220 2066 696e      print("  fin
+00021600: 616c 2052 5353 3a20 7b7d 222e 666f 726d  al RSS: {}".form
+00021610: 6174 2872 6f75 6e64 2866 696e 616c 202f  at(round(final /
+00021620: 2028 3130 202a 2a20 3629 292c 2032 2929   (10 ** 6)), 2))
+00021630: 0a0a 2020 2020 2020 2020 6763 2e63 6f6c  ..        gc.col
+00021640: 6c65 6374 2829 0a0a 2020 2020 2020 2020  lect()..        
+00021650: 6669 6e61 6c5f 6763 203d 2070 726f 6365  final_gc = proce
+00021660: 7373 2e6d 656d 6f72 795f 696e 666f 2829  ss.memory_info()
+00021670: 2e72 7373 0a20 2020 2020 2020 2070 7269  .rss.        pri
+00021680: 6e74 2822 2020 6669 6e61 6c20 5253 5320  nt("  final RSS 
+00021690: 6166 7465 7220 666f 7263 6564 2047 433a  after forced GC:
+000216a0: 207b 7d22 2e66 6f72 6d61 7428 726f 756e   {}".format(roun
+000216b0: 6428 6669 6e61 6c5f 6763 202f 2028 3130  d(final_gc / (10
+000216c0: 202a 2a20 3629 292c 2032 2929 0a0a 2020   ** 6)), 2))..  
+000216d0: 2020 2020 2020 6173 7365 7274 5f63 6170        assert_cap
+000216e0: 7475 7265 6428 6361 7066 642c 2022 6669  tured(capfd, "fi
+000216f0: 6e61 6c20 5253 5322 290a 2020 2020 2020  nal RSS").      
+00021700: 2020 7365 6c66 2e61 7373 6572 7454 7275    self.assertTru
+00021710: 6528 6669 6e61 6c20 3c20 2832 202a 2069  e(final < (2 * i
+00021720: 6e69 7469 616c 2929 0a0a 0a63 6c61 7373  nitial))...class
+00021730: 2054 6573 7448 6967 686c 6576 656c 2844   TestHighlevel(D
+00021740: 6973 6b54 6573 7443 6173 6529 3a0a 2020  iskTestCase):.  
+00021750: 2020 6465 6620 7465 7374 5f6f 7065 6e28    def test_open(
+00021760: 7365 6c66 293a 0a20 2020 2020 2020 2075  self):.        u
+00021770: 7269 203d 2073 656c 662e 7061 7468 2822  ri = self.path("
+00021780: 7465 7374 5f6f 7065 6e22 290a 2020 2020  test_open").    
+00021790: 2020 2020 6172 7261 7920 3d20 6e70 2e72      array = np.r
+000217a0: 616e 646f 6d2e 7261 6e64 2831 3029 0a20  andom.rand(10). 
+000217b0: 2020 2020 2020 2073 6368 656d 6120 3d20         schema = 
+000217c0: 7469 6c65 6462 2e73 6368 656d 615f 6c69  tiledb.schema_li
+000217d0: 6b65 2861 7272 6179 290a 2020 2020 2020  ke(array).      
+000217e0: 2020 7469 6c65 6462 2e41 7272 6179 2e63    tiledb.Array.c
+000217f0: 7265 6174 6528 7572 692c 2073 6368 656d  reate(uri, schem
+00021800: 6129 0a20 2020 2020 2020 2077 6974 6820  a).        with 
+00021810: 7469 6c65 6462 2e6f 7065 6e28 7572 692c  tiledb.open(uri,
+00021820: 2022 7722 2920 6173 2041 3a0a 2020 2020   "w") as A:.    
+00021830: 2020 2020 2020 2020 415b 3a5d 203d 2061          A[:] = a
+00021840: 7272 6179 202a 2031 300a 2020 2020 2020  rray * 10.      
+00021850: 2020 2020 2020 415b 3a5d 203d 2061 7272        A[:] = arr
+00021860: 6179 0a20 2020 2020 2020 2020 2020 206c  ay.            l
+00021870: 6173 745f 6672 6167 6d65 6e74 5f74 7320  ast_fragment_ts 
+00021880: 3d20 6c69 7374 2841 2e6c 6173 745f 7772  = list(A.last_wr
+00021890: 6974 655f 696e 666f 2e69 7465 6d73 2829  ite_info.items()
+000218a0: 295b 305d 5b31 5d5b 305d 0a0a 2020 2020  )[0][1][0]..    
+000218b0: 2020 2020 6374 7820 3d20 7469 6c65 6462      ctx = tiledb
+000218c0: 2e43 7478 2829 0a20 2020 2020 2020 2077  .Ctx().        w
+000218d0: 6974 6820 7469 6c65 6462 2e44 656e 7365  ith tiledb.Dense
+000218e0: 4172 7261 7928 7572 692c 2063 7478 3d63  Array(uri, ctx=c
+000218f0: 7478 2920 6173 2041 3a0a 2020 2020 2020  tx) as A:.      
+00021900: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00021910: 7445 7175 616c 2841 2e5f 6374 785f 2829  tEqual(A._ctx_()
+00021920: 2c20 6374 7829 0a0a 2020 2020 2020 2020  , ctx)..        
+00021930: 2320 7465 7374 2060 6f70 656e 6020 7769  # test `open` wi
+00021940: 7468 2074 696d 6573 7461 6d70 0a20 2020  th timestamp.   
+00021950: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+00021960: 2e6f 7065 6e28 7572 692c 2074 696d 6573  .open(uri, times
+00021970: 7461 6d70 3d6c 6173 745f 6672 6167 6d65  tamp=last_fragme
+00021980: 6e74 5f74 7329 2061 7320 413a 0a20 2020  nt_ts) as A:.   
+00021990: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+000219a0: 6172 7261 795f 6571 7561 6c28 415b 3a5d  array_equal(A[:]
+000219b0: 2c20 6172 7261 7929 0a0a 2020 2020 2020  , array)..      
+000219c0: 2020 7769 7468 2074 696c 6564 622e 6f70    with tiledb.op
+000219d0: 656e 2875 7269 2c20 6374 783d 6374 7829  en(uri, ctx=ctx)
+000219e0: 2061 7320 413a 0a20 2020 2020 2020 2020   as A:.         
+000219f0: 2020 2073 656c 662e 6173 7365 7274 4571     self.assertEq
+00021a00: 7561 6c28 412e 5f63 7478 5f28 292c 2063  ual(A._ctx_(), c
+00021a10: 7478 290a 0a20 2020 2020 2020 2063 6f6e  tx)..        con
+00021a20: 6669 6720 3d20 7469 6c65 6462 2e43 6f6e  fig = tiledb.Con
+00021a30: 6669 6728 290a 2020 2020 2020 2020 7769  fig().        wi
+00021a40: 7468 2074 696c 6564 622e 6f70 656e 2875  th tiledb.open(u
+00021a50: 7269 2c20 636f 6e66 6967 3d63 6f6e 6669  ri, config=confi
+00021a60: 6729 2061 7320 413a 0a20 2020 2020 2020  g) as A:.       
+00021a70: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00021a80: 4571 7561 6c28 412e 5f63 7478 5f28 292e  Equal(A._ctx_().
+00021a90: 636f 6e66 6967 2829 2c20 636f 6e66 6967  config(), config
+00021aa0: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
+00021ab0: 7365 6c66 2e61 7373 6572 7452 6169 7365  self.assertRaise
+00021ac0: 7328 4b65 7945 7272 6f72 293a 0a20 2020  s(KeyError):.   
+00021ad0: 2020 2020 2020 2020 2023 2054 6869 7320           # This 
+00021ae0: 7061 7468 206d 7573 7420 7465 7374 2060  path must test `
+00021af0: 7469 6c65 6462 2e6f 7065 6e60 2073 7065  tiledb.open` spe
+00021b00: 6369 6669 6361 6c6c 790a 2020 2020 2020  cifically.      
+00021b10: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
+00021b20: 6769 7468 7562 2e63 6f6d 2f54 696c 6544  github.com/TileD
+00021b30: 422d 496e 632f 5469 6c65 4442 2d50 792f  B-Inc/TileDB-Py/
+00021b40: 6973 7375 6573 2f32 3737 0a20 2020 2020  issues/277.     
+00021b50: 2020 2020 2020 2074 696c 6564 622e 6f70         tiledb.op
+00021b60: 656e 2875 7269 2c20 2272 222c 2061 7474  en(uri, "r", att
+00021b70: 723d 2274 6865 2d6d 6973 7369 6e67 2d61  r="the-missing-a
+00021b80: 7474 7222 290a 0a20 2020 2064 6566 2074  ttr")..    def t
+00021b90: 6573 745f 6374 785f 7468 7265 6164 5f63  est_ctx_thread_c
+00021ba0: 6c65 616e 7570 2873 656c 6629 3a0a 2020  leanup(self):.  
+00021bb0: 2020 2020 2020 2320 5468 6973 2074 6573        # This tes
+00021bc0: 7420 6368 6563 6b73 2074 6861 7420 636f  t checks that co
+00021bd0: 6e74 6578 7473 2061 7265 2064 6573 7472  ntexts are destr
+00021be0: 6f79 6564 2063 6f72 7265 6374 6c79 2e0a  oyed correctly..
+00021bf0: 2020 2020 2020 2020 2320 4974 2063 7265          # It cre
+00021c00: 6174 6573 206e 6577 2063 6f6e 7465 7874  ates new context
+00021c10: 7320 7265 7065 6174 6564 6c79 2c20 696e  s repeatedly, in
+00021c20: 2d70 726f 6365 7373 2c20 616e 640a 2020  -process, and.  
+00021c30: 2020 2020 2020 2320 6368 6563 6b73 2074        # checks t
+00021c40: 6861 7420 7468 6520 746f 7461 6c20 6e75  hat the total nu
+00021c50: 6d62 6572 206f 6620 7468 7265 6164 7320  mber of threads 
+00021c60: 7374 6179 7320 7374 6162 6c65 2e0a 2020  stays stable..  
+00021c70: 2020 2020 2020 636f 6e66 6967 203d 207b        config = {
+00021c80: 2273 6d2e 6e75 6d5f 7265 6164 6572 5f74  "sm.num_reader_t
+00021c90: 6872 6561 6473 223a 2031 3238 7d0a 2020  hreads": 128}.  
+00021ca0: 2020 2020 2020 6c6c 203d 206c 6973 7428        ll = list(
+00021cb0: 290a 2020 2020 2020 2020 7572 6920 3d20  ).        uri = 
+00021cc0: 7365 6c66 2e70 6174 6828 2274 6573 745f  self.path("test_
+00021cd0: 6374 785f 7468 7265 6164 5f63 6c65 616e  ctx_thread_clean
+00021ce0: 7570 2229 0a20 2020 2020 2020 2077 6974  up").        wit
+00021cf0: 6820 7469 6c65 6462 2e66 726f 6d5f 6e75  h tiledb.from_nu
+00021d00: 6d70 7928 7572 692c 206e 702e 7261 6e64  mpy(uri, np.rand
+00021d10: 6f6d 2e72 616e 6428 3130 3029 2920 6173  om.rand(100)) as
+00021d20: 2041 3a0a 2020 2020 2020 2020 2020 2020   A:.            
+00021d30: 7061 7373 0a0a 2020 2020 2020 2020 7468  pass..        th
+00021d40: 6973 7072 6f63 203d 2070 7375 7469 6c2e  isproc = psutil.
+00021d50: 5072 6f63 6573 7328 6f73 2e67 6574 7069  Process(os.getpi
+00021d60: 6428 2929 0a0a 2020 2020 2020 2020 666f  d())..        fo
+00021d70: 7220 6e20 696e 2072 616e 6765 2830 2c20  r n in range(0, 
+00021d80: 3130 293a 0a20 2020 2020 2020 2020 2020  10):.           
+00021d90: 2069 6620 6e20 3e20 303a 0a20 2020 2020   if n > 0:.     
+00021da0: 2020 2020 2020 2020 2020 2072 6574 7279             retry
+00021db0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+00021dc0: 2020 2020 2077 6869 6c65 2072 6574 7279       while retry
+00021dd0: 203c 2033 3a0a 2020 2020 2020 2020 2020   < 3:.          
+00021de0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00021df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021e00: 2020 2020 2020 2023 2063 6865 636b 696e         # checkin
+00021e10: 6720 6578 6163 7420 7468 7265 6164 2063  g exact thread c
+00021e20: 6f75 6e74 2069 7320 756e 7265 6c69 6162  ount is unreliab
+00021e30: 6c65 2c20 736f 0a20 2020 2020 2020 2020  le, so.         
+00021e40: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00021e50: 206d 616b 6520 7375 7265 2077 6520 6172   make sure we ar
+00021e60: 6520 686f 6c64 696e 6720 3c20 3278 2070  e holding < 2x p
+00021e70: 6572 2072 756e 2e0a 2020 2020 2020 2020  er run..        
+00021e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021e90: 7365 6c66 2e61 7373 6572 7454 7275 6528  self.assertTrue(
+00021ea0: 6c65 6e28 7468 6973 7072 6f63 2e74 6872  len(thisproc.thr
+00021eb0: 6561 6473 2829 2920 3c20 3220 2a20 7374  eads()) < 2 * st
+00021ec0: 6172 745f 7468 7265 6164 7329 0a20 2020  art_threads).   
+00021ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021ee0: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+00021ef0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00021f00: 7863 6570 7420 4173 7365 7274 696f 6e45  xcept AssertionE
+00021f10: 7272 6f72 2061 7320 6578 633a 0a20 2020  rror as exc:.   
+00021f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021f30: 2020 2020 2072 6169 7365 2065 7863 0a20       raise exc. 
+00021f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021f50: 2020 2065 7863 6570 7420 5275 6e74 696d     except Runtim
+00021f60: 6545 7272 6f72 2061 7320 7274 6572 723a  eError as rterr:
+00021f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021f80: 2020 2020 2020 2020 2072 6574 7279 202b           retry +
+00021f90: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00021fa0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00021fb0: 6574 7279 203e 2032 3a0a 2020 2020 2020  etry > 2:.      
+00021fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021fd0: 2020 2020 2020 7261 6973 6520 7274 6572        raise rter
+00021fe0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+00021ff0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00022000: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
+00022010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022020: 2020 2020 2022 5468 7265 6164 2063 6c65       "Thread cle
+00022030: 616e 7570 2074 6573 7420 5275 6e74 696d  anup test Runtim
+00022040: 6545 7272 6f72 3a20 7b7d 205c 6e20 2020  eError: {} \n   
+00022050: 206f 6e20 6974 6572 6174 696f 6e3a 207b   on iteration: {
+00022060: 7d22 2e66 6f72 6d61 7428 0a20 2020 2020  }".format(.     
+00022070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022080: 2020 2020 2020 2020 2020 2073 7472 2872             str(r
+00022090: 7465 7272 292c 206e 0a20 2020 2020 2020  terr), n.       
+000220a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000220b0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000220c0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000220d0: 0a0a 2020 2020 2020 2020 2020 2020 7769  ..            wi
+000220e0: 7468 2074 696c 6564 622e 4465 6e73 6541  th tiledb.DenseA
+000220f0: 7272 6179 2875 7269 2c20 6374 783d 7469  rray(uri, ctx=ti
+00022100: 6c65 6462 2e43 7478 2863 6f6e 6669 6729  ledb.Ctx(config)
+00022110: 2920 6173 2041 3a0a 2020 2020 2020 2020  ) as A:.        
+00022120: 2020 2020 2020 2020 7265 7320 3d20 415b          res = A[
+00022130: 3a5d 0a0a 2020 2020 2020 2020 2020 2020  :]..            
+00022140: 6966 206e 203d 3d20 303a 0a20 2020 2020  if n == 0:.     
+00022150: 2020 2020 2020 2020 2020 2073 7461 7274             start
+00022160: 5f74 6872 6561 6473 203d 206c 656e 2874  _threads = len(t
+00022170: 6869 7370 726f 632e 7468 7265 6164 7328  hisproc.threads(
+00022180: 2929 0a0a 0a23 2057 7261 7070 6572 2074  ))...# Wrapper t
+00022190: 6f20 6578 6563 7574 6520 7370 6563 6966  o execute specif
+000221a0: 6963 2063 6f64 6520 696e 2073 7562 7072  ic code in subpr
+000221b0: 6f63 6573 7320 736f 2074 6861 7420 7765  ocess so that we
+000221c0: 2063 616e 2065 6e73 7572 6520 7468 6520   can ensure the 
+000221d0: 7468 7265 6164 2063 6f75 6e74 0a23 2069  thread count.# i
+000221e0: 6e69 7420 6973 2063 6f72 7265 6374 2e20  nit is correct. 
+000221f0: 4e65 6365 7373 6172 7920 6265 6361 7573  Necessary becaus
+00022200: 6520 6d75 6c74 6970 726f 6365 7373 2e67  e multiprocess.g
+00022210: 6574 5f63 6f6e 7465 7874 2069 7320 6f6e  et_context is on
+00022220: 6c79 2061 7661 696c 6162 6c65 2069 6e20  ly available in 
+00022230: 5079 7468 6f6e 2033 2e34 2b2c 0a23 2061  Python 3.4+,.# a
+00022240: 6e64 2074 6865 206d 756c 7469 7072 6f63  nd the multiproc
+00022250: 6573 7369 6e67 206d 6574 686f 6420 6d61  essing method ma
+00022260: 7920 6265 2073 6574 2074 6f20 666f 726b  y be set to fork
+00022270: 2062 7920 6f74 6865 7220 7465 7374 7320   by other tests 
+00022280: 2865 2e67 2e20 6461 736b 292e 0a64 6566  (e.g. dask)..def
+00022290: 2069 6e69 745f 7465 7374 5f77 7261 7070   init_test_wrapp
+000222a0: 6572 2863 6667 3d4e 6f6e 6529 3a0a 2020  er(cfg=None):.  
+000222b0: 2020 7079 7468 6f6e 5f65 7865 203d 2073    python_exe = s
+000222c0: 7973 2e65 7865 6375 7461 626c 650a 2020  ys.executable.  
+000222d0: 2020 636d 6420 3d20 2266 726f 6d20 7465    cmd = "from te
+000222e0: 7374 5f6c 6962 7469 6c65 6462 2069 6d70  st_libtiledb imp
+000222f0: 6f72 7420 2a3b 2069 6e69 745f 7465 7374  ort *; init_test
+00022300: 5f68 656c 7065 7228 7b7d 2922 2e66 6f72  _helper({})".for
+00022310: 6d61 7428 6366 6729 0a20 2020 2074 6573  mat(cfg).    tes
+00022320: 745f 7061 7468 203d 206f 732e 7061 7468  t_path = os.path
+00022330: 2e64 6972 6e61 6d65 286f 732e 7061 7468  .dirname(os.path
+00022340: 2e61 6273 7061 7468 285f 5f66 696c 655f  .abspath(__file_
+00022350: 5f29 290a 0a20 2020 2073 705f 6f75 7470  _))..    sp_outp
+00022360: 7574 203d 2073 7562 7072 6f63 6573 732e  ut = subprocess.
+00022370: 6368 6563 6b5f 6f75 7470 7574 285b 7079  check_output([py
+00022380: 7468 6f6e 5f65 7865 2c20 222d 6322 2c20  thon_exe, "-c", 
+00022390: 636d 645d 2c20 6377 643d 7465 7374 5f70  cmd], cwd=test_p
+000223a0: 6174 6829 0a20 2020 2072 6574 7572 6e20  ath).    return 
+000223b0: 696e 7428 7370 5f6f 7574 7075 742e 6465  int(sp_output.de
+000223c0: 636f 6465 2822 5554 462d 3822 292e 7374  code("UTF-8").st
+000223d0: 7269 7028 2929 0a0a 0a64 6566 2069 6e69  rip())...def ini
+000223e0: 745f 7465 7374 5f68 656c 7065 7228 6366  t_test_helper(cf
+000223f0: 673d 4e6f 6e65 293a 0a20 2020 2074 696c  g=None):.    til
+00022400: 6564 622e 6c69 6274 696c 6564 622e 6465  edb.libtiledb.de
+00022410: 6661 756c 745f 6374 7828 6366 6729 0a20  fault_ctx(cfg). 
+00022420: 2020 2063 6f6e 6375 7272 656e 6379 5f6c     concurrency_l
+00022430: 6576 656c 203d 2074 696c 6564 622e 6465  evel = tiledb.de
+00022440: 6661 756c 745f 6374 7828 292e 636f 6e66  fault_ctx().conf
+00022450: 6967 2829 5b22 736d 2e69 6f5f 636f 6e63  ig()["sm.io_conc
+00022460: 7572 7265 6e63 795f 6c65 7665 6c22 5d0a  urrency_level"].
+00022470: 2020 2020 7072 696e 7428 696e 7428 636f      print(int(co
+00022480: 6e63 7572 7265 6e63 795f 6c65 7665 6c29  ncurrency_level)
+00022490: 290a 0a0a 636c 6173 7320 436f 6e74 6578  )...class Contex
+000224a0: 7454 6573 7428 756e 6974 7465 7374 2e54  tTest(unittest.T
+000224b0: 6573 7443 6173 6529 3a0a 2020 2020 6465  estCase):.    de
+000224c0: 6620 7465 7374 5f64 6566 6175 6c74 5f63  f test_default_c
+000224d0: 7478 2873 656c 6629 3a0a 2020 2020 2020  tx(self):.      
+000224e0: 2020 6374 7820 3d20 7469 6c65 6462 2e64    ctx = tiledb.d
+000224f0: 6566 6175 6c74 5f63 7478 2829 0a20 2020  efault_ctx().   
+00022500: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00022510: 4973 496e 7374 616e 6365 2863 7478 2c20  IsInstance(ctx, 
+00022520: 7469 6c65 6462 2e43 7478 290a 2020 2020  tiledb.Ctx).    
+00022530: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
+00022540: 7461 6e63 6528 6374 782e 636f 6e66 6967  tance(ctx.config
+00022550: 2829 2c20 7469 6c65 6462 2e6c 6962 7469  (), tiledb.libti
+00022560: 6c65 6462 2e43 6f6e 6669 6729 0a0a 2020  ledb.Config)..  
+00022570: 2020 6465 6620 7465 7374 5f73 636f 7065    def test_scope
+00022580: 5f63 7478 2873 656c 6629 3a0a 2020 2020  _ctx(self):.    
+00022590: 2020 2020 6b65 7920 3d20 2273 6d2e 7469      key = "sm.ti
+000225a0: 6c65 5f63 6163 6865 5f73 697a 6522 0a20  le_cache_size". 
+000225b0: 2020 2020 2020 2063 7478 3020 3d20 7469         ctx0 = ti
+000225c0: 6c65 6462 2e64 6566 6175 6c74 5f63 7478  ledb.default_ctx
+000225d0: 2829 0a20 2020 2020 2020 206e 6577 5f63  ().        new_c
+000225e0: 6f6e 6669 675f 6469 6374 203d 207b 6b65  onfig_dict = {ke
+000225f0: 793a 2034 327d 0a20 2020 2020 2020 206e  y: 42}.        n
+00022600: 6577 5f63 6f6e 6669 6720 3d20 7469 6c65  ew_config = tile
+00022610: 6462 2e43 6f6e 6669 6728 7b6b 6579 3a20  db.Config({key: 
+00022620: 3738 7d29 0a20 2020 2020 2020 206e 6577  78}).        new
+00022630: 5f63 7478 203d 2074 696c 6564 622e 4374  _ctx = tiledb.Ct
+00022640: 7828 7b6b 6579 3a20 3631 7d29 0a0a 2020  x({key: 61})..  
+00022650: 2020 2020 2020 6173 7365 7274 2074 696c        assert til
+00022660: 6564 622e 6465 6661 756c 745f 6374 7828  edb.default_ctx(
+00022670: 2920 6973 2063 7478 300a 2020 2020 2020  ) is ctx0.      
+00022680: 2020 6173 7365 7274 2074 696c 6564 622e    assert tiledb.
+00022690: 6465 6661 756c 745f 6374 7828 292e 636f  default_ctx().co
+000226a0: 6e66 6967 2829 5b6b 6579 5d20 3d3d 2022  nfig()[key] == "
+000226b0: 3130 3030 3030 3030 220a 0a20 2020 2020  10000000"..     
+000226c0: 2020 2077 6974 6820 7469 6c65 6462 2e73     with tiledb.s
+000226d0: 636f 7065 5f63 7478 286e 6577 5f63 6f6e  cope_ctx(new_con
+000226e0: 6669 675f 6469 6374 2920 6173 2063 7478  fig_dict) as ctx
+000226f0: 313a 0a20 2020 2020 2020 2020 2020 2061  1:.            a
+00022700: 7373 6572 7420 7469 6c65 6462 2e64 6566  ssert tiledb.def
+00022710: 6175 6c74 5f63 7478 2829 2069 7320 6374  ault_ctx() is ct
+00022720: 7831 0a20 2020 2020 2020 2020 2020 2061  x1.            a
+00022730: 7373 6572 7420 7469 6c65 6462 2e64 6566  ssert tiledb.def
+00022740: 6175 6c74 5f63 7478 2829 2e63 6f6e 6669  ault_ctx().confi
+00022750: 6728 295b 6b65 795d 203d 3d20 2234 3222  g()[key] == "42"
+00022760: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00022770: 6820 7469 6c65 6462 2e73 636f 7065 5f63  h tiledb.scope_c
+00022780: 7478 286e 6577 5f63 6f6e 6669 6729 2061  tx(new_config) a
+00022790: 7320 6374 7832 3a0a 2020 2020 2020 2020  s ctx2:.        
+000227a0: 2020 2020 2020 2020 6173 7365 7274 2074          assert t
+000227b0: 696c 6564 622e 6465 6661 756c 745f 6374  iledb.default_ct
+000227c0: 7828 2920 6973 2063 7478 320a 2020 2020  x() is ctx2.    
+000227d0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+000227e0: 7274 2074 696c 6564 622e 6465 6661 756c  rt tiledb.defaul
+000227f0: 745f 6374 7828 292e 636f 6e66 6967 2829  t_ctx().config()
+00022800: 5b6b 6579 5d20 3d3d 2022 3738 220a 2020  [key] == "78".  
+00022810: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+00022820: 7468 2074 696c 6564 622e 7363 6f70 655f  th tiledb.scope_
+00022830: 6374 7828 6e65 775f 6374 7829 2061 7320  ctx(new_ctx) as 
+00022840: 6374 7833 3a0a 2020 2020 2020 2020 2020  ctx3:.          
+00022850: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00022860: 2074 696c 6564 622e 6465 6661 756c 745f   tiledb.default_
+00022870: 6374 7828 2920 6973 2063 7478 3320 6973  ctx() is ctx3 is
+00022880: 206e 6577 5f63 7478 0a20 2020 2020 2020   new_ctx.       
+00022890: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+000228a0: 6572 7420 7469 6c65 6462 2e64 6566 6175  ert tiledb.defau
+000228b0: 6c74 5f63 7478 2829 2e63 6f6e 6669 6728  lt_ctx().config(
+000228c0: 295b 6b65 795d 203d 3d20 2236 3122 0a20  )[key] == "61". 
+000228d0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000228e0: 7373 6572 7420 7469 6c65 6462 2e64 6566  ssert tiledb.def
+000228f0: 6175 6c74 5f63 7478 2829 2069 7320 6374  ault_ctx() is ct
+00022900: 7832 0a20 2020 2020 2020 2020 2020 2020  x2.             
+00022910: 2020 2061 7373 6572 7420 7469 6c65 6462     assert tiledb
+00022920: 2e64 6566 6175 6c74 5f63 7478 2829 2e63  .default_ctx().c
+00022930: 6f6e 6669 6728 295b 6b65 795d 203d 3d20  onfig()[key] == 
+00022940: 2237 3822 0a20 2020 2020 2020 2020 2020  "78".           
+00022950: 2061 7373 6572 7420 7469 6c65 6462 2e64   assert tiledb.d
+00022960: 6566 6175 6c74 5f63 7478 2829 2069 7320  efault_ctx() is 
+00022970: 6374 7831 0a20 2020 2020 2020 2020 2020  ctx1.           
+00022980: 2061 7373 6572 7420 7469 6c65 6462 2e64   assert tiledb.d
+00022990: 6566 6175 6c74 5f63 7478 2829 2e63 6f6e  efault_ctx().con
+000229a0: 6669 6728 295b 6b65 795d 203d 3d20 2234  fig()[key] == "4
+000229b0: 3222 0a0a 2020 2020 2020 2020 6173 7365  2"..        asse
+000229c0: 7274 2074 696c 6564 622e 6465 6661 756c  rt tiledb.defaul
+000229d0: 745f 6374 7828 2920 6973 2063 7478 300a  t_ctx() is ctx0.
+000229e0: 2020 2020 2020 2020 6173 7365 7274 2074          assert t
+000229f0: 696c 6564 622e 6465 6661 756c 745f 6374  iledb.default_ct
+00022a00: 7828 292e 636f 6e66 6967 2829 5b6b 6579  x().config()[key
+00022a10: 5d20 3d3d 2022 3130 3030 3030 3030 220a  ] == "10000000".
+00022a20: 0a20 2020 2040 7079 7465 7374 2e6d 6172  .    @pytest.mar
+00022a30: 6b2e 736b 6970 6966 280a 2020 2020 2020  k.skipif(.      
+00022a40: 2020 2270 7974 6573 742e 7469 6c65 6462    "pytest.tiledb
+00022a50: 5f76 6673 203d 3d20 2773 3327 222c 2072  _vfs == 's3'", r
+00022a60: 6561 736f 6e3d 2254 6573 7420 6e6f 7420  eason="Test not 
+00022a70: 7965 7420 7375 7070 6f72 7465 6420 7769  yet supported wi
+00022a80: 7468 2053 3322 0a20 2020 2029 0a20 2020  th S3".    ).   
+00022a90: 2064 6566 2074 6573 745f 696e 6974 5f63   def test_init_c
+00022aa0: 6f6e 6669 6728 7365 6c66 293a 0a20 2020  onfig(self):.   
+00022ab0: 2020 2020 2073 656c 662e 6173 7365 7274       self.assert
+00022ac0: 4571 7561 6c28 0a20 2020 2020 2020 2020  Equal(.         
+00022ad0: 2020 2069 6e74 2874 696c 6564 622e 6465     int(tiledb.de
+00022ae0: 6661 756c 745f 6374 7828 292e 636f 6e66  fault_ctx().conf
+00022af0: 6967 2829 5b22 736d 2e69 6f5f 636f 6e63  ig()["sm.io_conc
+00022b00: 7572 7265 6e63 795f 6c65 7665 6c22 5d29  urrency_level"])
+00022b10: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
+00022b20: 6974 5f74 6573 745f 7772 6170 7065 7228  it_test_wrapper(
+00022b30: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+00022b40: 2020 2020 2020 7365 6c66 2e61 7373 6572        self.asser
+00022b50: 7445 7175 616c 2833 2c20 696e 6974 5f74  tEqual(3, init_t
+00022b60: 6573 745f 7772 6170 7065 7228 7b22 736d  est_wrapper({"sm
+00022b70: 2e69 6f5f 636f 6e63 7572 7265 6e63 795f  .io_concurrency_
+00022b80: 6c65 7665 6c22 3a20 337d 2929 0a0a 0a63  level": 3}))...c
+00022b90: 6c61 7373 2052 6570 7254 6573 7428 4469  lass ReprTest(Di
+00022ba0: 736b 5465 7374 4361 7365 293a 0a20 2020  skTestCase):.   
+00022bb0: 2064 6566 2074 6573 745f 6174 7472 5f72   def test_attr_r
+00022bc0: 6570 7228 7365 6c66 293a 0a20 2020 2020  epr(self):.     
+00022bd0: 2020 2061 7474 7220 3d20 7469 6c65 6462     attr = tiledb
+00022be0: 2e41 7474 7228 6e61 6d65 3d22 6974 7361  .Attr(name="itsa
+00022bf0: 6e61 7474 7222 2c20 6474 7970 653d 6e70  nattr", dtype=np
+00022c00: 2e66 6c6f 6174 3634 290a 2020 2020 2020  .float64).      
+00022c10: 2020 7365 6c66 2e61 7373 6572 7454 7275    self.assertTru
+00022c20: 6528 0a20 2020 2020 2020 2020 2020 2072  e(.            r
+00022c30: 652e 6d61 7463 6828 0a20 2020 2020 2020  e.match(.       
+00022c40: 2020 2020 2020 2020 2072 2241 7474 725c           r"Attr\
+00022c50: 286e 616d 653d 5b75 5d3f 2769 7473 616e  (name=[u]?'itsan
+00022c60: 6174 7472 272c 2064 7479 7065 3d27 666c  attr', dtype='fl
+00022c70: 6f61 7436 3427 2c20 7661 723d 4661 6c73  oat64', var=Fals
+00022c80: 652c 206e 756c 6c61 626c 653d 4661 6c73  e, nullable=Fals
+00022c90: 655c 2922 2c0a 2020 2020 2020 2020 2020  e\)",.          
+00022ca0: 2020 2020 2020 7265 7072 2861 7474 7229        repr(attr)
+00022cb0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00022cc0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00022cd0: 2020 2067 203d 2064 6963 7428 290a 2020     g = dict().  
+00022ce0: 2020 2020 2020 6578 6563 2822 6672 6f6d        exec("from
+00022cf0: 2074 696c 6564 6220 696d 706f 7274 2041   tiledb import A
+00022d00: 7474 723b 2066 726f 6d20 6e75 6d70 7920  ttr; from numpy 
+00022d10: 696d 706f 7274 2066 6c6f 6174 3634 222c  import float64",
+00022d20: 2067 290a 2020 2020 2020 2020 7365 6c66   g).        self
+00022d30: 2e61 7373 6572 7445 7175 616c 2865 7661  .assertEqual(eva
+00022d40: 6c28 7265 7072 2861 7474 7229 2c20 6729  l(repr(attr), g)
+00022d50: 2c20 6174 7472 290a 0a20 2020 2064 6566  , attr)..    def
+00022d60: 2074 6573 745f 6172 7261 7973 6368 656d   test_arrayschem
+00022d70: 615f 7265 7072 2873 656c 662c 2073 7061  a_repr(self, spa
+00022d80: 7273 655f 6365 6c6c 5f6f 7264 6572 293a  rse_cell_order):
+00022d90: 0a20 2020 2020 2020 2066 696c 7465 7273  .        filters
+00022da0: 203d 2074 696c 6564 622e 4669 6c74 6572   = tiledb.Filter
+00022db0: 4c69 7374 285b 7469 6c65 6462 2e5a 7374  List([tiledb.Zst
+00022dc0: 6446 696c 7465 7228 2d31 295d 290a 2020  dFilter(-1)]).  
+00022dd0: 2020 2020 2020 666f 7220 7370 6172 7365        for sparse
+00022de0: 2069 6e20 5b46 616c 7365 2c20 5472 7565   in [False, True
+00022df0: 5d3a 0a20 2020 2020 2020 2020 2020 2063  ]:.            c
+00022e00: 656c 6c5f 6f72 6465 7220 3d20 7370 6172  ell_order = spar
+00022e10: 7365 5f63 656c 6c5f 6f72 6465 7220 6966  se_cell_order if
+00022e20: 2073 7061 7273 6520 656c 7365 204e 6f6e   sparse else Non
+00022e30: 650a 2020 2020 2020 2020 2020 2020 646f  e.            do
+00022e40: 6d61 696e 203d 2074 696c 6564 622e 446f  main = tiledb.Do
+00022e50: 6d61 696e 280a 2020 2020 2020 2020 2020  main(.          
+00022e60: 2020 2020 2020 7469 6c65 6462 2e44 696d        tiledb.Dim
+00022e70: 2864 6f6d 6169 6e3d 2831 2c20 3829 2c20  (domain=(1, 8), 
+00022e80: 7469 6c65 3d32 292c 2074 696c 6564 622e  tile=2), tiledb.
+00022e90: 4469 6d28 646f 6d61 696e 3d28 312c 2038  Dim(domain=(1, 8
+00022ea0: 292c 2074 696c 653d 3229 0a20 2020 2020  ), tile=2).     
+00022eb0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00022ec0: 2020 2020 2061 3120 3d20 7469 6c65 6462       a1 = tiledb
+00022ed0: 2e41 7474 7228 2276 616c 222c 2064 7479  .Attr("val", dty
+00022ee0: 7065 3d22 6638 222c 2066 696c 7465 7273  pe="f8", filters
+00022ef0: 3d66 696c 7465 7273 290a 2020 2020 2020  =filters).      
+00022f00: 2020 2020 2020 6f72 6967 5f73 6368 656d        orig_schem
+00022f10: 6120 3d20 7469 6c65 6462 2e41 7272 6179  a = tiledb.Array
+00022f20: 5363 6865 6d61 280a 2020 2020 2020 2020  Schema(.        
+00022f30: 2020 2020 2020 2020 646f 6d61 696e 3d64          domain=d
+00022f40: 6f6d 6169 6e2c 2061 7474 7273 3d28 6131  omain, attrs=(a1
+00022f50: 2c29 2c20 7370 6172 7365 3d73 7061 7273  ,), sparse=spars
+00022f60: 652c 2063 656c 6c5f 6f72 6465 723d 6365  e, cell_order=ce
+00022f70: 6c6c 5f6f 7264 6572 0a20 2020 2020 2020  ll_order.       
+00022f80: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00022f90: 2020 2020 7363 6865 6d61 5f72 6570 7220      schema_repr 
+00022fa0: 3d20 7265 7072 286f 7269 675f 7363 6865  = repr(orig_sche
+00022fb0: 6d61 290a 2020 2020 2020 2020 2020 2020  ma).            
+00022fc0: 6720 3d20 6469 6374 2829 0a20 2020 2020  g = dict().     
+00022fd0: 2020 2020 2020 2073 6574 7570 203d 2022         setup = "
+00022fe0: 6672 6f6d 2074 696c 6564 6220 696d 706f  from tiledb impo
+00022ff0: 7274 202a 5c6e 2220 2269 6d70 6f72 7420  rt *\n" "import 
+00023000: 6e75 6d70 7920 6173 206e 705c 6e22 0a0a  numpy as np\n"..
+00023010: 2020 2020 2020 2020 2020 2020 6578 6563              exec
+00023020: 2873 6574 7570 2c20 6729 0a20 2020 2020  (setup, g).     
+00023030: 2020 2020 2020 206e 6577 5f73 6368 656d         new_schem
+00023040: 6120 3d20 4e6f 6e65 0a20 2020 2020 2020  a = None.       
+00023050: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00023060: 2020 2020 2020 2020 2020 6e65 775f 7363            new_sc
+00023070: 6865 6d61 203d 2065 7661 6c28 7363 6865  hema = eval(sche
+00023080: 6d61 5f72 6570 722c 2067 290a 2020 2020  ma_repr, g).    
+00023090: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+000230a0: 7863 6570 7469 6f6e 2061 7320 6578 633a  xception as exc:
+000230b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000230c0: 2077 6172 6e5f 7374 7220 3d20 280a 2020   warn_str = (.  
+000230d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000230e0: 2020 2222 2245 7863 6570 7469 6f6e 2064    """Exception d
+000230f0: 7572 696e 6720 5265 7072 5465 7374 2073  uring ReprTest s
+00023100: 6368 656d 6120 6576 616c 2222 220a 2020  chema eval""".  
+00023110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023120: 2020 2b20 2222 222c 2073 6368 656d 6120    + """, schema 
+00023130: 7374 7269 6e67 2077 6173 3a5c 6e22 2222  string was:\n"""
+00023140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023150: 2020 2020 202b 2022 2222 2727 2722 2222       + """'''"""
+00023160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023170: 2020 2020 202b 2022 2222 5c6e 7b7d 5c6e       + """\n{}\n
+00023180: 2727 2722 2222 2e66 6f72 6d61 7428 7363  '''""".format(sc
+00023190: 6865 6d61 5f72 6570 7229 0a20 2020 2020  hema_repr).     
+000231a0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000231b0: 2020 2020 2020 2020 2020 2020 2077 6172               war
+000231c0: 6e69 6e67 732e 7761 726e 2877 6172 6e5f  nings.warn(warn_
+000231d0: 7374 7229 0a20 2020 2020 2020 2020 2020  str).           
+000231e0: 2020 2020 2072 6169 7365 0a0a 2020 2020       raise..    
+000231f0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00023200: 6572 7445 7175 616c 286e 6577 5f73 6368  ertEqual(new_sch
+00023210: 656d 612c 206f 7269 675f 7363 6865 6d61  ema, orig_schema
+00023220: 290a 0a20 2020 2064 6566 2074 6573 745f  )..    def test_
+00023230: 6172 7261 7973 6368 656d 615f 7265 7072  arrayschema_repr
+00023240: 5f68 696c 6265 7274 2873 656c 6629 3a0a  _hilbert(self):.
+00023250: 2020 2020 2020 2020 646f 6d61 696e 203d          domain =
+00023260: 2074 696c 6564 622e 446f 6d61 696e 2874   tiledb.Domain(t
+00023270: 696c 6564 622e 4469 6d28 646f 6d61 696e  iledb.Dim(domain
+00023280: 3d28 312c 2038 292c 2074 696c 653d 3229  =(1, 8), tile=2)
+00023290: 290a 2020 2020 2020 2020 6120 3d20 7469  ).        a = ti
+000232a0: 6c65 6462 2e41 7474 7228 2261 222c 2064  ledb.Attr("a", d
+000232b0: 7479 7065 3d22 6638 2229 0a20 2020 2020  type="f8").     
+000232c0: 2020 2073 6368 656d 6120 3d20 7469 6c65     schema = tile
+000232d0: 6462 2e41 7272 6179 5363 6865 6d61 280a  db.ArraySchema(.
+000232e0: 2020 2020 2020 2020 2020 2020 646f 6d61              doma
+000232f0: 696e 3d64 6f6d 6169 6e2c 2061 7474 7273  in=domain, attrs
+00023300: 3d28 612c 292c 2063 656c 6c5f 6f72 6465  =(a,), cell_orde
+00023310: 723d 2268 696c 6265 7274 222c 2073 7061  r="hilbert", spa
+00023320: 7273 653d 5472 7565 0a20 2020 2020 2020  rse=True.       
+00023330: 2029 0a0a 2020 2020 2020 2020 6173 7365   )..        asse
+00023340: 7274 2073 6368 656d 612e 6365 6c6c 5f6f  rt schema.cell_o
+00023350: 7264 6572 203d 3d20 2268 696c 6265 7274  rder == "hilbert
+00023360: 220a 2020 2020 2020 2020 6173 7365 7274  ".        assert
+00023370: 2073 6368 656d 612e 7469 6c65 5f6f 7264   schema.tile_ord
+00023380: 6572 203d 3d20 4e6f 6e65 0a0a 0a63 6c61  er == None...cla
+00023390: 7373 204e 756c 6c61 626c 6549 4f54 6573  ss NullableIOTes
+000233a0: 7428 4469 736b 5465 7374 4361 7365 293a  t(DiskTestCase):
+000233b0: 0a20 2020 2064 6566 2074 6573 745f 6e75  .    def test_nu
+000233c0: 6c6c 6162 6c65 5f77 7269 7465 2873 656c  llable_write(sel
+000233d0: 6629 3a0a 2020 2020 2020 2020 7572 6920  f):.        uri 
+000233e0: 3d20 7365 6c66 2e70 6174 6828 226e 756c  = self.path("nul
+000233f0: 6c61 626c 655f 7772 6974 655f 7465 7374  lable_write_test
+00023400: 2229 0a0a 2020 2020 2020 2020 7363 6865  ")..        sche
+00023410: 6d61 203d 2074 696c 6564 622e 4172 7261  ma = tiledb.Arra
+00023420: 7953 6368 656d 6128 0a20 2020 2020 2020  ySchema(.       
+00023430: 2020 2020 2064 6f6d 6169 6e3d 7469 6c65       domain=tile
+00023440: 6462 2e44 6f6d 6169 6e28 0a20 2020 2020  db.Domain(.     
+00023450: 2020 2020 2020 2020 2020 202a 5b74 696c             *[til
+00023460: 6564 622e 4469 6d28 6e61 6d65 3d22 5f5f  edb.Dim(name="__
+00023470: 6469 6d5f 3022 2c20 646f 6d61 696e 3d28  dim_0", domain=(
+00023480: 302c 2033 292c 2074 696c 653d 342c 2064  0, 3), tile=4, d
+00023490: 7479 7065 3d22 7569 6e74 3634 2229 5d0a  type="uint64")].
+000234a0: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+000234b0: 2020 2020 2020 2020 2020 2061 7474 7273             attrs
+000234c0: 3d5b 7469 6c65 6462 2e41 7474 7228 6e61  =[tiledb.Attr(na
+000234d0: 6d65 3d22 222c 2064 7479 7065 3d22 696e  me="", dtype="in
+000234e0: 7436 3422 2c20 7661 723d 4661 6c73 652c  t64", var=False,
+000234f0: 206e 756c 6c61 626c 653d 5472 7565 295d   nullable=True)]
+00023500: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00023510: 2020 2020 7469 6c65 6462 2e41 7272 6179      tiledb.Array
+00023520: 2e63 7265 6174 6528 7572 692c 2073 6368  .create(uri, sch
+00023530: 656d 6129 0a0a 2020 2020 2020 2020 7769  ema)..        wi
+00023540: 7468 2074 696c 6564 622e 6f70 656e 2875  th tiledb.open(u
+00023550: 7269 2c20 2277 2229 2061 7320 413a 0a20  ri, "w") as A:. 
+00023560: 2020 2020 2020 2020 2020 2041 2e5f 7365             A._se
+00023570: 7469 7465 6d5f 696d 706c 280a 2020 2020  titem_impl(.    
+00023580: 2020 2020 2020 2020 2020 2020 736c 6963              slic
+00023590: 6528 302c 2034 292c 206e 702e 6f6e 6573  e(0, 4), np.ones
+000235a0: 2834 292c 207b 2222 3a20 6e70 2e61 7272  (4), {"": np.arr
+000235b0: 6179 285b 302c 2031 2c20 302c 2031 5d2c  ay([0, 1, 0, 1],
+000235c0: 2064 7479 7065 3d6e 702e 7569 6e74 3829   dtype=np.uint8)
+000235d0: 7d0a 2020 2020 2020 2020 2020 2020 290a  }.            ).
+000235e0: 0a0a 636c 6173 7320 496e 636f 6d70 6c65  ..class Incomple
+000235f0: 7465 5465 7374 2844 6973 6b54 6573 7443  teTest(DiskTestC
+00023600: 6173 6529 3a0a 2020 2020 6465 6620 7465  ase):.    def te
+00023610: 7374 5f69 6e63 6f6d 706c 6574 655f 6465  st_incomplete_de
+00023620: 6e73 655f 7661 726c 656e 2873 656c 6629  nse_varlen(self)
+00023630: 3a0a 2020 2020 2020 2020 6e63 656c 6c73  :.        ncells
+00023640: 203d 2031 300a 2020 2020 2020 2020 7061   = 10.        pa
+00023650: 7468 203d 2073 656c 662e 7061 7468 2822  th = self.path("
+00023660: 696e 636f 6d70 6c65 7465 5f64 656e 7365  incomplete_dense
+00023670: 5f76 6172 6c65 6e22 290a 2020 2020 2020  _varlen").      
+00023680: 2020 7374 725f 6461 7461 203d 205b 7261    str_data = [ra
+00023690: 6e64 5f75 7466 3828 7261 6e64 6f6d 2e72  nd_utf8(random.r
+000236a0: 616e 6469 6e74 2830 2c20 6e29 2920 666f  andint(0, n)) fo
+000236b0: 7220 6e20 696e 2072 616e 6765 286e 6365  r n in range(nce
+000236c0: 6c6c 7329 5d0a 2020 2020 2020 2020 6461  lls)].        da
+000236d0: 7461 203d 206e 702e 6172 7261 7928 7374  ta = np.array(st
+000236e0: 725f 6461 7461 2c20 6474 7970 653d 6e70  r_data, dtype=np
+000236f0: 2e75 6e69 636f 6465 5f29 0a0a 2020 2020  .unicode_)..    
+00023700: 2020 2020 2320 6261 7369 6320 7772 6974      # basic writ
+00023710: 650a 2020 2020 2020 2020 646f 6d20 3d20  e.        dom = 
+00023720: 7469 6c65 6462 2e44 6f6d 6169 6e28 7469  tiledb.Domain(ti
+00023730: 6c65 6462 2e44 696d 2864 6f6d 6169 6e3d  ledb.Dim(domain=
+00023740: 2831 2c20 6c65 6e28 6461 7461 2929 2c20  (1, len(data)), 
+00023750: 7469 6c65 3d6c 656e 2864 6174 6129 2929  tile=len(data)))
+00023760: 0a20 2020 2020 2020 2061 7474 203d 2074  .        att = t
+00023770: 696c 6564 622e 4174 7472 2864 7479 7065  iledb.Attr(dtype
+00023780: 3d6e 702e 756e 6963 6f64 655f 2c20 7661  =np.unicode_, va
+00023790: 723d 5472 7565 290a 0a20 2020 2020 2020  r=True)..       
+000237a0: 2073 6368 656d 6120 3d20 7469 6c65 6462   schema = tiledb
+000237b0: 2e41 7272 6179 5363 6865 6d61 2864 6f6d  .ArraySchema(dom
+000237c0: 2c20 2861 7474 2c29 290a 0a20 2020 2020  , (att,))..     
+000237d0: 2020 2074 696c 6564 622e 4465 6e73 6541     tiledb.DenseA
+000237e0: 7272 6179 2e63 7265 6174 6528 7061 7468  rray.create(path
+000237f0: 2c20 7363 6865 6d61 290a 2020 2020 2020  , schema).      
+00023800: 2020 7769 7468 2074 696c 6564 622e 4465    with tiledb.De
+00023810: 6e73 6541 7272 6179 2870 6174 682c 206d  nseArray(path, m
+00023820: 6f64 653d 2277 2229 2061 7320 543a 0a20  ode="w") as T:. 
+00023830: 2020 2020 2020 2020 2020 2054 5b3a 5d20             T[:] 
+00023840: 3d20 6461 7461 0a0a 2020 2020 2020 2020  = data..        
+00023850: 7769 7468 2074 696c 6564 622e 4465 6e73  with tiledb.Dens
+00023860: 6541 7272 6179 2870 6174 682c 206d 6f64  eArray(path, mod
+00023870: 653d 2272 2229 2061 7320 543a 0a20 2020  e="r") as T:.   
+00023880: 2020 2020 2020 2020 2061 7373 6572 745f           assert_
+00023890: 6172 7261 795f 6571 7561 6c28 6461 7461  array_equal(data
+000238a0: 2c20 545b 3a5d 290a 0a20 2020 2020 2020  , T[:])..       
+000238b0: 2023 2073 6574 2074 6865 206d 656d 6f72   # set the memor
+000238c0: 7920 746f 2074 6865 206d 6178 206c 656e  y to the max len
+000238d0: 6774 6820 6f66 2061 2063 656c 6c0a 2020  gth of a cell.  
+000238e0: 2020 2020 2020 2320 7468 6573 6520 7365        # these se
+000238f0: 7474 696e 6773 2066 6f72 6365 207e 3130  ttings force ~10
+00023900: 3020 7265 7472 6965 730a 2020 2020 2020  0 retries.      
+00023910: 2020 2320 544f 444f 2077 6f75 6c64 2062    # TODO would b
+00023920: 6520 676f 6f64 2074 6f20 6368 6563 6b20  e good to check 
+00023930: 7265 7065 6174 2063 6f75 6e74 2068 6572  repeat count her
+00023940: 653b 206e 6f74 2079 6574 2065 7870 6f73  e; not yet expos
+00023950: 6564 0a20 2020 2020 2020 2023 2020 2020  ed.        #    
+00023960: 2020 416c 736f 2077 6f75 6c64 2062 6520    Also would be 
+00023970: 7573 6566 756c 2074 6f20 6861 7665 206d  useful to have m
+00023980: 6178 2063 656c 6c20 636f 6e66 6967 2069  ax cell config i
+00023990: 6e20 6c69 6274 696c 6564 622e 0a20 2020  n libtiledb..   
+000239a0: 2020 2020 2069 6e69 745f 6275 6666 6572       init_buffer
+000239b0: 5f62 7974 6573 203d 2031 3032 3420 2a2a  _bytes = 1024 **
+000239c0: 2032 0a20 2020 2020 2020 2063 6f6e 6669   2.        confi
+000239d0: 6720 3d20 7469 6c65 6462 2e43 6f6e 6669  g = tiledb.Confi
+000239e0: 6728 0a20 2020 2020 2020 2020 2020 207b  g(.            {
+000239f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023a00: 2022 736d 2e6d 656d 6f72 795f 6275 6467   "sm.memory_budg
+00023a10: 6574 223a 206e 6365 6c6c 732c 0a20 2020  et": ncells,.   
+00023a20: 2020 2020 2020 2020 2020 2020 2022 736d               "sm
+00023a30: 2e6d 656d 6f72 795f 6275 6467 6574 5f76  .memory_budget_v
+00023a40: 6172 223a 206e 6365 6c6c 732c 0a20 2020  ar": ncells,.   
+00023a50: 2020 2020 2020 2020 2020 2020 2022 7079               "py
+00023a60: 2e69 6e69 745f 6275 6666 6572 5f62 7974  .init_buffer_byt
+00023a70: 6573 223a 2069 6e69 745f 6275 6666 6572  es": init_buffer
+00023a80: 5f62 7974 6573 2c0a 2020 2020 2020 2020  _bytes,.        
+00023a90: 2020 2020 7d0a 2020 2020 2020 2020 290a      }.        ).
+00023aa0: 2020 2020 2020 2020 7365 6c66 2e61 7373          self.ass
+00023ab0: 6572 7445 7175 616c 2863 6f6e 6669 675b  ertEqual(config[
+00023ac0: 2270 792e 696e 6974 5f62 7566 6665 725f  "py.init_buffer_
+00023ad0: 6279 7465 7322 5d2c 2073 7472 2869 6e69  bytes"], str(ini
+00023ae0: 745f 6275 6666 6572 5f62 7974 6573 2929  t_buffer_bytes))
+00023af0: 0a0a 2020 2020 2020 2020 7769 7468 2074  ..        with t
+00023b00: 696c 6564 622e 4465 6e73 6541 7272 6179  iledb.DenseArray
+00023b10: 2870 6174 682c 206d 6f64 653d 2272 222c  (path, mode="r",
+00023b20: 2063 7478 3d74 696c 6564 622e 4374 7828   ctx=tiledb.Ctx(
+00023b30: 636f 6e66 6967 2929 2061 7320 5432 3a0a  config)) as T2:.
+00023b40: 2020 2020 2020 2020 2020 2020 6466 203d              df =
+00023b50: 2054 322e 7175 6572 7928 6174 7472 733d   T2.query(attrs=
+00023b60: 5b22 225d 292e 6466 5b3a 5d0a 2020 2020  [""]).df[:].    
+00023b70: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+00023b80: 7272 6179 5f65 7175 616c 2864 665b 2222  rray_equal(df[""
+00023b90: 5d2c 2064 6174 6129 0a0a 2020 2020 6465  ], data)..    de
+00023ba0: 6620 7465 7374 5f69 6e63 6f6d 706c 6574  f test_incomplet
+00023bb0: 655f 7370 6172 7365 5f76 6172 6c65 6e28  e_sparse_varlen(
+00023bc0: 7365 6c66 293a 0a20 2020 2020 2020 206e  self):.        n
+00023bd0: 6365 6c6c 7320 3d20 3130 300a 0a20 2020  cells = 100..   
+00023be0: 2020 2020 2070 6174 6820 3d20 7365 6c66       path = self
+00023bf0: 2e70 6174 6828 2269 6e63 6f6d 706c 6574  .path("incomplet
+00023c00: 655f 7370 6172 7365 5f76 6172 6c65 6e22  e_sparse_varlen"
+00023c10: 290a 2020 2020 2020 2020 7374 725f 6461  ).        str_da
+00023c20: 7461 203d 205b 7261 6e64 5f75 7466 3828  ta = [rand_utf8(
+00023c30: 7261 6e64 6f6d 2e72 616e 6469 6e74 2830  random.randint(0
+00023c40: 2c20 6e29 2920 666f 7220 6e20 696e 2072  , n)) for n in r
+00023c50: 616e 6765 286e 6365 6c6c 7329 5d0a 2020  ange(ncells)].  
+00023c60: 2020 2020 2020 6461 7461 203d 206e 702e        data = np.
+00023c70: 6172 7261 7928 7374 725f 6461 7461 2c20  array(str_data, 
+00023c80: 6474 7970 653d 6e70 2e75 6e69 636f 6465  dtype=np.unicode
+00023c90: 5f29 0a20 2020 2020 2020 2063 6f6f 7264  _).        coord
+00023ca0: 7320 3d20 6e70 2e61 7261 6e67 6528 6e63  s = np.arange(nc
+00023cb0: 656c 6c73 290a 0a20 2020 2020 2020 2023  ells)..        #
+00023cc0: 2062 6173 6963 2077 7269 7465 0a20 2020   basic write.   
+00023cd0: 2020 2020 2064 6f6d 203d 2074 696c 6564       dom = tiled
+00023ce0: 622e 446f 6d61 696e 2874 696c 6564 622e  b.Domain(tiledb.
+00023cf0: 4469 6d28 646f 6d61 696e 3d28 302c 206c  Dim(domain=(0, l
+00023d00: 656e 2864 6174 6129 202b 2031 3030 292c  en(data) + 100),
+00023d10: 2074 696c 653d 6c65 6e28 6461 7461 2929   tile=len(data))
+00023d20: 290a 2020 2020 2020 2020 6174 7420 3d20  ).        att = 
+00023d30: 7469 6c65 6462 2e41 7474 7228 6474 7970  tiledb.Attr(dtyp
+00023d40: 653d 6e70 2e75 6e69 636f 6465 5f2c 2076  e=np.unicode_, v
+00023d50: 6172 3d54 7275 6529 0a0a 2020 2020 2020  ar=True)..      
+00023d60: 2020 7363 6865 6d61 203d 2074 696c 6564    schema = tiled
+00023d70: 622e 4172 7261 7953 6368 656d 6128 646f  b.ArraySchema(do
+00023d80: 6d2c 2028 6174 742c 292c 2073 7061 7273  m, (att,), spars
+00023d90: 653d 5472 7565 290a 0a20 2020 2020 2020  e=True)..       
+00023da0: 2074 696c 6564 622e 5370 6172 7365 4172   tiledb.SparseAr
+00023db0: 7261 792e 6372 6561 7465 2870 6174 682c  ray.create(path,
+00023dc0: 2073 6368 656d 6129 0a20 2020 2020 2020   schema).       
+00023dd0: 2077 6974 6820 7469 6c65 6462 2e53 7061   with tiledb.Spa
+00023de0: 7273 6541 7272 6179 2870 6174 682c 206d  rseArray(path, m
+00023df0: 6f64 653d 2277 2229 2061 7320 543a 0a20  ode="w") as T:. 
+00023e00: 2020 2020 2020 2020 2020 2054 5b63 6f6f             T[coo
+00023e10: 7264 735d 203d 2064 6174 610a 0a20 2020  rds] = data..   
+00023e20: 2020 2020 2077 6974 6820 7469 6c65 6462       with tiledb
+00023e30: 2e53 7061 7273 6541 7272 6179 2870 6174  .SparseArray(pat
+00023e40: 682c 206d 6f64 653d 2272 2229 2061 7320  h, mode="r") as 
+00023e50: 543a 0a20 2020 2020 2020 2020 2020 2061  T:.            a
+00023e60: 7373 6572 745f 6172 7261 795f 6571 7561  ssert_array_equa
+00023e70: 6c28 6461 7461 2c20 545b 3a5d 5b22 225d  l(data, T[:][""]
+00023e80: 290a 0a20 2020 2020 2020 2023 2073 6574  )..        # set
+00023e90: 2074 6865 206d 656d 6f72 7920 746f 2074   the memory to t
+00023ea0: 6865 206d 6178 206c 656e 6774 6820 6f66  he max length of
+00023eb0: 2061 2063 656c 6c0a 2020 2020 2020 2020   a cell.        
+00023ec0: 2320 7468 6573 6520 7365 7474 696e 6773  # these settings
+00023ed0: 2066 6f72 6365 207e 3130 3020 7265 7472   force ~100 retr
+00023ee0: 6965 730a 2020 2020 2020 2020 2320 544f  ies.        # TO
+00023ef0: 444f 2077 6f75 6c64 2062 6520 676f 6f64  DO would be good
+00023f00: 2074 6f20 6368 6563 6b20 7265 7065 6174   to check repeat
+00023f10: 2063 6f75 6e74 2068 6572 653b 206e 6f74   count here; not
+00023f20: 2079 6574 2065 7870 6f73 6564 0a20 2020   yet exposed.   
+00023f30: 2020 2020 2023 2020 2020 2020 416c 736f       #      Also
+00023f40: 2077 6f75 6c64 2062 6520 7573 6566 756c   would be useful
+00023f50: 2074 6f20 6861 7665 206d 6178 2063 656c   to have max cel
+00023f60: 6c20 636f 6e66 6967 2069 6e20 6c69 6274  l config in libt
+00023f70: 696c 6564 622e 0a20 2020 2020 2020 2069  iledb..        i
+00023f80: 6e69 745f 6275 6666 6572 5f62 7974 6573  nit_buffer_bytes
+00023f90: 203d 2031 3032 3420 2a2a 2032 0a20 2020   = 1024 ** 2.   
+00023fa0: 2020 2020 2063 6f6e 6669 6720 3d20 7469       config = ti
+00023fb0: 6c65 6462 2e43 6f6e 6669 6728 0a20 2020  ledb.Config(.   
+00023fc0: 2020 2020 2020 2020 207b 0a20 2020 2020           {.     
+00023fd0: 2020 2020 2020 2020 2020 2022 736d 2e6d             "sm.m
+00023fe0: 656d 6f72 795f 6275 6467 6574 223a 206e  emory_budget": n
+00023ff0: 6365 6c6c 732c 0a20 2020 2020 2020 2020  cells,.         
+00024000: 2020 2020 2020 2022 736d 2e6d 656d 6f72         "sm.memor
+00024010: 795f 6275 6467 6574 5f76 6172 223a 206e  y_budget_var": n
+00024020: 6365 6c6c 732c 0a20 2020 2020 2020 2020  cells,.         
+00024030: 2020 2020 2020 2022 7079 2e69 6e69 745f         "py.init_
+00024040: 6275 6666 6572 5f62 7974 6573 223a 2069  buffer_bytes": i
+00024050: 6e69 745f 6275 6666 6572 5f62 7974 6573  nit_buffer_bytes
+00024060: 2c0a 2020 2020 2020 2020 2020 2020 7d0a  ,.            }.
+00024070: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00024080: 2020 7365 6c66 2e61 7373 6572 7445 7175    self.assertEqu
+00024090: 616c 2863 6f6e 6669 675b 2270 792e 696e  al(config["py.in
+000240a0: 6974 5f62 7566 6665 725f 6279 7465 7322  it_buffer_bytes"
+000240b0: 5d2c 2073 7472 2869 6e69 745f 6275 6666  ], str(init_buff
+000240c0: 6572 5f62 7974 6573 2929 0a0a 2020 2020  er_bytes))..    
+000240d0: 2020 2020 7769 7468 2074 696c 6564 622e      with tiledb.
+000240e0: 5370 6172 7365 4172 7261 7928 7061 7468  SparseArray(path
+000240f0: 2c20 6d6f 6465 3d22 7222 2c20 6374 783d  , mode="r", ctx=
+00024100: 7469 6c65 6462 2e43 7478 2863 6f6e 6669  tiledb.Ctx(confi
+00024110: 6729 2920 6173 2054 323a 0a20 2020 2020  g)) as T2:.     
+00024120: 2020 2020 2020 2061 7373 6572 745f 6172         assert_ar
+00024130: 7261 795f 6571 7561 6c28 6461 7461 2c20  ray_equal(data, 
+00024140: 5432 5b3a 5d5b 2222 5d29 0a0a 2020 2020  T2[:][""])..    
+00024150: 2020 2020 2020 2020 6173 7365 7274 5f61          assert_a
+00024160: 7272 6179 5f65 7175 616c 2864 6174 612c  rray_equal(data,
+00024170: 2054 322e 6d75 6c74 695f 696e 6465 785b   T2.multi_index[
+00024180: 303a 6e63 656c 6c73 5d5b 2222 5d29 0a0a  0:ncells][""])..
+00024190: 2020 2020 2020 2020 2020 2020 2320 656e              # en
+000241a0: 7375 7265 2074 6861 7420 656d 7074 7920  sure that empty 
+000241b0: 7265 7375 6c74 7320 6172 6520 6861 6e64  results are hand
+000241c0: 6c65 6420 636f 7272 6563 746c 790a 2020  led correctly.  
+000241d0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+000241e0: 5f61 7272 6179 5f65 7175 616c 280a 2020  _array_equal(.  
+000241f0: 2020 2020 2020 2020 2020 2020 2020 5432                T2
+00024200: 2e6d 756c 7469 5f69 6e64 6578 5b31 3031  .multi_index[101
+00024210: 3a31 3035 5d5b 2222 5d2c 206e 702e 6172  :105][""], np.ar
+00024220: 7261 7928 5b5d 2c20 6474 7970 653d 6e70  ray([], dtype=np
+00024230: 2e64 7479 7065 2822 3c55 2229 290a 2020  .dtype("<U")).  
+00024240: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00024250: 2040 7079 7465 7374 2e6d 6172 6b2e 7061   @pytest.mark.pa
+00024260: 7261 6d65 7472 697a 6528 0a20 2020 2020  rametrize(.     
+00024270: 2020 2022 7265 7475 726e 5f61 7272 6f77     "return_arrow
+00024280: 2c20 696e 6465 7865 7222 2c20 5b28 5472  , indexer", [(Tr
+00024290: 7565 2c20 2264 6622 292c 2028 4661 6c73  ue, "df"), (Fals
+000242a0: 652c 2022 6466 2229 2c20 2846 616c 7365  e, "df"), (False
+000242b0: 2c20 226d 756c 7469 5f69 6e64 6578 2229  , "multi_index")
+000242c0: 5d0a 2020 2020 290a 2020 2020 6465 6620  ].    ).    def 
+000242d0: 7465 7374 5f69 6e63 6f6d 706c 6574 655f  test_incomplete_
+000242e0: 7265 7475 726e 280a 2020 2020 2020 2020  return(.        
+000242f0: 7365 6c66 2c20 7465 7374 5f69 6e63 6f6d  self, test_incom
+00024300: 706c 6574 655f 7265 7475 726e 5f61 7272  plete_return_arr
+00024310: 6179 2c20 7265 7475 726e 5f61 7272 6f77  ay, return_arrow
+00024320: 2c20 696e 6465 7865 720a 2020 2020 293a  , indexer.    ):
+00024330: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+00024340: 7079 6172 726f 7720 6173 2070 610a 2020  pyarrow as pa.  
+00024350: 2020 2020 2020 696d 706f 7274 2070 616e        import pan
+00024360: 6461 7320 6173 2070 640a 2020 2020 2020  das as pd.      
+00024370: 2020 6672 6f6d 2074 696c 6564 622e 6d75    from tiledb.mu
+00024380: 6c74 6972 616e 6765 5f69 6e64 6578 696e  ltirange_indexin
+00024390: 6720 696d 706f 7274 2045 7374 696d 6174  g import Estimat
+000243a0: 6564 5265 7375 6c74 5369 7a65 0a0a 2020  edResultSize..  
+000243b0: 2020 2020 2020 7061 7468 203d 2074 6573        path = tes
+000243c0: 745f 696e 636f 6d70 6c65 7465 5f72 6574  t_incomplete_ret
+000243d0: 7572 6e5f 6172 7261 790a 0a20 2020 2020  urn_array..     
+000243e0: 2020 2069 6e69 745f 6275 6666 6572 5f62     init_buffer_b
+000243f0: 7974 6573 203d 2032 3030 0a20 2020 2020  ytes = 200.     
+00024400: 2020 2063 6667 203d 2074 696c 6564 622e     cfg = tiledb.
+00024410: 436f 6e66 6967 280a 2020 2020 2020 2020  Config(.        
+00024420: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
+00024430: 2020 2020 2020 2270 792e 696e 6974 5f62        "py.init_b
+00024440: 7566 6665 725f 6279 7465 7322 3a20 696e  uffer_bytes": in
+00024450: 6974 5f62 7566 6665 725f 6279 7465 732c  it_buffer_bytes,
+00024460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024470: 2022 7079 2e65 7861 6374 5f69 6e69 745f   "py.exact_init_
+00024480: 6275 6666 6572 5f62 7974 6573 223a 2022  buffer_bytes": "
+00024490: 7472 7565 222c 0a20 2020 2020 2020 2020  true",.         
+000244a0: 2020 207d 0a20 2020 2020 2020 2029 0a0a     }.        )..
+000244b0: 2020 2020 2020 2020 7769 7468 2074 696c          with til
+000244c0: 6564 622e 6f70 656e 2870 6174 6829 2061  edb.open(path) a
+000244d0: 7320 413a 0a20 2020 2020 2020 2020 2020  s A:.           
+000244e0: 2066 756c 6c5f 6461 7461 203d 2041 5b3a   full_data = A[:
+000244f0: 5d5b 2222 5d0a 0a20 2020 2020 2020 2023  ][""]..        #
+00024500: 2063 6f75 6e74 206e 756d 6265 7220 6f66   count number of
+00024510: 2065 6c65 6d65 6e74 7320 7265 7472 6965   elements retrie
+00024520: 7665 6420 736f 2074 6861 7420 7765 2063  ved so that we c
+00024530: 616e 2073 6c69 6365 2074 6865 2063 6f6d  an slice the com
+00024540: 7061 7269 736f 6e20 6172 7261 790a 2020  parison array.  
+00024550: 2020 2020 2020 6964 7820 3d20 300a 2020        idx = 0.  
+00024560: 2020 2020 2020 7769 7468 2074 696c 6564        with tiled
+00024570: 622e 6f70 656e 2870 6174 682c 2063 7478  b.open(path, ctx
+00024580: 3d74 696c 6564 622e 4374 7828 6366 6729  =tiledb.Ctx(cfg)
+00024590: 2920 6173 2041 3a0a 2020 2020 2020 2020  ) as A:.        
+000245a0: 2020 2020 7175 6572 7920 3d20 412e 7175      query = A.qu
+000245b0: 6572 7928 7265 7475 726e 5f69 6e63 6f6d  ery(return_incom
+000245c0: 706c 6574 653d 5472 7565 2c20 7265 7475  plete=True, retu
+000245d0: 726e 5f61 7272 6f77 3d72 6574 7572 6e5f  rn_arrow=return_
+000245e0: 6172 726f 7729 0a20 2020 2020 2020 2020  arrow).         
+000245f0: 2020 2069 7465 7261 626c 6520 3d20 6765     iterable = ge
+00024600: 7461 7474 7228 7175 6572 792c 2069 6e64  tattr(query, ind
+00024610: 6578 6572 290a 0a20 2020 2020 2020 2020  exer)..         
+00024620: 2020 2066 6f72 2072 6573 756c 7420 696e     for result in
+00024630: 2069 7465 7261 626c 655b 3a5d 3a0a 0a20   iterable[:]:.. 
+00024640: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00024650: 7374 5f72 6573 756c 7473 203d 2069 7465  st_results = ite
+00024660: 7261 626c 652e 6573 7469 6d61 7465 645f  rable.estimated_
+00024670: 7265 7375 6c74 5f73 697a 6573 2829 0a20  result_sizes(). 
+00024680: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00024690: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
+000246a0: 2865 7374 5f72 6573 756c 7473 5b22 225d  (est_results[""]
+000246b0: 2c20 4573 7469 6d61 7465 6452 6573 756c  , EstimatedResul
+000246c0: 7453 697a 6529 0a20 2020 2020 2020 2020  tSize).         
+000246d0: 2020 2020 2020 2061 7373 6572 7420 6973         assert is
+000246e0: 696e 7374 616e 6365 2865 7374 5f72 6573  instance(est_res
+000246f0: 756c 7473 5b22 5f5f 6469 6d5f 3022 5d2c  ults["__dim_0"],
+00024700: 2045 7374 696d 6174 6564 5265 7375 6c74   EstimatedResult
+00024710: 5369 7a65 290a 2020 2020 2020 2020 2020  Size).          
+00024720: 2020 2020 2020 6173 7365 7274 2065 7374        assert est
+00024730: 5f72 6573 756c 7473 5b22 5f5f 6469 6d5f  _results["__dim_
+00024740: 3022 5d2e 6f66 6673 6574 735f 6279 7465  0"].offsets_byte
+00024750: 7320 3d3d 2030 0a20 2020 2020 2020 2020  s == 0.         
+00024760: 2020 2020 2020 2061 7373 6572 7420 6573         assert es
+00024770: 745f 7265 7375 6c74 735b 225f 5f64 696d  t_results["__dim
+00024780: 5f30 225d 2e64 6174 615f 6279 7465 7320  _0"].data_bytes 
+00024790: 3e20 300a 2020 2020 2020 2020 2020 2020  > 0.            
+000247a0: 2020 2020 6173 7365 7274 2065 7374 5f72      assert est_r
+000247b0: 6573 756c 7473 5b22 225d 2e6f 6666 7365  esults[""].offse
+000247c0: 7473 5f62 7974 6573 203e 2030 0a20 2020  ts_bytes > 0.   
+000247d0: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+000247e0: 6572 7420 6573 745f 7265 7375 6c74 735b  ert est_results[
+000247f0: 2222 5d2e 6461 7461 5f62 7974 6573 203e  ""].data_bytes >
+00024800: 2030 0a0a 2020 2020 2020 2020 2020 2020   0..            
+00024810: 2020 2020 6966 2072 6574 7572 6e5f 6172      if return_ar
+00024820: 726f 773a 0a20 2020 2020 2020 2020 2020  row:.           
+00024830: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00024840: 6973 696e 7374 616e 6365 2872 6573 756c  isinstance(resul
+00024850: 742c 2070 612e 5461 626c 6529 0a20 2020  t, pa.Table).   
+00024860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024870: 2064 6620 3d20 7265 7375 6c74 2e74 6f5f   df = result.to_
+00024880: 7061 6e64 6173 2829 0a20 2020 2020 2020  pandas().       
+00024890: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000248a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000248b0: 2020 2069 6620 696e 6465 7865 7220 3d3d     if indexer ==
+000248c0: 2022 6466 223a 0a20 2020 2020 2020 2020   "df":.         
+000248d0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000248e0: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
+000248f0: 2872 6573 756c 742c 2070 642e 4461 7461  (result, pd.Data
+00024900: 4672 616d 6529 0a20 2020 2020 2020 2020  Frame).         
+00024910: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00024920: 6620 3d20 7265 7375 6c74 0a20 2020 2020  f = result.     
+00024930: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00024940: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00024950: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+00024960: 6572 7420 6973 696e 7374 616e 6365 2872  ert isinstance(r
+00024970: 6573 756c 742c 204f 7264 6572 6564 4469  esult, OrderedDi
+00024980: 6374 290a 2020 2020 2020 2020 2020 2020  ct).            
+00024990: 2020 2020 2020 2020 2020 2020 6466 203d              df =
+000249a0: 2070 642e 4461 7461 4672 616d 6528 7265   pd.DataFrame(re
+000249b0: 7375 6c74 290a 0a20 2020 2020 2020 2020  sult)..         
+000249c0: 2020 2020 2020 2074 6f5f 736c 6963 6520         to_slice 
+000249d0: 3d20 736c 6963 6528 6964 782c 2069 6478  = slice(idx, idx
+000249e0: 202b 206c 656e 2864 6629 290a 2020 2020   + len(df)).    
+000249f0: 2020 2020 2020 2020 2020 2020 6368 756e              chun
+00024a00: 6b20 3d20 6675 6c6c 5f64 6174 615b 746f  k = full_data[to
+00024a10: 5f73 6c69 6365 5d0a 0a20 2020 2020 2020  _slice]..       
+00024a20: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+00024a30: 6e70 2e61 6c6c 2863 6875 6e6b 203d 3d20  np.all(chunk == 
+00024a40: 6466 5b22 225d 2e76 616c 7565 7329 0a20  df[""].values). 
+00024a50: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00024a60: 7373 6572 7420 6e70 2e61 6c6c 2864 665b  ssert np.all(df[
+00024a70: 225f 5f64 696d 5f30 225d 203d 3d20 6e70  "__dim_0"] == np
+00024a80: 2e61 7261 6e67 6528 6964 782c 2069 6478  .arange(idx, idx
+00024a90: 202b 206c 656e 2864 6629 2929 0a20 2020   + len(df))).   
+00024aa0: 2020 2020 2020 2020 2020 2020 2023 2075               # u
+00024ab0: 7064 6174 6520 7468 6520 6375 7272 656e  pdate the curren
+00024ac0: 7420 7265 6164 2063 6f75 6e74 0a20 2020  t read count.   
+00024ad0: 2020 2020 2020 2020 2020 2020 2069 6478               idx
+00024ae0: 202b 3d20 6c65 6e28 6466 290a 0a20 2020   += len(df)..   
+00024af0: 2020 2020 2061 7373 6572 7420 6964 7820       assert idx 
+00024b00: 3d3d 206c 656e 2866 756c 6c5f 6461 7461  == len(full_data
+00024b10: 290a 0a0a 636c 6173 7320 5465 7374 5465  )...class TestTe
+00024b20: 7374 2844 6973 6b54 6573 7443 6173 6529  st(DiskTestCase)
+00024b30: 3a0a 2020 2020 6465 6620 7465 7374 5f70  :.    def test_p
+00024b40: 6174 6828 7365 6c66 2c20 7079 7465 7374  ath(self, pytest
+00024b50: 636f 6e66 6967 293a 0a20 2020 2020 2020  config):.       
+00024b60: 2070 6174 6820 3d20 7365 6c66 2e70 6174   path = self.pat
+00024b70: 6828 2266 6f6f 2229 0a20 2020 2020 2020  h("foo").       
+00024b80: 2069 6620 7079 7465 7374 636f 6e66 6967   if pytestconfig
+00024b90: 2e67 6574 6f70 7469 6f6e 2822 7666 7322  .getoption("vfs"
+00024ba0: 2920 3d3d 2022 7333 223a 0a20 2020 2020  ) == "s3":.     
+00024bb0: 2020 2020 2020 2061 7373 6572 7420 7061         assert pa
+00024bc0: 7468 2e73 7461 7274 7377 6974 6828 2273  th.startswith("s
+00024bd0: 333a 2f2f 2229 0a0a 2020 2020 4070 7974  3://")..    @pyt
+00024be0: 6573 742e 6d61 726b 2e73 6b69 7069 6628  est.mark.skipif(
+00024bf0: 0a20 2020 2020 2020 2073 7973 2e70 6c61  .        sys.pla
+00024c00: 7466 6f72 6d20 3d3d 2022 7769 6e33 3222  tform == "win32"
+00024c10: 2c20 7265 6173 6f6e 3d22 6e6f 5f6f 7574  , reason="no_out
+00024c20: 7075 7420 6669 7874 7572 6520 6469 7361  put fixture disa
+00024c30: 626c 6564 206f 6e20 5769 6e64 6f77 7322  bled on Windows"
+00024c40: 0a20 2020 2029 0a20 2020 2040 7079 7465  .    ).    @pyte
+00024c50: 7374 2e6d 6172 6b2e 7866 6169 6c28 0a20  st.mark.xfail(. 
+00024c60: 2020 2020 2020 2054 7275 652c 2072 6561         True, rea
+00024c70: 736f 6e3d 2254 6869 7320 7465 7374 2070  son="This test p
+00024c80: 7269 6e74 732c 2061 6e64 2073 686f 756c  rints, and shoul
+00024c90: 6420 6661 696c 2062 6563 6175 7365 206f  d fail because o
+00024ca0: 6620 6e6f 5f6f 7574 7075 7420 6669 7874  f no_output fixt
+00024cb0: 7572 6521 220a 2020 2020 290a 2020 2020  ure!".    ).    
+00024cc0: 6465 6620 7465 7374 5f6e 6f5f 6f75 7470  def test_no_outp
+00024cd0: 7574 2873 656c 6629 3a0a 2020 2020 2020  ut(self):.      
+00024ce0: 2020 7072 696e 7428 2274 6869 7320 7465    print("this te
+00024cf0: 7374 2073 686f 756c 6420 6661 696c 2229  st should fail")
+00024d00: 0a0a 0a23 2069 6620 5f5f 6e61 6d65 5f5f  ...# if __name__
+00024d10: 203d 3d20 275f 5f6d 6169 6e5f 5f27 3a0a   == '__main__':.
+00024d20: 2320 2020 2023 2072 756e 2061 2073 696e  #    # run a sin
+00024d30: 676c 6520 6578 616d 706c 6520 666f 7220  gle example for 
+00024d40: 696e 2d70 726f 6365 7373 2064 6562 7567  in-process debug
+00024d50: 6769 6e67 0a23 2020 2020 2320 6265 7474  ging.#    # bett
+00024d60: 6572 2074 6f20 7573 6520 6070 7974 6573  er to use `pytes
+00024d70: 7420 2d2d 6764 6260 2069 6620 6176 6169  t --gdb` if avai
+00024d80: 6c61 626c 650a 2320 2020 2074 203d 2044  lable.#    t = D
+00024d90: 656e 7365 4172 7261 7954 6573 7428 290a  enseArrayTest().
+00024da0: 2320 2020 2074 2e73 6574 5570 2829 0a23  #    t.setUp().#
+00024db0: 2020 2020 742e 7465 7374 5f61 7272 6179      t.test_array
+00024dc0: 5f31 6428 290a                           _1d().
```

### Comparing `tiledb-0.9.4/tiledb/tests/test_metadata.py` & `tiledb-0.9.5/tiledb/tests/test_metadata.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/test_multi_index-hp.py` & `tiledb-0.9.5/tiledb/tests/test_multi_index-hp.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/test_multi_index.py` & `tiledb-0.9.5/tiledb/tests/test_multi_index.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/test_pandas_dataframe.py` & `tiledb-0.9.5/tiledb/tests/test_pandas_dataframe.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/tests/test_query_condition.py` & `tiledb-0.9.5/tiledb/tests/test_query_condition.py`

 * *Files 26% similar despite different names*

```diff
@@ -20,29 +20,28 @@
             ctx=ctx,
         )
         attrs = [
             tiledb.Attr(name="U", dtype=np.uint32, ctx=ctx),
             tiledb.Attr(name="I", dtype=np.int64, ctx=ctx),
             tiledb.Attr(name="D", dtype=np.float64, ctx=ctx),
             tiledb.Attr(name="S", dtype=np.dtype("|S1"), var=False, ctx=ctx),
+            tiledb.Attr(name="A", dtype="ascii", var=True, ctx=ctx),
         ]
 
         schema = tiledb.ArraySchema(domain=dom, attrs=attrs, sparse=True, ctx=ctx)
         tiledb.SparseArray.create(path, schema)
 
         U = np.random.randint(1, 10, 10)
         I = np.random.randint(-5, 5, 10)
         D = np.random.rand(10)
         S = np.array(list(string.ascii_lowercase[:10]), dtype="|S1")
+        A = np.array(list(string.ascii_lowercase[:10]), dtype="|S1")
 
-        coords = np.linspace(1, 10, num=10, dtype=np.uint32)
-        data = {"U": U, "I": I, "D": D, "S": S}
-
-        with tiledb.open(path, "w") as A:
-            A[coords] = data
+        with tiledb.open(path, "w") as arr:
+            arr[np.arange(1, 11)] = {"U": U, "I": I, "D": D, "S": S, "A": A}
 
         return path
 
     def setUp(self):
         super().setUp()
         if not tiledb.libtiledb.version() >= (2, 2, 3):
             pytest.skip("Only run QueryCondition test with TileDB>=2.2.3")
@@ -61,50 +60,120 @@
         with self.assertRaises(tiledb.TileDBError):
             with tiledb.open(input_array_UIDS) as A:
                 qc = tiledb.QueryCondition("'foo' == 'bar'")
                 A.query(attr_cond=qc, use_arrow=False).df[:]
 
         with self.assertRaises(tiledb.TileDBError):
             with tiledb.open(input_array_UIDS) as A:
-                qc = tiledb.QueryCondition("NO_CONDITION")
-                A.query(attr_cond=qc, use_arrow=False).df[:]
+                qc = tiledb.QueryCondition("U < 10000000000000000000000.0")
+                A.query(attr_cond=qc, attrs=["U"]).df[:]
+
+        with self.assertRaises(tiledb.TileDBError):
+            with tiledb.open(input_array_UIDS) as A:
+                qc = tiledb.QueryCondition("D")
+                A.query(attr_cond=qc, attrs=["D"]).df[:]
+
+        with self.assertRaises(tiledb.TileDBError):
+            with tiledb.open(input_array_UIDS) as A:
+                qc = tiledb.QueryCondition("D,")
+                A.query(attr_cond=qc, attrs=["D"]).df[:]
 
-    def test_ints_floats_bytestrings(self, input_array_UIDS):
+        with self.assertRaises(tiledb.TileDBError):
+            with tiledb.open(input_array_UIDS) as A:
+                qc = tiledb.QueryCondition("D > ")
+                A.query(attr_cond=qc, attrs=["D"]).df[:]
+
+        with self.assertRaises(tiledb.TileDBError):
+            with tiledb.open(input_array_UIDS) as A:
+                qc = tiledb.QueryCondition("(D > 0.7) | (D < 3.5)")
+                A.query(attr_cond=qc, attrs=["D"]).df[:]
+
+        with self.assertRaises(tiledb.TileDBError):
+            with tiledb.open(input_array_UIDS) as A:
+                qc = tiledb.QueryCondition("U >= 3 or 0.7 < D")
+                A.query(attr_cond=qc, attrs=["U", "D"]).df[:]
+
+    def test_unsigned(self, input_array_UIDS):
         with tiledb.open(input_array_UIDS) as A:
-            # bytestrings with PyArrow not yet support in TileDB-Py
             qc = tiledb.QueryCondition("U < 5")
             result = A.query(attr_cond=qc, attrs=["U"]).df[:]
             assert all(result["U"] < 5)
 
+    def test_signed(self, input_array_UIDS):
+        with tiledb.open(input_array_UIDS) as A:
             qc = tiledb.QueryCondition("I < 1")
             result = A.query(attr_cond=qc, attrs=["I"]).df[:]
             assert all(result["I"] < 1)
 
             qc = tiledb.QueryCondition("I < +1")
             result = A.query(attr_cond=qc, attrs=["I"]).df[:]
             assert all(result["I"] < +1)
 
             qc = tiledb.QueryCondition("I < ---1")
             result = A.query(attr_cond=qc, attrs=["I"]).df[:]
             assert all(result["I"] < ---1)
 
+            qc = tiledb.QueryCondition("-5 < I < 5")
+            result = A.query(attr_cond=qc, attrs=["I"]).df[:]
+            assert all(-5 < result["I"])
+            assert all(result["I"] < 5)
+
+    def test_floats(self, input_array_UIDS):
+        with tiledb.open(input_array_UIDS) as A:
             qc = tiledb.QueryCondition("D > 5.0")
             result = A.query(attr_cond=qc, attrs=["D"]).df[:]
             assert all(result["D"] > 5.0)
 
-            qc = tiledb.QueryCondition("U >= 3 and 0.7 < D")
-            result = A.query(attr_cond=qc, attrs=["U", "D"]).df[:]
-            assert all(result["U"] >= 3)
-            assert all(0.7 < result["D"])
+            qc = tiledb.QueryCondition("(D > 0.7) & (D < 3.5)")
+            result = A.query(attr_cond=qc, attrs=["D"]).df[:]
+            assert all((result["D"] > 0.7) & (result["D"] < 3.5))
+
+            qc = tiledb.QueryCondition("0.2 < D < 0.75")
+            result = A.query(attr_cond=qc, attrs=["D", "I"]).df[:]
+            assert all(0.2 < result["D"])
+            assert all(result["D"] < 0.75)
 
+    def test_string(self, input_array_UIDS):
+        with tiledb.open(input_array_UIDS) as A:
             qc = tiledb.QueryCondition("S == 'c'")
             result = A.query(attr_cond=qc, attrs=["S"], use_arrow=False).df[:]
             assert len(result["S"]) == 1
             assert result["S"][0] == b"c"
 
+            qc = tiledb.QueryCondition("A == 'a'")
+            result = A.query(attr_cond=qc, attrs=["A"], use_arrow=False).df[:]
+            assert len(result["A"]) == 1
+            assert result["A"][0] == b"a"
+
+    def test_combined_types(self, input_array_UIDS):
+        with tiledb.open(input_array_UIDS) as A:
+            qc = tiledb.QueryCondition("(I > 0) & ((-3 < D) & (D < 3.0))")
+            result = A.query(attr_cond=qc, attrs=["I", "D"]).df[:]
+            assert all((result["I"] > 0) & ((-3 < result["D"]) & (result["D"] < 3.0)))
+
+            qc = tiledb.QueryCondition("U >= 3 and 0.7 < D")
+            result = A.query(attr_cond=qc, attrs=["U", "D"]).df[:]
+            assert all(result["U"] >= 3)
+            assert all(0.7 < result["D"])
+
+            qc = tiledb.QueryCondition("(0.2 < D and D < 0.75) and (-5 < I < 5)")
+            result = A.query(attr_cond=qc, attrs=["D", "I"]).df[:]
+            assert all((0.2 < result["D"]) & (result["D"] < 0.75))
+            assert all((-5 < result["I"]) & (result["I"] < 5))
+
+            qc = tiledb.QueryCondition("(-5 < I <= -1) and (0.2 < D < 0.75)")
+            result = A.query(attr_cond=qc, attrs=["D", "I"]).df[:]
+            assert all((0.2 < result["D"]) & (result["D"] < 0.75))
+            assert all((-5 < result["I"]) & (result["I"] <= -1))
+
+            qc = tiledb.QueryCondition("(0.2 < D < 0.75) and (-5 < I < 5)")
+            result = A.query(attr_cond=qc, attrs=["D", "I"]).df[:]
+            assert all((0.2 < result["D"]) & (result["D"] < 0.75))
+            assert all((-5 < result["I"]) & (result["I"] < 5))
+
     def test_check_attrs(self, input_array_UIDS):
         with tiledb.open(input_array_UIDS) as A:
             qc = tiledb.QueryCondition("U < 0.1")
             result = A.query(attr_cond=qc, attrs=["U"]).df[:]
             assert all(result["U"] < 0.1)
 
             qc = tiledb.QueryCondition("U < 1.0")
@@ -118,11 +187,7 @@
             with self.assertRaises(tiledb.TileDBError):
                 qc = tiledb.QueryCondition("U < 'one'")
                 A.query(attr_cond=qc, attrs=["U"]).df[:]
 
             with self.assertRaises(tiledb.TileDBError):
                 qc = tiledb.QueryCondition("U < 1")
                 A.query(attr_cond=qc, attrs=["D"]).df[:]
-
-            with self.assertRaises(tiledb.TileDBError):
-                qc = tiledb.QueryCondition("U < 10000000000000000000000.0")
-                A.query(attr_cond=qc, attrs=["U"]).df[:]
```

### Comparing `tiledb-0.9.4/tiledb/tests/test_util.py` & `tiledb-0.9.5/tiledb/tests/test_util.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/util.h` & `tiledb-0.9.5/tiledb/util.h`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb/util.py` & `tiledb-0.9.5/tiledb/util.py`

 * *Files identical despite different names*

### Comparing `tiledb-0.9.4/tiledb.egg-info/PKG-INFO` & `tiledb-0.9.5/tiledb.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: tiledb
-Version: 0.9.4
+Version: 0.9.5
 Summary: Pythonic interface to the TileDB array storage manager
 Home-page: https://github.com/TileDB-Inc/TileDB-Py
 Author: TileDB, Inc.
 Author-email: help@tiledb.io
 Maintainer: TileDB, Inc.
 Maintainer-email: help@tiledb.io
 License: MIT
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
-Metadata-Version: 2.1 Name: tiledb Version: 0.9.4 Summary: Pythonic interface
+Metadata-Version: 2.1 Name: tiledb Version: 0.9.5 Summary: Pythonic interface
 to the TileDB array storage manager Home-page: https://github.com/TileDB-Inc/
 TileDB-Py Author: TileDB, Inc. Author-email: help@tiledb.io Maintainer: TileDB,
 Inc. Maintainer-email: help@tiledb.io License: MIT Platform: any Classifier:
 Development Status :: 4 - Beta Classifier: Intended Audience :: Developers
 Classifier: Intended Audience :: Information Technology Classifier: Intended
 Audience :: Science/Research Classifier: License :: OSI Approved :: MIT License
 Classifier: Programming Language :: Python Classifier: Topic :: Software
```

### Comparing `tiledb-0.9.4/tiledb.egg-info/SOURCES.txt` & `tiledb-0.9.5/tiledb.egg-info/SOURCES.txt`

 * *Files identical despite different names*

