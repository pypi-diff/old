--- tmp/lndb-0.39.2.tar.gz
+++ tmp/lndb-0.40.0.tar.gz
â”œâ”€â”€ filetype from file(1)
â”‚ @@ -1 +1 @@
â”‚ -gzip compressed data, was "lndb-0.39.2.tar", last modified: Mon Apr  3 11:01:52 2023, max compression
â”‚ +gzip compressed data, was "lndb-0.40.0.tar", last modified: Fri Apr  7 04:15:09 2023, max compression
â”‚   --- lndb-0.39.2.tar
â”œâ”€â”€ +++ lndb-0.40.0.tar
â”‚ â”œâ”€â”€ file list
â”‚ â”‚ @@ -1,77 +1,77 @@
â”‚ â”‚ --rw-r--r--   0        0        0     3899 2023-03-31 06:18:24.411522 lndb-0.39.2/.github/workflows/build.yml
â”‚ â”‚ --rw-r--r--   0        0        0      133 2023-02-17 13:49:16.959104 lndb-0.39.2/.github/workflows/latest-changes.jinja2
â”‚ â”‚ --rw-r--r--   0        0        0      597 2023-02-17 13:49:16.959170 lndb-0.39.2/.github/workflows/latest-changes.yml
â”‚ â”‚ --rw-r--r--   0        0        0     1204 2023-02-17 13:49:16.959268 lndb-0.39.2/.gitignore
â”‚ â”‚ --rw-r--r--   0        0        0     1772 2023-02-17 13:49:16.959356 lndb-0.39.2/.pre-commit-config.yaml
â”‚ â”‚ --rw-r--r--   0        0        0    11324 2023-02-17 13:49:16.959462 lndb-0.39.2/LICENSE
â”‚ â”‚ --rw-r--r--   0        0        0      173 2023-03-31 06:18:24.412474 lndb-0.39.2/README.md
â”‚ â”‚ --rw-r--r--   0        0        0       52 2023-03-06 07:28:24.074432 lndb-0.39.2/docs/api.md
â”‚ â”‚ --rw-r--r--   0        0        0    44453 2023-04-03 11:01:27.991038 lndb-0.39.2/docs/changelog.md
â”‚ â”‚ --rw-r--r--   0        0        0     4832 2023-03-31 06:18:24.413743 lndb-0.39.2/docs/faq/check-synchronization.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0     3334 2023-03-31 06:18:24.414194 lndb-0.39.2/docs/faq/clone.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0     8397 2023-03-31 06:18:24.415119 lndb-0.39.2/docs/faq/edge-cases-login-init.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0      166 2023-03-31 06:18:24.415959 lndb-0.39.2/docs/faq/index.md
â”‚ â”‚ --rw-r--r--   0        0        0     1464 2023-03-31 06:18:24.416798 lndb-0.39.2/docs/faq/manage-migrations.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0     3248 2023-03-31 06:18:24.417221 lndb-0.39.2/docs/faq/switch-environment.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0     2843 2023-03-31 06:18:24.417695 lndb-0.39.2/docs/faq/test-migrations-e2e.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0     3806 2023-03-31 06:18:24.418155 lndb-0.39.2/docs/faq/test-migrations-unit.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0     5163 2023-03-31 06:18:24.418653 lndb-0.39.2/docs/guide/01-setup-user.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0    10400 2023-03-31 06:18:24.419025 lndb-0.39.2/docs/guide/02-init-instance.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0     5573 2023-03-31 06:18:24.419573 lndb-0.39.2/docs/guide/03-load-instance.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0     5290 2023-03-31 06:18:24.420036 lndb-0.39.2/docs/guide/04-set-storage.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0     3724 2023-03-31 06:18:24.420381 lndb-0.39.2/docs/guide/05-schema-modules.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0     1496 2023-03-31 06:18:24.420751 lndb-0.39.2/docs/guide/06-info.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0     3282 2023-03-31 06:18:24.421507 lndb-0.39.2/docs/guide/07-delete.ipynb
â”‚ â”‚ --rw-r--r--   0        0        0      129 2023-02-17 19:35:05.599031 lndb-0.39.2/docs/guide/index.md
â”‚ â”‚ --rw-r--r--   0        0        0     3152 2023-03-31 06:18:24.421916 lndb-0.39.2/docs/guide/migrate.md
â”‚ â”‚ --rw-r--r--   0        0        0      126 2023-02-17 19:35:05.599275 lndb-0.39.2/docs/index.md
â”‚ â”‚ --rw-r--r--   0        0        0      118 2023-02-17 19:35:05.599424 lndb-0.39.2/lamin-project.yaml
â”‚ â”‚ --rw-r--r--   0        0        0     1926 2023-04-03 11:01:08.241399 lndb-0.39.2/lndb/__init__.py
â”‚ â”‚ --rw-r--r--   0        0        0     4242 2023-02-24 23:35:29.913848 lndb-0.39.2/lndb/__main__.py
â”‚ â”‚ --rw-r--r--   0        0        0      100 2023-02-17 13:49:16.961660 lndb-0.39.2/lndb/_assets/__init__.py
â”‚ â”‚ --rw-r--r--   0        0        0      216 2023-04-01 08:36:57.992002 lndb-0.39.2/lndb/_check_versions.py
â”‚ â”‚ --rw-r--r--   0        0        0      360 2023-02-17 19:35:05.600174 lndb-0.39.2/lndb/_close.py
â”‚ â”‚ --rw-r--r--   0        0        0     2062 2023-03-31 06:18:24.423693 lndb-0.39.2/lndb/_delete.py
â”‚ â”‚ --rw-r--r--   0        0        0      222 2023-02-17 19:35:05.600535 lndb-0.39.2/lndb/_info.py
â”‚ â”‚ --rw-r--r--   0        0        0     5731 2023-03-31 06:18:24.424157 lndb-0.39.2/lndb/_init_instance.py
â”‚ â”‚ --rw-r--r--   0        0        0     3752 2023-04-03 11:01:24.936585 lndb-0.39.2/lndb/_load_instance.py
â”‚ â”‚ --rw-r--r--   0        0        0     3525 2023-03-31 06:18:24.425302 lndb-0.39.2/lndb/_migrate/__init__.py
â”‚ â”‚ --rw-r--r--   0        0        0     6279 2023-03-31 06:18:24.425766 lndb-0.39.2/lndb/_migrate/_deploy.py
â”‚ â”‚ --rw-r--r--   0        0        0     5099 2023-03-31 06:18:24.426237 lndb-0.39.2/lndb/_migrate/_utils.py
â”‚ â”‚ --rw-r--r--   0        0        0      724 2023-02-17 19:35:05.601448 lndb-0.39.2/lndb/_migrate/alembic.ini
â”‚ â”‚ --rw-r--r--   0        0        0     3179 2023-02-17 19:35:05.601566 lndb-0.39.2/lndb/_migrate/env.py
â”‚ â”‚ --rw-r--r--   0        0        0      341 2023-02-17 19:35:05.601662 lndb-0.39.2/lndb/_migrate/script.py.mako
â”‚ â”‚ --rw-r--r--   0        0        0     1020 2023-02-17 13:49:16.963182 lndb-0.39.2/lndb/_schema.py
â”‚ â”‚ --rw-r--r--   0        0        0     1466 2023-02-24 18:23:12.622270 lndb-0.39.2/lndb/_set.py
â”‚ â”‚ --rw-r--r--   0        0        0     2087 2023-03-31 06:18:24.426717 lndb-0.39.2/lndb/_settings.py
â”‚ â”‚ --rw-r--r--   0        0        0       87 2023-02-17 19:35:05.602225 lndb-0.39.2/lndb/_settings_load.py
â”‚ â”‚ --rw-r--r--   0        0        0       72 2023-02-17 19:35:05.602342 lndb-0.39.2/lndb/_settings_store.py
â”‚ â”‚ --rw-r--r--   0        0        0     5291 2023-03-31 06:18:24.427489 lndb-0.39.2/lndb/_setup_user.py
â”‚ â”‚ --rw-r--r--   0        0        0      393 2023-02-20 08:48:26.781270 lndb-0.39.2/lndb/dev/__init__.py
â”‚ â”‚ --rw-r--r--   0        0        0     4030 2023-03-31 06:18:24.427954 lndb-0.39.2/lndb/dev/_clone.py
â”‚ â”‚ --rw-r--r--   0        0        0     6338 2023-03-31 06:18:24.428617 lndb-0.39.2/lndb/dev/_db.py
â”‚ â”‚ --rw-r--r--   0        0        0     2491 2023-02-17 19:35:05.603115 lndb-0.39.2/lndb/dev/_deprecated.py
â”‚ â”‚ --rw-r--r--   0        0        0      240 2023-02-17 19:35:05.603192 lndb-0.39.2/lndb/dev/_docs.py
â”‚ â”‚ --rw-r--r--   0        0        0     5562 2023-02-22 12:24:15.566492 lndb-0.39.2/lndb/dev/_exclusion.py
â”‚ â”‚ --rw-r--r--   0        0        0     8388 2023-02-20 08:48:26.781737 lndb-0.39.2/lndb/dev/_settings_instance.py
â”‚ â”‚ --rw-r--r--   0        0        0     2629 2023-03-31 06:18:24.428886 lndb-0.39.2/lndb/dev/_settings_load.py
â”‚ â”‚ --rw-r--r--   0        0        0     2061 2023-02-17 19:35:05.603816 lndb-0.39.2/lndb/dev/_settings_save.py
â”‚ â”‚ --rw-r--r--   0        0        0     1927 2023-03-31 06:18:24.429392 lndb-0.39.2/lndb/dev/_settings_store.py
â”‚ â”‚ --rw-r--r--   0        0        0      976 2023-02-17 19:35:05.604025 lndb-0.39.2/lndb/dev/_settings_user.py
â”‚ â”‚ --rw-r--r--   0        0        0     2446 2023-03-31 06:18:24.430632 lndb-0.39.2/lndb/dev/_setup_knowledge.py
â”‚ â”‚ --rw-r--r--   0        0        0     6996 2023-03-31 06:18:24.431076 lndb-0.39.2/lndb/dev/_setup_schema.py
â”‚ â”‚ --rw-r--r--   0        0        0     4004 2023-03-05 14:46:44.306277 lndb-0.39.2/lndb/dev/_storage.py
â”‚ â”‚ --rw-r--r--   0        0        0      140 2023-02-23 22:37:08.720821 lndb-0.39.2/lndb/dev/_testdb.py
â”‚ â”‚ --rw-r--r--   0        0        0     2001 2023-02-20 08:48:26.782279 lndb-0.39.2/lndb/dev/_upath_ext.py
â”‚ â”‚ --rw-r--r--   0        0        0      388 2023-03-31 06:18:24.431483 lndb-0.39.2/lndb/test/__init__.py
â”‚ â”‚ --rw-r--r--   0        0        0       50 2023-02-23 22:37:08.722119 lndb-0.39.2/lndb/test/_env.py
â”‚ â”‚ --rw-r--r--   0        0        0     3856 2023-03-31 06:18:24.431826 lndb-0.39.2/lndb/test/_migrations_e2e.py
â”‚ â”‚ --rw-r--r--   0        0        0     6229 2023-02-17 13:49:16.964351 lndb-0.39.2/lndb/test/_migrations_unit.py
â”‚ â”‚ --rw-r--r--   0        0        0      310 2023-02-23 22:37:08.722350 lndb-0.39.2/lndb/test/_nox.py
â”‚ â”‚ --rw-r--r--   0        0        0      188 2023-02-23 07:03:13.300099 lndb-0.39.2/lndb/test/nox.py
â”‚ â”‚ --rw-r--r--   0        0        0     1514 2023-03-31 06:18:24.432328 lndb-0.39.2/noxfile.py
â”‚ â”‚ --rw-r--r--   0        0        0     1414 2023-04-01 08:36:57.992406 lndb-0.39.2/pyproject.toml
â”‚ â”‚ --rw-r--r--   0        0        0      506 2023-02-17 13:49:16.964718 lndb-0.39.2/tests/test_bionty.py
â”‚ â”‚ --rw-r--r--   0        0        0      680 2023-03-31 06:18:24.433575 lndb-0.39.2/tests/test_init_instance.py
â”‚ â”‚ --rw-r--r--   0        0        0      385 2023-02-20 08:48:26.782884 lndb-0.39.2/tests/test_notebooks.py
â”‚ â”‚ --rw-r--r--   0        0        0     1395 1970-01-01 00:00:00.000000 lndb-0.39.2/PKG-INFO
â”‚ â”‚ +-rw-r--r--   0        0        0     3899 2023-04-05 12:41:02.524447 lndb-0.40.0/.github/workflows/build.yml
â”‚ â”‚ +-rw-r--r--   0        0        0      133 2023-01-15 12:18:16.566196 lndb-0.40.0/.github/workflows/latest-changes.jinja2
â”‚ â”‚ +-rw-r--r--   0        0        0      597 2023-01-15 12:18:16.566256 lndb-0.40.0/.github/workflows/latest-changes.yml
â”‚ â”‚ +-rw-r--r--   0        0        0     1204 2023-01-15 12:18:16.566326 lndb-0.40.0/.gitignore
â”‚ â”‚ +-rw-r--r--   0        0        0     1772 2023-01-16 03:13:03.815140 lndb-0.40.0/.pre-commit-config.yaml
â”‚ â”‚ +-rw-r--r--   0        0        0    11324 2023-01-15 12:18:16.566501 lndb-0.40.0/LICENSE
â”‚ â”‚ +-rw-r--r--   0        0        0      173 2023-03-27 04:37:15.707800 lndb-0.40.0/README.md
â”‚ â”‚ +-rw-r--r--   0        0        0       52 2023-03-06 11:50:26.265030 lndb-0.40.0/docs/api.md
â”‚ â”‚ +-rw-r--r--   0        0        0    45042 2023-04-07 04:14:47.673444 lndb-0.40.0/docs/changelog.md
â”‚ â”‚ +-rw-r--r--   0        0        0     4832 2023-03-22 14:41:54.962234 lndb-0.40.0/docs/faq/check-synchronization.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0     3334 2023-03-09 09:28:04.965028 lndb-0.40.0/docs/faq/clone.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0     8397 2023-03-22 05:59:33.863010 lndb-0.40.0/docs/faq/edge-cases-login-init.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0      166 2023-03-22 14:56:35.817208 lndb-0.40.0/docs/faq/index.md
â”‚ â”‚ +-rw-r--r--   0        0        0     1180 2023-04-05 05:10:26.112382 lndb-0.40.0/docs/faq/manage-migrations.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0     3248 2023-03-09 09:28:04.965998 lndb-0.40.0/docs/faq/switch-environment.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0     2798 2023-04-05 05:10:26.112662 lndb-0.40.0/docs/faq/test-migrations-e2e.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0     2073 2023-04-05 05:10:26.112933 lndb-0.40.0/docs/faq/test-migrations-unit.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0     5163 2023-03-22 05:59:33.863390 lndb-0.40.0/docs/guide/01-setup-user.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0    10400 2023-03-22 05:59:33.863723 lndb-0.40.0/docs/guide/02-init-instance.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0     5573 2023-03-22 14:56:35.818426 lndb-0.40.0/docs/guide/03-load-instance.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0     5290 2023-03-09 09:28:04.966850 lndb-0.40.0/docs/guide/04-set-storage.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0     3724 2023-03-22 05:59:33.864269 lndb-0.40.0/docs/guide/05-schema-modules.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0     1496 2023-03-22 05:59:33.864524 lndb-0.40.0/docs/guide/06-info.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0     3282 2023-03-22 05:59:33.864793 lndb-0.40.0/docs/guide/07-delete.ipynb
â”‚ â”‚ +-rw-r--r--   0        0        0      129 2023-02-16 15:52:14.590660 lndb-0.40.0/docs/guide/index.md
â”‚ â”‚ +-rw-r--r--   0        0        0     3152 2023-03-25 20:23:06.444401 lndb-0.40.0/docs/guide/migrate.md
â”‚ â”‚ +-rw-r--r--   0        0        0      126 2023-02-16 21:53:37.660107 lndb-0.40.0/docs/index.md
â”‚ â”‚ +-rw-r--r--   0        0        0      118 2023-02-17 10:58:37.191812 lndb-0.40.0/lamin-project.yaml
â”‚ â”‚ +-rw-r--r--   0        0        0     1932 2023-04-07 04:14:15.041388 lndb-0.40.0/lndb/__init__.py
â”‚ â”‚ +-rw-r--r--   0        0        0     4242 2023-02-27 18:35:12.951712 lndb-0.40.0/lndb/__main__.py
â”‚ â”‚ +-rw-r--r--   0        0        0      100 2023-02-12 04:51:38.272115 lndb-0.40.0/lndb/_assets/__init__.py
â”‚ â”‚ +-rw-r--r--   0        0        0      216 2023-04-03 04:25:19.341088 lndb-0.40.0/lndb/_check_versions.py
â”‚ â”‚ +-rw-r--r--   0        0        0      360 2023-02-16 21:53:37.660535 lndb-0.40.0/lndb/_close.py
â”‚ â”‚ +-rw-r--r--   0        0        0     2146 2023-04-05 13:47:39.618861 lndb-0.40.0/lndb/_delete.py
â”‚ â”‚ +-rw-r--r--   0        0        0      222 2023-02-16 21:53:37.660919 lndb-0.40.0/lndb/_info.py
â”‚ â”‚ +-rw-r--r--   0        0        0     5755 2023-04-05 12:41:02.525310 lndb-0.40.0/lndb/_init_instance.py
â”‚ â”‚ +-rw-r--r--   0        0        0     3752 2023-04-05 05:10:26.113362 lndb-0.40.0/lndb/_load_instance.py
â”‚ â”‚ +-rw-r--r--   0        0        0      135 2023-04-05 05:10:26.113647 lndb-0.40.0/lndb/_migrate/__init__.py
â”‚ â”‚ +-rw-r--r--   0        0        0      723 2023-04-05 05:10:26.113978 lndb-0.40.0/lndb/_migrate/alembic.ini
â”‚ â”‚ +-rw-r--r--   0        0        0     3469 2023-04-05 12:41:02.533096 lndb-0.40.0/lndb/_migrate/core.py
â”‚ â”‚ +-rw-r--r--   0        0        0     6303 2023-04-05 05:10:26.114561 lndb-0.40.0/lndb/_migrate/deploy.py
â”‚ â”‚ +-rw-r--r--   0        0        0     3179 2023-02-16 21:53:37.661733 lndb-0.40.0/lndb/_migrate/env.py
â”‚ â”‚ +-rw-r--r--   0        0        0      341 2023-02-16 21:53:37.661843 lndb-0.40.0/lndb/_migrate/script.py.mako
â”‚ â”‚ +-rw-r--r--   0        0        0     4840 2023-04-05 05:10:26.114776 lndb-0.40.0/lndb/_migrate/utils.py
â”‚ â”‚ +-rw-r--r--   0        0        0     1020 2023-02-12 04:51:38.274334 lndb-0.40.0/lndb/_schema.py
â”‚ â”‚ +-rw-r--r--   0        0        0     1490 2023-04-05 12:41:02.525753 lndb-0.40.0/lndb/_set.py
â”‚ â”‚ +-rw-r--r--   0        0        0     2165 2023-04-07 02:52:01.648931 lndb-0.40.0/lndb/_settings.py
â”‚ â”‚ +-rw-r--r--   0        0        0       87 2023-02-16 21:53:37.662311 lndb-0.40.0/lndb/_settings_load.py
â”‚ â”‚ +-rw-r--r--   0        0        0       72 2023-02-16 21:53:37.662460 lndb-0.40.0/lndb/_settings_store.py
â”‚ â”‚ +-rw-r--r--   0        0        0     5291 2023-03-12 15:04:39.932675 lndb-0.40.0/lndb/_setup_user.py
â”‚ â”‚ +-rw-r--r--   0        0        0      363 2023-04-05 12:41:02.526023 lndb-0.40.0/lndb/dev/__init__.py
â”‚ â”‚ +-rw-r--r--   0        0        0     4030 2023-03-27 17:35:42.591834 lndb-0.40.0/lndb/dev/_clone.py
â”‚ â”‚ +-rw-r--r--   0        0        0     6341 2023-04-05 12:41:02.526216 lndb-0.40.0/lndb/dev/_db.py
â”‚ â”‚ +-rw-r--r--   0        0        0     2491 2023-02-16 21:53:37.663214 lndb-0.40.0/lndb/dev/_deprecated.py
â”‚ â”‚ +-rw-r--r--   0        0        0      240 2023-02-16 21:53:37.663286 lndb-0.40.0/lndb/dev/_docs.py
â”‚ â”‚ +-rw-r--r--   0        0        0     5284 2023-04-05 12:41:02.526831 lndb-0.40.0/lndb/dev/_exclusion.py
â”‚ â”‚ +-rw-r--r--   0        0        0     8389 2023-04-05 12:41:02.527633 lndb-0.40.0/lndb/dev/_settings_instance.py
â”‚ â”‚ +-rw-r--r--   0        0        0     2629 2023-03-22 05:59:33.865686 lndb-0.40.0/lndb/dev/_settings_load.py
â”‚ â”‚ +-rw-r--r--   0        0        0     2061 2023-02-16 21:53:37.663723 lndb-0.40.0/lndb/dev/_settings_save.py
â”‚ â”‚ +-rw-r--r--   0        0        0     2454 2023-04-07 04:13:56.734044 lndb-0.40.0/lndb/dev/_settings_store.py
â”‚ â”‚ +-rw-r--r--   0        0        0      976 2023-02-16 21:53:37.663901 lndb-0.40.0/lndb/dev/_settings_user.py
â”‚ â”‚ +-rw-r--r--   0        0        0     2446 2023-03-21 06:52:10.981980 lndb-0.40.0/lndb/dev/_setup_knowledge.py
â”‚ â”‚ +-rw-r--r--   0        0        0     6996 2023-03-30 17:54:01.453792 lndb-0.40.0/lndb/dev/_setup_schema.py
â”‚ â”‚ +-rw-r--r--   0        0        0     4004 2023-04-05 12:41:02.528400 lndb-0.40.0/lndb/dev/_storage.py
â”‚ â”‚ +-rw-r--r--   0        0        0      140 2023-02-24 20:31:36.945684 lndb-0.40.0/lndb/dev/_testdb.py
â”‚ â”‚ +-rw-r--r--   0        0        0      356 2023-04-05 05:10:26.115134 lndb-0.40.0/lndb/test/__init__.py
â”‚ â”‚ +-rw-r--r--   0        0        0       50 2023-02-24 20:31:36.946187 lndb-0.40.0/lndb/test/_env.py
â”‚ â”‚ +-rw-r--r--   0        0        0     3856 2023-03-30 17:54:01.454075 lndb-0.40.0/lndb/test/_migrations_e2e.py
â”‚ â”‚ +-rw-r--r--   0        0        0     6646 2023-04-05 05:10:26.115464 lndb-0.40.0/lndb/test/_migrations_unit.py
â”‚ â”‚ +-rw-r--r--   0        0        0      310 2023-02-24 20:31:36.946490 lndb-0.40.0/lndb/test/_nox.py
â”‚ â”‚ +-rw-r--r--   0        0        0      188 2023-02-22 22:13:54.788863 lndb-0.40.0/lndb/test/nox.py
â”‚ â”‚ +-rw-r--r--   0        0        0     1514 2023-03-09 09:28:04.969263 lndb-0.40.0/noxfile.py
â”‚ â”‚ +-rw-r--r--   0        0        0     1219 2023-04-07 03:35:22.756124 lndb-0.40.0/pyproject.toml
â”‚ â”‚ +-rw-r--r--   0        0        0      506 2023-02-12 04:51:38.276939 lndb-0.40.0/tests/test_bionty.py
â”‚ â”‚ +-rw-r--r--   0        0        0      680 2023-03-09 09:28:04.969725 lndb-0.40.0/tests/test_init_instance.py
â”‚ â”‚ +-rw-r--r--   0        0        0      385 2023-02-21 15:53:42.076396 lndb-0.40.0/tests/test_notebooks.py
â”‚ â”‚ +-rw-r--r--   0        0        0     1162 1970-01-01 00:00:00.000000 lndb-0.40.0/PKG-INFO
â”‚ â”‚   --- lndb-0.39.2/.github/workflows/build.yml
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/.github/workflows/build.yml
â”‚ â”‚â”„ Files 2% similar despite different names
â”‚ â”‚ @@ -30,15 +30,15 @@
â”‚ â”‚        - name: Setup Python
â”‚ â”‚          uses: actions/setup-python@v3
â”‚ â”‚          with:
â”‚ â”‚            python-version: ${{ matrix.python-version }}
â”‚ â”‚        - name: Cache pre-commit & nox
â”‚ â”‚          uses: actions/cache@v3
â”‚ â”‚          env:
â”‚ â”‚ -          cache-name: cache-3
â”‚ â”‚ +          cache-name: cache-4
â”‚ â”‚          with:
â”‚ â”‚            path: |
â”‚ â”‚              .nox
â”‚ â”‚              ~/.cache/pre-commit
â”‚ â”‚            key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('.pre-commit-config.yaml') }}-${{ hashFiles('pyproject.yaml') }}
â”‚ â”‚        - name: Cache postgres
â”‚ â”‚          id: cache-postgres
â”‚ â”‚   --- lndb-0.39.2/.github/workflows/latest-changes.yml
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/.github/workflows/latest-changes.yml
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/.gitignore
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/.gitignore
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/.pre-commit-config.yaml
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/.pre-commit-config.yaml
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/LICENSE
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/LICENSE
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/docs/changelog.md
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/changelog.md
â”‚ â”‚â”„ Files 1% similar despite different names
â”‚ â”‚ @@ -1,15 +1,19 @@
â”‚ â”‚  # Changelog
â”‚ â”‚  
â”‚ â”‚  <!-- prettier-ignore -->
â”‚ â”‚  Name | PR | Developer | Date | Version
â”‚ â”‚  --- | --- | --- | --- | ---
â”‚ â”‚ +ğŸš¸ Rename settings directory to `.lamin` | [349](https://github.com/laminlabs/lndb/pull/349) | [falexwolf](https://github.com/falexwolf) | 2023-04-07 | 0.40.0
â”‚ â”‚ +ğŸš¸ Expose storage in settings | [348](https://github.com/laminlabs/lndb/pull/348) | [falexwolf](https://github.com/falexwolf) | 2023-04-07 |
â”‚ â”‚ +â™»ï¸ Move storage related code to lndb_storage | [338](https://github.com/laminlabs/lndb/pull/338) | [Koncopd](https://github.com/Koncopd) | 2023-04-05 |
â”‚ â”‚ +â™»ï¸ Refactor migrations | [346](https://github.com/laminlabs/lndb/pull/346) | [falexwolf](https://github.com/falexwolf) | 2023-04-04 |
â”‚ â”‚  ğŸ§‘â€ğŸ’» Enable to load instance from hub using access token | [343](https://github.com/laminlabs/lndb/pull/343) | [fredericenard](https://github.com/fredericenard) | 2023-04-03 | 0.39.2
â”‚ â”‚  â¬†ï¸ Upgrade lnhub-rest to 0.7.2 | [341](https://github.com/laminlabs/lndb/pull/341) | [falexwolf](https://github.com/falexwolf) | 2023-03-31 | 0.39.1
â”‚ â”‚ -:green_heart: Try to fix CI | [342](https://github.com/laminlabs/lndb/pull/342) | [falexwolf](https://github.com/falexwolf) | 2023-03-30 |
â”‚ â”‚ +ğŸ’š Try to fix CI | [342](https://github.com/laminlabs/lndb/pull/342) | [falexwolf](https://github.com/falexwolf) | 2023-03-30 |
â”‚ â”‚  ğŸš¸ Check schema version upon init | [340](https://github.com/laminlabs/lndb/pull/340) | [falexwolf](https://github.com/falexwolf) | 2023-03-30 | 0.39.0
â”‚ â”‚  ğŸš¸ Enforce order of schema modules for migration | [339](https://github.com/laminlabs/lndb/pull/339) | [falexwolf](https://github.com/falexwolf) | 2023-03-27 | 0.38.1
â”‚ â”‚  ğŸ’š Improve e2e migrations guide | [337](https://github.com/laminlabs/lndb/pull/337) | [falexwolf](https://github.com/falexwolf) | 2023-03-26 | 0.38.0
â”‚ â”‚  ğŸš¸ Update `_migration` in `__init__.py` of schema modules | [336](https://github.com/laminlabs/lndb/pull/336) | [falexwolf](https://github.com/falexwolf) | 2023-03-25 |
â”‚ â”‚  ğŸ¨ Improve e2e migrations testing | [335](https://github.com/laminlabs/lndb/pull/335) | [falexwolf](https://github.com/falexwolf) | 2023-03-25 |
â”‚ â”‚  ğŸ¨ Improve switching logic from and to sqlite | [334](https://github.com/laminlabs/lndb/pull/334) | [falexwolf](https://github.com/falexwolf) | 2023-03-22 | 0.37.9
â”‚ â”‚  âœ… Add tests for migration unit tests | [333](https://github.com/laminlabs/lndb/pull/333) | [falexwolf](https://github.com/falexwolf) | 2023-03-22 | 0.37.8
â”‚ â”‚   --- lndb-0.39.2/docs/faq/check-synchronization.ipynb
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/faq/check-synchronization.ipynb
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/docs/faq/clone.ipynb
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/faq/clone.ipynb
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/docs/faq/edge-cases-login-init.ipynb
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/faq/edge-cases-login-init.ipynb
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/docs/faq/manage-migrations.ipynb
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/guide/06-info.ipynb
â”‚ â”‚â”„ Files 12% similar despite different names
â”‚ â”‚ â”œâ”€â”€ Pretty-printed
â”‚ â”‚ â”‚â”„ Similarity: 0.8350694444444444%
â”‚ â”‚ â”‚â”„ Differences: {"'cells'": "{0: {'metadata': {replace: OrderedDict([('tags', [])])}, 'source': ['# Get info on an "
â”‚ â”‚ â”‚â”„             "instance'], 'id': 'b43d09d5-26d3-440d-b334-9643ec5248e6'}, 1: {'source': ['import "
â”‚ â”‚ â”‚â”„             "lamindb as ln'], 'id': '33c2bb76-d61f-4866-87e2-780e61600022'}, 2: {'source': "
â”‚ â”‚ â”‚â”„             '[\'ln.setup.load("mydata")\'], \'id\': \'b8a6f1fe\'}, 3: {\'source\': {insert: [(0, '
â”‚ â”‚ â”‚â”„             "'Running \\n'), (2, 'lamin info\\n'), (4, '\\n'), (5, 'on the command line runs the "
â”‚ â”‚ â”‚â”„             "following: [â€¦]
â”‚ â”‚ â”‚ @@ -1,54 +1,60 @@
â”‚ â”‚ â”‚  {
â”‚ â”‚ â”‚      "cells": [
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "markdown",
â”‚ â”‚ â”‚ -            "metadata": {},
â”‚ â”‚ â”‚ +            "id": "b43d09d5-26d3-440d-b334-9643ec5248e6",
â”‚ â”‚ â”‚ +            "metadata": {
â”‚ â”‚ â”‚ +                "tags": []
â”‚ â”‚ â”‚ +            },
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "# Manage migrations"
â”‚ â”‚ â”‚ +                "# Get info on an instance"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚ +            "id": "33c2bb76-d61f-4866-87e2-780e61600022",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "from lndb import migrate, init\n",
â”‚ â”‚ â”‚ -                "import lnschema_core\n",
â”‚ â”‚ â”‚ -                "from pathlib import Path"
â”‚ â”‚ â”‚ +                "import lamindb as ln"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚ +            "id": "b8a6f1fe",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "schema_root = Path(lnschema_core.__file__).parent.parent"
â”‚ â”‚ â”‚ +                "ln.setup.load(\"mydata\")"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "markdown",
â”‚ â”‚ â”‚ +            "id": "25a13298",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "Running the following on the CLI\n",
â”‚ â”‚ â”‚ +                "Running \n",
â”‚ â”‚ â”‚                  "```\n",
â”‚ â”‚ â”‚ -                "lamin migrate generate\n",
â”‚ â”‚ â”‚ +                "lamin info\n",
â”‚ â”‚ â”‚                  "```\n",
â”‚ â”‚ â”‚ -                "runs"
â”‚ â”‚ â”‚ +                "\n",
â”‚ â”‚ â”‚ +                "on the command line runs the following:"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚ +            "id": "8436575d",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "migrate.generate(schema_root=schema_root, package_name=\"lnschema_core\")"
â”‚ â”‚ â”‚ +                "ln.setup.info()"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          }
â”‚ â”‚ â”‚      ],
â”‚ â”‚ â”‚      "metadata": {
â”‚ â”‚ â”‚          "kernelspec": {
â”‚ â”‚ â”‚              "display_name": "Python 3 (ipykernel)",
â”‚ â”‚ â”‚              "language": "python",
â”‚ â”‚ â”‚ @@ -69,9 +75,9 @@
â”‚ â”‚ â”‚          "vscode": {
â”‚ â”‚ â”‚              "interpreter": {
â”‚ â”‚ â”‚                  "hash": "40d3a090f54c6569ab1632332b64b2c03c39dcf918b08424e98f38b5ae0af88f"
â”‚ â”‚ â”‚              }
â”‚ â”‚ â”‚          }
â”‚ â”‚ â”‚      },
â”‚ â”‚ â”‚      "nbformat": 4,
â”‚ â”‚ â”‚ -    "nbformat_minor": 4
â”‚ â”‚ â”‚ +    "nbformat_minor": 5
â”‚ â”‚ â”‚  }
â”‚ â”‚   --- lndb-0.39.2/docs/faq/switch-environment.ipynb
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/faq/switch-environment.ipynb
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/docs/faq/test-migrations-e2e.ipynb
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/faq/test-migrations-e2e.ipynb
â”‚ â”‚â”„ Files 13% similar despite different names
â”‚ â”‚ â”œâ”€â”€ Pretty-printed
â”‚ â”‚ â”‚â”„ Similarity: 0.9856944444444444%
â”‚ â”‚ â”‚â”„ Differences: {"'cells'": "{2: {'source': ['import lndb']}, 4: {'source': "
â”‚ â”‚ â”‚â”„             '[\'lndb.test.migrate_clone(storage="s3://lamin-site-assets")\']}, 5: {\'source\': '
â”‚ â”‚ â”‚â”„             '[\'lndb.delete("lamin-site-assets_test")\']}, 6: {\'source\': '
â”‚ â”‚ â”‚â”„             '[\'lndb.test.migrate_clones("lnschema_core", n_instances=1, '
â”‚ â”‚ â”‚â”„             'dialect_name="sqlite")\']}, 8: {\'source\': {insert: [(1, \'# '
â”‚ â”‚ â”‚â”„             "lndb.test.migrate_clone(\\n')], delete: [1]}}, 9: {'source': "
â”‚ â”‚ â”‚â”„             '[\'lndb.test.migrate_clones("lnsche [â€¦]
â”‚ â”‚ â”‚ @@ -21,15 +21,15 @@
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚              "id": "33c2bb76-d61f-4866-87e2-780e61600022",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "import lamindb as ln"
â”‚ â”‚ â”‚ +                "import lndb"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "markdown",
â”‚ â”‚ â”‚              "id": "119134fc-1362-4b6f-85e9-d65e5ab091cf",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ @@ -39,39 +39,39 @@
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚              "id": "2fe506c7-9788-4f04-8d12-a5a855a81db0",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "ln.setup.test.migrate_clone(storage=\"s3://lamin-site-assets\")"
â”‚ â”‚ â”‚ +                "lndb.test.migrate_clone(storage=\"s3://lamin-site-assets\")"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚              "id": "8f16a4b4-e165-4df3-af1b-592796b9bca5",
â”‚ â”‚ â”‚              "metadata": {
â”‚ â”‚ â”‚                  "tags": [
â”‚ â”‚ â”‚                      "hide-cell"
â”‚ â”‚ â”‚                  ]
â”‚ â”‚ â”‚              },
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "ln.setup.delete(\"lamin-site-assets_test\")"
â”‚ â”‚ â”‚ +                "lndb.delete(\"lamin-site-assets_test\")"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚              "id": "f1f43b5a-59ca-419a-8ed1-9672f2ff2025",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "ln.setup.test.migrate_clones(\"lnschema_core\", n_instances=1, dialect_name=\"sqlite\")"
â”‚ â”‚ â”‚ +                "lndb.test.migrate_clones(\"lnschema_core\", n_instances=1, dialect_name=\"sqlite\")"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "markdown",
â”‚ â”‚ â”‚              "id": "e53c8996-73a1-4c5f-b54f-4ea9ea117702",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ @@ -82,33 +82,33 @@
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚              "id": "cd10731f-5667-4550-99db-90fb47e92c32",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚                  "# replace with lamindata!\n",
â”‚ â”‚ â”‚ -                "# ln.setup.test.migrate_clone(\n",
â”‚ â”‚ â”‚ +                "# lndb.test.migrate_clone(\n",
â”‚ â”‚ â”‚                  "#     db=\"postgresql://batman:robin@35.222.187.204:5432/retro\", schema=\"bionty,retro\"\n",
â”‚ â”‚ â”‚                  "# )"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚              "id": "58c449e1-74e3-46b4-9361-343802fc1841",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "ln.setup.test.migrate_clones(\"lnschema_core\", n_instances=1, dialect_name=\"postgresql\")"
â”‚ â”‚ â”‚ +                "lndb.test.migrate_clones(\"lnschema_core\", n_instances=1, dialect_name=\"postgresql\")"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          }
â”‚ â”‚ â”‚      ],
â”‚ â”‚ â”‚      "metadata": {
â”‚ â”‚ â”‚          "kernelspec": {
â”‚ â”‚ â”‚ -            "display_name": "Python 3 (ipykernel)",
â”‚ â”‚ â”‚ +            "display_name": "py39",
â”‚ â”‚ â”‚              "language": "python",
â”‚ â”‚ â”‚              "name": "python3"
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          "language_info": {
â”‚ â”‚ â”‚              "codemirror_mode": {
â”‚ â”‚ â”‚                  "name": "ipython",
â”‚ â”‚ â”‚                  "version": 3
â”‚ â”‚ â”‚ @@ -118,14 +118,14 @@
â”‚ â”‚ â”‚              "name": "python",
â”‚ â”‚ â”‚              "nbconvert_exporter": "python",
â”‚ â”‚ â”‚              "pygments_lexer": "ipython3",
â”‚ â”‚ â”‚              "version": "3.9.15"
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          "vscode": {
â”‚ â”‚ â”‚              "interpreter": {
â”‚ â”‚ â”‚ -                "hash": "40d3a090f54c6569ab1632332b64b2c03c39dcf918b08424e98f38b5ae0af88f"
â”‚ â”‚ â”‚ +                "hash": "61b4062b24dfb1010f420dad5aa3bd73a4d2af47d0ec44eafec465a35a9d7239"
â”‚ â”‚ â”‚              }
â”‚ â”‚ â”‚          }
â”‚ â”‚ â”‚      },
â”‚ â”‚ â”‚      "nbformat": 4,
â”‚ â”‚ â”‚      "nbformat_minor": 5
â”‚ â”‚ â”‚  }
â”‚ â”‚   --- lndb-0.39.2/docs/faq/test-migrations-unit.ipynb
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/guide/07-delete.ipynb
â”‚ â”‚â”„ Files 15% similar despite different names
â”‚ â”‚ â”œâ”€â”€ Pretty-printed
â”‚ â”‚ â”‚â”„ Similarity: 0.9107638888888889%
â”‚ â”‚ â”‚â”„ Differences: {"'cells'": "{0: {'id': 'b43d09d5-26d3-440d-b334-9643ec5248e6', 'metadata': {replace: "
â”‚ â”‚ â”‚â”„             "OrderedDict([('tags', [])])}, 'source': ['# Delete an instance']}, 1: {'id': "
â”‚ â”‚ â”‚â”„             "'33c2bb76-d61f-4866-87e2-780e61600022', 'source': ['from lndb import delete, load, "
â”‚ â”‚ â”‚â”„             "login, init, settings\\n', 'from lndb.dev._settings_store import "
â”‚ â”‚ â”‚â”„             "instance_settings_file\\n', 'from pathlib import Path\\n', 'from datetime import "
â”‚ â”‚ â”‚â”„             'datetime\']}, 2: {\'id\': \'485f5ee1\', \'sou [â€¦]
â”‚ â”‚ â”‚ @@ -1,143 +1,148 @@
â”‚ â”‚ â”‚  {
â”‚ â”‚ â”‚      "cells": [
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "markdown",
â”‚ â”‚ â”‚ -            "id": "558d9dfc-e367-4406-b8df-c67647385e76",
â”‚ â”‚ â”‚ -            "metadata": {},
â”‚ â”‚ â”‚ +            "id": "b43d09d5-26d3-440d-b334-9643ec5248e6",
â”‚ â”‚ â”‚ +            "metadata": {
â”‚ â”‚ â”‚ +                "tags": []
â”‚ â”‚ â”‚ +            },
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "# Test migrations unit"
â”‚ â”‚ â”‚ +                "# Delete an instance"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚ -            "cell_type": "markdown",
â”‚ â”‚ â”‚ -            "id": "4330bc99-65c0-491d-a750-f59d86278b98",
â”‚ â”‚ â”‚ +            "cell_type": "code",
â”‚ â”‚ â”‚ +            "execution_count": null,
â”‚ â”‚ â”‚ +            "id": "33c2bb76-d61f-4866-87e2-780e61600022",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚ +            "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "Let us first mimic what happens inside a noxfile in a schema module. We set up a reference instance:"
â”‚ â”‚ â”‚ +                "from lndb import delete, load, login, init, settings\n",
â”‚ â”‚ â”‚ +                "from lndb.dev._settings_store import instance_settings_file\n",
â”‚ â”‚ â”‚ +                "from pathlib import Path\n",
â”‚ â”‚ â”‚ +                "from datetime import datetime"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚ -            "id": "a11f61be-cdb7-4f2c-9ab1-7f7a8c0351ea",
â”‚ â”‚ â”‚ +            "id": "485f5ee1",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "import lndb\n",
â”‚ â”‚ â”‚ -                "from laminci.db import setup_local_test_postgres"
â”‚ â”‚ â”‚ +                "login(\"testuser1\")"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚ -            "cell_type": "code",
â”‚ â”‚ â”‚ -            "execution_count": null,
â”‚ â”‚ â”‚ -            "id": "ce23227a-af86-4621-90b3-baff8107cd67",
â”‚ â”‚ â”‚ +            "cell_type": "markdown",
â”‚ â”‚ â”‚ +            "id": "cceb6b43",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚ -            "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "pgurl = setup_local_test_postgres()"
â”‚ â”‚ â”‚ +                "## With local default storage"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚ -            "id": "cd90aa98-51a6-4e08-9945-be2b2c5944bf",
â”‚ â”‚ â”‚ +            "id": "2609e58d",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "lndb.init(storage=\"./pgtest\", db=pgurl)"
â”‚ â”‚ â”‚ +                "init(storage=\"mydata-delete\")\n",
â”‚ â”‚ â”‚ +                "settings_file = instance_settings_file(\"mydata-delete\", \"testuser1\")"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "markdown",
â”‚ â”‚ â”‚ -            "id": "5082f68d-11c4-4568-8651-1b58f12825a7",
â”‚ â”‚ â”‚ +            "id": "25a13298",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "Let's now procede to importing lnschema_core (it depends on the current instance settings which were changed by lndb.init):"
â”‚ â”‚ â”‚ +                "Running \n",
â”‚ â”‚ â”‚ +                "```\n",
â”‚ â”‚ â”‚ +                "!lamin delete mydata\n",
â”‚ â”‚ â”‚ +                "```"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚ -            "id": "5ce51d4d-b5a5-4a50-98f1-5ac993070f19",
â”‚ â”‚ â”‚ +            "id": "8436575d",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "import os\n",
â”‚ â”‚ â”‚ -                "import lnschema_core\n",
â”‚ â”‚ â”‚ -                "from pathlib import Path\n",
â”‚ â”‚ â”‚ -                "from lnschema_core import _schema_id as schema_id\n",
â”‚ â”‚ â”‚ -                "from lndb._migrate import generate_module_files\n",
â”‚ â”‚ â”‚ -                "from lndb.test import model_definitions_match_ddl"
â”‚ â”‚ â”‚ +                "delete(\"mydata-delete\")"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚ -            "id": "24ce5c11-2f13-40b7-baa8-a6c8e4c7800c",
â”‚ â”‚ â”‚ +            "id": "d2e607c9",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "package_name = \"lnschema_core\"\n",
â”‚ â”‚ â”‚ -                "migrations_path = Path(lnschema_core.__file__).parent / \"migrations\""
â”‚ â”‚ â”‚ +                "assert settings_file.exists() == False"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚ -            "cell_type": "code",
â”‚ â”‚ â”‚ -            "execution_count": null,
â”‚ â”‚ â”‚ -            "id": "c4ef3b08-486d-43d3-9e02-201fc4f91957",
â”‚ â”‚ â”‚ +            "cell_type": "markdown",
â”‚ â”‚ â”‚ +            "id": "3286fbcc",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚ -            "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "migrations_path"
â”‚ â”‚ â”‚ +                "## With remote default storage"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚ -            "id": "e6a8fb6d-82bb-4546-aa3b-87a9b456bd3d",
â”‚ â”‚ â”‚ +            "id": "fa1efbce",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "Path(lnschema_core.__file__).parent.parent"
â”‚ â”‚ â”‚ +                "instance_name = f\"lamin.ci.instance.{datetime.now().timestamp()}\""
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚ -            "id": "79a3214f-ef24-4927-afe6-aaa8cde23157",
â”‚ â”‚ â”‚ +            "id": "037f38a3",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "# currently still needed\n",
â”‚ â”‚ â”‚ -                "os.chdir(Path(lnschema_core.__file__).parent.parent)"
â”‚ â”‚ â”‚ +                "init(storage=\"s3://lndb-setup-delete-ci\", name=instance_name)"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚ -            "id": "b49d863b-37e4-44f1-be3f-2e5fce1e9342",
â”‚ â”‚ â”‚ +            "id": "b2593ef8",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "def test_model_definitions_match_ddl_postgres():\n",
â”‚ â”‚ â”‚ -                "    generate_module_files(\n",
â”‚ â”‚ â”‚ -                "        package_name=package_name, migrations_path=migrations_path, schema_id=schema_id\n",
â”‚ â”‚ â”‚ -                "    )\n",
â”‚ â”‚ â”‚ -                "    model_definitions_match_ddl(package_name, dialect_name=\"postgresql\")"
â”‚ â”‚ â”‚ +                "delete(instance_name)"
â”‚ â”‚ â”‚ +            ]
â”‚ â”‚ â”‚ +        },
â”‚ â”‚ â”‚ +        {
â”‚ â”‚ â”‚ +            "cell_type": "markdown",
â”‚ â”‚ â”‚ +            "id": "06a22900",
â”‚ â”‚ â”‚ +            "metadata": {},
â”‚ â”‚ â”‚ +            "source": [
â”‚ â”‚ â”‚ +                "Clean up instances."
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚ -            "id": "a0dca892-4a44-48ba-91f0-7f6b78bba4d2",
â”‚ â”‚ â”‚ +            "id": "9117428e",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "test_model_definitions_match_ddl_postgres()"
â”‚ â”‚ â”‚ +                "from lnhub_rest._clean_ci import delete_ci_instances\n",
â”‚ â”‚ â”‚ +                "\n",
â”‚ â”‚ â”‚ +                "delete_ci_instances()"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          }
â”‚ â”‚ â”‚      ],
â”‚ â”‚ â”‚      "metadata": {
â”‚ â”‚ â”‚          "kernelspec": {
â”‚ â”‚ â”‚              "display_name": "Python 3 (ipykernel)",
â”‚ â”‚ â”‚              "language": "python",
â”‚ â”‚ â”‚ @@ -150,12 +155,17 @@
â”‚ â”‚ â”‚              },
â”‚ â”‚ â”‚              "file_extension": ".py",
â”‚ â”‚ â”‚              "mimetype": "text/x-python",
â”‚ â”‚ â”‚              "name": "python",
â”‚ â”‚ â”‚              "nbconvert_exporter": "python",
â”‚ â”‚ â”‚              "pygments_lexer": "ipython3",
â”‚ â”‚ â”‚              "version": "3.9.15"
â”‚ â”‚ â”‚ +        },
â”‚ â”‚ â”‚ +        "vscode": {
â”‚ â”‚ â”‚ +            "interpreter": {
â”‚ â”‚ â”‚ +                "hash": "40d3a090f54c6569ab1632332b64b2c03c39dcf918b08424e98f38b5ae0af88f"
â”‚ â”‚ â”‚ +            }
â”‚ â”‚ â”‚          }
â”‚ â”‚ â”‚      },
â”‚ â”‚ â”‚      "nbformat": 4,
â”‚ â”‚ â”‚      "nbformat_minor": 5
â”‚ â”‚ â”‚  }
â”‚ â”‚   --- lndb-0.39.2/docs/guide/01-setup-user.ipynb
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/guide/01-setup-user.ipynb
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/docs/guide/02-init-instance.ipynb
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/guide/02-init-instance.ipynb
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/docs/guide/03-load-instance.ipynb
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/guide/03-load-instance.ipynb
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/docs/guide/04-set-storage.ipynb
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/guide/04-set-storage.ipynb
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/docs/guide/05-schema-modules.ipynb
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/guide/05-schema-modules.ipynb
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/docs/guide/06-info.ipynb
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/faq/manage-migrations.ipynb
â”‚ â”‚â”„ Files 14% similar despite different names
â”‚ â”‚ â”œâ”€â”€ Pretty-printed
â”‚ â”‚ â”‚â”„ Similarity: 0.8163194444444444%
â”‚ â”‚ â”‚â”„ Differences: {"'cells'": "{0: {'metadata': {replace: OrderedDict()}, 'source': ['# Manage migrations'], delete: "
â”‚ â”‚ â”‚â”„             "['id']}, 1: {'source': ['import lndb'], delete: ['id']}, 2: {'source': {insert: [(0, "
â”‚ â”‚ â”‚â”„             "'Running the following on the CLI\\n'), (2, 'lamin migrate generate\\n'), (4, "
â”‚ â”‚ â”‚â”„             "'runs')], delete: [5, 4, 2, 0]}, delete: ['id']}, 3: {'source': "
â”‚ â”‚ â”‚â”„             '[\'lndb.migrate.generate(package_name="lnschema_core")\'], delete: [\'id\']}, delete: '
â”‚ â”‚ â”‚â”„             '[1]}',
â”‚ â”‚ â”‚â”„  "'nbformat_minor' [â€¦]
â”‚ â”‚ â”‚ @@ -1,60 +1,43 @@
â”‚ â”‚ â”‚  {
â”‚ â”‚ â”‚      "cells": [
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "markdown",
â”‚ â”‚ â”‚ -            "id": "b43d09d5-26d3-440d-b334-9643ec5248e6",
â”‚ â”‚ â”‚ -            "metadata": {
â”‚ â”‚ â”‚ -                "tags": []
â”‚ â”‚ â”‚ -            },
â”‚ â”‚ â”‚ -            "source": [
â”‚ â”‚ â”‚ -                "# Get info on an instance"
â”‚ â”‚ â”‚ -            ]
â”‚ â”‚ â”‚ -        },
â”‚ â”‚ â”‚ -        {
â”‚ â”‚ â”‚ -            "cell_type": "code",
â”‚ â”‚ â”‚ -            "execution_count": null,
â”‚ â”‚ â”‚ -            "id": "33c2bb76-d61f-4866-87e2-780e61600022",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚ -            "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "import lamindb as ln"
â”‚ â”‚ â”‚ +                "# Manage migrations"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚ -            "id": "b8a6f1fe",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "ln.setup.load(\"mydata\")"
â”‚ â”‚ â”‚ +                "import lndb"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "markdown",
â”‚ â”‚ â”‚ -            "id": "25a13298",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "Running \n",
â”‚ â”‚ â”‚ +                "Running the following on the CLI\n",
â”‚ â”‚ â”‚                  "```\n",
â”‚ â”‚ â”‚ -                "lamin info\n",
â”‚ â”‚ â”‚ +                "lamin migrate generate\n",
â”‚ â”‚ â”‚                  "```\n",
â”‚ â”‚ â”‚ -                "\n",
â”‚ â”‚ â”‚ -                "on the command line runs the following:"
â”‚ â”‚ â”‚ +                "runs"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          },
â”‚ â”‚ â”‚          {
â”‚ â”‚ â”‚              "cell_type": "code",
â”‚ â”‚ â”‚              "execution_count": null,
â”‚ â”‚ â”‚ -            "id": "8436575d",
â”‚ â”‚ â”‚              "metadata": {},
â”‚ â”‚ â”‚              "outputs": [],
â”‚ â”‚ â”‚              "source": [
â”‚ â”‚ â”‚ -                "ln.setup.info()"
â”‚ â”‚ â”‚ +                "lndb.migrate.generate(package_name=\"lnschema_core\")"
â”‚ â”‚ â”‚              ]
â”‚ â”‚ â”‚          }
â”‚ â”‚ â”‚      ],
â”‚ â”‚ â”‚      "metadata": {
â”‚ â”‚ â”‚          "kernelspec": {
â”‚ â”‚ â”‚              "display_name": "Python 3 (ipykernel)",
â”‚ â”‚ â”‚              "language": "python",
â”‚ â”‚ â”‚ @@ -75,9 +58,9 @@
â”‚ â”‚ â”‚          "vscode": {
â”‚ â”‚ â”‚              "interpreter": {
â”‚ â”‚ â”‚                  "hash": "40d3a090f54c6569ab1632332b64b2c03c39dcf918b08424e98f38b5ae0af88f"
â”‚ â”‚ â”‚              }
â”‚ â”‚ â”‚          }
â”‚ â”‚ â”‚      },
â”‚ â”‚ â”‚      "nbformat": 4,
â”‚ â”‚ â”‚ -    "nbformat_minor": 5
â”‚ â”‚ â”‚ +    "nbformat_minor": 4
â”‚ â”‚ â”‚  }
â”‚ â”‚   --- lndb-0.39.2/docs/guide/migrate.md
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/docs/guide/migrate.md
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/__init__.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/__init__.py
â”‚ â”‚â”„ Files 6% similar despite different names
â”‚ â”‚ @@ -46,21 +46,21 @@
â”‚ â”‚  
â”‚ â”‚  .. autosummary::
â”‚ â”‚     :toctree:
â”‚ â”‚  
â”‚ â”‚     dev
â”‚ â”‚  """
â”‚ â”‚  
â”‚ â”‚ -__version__ = "0.39.2"  # denote a release candidate for 0.1.0 with 0.1rc1
â”‚ â”‚ +__version__ = "0.40.0"  # denote a release candidate for 0.1.0 with 0.1rc1
â”‚ â”‚  
â”‚ â”‚  import sys
â”‚ â”‚  from os import name as _os_name
â”‚ â”‚  
â”‚ â”‚  from . import _check_versions  # noqa
â”‚ â”‚ -from . import dev
â”‚ â”‚ +from . import dev, test
â”‚ â”‚  from ._close import close  # noqa
â”‚ â”‚  from ._delete import delete  # noqa
â”‚ â”‚  from ._info import info  # noqa
â”‚ â”‚  from ._init_instance import init  # noqa
â”‚ â”‚  from ._load_instance import load  # noqa
â”‚ â”‚  from ._migrate import migrate
â”‚ â”‚  from ._schema import schema  # noqa
â”‚ â”‚   --- lndb-0.39.2/lndb/__main__.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/__main__.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/_delete.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/_delete.py
â”‚ â”‚â”„ Files 14% similar despite different names
â”‚ â”‚ @@ -17,19 +17,22 @@
â”‚ â”‚          raise RuntimeError(
â”‚ â”‚              "Instance settings do not exist locally. Did you provide a wrong instance"
â”‚ â”‚              " name? Could you try loading it?"
â”‚ â”‚          )
â”‚ â”‚      isettings = load_instance_settings(settings_file)
â”‚ â”‚  
â”‚ â”‚      delete_settings(settings_file)
â”‚ â”‚ -    if instance_identifier == settings.instance.identifier:
â”‚ â”‚ -        current_settings_file = current_instance_settings_file()
â”‚ â”‚ -        logger.info(f"    current instance settings {current_settings_file} deleted")
â”‚ â”‚ -        current_settings_file.unlink()
â”‚ â”‚ -        settings._instance_settings = None
â”‚ â”‚ +    if settings._instance_exists:
â”‚ â”‚ +        if instance_identifier == settings.instance.identifier:
â”‚ â”‚ +            current_settings_file = current_instance_settings_file()
â”‚ â”‚ +            logger.info(
â”‚ â”‚ +                f"    current instance settings {current_settings_file} deleted"
â”‚ â”‚ +            )
â”‚ â”‚ +            current_settings_file.unlink()
â”‚ â”‚ +            settings._instance_settings = None
â”‚ â”‚      delete_cache(isettings.storage.cache_dir)
â”‚ â”‚      logger.info(
â”‚ â”‚          f"    consider deleting your stored data manually: {isettings.storage.root}"
â”‚ â”‚      )
â”‚ â”‚      if isettings.dialect == "sqlite":
â”‚ â”‚          if isettings._sqlite_file.exists():
â”‚ â”‚              isettings._sqlite_file.unlink()
â”‚ â”‚   --- lndb-0.39.2/lndb/_init_instance.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/_init_instance.py
â”‚ â”‚â”„ Files 2% similar despite different names
â”‚ â”‚ @@ -1,24 +1,25 @@
â”‚ â”‚  import sys
â”‚ â”‚  from pathlib import Path
â”‚ â”‚  from typing import Optional, Union
â”‚ â”‚  
â”‚ â”‚  from lamin_logger import logger
â”‚ â”‚ +from lndb_storage import UPath
â”‚ â”‚  from lnhub_rest._add_storage import get_storage_region
â”‚ â”‚  from lnhub_rest._init_instance import init_instance as init_instance_hub
â”‚ â”‚  from lnhub_rest._init_instance import (
â”‚ â”‚      validate_db_arg,
â”‚ â”‚      validate_schema_arg,
â”‚ â”‚      validate_storage_arg,
â”‚ â”‚  )
â”‚ â”‚  from pydantic import PostgresDsn
â”‚ â”‚  
â”‚ â”‚  from ._load_instance import load, load_from_isettings
â”‚ â”‚  from ._settings import settings
â”‚ â”‚ -from .dev import InstanceSettings, UPath
â”‚ â”‚ +from .dev import InstanceSettings
â”‚ â”‚  from .dev._db import insert_if_not_exists, upsert
â”‚ â”‚  from .dev._docs import doc_args
â”‚ â”‚  from .dev._setup_knowledge import write_bionty_versions
â”‚ â”‚  from .dev._setup_schema import load_schema, setup_schema
â”‚ â”‚  from .dev._storage import Storage
â”‚ â”‚   --- lndb-0.39.2/lndb/_load_instance.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/_load_instance.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/_migrate/__init__.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/_migrate/core.py
â”‚ â”‚â”„ Files 10% similar despite different names
â”‚ â”‚ @@ -1,96 +1,96 @@
â”‚ â”‚ -from pathlib import Path
â”‚ â”‚  from subprocess import run
â”‚ â”‚  from typing import Optional
â”‚ â”‚  
â”‚ â”‚  from lamin_logger import logger
â”‚ â”‚ +from laminci import get_package_name
â”‚ â”‚  
â”‚ â”‚ -from ._deploy import check_deploy_migration  # noqa
â”‚ â”‚ -from ._utils import (
â”‚ â”‚ +from lndb._migrate.deploy import check_deploy_migration  # noqa
â”‚ â”‚ +from lndb._migrate.utils import (
â”‚ â”‚      generate_module_files,
â”‚ â”‚ -    get_package_info,
â”‚ â”‚ +    get_schema_package_info,
â”‚ â”‚      modify_alembic_ini,
â”‚ â”‚      modify_migration_id_in__init__,
â”‚ â”‚      set_alembic_logging_level,
â”‚ â”‚  )
â”‚ â”‚  
â”‚ â”‚ -push_instruction = """Please push your changes to a new remote branch and open a PR.
â”‚ â”‚ -Inspect CI step Build output and add migration code to the script.
â”‚ â”‚ -It will look like the following, beware of the renaming:
â”‚ â”‚ +push_instruction = """\
â”‚ â”‚ +Please push your changes to a new remote branch, open a PR, and wait for CI.
â”‚ â”‚ +
â”‚ â”‚ +Inspect the bottom of the output of the CI step 'Build'
â”‚ â”‚ +and add the code to the migration script.
â”‚ â”‚ +
â”‚ â”‚ +It will look like the following:
â”‚ â”‚      op.drop_column('biosample', 'description', schema='wetlab')
â”‚ â”‚ -    op.add_column('experiment', sa.Column('donor_id', sqlmodel.sql.sqltypes.AutoString(), schema="wetlab")"""  # noqa
â”‚ â”‚ +    op.add_column('experiment', sa.Column('donor_id', sqlmodel.sql.sqltypes.AutoString(), schema="wetlab")  # noqa
â”‚ â”‚ +
â”‚ â”‚ +Beware to account for renaming columns and tables manually, e.g.:
â”‚ â”‚ +    op.alter_column("mytable", column_name="oldname", new_column_name="newname", schema="myschema")  # noqa
â”‚ â”‚ +
â”‚ â”‚ +"""
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚  class migrate:
â”‚ â”‚      """Manage migrations."""
â”‚ â”‚  
â”‚ â”‚      @staticmethod
â”‚ â”‚      def generate(
â”‚ â”‚          version: str = "vX.X.X",
â”‚ â”‚ -        schema_root: Optional[Path] = None,
â”‚ â”‚          package_name: Optional[str] = None,
â”‚ â”‚      ):
â”‚ â”‚          """Generate migration for current schema module.
â”‚ â”‚  
â”‚ â”‚          Needs to be executed at the root level of the python package that contains
â”‚ â”‚          the schema module.
â”‚ â”‚  
â”‚ â”‚          Args:
â”‚ â”‚              version: Version string to label migration with.
â”‚ â”‚ -            schema_root: Optional. Root directory of schema module.
â”‚ â”‚              package_name: Optional. Name of schema module package.
â”‚ â”‚          """
â”‚ â”‚ -        package_name, migrations_path, schema_id = get_package_info(
â”‚ â”‚ -            schema_root=schema_root, package_name=package_name
â”‚ â”‚ -        )
â”‚ â”‚ -        generate_module_files(
â”‚ â”‚ -            package_name=package_name,  # type:ignore
â”‚ â”‚ -            migrations_path=migrations_path,
â”‚ â”‚ -            schema_id=schema_id,
â”‚ â”‚ -        )
â”‚ â”‚ -        testdb_path = migrations_path.parent.parent / "testdb/testdb.lndb"  # type: ignore # noqa
â”‚ â”‚ +        if package_name is None:
â”‚ â”‚ +            package_name = get_package_name()
â”‚ â”‚ +        package_dir, migrations_dir, schema_id = get_schema_package_info(package_name)
â”‚ â”‚ +        generate_module_files(package_name)
â”‚ â”‚ +        testdb_path = package_dir.parent / "testdb/testdb.lndb"  # type: ignore # noqa
â”‚ â”‚          if testdb_path.exists():
â”‚ â”‚              # runs dev mode to write migration scripts
â”‚ â”‚              rm = False
â”‚ â”‚ -            set_alembic_logging_level(migrations_path, level="INFO")
â”‚ â”‚ -            logger.info("Generate migration with reference db: testdb/testdb.lndb")
â”‚ â”‚ +            set_alembic_logging_level(migrations_dir, level="INFO")
â”‚ â”‚ +            logger.info(f"Generating based on {testdb_path}")
â”‚ â”‚          else:
â”‚ â”‚              # runs CI-guided mode to generate empty migration scripts
â”‚ â”‚              rm = True
â”‚ â”‚              from lndb._settings import settings
â”‚ â”‚  
â”‚ â”‚              modify_alembic_ini(
â”‚ â”‚ -                filepath=migrations_path.parent / "alembic.ini",
â”‚ â”‚ +                filepath=package_dir / "alembic.ini",
â”‚ â”‚                  isettings=settings.instance,
â”‚ â”‚                  package_name=package_name,
â”‚ â”‚                  move_sl=False,
â”‚ â”‚              )
â”‚ â”‚ -            set_alembic_logging_level(migrations_path, level="WARN")
â”‚ â”‚ +            set_alembic_logging_level(migrations_dir, level="WARN")
â”‚ â”‚              logger.info("Generate empty migration script.")
â”‚ â”‚          command = (
â”‚ â”‚ -            f"alembic --config {package_name}/alembic.ini --name {schema_id} revision"
â”‚ â”‚ -            f" --autogenerate -m '{version}'"
â”‚ â”‚ +            f"alembic --config {str(package_dir)}/alembic.ini --name"
â”‚ â”‚ +            f" {schema_id} revision --autogenerate -m '{version}'"
â”‚ â”‚          )
â”‚ â”‚ -        if schema_root is not None:
â”‚ â”‚ -            cwd = f"{schema_root}"
â”‚ â”‚ -        else:
â”‚ â”‚ -            cwd = None
â”‚ â”‚ -        process = run(command, shell=True, cwd=cwd)
â”‚ â”‚ +        process = run(command, shell=True)
â”‚ â”‚  
â”‚ â”‚          modify_migration_id_in__init__(package_name)
â”‚ â”‚  
â”‚ â”‚          if process.returncode == 0:
â”‚ â”‚              logger.success(f"Successfully generated migration {version}.")
â”‚ â”‚              if rm:
â”‚ â”‚                  modify_alembic_ini(
â”‚ â”‚ -                    filepath=migrations_path.parent / "alembic.ini",
â”‚ â”‚ +                    filepath=migrations_dir.parent / "alembic.ini",
â”‚ â”‚                      isettings=settings.instance,
â”‚ â”‚                      package_name=package_name,
â”‚ â”‚                      move_sl=False,
â”‚ â”‚                      revert=True,
â”‚ â”‚                  )
â”‚ â”‚                  logger.info(push_instruction)
â”‚ â”‚              return None
â”‚ â”‚          else:
â”‚ â”‚              print(process.stderr)
â”‚ â”‚              logger.error("Generating migration failed.")
â”‚ â”‚ +            logger.info(f"Check content of {str(package_dir)}/alembic.ini")
â”‚ â”‚              return "migrate-gen-failed"
â”‚ â”‚   --- lndb-0.39.2/lndb/_migrate/_deploy.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/_migrate/deploy.py
â”‚ â”‚â”„ Files 3% similar despite different names
â”‚ â”‚ @@ -7,19 +7,19 @@
â”‚ â”‚  from typing import Any, Optional
â”‚ â”‚  
â”‚ â”‚  import sqlmodel as sqm
â”‚ â”‚  from lamin_logger import logger
â”‚ â”‚  from natsort import natsorted
â”‚ â”‚  from packaging.version import parse as vparse
â”‚ â”‚  
â”‚ â”‚ -from ..dev._db import insert
â”‚ â”‚ -from ..dev._settings_instance import InstanceSettings
â”‚ â”‚ -from ..dev._settings_user import UserSettings
â”‚ â”‚ -from ..dev._setup_schema import create_schema_if_not_exists, get_schema_module_name
â”‚ â”‚ -from ._utils import generate_module_files, modify_alembic_ini
â”‚ â”‚ +from lndb._migrate.utils import generate_module_files, modify_alembic_ini
â”‚ â”‚ +from lndb.dev._db import insert
â”‚ â”‚ +from lndb.dev._settings_instance import InstanceSettings
â”‚ â”‚ +from lndb.dev._settings_user import UserSettings
â”‚ â”‚ +from lndb.dev._setup_schema import create_schema_if_not_exists, get_schema_module_name
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚  def check_deploy_migration(
â”‚ â”‚      *,
â”‚ â”‚      usettings: UserSettings,
â”‚ â”‚      isettings: InstanceSettings,
â”‚ â”‚      attempt_deploy: Optional[bool] = None,
â”‚ â”‚   --- lndb-0.39.2/lndb/_migrate/_utils.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/_migrate/utils.py
â”‚ â”‚â”„ Files 23% similar despite different names
â”‚ â”‚ @@ -1,48 +1,26 @@
â”‚ â”‚  import importlib
â”‚ â”‚ +import shutil
â”‚ â”‚  from pathlib import Path
â”‚ â”‚ -from typing import Optional
â”‚ â”‚ -
â”‚ â”‚ -from lndb.test import get_package_name
â”‚ â”‚ -from lndb.test._migrations_unit import get_migration_id_from_scripts
â”‚ â”‚ +from typing import Optional, Tuple
â”‚ â”‚  
â”‚ â”‚  from ..dev._settings_instance import InstanceSettings
â”‚ â”‚  from ..dev._setup_schema import get_schema_module_name
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚ -def get_package_info(
â”‚ â”‚ -    schema_root: Optional[Path] = None, package_name: Optional[str] = None
â”‚ â”‚ -):
â”‚ â”‚ -    if package_name is None:
â”‚ â”‚ -        package_name = get_package_name(schema_root)
â”‚ â”‚ +# this is a special function for schema packages
â”‚ â”‚ +def get_schema_package_info(package_name: str) -> Tuple[Path, Path, str]:
â”‚ â”‚      package = importlib.import_module(package_name)
â”‚ â”‚      if not hasattr(package, "_schema_id"):
â”‚ â”‚          package_name = f"{package_name}.schema"
â”‚ â”‚          package = importlib.import_module(package_name)
â”‚ â”‚      schema_id = getattr(package, "_schema_id")
â”‚ â”‚ -    migrations_path = Path(package.__file__).parent / "migrations"  # type:ignore
â”‚ â”‚ -    return package_name, migrations_path, schema_id
â”‚ â”‚ -
â”‚ â”‚ -
â”‚ â”‚ -def generate_alembic_ini(
â”‚ â”‚ -    package_name: str,
â”‚ â”‚ -    migrations_path: Optional[Path] = None,
â”‚ â”‚ -    schema_id: Optional[str] = None,
â”‚ â”‚ -):
â”‚ â”‚ -    if migrations_path is None:
â”‚ â”‚ -        _, migrations_path, schema_id = get_package_info(package_name=package_name)
â”‚ â”‚ -    _migrations_path = Path(__file__).parent
â”‚ â”‚ -
â”‚ â”‚ -    if not (migrations_path.parent / "alembic.ini").exists():
â”‚ â”‚ -        content = (
â”‚ â”‚ -            _readfile(_migrations_path / "alembic.ini")
â”‚ â”‚ -            .replace("[{schema_id}]", f"[{schema_id}]")
â”‚ â”‚ -            .replace("{package_name}/migrations", f"{package_name}/migrations")
â”‚ â”‚ -        )
â”‚ â”‚ -        _writefile(migrations_path.parent / "alembic.ini", content)
â”‚ â”‚ +    package_dir = Path(package.__file__).parent  # type: ignore
â”‚ â”‚ +    migrations_dir = package_dir / "migrations"
â”‚ â”‚ +    return package_dir, migrations_dir, schema_id
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚  def modify_migration_id_in__init__(package_name) -> None:
â”‚ â”‚      """Rewrite the migration_id in the __init__.py of the schema module."""
â”‚ â”‚      package = importlib.import_module(package_name)
â”‚ â”‚      filepath = str(package.__file__)
â”‚ â”‚  
â”‚ â”‚ @@ -51,14 +29,16 @@
â”‚ â”‚  
â”‚ â”‚      # get line with migration id
â”‚ â”‚      for line in content.split("\n"):
â”‚ â”‚          if line.startswith("_migration = "):
â”‚ â”‚              current_line = line
â”‚ â”‚              break
â”‚ â”‚  
â”‚ â”‚ +    from lndb.test._migrations_unit import get_migration_id_from_scripts
â”‚ â”‚ +
â”‚ â”‚      migration_id = get_migration_id_from_scripts(package_name)
â”‚ â”‚      content = content.replace(current_line, f'_migration = "{migration_id}"')
â”‚ â”‚  
â”‚ â”‚      with open(filepath, "w") as f:
â”‚ â”‚          f.write(content)
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚ @@ -96,50 +76,56 @@
â”‚ â”‚  
â”‚ â”‚      with open(filepath, "w") as f:
â”‚ â”‚          f.write(content)
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚  def generate_module_files(
â”‚ â”‚      package_name: str,
â”‚ â”‚ -    migrations_path: Optional[Path] = None,
â”‚ â”‚ +    # the following two are for backward compat only!
â”‚ â”‚ +    # they are not being used
â”‚ â”‚ +    migrations_path: Optional[Path] = None,  # noqa
â”‚ â”‚      schema_id: Optional[str] = None,
â”‚ â”‚  ):
â”‚ â”‚ -    if migrations_path is None:
â”‚ â”‚ -        _, migrations_path, schema_id = get_package_info(package_name=package_name)
â”‚ â”‚ -    _migrations_path = Path(__file__).parent
â”‚ â”‚ +    # this calls ensures that package_name is the only used argument here
â”‚ â”‚ +    package_dir, migrations_dir, schema_id = get_schema_package_info(package_name)
â”‚ â”‚ +    migrations_templates_dir = Path(__file__).parent
â”‚ â”‚  
â”‚ â”‚      # ensures migrations/versions folder exists
â”‚ â”‚ -    (migrations_path / "versions").mkdir(exist_ok=True, parents=True)
â”‚ â”‚ +    (migrations_dir / "versions").mkdir(exist_ok=True, parents=True)
â”‚ â”‚  
â”‚ â”‚ -    if not (migrations_path / "env.py").exists():
â”‚ â”‚ +    if not (migrations_dir / "env.py").exists():
â”‚ â”‚          content = (
â”‚ â”‚ -            _readfile(_migrations_path / "env.py")
â”‚ â”‚ +            _readfile(migrations_templates_dir / "env.py")
â”‚ â”‚              .replace("_schema_id = None\n", "")
â”‚ â”‚              .replace("# from {package_name} import *", f"from {package_name} import *")
â”‚ â”‚              .replace(
â”‚ â”‚                  "# from {package_name} import _schema_id",
â”‚ â”‚                  f"from {package_name} import _schema_id",
â”‚ â”‚              )
â”‚ â”‚          )
â”‚ â”‚ -        _writefile(migrations_path / "env.py", content)
â”‚ â”‚ -
â”‚ â”‚ -    if not (migrations_path / "script.py.mako").exists():
â”‚ â”‚ -        import shutil
â”‚ â”‚ +        _writefile(migrations_dir / "env.py", content)
â”‚ â”‚  
â”‚ â”‚ +    if not (migrations_dir / "script.py.mako").exists():
â”‚ â”‚          shutil.copyfile(
â”‚ â”‚ -            _migrations_path / "script.py.mako", migrations_path / "script.py.mako"
â”‚ â”‚ +            migrations_templates_dir / "script.py.mako",
â”‚ â”‚ +            migrations_dir / "script.py.mako",
â”‚ â”‚          )
â”‚ â”‚  
â”‚ â”‚ -    generate_alembic_ini(
â”‚ â”‚ -        package_name=package_name, migrations_path=migrations_path, schema_id=schema_id
â”‚ â”‚ -    )
â”‚ â”‚ +    # this is at the package_dir level, not at the migrations_dir level
â”‚ â”‚ +    if not (package_dir / "alembic.ini").exists():
â”‚ â”‚ +        content = (
â”‚ â”‚ +            _readfile(migrations_templates_dir / "alembic.ini")
â”‚ â”‚ +            .replace("[{schema_id}]", f"[{schema_id}]")
â”‚ â”‚ +            .replace("{package_dir}/migrations", f"{str(migrations_dir)}")
â”‚ â”‚ +        )
â”‚ â”‚ +        _writefile(migrations_dir.parent / "alembic.ini", content)
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚ -def set_alembic_logging_level(migrations_path: Path, level="INFO"):
â”‚ â”‚ -    alembic_ini_path = migrations_path.parent / "alembic.ini"
â”‚ â”‚ +def set_alembic_logging_level(migrations_dir: Path, level="INFO"):
â”‚ â”‚ +    alembic_ini_path = migrations_dir.parent / "alembic.ini"
â”‚ â”‚      text = _readfile(alembic_ini_path)
â”‚ â”‚      current_level = text.split("[logger_alembic]\n")[1].split("\n")[0]
â”‚ â”‚      new_level = f"level = {level}"
â”‚ â”‚      _writefile(
â”‚ â”‚          alembic_ini_path,
â”‚ â”‚          text.replace(
â”‚ â”‚              f"[logger_alembic]\n{current_level}", f"[logger_alembic]\n{new_level}"
â”‚ â”‚   --- lndb-0.39.2/lndb/_migrate/alembic.ini
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/_migrate/alembic.ini
â”‚ â”‚â”„ Files 2% similar despite different names
â”‚ â”‚ @@ -1,9 +1,9 @@
â”‚ â”‚  [{schema_id}]
â”‚ â”‚ -script_location = {package_name}/migrations
â”‚ â”‚ +script_location = {package_dir}/migrations
â”‚ â”‚  file_template = %%(year)d-%%(month).2d-%%(day).2d-%%(rev)s-%%(slug)s
â”‚ â”‚  prepend_sys_path = .
â”‚ â”‚  version_path_separator = os
â”‚ â”‚  sqlalchemy.url = sqlite:///testdb/testdb.lndb
â”‚ â”‚  
â”‚ â”‚  # Logging configuration
â”‚ â”‚  [loggers]
â”‚ â”‚   --- lndb-0.39.2/lndb/_migrate/env.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/_migrate/env.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/_schema.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/_schema.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/_set.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/_set.py
â”‚ â”‚â”„ Files 8% similar despite different names
â”‚ â”‚ @@ -1,16 +1,17 @@
â”‚ â”‚  from pathlib import Path
â”‚ â”‚  from typing import Union
â”‚ â”‚  
â”‚ â”‚  from lamin_logger import logger
â”‚ â”‚ +from lndb_storage import UPath
â”‚ â”‚  from lnhub_rest._add_storage import add_storage as add_storage_hub
â”‚ â”‚  
â”‚ â”‚  from ._init_instance import register
â”‚ â”‚  from ._settings import settings
â”‚ â”‚ -from .dev import UPath, deprecated
â”‚ â”‚ +from .dev import deprecated
â”‚ â”‚  from .dev._settings_instance import InstanceSettings
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚  class set:
â”‚ â”‚      """Set properties of current instance."""
â”‚ â”‚  
â”‚ â”‚      @staticmethod
â”‚ â”‚   --- lndb-0.39.2/lndb/_settings.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/_settings.py
â”‚ â”‚â”„ Files 22% similar despite different names
â”‚ â”‚ @@ -1,13 +1,12 @@
â”‚ â”‚  import os
â”‚ â”‚  from typing import Union
â”‚ â”‚  
â”‚ â”‚ -from .dev._settings_instance import InstanceSettings
â”‚ â”‚ -from .dev._settings_load import load_instance_settings, load_or_create_user_settings
â”‚ â”‚ -from .dev._settings_user import UserSettings
â”‚ â”‚ +from lndb.dev import InstanceSettings, Storage, UserSettings
â”‚ â”‚ +from lndb.dev._settings_load import load_instance_settings, load_or_create_user_settings
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚  # https://stackoverflow.com/questions/128573/using-property-on-classmethods/64738850#64738850
â”‚ â”‚  class classproperty(object):
â”‚ â”‚      def __init__(self, fget):
â”‚ â”‚          self.fget = fget
â”‚ â”‚  
â”‚ â”‚ @@ -16,48 +15,54 @@
â”‚ â”‚          return self.fget(owner_cls)
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚  class settings:
â”‚ â”‚      """Settings access.
â”‚ â”‚  
â”‚ â”‚      - :class:`~lndb.dev.InstanceSettings`
â”‚ â”‚ +    - :class:`~lndb.dev.Storage`
â”‚ â”‚      - :class:`~lndb.dev.UserSettings`
â”‚ â”‚      """
â”‚ â”‚  
â”‚ â”‚      _user_settings: Union[UserSettings, None] = None
â”‚ â”‚      _instance_settings: Union[InstanceSettings, None] = None
â”‚ â”‚  
â”‚ â”‚      _user_settings_env: Union[str, None] = None
â”‚ â”‚      _instance_settings_env: Union[str, None] = None
â”‚ â”‚  
â”‚ â”‚      @classproperty
â”‚ â”‚      def user(cls) -> UserSettings:
â”‚ â”‚ -        """User-related settings."""
â”‚ â”‚ +        """User."""
â”‚ â”‚          if (
â”‚ â”‚              cls._user_settings is None
â”‚ â”‚              or cls._user_settings_env != get_env_name()  # noqa
â”‚ â”‚          ):
â”‚ â”‚              cls._user_settings = load_or_create_user_settings()
â”‚ â”‚              cls._user_settings_env = get_env_name()
â”‚ â”‚              if cls._user_settings and cls._user_settings.id is None:
â”‚ â”‚                  raise RuntimeError("Need to login, first: lamin login <email>")
â”‚ â”‚          return cls._user_settings  # type: ignore
â”‚ â”‚  
â”‚ â”‚      @classproperty
â”‚ â”‚      def instance(cls) -> InstanceSettings:
â”‚ â”‚ -        """Instance-related settings."""
â”‚ â”‚ +        """Instance."""
â”‚ â”‚          if (
â”‚ â”‚              cls._instance_settings is None
â”‚ â”‚              or cls._instance_settings_env != get_env_name()  # noqa
â”‚ â”‚          ):
â”‚ â”‚              cls._instance_settings = load_instance_settings()
â”‚ â”‚              cls._instance_settings_env = get_env_name()
â”‚ â”‚          return cls._instance_settings  # type: ignore
â”‚ â”‚  
â”‚ â”‚      @classproperty
â”‚ â”‚ +    def storage(cls) -> Storage:
â”‚ â”‚ +        """Storage."""
â”‚ â”‚ +        return cls.instance.storage
â”‚ â”‚ +
â”‚ â”‚ +    @classproperty
â”‚ â”‚      def _instance_exists(cls):
â”‚ â”‚          try:
â”‚ â”‚              cls.instance
â”‚ â”‚              return True
â”‚ â”‚          except RuntimeError:
â”‚ â”‚              return False
â”‚ â”‚   --- lndb-0.39.2/lndb/_setup_user.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/_setup_user.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/dev/_clone.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/dev/_clone.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/dev/_db.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/dev/_db.py
â”‚ â”‚â”„ Files 2% similar despite different names
â”‚ â”‚ @@ -2,18 +2,17 @@
â”‚ â”‚  # This is currently needed as we can only import the schema module
â”‚ â”‚  # once isettings have been adjusted
â”‚ â”‚  from pathlib import Path
â”‚ â”‚  from typing import Any, List, Optional, Union
â”‚ â”‚  
â”‚ â”‚  import sqlmodel as sqm
â”‚ â”‚  from lamin_logger import logger
â”‚ â”‚ +from lndb_storage import UPath
â”‚ â”‚  from sqlalchemy.exc import ProgrammingError
â”‚ â”‚  
â”‚ â”‚ -from lndb.dev import UPath
â”‚ â”‚ -
â”‚ â”‚  from .._settings import settings
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚  class upsert:
â”‚ â”‚      @classmethod
â”‚ â”‚      def user(cls, email: str, user_id: str, handle: str, name: str = None):
â”‚ â”‚          import lnschema_core as schema_core
â”‚ â”‚   --- lndb-0.39.2/lndb/dev/_deprecated.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/dev/_deprecated.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/dev/_exclusion.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/dev/_exclusion.py
â”‚ â”‚â”„ Files 6% similar despite different names
â”‚ â”‚ @@ -1,16 +1,15 @@
â”‚ â”‚  from datetime import datetime, timezone
â”‚ â”‚  from pathlib import Path
â”‚ â”‚  from typing import Optional, Union
â”‚ â”‚  
â”‚ â”‚  import fsspec
â”‚ â”‚  from dateutil.parser import isoparse  # type: ignore
â”‚ â”‚  from lamin_logger import logger
â”‚ â”‚ -
â”‚ â”‚ -from ._upath_ext import UPath
â”‚ â”‚ +from lndb_storage import UPath, _infer_filesystem
â”‚ â”‚  
â”‚ â”‚  EXPIRATION_TIME = 1800  # 30 min
â”‚ â”‚  
â”‚ â”‚  MAX_MSG_COUNTER = 1000  # print the msg after this number of iterations
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚  class empty_locker:
â”‚ â”‚ @@ -27,28 +26,18 @@
â”‚ â”‚      def __init__(self, user_id: str, storage_root: Union[UPath, Path]):
â”‚ â”‚          logger.debug(f"Init cloud sqlite locker: {user_id}, {storage_root}.")
â”‚ â”‚  
â”‚ â”‚          self._counter = 0
â”‚ â”‚  
â”‚ â”‚          self.user = user_id
â”‚ â”‚  
â”‚ â”‚ -        root = storage_root
â”‚ â”‚ -        self.root = root
â”‚ â”‚ -
â”‚ â”‚ -        if isinstance(root, UPath):
â”‚ â”‚ -            self.fs = root.fs
â”‚ â”‚ -        else:
â”‚ â”‚ -            protocol = fsspec.utils.get_protocol(str(root))
â”‚ â”‚ -            if protocol == "s3":
â”‚ â”‚ -                fs_kwargs = {"cache_regions": True}
â”‚ â”‚ -            else:
â”‚ â”‚ -                fs_kwargs = {}
â”‚ â”‚ -            self.fs = fsspec.filesystem(protocol, **fs_kwargs)
â”‚ â”‚ +        self.root = storage_root
â”‚ â”‚ +        self.fs, _ = _infer_filesystem(storage_root)
â”‚ â”‚  
â”‚ â”‚ -        exclusion_path = root / "exclusion"
â”‚ â”‚ +        exclusion_path = storage_root / "exclusion"
â”‚ â”‚          self.mapper = fsspec.FSMap(str(exclusion_path), self.fs, create=True)
â”‚ â”‚  
â”‚ â”‚          priorities_path = str(exclusion_path / "priorities")
â”‚ â”‚          if self.fs.exists(priorities_path):
â”‚ â”‚              self.users = self.mapper["priorities"].decode().split("*")
â”‚ â”‚  
â”‚ â”‚              if self.user not in self.users:
â”‚ â”‚   --- lndb-0.39.2/lndb/dev/_settings_instance.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/dev/_settings_instance.py
â”‚ â”‚â”„ Files 1% similar despite different names
â”‚ â”‚ @@ -1,22 +1,22 @@
â”‚ â”‚  import os
â”‚ â”‚  import shutil
â”‚ â”‚  from pathlib import Path
â”‚ â”‚  from typing import Literal, Optional, Set, Tuple, Union
â”‚ â”‚  
â”‚ â”‚  import sqlalchemy as sa
â”‚ â”‚  import sqlmodel as sqm
â”‚ â”‚ +from lndb_storage import UPath
â”‚ â”‚  from pydantic import PostgresDsn
â”‚ â”‚  from sqlalchemy.future import Engine
â”‚ â”‚  
â”‚ â”‚  from ._exclusion import empty_locker, get_locker
â”‚ â”‚  from ._settings_save import save_instance_settings
â”‚ â”‚  from ._settings_store import current_instance_settings_file, instance_settings_file
â”‚ â”‚  from ._storage import Storage
â”‚ â”‚ -from ._upath_ext import UPath
â”‚ â”‚  
â”‚ â”‚  # leave commented out until we understand more how to deal with
â”‚ â”‚  # migrations in redun
â”‚ â”‚  # https://stackoverflow.com/questions/2614984/sqlite-sqlalchemy-how-to-enforce-foreign-keys
â”‚ â”‚  # foreign key constraints for sqlite3
â”‚ â”‚  # from sqlite3 import Connection as SQLite3Connection
â”‚ â”‚  # from sqlalchemy import event
â”‚ â”‚   --- lndb-0.39.2/lndb/dev/_settings_load.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/dev/_settings_load.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/dev/_settings_save.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/dev/_settings_save.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/dev/_settings_user.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/dev/_settings_user.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/dev/_setup_knowledge.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/dev/_setup_knowledge.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/dev/_setup_schema.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/dev/_setup_schema.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/dev/_storage.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/dev/_storage.py
â”‚ â”‚â”„ Files 2% similar despite different names
â”‚ â”‚ @@ -1,14 +1,13 @@
â”‚ â”‚  import os
â”‚ â”‚  from pathlib import Path
â”‚ â”‚  from typing import Literal, Optional, Union
â”‚ â”‚  
â”‚ â”‚  from appdirs import AppDirs
â”‚ â”‚ -
â”‚ â”‚ -from ._upath_ext import UPath
â”‚ â”‚ +from lndb_storage import UPath
â”‚ â”‚  
â”‚ â”‚  DIRS = AppDirs("lamindb", "laminlabs")
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚  class Storage:
â”‚ â”‚      """Manage cloud or local storage."""
â”‚ â”‚   --- lndb-0.39.2/lndb/test/_migrations_e2e.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/test/_migrations_e2e.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/lndb/test/_migrations_unit.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/lndb/test/_migrations_unit.py
â”‚ â”‚â”„ Files 11% similar despite different names
â”‚ â”‚ @@ -3,87 +3,93 @@
â”‚ â”‚  from pathlib import Path
â”‚ â”‚  from subprocess import run
â”‚ â”‚  
â”‚ â”‚  import sqlalchemy as sa
â”‚ â”‚  from alembic import command
â”‚ â”‚  from alembic.autogenerate.api import AutogenContext
â”‚ â”‚  from alembic.autogenerate.render import _render_cmd_body
â”‚ â”‚ +from lamin_logger import logger
â”‚ â”‚  from pytest_alembic.config import Config
â”‚ â”‚  from pytest_alembic.executor import CommandExecutor, ConnectionExecutor
â”‚ â”‚  from pytest_alembic.plugin.error import AlembicTestFailure
â”‚ â”‚  from pytest_alembic.runner import MigrationContext
â”‚ â”‚  from sqlmodel import SQLModel
â”‚ â”‚  
â”‚ â”‚  from lndb._delete import delete
â”‚ â”‚  from lndb._init_instance import init
â”‚ â”‚ +from lndb._migrate import generate_module_files, get_schema_package_info
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚ -def get_migration_config(schema_package_loc, *, target_metadata=None, **kwargs):
â”‚ â”‚ +def get_migration_config(package_name: str, *, target_metadata=None, **kwargs):
â”‚ â”‚ +    schema_package_dir = str(get_schema_package_info(package_name)[0])
â”‚ â”‚      if target_metadata is None:
â”‚ â”‚          target_metadata = SQLModel.metadata
â”‚ â”‚      target_metadata.naming_convention = {
â”‚ â”‚          "ix": "ix_%(column_0_label)s",
â”‚ â”‚          "uq": "uq_%(table_name)s_%(column_0_name)s",
â”‚ â”‚          "ck": "ck_%(table_name)s_`%(constraint_name)s`",
â”‚ â”‚          "fk": "fk_%(table_name)s_%(column_0_name)s_%(referred_table_name)s",
â”‚ â”‚          "pk": "pk_%(table_name)s",
â”‚ â”‚      }
â”‚ â”‚      raw_config = dict(
â”‚ â”‚ -        config_file_name=f"{schema_package_loc}/alembic.ini",
â”‚ â”‚ -        script_location=f"{schema_package_loc}/migrations",
â”‚ â”‚ +        config_file_name=f"{schema_package_dir}/alembic.ini",
â”‚ â”‚ +        script_location=f"{schema_package_dir}/migrations",
â”‚ â”‚          target_metadata=target_metadata,
â”‚ â”‚          **kwargs,
â”‚ â”‚      )
â”‚ â”‚      config = Config.from_raw_config(raw_config)
â”‚ â”‚      return config
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚ -def get_migration_context(schema_package, db, include_schemas=None):
â”‚ â”‚ +def get_migration_context(package_name: str, db: str, include_schemas=None):
â”‚ â”‚      engine = sa.create_engine(db)
â”‚ â”‚ -    config = get_migration_config(schema_package, include_schemas=include_schemas)
â”‚ â”‚ +    config = get_migration_config(package_name, include_schemas=include_schemas)
â”‚ â”‚      command_executor = CommandExecutor.from_config(config)
â”‚ â”‚      command_executor.configure(connection=engine)
â”‚ â”‚      migration_context = MigrationContext.from_config(
â”‚ â”‚          config, command_executor, ConnectionExecutor(), engine
â”‚ â”‚      )
â”‚ â”‚      return migration_context
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚ -def get_migration_id_from_scripts(schema_package):
â”‚ â”‚ -    config = get_migration_config(schema_package)
â”‚ â”‚ +def get_migration_id_from_scripts(package_name: str):
â”‚ â”‚ +    config = get_migration_config(package_name)
â”‚ â”‚      output_buffer = io.StringIO()
â”‚ â”‚ +    schema_package_dir = str(get_schema_package_info(package_name)[0])
â”‚ â”‚      # get the id of the latest migration script
â”‚ â”‚ -    if Path(f"./{schema_package}/migrations/versions").exists():
â”‚ â”‚ +    if Path(f"{schema_package_dir}/migrations/versions").exists():
â”‚ â”‚          command.heads(config.make_alembic_config(stdout=output_buffer))
â”‚ â”‚          output = output_buffer.getvalue()
â”‚ â”‚          migration_id = output.split(" ")[0]
â”‚ â”‚      else:  # there is no scripts directory
â”‚ â”‚ +        logger.warning(f"'{schema_package_dir}/migrations/versions' does not exist")
â”‚ â”‚          migration_id = ""
â”‚ â”‚      return migration_id
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚  def migration_id_is_consistent(package_name):
â”‚ â”‚      # package_name is either a simple module (if schema is at the root)
â”‚ â”‚      # or a relative path to the submodule that contains the schema,
â”‚ â”‚      # e.g. ./lnhub_rest/schema
â”‚ â”‚ -    migration_id = get_migration_id_from_scripts(package_name)
â”‚ â”‚ +    migration_id_from_scripts = get_migration_id_from_scripts(package_name)
â”‚ â”‚      if package_name.startswith("./"):
â”‚ â”‚          _, root, relative = package_name.split("/")
â”‚ â”‚          assert relative == "schema"
â”‚ â”‚          package = importlib.import_module(f".{relative}", package=root.lstrip("./"))
â”‚ â”‚      else:
â”‚ â”‚          package = importlib.import_module(package_name)
â”‚ â”‚      if package._migration is None:
â”‚ â”‚ -        manual_migration_id = ""
â”‚ â”‚ +        migration_id_from_import = ""
â”‚ â”‚      else:
â”‚ â”‚ -        manual_migration_id = package._migration
â”‚ â”‚ -    return manual_migration_id == migration_id
â”‚ â”‚ +        migration_id_from_import = package._migration
â”‚ â”‚ +    return migration_id_from_import == migration_id_from_scripts
â”‚ â”‚  
â”‚ â”‚  
â”‚ â”‚ -def model_definitions_match_ddl(schema_package, db=None, dialect_name="sqlite"):
â”‚ â”‚ +def model_definitions_match_ddl(package_name, db=None, dialect_name="sqlite"):
â”‚ â”‚ +    generate_module_files(package_name)
â”‚ â”‚      if db is None and dialect_name == "sqlite":
â”‚ â”‚          db = "sqlite:///testdb/testdb.lndb"
â”‚ â”‚          # need to call init to reload schema
â”‚ â”‚          init(storage="testdb", _migrate=False)
â”‚ â”‚      elif db is None and dialect_name == "postgresql":
â”‚ â”‚          # requires postgres has been set up through _nox_tools
â”‚ â”‚          db = "postgresql://postgres:pwd@0.0.0.0:5432/pgtest"
â”‚ â”‚ @@ -94,15 +100,15 @@
â”‚ â”‚              "Only sqlite and postgres test databases are implemented."
â”‚ â”‚          )
â”‚ â”‚      # the below is for debugging purposes, something with indexes doesn't work 100%
â”‚ â”‚      # e = sa.create_engine(db)
â”‚ â”‚      # print(sa.inspect(e).get_indexes("core.dobject"))
â”‚ â”‚      include_schemas = True if dialect_name == "postgresql" else False
â”‚ â”‚      migration_context = get_migration_context(
â”‚ â”‚ -        schema_package, db, include_schemas=include_schemas
â”‚ â”‚ +        package_name, db, include_schemas=include_schemas
â”‚ â”‚      )
â”‚ â”‚      execute_model_definitions_match_ddl(migration_context)
â”‚ â”‚      if dialect_name == "postgresql":
â”‚ â”‚          run("docker stop pgtest && docker rm pgtest", shell=True)
â”‚ â”‚          delete("pgtest")
â”‚ â”‚      else:
â”‚ â”‚          delete("testdb")
â”‚ â”‚   --- lndb-0.39.2/noxfile.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/noxfile.py
â”‚ â”‚â”„ Files identical despite different names
â”‚ â”‚   --- lndb-0.39.2/tests/test_init_instance.py
â”‚ â”œâ”€â”€ +++ lndb-0.40.0/tests/test_init_instance.py
â”‚ â”‚â”„ Files identical despite different names
